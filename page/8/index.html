<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"fyerfyer.github.io.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":2,"unescape":true,"preload":false}}</script><script src="/js/config.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">


    <meta name="description" content="fyerfyer&apos;s blog">
<meta property="og:type" content="website">
<meta property="og:title" content="fyerfyer">
<meta property="og:url" content="https://fyerfyer.github.io.com/page/8/index.html">
<meta property="og:site_name" content="fyerfyer">
<meta property="og:description" content="fyerfyer&apos;s blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="fyerfyer">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://fyerfyer.github.io.com/page/8/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/8/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>fyerfyer</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="&#x5207;&#x6362;&#x5BFC;&#x822A;&#x680F;" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">fyerfyer</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Hello! Nice to meet you!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="&#x641C;&#x7D22;" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>&#x9996;&#x9875;</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>&#x5173;&#x4E8E;</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>&#x5206;&#x7C7B;</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>&#x5F52;&#x6863;</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>&#x641C;&#x7D22;
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="&#x641C;&#x7D22;..." spellcheck="false" type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          &#x6587;&#x7AE0;&#x76EE;&#x5F55;
        </li>
        <li class="sidebar-nav-overview">
          &#x7AD9;&#x70B9;&#x6982;&#x89C8;
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="fyerfyer" src="/images/head.png">
  <p class="site-author-name" itemprop="name">fyerfyer</p>
  <div class="site-description" itemprop="description">fyerfyer&apos;s blog</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">126</span>
          <span class="site-state-item-name">&#x65E5;&#x5FD7;</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">38</span>
        <span class="site-state-item-name">&#x5206;&#x7C7B;</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/fyerfyer" title="GitHub &#x2192; https://github.com/fyerfyer" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/fuy60703@gmail.com" title="E-Mail &#x2192; fuy60703@gmail.com" rel="noopener me"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="&#x8FD4;&#x56DE;&#x9876;&#x90E8;">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/9.2.Quick%20Find/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/9.2.Quick%20Find/" class="post-title-link" itemprop="url">9.2.&#x5FEB;&#x901F;&#x67E5;&#x627E;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 17:51:55" itemprop="dateModified" datetime="2024-06-02T17:51:55+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/9-Disjoint-sets/" itemprop="url" rel="index"><span itemprop="name">9.Disjoint sets</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>334</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1><span id="92&#x5FEB;&#x901F;&#x67E5;&#x627E;"><span class="math inline">\(9.2\)</span>&#x5FEB;&#x901F;&#x67E5;&#x627E;</span></h1>
<h3><span id="1&#x5E76;&#x67E5;&#x96C6;&#x7684;&#x6784;&#x9020;">1.&#x5E76;&#x67E5;&#x96C6;&#x7684;&#x6784;&#x9020;</span></h3>
<p>&#x2003;&#x2003;&#x76F4;&#x89C2;&#x4E0A;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<span class="math inline">\(ListOfSet\)</span>&#x6765;&#x8868;&#x793A;&#x5E76;&#x67E5;&#x96C6;&#xFF0C;&#x4F8B;&#x5982;<code>[{0}, {1}, {2}, {3}, {4}, {5}, {6}]</code>&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x8FD9;&#x79CD;&#x5F62;&#x5F0F;&#x7684;&#x5E76;&#x67E5;&#x96C6;&#x96BE;&#x4EE5;&#x5408;&#x5E76;&#x3002;</p>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x8003;&#x8651;&#x53EA;&#x7528;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#x6765;&#x5B9E;&#x73B0;&#x5E76;&#x67E5;&#x96C6;&#x7684;&#x5408;&#x5E76;&#x64CD;&#x4F5C;&#xFF0C;&#x8BE5;&#x6570;&#x7EC4;&#x6309;&#x5982;&#x4E0B;&#x65B9;&#x5F0F;&#x6784;&#x9020;&#xFF1A;</p>
<ul>
<li>&#x6570;&#x7EC4;&#x7684;&#x4E0B;&#x6807;&#x503C;&#x4EE3;&#x8868;&#x5143;&#x7D20;&#x672C;&#x8EAB;&#x3002;</li>
<li>&#x6570;&#x7EC4;&#x4E0B;&#x6807;&#x5BF9;&#x5E94;&#x7684;&#x503C;&#x4EE3;&#x8868;&#x5143;&#x7D20;&#x6240;&#x5C5E;&#x96C6;&#x5408;&#x7684;&#x5E8F;&#x53F7;&#x3002;</li>
</ul>
<p>&#x2003;&#x2003;&#x4F8B;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5982;&#x4E0B;&#x8868;&#x793A;<code>{0, 1, 2, 4}, {3, 5}, {6}</code>&#xFF1A;</p>
<p><img src="/2024/05/31/9.2.Quick%20Find/image.png"></p>
<p>&#x2003;&#x2003;&#x96C6;&#x5408;&#x7684;&#x5E8F;&#x53F7;&#x5E76;&#x4E0D;&#x91CD;&#x8981;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x786E;&#x4FDD;&#x76F8;&#x540C;&#x7684;&#x96C6;&#x5408;&#x7684;&#x503C;&#x76F8;&#x540C;&#x5373;&#x53EF;&#x3002;</p>
<h3><span id="2connect&#x64CD;&#x4F5C;">2.<code>connect</code>&#x64CD;&#x4F5C;</span></h3>
<p>&#x2003;&#x2003;&#x6709;&#x4E86;&#x4E0A;&#x9762;&#x7684;&#x6784;&#x9020;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x66F4;&#x6539;&#x6570;&#x7EC4;&#x5BF9;&#x5E94;&#x4E0B;&#x6807;&#x7684;&#x503C;&#x6765;&#x5B9E;&#x73B0;&#x5408;&#x5E76;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5047;&#x5982;&#x6211;&#x4EEC;&#x60F3;&#x5C06;<span class="math inline">\(2\)</span>&#x4E0E;<span class="math inline">\(3\)</span>&#x5408;&#x5E76;&#xFF1A;</p>
<p><img src="/2024/05/31/9.2.Quick%20Find/image-1.png"></p>
<h3><span id="3isconnected&#x64CD;&#x4F5C;">3.<code>isConnected</code>&#x64CD;&#x4F5C;</span></h3>
<p>&#x2003;&#x2003;&#x4E3A;&#x4E86;&#x68C0;&#x67E5;<code>isConnected(x, y)</code>&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x68C0;&#x67E5;&#x5B83;&#x4EEC;&#x5BF9;&#x5E94;&#x96C6;&#x5408;&#x7684;&#x5E8F;&#x53F7;&#x662F;&#x5426;&#x76F8;&#x7B49;&#x5373;&#x53EF;&#x3002;&#x8FD9;&#x53EA;&#x9700;&#x8981;&#x5E38;&#x6570;&#x65F6;&#x95F4;&#x3002;</p>
<h3><span id="4&#x603B;&#x7ED3;&#x4E0E;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;">4.&#x603B;&#x7ED3;&#x4E0E;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;</span></h3>
<p><img src="/2024/05/31/9.2.Quick%20Find/image-2.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QuickFindDS</span> <span class="keyword">implements</span> <span class="title class_">DisjointSets</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span>[] id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">QuickFindDS</span><span class="params">(<span class="type">int</span> N)</span> {</span><br><span class="line">        id = <span class="keyword">new</span> <span class="title class_">int</span>[N];</span><br><span class="line">        <span class="comment">// initialize the parent</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; N; i += <span class="number">1</span>) {</span><br><span class="line">            id[i] = i;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">connect</span><span class="params">(<span class="type">int</span> p, <span class="type">int</span> q)</span> {</span><br><span class="line">        <span class="type">int</span> <span class="variable">pid</span> <span class="operator">=</span> id[p];</span><br><span class="line">        <span class="type">int</span> <span class="variable">qid</span> <span class="operator">=</span> id[q];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; id.length; i += <span class="number">1</span>) {</span><br><span class="line">            <span class="keyword">if</span> (id[i] == pid) {</span><br><span class="line">                id[i] = qid;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isConnected</span><span class="params">(<span class="type">int</span> p, <span class="type">int</span> q)</span> {</span><br><span class="line">        <span class="keyword">return</span> id[p] == id[q];</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/9.3.Quick%20Union/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/9.3.Quick%20Union/" class="post-title-link" itemprop="url">9.3.&#x5FEB;&#x901F;&#x5408;&#x5E76;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 17:57:09" itemprop="dateModified" datetime="2024-06-02T17:57:09+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/9-Disjoint-sets/" itemprop="url" rel="index"><span itemprop="name">9.Disjoint sets</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>469</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1><span id="93&#x5FEB;&#x901F;&#x5408;&#x5E76;"><span class="math inline">\(9.3\)</span>&#x5FEB;&#x901F;&#x5408;&#x5E76;</span></h1>
<h3><span id="1&#x6839;&#x8282;&#x70B9;&#x7684;&#x5F15;&#x5165;">1.&#x6839;&#x8282;&#x70B9;&#x7684;&#x5F15;&#x5165;</span></h3>
<p>&#x2003;&#x2003;&#x5047;&#x5982;&#x6211;&#x4EEC;&#x60F3;&#x8BA9;<code>connect</code>&#x64CD;&#x4F5C;&#x5FEB;&#x4E00;&#x4E9B;&#xFF0C;&#x7531;&#x4E8E;&#x5148;&#x524D;&#x7528;<span class="math inline">\(id[x]\)</span>&#x4EE3;&#x6307;&#x6240;&#x5C5E;&#x96C6;&#x5408;&#x7684;&#x64CD;&#x4F5C;&#x4ECD;&#x662F;&#x901A;&#x8FC7;&#x904D;&#x5386;&#x5E8F;&#x5217;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A;&#x7EBF;&#x6027;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x7528;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x4EE3;&#x6307;&#x6574;&#x4E2A;&#x96C6;&#x5408;&#xFF0C;&#x8FD9;&#x6837;&#x5408;&#x5E76;&#x64CD;&#x4F5C;&#x53EA;&#x9700;&#x8981;&#x5408;&#x5E76;&#x4E24;&#x4E2A;&#x5143;&#x7D20;&#x5373;&#x53EF;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5BF9;&#x5E8F;&#x5217;&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#xFF0C;&#x6211;&#x4EEC;&#x7ED9;&#x5B83;&#x5206;&#x6D3E;(<span class="math inline">\(assign\)</span>)&#x4E00;&#x4E2A;&#x503C;&#xFF0C;&#x8FD9;&#x4E2A;&#x503C;&#x662F;&#x5B83;&#x7684;&#x7236;&#x4EB2;(<span class="math inline">\(parent\)</span>)&#x7684;&#x7D22;&#x5F15;&#xFF1B;&#x5982;&#x679C;&#x67D0;&#x4E2A;&#x5143;&#x7D20;&#x6CA1;&#x6709;&#x7D22;&#x5F15;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x5C31;&#x662F;&#x6839;&#x8282;&#x70B9;&#xFF0C;&#x6211;&#x4EEC;&#x7ED9;&#x5B83;&#x5206;&#x6D3E;&#x4E00;&#x4E2A;&#x8D1F;&#x6570;&#x7684;&#x503C;&#x3002;&#x4E0B;&#x9762;&#x7684;&#x56FE;&#x793A;&#x5C55;&#x793A;&#x4E86;<code>{0, 1, 2, 4}, {3, 5}, {6}</code>&#x7684;&#x5BF9;&#x5E94;&#x8868;&#x793A;&#xFF1A;</p>
<p><img src="/2024/05/31/9.3.Quick%20Union/image-3.png"></p>
<p>&#x2003;&#x2003;&#x4E3A;&#x4E86;&#x5B9E;&#x73B0;&#x5FEB;&#x901F;&#x5408;&#x5E76;&#xFF0C;&#x6211;&#x4EEC;&#x5F15;&#x5165;&#x4E00;&#x4E2A;&#x8F85;&#x52A9;&#x51FD;&#x6570;<code>find(int item)</code>&#xFF0C;&#x5B83;&#x8FD4;&#x56DE;&#x67D0;&#x4E2A;&#x5143;&#x7D20;&#x5BF9;&#x5E94;&#x7684;&#x6839;&#x8282;&#x70B9;&#x3002;</p>
<h3><span id="2connectx-y">2.<code>connect(x, y)</code></span></h3>
<p>&#x2003;&#x2003;&#x4E3A;&#x4E86;&#x5408;&#x5E76;&#x4E24;&#x5143;&#x7D20;&#xFF0C;&#x6211;&#x4EEC;&#x627E;&#x5230;&#x4E24;&#x4E2A;&#x5143;&#x7D20;&#x5BF9;&#x5E94;&#x7684;&#x6839;&#x8282;&#x70B9;&#xFF0C;&#x7136;&#x540E;&#x8BA9;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x6839;&#x8282;&#x70B9;&#x4F5C;&#x4E3A;&#x53E6;&#x4E00;&#x4E2A;&#x7684;&#x513F;&#x5B50;(<span class="math inline">\(child\)</span>)&#x3002;&#x4F8B;&#x5982;<code>connect(5, 2)</code>&#x9700;&#x8981;&#x8FDB;&#x884C;&#x5982;&#x4E0B;&#x64CD;&#x4F5C;&#xFF1A;</p>
<ol type="1">
<li><code>find(5)</code> <span class="math inline">\(\rightarrow
3\)</span></li>
<li><code>find(2)</code> <span class="math inline">\(\rightarrow
0\)</span></li>
<li>&#x8BBE;&#x7F6E;<code>parent[3] = 0</code></li>
</ol>
<p><img src="/2024/05/31/9.3.Quick%20Union/image-4.png"></p>
<h3><span id="3isconnectedx-y">3.<code>isConnected(x, y)</code></span></h3>
<p>&#x2003;&#x2003;&#x5982;&#x679C;&#x4E24;&#x4E2A;&#x5143;&#x7D20;&#x540C;&#x5C5E;&#x4E00;&#x4E2A;&#x96C6;&#x5408;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x4EEC;&#x7684;&#x6839;&#x8282;&#x70B9;&#x5E94;&#x8BE5;&#x76F8;&#x540C;&#x3002;&#x53EA;&#x9700;&#x68C0;&#x67E5;<code>find(x) == find(y)</code>&#x5373;&#x53EF;&#x3002;</p>
<h3><span id="4&#x603B;&#x7ED3;&#x4E0E;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;">4.&#x603B;&#x7ED3;&#x4E0E;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;</span></h3>
<p><img src="/2024/05/31/9.3.Quick%20Union/image-6.png"></p>
<p>&#x2003;&#x2003;&#x770B;&#x8D77;&#x6765;&#x5FEB;&#x901F;&#x5408;&#x5E76;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x6BD4;&#x5FEB;&#x901F;&#x67E5;&#x8BE2;&#x957F;&#xFF01;&#x4F46;&#x662F;<span class="math inline">\(O(n)\)</span>&#x4EE3;&#x8868;&#x7684;&#x662F;&#x5FEB;&#x901F;&#x5408;&#x5E76;&#x7684;&#x4E0A;&#x754C;&#x3002;&#x5F53;&#x6211;&#x4EEC;&#x7684;&#x6811;&#x6BD4;&#x8F83;&#x5E73;&#x8861;&#x65F6;&#xFF0C;&#x5FEB;&#x901F;&#x67E5;&#x8BE2;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4F1A;&#x975E;&#x5E38;&#x4F18;&#x79C0;&#x3002;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QuickUnionDS</span> <span class="keyword">implements</span> <span class="title class_">DisjointSets</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span>[] parent;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">QuickUnionDS</span><span class="params">(<span class="type">int</span> num)</span> {</span><br><span class="line">        parent = <span class="keyword">new</span> <span class="title class_">int</span>[num];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; num; i += <span class="number">1</span>) {</span><br><span class="line">            parent[i] = -<span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">find</span><span class="params">(<span class="type">int</span> p)</span> {</span><br><span class="line">        <span class="keyword">while</span>(parent[p] &gt;= <span class="number">0</span>) {</span><br><span class="line">            p = parent[p];</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">connect</span><span class="params">(<span class="type">int</span> p, <span class="type">int</span> q)</span> {</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> find(p);</span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> find(q);</span><br><span class="line">        parent[i] = j;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isConnected</span><span class="params">(<span class="type">int</span> p, <span class="type">int</span> q)</span> {</span><br><span class="line">        <span class="keyword">return</span> find(p) == find(q);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/22/1-3-C-Intro/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/22/1-3-C-Intro/" class="post-title-link" itemprop="url">1.3.C Intro</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-22 11:31:00" itemprop="dateCreated datePublished" datetime="2024-05-22T11:31:00+08:00">2024-05-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 21:28:45" itemprop="dateModified" datetime="2024-06-03T21:28:45+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/" itemprop="url" rel="index"><span itemprop="name">CS61C Great Ideas in Computer Architecture</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/Module-1-Intro/" itemprop="url" rel="index"><span itemprop="name">Module 1.Intro</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>418</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1><span id="13c-intro"><span class="math inline">\(1.3.\)</span>C Intro</span></h1>
<h3><span id="1c-compilation">1.C compilation</span></h3>
<p><img src="/2024/05/22/1-3-C-Intro/image.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-1.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-2.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-3.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-4.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-5.png"></p>
<h3><span id="2some-c-grammar">2.Some C grammar</span></h3>
<p><img src="/2024/05/22/1-3-C-Intro/image-6.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-7.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-8.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-9.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-10.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-11.png"></p>
<h3><span id="3c-pointer">3.C pointer</span></h3>
<p><img src="/2024/05/22/1-3-C-Intro/image-12.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-13.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-14.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-15.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-16.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-17.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-18.png"></p>
<h3><span id="4pointer-operation">4.Pointer operation</span></h3>
<p><img src="/2024/05/22/1-3-C-Intro/image-19.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-20.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-21.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-22.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-23.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-24.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-25.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-26.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-27.png"></p>
<blockquote>
<p>Why? * <em>Address validity</em>: The pointer is used to store the
memory address and point at the specified data. If we cast an integer to
a pointer, the integer may <strong>not be an valid memory
address</strong>, and visit this address will lead to program crash. *
<em>Type system protection</em>: Cast ignores the protection of the type
system. An important function of the type system is to ensure that the
operations in your code are safe. For example, converting an integer to
a pointer and accessing it, skipping the type system check, might result
in accessing an incorrect data type.</p>
</blockquote>
<hr>
<p><img src="/2024/05/22/1-3-C-Intro/image-28.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-29.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-30.png"></p>
<hr>
<p><img src="/2024/05/22/1-3-C-Intro/image-31.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-32.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-33.png"></p>
<hr>
<p><img src="/2024/05/22/1-3-C-Intro/image-34.png"></p>
<h3><span id="5c-string">5.C string</span></h3>
<p><img src="/2024/05/22/1-3-C-Intro/image-35.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-36.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-37.png"></p>
<h3><span id="6c-structures">6.C structures</span></h3>
<p><img src="/2024/05/22/1-3-C-Intro/image-38.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-39.png"></p>
<h3><span id="7error-types">7.Error types</span></h3>
<p><img src="/2024/05/22/1-3-C-Intro/image-40.png"></p>
<hr>
<p><img src="/2024/05/22/1-3-C-Intro/image-41.png"></p>
<h3><span id="8c-array">8.C array</span></h3>
<p><img src="/2024/05/22/1-3-C-Intro/image-42.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-43.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-44.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-45.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-46.png"></p>
<h3><span id="9endianness">9.Endianness</span></h3>
<p><img src="/2024/05/22/1-3-C-Intro/image-47.png"></p>
<h3><span id="10c-memory-management">10.C memory management</span></h3>
<p><img src="/2024/05/22/1-3-C-Intro/image-48.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-49.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-50.png"></p>
<hr>
<p><img src="/2024/05/22/1-3-C-Intro/image-51.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-52.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-53.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-54.png"></p>
<hr>
<p><img src="/2024/05/22/1-3-C-Intro/image-55.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-56.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-57.png"></p>
<blockquote>
<p>For example, the following program is right: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">void functionB(int *ptr) {</span><br><span class="line">    printf(&quot;Value: %d\n&quot;, *ptr);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">void functionA() {</span><br><span class="line">    int x = 10;</span><br><span class="line">    functionB(&amp;x);</span><br><span class="line">}</span><br></pre></td></tr></table></figure> Because
the local variable is stored on the stack during the run of
<code>functionB</code>, it&apos;s safe to pass its pointer to the
function.</p>
<p>However, this program is wrong: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">int* function() {</span><br><span class="line">    int x = 10;</span><br><span class="line">    return &amp;x; </span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">void example() {</span><br><span class="line">    int *p = function(); </span><br><span class="line">    printf(&quot;Value: %d\n&quot;, *p);</span><br><span class="line">}</span><br></pre></td></tr></table></figure> After the function is
returned, <strong>the stack frame where <code>x</code> is located is
released</strong>, and <strong>the memory address pointed to by pointer
<code>p</code> may be overwritten by other data</strong>. This can lead
to undefined behavior</p>
</blockquote>
<p><img src="/2024/05/22/1-3-C-Intro/image-58.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-59.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-60.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-61.png"></p>
<blockquote>
<p>Static string constants are typically <strong>stored in read-only
memory</strong>, and modifying these is an undifined behavior in C.</p>
</blockquote>
<p><img src="/2024/05/22/1-3-C-Intro/image-62.png"></p>
<hr>
<p><img src="/2024/05/22/1-3-C-Intro/image-63.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-64.png"></p>
<blockquote>
<p>The main reason for placing 4 bytes of data on multiples of 4 is to
<strong>optimize the processor&apos;s memory access efficiency</strong>.
Suppose a processor has a 4-byte memory bus width. When accessing 4-byte
aligned data, the processor <strong>can retrieve the entire data in one
memory read operation</strong>. If the data is not aligned (for example,
an int spanning two memory addresses) , the processor may <strong>need
to perform two memory reads and then merge the two reads</strong>. This
can cause performance degradation.</p>
</blockquote>
<figure>
<img src="/2024/05/22/1-3-C-Intro/image-65.png" alt="Alt text">
<figcaption aria-hidden="true">Alt text</figcaption>
</figure>
<blockquote>
<p>Let&apos;s take an example to illustrate the alignment process:
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">struct Example { </span><br><span class="line">	char a; </span><br><span class="line">	int b; </span><br><span class="line">};</span><br></pre></td></tr></table></figure> The <code>a</code> requires 1 byte, and alignment requires
1 byte, so it can be placed at the starting address of the
struction.</p>
<p>The <code>b</code> requires 4 bytes, and alignement requires 4 bytes,
so <strong>it must be placed on a multiple of 4 address.</strong> To
satisfy <code>b</code>&apos;s alignment requirements, the compiler
<strong>inserts three padding bytes after <code>a</code></strong>,
making <code>b</code>&apos;s address a multiple of 4.</p>
</blockquote>
<hr>
<p><img src="/2024/05/22/1-3-C-Intro/image-66.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-67.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-68.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-69.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-70.png"></p>
<hr>
<p><img src="/2024/05/22/1-3-C-Intro/image-71.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-72.png"></p>
<hr>
<p><img src="/2024/05/22/1-3-C-Intro/image-73.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-74.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-75.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-76.png"></p>
<hr>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/19/1-2-Number-Representation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/19/1-2-Number-Representation/" class="post-title-link" itemprop="url">1.2.Number Representation</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-19 10:31:00" itemprop="dateCreated datePublished" datetime="2024-05-19T10:31:00+08:00">2024-05-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 18:03:59" itemprop="dateModified" datetime="2024-06-03T18:03:59+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/" itemprop="url" rel="index"><span itemprop="name">CS61C Great Ideas in Computer Architecture</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/Module-1-Intro/" itemprop="url" rel="index"><span itemprop="name">Module 1.Intro</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>64</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1><span id="12number-representation"><span class="math inline">\(1.2.\)</span>Number Representation</span></h1>
<h3><span id="1binary-representation">1.Binary representation</span></h3>
<p><img src="/2024/05/19/1-2-Number-Representation/image.png"></p>
<p><img src="/2024/05/19/1-2-Number-Representation/image-1.png"></p>
<p><img src="/2024/05/19/1-2-Number-Representation/image-2.png"></p>
<ul>
<li>We move -1 to the right by one, -2 to the right, etc. Then the two
0s overlap:</li>
</ul>
<p><img src="/2024/05/19/1-2-Number-Representation/image-3.png"></p>
<p><img src="/2024/05/19/1-2-Number-Representation/image-4.png"></p>
<p><img src="/2024/05/19/1-2-Number-Representation/image-5.png"></p>
<p><img src="/2024/05/19/1-2-Number-Representation/image-6.png"></p>
<p><img src="/2024/05/19/1-2-Number-Representation/image-7.png"></p>
<h3><span id="2bias-encoding">2.Bias encoding</span></h3>
<p><img src="/2024/05/19/1-2-Number-Representation/image-8.png"></p>
<p><img src="/2024/05/19/1-2-Number-Representation/image-9.png"></p>
<p><img src="/2024/05/19/1-2-Number-Representation/image-10.png"></p>
<p><img src="/2024/05/19/1-2-Number-Representation/image-11.png"></p>
<p><img src="/2024/05/19/1-2-Number-Representation/image-12.png"></p>
<p><img src="/2024/05/19/1-2-Number-Representation/image-13.png"></p>
<p><img src="/2024/05/19/1-2-Number-Representation/image-14.png"></p>
<ul>
<li>Because the biased number are all <strong>start at 0</strong>,
<strong>the MSB doesn&apos;t represent the sign anymore</strong>. So in
floating point, we can compare two biased number directly as if they
were unsigned number.</li>
</ul>
<h3><span id="3iec-standard-prefixes">3.IEC standard prefixes</span></h3>
<p><img src="/2024/05/19/1-2-Number-Representation/image-15.png"></p>
<p><img src="/2024/05/19/1-2-Number-Representation/image-16.png"></p>
<p><img src="/2024/05/19/1-2-Number-Representation/image-17.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/18/1-1-Great-Idea-Intro/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/18/1-1-Great-Idea-Intro/" class="post-title-link" itemprop="url">1.1.Great Indea Intro</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-18 11:31:00" itemprop="dateCreated datePublished" datetime="2024-05-18T11:31:00+08:00">2024-05-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 17:55:57" itemprop="dateModified" datetime="2024-06-03T17:55:57+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/" itemprop="url" rel="index"><span itemprop="name">CS61C Great Ideas in Computer Architecture</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/Module-1-Intro/" itemprop="url" rel="index"><span itemprop="name">Module 1.Intro</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>197</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3><span id="1cs61c-intro">1.CS61C intro</span></h3>
<p><img src="/2024/05/18/1-1-Great-Idea-Intro/image-4.png"></p>
<ul>
<li>The hareware is composed of <strong>a gazillion computers in
parallel</strong>.</li>
<li>The computers are consisted of <strong>parallel computers within the
processing unit</strong>.</li>
<li>We get parallelism all the way down the stack.</li>
</ul>
<p><img src="/2024/05/18/1-1-Great-Idea-Intro/image-5.png"></p>
<h3><span id="2abstraction">2.Abstraction</span></h3>
<p><img src="/2024/05/18/1-1-Great-Idea-Intro/image.png"></p>
<ul>
<li>Each level of abstraction is only influenced by <strong>the level
above or below by one</strong>.</li>
<li>We can change out the architecture and keep the same machine
language to make program run faster.</li>
</ul>
<h3><span id="3moores-law">3.Moore&apos;s law</span></h3>
<p><img src="/2024/05/18/1-1-Great-Idea-Intro/image-1.png"></p>
<ul>
<li><em>Moore&apos;s law</em>: Over time, the number of transistors that&apos;s
actual switches keeps growing exponentially.</li>
<li>However, we hit a brick wall that getting more performance is no
longer a matter of improving processes and adding transistors, but
<strong>exploiting parallelsome</strong>.</li>
</ul>
<h3><span id="4localitymemory-hierarchy">4.Locality/Memory Hierarchy</span></h3>
<ul>
<li>It&apos;s about <strong>how far away is a piece of data</strong>.</li>
</ul>
<p><img src="/2024/05/18/1-1-Great-Idea-Intro/image-2.png"></p>
<p><img src="/2024/05/18/1-1-Great-Idea-Intro/image-3.png"></p>
<h3><span id="5parallelism">5.Parallelism</span></h3>
<ul>
<li>We do lots of things at once, even within the most processor.</li>
<li>On the program, we spilt things up.</li>
</ul>
<p><img src="/2024/05/18/1-1-Great-Idea-Intro/image-6.png"></p>
<ul>
<li>However, there&apos;s a limit called <em>Amdahl&apos;s Law</em>: The amount
you can speed up something by parallelization depends on <strong>the
amount that&apos;s actually parallelizable</strong>. If the problem isn&apos;t
parallelizable, then it will fail.</li>
</ul>
<h3><span id="6dependability-viaredundancy">6.Dependability via
redundancy</span></h3>
<ul>
<li>To deal with failures, we use <em>redundancy</em> so that a failing
piece doesn&apos;t make the whole thing fail:</li>
</ul>
<p><img src="/2024/05/18/1-1-Great-Idea-Intro/image-7.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/04/10-11-%E7%BC%96%E8%AF%91%E5%99%A8%E5%AE%9E%E7%8E%B0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/04/10-11-%E7%BC%96%E8%AF%91%E5%99%A8%E5%AE%9E%E7%8E%B0%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">10.11.&#x7F16;&#x8BD1;&#x5668;&#x5B9E;&#x73B0;&#x7B14;&#x8BB0;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-04 20:15:43" itemprop="dateCreated datePublished" datetime="2024-05-04T20:15:43+08:00">2024-05-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 16:06:53" itemprop="dateModified" datetime="2024-06-03T16:06:53+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-10-Code-Generator/" itemprop="url" rel="index"><span itemprop="name">Module 10.Code Generator</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>4.2k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>15 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1><span id="1011&#x7F16;&#x8BD1;&#x5668;&#x5B9E;&#x73B0;&#x7B14;&#x8BB0;"><span class="math inline">\(10.11.\)</span>&#x7F16;&#x8BD1;&#x5668;&#x5B9E;&#x73B0;&#x7B14;&#x8BB0;</span></h1>
<h3><span id="1symbol-table&#x5B9E;&#x73B0;">1.<code>Symbol Table</code>&#x5B9E;&#x73B0;</span></h3>
<p>&#x2003;&#x2003;&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x8BFB;&#x53D6;&#x5355;&#x4E00;&#x5B57;&#x7B26;&#xFF0C;&#x6211;&#x4EEC;&#x9009;&#x62E9;<strong>&#x5229;&#x7528;<code>tokenizer</code>&#x751F;&#x6210;&#x7684;&#x4EE3;&#x7801;</strong>&#x6765;&#x6784;&#x5EFA;&#x6211;&#x4EEC;&#x7684;<code>Symbol Table</code>.</p>
<h4><span id="a&#x51C6;&#x5907;&#x5DE5;&#x4F5C;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&#x51C6;&#x5907;&#x5DE5;&#x4F5C;</span></h4>
<ol type="1">
<li>&#x867D;&#x7136;&#x7406;&#x8BBA;&#x4E0A;&#x5E94;&#x8BE5;&#x5BF9;&#x4E8E;&#x6BCF;&#x4E00;&#x4E2A;&#x5B50;&#x7A0B;&#x5E8F;&#xFF0C;&#x6211;&#x4EEC;&#x90FD;&#x5E94;&#x8BE5;&#x5B9E;&#x65F6;&#x5730;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x5BF9;&#x5E94;&#x7684;<code>subroutineMap</code>&#xFF0C;&#x4F46;&#x662F;&#x7531;&#x4E8E;&#x8F83;&#x96BE;&#x5B9E;&#x73B0;&#xFF0C;&#x6211;&#x9009;&#x62E9;&#x904D;&#x5386;&#x6574;&#x4E2A;&#x7A0B;&#x5E8F;&#x540E;&#xFF0C;&#x5C06;&#x6BCF;&#x4E2A;&#x5B50;&#x7A0B;&#x5E8F;&#x5BF9;&#x5E94;&#x7684;<code>subroutineMap</code>&#x7528;&#x4E00;&#x4E2A;&#x65B0;&#x7684;<span class="math inline">\(Map\)</span>&#x6765;&#x5B58;&#x50A8;&#xFF1A;</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//for convenience, we store the symbolTable of each subroutine into a map.</span></span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Map&lt;String, Integer&gt;&gt; mapOfSubVar = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">&#xA0; &#xA0; <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Map&lt;String, String&gt;&gt; mapOfSubVarType = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">&#xA0; &#xA0; <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Map&lt;String, String&gt;&gt; mapOfSubVarKind = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Integer&gt; subroutineVar = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">&#xA0; &#xA0; <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, String&gt; typeOfSubroutineVar = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">&#xA0; &#xA0; <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, String&gt; kindOfSubroutineVar = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;&#x540C;&#x65F6;&#xFF0C;&#x8FD9;&#x8981;&#x6C42;&#x6211;&#x4EEC;&#x8BB0;&#x5F55;&#x4E0B;&#x5F53;&#x524D;&#x904D;&#x5386;&#x7684;&#x5B50;&#x7A0B;&#x5E8F;&#x7684;&#x540D;&#x79F0;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">StringBuilder</span> <span class="variable">currentStringName</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>&#x7531;&#x4E8E;&#x5BF9;&#x6BCF;&#x4E2A;<code>class</code>&#xFF0C;&#x6211;&#x4EEC;&#x90FD;&#x8981;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x65B0;&#x7684;<code>Symbol Table</code>&#xFF0C;
&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x5728;&#x751F;&#x6210;&#x5BF9;&#x5E94;&#x7684;<code>Symbol Table</code>&#x524D;&#x5148;&#x8981;&#x5BF9;&#x50A8;&#x5B58;&#x8868;&#x683C;&#x7684;<span class="math inline">\(Map\)</span>&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;&#xFF1A;</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">startClass</span><span class="params">()</span> {</span><br><span class="line">    classVar.clear();</span><br><span class="line">    typeOfClassVar.clear();</span><br><span class="line">    kindOfClassVar.clear();</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<ol start="3" type="1">
<li>&#x5728;&#x540E;&#x7EED;&#x751F;&#x6210;VM&#x4EE3;&#x7801;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x6BCF;&#x4E2A;&#x53D8;&#x91CF;&#x5BF9;&#x5E94;&#x7684;&#x5E8F;&#x53F7;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8BBE;&#x7F6E;&#x53D8;&#x91CF;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x5B58;&#x50A8;&#xFF1A;</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#xA0; &#xA0; <span class="comment">//use to return the kind index</span></span><br><span class="line">&#xA0; &#xA0; <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">classNum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">&#xA0; &#xA0; <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">argNum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">&#xA0; &#xA0; <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">localNum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//and for subroutine, we store their argNum and localNum</span></span><br><span class="line">&#xA0; &#xA0; <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Integer&gt; subroutineArgNum = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">&#xA0; &#xA0; <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Integer&gt; subroutineLCLNum = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br></pre></td></tr></table></figure>
<h4><span id="b&#x7C7B;&#x53D8;&#x91CF;&#x5904;&#x7406;">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>&#x7C7B;&#x53D8;&#x91CF;&#x5904;&#x7406;</span></h4>
<p>&#x2003;&#x2003;&#x7C7B;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x53D8;&#x91CF;&#x9075;&#x5FAA;&#x4EE5;&#x4E0B;&#x7ED3;&#x6784;&#xFF1A;</p>
<p><span class="math display">\[kind+type+name(,name);\]</span></p>
<p>&#x2003;&#x2003;&#x7531;&#x4E8E;&#x8BE5;&#x7ED3;&#x6784;&#x5177;&#x6709;&#x666E;&#x9002;&#x6027;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;<strong>&#x9012;&#x5F52;</strong>&#x7684;&#x65B9;&#x6CD5;&#x8BFB;&#x53D6;&#x5E76;&#x5904;&#x7406;&#x6211;&#x4EEC;&#x8BFB;&#x5165;&#x7684;<em>token</em>&#xFF1A;</p>
<ol type="1">
<li>&#x5904;&#x7406;&#x4E00;&#x5B9A;&#x5B58;&#x5728;&#x7684;<span class="math inline">\(kind+type+name\)</span>.</li>
<li>&#x5224;&#x65AD;&#x662F;&#x5426;&#x6709;<span class="math inline">\(,name\)</span>&#x90E8;&#x5206;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x7684;&#x8BDD;&#x8FDB;&#x884C;&#x5904;&#x7406;.</li>
<li>&#x9012;&#x5F52;&#x6267;&#x884C;&#x4E0A;&#x8FF0;&#x6B65;&#x9AA4;&#xFF0C;&#x76F4;&#x81F3;&#x4E0B;&#x4E00;&#x4E2A;&#x4F20;&#x5165;&#x53D8;&#x91CF;&#x4E0D;&#x662F;<code>local</code>&#x53D8;&#x91CF;.</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">dealClassVar</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">if</span> (Tokenizer.getNextString().equals(<span class="string">&quot;field&quot;</span>) || Tokenizer.getNextString().equals(<span class="string">&quot;static&quot;</span>)) {</span><br><span class="line">        <span class="comment">// get the kind</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">classVarKind</span> <span class="operator">=</span> Tokenizer.stringAdvance();</span><br><span class="line">        <span class="comment">// get the type</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">classVarType</span> <span class="operator">=</span> Tokenizer.stringAdvance();</span><br><span class="line">        <span class="comment">// get the name</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">classVarName</span> <span class="operator">=</span> Tokenizer.stringAdvance();</span><br><span class="line">        <span class="comment">// add to correspond kind</span></span><br><span class="line">        <span class="keyword">if</span> (classVarKind.equals(<span class="string">&quot;static&quot;</span>)) {</span><br><span class="line">            classVar.put(classVarName, classNum++);</span><br><span class="line">            typeOfClassVar.put(classVarName, classVarType);</span><br><span class="line">            kindOfClassVar.put(classVarName, <span class="string">&quot;this&quot;</span>);</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (classVarKind.equals(<span class="string">&quot;field&quot;</span>)) {</span><br><span class="line">            classVar.put(classVarName, classNum++);</span><br><span class="line">            typeOfClassVar.put(classVarName, classVarType);</span><br><span class="line">            kindOfClassVar.put(classVarName, <span class="string">&quot;this&quot;</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// if there&apos;s a &apos;,&apos;, there remains some vars</span></span><br><span class="line">        <span class="keyword">while</span> (Tokenizer.getNextString().equals(<span class="string">&quot;,&quot;</span>)) {</span><br><span class="line">            Tokenizer.stringAdvance();</span><br><span class="line">            <span class="type">String</span> <span class="variable">nextName</span> <span class="operator">=</span> Tokenizer.stringAdvance();</span><br><span class="line">            <span class="comment">// after the operation, there will be &apos;,&apos; or &apos;;&apos;</span></span><br><span class="line">            <span class="keyword">if</span> (classVarKind.equals(<span class="string">&quot;static&quot;</span>)) {</span><br><span class="line">                classVar.put(nextName, classNum++);</span><br><span class="line">                typeOfClassVar.put(nextName, classVarType);</span><br><span class="line">                kindOfClassVar.put(nextName, <span class="string">&quot;this&quot;</span>);</span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">if</span> (classVarKind.equals(<span class="string">&quot;field&quot;</span>)) {</span><br><span class="line">                classVar.put(nextName, classNum++);</span><br><span class="line">                typeOfClassVar.put(nextName, classVarType);</span><br><span class="line">                kindOfClassVar.put(nextName, <span class="string">&quot;this&quot;</span>);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// then we meets &apos;;&apos;, we skip it</span></span><br><span class="line">        Tokenizer.stringAdvance();</span><br><span class="line">        <span class="comment">// we continuously deal with rest classVar recursively</span></span><br><span class="line">        <span class="keyword">if</span> (Tokenizer.getNextString().equals(<span class="string">&quot;field&quot;</span>) || Tokenizer.getNextString().equals(<span class="string">&quot;static&quot;</span>)) {</span><br><span class="line">            dealClassVar();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// finally, update the current string</span></span><br><span class="line">        currentStringName.setLength(<span class="number">0</span>);</span><br><span class="line">        currentStringName.append(Tokenizer.stringAdvance());</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4><span id="c&#x5B50;&#x7A0B;&#x5E8F;&#x53D8;&#x91CF;">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>&#x5B50;&#x7A0B;&#x5E8F;&#x53D8;&#x91CF;</span></h4>
<p>&#x2003;&#x2003;&#x5B50;&#x7A0B;&#x5E8F;&#x53D8;&#x91CF;&#x7ED3;&#x6784;&#x4E0E;&#x7C7B;&#x53D8;&#x91CF;&#x76F8;&#x4F3C;&#xFF0C;&#x8FD9;&#x91CC;&#x7565;&#x8FC7;&#x3002;&#x9700;&#x8981;&#x6CE8;&#x610F;&#xFF1A;&#x5B50;&#x7A0B;&#x5E8F;&#x4E2D;&#x5305;&#x542B;&#x53C2;&#x6570;&#x53D8;&#x91CF;&#xFF0C;&#x8FD9;&#x4E5F;&#x9700;&#x8981;&#x6211;&#x4EEC;&#x7EB3;&#x5165;&#x8003;&#x8651;&#x7684;&#x8303;&#x7574;&#xFF1A;</p>
<ul>
<li><p>&#x5BF9;&#x53C2;&#x6570;&#x7684;&#x5904;&#x7406;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">dealFuncArgVar</span><span class="params">()</span> {</span><br><span class="line">    <span class="comment">//the function features: Dec + type + funcName + ( + args + )</span></span><br><span class="line">    <span class="comment">//so we need to ignore the irrelevant elements</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">subroutineType</span> <span class="operator">=</span> Tokenizer.stringAdvance();</span><br><span class="line">    currentSubroutineName.setLength(<span class="number">0</span>);</span><br><span class="line">    currentSubroutineName.append(className + <span class="string">&quot;.&quot;</span>);</span><br><span class="line">    currentSubroutineName.append(Tokenizer.stringAdvance());</span><br><span class="line">    Tokenizer.stringAdvance();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//we continue read the arguments until we meet &quot;)&quot;</span></span><br><span class="line">    <span class="keyword">while</span> (!Tokenizer.getNextString().equals(<span class="string">&quot;)&quot;</span>)) {</span><br><span class="line">        <span class="comment">// type + name</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">type</span> <span class="operator">=</span> Tokenizer.stringAdvance();</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> Tokenizer.stringAdvance();</span><br><span class="line">        subroutineVar.put(name, argNum++);</span><br><span class="line">        typeOfSubroutineVar.put(name, type);</span><br><span class="line">        kindOfSubroutineVar.put(name, <span class="string">&quot;argument&quot;</span>);</span><br><span class="line">        <span class="comment">//if there&apos;s a &apos;,&apos;, then we have more args</span></span><br><span class="line">        <span class="keyword">while</span> (Tokenizer.getNextString().equals(<span class="string">&quot;,&quot;</span>)) {</span><br><span class="line">            <span class="comment">//ignore the &apos;,&apos;</span></span><br><span class="line">            Tokenizer.stringAdvance();</span><br><span class="line">            type = Tokenizer.stringAdvance();</span><br><span class="line">            name = Tokenizer.stringAdvance();</span><br><span class="line">            subroutineVar.put(name, argNum++);</span><br><span class="line">            typeOfSubroutineVar.put(name, type);</span><br><span class="line">            kindOfSubroutineVar.put(name, <span class="string">&quot;argument&quot;</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//we ignore the &quot;)&quot;</span></span><br><span class="line">    Tokenizer.stringAdvance();</span><br><span class="line">    <span class="comment">//then we ignore the &quot;{&quot;</span></span><br><span class="line">    Tokenizer.stringAdvance();</span><br><span class="line">    currentStringName.setLength(<span class="number">0</span>);</span><br><span class="line">    currentStringName.append(Tokenizer.stringAdvance());</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure></p></li>
<li><p>&#x5BF9;&#x7A0B;&#x5E8F;&#x4F53;&#x5185;&#x90E8;&#x53D8;&#x91CF;&#x7684;&#x5904;&#x7406;&#xFF1A;</p></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">dealFuncLCLVar</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">if</span> (currentStringName.toString().equals(<span class="string">&quot;var&quot;</span>)) {</span><br><span class="line">        <span class="comment">//var + type + name</span></span><br><span class="line">        <span class="comment">//we skip var first</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">type</span> <span class="operator">=</span> Tokenizer.stringAdvance();</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> Tokenizer.stringAdvance();</span><br><span class="line"></span><br><span class="line">        subroutineVar.put(name, localNum++);</span><br><span class="line">        typeOfSubroutineVar.put(name, type);</span><br><span class="line">        kindOfSubroutineVar.put(name, <span class="string">&quot;local&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//deal with &quot;,&quot;</span></span><br><span class="line">        <span class="keyword">while</span> (Tokenizer.getNextString().equals(<span class="string">&quot;,&quot;</span>)) {</span><br><span class="line">            Tokenizer.stringAdvance();</span><br><span class="line">            name = Tokenizer.stringAdvance();</span><br><span class="line">            subroutineVar.put(name, localNum++);</span><br><span class="line">            typeOfSubroutineVar.put(name, type);</span><br><span class="line">            kindOfSubroutineVar.put(name, <span class="string">&quot;local&quot;</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//we meet a &quot;;&quot;</span></span><br><span class="line">    Tokenizer.stringAdvance();</span><br><span class="line">    currentStringName.setLength(<span class="number">0</span>);</span><br><span class="line">    currentStringName.append(Tokenizer.stringAdvance());</span><br><span class="line">    <span class="keyword">if</span> (currentStringName.toString().equals(<span class="string">&quot;var&quot;</span>)) dealFuncLCLVar();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; }</span><br></pre></td></tr></table></figure>
<h4><span id="dsymbol-table&#x6700;&#x7EC8;&#x6784;&#x5EFA;">&#x2003;&#x2003;<span class="math inline">\(d.\)</span><code>Symbol Table</code>&#x6700;&#x7EC8;&#x6784;&#x5EFA;</span></h4>
<p>&#x2003;&#x2003;&#x6709;&#x4E86;&#x4E0A;&#x8FF0;&#x65B9;&#x6CD5;&#x7684;&#x94FA;&#x57AB;&#xFF0C; &#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x5728;&#x9047;&#x5230;&#x5BF9;&#x5E94;&#x7684;<span class="math inline">\(token\)</span>&#x65F6;&#x8C03;&#x7528;&#x5BF9;&#x5E94;&#x7684;&#x65B9;&#x6CD5;&#x5373;&#x53EF;&#x3002;&#x6211;&#x4EEC;&#x5229;&#x7528;<code>private static String currentStringName</code>&#x6765;&#x8BB0;&#x5F55;&#x5F53;&#x524D;&#x8BFB;&#x5165;&#x7684;<span class="math inline">\(token\)</span>&#xFF0C;&#x5982;&#x679C;&#x9047;&#x5230;&#x4E86;&#x58F0;&#x660E;&#x7C7B;&#x6216;&#x5B50;&#x7A0B;&#x5E8F;&#x7684;&#x5173;&#x952E;&#x5B57;&#xFF0C;&#x5C31;&#x8DF3;&#x8F6C;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x53D8;&#x91CF;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x4E2D;&#xFF1A;</p>
<ol type="1">
<li>&#x5F53;&#x9047;&#x5230;<code>class</code>&#x5173;&#x952E;&#x5B57;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x5FFD;&#x7565;&#x6389;<span class="math inline">\(class+className+{\)</span>&#x540E;&#x7740;&#x624B;&#x5904;&#x7406;&#x7C7B;&#x53D8;&#x91CF;&#xFF1A;</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//if we meet &quot;class&quot;, then we call dealClass</span></span><br><span class="line"><span class="keyword">if</span> (currentStringName.toString().equals(<span class="string">&quot;class&quot;</span>)) {</span><br><span class="line">    startClass();</span><br><span class="line"></span><br><span class="line">    className = Tokenizer.stringAdvance();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ignore the &apos;{&apos;</span></span><br><span class="line">    Tokenizer.stringAdvance();</span><br><span class="line"></span><br><span class="line">    dealClassVar();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!currentStringName.toString().equals(<span class="string">&quot;class&quot;</span>)) <span class="keyword">continue</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>&#x5F53;&#x9047;&#x5230;<code>funcDec</code>&#x5173;&#x952E;&#x8BCD;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x5904;&#x7406;<code>varDec</code>&#x90E8;&#x5206;&#xFF0C;&#x5E76;&#x5C06;&#x5F97;&#x5230;&#x7684;<span class="math inline">\(Map\)</span>&#x5B58;&#x5165;&#x5BF9;&#x5E94;&#x5B50;&#x7A0B;&#x5E8F;&#x7684;<span class="math inline">\(Map\)</span>&#x4E2D;&#xFF1A;</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (currentStringName.toString().equals(<span class="string">&quot;method&quot;</span>)</span><br><span class="line">        || currentStringName.toString().equals(<span class="string">&quot;function&quot;</span>)</span><br><span class="line">        || currentStringName.toString().equals(<span class="string">&quot;constructor&quot;</span>)) {</span><br><span class="line">    <span class="comment">//deal with the arguments first</span></span><br><span class="line">    startSubroutine();</span><br><span class="line">    <span class="keyword">if</span> (currentStringName.toString().equals(<span class="string">&quot;method&quot;</span>)) startMethod();</span><br><span class="line">    dealFuncArgVar();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//after the argument comes the body of func</span></span><br><span class="line">    <span class="comment">//we only care about varDec</span></span><br><span class="line">    <span class="keyword">if</span> (currentStringName.toString().equals(<span class="string">&quot;var&quot;</span>)) dealFuncLCLVar();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//we copy the current ArrayList and deliver the copyList</span></span><br><span class="line">    Map&lt;String, Integer&gt; copyVar = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(subroutineVar);</span><br><span class="line">    Map&lt;String, String&gt; copyType = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(typeOfSubroutineVar);</span><br><span class="line">    Map&lt;String, String&gt; copyKind = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(kindOfSubroutineVar);</span><br><span class="line"></span><br><span class="line">    mapOfSubVar.put(currentSubroutineName.toString(), copyVar);</span><br><span class="line">    mapOfSubVarType.put(currentSubroutineName.toString(), copyType);</span><br><span class="line">    mapOfSubVarKind.put(currentSubroutineName.toString(), copyKind);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//store the index of arg and lcl</span></span><br><span class="line">    subroutineLCLNum.put(currentSubroutineName.toString(), localNum);</span><br><span class="line">    subroutineArgNum.put(currentSubroutineName.toString(), argNum);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4><span id="d&#x4F9B;&#x5176;&#x4ED6;&#x7C7B;&#x4F7F;&#x7528;&#x7684;&#x51FD;&#x6570;">&#x2003;&#x2003;<span class="math inline">\(d.\)</span>&#x4F9B;&#x5176;&#x4ED6;&#x7C7B;&#x4F7F;&#x7528;&#x7684;&#x51FD;&#x6570;</span></h4>
<p>&#x2003;&#x2003;&#x5BF9;&#x4E8E;&#x7ED9;&#x5B9A;&#x7684;&#x8F93;&#x5165;&#xFF0C;&#x8FD4;&#x56DE;&#x8BE5;&#x8F93;&#x5165;&#x5728;<span class="math inline">\(Map\)</span>&#x4E2D;&#x5BF9;&#x5E94;&#x7684;&#x503C;&#x5373;&#x53EF;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">varCount</span><span class="params">(String <span class="keyword">var</span>, String subroutine)</span> {</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">if</span> (subroutine != <span class="literal">null</span> &amp;&amp; mapOfSubVar.get(subroutine).containsKey(<span class="keyword">var</span>))</span><br><span class="line">            <span class="keyword">return</span> mapOfSubVar.get(subroutine).get(<span class="keyword">var</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (classVar.containsKey(<span class="keyword">var</span>))</span><br><span class="line">            <span class="keyword">return</span> classVar.get(<span class="keyword">var</span>);</span><br><span class="line">    } <span class="keyword">catch</span> (ArrayIndexOutOfBoundsException e) {</span><br><span class="line">        System.out.println(<span class="string">&quot;The variable is undefined&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">varType</span><span class="params">(String <span class="keyword">var</span>, String subroutine)</span> {</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">if</span> (subroutine != <span class="literal">null</span> &amp;&amp; mapOfSubVarType.get(subroutine).containsKey(<span class="keyword">var</span>))</span><br><span class="line">            <span class="keyword">return</span> mapOfSubVarType.get(subroutine).get(<span class="keyword">var</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (typeOfClassVar.containsKey(<span class="keyword">var</span>))</span><br><span class="line">            <span class="keyword">return</span> typeOfClassVar.get(<span class="keyword">var</span>);</span><br><span class="line">    } <span class="keyword">catch</span> (ArrayIndexOutOfBoundsException e) {</span><br><span class="line">        System.out.println(<span class="string">&quot;The variable is undefined&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">varKind</span><span class="params">(String <span class="keyword">var</span>, String subroutine)</span> {</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">if</span> (subroutine != <span class="literal">null</span> &amp;&amp; mapOfSubVarKind.get(subroutine).containsKey(<span class="keyword">var</span>))</span><br><span class="line">            <span class="keyword">return</span> mapOfSubVarKind.get(subroutine).get(<span class="keyword">var</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (kindOfClassVar.containsKey(<span class="keyword">var</span>))</span><br><span class="line">            <span class="keyword">return</span> kindOfClassVar.get(<span class="keyword">var</span>);</span><br><span class="line">    } <span class="keyword">catch</span> (ArrayIndexOutOfBoundsException e) {</span><br><span class="line">        System.out.println(<span class="string">&quot;The variable is undefined.&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//if it&apos;s a classVar, then subroutine is null</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">kindCount</span><span class="params">(String kindName, String subroutine)</span> {</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">if</span> (subroutine.equals(<span class="string">&quot;Output.printInt&quot;</span>)) <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (kindName.equals(<span class="string">&quot;argument&quot;</span>)) <span class="keyword">return</span> subroutineArgNum.get(subroutine);</span><br><span class="line">        <span class="keyword">if</span> (kindName.equals(<span class="string">&quot;local&quot;</span>)) <span class="keyword">return</span> subroutineLCLNum.get(subroutine);</span><br><span class="line">        <span class="keyword">if</span> (kindName.equals(<span class="string">&quot;field&quot;</span>) || kindName.equals(<span class="string">&quot;static&quot;</span>)) <span class="keyword">return</span> classNum;</span><br><span class="line">    } <span class="keyword">catch</span> (ArrayIndexOutOfBoundsException e) {</span><br><span class="line">        System.out.println(<span class="string">&quot;The kind is out of range.&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3><span id="2vmwriter&#x5B9E;&#x73B0;">2.<code>VMWriter</code>&#x5B9E;&#x73B0;</span></h3>
<p>&#x2003;&#x2003;&#x4E3A;&#x6EE1;&#x8DB3;<code>CompileEngine</code>VM&#x4EE3;&#x7801;&#x7684;&#x751F;&#x6210;&#xFF0C;&#x6211;&#x4EEC;&#x5728;<code>VMWriter</code>&#x4E2D;&#x8BBE;&#x8BA1;&#x4EE5;&#x4E0B;&#x51FD;&#x6570;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">writePush</span><span class="params">(String segment, <span class="type">int</span> index)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">writePop</span><span class="params">(String segment, <span class="type">int</span> index)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">writeOp</span><span class="params">(String command)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">writeUnaryOp</span><span class="params">(String command)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">writeCall</span><span class="params">(String name, <span class="type">int</span> argNum)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">writeFunctionDec</span><span class="params">(String name, <span class="type">int</span> lclNum)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">writeFunctionCall</span><span class="params">(String name, <span class="type">int</span> argNum)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">writeReturn</span><span class="params">()</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ArrayList&lt;String&gt; <span class="title function_">writeString</span><span class="params">(String string)</span></span><br></pre></td></tr></table></figure>
<h3><span id="3compileengine&#x5B9E;&#x73B0;">3.<code>CompileEngine</code>&#x5B9E;&#x73B0;</span></h3>
<p>&#x2003;&#x2003;&#x5728;<code>CompileEngine</code>&#x4E2D;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x8BFB;&#x5165;&#x5B8C;&#x6574;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x4EE5;&#x751F;&#x6210;&#x5BF9;&#x5E94;&#x7684;VM&#x4EE3;&#x7801;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x9009;&#x62E9;&#x76F4;&#x63A5;&#x8BFB;&#x5165;&#x6E90;&#x7A0B;&#x5E8F;&#xFF0C;&#x7136;&#x540E;&#x6839;&#x636E;&#x8BFB;&#x5165;&#x884C;&#x7684;&#x5173;&#x952E;&#x5B57;&#x5224;&#x65AD;&#x5176;&#x8868;&#x8FBE;&#x5F0F;&#x7C7B;&#x578B;&#x3002;</p>
<h4><span id="a&#x51C6;&#x5907;&#x5DE5;&#x4F5C;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&#x51C6;&#x5907;&#x5DE5;&#x4F5C;</span></h4>
<p>&#x2003;&#x2003;&#x4E3A;&#x4E86;&#x9632;&#x6B62;<code>if</code>&#x548C;<code>while</code>&#x7684;<span class="math inline">\(label\)</span>&#x91CD;&#x590D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;<code>private static int ifLabelCount, whileLabelCount</code>&#x3002;</p>
<p>&#x2003;&#x2003;&#x540C;&#x65F6;&#xFF0C;&#x7531;&#x4E8E;&#x5728;&#x8C03;&#x7528;&#x51FD;&#x6570;&#x65F6;&#x9700;&#x8981;&#x77E5;&#x9053;&#x51FD;&#x6570;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x7C7B;&#x578B;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x8981;&#x5728;&#x7F16;&#x8BD1;&#x8FC7;&#x7A0B;&#x4E2D;&#x5B58;&#x50A8;&#x6211;&#x4EEC;&#x9047;&#x5230;&#x7684;&#x51FD;&#x6570;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, String&gt; funcType</span><br></pre></td></tr></table></figure>
<h4><span id="b&#x8868;&#x8FBE;&#x5F0F;&#x8BA1;&#x7B97;">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>&#x8868;&#x8FBE;&#x5F0F;&#x8BA1;&#x7B97;</span></h4>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#xFF0C;<code>Jack</code>&#x4E2D;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x6709;&#x4EE5;&#x4E0B;&#x6027;&#x8D28;&#xFF1A; 1.
&#x5F53;&#x6CA1;&#x6709;&#x62EC;&#x53F7;&#x65F6;&#xFF0C;&#x4ECE;&#x5DE6;&#x5230;&#x53F3;&#x4F9D;&#x6B21;&#x8BA1;&#x7B97;&#x3002; 2. &#x6709;&#x62EC;&#x53F7;&#x65F6;&#xFF0C;&#x4F18;&#x5148;&#x8BA1;&#x7B97;&#x62EC;&#x53F7;&#x5185;&#x5F0F;&#x5B50;&#x3002;</p>
<p>&#x2003;&#x2003;&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;<strong>&#x4ECE;&#x5DE6;&#x5F80;&#x53F3;</strong>&#x5904;&#x7406;&#x8F93;&#x5165;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x5E76;<strong>&#x4F18;&#x5148;&#x8003;&#x8651;&#x662F;&#x5426;&#x6709;&#x62EC;&#x53F7;&#xFF0C;&#x5982;&#x679C;&#x9047;&#x5230;&#x62EC;&#x53F7;&#x4F18;&#x5148;&#x5904;&#x7406;&#x62EC;&#x53F7;&#x5185;&#x8BED;&#x53E5;</strong>&#x3002;</p>
<blockquote>
<p><span class="math inline">\(p.s.\)</span>:&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x5148;&#x8BA1;&#x7B97;&#x5185;&#x4FA7;&#x62EC;&#x53F7;&#x3001;&#x518D;&#x8BA1;&#x7B97;&#x5916;&#x4FA7;&#x62EC;&#x53F7;&#xFF0C;&#x4E00;&#x4E2A;&#x81EA;&#x7136;&#x7684;&#x60F3;&#x6CD5;&#x662F;<strong>&#x627E;&#x5230;&#x6700;&#x5185;&#x4FA7;&#x7684;&#x62EC;&#x53F7;&#x5BF9;&#xFF0C;&#x5904;&#x7406;&#x5B8C;&#x5176;&#x5185;&#x90E8;&#x8868;&#x8FBE;&#x5F0F;&#x540E;&#x5C06;&#x5176;&#x62B9;&#x53BB;&#xFF0C;&#x5411;&#x5916;&#x5EF6;&#x5C55;</strong>&#x3002;&#x4F46;&#x662F;&#x8FD9;&#x6837;&#x4E0D;&#x6EE1;&#x8DB3;&#x6027;&#x8D28;&#x4E00;&#xFF0C;&#x56E0;&#x800C;&#x4F1A;&#x5BFC;&#x81F4;&#x5931;&#x8D25;&#x3002;</p>
</blockquote>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5229;&#x7528;<strong>&#x6808;</strong>&#x6765;&#x8FDB;&#x884C;&#x62EC;&#x53F7;&#x5BF9;&#x7684;&#x5339;&#x914D;&#xFF0C;&#x7136;&#x540E;&#x8BA1;&#x7B97;&#x5BF9;&#x5E94;&#x4E0B;&#x6807;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x503C;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5728;<code>Jack</code>&#x8BED;&#x6CD5;&#x4E00;&#x7AE0;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x8868;&#x8FBE;&#x5F0F;&#x5177;&#x6709;&#x5982;&#x4E0B;&#x7ED3;&#x6784;&#xFF1A;</p>
<p><span class="math display">\[expression=term(op\;term)\]</span></p>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x6CBF;&#x7528;&#x8BE5;&#x7ED3;&#x6784;&#xFF0C;<strong>&#x5229;&#x7528;<code>op</code>&#x5C06;&#x539F;&#x8868;&#x8FBE;&#x5F0F;&#x62C6;&#x5206;&#x6210;&#x4E00;&#x4E2A;&#x4E2A;&#x5B50;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x7136;&#x540E;&#x5206;&#x522B;&#x9012;&#x5F52;&#x8BA1;&#x7B97;</strong>&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x5E76;&#x4E0D;&#x80FD;&#x786E;&#x5B9A;<span class="math inline">\(term\)</span>&#x7684;&#x4E2A;&#x6570;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x5BF9;&#x4E0A;&#x9762;&#x7684;&#x7ED3;&#x6784;&#x8FDB;&#x884C;&#x6539;&#x52A8;&#xFF1A;</p>
<p><span class="math display">\[expression=term(op\;expression)\]</span></p>
<p>&#x2003;&#x2003;&#x8BE5;&#x7ED3;&#x6784;&#x7684;&#x53D8;&#x91CF;&#x4E2A;&#x6570;&#x662F;&#x786E;&#x5B9A;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x5206;&#x522B;&#x9012;&#x5F52;&#x8BA1;&#x7B97;&#x5373;&#x53EF;&#xFF1A;</p>
<blockquote>
<p><span class="math inline">\(p.s\)</span>&#x8FD9;&#x91CC;&#x6709;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x68D8;&#x624B;&#x7684;&#x95EE;&#x9898;&#xFF1A;&#x5BF9;&#x4E8E;<span class="math inline">\(unary\;op\)</span>&#x7684;&#x5904;&#x7406;&#x3002;&#x5728;<code>-(1+2)</code>&#x8FD9;&#x4E2A;&#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;<code>-</code>&#x5E76;&#x4E0D;&#x8D77;&#x5230;&#x62C6;&#x5206;&#x7684;&#x4F5C;&#x7528;&#x3002;&#x6CE8;&#x610F;&#x5230;&#x6211;&#x4EEC;&#x662F;&#x4EE5;<span class="math inline">\(term\)</span>&#x4E3A;&#x57FA;&#x672C;&#x5904;&#x7406;&#x5355;&#x5143;&#x7684;&#xFF0C;&#x800C;<strong>&#x5728;<span class="math inline">\(term\)</span>&#x4E2D;<span class="math inline">\(unary\;op\)</span>&#x53EA;&#x80FD;&#x5728;&#x7B2C;&#x4E00;&#x4E2A;&#x4F4D;&#x7F6E;</strong>&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x4ECE;&#x5DE6;&#x5F80;&#x53F3;&#x8BA1;&#x7B97;&#x524D;<strong>&#x5148;&#x5224;&#x65AD;&#x7B2C;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x662F;&#x5426;&#x4E3A;<span class="math inline">\(op\)</span>&#xFF0C;&#x5982;&#x679C;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x8BA1;&#x7B97;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x8BA1;&#x7B97;&#x5B8C;&#x7B2C;&#x4E00;&#x4E2A;<span class="math inline">\(term\)</span>&#x540E;&#x8BB0;&#x5F55;&#x8BE5;&#x8868;&#x8FBE;&#x5F0F;&#xFF1A;</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//if the first character belongs unary op //then we skip it </span></span><br><span class="line"><span class="type">String</span> <span class="variable">unaryOp</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>; </span><br><span class="line"><span class="keyword">if</span> (isOp(line.charAt(<span class="number">0</span>))) { </span><br><span class="line">	unaryOp = Character.toString(line.charAt(<span class="number">0</span>)); </span><br><span class="line">	line = line.substring(<span class="number">1</span>); </span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!unaryOp.isEmpty()) expression.add(VMWriter.writeUnaryOp(unaryOp));</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> ArrayList&lt;String&gt; <span class="title function_">compileExpression</span><span class="params">(String line)</span> {</span><br><span class="line">    ArrayList&lt;String&gt; expression = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//if the first character belongs unary op</span></span><br><span class="line">    <span class="comment">//then we skip it</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">unaryOp</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (isOp(line.charAt(<span class="number">0</span>))) {</span><br><span class="line">        unaryOp = Character.toString(line.charAt(<span class="number">0</span>));</span><br><span class="line">        line = line.substring(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!containOP(line)) {</span><br><span class="line">        ArrayList&lt;String&gt; term = compileTerm(line);</span><br><span class="line">        expression.addAll(term);</span><br><span class="line">        <span class="keyword">if</span> (!unaryOp.isEmpty())</span><br><span class="line">            expression.add(VMWriter.writeUnaryOp(unaryOp));</span><br><span class="line">        <span class="keyword">return</span> expression;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//if we meet (, deal with it first</span></span><br><span class="line">    <span class="keyword">if</span> (line.charAt(<span class="number">0</span>) == <span class="string">&apos;(&apos;</span>) {</span><br><span class="line">        Stack&lt;Integer&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">rightIndex</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; line.length(); i++) {</span><br><span class="line">            <span class="keyword">if</span> (line.charAt(i) == <span class="string">&apos;(&apos;</span>) stack.push(i);</span><br><span class="line">            <span class="keyword">if</span> (line.charAt(i) == <span class="string">&apos;)&apos;</span>) {</span><br><span class="line">                <span class="keyword">if</span> (!stack.isEmpty()) stack.pop();</span><br><span class="line">                <span class="keyword">else</span> {</span><br><span class="line">                    rightIndex = i;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">termExp</span> <span class="operator">=</span> line.substring(<span class="number">0</span>, rightIndex + <span class="number">1</span>);</span><br><span class="line">        expression.addAll(compileTerm(termExp));</span><br><span class="line">        <span class="keyword">if</span> (!unaryOp.isEmpty()) expression.add(VMWriter.writeUnaryOp(unaryOp));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//if the ) is not the last, then after it comes an op</span></span><br><span class="line">        <span class="comment">//it&apos;s defined by the Jack grammar</span></span><br><span class="line">        <span class="keyword">if</span> (rightIndex &lt; line.length() - <span class="number">1</span>) {</span><br><span class="line">            expression.addAll(compileExpression(line.substring(rightIndex + <span class="number">2</span>)));</span><br><span class="line">            expression.add(VMWriter.writeOp(Character.toString(line.charAt(rightIndex + <span class="number">1</span>))));</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> expression;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//we deal with the next op</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">opIndex</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">curOp</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; line.length(); i++) {</span><br><span class="line">        <span class="keyword">if</span> (isOp(line.charAt(i))) {</span><br><span class="line">            opIndex = i;</span><br><span class="line">            curOp = Character.toString(line.charAt(i));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">termExp1</span> <span class="operator">=</span> line.substring(<span class="number">0</span>, opIndex);</span><br><span class="line">    <span class="type">String</span> <span class="variable">termExp2</span> <span class="operator">=</span> line.substring(opIndex + <span class="number">1</span>);</span><br><span class="line">    expression.addAll(compileTerm(termExp1));</span><br><span class="line">    <span class="keyword">if</span> (!unaryOp.isEmpty())</span><br><span class="line">        expression.add(VMWriter.writeUnaryOp(unaryOp));</span><br><span class="line">    <span class="keyword">if</span> (!termExp2.isEmpty())</span><br><span class="line">        expression.addAll(compileExpression(termExp2));</span><br><span class="line">    expression.add(VMWriter.writeOp(curOp));</span><br><span class="line">    <span class="keyword">return</span> expression;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;&#x5BF9;&#x4E8E;<span class="math inline">\(term\)</span>&#x7684;&#x5904;&#x7406;&#x8F83;&#x4E3A;&#x7B80;&#x5355;&#xFF0C;&#x53EA;&#x9700;&#x6CE8;&#x610F;&#x5BF9;&#x51FD;&#x6570;&#x7684;&#x5224;&#x65AD;&#x65B9;&#x5F0F;&#x5373;&#x53EF;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> ArrayList&lt;String&gt; <span class="title function_">compileTerm</span><span class="params">(String line)</span> {</span><br><span class="line">    ArrayList&lt;String&gt; term = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (line.matches(<span class="string">&quot;-?\\d+&quot;</span>)) {</span><br><span class="line">        term.add(VMWriter.writePush(<span class="string">&quot;constant&quot;</span>, Integer.parseInt(line)));</span><br><span class="line">        <span class="keyword">return</span> term;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (line.contains(<span class="string">&quot;(&quot;</span>)) {</span><br><span class="line">        <span class="comment">//if the first is &quot;(&quot;, then it&apos;s (expression)</span></span><br><span class="line">        <span class="keyword">if</span> (line.charAt(<span class="number">0</span>) == <span class="string">&apos;(&apos;</span>) {</span><br><span class="line">            term.addAll(compileExpression(line.substring(<span class="number">1</span>, line.length() - <span class="number">1</span>)));</span><br><span class="line">            <span class="keyword">return</span> term;</span><br><span class="line">        } <span class="keyword">else</span> { <span class="comment">//else, it&apos;s a functionCall</span></span><br><span class="line">            ArrayList&lt;String&gt; functionCall = compileSubroutineCall(line);</span><br><span class="line">            term.addAll(functionCall);</span><br><span class="line">            <span class="keyword">return</span> term;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//if line contains &apos;[&apos;, it must be an array</span></span><br><span class="line">    <span class="keyword">if</span> (line.contains(<span class="string">&quot;[&quot;</span>)) {</span><br><span class="line">        term.addAll(compileArray(line));</span><br><span class="line">        <span class="keyword">return</span> term;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//if it&apos;s a stringConstant, we use string method to append char by char</span></span><br><span class="line">    <span class="keyword">if</span> (line.charAt(<span class="number">0</span>) == <span class="string">&apos;&quot;&apos;</span>) {</span><br><span class="line">        <span class="type">String</span> <span class="variable">string</span> <span class="operator">=</span> line.substring(<span class="number">1</span>, line.length() - <span class="number">1</span>);</span><br><span class="line">        term.addAll(VMWriter.writeString(string));</span><br><span class="line">        <span class="keyword">return</span> term;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//else, it&apos;s a variable</span></span><br><span class="line">    <span class="keyword">else</span> {</span><br><span class="line">        term.add(VMWriter.writePush(SymbolTable.varKind(line, curSubroutine.toString()), SymbolTable.varCount(line, curSubroutine.toString())));</span><br><span class="line">        <span class="keyword">return</span> term;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<h4><span id="creturn&#x8BED;&#x53E5;">&#x2003;&#x2003;<span class="math inline">\(c.\)</span><code>return</code>&#x8BED;&#x53E5;</span></h4>
<p>&#x2003;&#x2003;&#x6839;&#x636E;<code>return</code>&#x53D8;&#x91CF;&#x8FDB;&#x884C;&#x5206;&#x7C7B;&#x5904;&#x7406;&#x5373;&#x53EF;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> ArrayList&lt;String&gt; <span class="title function_">compileReturnStatement</span><span class="params">(String line)</span> {</span><br><span class="line">    ArrayList&lt;String&gt; returnStatement = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Extract the return value from the line</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">returnVal</span> <span class="operator">=</span> line.substring(<span class="number">6</span>, line.indexOf(<span class="string">&quot;;&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!returnVal.isEmpty()) {</span><br><span class="line">        <span class="keyword">if</span> (isKeywordConstant(returnVal)) {</span><br><span class="line">            <span class="comment">// Handle keyword constants</span></span><br><span class="line">            <span class="keyword">if</span> (returnVal.equals(<span class="string">&quot;this&quot;</span>)) {</span><br><span class="line">                returnStatement.add(VMWriter.writePush(<span class="string">&quot;pointer&quot;</span>, <span class="number">0</span>));</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (returnVal.equals(<span class="string">&quot;true&quot;</span>)) {</span><br><span class="line">                returnStatement.add(VMWriter.writePush(<span class="string">&quot;constant&quot;</span>, <span class="number">0</span>));</span><br><span class="line">                returnStatement.add(<span class="string">&quot;not&quot;</span>);</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (returnVal.equals(<span class="string">&quot;false&quot;</span>) || returnVal.equals(<span class="string">&quot;null&quot;</span>)) {</span><br><span class="line">                returnStatement.add(VMWriter.writePush(<span class="string">&quot;constant&quot;</span>, <span class="number">0</span>));</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (returnVal.matches(<span class="string">&quot;-?\\d+&quot;</span>)) {</span><br><span class="line">            <span class="comment">// Handle integer constants</span></span><br><span class="line">            returnStatement.add(VMWriter.writePush(<span class="string">&quot;constant&quot;</span>, Integer.parseInt(returnVal)));</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (returnVal.charAt(<span class="number">0</span>) == <span class="string">&apos;&quot;&apos;</span>) {</span><br><span class="line">            <span class="comment">// Handle string constants</span></span><br><span class="line">            returnVal = returnVal.substring(<span class="number">1</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">string</span> <span class="operator">=</span> returnVal.substring(<span class="number">0</span>, returnVal.length() - <span class="number">1</span>);</span><br><span class="line">            returnStatement.addAll(VMWriter.writeString(string));</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="comment">// Handle variable return values</span></span><br><span class="line">            returnStatement.add(VMWriter.writePush(SymbolTable.varKind(returnVal, curSubroutine.toString()), SymbolTable.varCount(returnVal, curSubroutine.toString())));</span><br><span class="line">        }</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="comment">// If no return value, push 0</span></span><br><span class="line">        returnStatement.add(VMWriter.writePush(<span class="string">&quot;constant&quot;</span>, <span class="number">0</span>));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add return command</span></span><br><span class="line">    returnStatement.add(<span class="string">&quot;return&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> returnStatement;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4><span id="ddo&#x8BED;&#x53E5;">&#x2003;&#x2003;<span class="math inline">\(d.\)</span><code>do</code>&#x8BED;&#x53E5;</span></h4>
<p>&#x2003;&#x2003;<code>do</code>&#x8BED;&#x53E5;&#x53EA;&#x9700;&#x5904;&#x7406;&#x88AB;&#x8C03;&#x7528;&#x7684;&#x51FD;&#x6570;&#x5373;&#x53EF;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> ArrayList&lt;String&gt; <span class="title function_">compileDoStatement</span><span class="params">(String line)</span> {</span><br><span class="line">	line = line.substring(<span class="number">2</span>);</span><br><span class="line">&#xA0; &#xA0; <span class="keyword">return</span> compileSubroutineCall(line);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h4><span id="elet&#x8BED;&#x53E5;">&#x2003;&#x2003;<span class="math inline">\(e.\)</span><code>let</code>&#x8BED;&#x53E5;</span></h4>
<p>&#x2003;&#x2003;&#x5BF9;<code>let</code>&#x8BED;&#x53E5;&#x7684;&#x5904;&#x7406;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x5206;&#x7C7B;&#x7684;&#x4F9D;&#x636E;&#xFF1A;<strong>&#x5DE6;&#x4FA7;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x662F;&#x5426;&#x4E3A;&#x6570;&#x7EC4;</strong>&#xFF0C;&#x5982;&#x679C;&#x5DE6;&#x4FA7;&#x4E3A;&#x6570;&#x7EC4;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x52A0;&#x5165;&#x4EE5;&#x4E0B;&#x7684;&#x64CD;&#x4F5C;&#xFF1A;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pop temp 0</span><br><span class="line">pop pointer 1</span><br><span class="line">push temp 0</span><br><span class="line">pop that 0</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;&#x5426;&#x5219;&#x5DE6;&#x4FA7;&#x8868;&#x8FBE;&#x5F0F;&#x53EA;&#x80FD;&#x662F;&#x4E00;&#x4E2A;&#x666E;&#x901A;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x5176;<code>pop</code>&#x5373;&#x53EF;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&#xA0; &#xA0; <span class="keyword">private</span> <span class="keyword">static</span> ArrayList&lt;String&gt; <span class="title function_">compileLetStatement</span><span class="params">(String line)</span> {</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; ArrayList&lt;String&gt; letstatement = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; line = line.substring(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; <span class="type">String</span> <span class="variable">var1</span> <span class="operator">=</span> line.substring(<span class="number">0</span>, line.indexOf(<span class="string">&quot;=&quot;</span>));</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; <span class="type">String</span> <span class="variable">var2</span> <span class="operator">=</span> line.substring(line.indexOf(<span class="string">&quot;=&quot;</span>) + <span class="number">1</span>, line.indexOf(<span class="string">&quot;;&quot;</span>));</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; <span class="comment">//case 1: array var + expression</span></span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; <span class="keyword">if</span> (var1.contains(<span class="string">&quot;[&quot;</span>)) {</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; <span class="type">String</span> <span class="variable">exp1</span> <span class="operator">=</span> var1.substring(var1.indexOf(<span class="string">&quot;[&quot;</span>) + <span class="number">1</span>, var1.indexOf(<span class="string">&quot;]&quot;</span>));</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; <span class="type">String</span> <span class="variable">name1</span> <span class="operator">=</span> var1.substring(<span class="number">0</span>, var1.indexOf(<span class="string">&quot;[&quot;</span>));</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ArrayList&lt;String&gt; expression1 = compileExpression(exp1);</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; letstatement.addAll(expression1);</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; letstatement.add(VMWriter.writePush(SymbolTable.varKind(name1, curSubroutine.toString()), SymbolTable.varCount(name1, curSubroutine.toString())));</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; letstatement.add(<span class="string">&quot;add&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; letstatement.addAll(compileExpression(var2));</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; letstatement.add(VMWriter.writePop(<span class="string">&quot;temp&quot;</span>, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; letstatement.add(VMWriter.writePop(<span class="string">&quot;pointer&quot;</span>, <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; letstatement.add(VMWriter.writePush(<span class="string">&quot;temp&quot;</span>, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; letstatement.add(VMWriter.writePop(<span class="string">&quot;that&quot;</span>, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; <span class="keyword">return</span> letstatement;</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; }</span><br></pre></td></tr></table></figure>
<h4><span id="e&#x51FD;&#x6570;&#x4F53;&#x6A21;&#x5757;&#x8BBE;&#x8BA1;ampif-while&#x5904;&#x7406;&#x624B;&#x6BB5;">&#x2003;&#x2003;<span class="math inline">\(e.\)</span>&#x51FD;&#x6570;&#x4F53;&#x6A21;&#x5757;&#x8BBE;&#x8BA1;&amp;<code>if, while</code>&#x5904;&#x7406;&#x624B;&#x6BB5;</span></h4>
<p>&#x2003;&#x2003;&#x5728;&#x5904;&#x7406;<code>if</code>&#x8BED;&#x53E5;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728;&#x5904;&#x7406;<code>if</code>&#x82B1;&#x62EC;&#x53F7;&#x62EC;&#x8D77;&#x7684;&#x90E8;&#x5206;&#x540E;&#x6DFB;&#x52A0;<code>IF_ENDLabelindex</code>&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x81EA;&#x7136;&#x5730;&#x60F3;&#x5230;&#x5F15;&#x5165;<code>compileSubroutineBody</code>&#x51FD;&#x6570;&#x5BF9;&#x51FD;&#x6570;&#x4F53;&#x6A21;&#x5757;&#x8FDB;&#x884C;&#x6574;&#x4F53;&#x5730;&#x7F16;&#x8BD1;(&#x800C;&#x975E;&#x4E00;&#x6761;&#x8BED;&#x53E5;&#x4E00;&#x6761;&#x8BED;&#x53E5;&#x5730;&#x79BB;&#x6563;&#x5904;&#x7406;)&#xFF0C;&#x5B83;&#x63A5;&#x53D7;&#x7684;&#x53C2;&#x6570;&#x662F;<strong>&#x591A;&#x6761;&#x8BED;&#x53E5;&#x6784;&#x6210;&#x7684;&#x51FD;&#x6570;&#x4F53;<code>ArrayList&lt;String&gt;</code></strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x90A3;&#x4E48;&#x5982;&#x4F55;&#x5B9E;&#x73B0;<code>if</code>&#x8BED;&#x53E5;&#x5462;&#xFF1F;&#x4E00;&#x4E2A;&#x81EA;&#x7136;&#x5730;&#x60F3;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A;</p>
<ol type="1">
<li>&#x8BBE;&#x8BA1;&#x4E00;&#x4E2A;&#x51FD;&#x6570;<code>compileIfStatement()</code>&#xFF0C;&#x5B83;&#x63A5;&#x53D7;&#x4E00;&#x4E2A;<code>ArrayList&lt;String&gt;</code>&#xFF0C;&#x8FD4;&#x56DE;&#x7F16;&#x8BD1;&#x540E;&#x7684;<code>ArrayList&lt;String&gt;</code>&#x3002;</li>
<li>&#x4F20;&#x5165;<code>if</code>&#x8BED;&#x53E5;&#x5BF9;&#x5E94;&#x7684;&#x5B50;&#x7A0B;&#x5E8F;&#xFF0C;&#x7136;&#x540E;&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#x3002;</li>
</ol>
<p>&#x2003;&#x2003;&#x4F46;&#x662F;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x5F97;&#x5230;&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#x5E76;&#x5F80;&#x4E0B;&#x7EE7;&#x7EED;&#x5904;&#x7406;&#x65F6;&#xFF0C;&#x90A3;&#x4E9B;&#x5C5E;&#x4E8E;<code>if</code>&#x5B50;&#x7A0B;&#x5E8F;&#x7684;&#x4EE3;&#x7801;&#x4F1A;<strong>&#x88AB;&#x91CD;&#x590D;&#x5904;&#x7406;</strong>&#x3002;&#x8FD9;&#x5E76;&#x4E0D;&#x662F;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x7684;&#x7ED3;&#x679C;&#x3002;&#x7B14;&#x8005;&#x66FE;&#x8BD5;&#x8FC7;&#x5904;&#x7406;&#x5B8C;<code>if</code>&#x7684;&#x5B50;&#x7A0B;&#x5E8F;&#x540E;&#x5C06;&#x5176;&#x5220;&#x53BB;&#xFF0C;&#x4F46;&#x6700;&#x7EC8;&#x5931;&#x8D25;&#x4E86;&#x3002;&#x56E0;&#x6B64;&#x7B14;&#x8005;&#x60F3;&#x5230;&#x4E86;&#x4E0B;&#x9762;&#x7684;&#x65B9;&#x6CD5;&#xFF1A;</p>
<ol type="1">
<li>&#x6211;&#x4EEC;&#x4F9D;&#x7136;&#x5BF9;<code>if</code>&#x5BF9;&#x5E94;&#x7684;&#x5B50;&#x7A0B;&#x5E8F;&#x8FDB;&#x884C;&#x8BFB;&#x53D6;&#x3002;</li>
<li>&#x4F46;&#x6211;&#x4EEC;&#x5E76;&#x4E0D;&#x5C06;&#x5176;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x4F20;&#x5165;<code>compileIfStatement</code>&#xFF0C;&#x800C;&#x662F;<strong>&#x8BB0;&#x5F55;&#x4E0B;&#x8BE5;&#x5B50;&#x7A0B;&#x5E8F;&#x7684;&#x884C;&#x6570;</strong><code>ifIndex</code>&#x3002;</li>
<li>&#x540C;&#x65F6;&#xFF0C;&#x5728;<code>compileSubroutineBody</code>&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5B9E;&#x65F6;&#x66F4;&#x65B0;&#x5F53;&#x524D;&#x7684;&#x4EE3;&#x7801;&#x884C;&#x6570;<code>currentIndex</code>&#x3002;</li>
<li>&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x8BB0;&#x5F55;&#x7684;<code>currentIndex</code>&#x548C;<code>ifIndex</code><strong>&#x8BA1;&#x7B97;&#x51FA;&#x5E94;&#x8BE5;&#x6DFB;&#x52A0;<span class="math inline">\(label\)</span>&#x7684;&#x884C;&#x6570;</strong>&#xFF0C;&#x7136;&#x540E;<strong>&#x5F53;<code>currentIndex</code>&#x7684;&#x503C;&#x4E0E;&#x5176;&#x76F8;&#x7B49;&#x65F6;&#x6DFB;&#x52A0;<span class="math inline">\(label\)</span></strong>&#x3002;</li>
</ol>
<p>&#x2003;&#x2003;&#x540C;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x4F9D;&#x7136;&#x4FDD;&#x7559;<code>compileIfStatement</code>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x53EA;&#x662F;&#x8BE5;&#x65B9;&#x6CD5;&#x4EC5;&#x7528;&#x6765;&#x7F16;&#x8BD1;<code>if(expression)</code>&#x8BED;&#x53E5;&#x3002;</p>
<blockquote>
<p>&#x5982;&#x679C;&#x9047;&#x5230;<code>else</code>&#x8BED;&#x53E5;&#xFF0C;&#x76F4;&#x63A5;&#x5FFD;&#x7565;&#x5373;&#x53EF;&#x3002;</p>
</blockquote>
<blockquote>
<p>&#x53E6;&#xFF1A;&#x6211;&#x4EEC;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x7528;&#x7C7B;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;<code>static int ifLabelCount</code>&#x4F5C;&#x4E3A;&#x6807;&#x8BB0;&#x7684;&#x5E8F;&#x53F7;&#xFF0C;&#x56E0;&#x4E3A;&#x5F53;&#x5B58;&#x5728;&#x5D4C;&#x5957;&#x6761;&#x4EF6;&#x5FAA;&#x73AF;&#x65F6;&#xFF0C;&#x7531;&#x4E8E;&#x4E0D;&#x7BA1;&#x9047;&#x5230;&#x54EA;&#x4E2A;<code>if</code>&#x8BE5;&#x503C;&#x90FD;&#x4F1A;&#x589E;&#x52A0;1&#xFF0C;&#x8FD9;&#x4F1A;&#x5BFC;&#x81F4;<strong>&#x540C;&#x4E00;&#x4E2A;<code>if</code>&#x7684;&#x524D;&#x540E;&#x6807;&#x8BB0;&#x5E8F;&#x53F7;&#x4E0D;&#x4E00;&#x81F4;</strong>&#x3002;&#x5BF9;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;<strong>&#x7528;&#x4E00;&#x4E2A;<span class="math inline">\(Map\)</span>&#x6765;&#x5B58;&#x50A8;&#x7279;&#x5B9A;<code>lineIndex</code>&#x5BF9;&#x5E94;&#x7684;&#x6807;&#x8BB0;&#x5E8F;&#x53F7;</strong>&#xFF0C;&#x7531;&#x4E8E;<code>lineIndex</code>&#x662F;&#x552F;&#x4E00;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x524D;&#x540E;&#x6807;&#x8BB0;&#x5E8F;&#x53F7;&#x5C06;&#x4F1A;&#x4E00;&#x81F4;&#x3002;</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> ArrayList&lt;String&gt; <span class="title function_">compileSubroutineBody</span><span class="params">(ArrayList&lt;String&gt; lines)</span> {</span><br><span class="line">    ArrayList&lt;String&gt; subroutinebody = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> <span class="variable">lineIndex</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ifstatementLineNum</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">whilestatementLineNum</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (String line : lines) {</span><br><span class="line">        <span class="keyword">if</span> (lineIndex == ifstatementLineNum) {</span><br><span class="line">            <span class="type">int</span> <span class="variable">labelCnt</span> <span class="operator">=</span> loopCount.get(ifstatementLineNum);</span><br><span class="line">            subroutinebody.add(<span class="string">&quot;label IF_FALSE&quot;</span> + Integer.toString(labelCnt));</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (lineIndex == whilestatementLineNum) {</span><br><span class="line">            <span class="type">int</span> <span class="variable">labelCnt</span> <span class="operator">=</span> loopCount.get(whilestatementLineNum);</span><br><span class="line">            subroutinebody.add(<span class="string">&quot;goto WHILE_EXP&quot;</span> + Integer.toString(labelCnt));</span><br><span class="line">            subroutinebody.add(<span class="string">&quot;label WHILE_END&quot;</span> + Integer.toString(labelCnt));</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (line.indexOf(<span class="string">&quot;else&quot;</span>) == <span class="number">0</span>) {</span><br><span class="line">            line = line.substring(<span class="number">4</span>);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (line.indexOf(<span class="string">&quot;do&quot;</span>) == <span class="number">0</span>) {</span><br><span class="line">            subroutinebody.addAll(compileDoStatement(line));</span><br><span class="line">            lineIndex++;</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (line.indexOf(<span class="string">&quot;let&quot;</span>) == <span class="number">0</span>) {</span><br><span class="line">            subroutinebody.addAll(compileLetStatement(line));</span><br><span class="line">            lineIndex++;</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (line.indexOf(<span class="string">&quot;return&quot;</span>) == <span class="number">0</span>) {</span><br><span class="line">            subroutinebody.addAll(compileReturnStatement(line));</span><br><span class="line">            lineIndex++;</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (line.indexOf(<span class="string">&quot;if&quot;</span>) == <span class="number">0</span>) {</span><br><span class="line">            <span class="type">String</span> <span class="variable">ifstatement</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span> (line.contains(<span class="string">&quot;{&quot;</span>)) {</span><br><span class="line">                ifstatement = line.substring(<span class="number">0</span>, line.indexOf(<span class="string">&quot;{&quot;</span>));</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                ifstatement = line;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            subroutinebody.addAll(compileIfStatement(ifstatement));</span><br><span class="line">            subroutinebody.add(<span class="string">&quot;if-goto IF_TRUE&quot;</span> + Integer.toString(ifLabelCount));</span><br><span class="line">            subroutinebody.add(<span class="string">&quot;goto IF_FALSE&quot;</span> + Integer.toString(ifLabelCount));</span><br><span class="line">            subroutinebody.add(<span class="string">&quot;label IF_TRUE&quot;</span> + Integer.toString(ifLabelCount));</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (line.contains(<span class="string">&quot;{&quot;</span>) &amp;&amp; line.indexOf(<span class="string">&quot;{&quot;</span>) != line.length() - <span class="number">1</span>) {</span><br><span class="line">                ArrayList&lt;String&gt; statement = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">                statement.add(line.substring(line.indexOf(<span class="string">&quot;{&quot;</span>) + <span class="number">1</span>));</span><br><span class="line">                subroutinebody.addAll(compileSubroutineBody(statement));</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            ifstatementLineNum = Operation.selectContent(Operation.subList(lines, lineIndex)).size() + lineIndex++;</span><br><span class="line">            loopCount.put(ifstatementLineNum, ifLabelCount++);</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (line.indexOf(<span class="string">&quot;while&quot;</span>) == <span class="number">0</span>) {</span><br><span class="line">            <span class="type">String</span> <span class="variable">whilestatement</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span> (line.contains(<span class="string">&quot;{&quot;</span>)) {</span><br><span class="line">                whilestatement = line.substring(<span class="number">0</span>, line.indexOf(<span class="string">&quot;{&quot;</span>));</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                whilestatement = line;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            subroutinebody.add(<span class="string">&quot;label WHILE_EXP&quot;</span> + Integer.toString(whileLabelCount));</span><br><span class="line">            subroutinebody.addAll(compileWhileStatement(whilestatement));</span><br><span class="line">            subroutinebody.add(<span class="string">&quot;not&quot;</span>);</span><br><span class="line">            subroutinebody.add(<span class="string">&quot;if-goto WHILE_END&quot;</span> + Integer.toString(whileLabelCount));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (line.contains(<span class="string">&quot;{&quot;</span>) &amp;&amp; line.indexOf(<span class="string">&quot;{&quot;</span>) != line.length() - <span class="number">1</span>) {</span><br><span class="line">                ArrayList&lt;String&gt; statement = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">                statement.add(line.substring(line.indexOf(<span class="string">&quot;{&quot;</span>) + <span class="number">1</span>));</span><br><span class="line">                subroutinebody.addAll(compileSubroutineBody(statement));</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            whilestatementLineNum = Operation.selectContent(Operation.subList(lines, lineIndex)).size() + lineIndex++;</span><br><span class="line">            loopCount.put(whilestatementLineNum, whileLabelCount++);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            lineIndex++;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> subroutinebody;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h4><span id="f&#x5176;&#x4ED6;&#x6742;&#x9879;&#x7684;&#x5904;&#x7406;">&#x2003;&#x2003;<span class="math inline">\(f.\)</span>&#x5176;&#x4ED6;&#x6742;&#x9879;&#x7684;&#x5904;&#x7406;</span></h4>
<p>&#x2003;&#x2003;&#x5728;&#x5B9E;&#x73B0;&#x4E86;&#x6846;&#x67B6;&#x7684;&#x5927;&#x90E8;&#x5206;&#x5185;&#x5BB9;&#x540E;&#xFF0C;&#x9488;&#x5BF9;VM&#x4EE3;&#x7801;&#x81EA;&#x8EAB;&#x7684;&#x7279;&#x5B9A;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x989D;&#x5916;&#x8865;&#x5145;&#x5BF9;&#x4E00;&#x4E9B;&#x64CD;&#x4F5C;&#x7684;&#x5B9E;&#x73B0;&#xFF1A;</p>
<ol type="1">
<li>&#x5BF9;&#x6570;&#x7EC4;&#x7684;&#x5904;&#x7406;&#xFF1A;&#x6211;&#x4EEC;&#x5C06;&#x6570;&#x7EC4;&#x540D;&#x79F0;&#x6240;&#x5728;&#x5185;&#x5B58;&#x6BB5;&#x548C;&#x5185;&#x90E8;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x503C;<code>add</code>&#xFF0C;&#x7136;&#x540E;<code>pop pointer 1</code>&#xFF0C;<code>push that 0</code>&#x5373;&#x53EF;&#xFF1A;</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> ArrayList&lt;String&gt; <span class="title function_">compileArray</span><span class="params">(String line)</span> {</span><br><span class="line">    ArrayList&lt;String&gt; array = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// the array consists of varName + [ + expression + ]</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">varName</span> <span class="operator">=</span> line.substring(<span class="number">0</span>, line.indexOf(<span class="string">&quot;[&quot;</span>));</span><br><span class="line">    <span class="type">String</span> <span class="variable">exp</span> <span class="operator">=</span> line.substring(line.indexOf(<span class="string">&quot;[&quot;</span>) + <span class="number">1</span>, line.indexOf(<span class="string">&quot;]&quot;</span>));</span><br><span class="line">    ArrayList&lt;String&gt; expression = compileExpression(exp);</span><br><span class="line"></span><br><span class="line">    array.add(VMWriter.writePush(SymbolTable.varKind(varName, curSubroutine.toString()), SymbolTable.varCount(varName, curSubroutine.toString())));</span><br><span class="line">    array.addAll(expression);</span><br><span class="line">    array.add(<span class="string">&quot;add&quot;</span>);</span><br><span class="line">    array.add(VMWriter.writePop(<span class="string">&quot;pointer&quot;</span>, <span class="number">1</span>));</span><br><span class="line">    array.add(VMWriter.writePush(<span class="string">&quot;that&quot;</span>, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> array;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>&#x8C03;&#x7528;&#x51FD;&#x6570;&#xFF1A;&#x5C06;&#x51FD;&#x6570;&#x6240;&#x9700;&#x53C2;&#x6570;<code>push</code>&#xFF0C;&#x7136;&#x540E;&#x8BA1;&#x7B97;&#x53C2;&#x6570;&#x4E2A;&#x6570;&#x3001;&#x8C03;&#x7528;&#x5373;&#x53EF;&#x3002;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x5224;&#x65AD;&#x51FD;&#x6570;&#x662F;&#x5426;&#x4E3A;<code>void</code>&#x578B;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x7684;&#x8BDD;&#x9700;&#x8981;<code>pop temp 0</code>&#xFF1A;</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> ArrayList&lt;String&gt; <span class="title function_">compileSubroutineCall</span><span class="params">(String line)</span> {</span><br><span class="line">    ArrayList&lt;String&gt; subroutine = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> <span class="variable">argNum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// we first store the functionName</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">funcName</span> <span class="operator">=</span> line.substring(<span class="number">0</span>, line.indexOf(<span class="string">&quot;(&quot;</span>));</span><br><span class="line">    line = line.substring(line.indexOf(<span class="string">&quot;(&quot;</span>));</span><br><span class="line">    <span class="keyword">if</span> (!funcName.contains(<span class="string">&quot;.&quot;</span>)) funcName = className + <span class="string">&quot;.&quot;</span> + funcName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// then comes the expressionList</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">expressionList</span> <span class="operator">=</span> line.substring(line.indexOf(<span class="string">&apos;(&apos;</span>) + <span class="number">1</span>, line.indexOf(<span class="string">&apos;)&apos;</span>));</span><br><span class="line">    <span class="keyword">if</span> (!expressionList.isEmpty()) {</span><br><span class="line">        ArrayList&lt;String&gt; expressions = compileExpressionList(expressionList);</span><br><span class="line">        subroutine.addAll(expressions);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!expressionList.isEmpty()) {</span><br><span class="line">        argNum = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; expressionList.length(); i++) {</span><br><span class="line">            <span class="keyword">if</span> (expressionList.charAt(i) == <span class="string">&apos;,&apos;</span>) argNum++;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// finally we call the method</span></span><br><span class="line">    <span class="keyword">if</span> (Tokenizer.funcCollection.contains(funcName)) {</span><br><span class="line">        subroutine.add(VMWriter.writeFunctionCall(funcName, argNum));</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">for</span> (String s : Tokenizer.funcCollection) {</span><br><span class="line">            <span class="keyword">if</span> (s.substring(s.indexOf(<span class="string">&quot;.&quot;</span>) + <span class="number">1</span>).equals(funcName.substring(funcName.indexOf(<span class="string">&quot;.&quot;</span>) + <span class="number">1</span>))) {</span><br><span class="line">                subroutine.add(VMWriter.writeFunctionCall(s, argNum));</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (funcType.get(funcName).equals(<span class="string">&quot;void&quot;</span>))</span><br><span class="line">        subroutine.add(VMWriter.writePop(<span class="string">&quot;temp&quot;</span>, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> subroutine;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h4><span id="gcompileengine&#x6700;&#x7EC8;&#x6784;&#x5EFA;">&#x2003;&#x2003;<span class="math inline">\(g.\)</span>
<code>CompileEngine</code>&#x6700;&#x7EC8;&#x6784;&#x5EFA;</span></h4>
<ol type="1">
<li><p>&#x9884;&#x5904;&#x7406;&#x3002;&#x5C06;&#x5F85;&#x7F16;&#x8BD1;&#x7684;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x6587;&#x4EF6;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x4F20;&#x5165;<code>SymbolTable.constructor</code>&#xFF0C;&#x4EE5;&#x6784;&#x5EFA;&#x6BCF;&#x4E2A;&#x6587;&#x4EF6;&#x5BF9;&#x5E94;&#x7684;<code>Symbol Table</code>&#x3002;</p></li>
<li><p>&#x7F16;&#x8BD1;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x9047;&#x5230;&#x4E00;&#x4E2A;&#x51FD;&#x6570;/&#x65B9;&#x6CD5;&#x540D;&#xFF0C;&#x5148;&#x5C06;&#x5176;&#x5B58;&#x5165;<code>funcType</code>&#x4E2D;&#xFF0C;&#x4EE5;&#x5728;&#x540E;&#x7EED;&#x8C03;&#x7528;&#x8BE5;&#x51FD;&#x6570;&#x65F6;&#x80FD;&#x591F;&#x627E;&#x5230;&#x8BE5;&#x51FD;&#x6570;/&#x65B9;&#x6CD5;&#x540D;&#x3002;</p></li>
<li><p>&#x5BF9;<code>constructor</code>&#xFF0C;<code>method</code>&#x9700;&#x8981;&#x8FDB;&#x884C;&#x5404;&#x81EA;&#x7684;&#x9884;&#x5904;&#x7406;&#x3002;</p></li>
<li><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C06;&#x5F85;&#x7F16;&#x8BD1;&#x7684;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#x5206;&#x7C7B;&#xFF1A;</p>
<ul>
<li>&#x65B9;&#x6CD5;/&#x51FD;&#x6570;&#x7684;&#x58F0;&#x660E;&#x3002;</li>
<li>&#x53D8;&#x91CF;&#x58F0;&#x660E;&#x3002;</li>
<li>&#x65B9;&#x6CD5;/&#x51FD;&#x6570;&#x4F53;&#x3002;</li>
</ul></li>
</ol>
<p>&#x2003;&#x2003;&#x5BF9;&#x6BCF;&#x4E00;&#x7C7B;&#xFF0C;&#x5206;&#x522B;&#x7F16;&#x8BD1;&#x5373;&#x53EF;&#x3002;&#x9700;&#x8981;&#x6CE8;&#x610F;&#xFF0C;&#x5904;&#x7406;&#x51FD;&#x6570;&#x4F53;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8BFB;&#x5165;&#x6574;&#x4E2A;&#x5B50;&#x7A0B;&#x5E8F;&#xFF0C;&#x5C06;&#x5176;&#x653E;&#x5165;<code>ArrayList&lt;String&gt;</code>&#x4E2D;&#x4F5C;&#x4E3A;<code>compileSubroutineBody</code>&#x7684;&#x53C2;&#x6570;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">constructor</span><span class="params">(String[] files)</span> {</span><br><span class="line">    <span class="keyword">for</span> (String filename : files) {</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> filename.substring(<span class="number">0</span>, filename.length() - <span class="number">5</span>);</span><br><span class="line">        Operation.addToArray(Tokenizer.className, name);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    initType();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (String filename : files) {</span><br><span class="line">        SymbolTable.constructor(filename);</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="type">String</span> <span class="variable">vmFile</span> <span class="operator">=</span> filename.substring(<span class="number">0</span>, filename.length() - <span class="number">5</span>) + <span class="string">&quot;.vm&quot;</span>;</span><br><span class="line">            <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(filename));</span><br><span class="line">            <span class="type">BufferedWriter</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(<span class="keyword">new</span> <span class="title class_">FileWriter</span>(vmFile));</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> Operation.modify(reader.readLine());</span><br><span class="line">            <span class="keyword">while</span> (line != <span class="literal">null</span>) {</span><br><span class="line">                <span class="keyword">if</span> (!line.isEmpty()) {</span><br><span class="line">                    <span class="keyword">if</span> (line.indexOf(<span class="string">&quot;class&quot;</span>) == <span class="number">0</span>) {</span><br><span class="line">                        className.setLength(<span class="number">0</span>);</span><br><span class="line">                        className.append(line.substring(<span class="number">5</span>, line.length() - <span class="number">1</span>));</span><br><span class="line">                        line = Operation.modify(reader.readLine());</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    }</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (isSubroutineDec(line)) {</span><br><span class="line">                        <span class="type">String</span> <span class="variable">subroutineKind</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">                        <span class="type">String</span> <span class="variable">subroutineType</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">                        <span class="type">int</span> <span class="variable">subroutineLength</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">                        <span class="type">int</span> <span class="variable">typeLength</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; subroutineDec.length; i++) {</span><br><span class="line">                            <span class="keyword">if</span> (line.indexOf(subroutineDec[i]) == <span class="number">0</span>) {</span><br><span class="line">                                subroutineKind = subroutineDec[i];</span><br><span class="line">                                subroutineLength = subroutineDec[i].length();</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            }</span><br><span class="line">                        }</span><br><span class="line"></span><br><span class="line">                        line = line.substring(subroutineLength);</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// then comes the type</span></span><br><span class="line">                        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; type.length; i++) {</span><br><span class="line">                            <span class="keyword">if</span> (line.indexOf(type[i]) == <span class="number">0</span>) {</span><br><span class="line">                                subroutineType = type[i];</span><br><span class="line">                                typeLength = type[i].length();</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            }</span><br><span class="line">                        }</span><br><span class="line"></span><br><span class="line">                        line = line.substring(typeLength);</span><br><span class="line">                        <span class="type">String</span> <span class="variable">subroutine</span> <span class="operator">=</span> className + <span class="string">&quot;.&quot;</span> + line.substring(<span class="number">0</span>, line.indexOf(<span class="string">&quot;(&quot;</span>));</span><br><span class="line">                        curSubroutine.setLength(<span class="number">0</span>);</span><br><span class="line">                        curSubroutine.append(subroutine);</span><br><span class="line">                        funcType.put(curSubroutine.toString(), subroutineType);</span><br><span class="line">                        writer.write(VMWriter.writeFunctionDec(curSubroutine.toString(), SymbolTable.kindCount(<span class="string">&quot;local&quot;</span>, curSubroutine.toString())));</span><br><span class="line">                        writer.newLine();</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (subroutineKind.equals(<span class="string">&quot;constructor&quot;</span>)) {</span><br><span class="line">                            <span class="type">String</span> <span class="variable">line1</span> <span class="operator">=</span> VMWriter.writePush(<span class="string">&quot;constant&quot;</span>, SymbolTable.kindCount(<span class="string">&quot;field&quot;</span>, <span class="literal">null</span>));</span><br><span class="line">                            <span class="type">String</span> <span class="variable">line2</span> <span class="operator">=</span> VMWriter.writeCall(<span class="string">&quot;Memory.alloc&quot;</span>, <span class="number">1</span>);</span><br><span class="line">                            writer.write(line1);</span><br><span class="line">                            writer.newLine();</span><br><span class="line">                            writer.write(line2);</span><br><span class="line">                            writer.newLine();</span><br><span class="line">                        }</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (subroutineKind.equals(<span class="string">&quot;method&quot;</span>)) {</span><br><span class="line">                            <span class="type">String</span> <span class="variable">line1</span> <span class="operator">=</span> VMWriter.writePush(<span class="string">&quot;argument&quot;</span>, <span class="number">0</span>);</span><br><span class="line">                            <span class="type">String</span> <span class="variable">line2</span> <span class="operator">=</span> VMWriter.writePop(<span class="string">&quot;pointer&quot;</span>, <span class="number">0</span>);</span><br><span class="line">                            writer.write(line1);</span><br><span class="line">                            writer.newLine();</span><br><span class="line">                            writer.write(line2);</span><br><span class="line">                            writer.newLine();</span><br><span class="line">                        }</span><br><span class="line"></span><br><span class="line">                        line = Operation.modify(reader.readLine());</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    }</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// case 2: varDec, we just ignore it</span></span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (isVarDec(line)) {</span><br><span class="line">                        <span class="keyword">while</span> (isVarDec(line)) {</span><br><span class="line">                            line = Operation.modify(reader.readLine());</span><br><span class="line">                        }</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    }</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// case 3: subroutineBody</span></span><br><span class="line">                    <span class="keyword">else</span> {</span><br><span class="line">                        ArrayList&lt;String&gt; subroutineCode = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">                        <span class="keyword">while</span> (line != <span class="literal">null</span> &amp;&amp; !isSubroutineDec(line)) {</span><br><span class="line">                            <span class="keyword">if</span> (!line.isEmpty()) {</span><br><span class="line">                                System.out.println(line);</span><br><span class="line">                                subroutineCode.add(line);</span><br><span class="line">                            }</span><br><span class="line">                            line = Operation.modify(reader.readLine());</span><br><span class="line">                        }</span><br><span class="line"></span><br><span class="line">                        ArrayList&lt;String&gt; subroutineBody = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(compileSubroutineBody(subroutineCode));</span><br><span class="line">                        <span class="keyword">for</span> (String s : subroutineBody) {</span><br><span class="line">                            writer.write(s);</span><br><span class="line">                            writer.newLine();</span><br><span class="line">                        }</span><br><span class="line"></span><br><span class="line">                        line = Operation.modify(reader.readLine());</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">                line = Operation.modify(reader.readLine());</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            reader.close();</span><br><span class="line">            writer.close();</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/27/10-8-%E5%AF%B9%E6%95%B0%E7%BB%84%E7%9A%84%E5%A4%84%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/27/10-8-%E5%AF%B9%E6%95%B0%E7%BB%84%E7%9A%84%E5%A4%84%E7%90%86/" class="post-title-link" itemprop="url">10.8.&#x5BF9;&#x6570;&#x7EC4;&#x7684;&#x5904;&#x7406;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-27 20:15:43" itemprop="dateCreated datePublished" datetime="2024-04-27T20:15:43+08:00">2024-04-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 16:04:46" itemprop="dateModified" datetime="2024-06-03T16:04:46+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-10-Code-Generator/" itemprop="url" rel="index"><span itemprop="name">Module 10.Code Generator</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>521</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1><span id="108handling-array"><span class="math inline">\(10.8.\)</span>Handling Array</span></h1>
<h3><span id="1array-construction">1.Array construction</span></h3>
<p>&#x2003;&#x2003;Assume that the high-level programmer writes
<code>var Array arr</code>.</p>
<ul>
<li>In response to this, the compiler will only <strong>allocate a
<code>local</code> variable</strong> to represent the array and
<strong>initialize this variable to 0</strong>.</li>
<li>This statement <strong>generates no code</strong>. The compiler will
<strong>get a variable called <code>loca1 0</code>, its type
<code>Array</code> and name <code>arr</code></strong>.</li>
</ul>
<p>&#x2003;&#x2003;When we construct this array by calling the subroutine of the
<code>Array</code> class: <code>let arr = Array.new(5)</code>.</p>
<ul>
<li>The compiler and OS will magically <strong>allocate sufficient space
in the heap</strong> to represent the array.</li>
<li>The base address of the new allocated block is going to be stored in
<code>local 0</code>, regardless of the address may be.</li>
<li>What we have here is <strong>a standard call to a Jack
subroutine</strong>, which we already knew how to handle.</li>
</ul>
<p><img src="/2024/04/27/10-8-%E5%AF%B9%E6%95%B0%E7%BB%84%E7%9A%84%E5%A4%84%E7%90%86/image.png"></p>
<h3><span id="2array-manipulation">2.Array manipulation</span></h3>
<h4><span id="athis-and-thatreview">&#x2003;&#x2003;<span class="math inline">\(a.\)</span><code>THIS</code> and <code>THAT</code>
review</span></h4>
<p><img src="/2024/04/27/10-8-%E5%AF%B9%E6%95%B0%E7%BB%84%E7%9A%84%E5%A4%84%E7%90%86/image-1.png"></p>
<p><img src="/2024/04/27/10-8-%E5%AF%B9%E6%95%B0%E7%BB%84%E7%9A%84%E5%A4%84%E7%90%86/image-2.png"></p>
<h5><span id="bgenerating-code">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Generating code</span></h5>
<p>&#x2003;&#x2003;Suppose we want to conduct <code>arr[2] = 17</code>:</p>
<p><img src="/2024/04/27/10-8-%E5%AF%B9%E6%95%B0%E7%BB%84%E7%9A%84%E5%A4%84%E7%90%86/image-3.png"></p>
<ul>
<li><p>Since the base address of <code>arr</code> is stored in
<code>THAT</code>, we simply <code>push arr</code> then
<code>push index</code>, and <code>add</code> to get
<code>arr + 2</code>.</p></li>
<li><p>Then the <code>THAT</code> pointer will be aligned with the
address we want to manipulate.</p></li>
<li><p>Notice that:</p>
<ol type="1">
<li>We use <strong>only <code>THAT 0</code></strong>, we don&apos;t use other
entries from <code>THAT</code> segment.</li>
<li>The VM code you have <strong>operates in a completely symbolic
logical world</strong>. It doesn&apos;t know where the array is located in
RAM or which address we are manipulating. In this respect, it&apos;s a very
safe code, for it cannot reach out of the VM world, because all the
physical considerations are being implemented by the VM translator, and
VM code itself is completely oblivious of the host platform. This is
very important because we have numerous different computers, we don&apos;t
know where this code is going to run, and we <strong>don&apos;t have the
luxury of making any assumptions about the underlying hardware
platform</strong>.</li>
</ol></li>
</ul>
<p>&#x2003;&#x2003;What about <code>arr[exp1] = exp2</code>? As above, we may write
the following code:</p>
<p><img src="/2024/04/27/10-8-%E5%AF%B9%E6%95%B0%E7%BB%84%E7%9A%84%E5%A4%84%E7%90%86/image-4.png"></p>
<p>&#x2003;&#x2003;This seems make sense, but when we try to write
<code>a[i] = b[j]</code>, there comes a crush:</p>
<p><img src="/2024/04/27/10-8-%E5%AF%B9%E6%95%B0%E7%BB%84%E7%9A%84%E5%A4%84%E7%90%86/image-5.png"></p>
<p>&#x2003;&#x2003;To avoid this, we:</p>
<ol type="1">
<li>First deal with the right hand side and left hand side separately.
Once we complete this, the stack is going to <strong>contain two
addresses</strong>: the address of <code>a[i]</code> and the address of
<code>b[j]</code>:</li>
</ol>
<p><img src="/2024/04/27/10-8-%E5%AF%B9%E6%95%B0%E7%BB%84%E7%9A%84%E5%A4%84%E7%90%86/image-6.png"></p>
<ol start="2" type="1">
<li>We <strong><code>pop</code> the topmost value</strong> onto
<code>pointer 1</code>, which is <code>b[i]</code> in this example. Once
is done, we are going to get the following state:</li>
</ol>
<p><img src="/2024/04/27/10-8-%E5%AF%B9%E6%95%B0%E7%BB%84%E7%9A%84%E5%A4%84%E7%90%86/image-7.png"></p>
<ol start="3" type="1">
<li>Now that <code>That 0</code> is aligned with <code>b[j]</code>, we
<strong><code>push</code> the value in <code>b[j]</code> and
<code>pop</code> it into <code>temp 0</code></strong>. This is the
picture of the VM segments after the process:</li>
</ol>
<p><img src="/2024/04/27/10-8-%E5%AF%B9%E6%95%B0%E7%BB%84%E7%9A%84%E5%A4%84%E7%90%86/image-8.png"></p>
<ol start="4" type="1">
<li>Because we have <strong>safely saved the value of
<code>b[i]</code></strong>, we can <strong>take the address of
<code>a[i]</code> and <code>pop</code> it onto
<code>pointer 1</code></strong></li>
<li>We finally <strong><code>push temp 0</code> onto the stack</strong>
and <strong><code>pop</code> it onto <code>that 0</code></strong>, which
is on the address of <code>a[i]</code>:</li>
</ol>
<p><img src="/2024/04/27/10-8-%E5%AF%B9%E6%95%B0%E7%BB%84%E7%9A%84%E5%A4%84%E7%90%86/image-9.png"></p>
<p>&#x2003;&#x2003;The general solution for generating array access code is as
below:</p>
<p>![[Pasted image 20240507234141.png]]</p>
<p><img src="/2024/04/27/10-8-%E5%AF%B9%E6%95%B0%E7%BB%84%E7%9A%84%E5%A4%84%E7%90%86/image-10.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/26/10-7-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E6%93%8D%E7%BA%B5%E5%AF%B9%E8%B1%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/26/10-7-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E6%93%8D%E7%BA%B5%E5%AF%B9%E8%B1%A1/" class="post-title-link" itemprop="url">10.7.&#x5BF9;&#x5BF9;&#x8C61;&#x7684;&#x5904;&#x7406;&#x2014;&#x2014;&#x64CD;&#x7EB5;&#x5BF9;&#x8C61;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-26 20:15:43" itemprop="dateCreated datePublished" datetime="2024-04-26T20:15:43+08:00">2024-04-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 15:58:26" itemprop="dateModified" datetime="2024-06-03T15:58:26+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-10-Code-Generator/" itemprop="url" rel="index"><span itemprop="name">Module 10.Code Generator</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>489</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1><span id="107handling-objects-manipulation"><span class="math inline">\(10.7.\)</span>Handling Objects: Manipulation</span></h1>
<h3><span id="1compiling-method-calls">1.Compiling method calls</span></h3>
<ul>
<li>In compiler, we are going to translate the OO method calls into
<strong>procedural style language</strong> like VM language or machine
language, they don&apos;t understand what an object is.</li>
</ul>
<p>&#x2003;&#x2003;In order to do this:</p>
<ul>
<li>We can <strong>treat the object as the first, implicit
argument</strong>. We push it onto the stack, because we want it to
<strong>be the first argument on which the method is going to
operate</strong>.</li>
</ul>
<p><img src="/2024/04/26/10-7-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E6%93%8D%E7%BA%B5%E5%AF%B9%E8%B1%A1/image-5.png"></p>
<ol type="1">
<li>We <code>push</code> the object into the stack.</li>
<li>We <code>push</code> enough arguments into the stack.</li>
<li>We <code>call</code> the method.</li>
</ol>
<p>&#x2003;&#x2003;When we say &quot;put the object onto the stack&quot;, we don&apos;t care what the
object is, we are only interested in its <em>base address</em>.</p>
<h3><span id="2compiling-methods">2.Compiling methods</span></h3>
<p>&#x2003;&#x2003;Methods are used to operate on the object which refers to as
<code>THIS</code>. Therefore, each method&apos;s code needs to <strong>access
to the object&apos;s <code>field</code> variables</strong>.</p>
<p>&#x2003;&#x2003;In the previous unit, we know that we can access the <span class="math inline">\(ith\)</span> <code>field</code> by
<code>THIS i</code>. However, before we use <code>THIS</code>, we have
to anchor it on the proper address on the RAM first, so we also need
<code>pointer</code>.</p>
<p><img src="/2024/04/26/10-7-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E6%93%8D%E7%BA%B5%E5%AF%B9%E8%B1%A1/image-6.png"></p>
<p>&#x2003;&#x2003;Let&apos;s take the <code>distance</code> method as an example:</p>
<ol type="1">
<li>The method is compiled within a class, so we will <strong>compile
the class variables</strong>, namely <code>x, y, pointCount</code>. This
will end up generating no code.</li>
<li>Both the method declaration and variable declaration generate no
code, either. Instead, the compiler <strong>creates the symbol table of
the subroutine</strong> and <strong>populates it within the
<code>this</code> object as well as the explicit variables that is found
in the parameter list and the variable declaration.</strong></li>
<li>We can anticipate that the method will want to operate on the
current object, so we need to generate code that will <strong>anchor
this on the correct address in memory</strong>. And we know that the
current object address is <code>argument 0</code>, so we do
<code>push argument 0</code> and <code>pop pointer 0</code> to let
<code>THIS</code> pointer to contain the address of the current
object.</li>
</ol>
<p>&#x2003;&#x2003;When the <code>distance</code> method completes execution and
terminates, control will return to the caller. The compiled code of the
caller is as below:</p>
<p><img src="/2024/04/26/10-7-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E6%93%8D%E7%BA%B5%E5%AF%B9%E8%B1%A1/image-7.png"></p>
<ul>
<li>We know that the method returns a value on the top of stack, so we
remove it and put it into <code>d</code>.</li>
</ul>
<h3><span id="3void-methodcompilation">3.<code>void</code> method
compilation</span></h3>
<p><img src="/2024/04/26/10-7-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E6%93%8D%E7%BA%B5%E5%AF%B9%E8%B1%A1/image-8.png"></p>
<p>&#x2003;&#x2003;The <code>void</code> doesn&apos;t expect to get a return value, while
according to the rules of the game, we must return a value. As a result,
we:</p>
<ol type="1">
<li>To obey the rule, we <strong>generate code at the end of each method
that returns a value</strong>.</li>
<li>Since we have nothing to return, we <code>push constant 0</code>,
which is a dummy value and then <code>return</code>.</li>
</ol>
<p>&#x2003;&#x2003;But now the compiled code faces a slight problem: the stack
contains uncessary value and we want to get rid of it.</p>
<ol start="3" type="1">
<li>To do this, we simply <code>pop temp 0</code>.</li>
</ol>
<p><img src="/2024/04/26/10-7-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E6%93%8D%E7%BA%B5%E5%AF%B9%E8%B1%A1/image-9.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/25/10-6-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E6%9E%84%E9%80%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/25/10-6-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E6%9E%84%E9%80%A0/" class="post-title-link" itemprop="url">10.6.&#x5BF9;&#x5BF9;&#x8C61;&#x7684;&#x5904;&#x7406;&#x2014;&#x2014;&#x6784;&#x9020;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-25 20:15:43" itemprop="dateCreated datePublished" datetime="2024-04-25T20:15:43+08:00">2024-04-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 15:56:21" itemprop="dateModified" datetime="2024-06-03T15:56:21+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-10-Code-Generator/" itemprop="url" rel="index"><span itemprop="name">Module 10.Code Generator</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>664</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1><span id="106handling-objects-construction"><span class="math inline">\(10.6.\)</span>Handling Objects: Construction</span></h1>
<p><img src="/2024/04/25/10-6-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E6%9E%84%E9%80%A0/image.png"></p>
<ul>
<li>What we have here is two completely separate compilation units. We
are facing the challenge of compiling the caller class and the callee
class.</li>
</ul>
<h3><span id="1high-level-of-objectconstruction">1.High level of object
construction</span></h3>
<ul>
<li>When we do <code>var Point p1</code>, the compiler will end up
generating code on <strong>some location in the stack which is going to
be initialized to 0</strong>.</li>
<li>When we call the constructor, the compiled code will end up
<strong>creating the object proper on the heap</strong>.</li>
<li>The two class running together will end up <strong>taking the base
address of the newly created object</strong> and <strong>storing it in
what we assign previously the p1 variable</strong>.</li>
</ul>
<h3><span id="2the-callerss-side">2.The callers&apos;s side</span></h3>
<p><img src="/2024/04/25/10-6-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E6%9E%84%E9%80%A0/image-1.png"></p>
<ul>
<li><p>Whenever the compiler encounters a variable declaration, it
<strong>generates no code whatsover</strong>. The only thing the
compiler does is it <strong>update the relevant symbol table</strong>.
Because we are now compiling code that resides in a certain subroutine,
we will end up <strong>updating the symbol table of the
subroutine</strong>.</p></li>
<li><p><code>Point.new(2, 3)</code> is a call to some subroutine, so we
handle it just like other subroutine. We push the two arguments and
<code>call Point.new</code></p></li>
<li><p>The calling code assumes that when the constructor will execute,
it will end up <strong>allocating some space on the RAM</strong> for the
newly constructed object. It will also take the base address of this
space on the RAM and <strong>return it to the caller</strong>.</p></li>
<li><p>So we <strong><code>pop</code> the topmost value of the stack
into <code>p1</code></strong>, because we want <code>p1</code> to point
at the base address of this object.</p></li>
</ul>
<h3><span id="3resulting-impact">3.Resulting impact</span></h3>
<p><img src="/2024/04/25/10-6-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E6%9E%84%E9%80%A0/image-2.png"></p>
<ul>
<li>Only when we call the constructors will we actually create the
objects on RAM.</li>
<li>Object construction is a <strong>two-stage affair that happens both
during compile time and run time</strong>.</li>
</ul>
<h3><span id="4the-big-picture-ofconstructors">4.The big picture of
constructors</span></h3>
<p><img src="/2024/04/25/10-6-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E6%9E%84%E9%80%A0/image-3.png"></p>
<p>&#x2003;&#x2003;A constructor is typically designed to do at least two things:</p>
<ol type="1">
<li><strong>Arrange some place</strong> on RAM for the new object.</li>
<li><strong>Assign certain values</strong> to the fields of the newly
constructed object.</li>
</ol>
<p>&#x2003;&#x2003;To do this, the constructor must have access to the object&apos;s
fields:</p>
<ul>
<li>We can <strong>manipulate <code>THIS</code> segment</strong> to
manipulate the object that the constructor juct created.</li>
<li>To access <code>THIS</code> segment, we first <strong>anchor it
properly on the right address in the RAM</strong> using
<code>pointer</code> segment.</li>
</ul>
<h3><span id="5compiling-constuctor">5.Compiling constuctor</span></h3>
<ol type="1">
<li>The first thing we meet is the constructor signature. The compiler
will generate no code whatsover. The only thing it will do is <strong>it
will create the subroutine symbol table</strong> and <strong>record in
it two variables <code>ax</code> and <code>ay</code> which are both
arguments </strong></li>
</ol>
<p>&#x2003;&#x2003;Then comes the question: how much space is needed?</p>
<ol start="2" type="1">
<li>The compiler can <strong>consult the class level symbol
table</strong> and realize that objects of the point class requires two
words only, <code>x</code> and <code>y</code>.</li>
</ol>
<p>&#x2003;&#x2003;Then how do we find such a free memory block on RAM?</p>
<ol start="3" type="1">
<li><p>The <em>operating system</em> supplies a function called
<code>alloc</code>, if you provide <code>alloc(x)</code> with a certain
argument, it will <strong>find a memory block on the RAM</strong> and
<strong>return the base address of it.</strong> The memory block has two
important properties:</p>
<ol type="1">
<li>It&apos;s <code>x</code> words long.</li>
<li>It&apos;s free, no one needs it now, so the constructor can safely use
it.</li>
</ol></li>
</ol>
<p><img src="/2024/04/25/10-6-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E6%9E%84%E9%80%A0/image-4.png"></p>
<ol type="1">
<li>We <code>push 2</code>, because we <strong>need 2 words to store the
arguments</strong>.</li>
<li>We want to push <code>THIS</code> into the stack, we need 1 word, so
we <code>call Memory.alloc 1</code>.</li>
<li>As usual, we anchor <code>THIS</code> at the base address:
<code>pop pointer 0</code>.</li>
</ol>
<blockquote>
<p>If we do <code>pop pointer 0</code>, we are going to align the
virtual segment ot the object we currently constructed on the RAM. We do
this because I know that with very high likelihood the next commands in
the constructor will want to access the fields of the newly created
object.</p>
</blockquote>
<ol start="4" type="1">
<li>Since <code>THIS</code> is anchored on the right endness, to
<code>return</code>, we simply do <code>push pointer 0</code>. And when
the caller of constructor do <code>pop pointer 0</code>, it can
successfully get the address of the newly created object.</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/22/10-5-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E5%BA%95%E5%B1%82%E7%89%B9%E6%80%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/22/10-5-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E5%BA%95%E5%B1%82%E7%89%B9%E6%80%A7/" class="post-title-link" itemprop="url">10.5.&#x5BF9;&#x5BF9;&#x8C61;&#x7684;&#x5904;&#x7406;&#x2014;&#x2014;&#x5E95;&#x5C42;&#x7279;&#x6027;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-22 20:15:43" itemprop="dateCreated datePublished" datetime="2024-04-22T20:15:43+08:00">2024-04-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 15:52:40" itemprop="dateModified" datetime="2024-06-03T15:52:40+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-10-Code-Generator/" itemprop="url" rel="index"><span itemprop="name">Module 10.Code Generator</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>401</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1><span id="105handling-objects-low-levelaspects"><span class="math inline">\(10.5.\)</span>Handling Objects: Low-level
Aspects</span></h1>
<p><img src="/2024/04/22/10-5-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E5%BA%95%E5%B1%82%E7%89%B9%E6%80%A7/image.png"></p>
<h3><span id="1handling-objects">1.Handling objects</span></h3>
<p>&#x2003;&#x2003;Let&apos;s review how we handle <code>local</code> and
<code>argument</code> first:</p>
<p><img src="/2024/04/22/10-5-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E5%BA%95%E5%B1%82%E7%89%B9%E6%80%A7/image-1.png"></p>
<ul>
<li><p>The first five words in the RAM are used as <strong>pointer that
hold the current value of the stack pointer, namely the base address of
the <code>local</code>, <code>argument</code>, <code>this</code>,
<code>that</code></strong>.</p></li>
<li><p>The VM implementation also allocates a certain area on RAM to
hold the global stack which <strong>keeps the working stack of the
currentlt running VM functions</strong> and all the working stack and
memory segments of the functions that wait to for the current function
to terminate, namely the functions which <strong>are on the calling
chain</strong>.</p></li>
<li><p>The VM implementation recalls the location of these segments of
the stack by <strong>using the two pointers <code>LCL</code> and
<code>ARG</code></strong>. It records the base address of this segment
in the <code>LCL</code>.</p></li>
</ul>
<p>&#x2003;&#x2003;Then how can we use the same architecture to represent object and
array data?</p>
<ol type="1">
<li>We use a different area altogether on the RAM called
<em><code>heap</code></em>.</li>
<li>On the <code>heap</code>, we recall the data of all the objects and
the arrays that the current program seeks to manipulate.</li>
</ol>
<p><img src="/2024/04/22/10-5-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E5%BA%95%E5%B1%82%E7%89%B9%E6%80%A7/image-2.png"></p>
<p>&#x2003;&#x2003;As opposed to the <code>local</code> and <code>argument</code>
segments which have only one of each to worry about, here you may have
many objects on the heap. So before we access an object using
<code>this</code> segment, we have to tell the system <strong>to which
object are we actually referring</strong>?</p>
<ul>
<li>The implementation of <code>this</code> location is first
<strong>use the pointer <code>this</code> and
<code>that</code></strong>.</li>
<li>Before we use the two segments, we <strong>first have to use the
<code>pointer</code> segment</strong> to <strong>tell the system where
we want to align <code>this</code> and <code>that</code> on the
RAM</strong>.</li>
</ul>
<blockquote>
<p>We had to provide a mechanism to anchor this and that on the
particular object and array the code has to operate on and we are using
this virtual segment pointer for this purpose.</p>
</blockquote>
<p>&#x2003;&#x2003;Now, suppose we want to access RAM words 8000, 8001, 8002... We can
achieve this by the following VM code:</p>
<p><img src="/2024/04/22/10-5-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E5%BA%95%E5%B1%82%E7%89%B9%E6%80%A7/image-3.png"></p>
<ul>
<li>Once we set <code>THIS</code> pointer to a particular address,
<strong><code>THIS</code>can be used as if it&apos;s anchored exactly on the
8000th address in RAM</strong>. Given this desired mapping, we can use
command related to <code>THIS</code>.</li>
<li><code>push this 0</code> will <strong>take the value which is
currently located in <code>RAM 8000</code> onto the stack</strong>.</li>
<li><code>pop this 0</code> will <strong>take something off the stack
and put it into <code>RAM 8000</code></strong>.</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="&#x4E0A;&#x4E00;&#x9875;" aria-label="&#x4E0A;&#x4E00;&#x9875;" href="/page/7/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&#x2026;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><span class="space">&#x2026;</span><a class="page-number" href="/page/13/">13</a><a class="extend next" rel="next" title="&#x4E0B;&#x4E00;&#x9875;" aria-label="&#x4E0B;&#x4E00;&#x9875;" href="/page/9/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">



  <div class="copyright">
    &#xA9; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">fyerfyer</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>&#x7AD9;&#x70B9;&#x603B;&#x5B57;&#x6570;&#xFF1A;</span>
    <span title="&#x7AD9;&#x70B9;&#x603B;&#x5B57;&#x6570;">99k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>&#x7AD9;&#x70B9;&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
    <span title="&#x7AD9;&#x70B9;&#x9605;&#x8BFB;&#x65F6;&#x957F;">6:01</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="&#x603B;&#x8BBF;&#x5BA2;&#x91CF;">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="&#x603B;&#x8BBF;&#x95EE;&#x91CF;">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">&#x7531; <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> &amp; <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> &#x5F3A;&#x529B;&#x9A71;&#x52A8;
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"all","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
