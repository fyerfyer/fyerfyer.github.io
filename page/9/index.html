<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"fyerfyer.github.io.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">


    <meta name="description" content="fyerfyer&apos;s blog">
<meta property="og:type" content="website">
<meta property="og:title" content="fyerfyer">
<meta property="og:url" content="https://fyerfyer.github.io.com/page/9/index.html">
<meta property="og:site_name" content="fyerfyer">
<meta property="og:description" content="fyerfyer&apos;s blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="fyerfyer">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://fyerfyer.github.io.com/page/9/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/9/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>fyerfyer</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="&#x5207;&#x6362;&#x5BFC;&#x822A;&#x680F;" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">fyerfyer</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Hello! Nice to meet you!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="&#x641C;&#x7D22;" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>&#x9996;&#x9875;</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>&#x5173;&#x4E8E;</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>&#x5206;&#x7C7B;</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>&#x5F52;&#x6863;</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          &#x6587;&#x7AE0;&#x76EE;&#x5F55;
        </li>
        <li class="sidebar-nav-overview">
          &#x7AD9;&#x70B9;&#x6982;&#x89C8;
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="fyerfyer" src="/images/head.png">
  <p class="site-author-name" itemprop="name">fyerfyer</p>
  <div class="site-description" itemprop="description">fyerfyer&apos;s blog</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">106</span>
          <span class="site-state-item-name">&#x65E5;&#x5FD7;</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">33</span>
        <span class="site-state-item-name">&#x5206;&#x7C7B;</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/fyerfyer" title="GitHub &#x2192; https://github.com/fyerfyer" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/fuy60703@gmail.com" title="E-Mail &#x2192; fuy60703@gmail.com" rel="noopener me"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="&#x8FD4;&#x56DE;&#x9876;&#x90E8;">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/08/7-3-%E5%86%85%E5%AD%98%E6%AE%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/08/7-3-%E5%86%85%E5%AD%98%E6%AE%B5/" class="post-title-link" itemprop="url">7.3.&#x5185;&#x5B58;&#x6BB5;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-08 15:54:36" itemprop="dateCreated datePublished" datetime="2024-04-08T15:54:36+08:00">2024-04-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 08:02:02" itemprop="dateModified" datetime="2024-06-03T08:02:02+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-7-VM-Machine/" itemprop="url" rel="index"><span itemprop="name">Module 7.VM Machine</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1><span id="73memorysegments"><span class="math inline">\(7.3.\)</span>Memory
Segments</span></h1>
<h3><span id="1memory-segments-intro">1.Memory segments intro</span></h3>
<p>&#x2003;&#x2003;There are different variable kinds in the high-level language, such
as:</p>
<ul>
<li>Argument variables</li>
<li>Local variables</li>
<li>Static variables</li>
</ul>
<p>&#x2003;&#x2003;Since different kind of variables <strong>play different
role</strong>, we need some mechanism to <strong>record the different
roles of different variables</strong>. We can achieve this by the notion
of <em>memory segments</em>:</p>
<p><img src="/2024/04/08/7-3-%E5%86%85%E5%AD%98%E6%AE%B5/image.png"></p>
<p>&#x2003;&#x2003;So the program below can be translated into two ways: without
<em>memory segments</em>:</p>
<p><img src="/2024/04/08/7-3-%E5%86%85%E5%AD%98%E6%AE%B5/image-1.png"></p>
<p>&#x2003;&#x2003;And with <em>memory segments</em>:</p>
<p><img src="/2024/04/08/7-3-%E5%86%85%E5%AD%98%E6%AE%B5/image-2.png"></p>
<p>&#x2003;&#x2003;In this way, we will be able to preserve the role semantics of
these variables.</p>
<p>&#x2003;&#x2003;But it seems that we lost the variable names in the process. It&apos;s
not a big deal, however, for <strong>the VM obstruction doesn&apos;t
recognize symbolic variable names</strong>, all the variables are
replaced by references to memory segments.</p>
<p>&#x2003;&#x2003;Through memory segments, we now interact with several different
segments:</p>
<p><img src="/2024/04/08/7-3-%E5%86%85%E5%AD%98%E6%AE%B5/image-3.png"></p>
<p>&#x2003;&#x2003;And the syntax of the command is:
<code>push / pop segment i</code></p>
<ul>
<li><em>segment</em> is the segment you want to operate on.</li>
<li><em>i</em> is the index of the command in that segment.</li>
<li><span class="math inline">\(e.g.\)</span>
:<code>push constant 17</code></li>
<li><span class="math inline">\(e.g.\)</span> : translation of
<code>let static 2 = argument 1</code>:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">push argument 1</span><br><span class="line">pop static 2</span><br></pre></td></tr></table></figure>
<h3><span id="2the-usage-of-segment">2.The usage of segment</span></h3>
<ul>
<li><p>There&apos;s a lot of semantics going on in the high-level
language:</p>
<ul>
<li>static variables, local variables, argument variables, ...</li>
<li>the <em>object</em> consisting a bundle of variables</li>
</ul></li>
<li><p>We can handle all the semantics using the eight virtual
segments.</p></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/08/7-1-%E7%A8%8B%E5%BA%8F%E7%BC%96%E8%AF%91%E5%89%8D%E7%9E%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/08/7-1-%E7%A8%8B%E5%BA%8F%E7%BC%96%E8%AF%91%E5%89%8D%E7%9E%BB/" class="post-title-link" itemprop="url">7.1.&#x7A0B;&#x5E8F;&#x7F16;&#x8BD1;&#x524D;&#x77BB;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-08 13:24:34" itemprop="dateCreated datePublished" datetime="2024-04-08T13:24:34+08:00">2024-04-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 07:51:48" itemprop="dateModified" datetime="2024-06-03T07:51:48+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-7-VM-Machine/" itemprop="url" rel="index"><span itemprop="name">Module 7.VM Machine</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1><span id="71program-compilation-preview"><span class="math inline">\(7.1.\)</span>Program Compilation Preview</span></h1>
<h3><span id="1problem-in-compilation">1.Problem in compilation</span></h3>
<p>&#x2003;&#x2003;To start with an abstract program and end with something actually
runs on the computer, we need</p>
<ul>
<li>A computer that can run machine language code.</li>
<li>Translating the high level language into machine language.</li>
</ul>
<p><img src="/2024/04/08/7-1-%E7%A8%8B%E5%BA%8F%E7%BC%96%E8%AF%91%E5%89%8D%E7%9E%BB/image.png"></p>
<p>&#x2003;&#x2003;However, there are so many kinds of computers in the world, and
many of them <strong>use different processes, which take different
machine languages</strong>. It seems that we have to develop many
compilers, one for each processor. This is very annoying.</p>
<p>&#x2003;&#x2003;Luckily, this &quot;write once fix everywhere&quot; can be replaced by a
&quot;write once run everywhere&quot; process.</p>
<h3><span id="2-2-tier-compilation">2. 2-Tier compilation</span></h3>
<p>&#x2003;&#x2003;Let&apos;s take Java as example:</p>
<ul>
<li><p>The first tier: also called <em>the top tier</em></p>
<ul>
<li><p>Java compiler translates the Java program into VM code.</p>
<ul>
<li>The VM code is designed to run on an abstract artifact called
<em>virtual machine</em>.</li>
<li>It&apos;s not a real computer, so if we want to execute the code, we have
to translate it further into machine language and realize it on real
hardware (computer, for example).</li>
</ul></li>
</ul></li>
</ul>
<p><img src="/2024/04/08/7-1-%E7%A8%8B%E5%BA%8F%E7%BC%96%E8%AF%91%E5%89%8D%E7%9E%BB/image-1.png"></p>
<ul>
<li><p>The second tier:</p>
<ul>
<li>We equip the target device with <em>JVM</em>, the Java machine
implementation.</li>
<li>The JVM is a program that takes VM code and translates it into the
target code of the target platform.</li>
<li>We need such translator <strong>for every platform on which we want
to execute VM program</strong>.</li>
</ul></li>
</ul>
<p><img src="/2024/04/08/7-1-%E7%A8%8B%E5%BA%8F%E7%BC%96%E8%AF%91%E5%89%8D%E7%9E%BB/image-2.png"></p>
<p>&#x2003;&#x2003;The gap between high-level language (Java, for example) and
low-level language is huge. But by <strong>introducing an intermediate
level</strong>, we <strong>decouple this process into two separate
standalone sub-processes</strong>: the compiler of <em>VM compiler</em>
and <em>VM implementation</em>.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/07/6-5-Hack%E6%B1%87%E7%BC%96%E5%99%A8%E5%BC%80%E5%8F%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/07/6-5-Hack%E6%B1%87%E7%BC%96%E5%99%A8%E5%BC%80%E5%8F%91/" class="post-title-link" itemprop="url">6.5.Hack&#x6C47;&#x7F16;&#x5668;&#x5F00;&#x53D1;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-07 18:24:54" itemprop="dateCreated datePublished" datetime="2024-04-07T18:24:54+08:00">2024-04-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 00:05:51" itemprop="dateModified" datetime="2024-06-03T00:05:51+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-6-Assembler/" itemprop="url" rel="index"><span itemprop="name">Module 6.Assembler</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1><span id="65developing-a-hack-assembler"><span class="math inline">\(6.5.\)</span>Developing a Hack Assembler</span></h1>
<h3><span id="1start-reding-a-file">1.Start reding a file</span></h3>
<p>&#x2003;&#x2003;In general, this part:</p>
<ul>
<li>Need to be able to read the input and break it into parts.</li>
<li>Doesn&apos;t need to understand what the command means or how it will be
translated into machine language.</li>
<li>Need to understand the format of the input language and how it
breaks into different components.</li>
</ul>
<p>&#x2003;&#x2003;In detail, we may divide it into several parts:</p>
<ol type="1">
<li><p>Read a file with a given name.</p>
<ul>
<li>You may want a constructor to be able to accept the file name and
then open the file for reading.</li>
</ul></li>
<li><p>Move to next command in the file:</p>
<ol type="1">
<li>Are we finished? <code>boolean hasMoreCommands()</code></li>
<li>Get the next command: <code>void advance()</code></li>
<li>Read into one line into some kind of string.</li>
<li>Skip white space including comments.</li>
</ol></li>
<li><p>Get the fields of the current command</p>
<ul>
<li>Type of command (A, C, or label)</li>
</ul></li>
</ol>
<p><img src="/2024/04/07/6-5-Hack%E6%B1%87%E7%BC%96%E5%99%A8%E5%BC%80%E5%8F%91/image.png"></p>
<h3><span id="2translating-mnemonic-tocode">2.Translating mnemonic to
code</span></h3>
<p>&#x2003;&#x2003;In general, this part:</p>
<ul>
<li><p>Don&apos;t need to worry about how the mnemonic fields were
obtained.</p>
<ul>
<li>No need to know what part of input line it is, etc.</li>
</ul></li>
</ul>
<p>&#x2003;&#x2003;In detail, we:</p>
<ol type="1">
<li>Ask the parser to give us the string that corresponds to each part
of the field.</li>
<li>Once we get the three string, we go to the code object to translate
each one of them separately according to the known table.</li>
<li>Concatenate the output together.</li>
</ol>
<p><img src="/2024/04/07/6-5-Hack%E6%B1%87%E7%BC%96%E5%99%A8%E5%BC%80%E5%8F%91/image-1.png"></p>
<h3><span id="3the-symbol-table">3.The symbol table</span></h3>
<p>&#x2003;&#x2003;In general, this part:</p>
<ul>
<li>Don&apos;t need to know what the symbols mean.</li>
<li>Need to maintain the association between a symbol and a memory
address.</li>
</ul>
<p>&#x2003;&#x2003;In detail, we need to be able to:</p>
<ol type="1">
<li>Create an new empty table</li>
<li>Add a (symbol, address) pair to the table</li>
<li>Does the table contain a given symbol?</li>
<li>What is the address associated with a given symbol?</li>
</ol>
<p>&#x2003;&#x2003;And do the following things:</p>
<ol type="1">
<li><p>Create a new empty table</p></li>
<li><p>Add all the pre-defined symbols to the table</p></li>
<li><p>While reading the input, add labels and new variables to the
table</p>
<ul>
<li><p>Labels: when you see a <code>&quot;(xxx)&quot;</code> command,add
<code>&quot;xxx&quot;</code> and the address of the next machine language
command</p>
<ul>
<li>Comment 1: this requires maintaining this running address (line
number).</li>
<li>Comment 2: this may need to be done in a first pass</li>
</ul></li>
<li><p>Variables: when you see an <code>&quot;@xxx&quot;</code> command, where
<code>&quot;xxx&quot;</code> is not a number and not already in the table, add
<code>&quot;xxx&quot;</code> and the next free address for variable
allocation</p></li>
</ul></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/07/6-4-%E7%AC%A6%E5%8F%B7%E7%9A%84%E5%A4%84%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/07/6-4-%E7%AC%A6%E5%8F%B7%E7%9A%84%E5%A4%84%E7%90%86/" class="post-title-link" itemprop="url">6.4.&#x7B26;&#x53F7;&#x7684;&#x5904;&#x7406;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-07 15:34:54" itemprop="dateCreated datePublished" datetime="2024-04-07T15:34:54+08:00">2024-04-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 00:00:56" itemprop="dateModified" datetime="2024-06-03T00:00:56+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-6-Assembler/" itemprop="url" rel="index"><span itemprop="name">Module 6.Assembler</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1><span id="64handling-the-symbol"><span class="math inline">\(6.4.\)</span>Handling the Symbol</span></h1>
<h3><span id="1type-of-symbol">1.Type of symbol</span></h3>
<p>&#x2003;&#x2003;Generally there are three types of symbol:</p>
<ul>
<li><em>Variable symbols</em>: Which represents memory locations where
the programmer wants to maintain values.</li>
<li><em>Label symbols</em>: Which represents destinations of goto
instructions.</li>
<li><em>Pre-defined symbols</em>: Which represents special memory
lorations.</li>
</ul>
<h3><span id="2pre-define-symbolstranslation">2.Pre-define symbols
translation</span></h3>
<ul>
<li>These symbols exist only <strong>in the context of A
instructions</strong>. So they will only be seen in expression like
<code>@preDefinedSymbol</code></li>
<li>Translating <code>@preDefinedSymbol</code>: Replace
<code>preDefineSymbol</code> with its corresponding value:</li>
</ul>
<p><img src="/2024/04/07/6-4-%E7%AC%A6%E5%8F%B7%E7%9A%84%E5%A4%84%E7%90%86/image.png"></p>
<h3><span id="3label-symbols-translation">3.Label symbols translation</span></h3>
<p>&#x2003;&#x2003;To begin with, there are two sorts of label:</p>
<ul>
<li>Used to label destination of <code>goto</code> commands. For
example, <code>@STOP, 0;JMP</code></li>
<li>Declared by the <em>pseudo-command</em>. For example,
<code>(STOP)</code></li>
</ul>
<blockquote>
<p>This is called pseudo-commands because <strong>it doesn&apos;t generate
any code</strong>. When we translate the program into binary. we don&apos;t
translate the label declaration instructions.</p>
</blockquote>
<p>&#x2003;&#x2003;To allocate a specific location to each label, we
<strong>number</strong> the instruction one by one, like the left hand
side:</p>
<p><img src="/2024/04/07/6-4-%E7%AC%A6%E5%8F%B7%E7%9A%84%E5%A4%84%E7%90%86/image-1.png"></p>
<ul>
<li>We ignore <strong>white space and pseudo-commands</strong> when
numbering.</li>
</ul>
<p>&#x2003;&#x2003;Once we complete the numbering, we can <strong>refer the label to
its corresponding line number</strong>. For example, <code>LOOP</code>
relates to 4 and <code>STOP</code> relates to 18. And when we see the
instruction <code>@LOOP</code>, we actually mean <code>@4</code>.</p>
<p>&#x2003;&#x2003;After this pre-work, the translating is plain: * Translating
<code>@labelSymbol</code>: Replace <code>labelSymbol</code> with its
value.</p>
<h3><span id="4varables-translation">4.Varables translation</span></h3>
<ul>
<li>Any symbol xx appearing in an assembly program which <strong>is not
pre-defined</strong> and <strong>is not defined elsewhere using the
(xxx) directive</strong> is treated as a variable</li>
<li>if a variable appears in the program for the first time, we allocate
it to a memory address <strong>starting from address 16</strong> . If we
see this varable popping up later in the program, we simply <strong>look
up the value that you assigned to it before</strong>.</li>
</ul>
<h3><span id="5symbol-table-construction">5.Symbol table construction</span></h3>
<h4><span id="afirstpass">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>First
pass</span></h4>
<p>&#x2003;&#x2003;In the <em>first pass</em>, we extract from the program <strong>all
the label symbols</strong>.</p>
<ul>
<li><p>Before starting any translation, create an empty table and add
all the predefined symbos one by one.</p></li>
<li><p>March through the entire text file that constitutes the source
assembly program:</p>
<ul>
<li><p>Only <strong>look for label declarations</strong></p>
<ul>
<li>Line of code that begins with left parenthesis.</li>
</ul></li>
<li><p>Meanwhile keep track of how many lines you&apos;ve read so far (only
count real instructions).</p></li>
</ul></li>
</ul>
<p><img src="/2024/04/07/6-4-%E7%AC%A6%E5%8F%B7%E7%9A%84%E5%A4%84%E7%90%86/image-2.png"></p>
<h4><span id="bsecondpass">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Second
pass</span></h4>
<ul>
<li>We start once again to scan the entire program.</li>
<li>Whenever we see a symbol <strong>which doesn&apos;t appear in the symbol
table</strong>, we add it to the table, assign to it <code>16</code> or
larger number (for it must be a varable).</li>
<li>If we find them in the symbol table, then they&apos;ve been declared and
we can use them.</li>
</ul>
<h4><span id="cmore-about-the-table">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>More about the table</span></h4>
<ul>
<li>When resolving a symbol, we look it up in the table, retrieve its
value, and put it into the instruction. What you get is <strong>the
meaning of this symbol</strong> according to the symbol table.</li>
<li>We maintain the table as long as the assembler is processing the
program, and then we can toss it away.</li>
</ul>
<h3><span id="6summary-the-assemblyprocess">6.Summary: The assembly
process</span></h3>
<ul>
<li><p><em>Initialization</em>:</p>
<ul>
<li>Construct an empty symbol table,</li>
<li>Add the pre-defined symbols to the symbol table,</li>
</ul></li>
<li><p><em>First pass</em>:</p>
<ul>
<li><p>Scan the entire program;</p></li>
<li><p>For each &quot;instruction&quot; of the form <code>(xxx)</code>:</p>
<ul>
<li>Add the pair (xxx, address) to the symbol table, where
<em>address</em> is <strong>the number of the instruction following
<code>(xxx)</code></strong>.</li>
</ul></li>
</ul></li>
<li><p><em>Second pass</em>:</p>
<ul>
<li><p>Set n to 16</p></li>
<li><p>Scan the entire program again, for each instruction:</p>
<ul>
<li><p>If the instruction is <code>@symbol</code>, look up symbol in the
symbol table:</p>
<ul>
<li><p>If (symbol, value) is found, use value to complete the
instruction&apos;s translation;</p></li>
<li><p>If not found:</p>
<ul>
<li>Add (symbol, n) to the symbol table,</li>
<li>Use n to complete the instruction&apos;s translation,</li>
<li>n++</li>
</ul></li>
</ul></li>
</ul></li>
<li><p>If the instruction is a C-instruction, complete the instruction&apos;s
translation.</p></li>
<li><p>Write the translated instruction to the output file.</p></li>
</ul></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/07/5-5-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AE%9E%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/07/5-5-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AE%9E%E7%8E%B0/" class="post-title-link" itemprop="url">5.5.Hack&#x8BA1;&#x7B97;&#x673A;&#x5B9E;&#x73B0;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-07 10:24:34" itemprop="dateCreated datePublished" datetime="2024-04-07T10:24:34+08:00">2024-04-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 23:52:32" itemprop="dateModified" datetime="2024-06-02T23:52:32+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-5-Computer-Architecture/" itemprop="url" rel="index"><span itemprop="name">Module 5. Computer Architecture</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1><span id="55hack&#x8BA1;&#x7B97;&#x673A;&#x5B9E;&#x73B0;&#x7B14;&#x8BB0;"><span class="math inline">\(5.5.\)</span>Hack&#x8BA1;&#x7B97;&#x673A;&#x5B9E;&#x73B0;&#x7B14;&#x8BB0;</span></h1>
<h3><span id="1cpu&#x5B9E;&#x73B0;">1.CPU&#x5B9E;&#x73B0;</span></h3>
<p><img src="/2024/04/07/5-5-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AE%9E%E7%8E%B0/image.png"></p>
<h4><span id="a&#x6307;&#x4EE4;&#x8BC6;&#x522B;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&#x6307;&#x4EE4;&#x8BC6;&#x522B;</span></h4>
<ul>
<li><code>instruction[15]</code>:&#x7528;&#x4E8E;<strong>&#x5224;&#x65AD;&#x662F;&#x5426;&#x4E3A;<code>A</code>&#x6307;&#x4EE4;</strong>&#x3002;</li>
<li><code>instruction[12]</code>&#x7528;&#x4E8E;<strong>&#x9009;&#x62E9;ALU&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x8F93;&#x5165;&#x6765;&#x6E90;</strong>&#x3002;&#x5F53;<code>instruction[12] = 0</code>&#x65F6;&#xFF0C;ALU&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x8F93;&#x5165;&#x4E3A;<code>A</code>&#x5BC4;&#x5B58;&#x5668;&#xFF1B;&#x5426;&#x5219;&#x4E3A;&#x5B58;&#x50A8;&#x5668;&#x7684;&#x8F93;&#x5165;&#x6570;&#x636E;<code>inM</code>&#x3002;</li>
<li><code>instruction[6:11]</code>:&#x7528;&#x4E8E;<strong>&#x63A7;&#x5236;ALU&#x7684;&#x64CD;&#x4F5C;</strong>&#x3002;</li>
<li><code>instruction[5]</code>:&#x5F53;<code>instruction[15] = 0</code>&#x65F6;&#xFF0C;<code>instruction[5]</code><strong>&#x5C31;&#x662F;<code>A</code>&#x6307;&#x4EE4;&#x7684;&#x4E00;&#x90E8;&#x5206;</strong>&#xFF1B;&#x5426;&#x5219;&#xFF0C;&#x5B83;&#x5C31;&#x662F;<code>C</code>&#x6307;&#x4EE4;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x3002;</li>
<li><code>instruction[4]</code>:&#x7528;&#x4E8E;<strong>&#x9009;&#x62E9;ALU&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x8F93;&#x5165;</strong>&#x3002;&#x5F53;<code>instruction[4] = 1</code>&#x65F6;&#xFF0C;&#x6211;&#x4EEC;<strong>&#x5C06;&#x5185;&#x5B58;&#x4E2D;&#x8BFB;&#x53D6;&#x7684;&#x6570;&#x636E;&#x4F5C;&#x4E3A;ALU&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x8F93;&#x5165;(&#x5373;<code>inM</code>)</strong>&#xFF1B;&#x5426;&#x5219;<strong>&#x5C06;<code>A</code>&#x5BC4;&#x5B58;&#x5668;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x4F5C;&#x4E3A;ALU&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x8F93;&#x5165;</strong>&#x3002;</li>
<li><code>instruction[3]</code>:&#x7528;&#x4E8E;<strong>&#x6307;&#x793A;&#x662F;&#x5426;&#x8981;&#x5411;&#x6570;&#x636E;&#x5185;&#x5B58;&#x5199;&#x5165;&#x6570;&#x636E;</strong>&#x3002;&#x5F53;<code>instruction[3] = 1</code>&#x65F6;&#xFF0C;&#x8868;&#x793A;&#x8981;&#x5411;&#x6570;&#x636E;&#x5185;&#x5B58;&#x4E2D;&#x5199;&#x5165;&#x6570;&#x636E;(&#x5373;<code>writeM = 1</code>)&#xFF1B;&#x5426;&#x5219;&#x4E0D;&#x5BF9;&#x6570;&#x636E;&#x5185;&#x5B58;&#x8FDB;&#x884C;&#x5199;&#x5165;&#x64CD;&#x4F5C;&#x3002;</li>
<li><code>C</code>&#x6307;&#x4EE4;&#x5BF9;&#x5E94;&#x7684;16&#x4F4D;&#x6307;&#x4EE4;&#xFF1A;</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 c1 c2 c3 c4 c5 c6 d1 d2 d3 j1 j2 j3</span><br></pre></td></tr></table></figure>
<ul>
<li><code>A</code>&#x6307;&#x4EE4;&#x5BF9;&#x5E94;&#x7684;16&#x4F4D;&#x6307;&#x4EE4;</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 address[14:0]</span><br></pre></td></tr></table></figure>
<h4><span id="ba&#x5BC4;&#x5B58;&#x5668;&#x5904;&#x7406;">&#x2003;&#x2003;<span class="math inline">\(b.\)</span><code>A</code>&#x5BC4;&#x5B58;&#x5668;&#x5904;&#x7406;</span></h4>
<figure>
<img src="/2024/04/07/5-5-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AE%9E%E7%8E%B0/image-1.png" alt="Alt text">
<figcaption aria-hidden="true">Alt text</figcaption>
</figure>
<ol type="1">
<li>&#x8F93;&#x5165;&#x7684;16&#x4F4D;&#x6307;&#x4EE4;&#x548C;ALU&#x7684;&#x8F93;&#x51FA;&#x7ECF;&#x8FC7;<code>Mux16</code>&#x4F5C;&#x4E3A;<code>A</code>&#x5BC4;&#x5B58;&#x5668;&#x7684;&#x8F93;&#x5165;&#xFF1A;</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mux16(a = instruction, b = ALUOut, sel = instruction[15], out = Ain);</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>&#x5728;&#x540E;&#x9762;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x77E5;&#x9053;&#x6307;&#x4EE4;&#x662F;&#x5426;&#x4E3A;<code>A</code>&#x6307;&#x4EE4;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x7528;&#x4E00;&#x4E2A;pin&#x6765;&#x8BB0;&#x5F55;&#xFF1A;</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Not(in = instruction[15], out = NotA);</span><br></pre></td></tr></table></figure>
<ol start="3" type="1">
<li><p>&#x5224;&#x65AD;&#x662F;&#x5426;&#x9700;&#x8981;&#x5C06;&#x6307;&#x4EE4;&#x52A0;&#x8F7D;&#x5230;<code>A</code>&#x5BC4;&#x5B58;&#x5668;&#x4E2D;&#x3002;&#x6B64;&#x65F6;&#x6709;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#xFF1A;</p>
<ol type="1">
<li>&#x5F53;&#x524D;&#x6307;&#x4EE4;&#x4E0D;&#x662F;<code>A</code>&#x6307;&#x4EE4;&#xFF0C;&#x5219;&#x9009;&#x62E9;&#x52A0;&#x8F7D;&#x3002;</li>
<li>&#x5F53;&#x524D;&#x6307;&#x4EE4;&#x4E3A;<code>A</code>&#x6307;&#x4EE4;&#xFF0C;&#x4F46;&#x662F;<code>instruction[5] = 1</code>(&#x8BE5;&#x4F4D;&#x7F6E;&#x7528;&#x4E8E;&#x5B58;&#x50A8;<code>A</code>&#x6307;&#x4EE4;&#x6709;&#x5173;&#x4FE1;&#x606F;)&#xFF0C;&#x5219;&#x9009;&#x62E9;&#x52A0;&#x8F7D;&#xFF1A;</li>
</ol></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Or(a = NotA, b = instruction[5] , out=loadA);</span><br><span class="line">ARegister(in = Ain, load = loadA, out = Aout, out[0..14] = addressM);</span><br></pre></td></tr></table></figure>
<h4><span id="calu&#x8FD0;&#x7B97;">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>ALU&#x8FD0;&#x7B97;</span></h4>
<p><img src="/2024/04/07/5-5-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AE%9E%E7%8E%B0/image-2.png"></p>
<ol type="1">
<li>&#x6211;&#x4EEC;&#x5148;&#x5904;&#x7406;ALU&#x7684;&#x4E24;&#x4E2A;&#x8F93;&#x5165;&#x6E90;&#xFF0C;&#x5176;&#x4E2D;&#x7B2C;&#x4E8C;&#x4E2A;&#x8F93;&#x5165;&#x6E90;&#x7531;<code>C</code>&#x6307;&#x4EE4;&#x96C6;&#x7684;<code>instruction[12]</code>&#x63A7;&#x5236;&#xFF1A;</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Mux16(a = Aout, b = inM, sel = instruction[12], out = AMout);</span><br><span class="line">And(a = instruction[15], b = instruction[4], out = loadD);</span><br><span class="line">DRegister(in = ALUOut, load = loadD, out = Dout);</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x6839;&#x636E;&#x5148;&#x524D;&#x7684;&#x6307;&#x4EE4;&#x8BC6;&#x522B;&#x8FDB;&#x884C;ALU&#x8FD0;&#x7B97;&#x5E76;&#x8F93;&#x51FA;&#xFF1A;</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">And(a = instruction[11], b = instruction[15], out = zx);</span><br><span class="line">And(a = instruction[10], b = instruction[15], out = nx);</span><br><span class="line">Or(a = instruction[9], b = NotA, out = zy);</span><br><span class="line">Or(a = instruction[8], b = NotA, out = ny);</span><br><span class="line">And(a = instruction[7], b = instruction[15], out = f);</span><br><span class="line">And(a = instruction[6], b = instruction[15], out = no);</span><br><span class="line"></span><br><span class="line">ALU(x = Dout, y = AMout, zx = zx, nx = nx, zy = zy, ny = ny, f = f, no = no, out = outM, out = ALUOut, zr = zero, ng = nega);</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>zy</code>&#x548C;<code>ny</code>&#x63A7;&#x5236;&#x4FE1;&#x53F7;&#x5728;<code>A</code>&#x6307;&#x4EE4;&#x65F6;&#x88AB;&#x5F3A;&#x5236;&#x4E3A;1&#x662F;&#x4E3A;&#x4E86;<strong>&#x786E;&#x4FDD;ALU&#x7684;&#x8F93;&#x5165;&#x5728;&#x5904;&#x7406;<code>A</code>&#x6307;&#x4EE4;&#x65F6;&#x88AB;&#x7B80;&#x5316;&#x4E0E;&#x56FA;&#x5B9A;&#xFF0C;&#x4E0D;&#x53D7;<code>C</code>&#x6307;&#x4EE4;&#x63A7;&#x5236;&#x4F4D;&#x7684;&#x5F71;&#x54CD;</strong>&#xFF0C;&#x4ECE;&#x800C;&#x907F;&#x514D;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x8BA1;&#x7B97;&#x3002;</p>
</blockquote>
<ol start="3" type="1">
<li>&#x4E4B;&#x540E;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x6267;&#x884C;<code>C</code>&#x6307;&#x4EE4;&#x96C6;&#x7684;&#x8DF3;&#x8F6C;&#x903B;&#x8F91;&#x3002;&#x6211;&#x4EEC;&#x6839;&#x636E;<strong>ALU&#x8BA1;&#x7B97;&#x7ED3;&#x679C;&#x548C;&#x6307;&#x4EE4;&#x4E2D;&#x7684;&#x8DF3;&#x8F6C;&#x4F4D;</strong>&#x6765;&#x51B3;&#x5B9A;&#x662F;&#x5426;&#x8DF3;&#x8F6C;&#x3002;</li>
</ol>
<p>&#x2003;&#x2003;&#x9996;&#x5148;&#x5BF9;<code>C</code>&#x6307;&#x4EE4;&#x96C6;&#x7684;&#x8DF3;&#x8F6C;&#x4F4D;&#x8FDB;&#x884C;&#x660E;&#x6670;&#xFF1A;</p>
<ul>
<li><code>instruction[0]</code>&#x5BF9;&#x5E94;<code>JGT</code>&#xFF0C;&#x5F53;ALU&#x8F93;&#x51FA;&#x4E3A;&#x6B63;&#x6570;&#x65F6;&#x8DF3;&#x8F6C;&#x3002;</li>
<li><code>instruction[1]</code>&#x5BF9;&#x5E94;<code>JEQ</code>&#xFF0C;&#x5F53;ALU&#x8F93;&#x51FA;&#x4E3A;0&#x65F6;&#x8DF3;&#x8F6C;&#x3002;</li>
<li><code>instruction[2]</code>&#x5BF9;&#x5E94;<code>JLT</code>&#xFF0C;&#x5F53;ALU&#x8F93;&#x51FA;&#x4E3A;&#x8D1F;&#x6570;&#x65F6;&#x8DF3;&#x8F6C;&#x3002;</li>
</ul>
<p>&#x2003;&#x2003;&#x4E8E;&#x662F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5199;&#x51FA;&#x4EE5;&#x4E0B;&#x4EE3;&#x7801;&#xFF1A;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Or(a = zero, b = nega, out = notpos);</span><br><span class="line">Not(in = notpos, out = pos);</span><br><span class="line">&#xA0; &#xA0; </span><br><span class="line">And(a = instruction[0], b = pos, out = out3);</span><br><span class="line">And(a = instruction[1], b = zero, out = out2);</span><br><span class="line">And(a = instruction[2], b = nega, out = out1);</span><br><span class="line"></span><br><span class="line">Or(a = out1, b = out2, out = out12);</span><br><span class="line">Or(a = out12, b = out3, out = out123);</span><br><span class="line"></span><br><span class="line">And(a = out123, b = instruction[15], out = jump);</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>pos</code>, <code>nega</code>,
<code>zero</code>&#x5206;&#x522B;&#x4EE3;&#x8868;&#x6B63;&#x6570;&#x3001;&#x8D1F;&#x6570;&#x548C;&#x6070;&#x597D;&#x4E3A;0&#x3002;&#x5E76;&#x4E14;&#x6CE8;&#x610F;&#x9664;&#x4E86;&#x6EE1;&#x8DB3;&#x8DF3;&#x8F6C;&#x6761;&#x4EF6;&#x5916;&#xFF0C;&#x8FD8;&#x9700;&#x8981;<strong>&#x786E;&#x4FDD;&#x5F53;&#x524D;&#x662F;<code>C</code>&#x6307;&#x4EE4;</strong>&#x3002;</p>
</blockquote>
<ol start="4" type="1">
<li>&#x6700;&#x540E;&#x6211;&#x4EEC;&#x8C03;&#x7528;<code>PC</code>&#x4EE5;&#x5B58;&#x50A8;&#x5E76;&#x66F4;&#x65B0;&#x5F53;&#x524D;&#x6307;&#x4EE4;&#x7684;&#x5730;&#x5740;&#xFF1A;</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PC(in = Aout, load = jump, reset = reset, inc = true, out[0..14] = pc);</span><br></pre></td></tr></table></figure>
<h3><span id="2&#x5185;&#x5B58;&#x5B9E;&#x73B0;">2.&#x5185;&#x5B58;&#x5B9E;&#x73B0;</span></h3>
<p>&#x2003;&#x2003;&#x5185;&#x5B58;&#x5B9E;&#x73B0;&#x8F83;&#x4E3A;&#x7B80;&#x5355;&#xFF0C;&#x6839;&#x636E;&#x4F20;&#x5165;&#x7684;15&#x4F4D;&#x5730;&#x5740;<code>address</code>&#x7684;&#x540E;&#x4E24;&#x4F4D;&#x4EE5;&#x53CA;<code>load</code>&#x6765;&#x8C03;&#x63A7;RAM&#x3001;&#x5C4F;&#x5E55;&#x4EE5;&#x53CA;&#x952E;&#x76D8;&#x5373;&#x53EF;&#x3002;</p>
<ul>
<li><code>01 and load: RAMLoad</code></li>
<li><code>10 and load: SCRLoad</code></li>
<li><code>11 and load and other digit 0: KEYLoad</code></li>
</ul>
<h3><span id="3hack&#x8BA1;&#x7B97;&#x673A;&#x5B9E;&#x73B0;">3.Hack&#x8BA1;&#x7B97;&#x673A;&#x5B9E;&#x73B0;</span></h3>
<p><img src="/2024/04/07/5-5-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AE%9E%E7%8E%B0/image-3.png"></p>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x6839;&#x636E;&#x8BA1;&#x7B97;&#x673A;&#x7684;&#x7ED3;&#x6784;&#xFF0C;&#x5BF9;&#x5DF2;&#x6709;&#x82AF;&#x7247;&#x8FDB;&#x884C;&#x63A5;&#x7EBF;&#x5373;&#x53EF;&#xFF1A;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CPU(inM = MemoryOut, instruction = Rominstruction, reset = reset, outM = CPUoutM, writeM = CPUload, addressM = CPUaddress, pc = CPUpc);</span><br><span class="line">Memory(in = CPUoutM, load = CPUload, address = CPUaddress, out = MemoryOut);</span><br><span class="line">ROM32K(address = CPUpc, out = Rominstruction);</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/07/6-1-%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E4%B8%8E%E7%A8%8B%E5%BA%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/07/6-1-%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E4%B8%8E%E7%A8%8B%E5%BA%8F/" class="post-title-link" itemprop="url">6.1.&#x6C47;&#x7F16;&#x8BED;&#x8A00;&#x4E0E;&#x7A0B;&#x5E8F;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-07 09:34:24" itemprop="dateCreated datePublished" datetime="2024-04-07T09:34:24+08:00">2024-04-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 07:47:54" itemprop="dateModified" datetime="2024-06-03T07:47:54+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-6-Assembler/" itemprop="url" rel="index"><span itemprop="name">Module 6.Assembler</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1><span id="61assemble-program-and-assembler"><span class="math inline">\(6.1.\)</span>Assemble Program and Assembler</span></h1>
<h3><span id="1basic-assembler-logic">1.Basic assembler logic</span></h3>
<ul>
<li><p>Repeat:</p>
<ul>
<li>Read the next Assembly language command.</li>
<li>Break it into the different fields it is composed of.</li>
<li>Lookup the binary code for each field.</li>
<li>Combine these codes into a single machine language command.</li>
<li>Output this machine language command.</li>
</ul></li>
<li><p>One thing we need to worry about: <em>Symbols</em>:</p>
<ul>
<li><p>Two cases:</p>
<ul>
<li><em>Labels</em>: When jumping into a certain part, you give it a
name instead of hard core the address. <code>JMP loop</code></li>
<li><em>Variables</em>: You give a variable name rather than always
refer to its exact address in memory. <code>load R1, weight</code></li>
</ul></li>
<li><p>To convert it into concrete address, we use a <em>symbol
table</em>:</p></li>
</ul></li>
</ul>
<p><img src="/2024/04/07/6-1-%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E4%B8%8E%E7%A8%8B%E5%BA%8F/image.png"></p>
<ul>
<li><p>To maintain such table:</p>
<ul>
<li>When we first meet a symbol, we need to <strong>allocate a new
memory location</strong> to hold it. For the assembler, it will find the
<strong>next memory location that&apos;s available</strong>.</li>
<li>When we meet it again, we simply refer to its address in the
table.</li>
</ul></li>
<li><p>One special case: <em>Forward references</em>: We can jump into a
label before where it was defined. There are two ways to handle it:</p>
<ol type="1">
<li>Use a little bit to remember that we&apos;ve set the labels but don&apos;t
know where it is yet. We leave it blank until label appears.(more
complicated)</li>
<li>In first pass just figure out all address.</li>
</ol></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/06/5-4-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/06/5-4-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA/" class="post-title-link" itemprop="url">5.4.Hack&#x8BA1;&#x7B97;&#x673A;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-06 11:34:24" itemprop="dateCreated datePublished" datetime="2024-04-06T11:34:24+08:00">2024-04-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 23:47:54" itemprop="dateModified" datetime="2024-06-02T23:47:54+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-5-Computer-Architecture/" itemprop="url" rel="index"><span itemprop="name">Module 5. Computer Architecture</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1><span id="54hackcomputer"><span class="math inline">\(5.4.\)</span>Hack
Computer</span></h1>
<h3><span id="1hack-computer-abstraction">1.Hack computer abstraction</span></h3>
<ul>
<li>A computer capable of running programs written in the Hack machine
language.</li>
</ul>
<h3><span id="2cpu-operations">2.CPU operations</span></h3>
<p><img src="/2024/04/06/5-4-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA/image.png"></p>
<figure>
<img src="/2024/04/06/5-4-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA/image-1.png" alt="Alt text">
<figcaption aria-hidden="true">Alt text</figcaption>
</figure>
<ul>
<li><p>If the instruction includes <code>D And A</code>, CPU is going to
<strong>manipulate the respective D and A registers</strong>.</p></li>
<li><p>If the instruction ia an A instruction like <code>@17</code>, CPU
is going to <strong>take the 15-bit data value and store them inside the
A register</strong>. This value is <strong>emitted by
<code>addressM</code></strong>.</p></li>
<li><p>If the instruction&apos;s <em>right hand side</em> includes
<code>M</code> like <code>M = M + 1</code>, this value is <strong>read
from <code>inM</code> interface</strong>.</p></li>
<li><p>If the instruction&apos;s <em>left hand side</em> includes
<code>M</code>, then the value output should be stored in the data
memory of the selected memory register.</p>
<ul>
<li>As we discuss in the CPU, we have to provide <strong>what things we
want to write, where to write and the control bits</strong> to write
something to the data memory. As a result, <strong>the ALU output is
emitted by <code>outM</code>, and the <code>writeM</code> is
asserted</strong>.</li>
</ul></li>
<li><p>If we have a jump situation <code>@100, D = D - 1; JEQ</code>. ,
we want to jump to the address that was specified before(100, in this
case):</p>
<ul>
<li>If <code>reset == 0</code>, CPU logic uses <strong>the jump bits and
the ALU output</strong> to decide whether or not there should be a
jump.</li>
<li>If there is a jump, <code>PC = A</code></li>
<li>Else, <code>PC++</code></li>
<li>The updated <code>PC</code> value <strong>is emitted by
<em>pc</em></strong>.</li>
<li>If <code>reset == 1</code>, <em>pc</em> emits <code>0</code>,
causing a program restart</li>
</ul></li>
</ul>
<h3><span id="3memory-abstraction">3.Memory abstraction</span></h3>
<figure>
<img src="/2024/04/06/5-4-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA/image-2.png" alt="Alt text">
<figcaption aria-hidden="true">Alt text</figcaption>
</figure>
<ul>
<li><p>Three different segments:</p>
<ul>
<li>Address 0 to 16383(16k): <em>data memory</em></li>
<li>Address 16384 to 24575(next 8k): <em>screen memory map</em></li>
<li>Address 24576: <em>keyboard memory map</em></li>
</ul></li>
</ul>
<h3><span id="4memory-implementation">4.Memory implementation</span></h3>
<p>&#x2003;&#x2003;We bulid our memory from three different sub-chips:</p>
<ul>
<li><em>RAM:</em> 16-bit 16K RAM chip</li>
<li><em>Screen</em>: 16-bit/8K memory chip with a raster display
side-effect.</li>
<li><em>Keyboard</em>: 16-bit register with a keyboard side-effect.</li>
</ul>
<h4><span id="aram">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>RAM</span></h4>
<p>![[Pasted image 20240406103441.png]]</p>
<ul>
<li>The inputs and outputs of RAM16 are identical to the inputs and
outputs of the overall memory chip.</li>
<li>So whoever builds the chip has to make sure to take the outside
inputs and outputs and <strong>make connections that will funnel these
value into the inner chip box, such as RAM 16K</strong>.</li>
</ul>
<h4><span id="bscreen">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Screen</span></h4>
<p>![[Pasted image 20240406104348.png]]</p>
<ul>
<li>We use a special built-in <em>8K screen chip</em> that knows how to
automatically refresh a connected display unit.
<ul>
<li>It&apos;s a RAM chip, which has a nice side effect of refreshing a
connected display unit.</li>
</ul></li>
</ul>
<h4><span id="ckeyboard">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>Keyboard</span></h4>
<p><img src="/2024/04/06/5-4-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA/image-3.png"></p>
<ul>
<li>We use a built-in Keyboard chip featuring a keyboard capture
side-effect, which is that it always reflects what the user is pressing
on the keyboard.</li>
</ul>
<h3><span id="5instruction-memory">5.Instruction memory</span></h3>
<h4><span id="aintro">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>Intro</span></h4>
<ul>
<li>We implement this instruction memory using a chip called <em>ROM
32K</em>.</li>
</ul>
<p><img src="/2024/04/06/5-4-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA/image-4.png"></p>
<ul>
<li><p>We can <strong>loading a program</strong> in this way:</p>
<ul>
<li><p>Hardware inplementation: <em>plug-and-play ROM chips</em>: We put
our machine instruction code into a ROM chip. We take this RAM chip,
plug it into the computer. We press the <code>reset</code> button, and
the computer will start executing this particular program.</p>
<ul>
<li>If we want to run another program, we take the chip out and plug in
another chip.</li>
</ul></li>
</ul></li>
</ul>
<h4><span id="brominterface">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>ROM
interface</span></h4>
<p><img src="/2024/04/06/5-4-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA/image-5.png"></p>
<ul>
<li>It&apos;s a <strong>read-only</strong> device.</li>
<li>Contains a sequence of Hack instructions (program).</li>
<li>The <em>output</em> of of the ROM is always <strong>the contents of
the register that is selected by the address input</strong>.</li>
<li>Since the <em>pc</em> always emits the address of next instruction,
if we feed this address into ROM, we are guaranteed that ROM will always
admit a 16-bit value that we can treat as the current instruction.</li>
</ul>
<h3><span id="6hack-computerimplementation">6.Hack computer
implementation</span></h3>
<p><img src="/2024/04/06/5-4-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA/image-6.png"></p>
<ul>
<li>We first connect to the CPU <strong>the instruction memory which we
call ROM</strong>. The instruction input of the CPU is taken from the
output of instruction memory.</li>
<li>In the process of executing this instuction, we are going to compute
the address of the next instruction. This address is emitted by
<em>pc</em>.</li>
<li>The address goes all the way into the address of the instruction
unit, and the unit will emit the next instruction that has to be
executed in the next cycle.</li>
</ul>
<p><img src="/2024/04/06/5-4-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA/image-7.png"></p>
<ul>
<li>To do something useful with the outputs, we connect outputs to
<em>memory unit</em>.</li>
<li>We take the output of the memory, and connect it back into the
CPU</li>
</ul>
<p><img src="/2024/04/06/5-4-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA/image-8.png"></p>
<ul>
<li>The input and output units are the only two things the computer
users sees when he works.</li>
<li>With this computer is a display unit, a keyboard and the reset
button.</li>
</ul>
<p><img src="/2024/04/06/5-4-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA/image-9.png"></p>
<p><img src="/2024/04/06/5-4-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA/image-10.png"></p>
<ul>
<li>This is the overall computer architect!!!</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/06/5-2-%E8%8E%B7%E5%8F%96-%E6%89%A7%E8%A1%8C%E5%BE%AA%E7%8E%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/06/5-2-%E8%8E%B7%E5%8F%96-%E6%89%A7%E8%A1%8C%E5%BE%AA%E7%8E%AF/" class="post-title-link" itemprop="url">5.2.&#x83B7;&#x53D6;-&#x6267;&#x884C;&#x5FAA;&#x73AF;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-06 09:44:54" itemprop="dateCreated datePublished" datetime="2024-04-06T09:44:54+08:00">2024-04-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 23:36:00" itemprop="dateModified" datetime="2024-06-02T23:36:00+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-5-Computer-Architecture/" itemprop="url" rel="index"><span itemprop="name">Module 5. Computer Architecture</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1><span id="52the-fetch-execute-cycle"><span class="math inline">\(5.2.\)</span>The Fetch-Execute Cycle</span></h1>
<ul>
<li><em>Fetch an instruction from the program memory</em></li>
<li><em>Execute</em> it</li>
</ul>
<h3><span id="1fetching">1.Fetching</span></h3>
<ul>
<li><p>The next instruction is located at the <em>program memory</em>,
the program memory is in the <em>memory</em>, and its address is
specified by the <em>program counter</em>.</p></li>
<li><p>We need to basically <strong>put the location of the next
instruction into the &quot;address&quot; of the program memory</strong>. Then we
need to read the contents at that location and then will get the basic
instructions we need to execute.</p></li>
<li><p>We usually put the address of the next instruction into the
address input of the program memory by <em>program
counter</em>.</p></li>
</ul>
<p>&#x2003;&#x2003;The hardware cycle of executing the fetch operation is as
below:</p>
<p><img src="/2024/04/06/5-2-%E8%8E%B7%E5%8F%96-%E6%89%A7%E8%A1%8C%E5%BE%AA%E7%8E%AF/image.png"></p>
<ul>
<li>When we need to jump into a new location, we <strong>manipulate the
program counter</strong> so that it will have the address of the next
instruction.</li>
<li>The output of the program counter feeds into the address
specification of program memory.</li>
<li>The program memory output comes the actual instruction code that we
need to execute.</li>
</ul>
<h3><span id="2execute">2.Execute</span></h3>
<ul>
<li><p>The instruction code specifies &quot;what to do&quot;</p>
<ul>
<li>Which arithmetie or logical instruction.</li>
<li>What memory to access (read/write).</li>
<li>If/where to jump.</li>
</ul></li>
<li><p><em>Bit aspect</em>: Execute current instruction means
<strong>taking the bits from the instruction code that specifies what to
do</strong>, and do what needs to be done.</p>
<ul>
<li>Often, different subsets of the bits control different aspects of
the operation</li>
</ul></li>
<li><p><em>Hardware aspect</em>:</p></li>
</ul>
<p><img src="/2024/04/06/5-2-%E8%8E%B7%E5%8F%96-%E6%89%A7%E8%A1%8C%E5%BE%AA%E7%8E%AF/image-1.png"></p>
<ul>
<li><p><em>control bus</em>:</p>
<ul>
<li><p>tells the ALU what instruction to compute,</p></li>
<li><p>tells where do the data pieces come from,</p></li>
</ul></li>
</ul>
<h3><span id="2the-clash">2.The clash</span></h3>
<p>&#x2003;&#x2003;There&apos;s a clash in the cycle above:</p>
<ul>
<li>For <em>fetch</em>, we need to put into the address of the memory
<strong>the address of the next instruction</strong> to get the
instruction output.</li>
<li>For <em>execute</em>, we need to put into the address of the memory
<strong>the address of the data pieces</strong> that we want to operate
on to access data.</li>
<li>But we only have a single memory, so <strong>should we put into the
memory the address of data or instructions</strong>?</li>
</ul>
<p><img src="/2024/04/06/5-2-%E8%8E%B7%E5%8F%96-%E6%89%A7%E8%A1%8C%E5%BE%AA%E7%8E%AF/image-2.png"></p>
<p>&#x2003;&#x2003;To solve this problem, we will do <strong>one after
another</strong>. We will achieve this through a
<em>Multiplexer</em>:</p>
<ul>
<li>In the first part, the <em>fetch cycle</em>, the multiplexer set the
memory to point into <strong>the program counter that is the location of
the next instruction</strong>.</li>
<li>While in the <em>execute cycle</em>, the multiplexer will set the
memory to point into <strong>the data address that we need to
access</strong>.</li>
</ul>
<p>&#x2003;&#x2003;So how do we do this together?</p>
<p><img src="/2024/04/06/5-2-%E8%8E%B7%E5%8F%96-%E6%89%A7%E8%A1%8C%E5%BE%AA%E7%8E%AF/image-3.png"></p>
<ul>
<li>When we are in a <em>fetch cycle</em>, we get the next instruction,
and then we need to <strong>remember it inside an instruction
register</strong>.</li>
<li><strong>That instruction register is exactly what is remains holding
the value of the instruction that we are now executing in the execute
cycle.</strong> Then in the <em>execute cycle</em> we have the
instruction already stored in this register, so we can work with all the
information we need for the cycle.</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/06/5-3-CPU/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/06/5-3-CPU/" class="post-title-link" itemprop="url">5.3.CPU</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-06 09:44:54" itemprop="dateCreated datePublished" datetime="2024-04-06T09:44:54+08:00">2024-04-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 23:41:19" itemprop="dateModified" datetime="2024-06-02T23:41:19+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-5-Computer-Architecture/" itemprop="url" rel="index"><span itemprop="name">Module 5. Computer Architecture</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1><span id="53central-processing-unit"><span class="math inline">\(5.3.\)</span>Central Processing Unit</span></h1>
<h3><span id="1abstraction">1.Abstraction</span></h3>
<p>&#x2003;&#x2003;We can view CPU as <strong>a 16-bit</strong> processor, designed
to:</p>
<ul>
<li><p>Execute the current instruction.</p>
<ul>
<li>This turns the static code into reality.</li>
</ul></li>
<li><p>Figure out which instruction to execute next.</p></li>
</ul>
<h3><span id="2hack-cpu-interface">2.Hack CPU interface</span></h3>
<p><img src="/2024/04/06/5-3-CPU/image.png"></p>
<ul>
<li>CPU is connected both to the <em>instruction memory</em> and to the
<em>data memory</em>.</li>
</ul>
<p>&#x2003;&#x2003;here is the specific input and output connections of the CPU:</p>
<p><img src="/2024/04/06/5-3-CPU/image-1.png"></p>
<ul>
<li><p>We have three inputs coming from three completely different
sources.</p>
<ul>
<li><p>A 16-bit <em>data value</em>, which is the value of <strong>the
currently selected data memory register</strong>. This is the value CPU
is going to operate on.</p></li>
<li><p>A 16-bit <em>instruction value</em>, which is the value of
<strong>the selected instruction memory register</strong>.</p>
<ul>
<li>Remember that at any given point of time, there is always <strong>a
selected register in the instruction memory</strong>, and a
<strong>selected memory register in the data memory</strong>. So always
something comes into the CPU.</li>
</ul></li>
<li><p>A 1-bit <em>input</em>, which we <strong>decide to call the
reset</strong>.</p></li>
</ul></li>
<li><p>On the right hand side we see the outputs of ALU:</p>
<ul>
<li><p>The ALU specifies 3 different things to write something to the
data memory:</p>
<ol type="1">
<li><em>outM</em>: What we want to write.</li>
<li><em>writeM</em>: A <strong>load bit</strong> that enables the data
memory to write operations.</li>
<li><em>address</em>: Where do we want to write it.</li>
<li><em>pc</em>: It holds the <strong>address of the next
instruction</strong> that has to be fetched and executed in the next
cycle of this computer.</li>
</ol></li>
</ul></li>
</ul>
<h3><span id="3cpu-implementation">3.CPU implementation</span></h3>
<p>&#x2003;&#x2003;The whole CPU hardware diagram is as below:</p>
<p><img src="/2024/04/06/5-3-CPU/image-2.png"></p>
<h4><span id="aainstruction">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>A
instruction</span></h4>
<p><img src="/2024/04/06/5-3-CPU/image-3.png"></p>
<p>&#x2003;&#x2003;This section contains:</p>
<ul>
<li><em>A register</em> called A.</li>
<li><em>An A-instruction input</em> that connects to this register
through a <em>multiplexer</em>.</li>
</ul>
<p>&#x2003;&#x2003;We see that this instruction seeks to load the value
<code>3001</code> into a register. In order to carry out this
instruction, the CPU do:</p>
<ol type="1">
<li>Decode the instruction into <strong>op-code + 15-bit
value</strong>.</li>
<li>Noticing that it is a A instruction, CPU <strong>stores the 15-bit
value in the A-register</strong>.</li>
<li>Take the output of A register and admit it outside.</li>
</ol>
<h4><span id="b-cinstruction">&#x2003;&#x2003;<span class="math inline">\(b.\)</span> C
instruction</span></h4>
<p><img src="/2024/04/06/5-3-CPU/image-4.png"></p>
<p>&#x2003;&#x2003;This section contains:</p>
<ul>
<li>A register.</li>
<li>C instruction.</li>
</ul>
<p>&#x2003;&#x2003;Others is the same as above.</p>
<ul>
<li><p>Say we want to gain an A instruction, we can use the
<em>Mux16</em>:</p>
<ul>
<li>If the instruction input is with an op-code <code>0</code>, we
choose the instruction input.</li>
<li>Otherwise, we choose the ALU input.</li>
</ul></li>
</ul>
<h4><span id="caluoperation">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>ALU
Operation</span></h4>
<p><img src="/2024/04/06/5-3-CPU/image-5.png"></p>
<ul>
<li><p>The inputs of ALU come from:</p>
<ol type="1">
<li><p><em>D register</em></p></li>
<li><p>Either the value of <em>A register</em> or <em>selected memory
register</em>.</p></li>
<li><p><em>Multiplexer</em> takes care of this decision, and the control
bit of it is <strong>one of the bits in the instruction</strong>.</p>
<ul>
<li>The CPU designer has to <strong>choose this bit</strong>, and then
ALU gets the correct input.</li>
</ul></li>
</ol></li>
<li><p>ALU also has <em>6 control bits taken together</em> to
<strong>tell or specify the ALU which operation we want to carry
out</strong>.</p></li>
</ul>
<p><img src="/2024/04/06/5-3-CPU/image-6.png"></p>
<ul>
<li><p>The output of ALU is <strong>simultaneously</strong> fed
into:</p>
<ol type="1">
<li><p><em>D register</em></p></li>
<li><p><em>A register</em></p></li>
<li><p><em>M register</em></p>
<ul>
<li>It goes through a <em>Multiplexer</em>.</li>
</ul></li>
</ol></li>
</ul>
<p>&#x2003;&#x2003;The same ALU is fanned out into 3 different places, so we have the
same ALU output knocking on three different doors. The programmer has to
decide which door to be opened. The decision is made by next field of
bits &#x2014;&#x2014; <em>destination bits</em>:</p>
<ul>
<li>We have 3 destination bits, which decide whether or not open the
<em>D register</em>, <em>A register</em>, <em>M register</em> and the
<em>data memory</em> to accept the ALU output.</li>
</ul>
<h4><span id="dcontrol-abstraction">&#x2003;&#x2003;<span class="math inline">\(d.\)</span>Control abstraction</span></h4>
<p>&#x2003;&#x2003;The computer is loaded with some program, when you push
<code>reset</code>, <strong>the program starts running</strong>.</p>
<p>&#x2003;&#x2003;In our previous chapter, we know that the last three bits of the
instruction is <em>jump bits</em>, which a <code>1</code> represents
unconditional <code>goto</code>. CPU realizes this functionality by
<em>program counter</em></p>
<h5><span id="ipcabstraction">&#x2003;&#x2003;<span class="math inline">\(i.\)</span>PC
abstraction</span></h5>
<ul>
<li><p>Emits <strong>the address of the next instruction</strong>:</p>
<ul>
<li>To start / restart the program&apos;s execution: <code>PC = 0</code>(for
we want to execute the first instruction of the program).</li>
<li>no jump: <code>PC++</code></li>
<li>unconditional <code>goto</code>: <code>PC = A</code></li>
<li>conditional <code>goto</code>: if true <code>PC = A</code> else
<code>PC++</code></li>
</ul></li>
</ul>
<h5><span id="iicontrol-implementation">&#x2003;&#x2003;<span class="math inline">\(ii.\)</span>Control implementation</span></h5>
<p><img src="/2024/04/06/5-3-CPU/image-7.png"></p>
<p><img src="/2024/04/06/5-3-CPU/image-8.png"></p>
<ul>
<li><p>if <code>reset == 1</code>, <code>PC=0</code></p></li>
<li><p>else</p>
<ul>
<li><p>We have to look at the <strong>jump bits</strong> and
simultaneously look at the <strong>ALU output</strong> to decide if we
want to carry out the jump.</p></li>
<li><p><code>load = f(jump bits, ALU control outputs)</code></p>
<ul>
<li>if <code>load == 1</code>, <code>PC = A</code></li>
<li>else <code>PC++</code></li>
</ul></li>
</ul></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/05/4-8-%E6%8C%87%E9%92%88%E3%80%81%E8%BE%93%E5%85%A5%E4%B8%8E%E8%BE%93%E5%87%BA%E6%8E%A7%E5%88%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/05/4-8-%E6%8C%87%E9%92%88%E3%80%81%E8%BE%93%E5%85%A5%E4%B8%8E%E8%BE%93%E5%87%BA%E6%8E%A7%E5%88%B6/" class="post-title-link" itemprop="url">4.8.&#x6307;&#x9488;&#xFF0C;&#x8F93;&#x5165;&#x4E0E;&#x8F93;&#x51FA;&#x63A7;&#x5236;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-05 20:23:44" itemprop="dateCreated datePublished" datetime="2024-04-05T20:23:44+08:00">2024-04-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 23:22:51" itemprop="dateModified" datetime="2024-06-02T23:22:51+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-4-Machine-Language/" itemprop="url" rel="index"><span itemprop="name">Module 4. Machine Language</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1><span id="48pointer-and-input-outputcontrol"><span class="math inline">\(4.8.\)</span>Pointer and Input, Output
Control</span></h1>
<h3><span id="1pointer">1.Pointer</span></h3>
<p>&#x2003;&#x2003;We use <strong>A-instruction</strong> to point to a certain
address. For example: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">//   for(i = 0; i &lt; n; i ++) {</span><br><span class="line">//      arr[i] = -1</span><br><span class="line">//   }</span><br><span class="line"></span><br><span class="line">//   suppose arr = 100 and n = 10</span><br><span class="line"></span><br><span class="line">//initialize</span><br><span class="line">	@100</span><br><span class="line">	D = A</span><br><span class="line">	@arr</span><br><span class="line">	M = D</span><br><span class="line"></span><br><span class="line">	@10</span><br><span class="line">	D = A</span><br><span class="line">	@n</span><br><span class="line">	M = D</span><br><span class="line"></span><br><span class="line">	@i</span><br><span class="line">	M = 0</span><br><span class="line"></span><br><span class="line">//iteration</span><br><span class="line"></span><br><span class="line">(LOOP)</span><br><span class="line">	@i</span><br><span class="line">	D = M</span><br><span class="line">	@n </span><br><span class="line">	D = D - M</span><br><span class="line">	@END</span><br><span class="line">	D;JEQ</span><br><span class="line"></span><br><span class="line">	//RAM[arr + i] = -1</span><br><span class="line">	@i</span><br><span class="line">	D = M</span><br><span class="line">	@arr</span><br><span class="line">	A = D + M</span><br><span class="line">	M = -1</span><br><span class="line">	@i</span><br><span class="line">	M = M + 1</span><br><span class="line">	</span><br><span class="line">	@LOOP</span><br><span class="line">	0;JMP</span><br><span class="line"></span><br><span class="line">	(END)</span><br><span class="line">	@END</span><br><span class="line">	0;JMP</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;The key step in the program is <code>A = D + M, M = -1</code>:</p>
<ul>
<li><p>The <code>A = D + M</code> point the address of <code>arr</code>
to the <strong>base address</strong> of <code>arr</code>(the initial
address, 100) plus i, which match the expression
<code>arr + i</code>.</p></li>
<li><p>By the time we say M equals -1, the register that will be
affected is the register in A address.</p></li>
<li><p>Variables that store memory addresses like <code>arr + i</code>
are called <em>pointers</em>.</p></li>
<li><p>Typical pointer semantics:&quot;set the address register to the
contents of some <strong>memory register</strong>&quot;</p></li>
</ul>
<h3><span id="2screen-input">2.Screen input</span></h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">//for (i = 0; i &lt; n; i ++)</span><br><span class="line">//    draw 16 black pixels at the </span><br><span class="line">//    beginning of row i</span><br><span class="line"></span><br><span class="line">//    addr = SCREEN</span><br><span class="line">//    n = RAM[0]</span><br><span class="line">//    i = 0</span><br><span class="line">//    LOOP:</span><br><span class="line">//    if i &gt; n goto END</span><br><span class="line">//    RAM[addr] = -1 1111111111111111</span><br><span class="line">//    addr = addr + 32</span><br><span class="line">//    i = i + 1</span><br><span class="line">//    goto LOOP</span><br><span class="line"></span><br><span class="line">@SCREEN</span><br><span class="line">D = A</span><br><span class="line">@addr</span><br><span class="line">M = D</span><br><span class="line"></span><br><span class="line">@R0</span><br><span class="line">D = M</span><br><span class="line">@n</span><br><span class="line">M = D</span><br><span class="line"></span><br><span class="line">@i</span><br><span class="line">M = 0</span><br><span class="line"></span><br><span class="line">(LOOP)</span><br><span class="line">	@i</span><br><span class="line">	D = M</span><br><span class="line">	@n</span><br><span class="line">	D = D - M</span><br><span class="line">	@END</span><br><span class="line">	D; JGT</span><br><span class="line"></span><br><span class="line">	@addr</span><br><span class="line">	A = M</span><br><span class="line">	M = -1</span><br><span class="line"></span><br><span class="line">	@i</span><br><span class="line">	M = M + 1</span><br><span class="line">	@32</span><br><span class="line">	D = A</span><br><span class="line">	@addr</span><br><span class="line">	M = M + D</span><br><span class="line">	(LOOP)</span><br><span class="line">	0; JMP</span><br><span class="line">	</span><br><span class="line">(END)</span><br><span class="line">	@END</span><br><span class="line">	0; JMP</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="&#x4E0A;&#x4E00;&#x9875;" aria-label="&#x4E0A;&#x4E00;&#x9875;" href="/page/8/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&#x2026;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" title="&#x4E0B;&#x4E00;&#x9875;" aria-label="&#x4E0B;&#x4E00;&#x9875;" href="/page/10/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">



  <div class="copyright">
    &#xA9; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">fyerfyer</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="&#x603B;&#x8BBF;&#x5BA2;&#x91CF;">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="&#x603B;&#x8BBF;&#x95EE;&#x91CF;">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">&#x7531; <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> &amp; <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> &#x5F3A;&#x529B;&#x9A71;&#x52A8;
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"all","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
