<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"fyerfyer.github.io.com","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":2,"unescape":true,"preload":false}}</script><script src="/js/config.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">


    <meta name="description" content="fyerfyer&apos;s blog">
<meta property="og:type" content="website">
<meta property="og:title" content="fyerfyer">
<meta property="og:url" content="https://fyerfyer.github.io.com/index.html">
<meta property="og:site_name" content="fyerfyer">
<meta property="og:description" content="fyerfyer&apos;s blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="fyerfyer">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://fyerfyer.github.io.com/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>fyerfyer</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="&#x5207;&#x6362;&#x5BFC;&#x822A;&#x680F;" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">fyerfyer</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Hello! Nice to meet you!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="&#x641C;&#x7D22;" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>&#x9996;&#x9875;</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>&#x5173;&#x4E8E;</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>&#x5206;&#x7C7B;</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>&#x5F52;&#x6863;</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>&#x641C;&#x7D22;
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="&#x641C;&#x7D22;..." spellcheck="false" type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          &#x6587;&#x7AE0;&#x76EE;&#x5F55;
        </li>
        <li class="sidebar-nav-overview">
          &#x7AD9;&#x70B9;&#x6982;&#x89C8;
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="fyerfyer" src="/images/head.png">
  <p class="site-author-name" itemprop="name">fyerfyer</p>
  <div class="site-description" itemprop="description">fyerfyer&apos;s blog</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">133</span>
          <span class="site-state-item-name">&#x65E5;&#x5FD7;</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">39</span>
        <span class="site-state-item-name">&#x5206;&#x7C7B;</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/fyerfyer" title="GitHub &#x2192; https://github.com/fyerfyer" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/fuy60703@gmail.com" title="E-Mail &#x2192; fuy60703@gmail.com" rel="noopener me"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="&#x8FD4;&#x56DE;&#x9876;&#x90E8;">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/top-passage/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/top-passage/" class="post-title-link" itemprop="url">18.4.&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-07-26 10:42:58" itemprop="dateModified" datetime="2024-07-26T10:42:58+08:00">2024-07-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/18-Basic-Sorting/" itemprop="url" rel="index"><span itemprop="name">18.Basic Sorting</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>2</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>hello! HHH</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/07/25/4-3-Sequential-Y86-64-Implementation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/07/25/4-3-Sequential-Y86-64-Implementation/" class="post-title-link" itemprop="url">4.3.Sequential Y86-64 Implementation</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-07-25 14:31:22" itemprop="dateCreated datePublished" datetime="2024-07-25T14:31:22+08:00">2024-07-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-07-26 09:08:04" itemprop="dateModified" datetime="2024-07-26T09:08:04+08:00">2024-07-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CSAPP/" itemprop="url" rel="index"><span itemprop="name">CSAPP</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CSAPP/Chapter-4-Processor-Architecture/" itemprop="url" rel="index"><span itemprop="name">Chapter 4.Processor Architecture</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>2.4k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>9 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="43sequential-y86-64-implementation"><span class="math inline">\(4.3.\)</span>Sequential Y86-64 Implementation</h1>
<h3 id="1organizing-processing-intostages">1.Organizing Processing into
Stages</h3>
<h4 id="asummary">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>Summary</h4>
<p>&#x2003;&#x2003;The following is an informal description of the stages and the
operations performed within them:</p>
<ol type="1">
<li><p><em>Fetch</em>: The fetch stage <strong>reads the bytes of an
instruction from memory, using the program counter(PC) as the memory
address</strong>.</p>
<ul>
<li><p>From the instruction it <strong>extracts the two 4-bit portions
of the instruction specifier byte</strong>, referred to as
<code>icode</code>(the instruction code) and <code>ifun</code>(the
instruction function).</p></li>
<li><p>It computes <code>valP</code> to be <strong>the address of the
instruction following the current one in sequential order</strong>. That
is, <code>valP</code> equals <strong>the value of the PC plus the length
of the fetched instruction</strong>.</p></li>
</ul></li>
<li><p><em>Decode</em>: The decode stage <strong>reads up to two
operands from the register file</strong>, giving values
<code>valA</code> and/or <code>valB</code>.</p></li>
<li><p><em>Execute</em>: In the execute stage, the arithmetic/logic
unit(ALU) either <strong>performs the operation specified by the
instruction</strong>(according to <strong>the value of
<code>ifun</code></strong>), <strong>computes the effective address of a
memory reference</strong>, or <strong>increments or decrements the stack
pointer</strong>. We refer to the resulting value as
<code>valE</code>.</p>
<ul>
<li>For a conditional move instruction, the stage will evaluate the
condition codes and move condition (given by <code>ifun</code>) and
<strong>enable the updating of the destination register only if the
condition holds</strong>.</li>
</ul></li>
<li><p><em>Memory</em>: The memory stage may write data to memory, or it
may read data from memory. We refer to the value read as
<code>valM</code>.</p></li>
<li><p><em>Write Back</em>: The write-back stage writes up to two
results to the register file.</p></li>
<li><p><em>PC Update</em>: The PC is set to the address of the next
instruction.</p></li>
</ol>
<p>&#x2003;&#x2003;In our simplified implementation, the processor will stop when any
exception occurs&#xFFFD;&#xFFFD;that is, when it executes a <code>halt</code> or
invalid instruction, or it attempts to read or write an invalid
address.</p>
<h4 id="barithmetic-operations">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Arithmetic operations</h4>
<p><img src="/2024/07/25/4-3-Sequential-Y86-64-Implementation/image.png"></p>
<ul>
<li><p>For the integer-operation instruction:</p>
<ol type="1">
<li><p>In the fetch stage, we do not require a constant word, and so
<code>valP</code> is computed as <code>PC+2</code>.</p></li>
<li><p>During the decode stage, we read both operands. These are
supplied to the ALU in the execute stage, along with the function
specifier <code>ifun</code>.</p></li>
<li><p><code>valE</code> equals to the instruction result
<code>valB OP valA</code>. The <code>OP</code> is specified by
<code>ifun</code>.</p></li>
</ol></li>
<li><p>For the <code>rmmovq</code> instruction:</p>
<ol type="1">
<li><p>The process is similar to integer-operation operation, but we
don&apos;t need to fetch the second register operand. Instead, we <strong>set
the second ALU input to zero and add this to the first</strong>, giving
<code>valE = valA</code>.</p></li>
<li><p>In addition, we must increment the program counter by 10 for
<code>irmovq</code> <strong>due to the long instruction
format</strong>.</p></li>
</ol></li>
</ul>
<p><img src="/2024/07/25/4-3-Sequential-Y86-64-Implementation/image-1.png"></p>
<h4 id="coperations-involving-memoryoperation">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>Operations involving memory
operation</h4>
<p>&#x2003;&#x2003;The following instructions involve memory write and read stage:</p>
<p><img src="/2024/07/25/4-3-Sequential-Y86-64-Implementation/image-2.png"></p>
<ul>
<li><p>The process <strong>use the ALU to add <code>valC</code> to
<code>valB</code>, giving the effective address for memory
operation</strong>.</p></li>
<li><p>In the memory stage, we either write the register value
<code>valA</code> to memory or read <code>valM</code> from
memory.</p></li>
</ul>
<p><img src="/2024/07/25/4-3-Sequential-Y86-64-Implementation/image-3.png"></p>
<h4 id="dpushq-amppopq-operations">&#x2003;&#x2003;<span class="math inline">\(d.\)</span><code>pushq</code> &amp;
<code>popq</code> operations</h4>
<p><img src="/2024/07/25/4-3-Sequential-Y86-64-Implementation/image-4.png"></p>
<p>&#x2003;&#x2003;The <code>pushq</code> and <code>popq</code> involve both accessing
memory and incrementing or decrementing the stack pointer.</p>
<ul>
<li><p>For the <code>pushq</code> instruction:</p>
<ol type="1">
<li><p>In decode stage, we use <code>%rsp</code> as the identifier for
the second register operand, giving the stack pointer as
<code>valB</code>.</p></li>
<li><p>In the execute stage, we <strong>use the ALU to decrement the
stack pointer by 8</strong>. This decremented value is used for the
memory write address and is also <strong>stored back to
<code>%rsp</code> in the write-back stage</strong>.</p></li>
<li><p>We use <code>valE</code> as the address for the write
operation.</p></li>
</ol></li>
</ul>
<blockquote>
<p>we adhere to the Y86-64 convention that <code>pushq</code> should
<strong>decrement the stack pointer before writing</strong>.</p>
</blockquote>
<ul>
<li><p>For the <code>popq</code> instruction:</p>
<ol type="1">
<li><p>The <code>popq</code> instruction proceeds much like
<code>pushq</code>, except that we <strong>read two copies of the stack
pointer</strong> in the decode stage. This is clearly redundant, but we
will see that having the stack pointer as both <code>valA</code> and
<code>valB</code> makes the subsequent flow more similar to that of
other instructions, enhancing the overall uniformity of the
design.</p></li>
<li><p>We use <strong>the unincremented value as the address for the
memory operation</strong>.</p></li>
<li><p>In the write-back stage, we update both <strong>the stack pointer
register with the incremented stack pointer</strong> and
<strong>register <code>rA</code> with the value read from
memory</strong>.</p></li>
</ol></li>
</ul>
<p><img src="/2024/07/25/4-3-Sequential-Y86-64-Implementation/image-5.png"></p>
<h4 id="econtrol-transfer-instructions">&#x2003;&#x2003;<span class="math inline">\(e.\)</span>Control transfer instructions</h4>
<p><img src="/2024/07/25/4-3-Sequential-Y86-64-Implementation/image-6.png"></p>
<ul>
<li><p>A jump instruction proceeds through fetch and decode much like
the previous instructions, except that <strong>it does not require a
register specifier byte</strong>.</p></li>
<li><p>In the execute stage, we check the condition codes and the jump
condition to determine whether or not to take the branch, yielding a
1-bit signal <code>Cnd</code>.</p></li>
<li><p>We test this flag and set the PC to <code>valC</code>(the jump
target) if the flag is 1 and to <code>valP</code>(the address of the
following instruction) if the flag is 0.</p></li>
</ul>
<p><img src="/2024/07/25/4-3-Sequential-Y86-64-Implementation/image-7.png"></p>
<h4 id="fcall-ampret-operations">&#x2003;&#x2003;<span class="math inline">\(f.\)</span><code>call</code> &amp;
<code>ret</code> operations</h4>
<ul>
<li><p>Instructions <code>call</code> and <code>ret</code> is similar to
<code>pushq</code> and <code>popq</code>, except that we push and pop
program counter values.</p>
<ul>
<li><p>With instruction call, we push <code>valP</code>, <strong>the
address of the instruction that follows the call instruction</strong>.
During the PC update stage, we <strong>set the PC to <code>valC</code>,
the call destination</strong>.</p></li>
<li><p>With instruction <code>ret</code>, we assign <code>valM</code>,
<strong>the value popped from the stack</strong>, to the PC in the PC
update stage.</p></li>
</ul></li>
</ul>
<p><img src="/2024/07/25/4-3-Sequential-Y86-64-Implementation/image-8.png"></p>
<h3 id="2seq-hardware-structure">2.SEQ Hardware Structure</h3>
<p>&#x2003;&#x2003;The following figure shows an abstract view of a hardware structure
that performs the six stages:</p>
<p><img src="/2024/07/25/4-3-Sequential-Y86-64-Implementation/image-9.png"></p>
<ul>
<li><p>Information then flows along wires(shown grouped together as a
heavy gray line), first upward and then around to the right.</p></li>
<li><p>The feedback paths coming back down on the right-hand side
<strong>contain the updated values to write to the register file and the
updated program counter</strong>.</p></li>
</ul>
<p>&#x2003;&#x2003;The six stages are executed as below:</p>
<ol type="1">
<li><p><em>Fetch</em>: <strong>Using the program counter register as an
address</strong>, the <em>instruction memory</em> reads the bytes of an
instruction. The PC incrementer computes <code>valP</code>.</p></li>
<li><p><em>Decode</em>: The two register values <code>valA</code> and
<code>valB</code> are read simultaneously from the read ports A and
B.</p></li>
<li><p><em>Execute</em>:</p>
<ul>
<li><p>The ALU do the operations for different purposes.</p></li>
<li><p>The condition code register(CC) holds the three condition code
bits. New values for the condition codes are computed by the ALU. The
execution of move instruction and the <code>Cnd</code> of the jump
instruction is computed based on the CC.</p></li>
</ul></li>
<li><p><em>Memory</em>: The data memory reads or writes a word of memory
when executing a memory instruction.</p>
<ul>
<li>The instruction and data memories access the same memory locations,
but for different purposes.</li>
</ul></li>
<li><p><em>Write Back</em>: The register file has two write ports. Port
E is used to write values computed by the ALU, while port M is used to
write values read from the data memory.</p></li>
<li><p><em>PC Update</em>: The new value of the program counter is
selected to be either <code>valP</code>, <strong>the address of the next
instruction</strong>, <code>valC</code>, <strong>the destination address
specified by a call or jump instruction</strong>, or <code>valM</code>,
<strong>the return address read from memory</strong>.</p></li>
</ol>
<p>&#x2003;&#x2003;The following figure gives a more detailed view of the hardware
design:</p>
<p><img src="/2024/07/25/4-3-Sequential-Y86-64-Implementation/image-10.png"></p>
<p><img src="/2024/07/25/4-3-Sequential-Y86-64-Implementation/image-11.png"></p>
<h3 id="3seq-timing">3.SEQ Timing</h3>
<h4 id="asomebasic-idea">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>Some
basic idea</h4>
<ul>
<li><p>Combinational logic does not require any sequencing or
control&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;<strong>values propagate through a network of logic gates
whenever the inputs change</strong>.</p></li>
<li><p>We assume that reading from a random access memory operates much
like combinational logic, with the output word generated based on the
address input.</p></li>
<li><p>The program counter is loaded with a new instruction address
every clock cycle.</p></li>
<li><p>The condition code register is loaded only <strong>when an
integer operation instruction is executed</strong>.</p></li>
<li><p>The data memory is written only when an <code>rmmovq</code>,
<code>pushq</code>, or <code>call</code> instruction is
executed.</p></li>
<li><p>The two write ports of the register file allow two program
registers to be updated on every cycle, but we can use the special
register ID 0xF as a port address to indicate that no write should be
performed for this port.</p></li>
<li><p><em>Principle</em>: The processor <strong>never needs to read
back the state updated by an instruction</strong> in order to complete
the processing of this instruction.</p></li>
</ul>
<h4 id="bprogram-example">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Program example</h4>
<p><img src="/2024/07/25/4-3-Sequential-Y86-64-Implementation/image-12.png"></p>
<p>&#x2003;&#x2003;Every time the clock transitions from low to high, the processor
begins executing a new instruction.</p>
<h3 id="4seq-stage-implementation">4.SEQ Stage Implementation</h3>
<p>&#x2003;&#x2003;The used constant are shown below:</p>
<p><img src="/2024/07/25/4-3-Sequential-Y86-64-Implementation/image-13.png"></p>
<h4 id="afetchstage">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>Fetch
stage</h4>
<p><img src="/2024/07/25/4-3-Sequential-Y86-64-Implementation/image-14.png"></p>
<ul>
<li><p>The instruction memory hardware unit reads 10 bytes from memory
at a time, <strong>using the PC as the address of the first byte(byte
0)</strong>. This byte is interpreted as the instruction byte and is
<strong>split(by the unit labeled &quot;Split&quot;) into two 4-bit
quantities</strong>.</p></li>
<li><p>The control logic blocks labeled &quot;icode&quot; and &quot;ifun&quot; then compute
the instruction and function codes as equaling either <strong>the values
read from memory</strong> or the values corresponding to a nop
instruction(as indicated by the signal
<code>imem_error</code>).</p></li>
</ul>
<p>&#x2003;&#x2003;Based on the value of <code>icode</code>, we can compute three
1-bit signals:</p>
<ol type="1">
<li><p><code>instr_valid</code>: This signal is used to <strong>detect
an illegal instruction</strong>.</p></li>
<li><p><code>need_regids</code>: Does this instruction <strong>include a
register specifier byte</strong>?</p></li>
<li><p><code>need_valC</code>: Does this instruction <strong>include a
constant word</strong>?</p></li>
</ol>
<p>&#x2003;&#x2003;The signals <code>instr_valid</code> and
<code>imem_error</code>(generated when the instruction address is out of
bounds) are used to <strong>generate the status code in the memory
stage</strong>.</p>
<p>&#x2003;&#x2003;The HCL description for <code>need_regids</code> and
<code>need_valC</code> are as below:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bool need_regids =</span><br><span class="line">    icode in { IRRMOVQ, IOPQ, IPUSHQ, IPOPQ,</span><br><span class="line">               IIRMOVQ, IRMMOVQ, IMRMOVQ };</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bool need_valC =</span><br><span class="line">    icode in { IIRMOVQ, IRMMOVQ, IMRMOVQ, IJXX, ICALL };</span><br></pre></td></tr></table></figure>
<ul>
<li><p>The remaining 9 bytes read from the instruction memory encode
some combination of the register specifier byte and the constant
word.</p>
<ul>
<li>Byte 1 <strong>is split into register specifiers <code>rA</code> and
<code>rB</code> when the computed signal need_regids is 1</strong>. If
<code>need_regids</code> is 0, both register specifiers are set to
0xF(<code>RNONE</code>).</li>
</ul></li>
<li><p>The PC incrementer hardware unit generates the signal
<code>valP</code>, based on the current value of the PC, and the two
signals <code>need_regids</code> and <code>need_valC</code>. For PC
value <span class="math inline">\(p\)</span>, <code>need_regids</code>
value <span class="math inline">\(r\)</span>, and <code>need_valC</code>
value <span class="math inline">\(i\)</span>, the incrementer generates
the value <span class="math inline">\(p+1+r+8i\)</span>.</p></li>
</ul>
<h4 id="bdecode-and-write-back-stagess">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Decode and write-back stagess</h4>
<p><img src="/2024/07/25/4-3-Sequential-Y86-64-Implementation/image-15.png"></p>
<ul>
<li><p>The register file has four ports. It supports up to two
simultaneous reads(on ports A and B) and two simultaneous writes(on
ports E and M).</p>
<ul>
<li><p>Each port has <strong>both an address connection and a data
connection</strong>, where the address connection is a register ID, and
the data connection is a set of 64 wires serving as either an output
word (for a read port) or an input word (for a write port) of the
register file.</p></li>
<li><p>The two read ports have address inputs <code>srcA</code> and
<code>srcB</code>, while the two write ports have address inputs
<code>dstE</code> and <code>dstM</code>. The 0xF(<code>RNONE</code>) on
an address port indicates that no register should be accessed.</p></li>
</ul></li>
<li><p>The four blocks at the bottom generate <strong>the four different
register IDs</strong> for the register file based on <code>icode</code>,
<code>rA</code>, <code>rB</code> and <code>Cnd</code>.</p>
<ul>
<li><p><code>srcA</code> indicates which register should be read to
generate <code>valA</code>, so as <code>srcB</code>.</p></li>
<li><p><code>dstE</code> indicates <strong>the destination register for
write port E</strong>, where the computed value <code>valE</code> is
stored, so as <code>dstM</code>.</p></li>
</ul></li>
</ul>
<p>&#x2003;&#x2003;The HCL description of <code>srcA</code> and <code>srcB</code> are
as below:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">word srcA = [</span><br><span class="line">    icode in { IRRMOVQ, IRMMOVQ, IOPQ, IPUSHQ } : rA;</span><br><span class="line">    icode in { IPOPQ, IRET } : RRSP;</span><br><span class="line">    1 : RNONE; # Don&apos;t need register</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">word srcB = [</span><br><span class="line">    icode in { IOPQ, IRMMOVQ, IMRMOVQ } : rB;</span><br><span class="line">    icode in { IPUSHQ, IPOPQ, ICALL, IRET } : RRSP;</span><br><span class="line">    1 : RNONE; # Don&apos;t need register</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;The HCL description of <code>dstM</code> is as below:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">word dstM = [</span><br><span class="line">    icode in { IMRMOVQ, IPOPQ } : rA;</span><br><span class="line">    1 : RNONE; # Don&#xFFFD;&#xFFFD;t write any register</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<h4 id="cexecute-stage">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>Execute stage</h4>
<p><img src="/2024/07/25/4-3-Sequential-Y86-64-Implementation/image-16.png"></p>
<ul>
<li><p>The stage includes ALU, which performs operations based on the
setting of <code>alufun</code> signal. The ALU output becomes the signal
<code>valE</code>.</p></li>
<li><p>The value of <code>aluA</code> can be <code>valA</code>,
<code>valC</code>, or either ?8 or +8, depending on the instruction
type, so as <code>aluB</code></p></li>
</ul>
<p>&#x2003;&#x2003;They can be described by the following HCL code:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">word aluA = [</span><br><span class="line">    icode in { IRRMOVQ, IOPQ } : valA;</span><br><span class="line">    icode in { IIRMOVQ, IRMMOVQ, IMRMOVQ } : valC;</span><br><span class="line">    icode in { ICALL, IPUSHQ } : -8;</span><br><span class="line">    icode in { IRET, IPOPQ } : 8;</span><br><span class="line">    # Other instructions don&#xFFFD;&#xFFFD;t need ALU</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">word aluB = [</span><br><span class="line">    icode in { IRMMOVQ, IMRMOVQ, IOPQ, ICALL,</span><br><span class="line">    IPUSHQ, IRET, IPOPQ } : valB;</span><br><span class="line">    icode in { IRRMOVQ, IIRMOVQ } : 0;</span><br><span class="line">    # Other instructions don&#xFFFD;&#xFFFD;t need ALU</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<ul>
<li>The operations in ALU is <strong>mostly an adder</strong>. However,
we want it to use the operation encoded in the <code>ifun</code> field
of the instruction. So we describe the ALU control as below:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">word alufun = [</span><br><span class="line">    icode == IOPQ : ifun;</span><br><span class="line">    1 : ALUADD;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<ul>
<li>We only want to set the condition codes when an <code>OPq</code>
instruction is executed. The logic is described in HCL as below:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bool set_cc = icode in { IOPQ };</span><br></pre></td></tr></table></figure>
<ul>
<li><p>The hardware unit labeled &quot;cond&quot; uses <strong>a combination of
the condition codes and the function code</strong> to <strong>determine
whether a conditional branch or data transfer should take
place</strong>.</p>
<ul>
<li>It generates the <code>Cnd</code> signal used both for the setting
of <code>dstE</code> with conditional moves and in the next PC logic for
conditional branches.</li>
</ul></li>
</ul>
<p>&#x2003;&#x2003;By using the <code>Cnd</code> signal, we can describe
<code>dstE</code> as below:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">word dstE = [</span><br><span class="line">    icode in { IRRMOVQ } &amp;&amp; Cnd : rB;</span><br><span class="line">    icode in { IIRMOVQ, IOPQ} : rB;</span><br><span class="line">    icode in { IPUSHQ, IPOPQ, ICALL, IRET } : RRSP;</span><br><span class="line">    1 : RNONE; # Don&apos;t write any register</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<h4 id="dmemorystage">&#x2003;&#x2003;<span class="math inline">\(d.\)</span>Memory
stage</h4>
<p><img src="/2024/07/25/4-3-Sequential-Y86-64-Implementation/image-17.png"></p>
<ul>
<li><p>Two control blocks generate the values for the memory address and
the memory input data(for write operations).</p></li>
<li><p>Two other blocks generate the control signals indicating
<strong>whether to perform a read or a write
operation</strong>.</p></li>
<li><p>When a read operation is performed, <strong>the data memory
generates the value <code>valM</code></strong>.</p></li>
</ul>
<p>&#x2003;&#x2003;The HCL description of <code>mem_addr</code> and
<code>mem_data</code> are as below:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">word mem_addr = [</span><br><span class="line">    icode in { IRMMOVQ, IPUSHQ, ICALL, IMRMOVQ } : valE;</span><br><span class="line">    icode in { IPOPQ, IRET } : valA;</span><br><span class="line">    # Other instructions don&#xFFFD;&#xFFFD;t need address</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">word mem_data = [</span><br><span class="line">    # Value from register</span><br><span class="line">    icode in { IRMMOVQ, IPUSHQ } : valA;</span><br><span class="line">    # Return PC</span><br><span class="line">    icode == ICALL : valP;</span><br><span class="line">    # Default: Don&#xFFFD;&#xFFFD;t write anything</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<ul>
<li>We set the signal <code>mem_read</code> only for instructions that
read data from memory, so as <code>mem_write</code>:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bool mem_read = icode in { IMRMOVQ, IPOPQ, IRET };</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bool mem_write = icode in { IRMMOVQ, IPUSHQ, ICALL };</span><br></pre></td></tr></table></figure>
<ul>
<li>A final function for the memory stage is to compute the status code
<code>Stat</code>. It is generated from <code>icode</code>,
<code>imem_error</code>, <code>instr_valid</code> and
<code>dmem_error</code>. It&apos;s described in HCL as below:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">## Determine instruction status</span><br><span class="line">word Stat = [</span><br><span class="line">    imem_error || dmem_error : SADR;</span><br><span class="line">    !instr_valid: SINS;</span><br><span class="line">    icode == IHALT : SHLT;</span><br><span class="line">    1 : SAOK;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<h4 id="epcupdate-stage">&#x2003;&#x2003;<span class="math inline">\(e.\)</span>PC
update stage</h4>
<p><img src="/2024/07/25/4-3-Sequential-Y86-64-Implementation/image-18.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">word new_pc = [</span><br><span class="line">    # Call. Use instruction constant</span><br><span class="line">    icode == ICALL : valC;</span><br><span class="line">    # Taken branch. Use instruction constant</span><br><span class="line">    icode == IJXX &amp;&amp; Cnd : valC;</span><br><span class="line">    # Completion of RET instruction. Use value from stack</span><br><span class="line">    icode == IRET : valM;</span><br><span class="line">    # Default: Use incremented PC</span><br><span class="line">    1 : valP;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/07/24/4-2-Logical-Design-and-the-HCL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/07/24/4-2-Logical-Design-and-the-HCL/" class="post-title-link" itemprop="url">4.2.Logical Design and the HCL</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-07-24 09:31:22" itemprop="dateCreated datePublished" datetime="2024-07-24T09:31:22+08:00">2024-07-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-07-25 14:48:06" itemprop="dateModified" datetime="2024-07-25T14:48:06+08:00">2024-07-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CSAPP/" itemprop="url" rel="index"><span itemprop="name">CSAPP</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CSAPP/Chapter-4-Processor-Architecture/" itemprop="url" rel="index"><span itemprop="name">Chapter 4.Processor Architecture</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>1.1k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>4 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="42logical-design-and-the-hcl"><span class="math inline">\(4.2.\)</span>Logical Design and the HCL</h1>
<h3 id="1combinationalcircuits-amp-hcl-boolean-expressions">1.Combinational
Circuits &amp; HCL Boolean Expressions</h3>
<p>&#x2003;&#x2003;By assembling a number of logic gates into a network, we can
construct computational blocks known as <em>combinational circuits</em>.
There are several restrictions:</p>
<ol type="1">
<li><p>Every logic gate input must be connected to exactly one of the
following:</p>
<ol type="1">
<li><p>one of the system inputs (known as a <em>primary
input</em>)</p></li>
<li><p>the output connection of some memory element</p></li>
<li><p>the output of some logic gate.</p></li>
</ol></li>
<li><p>The outputs of two or more logic gates cannot be connected
together. <strong>Otherwise, the two could try to drive the wire toward
different voltages</strong>, possibly causing an invalid voltage or a
circuit malfunction.</p></li>
<li><p>The network must be acyclic. That is, there cannot be a path
through a series of gates that forms a loop in the network.</p></li>
</ol>
<p>&#x2003;&#x2003;The following shows an example of a combinational circuit:</p>
<p><img src="/2024/07/24/4-2-Logical-Design-and-the-HCL/image.png"></p>
<p>&#x2003;&#x2003;The network is written in HCL as:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bool eq = (a &amp;&amp; b) || (!a &amp;&amp; !b)</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;The HCL uses C-sytle syntax. However, we don&apos;t view the code as
performing a computation and assigning the result to some memory
location. Instead, it is simply a way to <strong>give a name to an
expression</strong>.</p>
<p>&#x2003;&#x2003;There are some other differences that are worth noting:</p>
<ul>
<li><p>The combinational circuit has the property that the outputs
continually respond to changes in the inputs. By contrast, a C
expression <strong>is only evaluated when it is encountered</strong>
during the execution of a program.</p></li>
<li><p>The combinational circuit only operates over the bit value 0 and
1.</p></li>
<li><p>Logical expressions in C have the property that <strong>they
might only be partially evaluated</strong>. If the outcome of an and or
or operation can be determined by just evaluating the first argument,
then the second argument will not be evaluated. In contrast,
combinational logic <strong>doesn&apos;t have any partial evaluation
rules</strong>.</p></li>
</ul>
<h3 id="2word-levelcombinational-circuits-and-hcl-integer-expression">2.Word-Level
Combinational Circuits and HCL Integer Expression</h3>
<p>&#x2003;&#x2003;Combinational circuits that perform word-level computations are
constructed using logic gates to compute the individual bits of the
output word, based on the individual bits of the input words. The
following circuit tests if two words A and B are equal:</p>
<p><img src="/2024/07/24/4-2-Logical-Design-and-the-HCL/image-1.png"></p>
<p>&#x2003;&#x2003;HCL allows words to be compared for equality. So we can express the
circuit as <code>bool Eq = (A == B)</code></p>
<hr>
<p>&#x2003;&#x2003;Multiplexing functions are described in HCL using <em>casing
expressions</em>. A case expressions has the following general form:</p>
<p><span class="math display">\[
\begin{bmatrix}
\text{select}_1 : \text{expr}_1; \\
\text{select}_2 : \text{expr}_2; \\
\vdots \\
\text{select}_k : \text{expr}_k;
\end{bmatrix}
\]</span></p>
<ul>
<li><p><span class="math inline">\(select_i\)</span> indicates when this
case should be selected.</p></li>
<li><p>The integer expression <span class="math inline">\(expr_i\)</span> indicates the resulting
value.</p></li>
<li><p>The selection expressions can be <strong>arbitrary Boolean
expressions</strong>, and there can be <strong>an arbitrary number of
cases</strong>.</p></li>
</ul>
<p>&#x2003;&#x2003;Logically, the selection expressions are evaluated in sequence, and
the case <strong>for the first one yielding 1 is selected</strong>.</p>
<p>&#x2003;&#x2003;For example, the figure below shows the circuit of the word-level
multiplexor:</p>
<p><img src="/2024/07/24/4-2-Logical-Design-and-the-HCL/image-2.png"></p>
<p>&#x2003;&#x2003;it can be expressed in HCL as:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">word Out = [</span><br><span class="line">    s: A;</span><br><span class="line">    1: B;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;And a 4-way multiplexor can be expressed in HCL as:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">word Out4 = [</span><br><span class="line">    !s1 &amp;&amp; !s0: A; </span><br><span class="line">    !s1       : B;</span><br><span class="line">    !s0       : C;</span><br><span class="line">    1         : D; </span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;If we want to design a logic circuit that finds the minimum value
among a set of words A, B and C, we can write the following HCL
program:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">word MIN3 = [</span><br><span class="line">    A &lt;= B &amp;&amp; A &lt;= C: A;</span><br><span class="line">    B &lt;= A &amp;&amp; B &lt;= C: B;</span><br><span class="line">    1               : C;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<h3 id="3set-membership">3.Set Membership</h3>
<p>&#x2003;&#x2003;The general form of a set membership test is:</p>
<p><span class="math display">\[
\text{iexpr} \in \{\text{iexpr}_1, \text{iexpr}_2, \ldots,
\text{iexpr}_k\}
\]</span></p>
<p>&#x2003;&#x2003;where the value being tested(<span class="math inline">\(iexpr\)</span>) and the candidate matches(<span class="math inline">\(iexpr_1\)</span> through <span class="math inline">\(iexpr_k\)</span>) are <strong>all integer
expressions</strong>.</p>
<h3 id="4memory-and-clock">4.Memory and Clock</h3>
<h4 id="asummary">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>Summary</h4>
<p>&#x2003;&#x2003;Combinational circuits don&apos;t store any information, they simply
react to the signals at their inputs. So we must introduce devices that
<strong>store information represented as bits</strong>.</p>
<p>&#x2003;&#x2003;Our storage devices are all controlled by a single clock, a
periodic signal that <strong>determines when new values are to be loaded
into the devices</strong>.</p>
<p>&#x2003;&#x2003;We consider two classes of memory devices:</p>
<ul>
<li><p><em>Clocked registers(simple registers)</em>: It stores
individual bits or words. <strong>The clock signal controls the loading
of the register with the value at its input</strong>.</p>
<ul>
<li>Our Y86-64 processors will use clocked registers to hold the program
counter(PC), the condition codes(CC), and the program status(Stat).</li>
</ul></li>
<li><p><em>Random access memories</em>(<em>simply memories</em>):It
store multiple words, <strong>using an address to select which word
should be read or written</strong>.</p>
<ul>
<li><p>Examples of random access memories include</p>
<ul>
<li><p>the virtual memory system of a processor, where a combination of
hardware and operating system software make it appear to a processor
that it can access any word within a large address space;</p></li>
<li><p>the register file, where register identifiers serve as the
addresses.</p></li>
</ul></li>
<li><p>In a Y86-64 processor, <strong>the register file holds the 15
program registers</strong>(<code>%rax</code> through
<code>%r14</code>).</p></li>
</ul></li>
</ul>
<blockquote>
<p>In hardware, a register <strong>is directly connected to the rest of
the circuit by its input and output wires</strong>. In machine-level
programming, the registers <strong>represent a small collection of
addressable words in the CPU</strong>, where <strong>the addresses
consist of register IDs</strong>.</p>
</blockquote>
<p>&#x2003;&#x2003;The following figure shows the detailed register operation:</p>
<p><img src="/2024/07/24/4-2-Logical-Design-and-the-HCL/image-3.png"></p>
<p>&#x2003;&#x2003;In the figure, the register serves as <strong>barriers between the
combinational logic</strong> in different parts of the circuit.</p>
<h4 id="bregister-file">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Register file</h4>
<p>&#x2003;&#x2003;The following g diagram shows a typical register file:</p>
<p><img src="/2024/07/24/4-2-Logical-Design-and-the-HCL/image-4.png"></p>
<ul>
<li><p>The <em>multiported</em> RAM allows <strong>multiple read and
write operations to take place simultaneously</strong>.</p></li>
<li><p>Each port has an <em>address input</em>, indicating <strong>which
program register should be selected</strong>, and a <em>data output or
input</em> <strong>giving a value for that program
register</strong>.</p></li>
<li><p>Every time the clock rises, the value on input <code>valW</code>
is written to the program register indicated by the register ID on input
<code>dstW</code>.</p>
<ul>
<li>When <code>dstW</code> is set to <code>0xF</code>, no program
register is written.</li>
</ul></li>
</ul>
<h4 id="cdatamemory">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>Data
memory</h4>
<p>&#x2003;&#x2003;The Data memory is used to store program data:</p>
<p><img src="/2024/07/24/4-2-Logical-Design-and-the-HCL/image-5.png"></p>
<ul>
<li><p>This memory has a single address input, a data input for writing,
and a data output for reading.</p></li>
<li><p>We set <code>address</code> to the desired address,
<code>data in</code> to the desired value.</p></li>
<li><p>The <code>error</code> signal will be set to 1 if the
<code>address</code> is out of range.</p></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/07/24/4.1.Y86-64-Instruction-Set-Architecture/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/07/24/4.1.Y86-64-Instruction-Set-Architecture/" class="post-title-link" itemprop="url">4.1.Y86-64 Instruction Set Architecture</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-07-24 09:31:22" itemprop="dateCreated datePublished" datetime="2024-07-24T09:31:22+08:00">2024-07-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-07-25 09:49:13" itemprop="dateModified" datetime="2024-07-25T09:49:13+08:00">2024-07-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CSAPP/" itemprop="url" rel="index"><span itemprop="name">CSAPP</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CSAPP/Chapter-4-Processor-Architecture/" itemprop="url" rel="index"><span itemprop="name">Chapter 4.Processor Architecture</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>1.1k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>4 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="41y86-64-instruction-setarchitecture"><span class="math inline">\(4.1.\)</span>Y86-64 Instruction Set
Architecture</h1>
<h3 id="1programmer-visible-state">1.Programmer-Visible State</h3>
<p>&#x2003;&#x2003;The programmer-visible state is where the programmer can generate
machine-level code.</p>
<p><img src="/2024/07/24/4.1.Y86-64-Instruction-Set-Architecture/image.png"></p>
<ul>
<li>The <code>Stat</code> indicates the overall state of program
execution. It will indicate either normal operation or that some sort of
exception has occurred.</li>
</ul>
<h3 id="2y86-64-instruction-set">2.Y86-64 Instruction Set</h3>
<p><img src="/2024/07/24/4.1.Y86-64-Instruction-Set-Architecture/image-1.png"></p>
<ul>
<li><p>The integer operation instructions operate only on register data.
This instructions set the three condition codes <code>ZF</code>,
<code>SF</code>, and <code>OF</code> (zero, sign, and
overflow).</p></li>
<li><p>The <code>call</code> instruction <strong>pushes the return
address on the stack</strong> and <strong>jumps to the destination
address</strong>. The <code>ret</code> instruction returns from such a
call.</p></li>
<li><p>The <code>halt</code> instruction stops instruction execution,
and the status code is set to <code>HLT</code>.</p></li>
</ul>
<h3 id="3instruction-encoding">3.Instruction Encoding</h3>
<p><img src="/2024/07/24/4.1.Y86-64-Instruction-Set-Architecture/image-1.png"></p>
<p><img src="/2024/07/24/4.1.Y86-64-Instruction-Set-Architecture/image-2.png"></p>
<ul>
<li>Every instruction has an <strong>initial byte identifying the
instruction type</strong>. This byte is split into two 4-bit parts: the
high-order, or code, part, and the low-order, or function, part.</li>
</ul>
<p>&#x2003;&#x2003;Instructions that need operands have longer encodings:</p>
<ul>
<li><p>There can be an additional register specifier byte
<strong>specifying either one or two registers</strong>. These register
fields are called <code>rA</code> and <code>rB</code> in figure
above.</p>
<ul>
<li><p>Instructions that have no register operands do not have a
register specifier byte.</p></li>
<li><p>Those that require just one register operand have the other
register specifier set to 0xF.</p></li>
</ul></li>
<li><p>Some instructions require an additional 8-byte constant word.
This word can serve as the immediate data for <code>irmovq</code>, the
displacement for <code>rmmovq</code> and <code>mrmovq</code> address
specifiers, and the destination of branches and calls.</p>
<ul>
<li>Note that branch and call destinations are given as <strong>absolute
addresses</strong>, rather than using the PC-relative addressing seen in
x86-64.</li>
</ul></li>
</ul>
<p><img src="/2024/07/24/4.1.Y86-64-Instruction-Set-Architecture/image-3.png"></p>
<ul>
<li>The program registers are stored within the CPU in a register file,
a small random access memory where <strong>the register IDs serve as
addresses</strong>.</li>
</ul>
<p>&#x2003;&#x2003;Let&apos;s take the instruction
<code>rmmovq %rsp, 0x123456789abcd(%rdx)</code> as an example:</p>
<ol type="1">
<li><p><code>rmmovq</code> has initial byte <code>40</code>.</p></li>
<li><p>The source register <code>%rsp</code> is encoded in
<code>rA</code> field, and base register <code>%rdx</code> is encoded in
<code>rB</code> field. So we get the register specifier byte of
<code>42</code>.</p></li>
<li><p>The displacement is encoded in the 8-byte constant word:
<code>00 01 23 45 67 89 ab cd</code>, and we write it in byte-reversed
order.</p></li>
</ol>
<p>&#x2003;&#x2003;So the final result is <code>4042cdab896745230100</code>.</p>
<ul>
<li><p>One important property of any instruction set is that <strong>the
byte encodings must have a unique interpretation</strong>. An arbitrary
sequence of bytes either encodes a unique instruction sequence or is not
a legal byte sequence</p>
<ul>
<li>This property ensures that a processor can execute an object-code
program without any ambiguity about the meaning of the code. However, if
we do not know the starting position of a code sequence, we cannot
reliably determine how to split the sequence into individual
instructions.</li>
</ul></li>
</ul>
<h3 id="4exceptions">4.Exceptions</h3>
<p>&#x2003;&#x2003;The programmer-visible state includes a status code
<code>Stat</code> describing the overall state of the executing program.
The possible values for this code are as below:</p>
<p><img src="/2024/07/24/4.1.Y86-64-Instruction-Set-Architecture/image-4.png"></p>
<ul>
<li><p>The <code>ADR</code>indicates that the processor attempted to
read from or write to an invalid memory address, either while fetching
an instruction or while reading or writing data.</p>
<ul>
<li>We limit the maximum address, and <strong>any access to an address
beyond this limit will trigger an ADR exception</strong>.</li>
</ul></li>
</ul>
<h3 id="5y86-64-programs">5.Y86-64 Programs</h3>
<p>&#x2003;&#x2003;Take the following C program as an example:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="title function_">sum</span><span class="params">(<span class="type">long</span> *start, <span class="type">long</span> count)</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">long</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (count)</span><br><span class="line">    {</span><br><span class="line">        sum += *start;</span><br><span class="line">        start++;</span><br><span class="line">        count--;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;the x86-64 and Y86-64 assembly code are as below:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># x86-64 ver</span><br><span class="line"># long sum(long *start, long count)</span><br><span class="line"># start in %rdi, count in %rsi</span><br><span class="line">sum:</span><br><span class="line">    movl $0, %eax        # sum = 0</span><br><span class="line">    jmp .L2              # Goto test</span><br><span class="line">.L3:                     # loop:</span><br><span class="line">    addq (%rdi), %rax    # Add *start to sum</span><br><span class="line">    addq $8, %rdi        # start++</span><br><span class="line">    subq $1, %rsi        # count--</span><br><span class="line">.L2:                     # test:</span><br><span class="line">    testq %rsi, %rsi     # Test sum</span><br><span class="line">    jne .L3              # If !=0, goto loop</span><br><span class="line">    rep; ret             # Return</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># Y86-64 ver</span><br><span class="line"># long sum(long *start, long count)</span><br><span class="line"># start in %rdi, count in %rsi</span><br><span class="line">sum:</span><br><span class="line">    irmovq $8,%r8       # Constant 8</span><br><span class="line">    irmovq $1,%r9       # Constant 1</span><br><span class="line">    xorq %rax,%rax      # sum = 0</span><br><span class="line">    andq %rsi,%rsi      # Set CC</span><br><span class="line">    jmp test            # Goto test</span><br><span class="line">loop:</span><br><span class="line">    mrmovq (%rdi),%r10  # Get *start</span><br><span class="line">    addq %r10,%rax      # Add to sum</span><br><span class="line">    addq %r8,%rdi       # start++</span><br><span class="line">    subq %r9,%rsi       # count--. Set CC</span><br><span class="line">test:</span><br><span class="line">    jne loop            # Stop when 0</span><br><span class="line">    ret                 # Return</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;The Y86-64 codes have the following differences:</p>
<ol type="1">
<li><p>The Y86-64 code <strong>loads constants into registers</strong>
(lines 2&#xFFFD;C3), since it cannot use immediate data in arithmetic
instructions.</p></li>
<li><p>The Y86-64 code requires two instructions (lines 8&#xFFFD;C9) to
<strong>read a value from memory and add it to a
register</strong>.</p></li>
</ol>
<p>&#x2003;&#x2003;The following shows a complete program file written in Y86-64
assembly code:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">.pos 0                                      # Execution begins at address 0</span><br><span class="line">irmovq stack, %rsp                          # Set up stack pointer</span><br><span class="line">call main                                   # Execute main program</span><br><span class="line">halt                                        # Terminate program</span><br><span class="line"></span><br><span class="line">.align 8                                    # Array of 4 elements</span><br><span class="line">array:</span><br><span class="line">.quad 0x000d000d000d</span><br><span class="line">.quad 0x00c000c000c0</span><br><span class="line">.quad 0x0b000b000b00</span><br><span class="line">.quad 0xa000a000a000</span><br><span class="line"></span><br><span class="line">main:</span><br><span class="line">irmovq array, %rdi</span><br><span class="line">irmovq $4, %rsi</span><br><span class="line">call sum                                    # sum(array, 4)</span><br><span class="line">ret</span><br><span class="line"></span><br><span class="line">sum:                                        # long sum(long *start, long count)</span><br><span class="line">irmovq $8, %r8                              # Constant 8</span><br><span class="line">irmovq $1, %r9                              # Constant 1</span><br><span class="line">xorq %rax, %rax                             # sum = 0</span><br><span class="line">andq %rsi, %rsi                             # Set CC</span><br><span class="line">jmp test                                    # Goto test</span><br><span class="line">loop:</span><br><span class="line">mrmovq (%rdi), %r10                         # Get *start</span><br><span class="line">addq %r10, %rax                             # Add to sum</span><br><span class="line">addq %r8, %rdi                              # start++</span><br><span class="line">subq %r9, %rsi                              # count--. Set CC</span><br><span class="line">test:</span><br><span class="line">jne loop                                    # Stop when 0</span><br><span class="line">ret                                         # Return</span><br><span class="line"></span><br><span class="line">.pos 0x200                                  # Stack starts here and grows to lower addresses</span><br><span class="line">stack:</span><br></pre></td></tr></table></figure>
<ul>
<li><p>Words beginning with &apos;.&apos; are assembler directives telling the
assembler to <strong>adjust the address at which it is generating code
or to insert some words of data</strong>.</p>
<ul>
<li><p>The directive <code>.pos 0</code> indicates that <strong>the
assembler should begin generating code starting at address
0</strong>.</p></li>
<li><p>The next instruction <code>irmovq stack, %rsp</code> initializes
the stack pointer.</p>
<ul>
<li>The label <code>stack</code> is declared at the end of the program,
to indicate address 0x200 using a .pos directive. Our stack will
therefore <strong>start at this address and grow toward lower
addresses</strong>.</li>
</ul></li>
<li><p>The label <code>array</code> denotes the start of this array, and
is aligned on an 8-byte boundary using the <code>.align</code>
directive. The array stores 4 words.</p></li>
</ul></li>
</ul>
<p>&#x2003;&#x2003;Since our only tool for creating Y86-64 code is an assembler, the
programmer must perform tasks we ordinarily delegate to the compiler,
linker, and run-time system.</p>
<p>&#x2003;&#x2003;The <code>YIS</code> tools is used to simulate the execution of the
Y86-64 machine-code program. If we run our object code on
<code>YIS</code>, we will get the following output:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Stopped in 34 steps at PC = 0x13. Status &apos;HLT&apos;, CC Z=1 S=0 O=0</span><br><span class="line">Changes to registers:</span><br><span class="line">%rax:   0x0000000000000000 0x0000abcdabcdabcd</span><br><span class="line">%rsp:   0x0000000000000000 0x0000000000000200</span><br><span class="line">%rdi:   0x0000000000000000 0x0000000000000038</span><br><span class="line">%r8:    0x0000000000000000 0x0000000000000008</span><br><span class="line">%r9:    0x0000000000000000 0x0000000000000001</span><br><span class="line">%r10:   0x0000000000000000 0x0000a000a000a000</span><br><span class="line"></span><br><span class="line">Changes to memory:</span><br><span class="line">0x01f0: 0x0000000000000000 0x0000000000000055</span><br><span class="line">0x01f8: 0x0000000000000000 0x0000000000000013</span><br></pre></td></tr></table></figure>
<ul>
<li><p>The first line of the simulation output summarizes the execution
and the resulting values of the PC and program status.</p></li>
<li><p>The original values of the register are shown on the
left.</p></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/07/19/3-11-Floating-Point-Code/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/07/19/3-11-Floating-Point-Code/" class="post-title-link" itemprop="url">3.11.Floating-Point Code</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-07-19 21:31:22" itemprop="dateCreated datePublished" datetime="2024-07-19T21:31:22+08:00">2024-07-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-07-20 18:35:52" itemprop="dateModified" datetime="2024-07-20T18:35:52+08:00">2024-07-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CSAPP/" itemprop="url" rel="index"><span itemprop="name">CSAPP</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CSAPP/Chapter-3-Machine-level-Representation-of-Program/" itemprop="url" rel="index"><span itemprop="name">Chapter 3.Machine-level Representation of Program</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>1.2k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>5 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="311floating-point-code"><span class="math inline">\(3.11.\)</span>Floating-Point Code</h1>
<h3 id="1floating-pointmovement-and-conversion-operations">1.Floating-Point
Movement and Conversion Operations</h3>
<h4 id="abasic-instructions">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>Basic instructions</h4>
<ul>
<li><p>For floating-point, the data are held either in memory (indicated
in the table as <span class="math inline">\(M_{32}\)</span> and <span class="math inline">\(M_{64}\)</span>) or in XMM registers (shown in the
table as <code>X</code>).</p>
<ul>
<li>Each YMM register is 32 bytes long. When operating on scalar data,
these registers only hold floating-point data, and <strong>only the
low-order 32 bits (for float) or 64 bits (for double) are
used</strong>.</li>
</ul></li>
</ul>
<p><img src="/2024/07/19/3-11-Floating-Point-Code/image.png"></p>
<hr>
<p><img src="/2024/07/19/3-11-Floating-Point-Code/image-1.png"></p>
<ul>
<li>The &apos;a&apos; stands for &apos;aligned&apos;.</li>
</ul>
<hr>
<p><img src="/2024/07/19/3-11-Floating-Point-Code/image-2.png"></p>
<p><img src="/2024/07/19/3-11-Floating-Point-Code/image-3.png"></p>
<ul>
<li>When converting floating-point values to integers, the two-operand
floating-point conversion operations <strong>perform truncation,
rounding values toward zero</strong>.</li>
</ul>
<p>&#x2003;&#x2003;For three-operand floating-point conversion operations, we can
<strong>ignore the second operand, since its value only affects the
upper bytes of the result</strong>. In common use, both the second
source and the destination oprands are identical:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vcvtsi2sdq %rax, %xmm1, %xmm1</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;This instruction reads a long integer from register
<code>%rax</code>, converts it to data type double, and <strong>stores
the result in the lower bytes of XMM register
<code>%xmm1</code></strong>.</p>
<h4 id="bconversion-between-floating-point">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Conversion between floating-point</h4>
<p>&#x2003;&#x2003;To convert between two different floating-point format, suppose the
low-order 4 bytes of <code>%xmm0</code> hold a single-precision value;
then it would seem straightforward to convert this to a double-precision
value and store the result in the lower 8 bytes of register
<code>%xmm0</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vcvtss2sd %xmm0, %xmm0, %xmm0</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;However, GCC will generate the following code:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Conversion from single to double precision</span><br><span class="line">vunpcklps %xmm0, %xmm0, %xmm0   # Replicate first vector element</span><br><span class="line">vcvtps2pd %xmm0, %xmm0          # Convert two vector elements to double</span><br></pre></td></tr></table></figure>
<ul>
<li><p>The <code>vunpcklps</code> instruction <strong>interleaves the
values in two XMM registers and store them in a third</strong>. That is,
if one source register contains words <span class="math inline">\([s_3,
s_2, s_1, s_0]\)</span> and the other contains words <span class="math inline">\([d_3, d_2, d_1, d_0]\)</span>, then the value of
the destination register will be <span class="math inline">\([s_1, d_1,
s_0, d_0]\)</span>.</p></li>
<li><p>The <code>vcvtps2pd</code> instruction <strong>expands the two
low-order single precision values in the source XMM register to be the
two double-precision values in the destination XMM register</strong>.
Applying this to the result of the preceding <code>vunpcklps</code>
instruction would give values <span class="math inline">\([dx_0,dx_0]\)</span>, where <span class="math inline">\(dx_0\)</span> is the result of converting <span class="math inline">\(x\)</span> to double precision.</p></li>
</ul>
<p>&#x2003;&#x2003;GCC generates similar code for converting from double precision to
single precision:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Conversion from double to single precision</span><br><span class="line">vmovddup %xmm0, %xmm0    # Replicate first vector element</span><br><span class="line">vcvtpd2ps %xmm0, %xmm0  # Convert two vector elements to single</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;rather than by using the single instruction:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vcvtsd2ss %xmm0, %xmm0, %xmm0</span><br></pre></td></tr></table></figure>
<h3 id="2floating-point-code-inprocedure">2.Floating-Point Code in
Procedure</h3>
<p><img src="/2024/07/19/3-11-Floating-Point-Code/image.png"></p>
<p>&#x2003;&#x2003;The following conventions are observed:</p>
<ul>
<li><p>Up to eight floating-point arguments can be passed in XMM
registers <code>%xmm0~%xmm7</code>. These registers are used in the
order the arguments are listed. Additional floating-point arguments can
be passed on the stack.</p></li>
<li><p>A function that returns a floating-point value does so in
register <code>%xmm0</code>.</p></li>
<li><p><strong>All XMM registers are caller saved</strong>. The callee
may overwrite any of these registers without first saving it.</p></li>
</ul>
<p>&#x2003;&#x2003;When a function contains a combination of pointer, integer, and
floating-point arguments, the pointers and integers are passed in
general-purpose registers, while the floating-point values are passed in
XMM registers. This means that <strong>the mapping of arguments to
registers depends on both their types and their ordering</strong>.</p>
<p>&#x2003;&#x2003;<span class="math inline">\(e.g.\)</span></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">double</span> <span class="title function_">g1</span><span class="params">(<span class="type">double</span> a, <span class="type">long</span> b, <span class="type">float</span> c, <span class="type">int</span> d)</span></span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;Registers: <code>a</code> in <code>%xmm0</code>, <code>b</code> in
<code>%rdi</code>, <code>c</code> in<code>%xmm1</code>, <code>d</code>
in <code>%esi</code>.</p>
<h3 id="3floating-pointarithmetic-operations">3.Floating-Point
Arithmetic Operations</h3>
<p><img src="/2024/07/19/3-11-Floating-Point-Code/image-4.png"></p>
<ul>
<li><p>The first source operand S1 can be <strong>either an XMM register
or a memory location</strong>.</p></li>
<li><p>The second source operand and the destination operands
<strong>must be XMM registers</strong>.</p></li>
</ul>
<p>&#x2003;&#x2003;Take the following C program as an example:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">double</span> <span class="title function_">funct</span><span class="params">(<span class="type">double</span> a, <span class="type">float</span> x, <span class="type">double</span> b, <span class="type">int</span> i)</span> {</span><br><span class="line">    <span class="keyword">return</span> a * x - b / i;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># double funct(double a, float x, double b, int i)</span><br><span class="line"># a in %xmm0, x in %xmm1, b in %xmm2, i in %edi</span><br><span class="line"></span><br><span class="line">funct:</span><br><span class="line">    vunpcklps %xmm1, %xmm1, %xmm1  # Convert x to double</span><br><span class="line">    vcvtps2pd %xmm1, %xmm1         # Convert x to double</span><br><span class="line">    vmulsd %xmm0, %xmm1, %xmm0     # Multiply a by x</span><br><span class="line">    vcvtsi2sd %edi, %xmm1, %xmm1   # Convert i to double</span><br><span class="line">    vdivsd %xmm1, %xmm2, %xmm2     # Compute b/i</span><br><span class="line">    vsubsd %xmm2, %xmm0, %xmm0     # Subtract from a*x</span><br><span class="line">    ret                            # Return</span><br></pre></td></tr></table></figure>
<hr>
<p><img src="/2024/07/19/3-11-Floating-Point-Code/image-5.png"></p>
<p>&#x2003;&#x2003;Sometimes the bitwise operations are a useful way to manipulate
floating-point values. The following are some examples:</p>
<p>&#x2003;&#x2003;<span class="math inline">\(a.\)</span>Taking absolute value:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vmovsd .LC1(%rip), %xmm1</span><br><span class="line">vandpd %xmm1, %xmm0, %xmm0</span><br><span class="line"></span><br><span class="line">.LC1:</span><br><span class="line">    .long 4294967295</span><br><span class="line">    .long 2147483647</span><br><span class="line">    .long 0</span><br><span class="line">    .long 0</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Set value to zero:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vxorpd %xmm0, %xmm0, %xmm0</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;<span class="math inline">\(c.\)</span>Negate</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vmovsd .LC2(%rip), %xmm1</span><br><span class="line">vxorpd %xmm1, %xmm0, %xmm0</span><br><span class="line"></span><br><span class="line">.LC2:</span><br><span class="line">    .long 0</span><br><span class="line">    .long -2147483648</span><br><span class="line">    .long 0</span><br><span class="line">    .long 0</span><br></pre></td></tr></table></figure>
<h3 id="4defining-andusing-floating-point-constants">4.Defining and
Using Floating-Point Constants</h3>
<p>&#x2003;&#x2003;AVX floating-point operations cannot have immediate values as
oprands. Instead, the compiler must <strong>allocate and initialize
storage for any constant values</strong>.</p>
<p>&#x2003;&#x2003;Take the following C program as an example:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">double</span> <span class="title function_">cel2fahr</span><span class="params">(<span class="type">double</span> temp)</span> {</span><br><span class="line"><span class="keyword">return</span> <span class="number">1.8</span> * temp + <span class="number">32.0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cel2fahr:</span><br><span class="line">vmulsd .LC2(%rip), %xmm0, %xmm0  # Multiply by 1.8</span><br><span class="line">vaddsd .LC3(%rip), %xmm0, %xmm0  # Add 32.0</span><br><span class="line">ret</span><br><span class="line"></span><br><span class="line">.LC2:</span><br><span class="line">.long 3435973837                 # Low-order 4 bytes of 1.8</span><br><span class="line">.long 1073532108                 # High-order 4 bytes of 1.8</span><br><span class="line"></span><br><span class="line">.LC3:</span><br><span class="line">.long 0                          # Low-order 4 bytes of 32.0</span><br><span class="line">.long 1077936128                 # High-order 4 bytes of 32.0</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;the function reads the value 1.8 from the memory location labeled
<code>.LC2</code> and the value 32.0 from the memory location labeled
<code>.LC3</code>.</p>
<h3 id="5floating-pointcomparison-operations">5.Floating-Point
Comparison Operations</h3>
<p><img src="/2024/07/19/3-11-Floating-Point-Code/image-6.png"></p>
<ul>
<li><p>These instructions are similar to the <code>cmp</code>
instructions for integer: they <strong>compare operands S1 and S2 and
set the condition codes to indicate their relative
values</strong>.</p></li>
<li><p>As with <code>cmpq</code>, they follow the ATT-format convention
of <strong>listing the operands in reverse order</strong>.</p></li>
<li><p>Argument S2 must be in <strong>an XMM register</strong>, while S1
can be <strong>either in an XMM register or in memory</strong>.</p></li>
</ul>
<p>&#x2003;&#x2003;The floating-point comparison instructions set three condition
codes: the zero flag, the carry flag, and the parity flag:</p>
<p><img src="/2024/07/19/3-11-Floating-Point-Code/image-7.png"></p>
<ul>
<li><p>The parity flag is set when <strong>either operand is <span class="math inline">\(NaN\)</span></strong>.</p></li>
<li><p>By convention, <strong>any comparison in C is considered to fail
when one of the arguments is <span class="math inline">\(NaN\)</span></strong>, and this flag is used to
detect such a condition. For example, even the comparison
<code>x == x</code> yields 0 when x is <span class="math inline">\(NaN\)</span>.</p></li>
<li><p>The unordered case occurs when <strong>either operand is <span class="math inline">\(NaN\)</span></strong>.</p></li>
</ul>
<p>&#x2003;&#x2003;There are also three relative jump statements:</p>
<ul>
<li><p><code>jp</code>: It conditionally jump when a floating-point
comparison <strong>yields an unordered result</strong>.</p></li>
<li><p><code>ja</code>: It conditionally jump when <code>CF=0</code> and
<code>ZF=0</code>.</p></li>
<li><p><code>jb</code>: It conditionally jump when
<code>CF=1</code></p></li>
</ul>
<p>&#x2003;&#x2003;Take the following C program as an example:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span> {</span>NEG, ZERO, POS, OTHER} <span class="type">range_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">range_t</span> <span class="title function_">find_range</span><span class="params">(<span class="type">float</span> x)</span> {</span><br><span class="line">    <span class="type">int</span> result;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>)</span><br><span class="line">        result = NEG;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (x == <span class="number">0</span>)</span><br><span class="line">        result = ZERO;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (x &gt; <span class="number">0</span>)</span><br><span class="line">        result = POS;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        result = OTHER;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">find_range:</span><br><span class="line">    vxorps %xmm1, %xmm1, %xmm1  # Set %xmm1 = 0</span><br><span class="line">    vucomiss %xmm0, %xmm1       # Compare 0:x</span><br><span class="line">    ja .L5                      # If &gt;, goto neg</span><br><span class="line">    vucomiss %xmm1, %xmm0       # Compare x:0</span><br><span class="line">    jp .L8                      # If NaN, goto posornan</span><br><span class="line">    movl $1, %eax               # result = ZERO</span><br><span class="line">    je .L3                      # If =, goto done</span><br><span class="line">.L8: posornan:</span><br><span class="line">    vucomiss .LC0(%rip), %xmm0  # Compare x:0</span><br><span class="line">    setbe %al                   # Set result = NaN?1:0</span><br><span class="line">    movzbl %al, %eax            # Zero-extend</span><br><span class="line">    addl $2, %eax               # result += 2 (POS for &gt; 0, OTHER for NaN)</span><br><span class="line">    ret                         # Return</span><br><span class="line">.L5: neg:</span><br><span class="line">    movl $0, %eax               # result = NEG</span><br><span class="line">.L3: done:</span><br><span class="line">    rep; ret                    # Return</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/07/18/3-10-Combining-Control-and-Data-in-Machine-Level-Programs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/07/18/3-10-Combining-Control-and-Data-in-Machine-Level-Programs/" class="post-title-link" itemprop="url">3.10.Combining Control and Data in Machine-Level Programs</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-07-18 15:31:22" itemprop="dateCreated datePublished" datetime="2024-07-18T15:31:22+08:00">2024-07-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-07-19 21:33:07" itemprop="dateModified" datetime="2024-07-19T21:33:07+08:00">2024-07-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CSAPP/" itemprop="url" rel="index"><span itemprop="name">CSAPP</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CSAPP/Chapter-3-Machine-level-Representation-of-Program/" itemprop="url" rel="index"><span itemprop="name">Chapter 3.Machine-level Representation of Program</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>1.7k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>6 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="310combining-control-and-data-inmachine-level-programs"><span class="math inline">\(3.10.\)</span>Combining Control and Data in
Machine-Level Programs</h1>
<h3 id="1understanding-pointers">1.Understanding Pointers</h3>
<p>&#x2003;&#x2003;Pointers serve as a uniform way to <strong>generate references to
elements</strong> within different data structures.</p>
<p>&#x2003;&#x2003;They are some key principles of pointers:</p>
<ol type="1">
<li><p>Every pointer has an associated type. This type indicates
<strong>what kind of object the pointer points to</strong>. The
<code>void *</code> pointer represents a generic pointer.</p></li>
<li><p>Every pointer has a value. This value is <strong>an address of
some object of the designated type</strong>.</p></li>
<li><p>Pointers are created with the <code>&amp;</code> operator. This
operator can be applied to any C expression that is categorized as an
<em>lvalue</em>, meaning an expression that <strong>can appear on the
left side of an assignment</strong>.</p>
<ul>
<li>The operation is often realized by <code>leaq</code>.</li>
</ul></li>
<li><p>Pointers are dereferenced with the `*`` operator. It&apos;s
implemented by a memory reference.</p></li>
<li><p><em>Casting</em> the type of pointer <strong>don&apos;t change its
value</strong> but lead to other changes. One effect is to
<strong>change any scaling of pointer arithmetic</strong>.</p>
<ul>
<li>For example, if we have a char pointer with value <code>p</code>,
then <code>(int*)p + 7</code> computes <code>p + 28</code>, while
<code>(int*)(p + 7)</code> computes <code>p + 7</code>.</li>
</ul></li>
<li><p>Pointers can also point to functions, and the value of a function
pointer is <strong>the address of the first instruction in the
machine-code representatio</strong>n of the function.</p>
<ul>
<li>Take the following function as an example:</li>
</ul></li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">fun</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> *p)</span>;</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;&#x2003;&#x2003;and we declare a fucntions pointer <code>fp</code>:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> (*fp)(<span class="type">int</span>, <span class="type">int</span> *);</span><br><span class="line">fp = fun;</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;&#x2003;&#x2003;Then we can use <code>fp</code> to invoke the function:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> y = <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> result = fp(<span class="number">3</span>, &amp;y);</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>The parentheses around <code>*fp</code> are
required</strong>, or it will be recognized as
<code>(int *) fp(int, int *)</code>, which is a function prototype.</p>
</blockquote>
<h3 id="2thwarting-buffer-overflowattacks">2.Thwarting Buffer Overflow
Attacks</h3>
<h4 id="abuffer-overflow-amp-attacks">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>Buffer overflow &amp; attacks</h4>
<p>&#x2003;&#x2003;<em>Buffer overflow</em> is a specific type of out-of-bound memory
reference. A typical case of <em>buffer overflow</em> is that: some
character array is allocated on the stack to hold a string, but
<strong>the size of the string exceeds the space allocated for the
array</strong>.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *<span class="title function_">gets</span><span class="params">(<span class="type">char</span> *s)</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">int</span> c;</span><br><span class="line">    <span class="type">char</span> *dest = s;</span><br><span class="line">    <span class="keyword">while</span> ((c = getchar()) != <span class="string">&apos;\n&apos;</span> &amp;&amp; c != EOF)</span><br><span class="line">        *dest++ = c;</span><br><span class="line">    <span class="keyword">if</span> (c == EOF &amp;&amp; dest == s)</span><br><span class="line">        <span class="comment">/* No characters read */</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    *dest++ = <span class="string">&apos;\0&apos;</span>; <span class="comment">/* Terminate string */</span></span><br><span class="line">    <span class="keyword">return</span> s;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Read input line and write it back */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">echo</span><span class="params">()</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">8</span>]; <span class="comment">/* Way too small! */</span></span><br><span class="line">    gets(buf);</span><br><span class="line">    <span class="built_in">puts</span>(buf);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;The problem with <code>gets</code> is that <strong>it has no way to
determine whether sufficient space has been allocated to hold the entire
string</strong>. In our <code>echo</code> example, any string longer
than seven characters will cause an out-of-bounds write. This will
<strong>overwrite some of the information stored on the stack</strong>,
and as the string gets longer, the following information will get
corrupted.</p>
<ul>
<li><p>Buffer overflow is used to <strong>get a program to perform a
function that it would otherwise be unwilling to do</strong>.</p>
<ul>
<li>Typically, the program is fed with a string that contains the byte
encoding of some executable code, called the <em>exploit code</em>, plus
some extra bytes that <strong>overwrite the return address with a
pointer to the exploit code</strong>. The effect of executing the
<code>ret</code> instruction is then to <strong>jump to the exploit
code</strong>.</li>
</ul></li>
</ul>
<h4 id="bstack-randomization">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Stack randomization</h4>
<p>&#x2003;&#x2003;In order to insert exploit code into a system, the attacker needs
to inject <strong>both the code as well as a pointer</strong> to this
code as part of the attack string. Generating this pointer requires
<strong>knowing the stack address</strong> where the string will be
located.</p>
<ul>
<li><p>The idea of stack randomization is to <strong>make the position
of the stack vary from one run of a program to another</strong>. This is
implemented by <strong>allocating a random amount of space between 0 and
n bytes on the stack at the start of a program</strong>.</p>
<ul>
<li>for example, by using the allocation function <code>alloca</code>,
which allocates space for a specified number of bytes on the stack.
<strong>This allocated space is not used by the program, but it causes
all subsequent stack locations to vary from one execution of a program
to another</strong>.</li>
</ul></li>
</ul>
<p>&#x2003;&#x2003;Stack randomization is one of a larger class of techniques known as
<strong>address-space layout randomization, or ASLR</strong>. With ASLR,
different parts of the program, including program code, library code,
stack, global variables, and heap data, <strong>are loaded into
different regions of memory each time a program is run</strong>.</p>
<h4 id="cstack-corruption-detection">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>Stack corruption detection</h4>
<p>&#x2003;&#x2003;A second line of defense is to <strong>be able to detect when a
stack has been corrupted</strong>. It&apos; hard to prevent the behavious,
however, the program can attempt to <strong>detect when such a write has
occurred before it can have any harmful effects</strong>.</p>
<ul>
<li><p>The GCC use a mechanisim known as a <em>stack protector</em> into
the generated code to detect buffer overruns.</p>
<ul>
<li><p>The idea is to <strong>store a special <em>canary value(guard
value)</em> in the stack frame between any local buffer and the rest of
the stack state</strong>. The value is generated randomly each time the
program runs:</p></li>
<li><p>Before restoring the register state and returning from the
function, <strong>the program checks if the canary has been altered by
some operation of this function or one that it has called</strong>. If
so, the program <strong>aborts with an error</strong>.</p></li>
</ul></li>
</ul>
<p><img src="/2024/07/18/3-10-Combining-Control-and-Data-in-Machine-Level-Programs/image.png"></p>
<p>&#x2003;&#x2003;Recent version of GCC inserts this type of overflow detection
automatically. We have to give the command-line option
<code>-fno-stack-protector</code>.</p>
<p>&#x2003;&#x2003;The following code uses the overflow detection techniques:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">echo:</span><br><span class="line">    subq $24, %rsp        # Allocate 24 bytes on stack</span><br><span class="line">    movq %fs:40, %rax     # Retrieve canary</span><br><span class="line">    movq %rax, 8(%rsp)    # Store on stack</span><br><span class="line">    xorl %eax, %eax       # Zero out register</span><br><span class="line">    movq %rsp, %rdi       # Compute buf as %rsp</span><br><span class="line">    call gets             # Call gets</span><br><span class="line">    movq %rsp, %rdi       # Compute buf as %rsp</span><br><span class="line">    call puts             # Call puts</span><br><span class="line">    movq 8(%rsp), %rax    # Retrieve canary</span><br><span class="line">    xorq %fs:40, %rax     # Compare to stored value</span><br><span class="line">    je .L9                # If =, goto ok</span><br><span class="line">    call __stack_chk_fail # Stack corrupted!</span><br><span class="line">.L9:</span><br><span class="line">    addq $24, %rsp        # Deallocate stack space</span><br><span class="line">    ret</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003; The instruction argument <code>%fs:40</code> is an indication that
<strong>the canary value is read from memory using <em>segmented
addressing</em></strong>.</p>
<ul>
<li><p>By storing the canary in a special segment, it can be marked as
<strong>&quot;read only&quot;</strong>, so that an attacker cannot overwrite the
stored canary value.</p></li>
<li><p>Before restoring the register state and returning, the function
<strong>compares the value stored at the stack location with the canary
value</strong> (<strong>via the <code>xorq</code> instruction on line
11</strong>). <strong>A nonzero value indicates that the canary on the
stack has been modified</strong>, and so the code will call an error
routine.</p></li>
</ul>
<h4 id="dordering-rearrangement">&#x2003;&#x2003;<span class="math inline">\(d.\)</span>Ordering rearrangement</h4>
<p>&#x2003;&#x2003;<span class="math inline">\(e.g.\)</span>Let&apos;s discuss the
following C program:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">len</span><span class="params">(<span class="type">char</span> *s)</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">strlen</span>(s);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">iptoa</span><span class="params">(<span class="type">char</span> *s, <span class="type">long</span> *p)</span> {</span><br><span class="line">    <span class="type">long</span> val = *p;</span><br><span class="line">    <span class="built_in">sprintf</span>(s, <span class="string">&quot;%ld&quot;</span>, val);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">intlen</span><span class="params">(<span class="type">long</span> x)</span> {</span><br><span class="line">    <span class="type">long</span> v;</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">12</span>];</span><br><span class="line">    v = x;</span><br><span class="line">    iptoa(buf, &amp;v);</span><br><span class="line">    <span class="keyword">return</span> len(buf);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;And the following show portions of the code for
<code>intlen</code>, compiled both with and without stack protector:</p>
<p>&#x2003;&#x2003;<span class="math inline">\(a.\)</span></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># int intlen(long x)</span><br><span class="line"># x in %rdi</span><br><span class="line">intlen:</span><br><span class="line">    subq $40, %rsp</span><br><span class="line">    movq %rdi, 24(%rsp)</span><br><span class="line">    leaq 24(%rsp), %rsi</span><br><span class="line">    movq %rsp, %rdi</span><br><span class="line">    call iptoa</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;<span class="math inline">\(b.\)</span></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># int intlen(long x)</span><br><span class="line"># x in %rdi</span><br><span class="line">intlen:</span><br><span class="line">    subq $56, %rsp</span><br><span class="line">    movq %fs:40, %rax</span><br><span class="line">    movq %rax, 40(%rsp)</span><br><span class="line">    xorl %eax, %eax</span><br><span class="line">    movq %rdi, 8(%rsp)</span><br><span class="line">    leaq 8(%rsp), %rsi</span><br><span class="line">    leaq 16(%rsp), %rdi</span><br><span class="line">    call iptoa</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;In the protected code, <strong>local variable <code>v</code> is
positioned closer to the top of the stack than
<code>buf</code></strong>, and so a<strong>n overrun of <code>buf</code>
will not corrupt the value of <code>v</code></strong>.</p>
<h4 id="elimiting-executable-code-regions">&#x2003;&#x2003;<span class="math inline">\(e.\)</span>Limiting executable code regions</h4>
<p>&#x2003;&#x2003;A final step is to eliminate the ability of an attacker to insert
executable code into a system. One method is to <strong>limit which
memory regions hold executable code</strong>. In typical programs,
<strong>only the portion of memory holding the code generated by the
compiler need be executable</strong>. <strong>The other portions can be
restricted to allow just reading and writing</strong>.</p>
<ul>
<li><p>Many systems allow control over three forms of access:
<strong>read</strong> (reading data from memory), <strong>write</strong>
(storing data into memory), and <strong>execute</strong> (treating the
memory contents as machine-level code).</p></li>
<li><p><code>AMD</code> introduced an <code>NX</code> (for &quot;no-execute&quot;)
bit into the memory protection for its 64-bit processors,
<strong>separating the read and execute access modes</strong>. With this
feature, the stack can be marked as being readable and writable, but not
executable, and <strong>the checking of whether a page is executable is
performed in hardware</strong>, with no penalty in efficiency.</p></li>
</ul>
<h3 id="3variable-size-stack-frames">3.Variable-Size Stack Frames</h3>
<p>&#x2003;&#x2003;Some functions require a variable amount of space that must be
allocated for their stack frames, such as a local array declared with
variable size:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="title function_">vframe</span><span class="params">(<span class="type">long</span> n, <span class="type">long</span> idx, <span class="type">long</span> *q)</span> {</span><br><span class="line">    <span class="type">long</span> i;</span><br><span class="line">    <span class="type">long</span> *p[n];</span><br><span class="line">    p[<span class="number">0</span>] = &amp;i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; n; i++)</span><br><span class="line">        p[i] = q;</span><br><span class="line">    <span class="keyword">return</span> *p[idx];</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;To manage a variable-size stack frame, x86-64 code uses
<code>%rbp</code> to serve as a <em>frame pointer</em>(sometimes
referred to as a <em>base pointer</em>). When using a frame pointer, the
stack frame is organized as below:</p>
<p><img src="/2024/07/18/3-10-Combining-Control-and-Data-in-Machine-Level-Programs/image-1.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># long vframe(long n, long idx, long *q)</span><br><span class="line"># n in %rdi, idx in %rsi, q in %rdx</span><br><span class="line"># Only portions of code shown</span><br><span class="line"></span><br><span class="line">vframe:</span><br><span class="line">    pushq %rbp      # Save old %rbp</span><br><span class="line">    movq %rsp, %rbp # Set frame pointer</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    leave           # Restore %rbp and %rsp</span><br><span class="line">    ret             # Return</span><br></pre></td></tr></table></figure>
<ul>
<li><p>The code must save the previous version of <code>%rbp</code> on
the stack, since it is a callee-saved register. It then <strong>keeps
<code>%rbp</code> pointing to this position throughout the execution of
the function</strong>, and it references fixed-length local variables,
such as <code>i</code>, at <strong>offsets relative to
<code>%rbp</code></strong>.</p>
<ul>
<li>So the code start by pushing the current value of <code>%rbp</code>
onto the stack and setting %rbp to point to this stack position</li>
</ul></li>
<li><p>At the end of the function, the frame pointer is restored to its
previous value using the <code>leave</code> instruction. This
instruction takes no arguments. It is equivalent to executing the
following two instructions:</p></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">movq %rbp, %rsp     # Set stack pointer to beginning of frame</span><br><span class="line">popq %rbp           # Restore saved %rbp and set stack ptr</span><br><span class="line">                    # to end of caller&#xFFFD;&#xFFFD;s frame</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/07/17/3-9-Heterogeneous-Data-Structures/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/07/17/3-9-Heterogeneous-Data-Structures/" class="post-title-link" itemprop="url">3.9.Heterogeneous Data Structures</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-07-17 22:31:22" itemprop="dateCreated datePublished" datetime="2024-07-17T22:31:22+08:00">2024-07-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-07-18 18:01:14" itemprop="dateModified" datetime="2024-07-18T18:01:14+08:00">2024-07-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CSAPP/" itemprop="url" rel="index"><span itemprop="name">CSAPP</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CSAPP/Chapter-3-Machine-level-Representation-of-Program/" itemprop="url" rel="index"><span itemprop="name">Chapter 3.Machine-level Representation of Program</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>860</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>3 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="39heterogeneous-data-structures"><span class="math inline">\(3.9.\)</span>Heterogeneous Data Structures</h1>
<h3 id="1structures">1.Structures</h3>
<p>&#x2003;&#x2003;The implementation of structures is similar to that of arrays: all
of the components of a structure are stored <strong>in a contiguous
region of memory</strong> and <strong>a pointer to a structure is the
address of its first byte</strong>.</p>
<p>&#x2003;&#x2003;The compiler maintains information about each structure type
indicating <strong>the byte offset of each field</strong>.</p>
<ul>
<li>It generates references to structure elements <strong>using these
offsets as displacements</strong> in memory referencing
instructions.</li>
</ul>
<p>&#x2003;&#x2003;For example, the structure below:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rec</span> {</span></span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="type">int</span> j;</span><br><span class="line">    <span class="type">int</span> a[<span class="number">2</span>];</span><br><span class="line">    <span class="type">int</span> *p;</span><br><span class="line">};</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;is represented in memory like this:</p>
<p><img src="/2024/07/17/3-9-Heterogeneous-Data-Structures/image.png"></p>
<p>&#x2003;&#x2003;and the compiler access the code by <strong>adding the appropriate
offset to the address of the structure</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Registers: r in %rdi</span><br><span class="line">movl (%rdi), %eax   # Get r-&gt;i</span><br><span class="line">movl %eax, 4(%rdi)  # Store in r-&gt;j</span><br></pre></td></tr></table></figure>
<ul>
<li>To generate a pointer to an object within a structure, we simply add
the field&apos;s offset to the structure address:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Registers: r in %rdi, i %rsi</span><br><span class="line">leaq 8(%rdi,%rsi,4), %rax    # Set %rax to &amp;r-&gt;a[i]</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;The selection of the different fields of a structure is handled
completely <strong>at compile time</strong>. The machine code contains
no information about the field declarations or the names of the
fields.</p>
<h3 id="2unions">2.Unions</h3>
<p>&#x2003;&#x2003;Unions allow a single object to be referenced according to multiple
types. Rather than having the different fields reference different
blocks of memory, they all <strong>reference the same
block</strong>.</p>
<ul>
<li>The overall size of a union equals <strong>the maximum size of any
of its fields</strong>.</li>
</ul>
<p>&#x2003;&#x2003;Unions are used in several cases:</p>
<ol type="1">
<li>We know in advance that the use of two different fields in a data
structure will be <strong>mutually exclusive</strong>.</li>
</ol>
<p>&#x2003;&#x2003;For example, we can represent a binary tree using structure:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node_s</span> {</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node_s</span> *<span class="title">left</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node_s</span> *<span class="title">right</span>;</span></span><br><span class="line">    <span class="type">double</span> data[<span class="number">2</span>];</span><br><span class="line">};</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;which use 32 bytes. But if we use union:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">union</span> <span class="title">node_u</span></span></span><br><span class="line"><span class="class">{</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">        <span class="class"><span class="keyword">union</span> <span class="title">node_u</span> *<span class="title">left</span>;</span></span><br><span class="line">        <span class="class"><span class="keyword">union</span> <span class="title">node_u</span> *<span class="title">right</span>;</span></span><br><span class="line">    } internal;</span><br><span class="line">    <span class="type">double</span> data[<span class="number">2</span>];</span><br><span class="line">};</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;it will only take up 16 bytes.</p>
<p>&#x2003;&#x2003;Moreover, to identify <code>leaf</code> with <code>internal</code>
node, we can use <strong>an enumerated type defining the different
possible choices for the union</strong>, and then create a structure
<strong>containing a tag field and the union</strong>:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span> {</span> N_LEAF, N_INTERNAL } <span class="type">nodetype_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node_t</span> {</span></span><br><span class="line">    <span class="type">nodetype_t</span> type;</span><br><span class="line">    <span class="class"><span class="keyword">union</span> {</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">node_t</span> *<span class="title">left</span>;</span></span><br><span class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">node_t</span> *<span class="title">right</span>;</span></span><br><span class="line">        } internal;</span><br><span class="line">        <span class="type">double</span> data[<span class="number">2</span>];</span><br><span class="line">    } info;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">// example</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// leaves</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node_t</span> *<span class="title">leaf</span> =</span> <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <span class="type">node_t</span>));</span><br><span class="line">    leaf-&gt;type = N_LEAF;</span><br><span class="line">    leaf-&gt;info.data[<span class="number">0</span>] = <span class="number">1.23</span>;</span><br><span class="line">    leaf-&gt;info.data[<span class="number">1</span>] = <span class="number">4.56</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// internal</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node_t</span> *<span class="title">internal</span> =</span> <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <span class="type">node_t</span>));</span><br><span class="line">    internal-&gt;type = N_INTERNAL;</span><br><span class="line">    internal-&gt;info.internal.left = leaf;</span><br><span class="line">    internal-&gt;info.internal.right = <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>The union <strong>won&apos;t change the bit it stored according to
different types</strong>, even if the value is stored in one type but
access in another.</li>
</ol>
<p>&#x2003;&#x2003;Say we convert a <code>double d</code> to an
<code>unsigned long</code> variable:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">long</span> u = (<span class="type">unsigned</span> <span class="type">long</span>) d;</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;Value <code>u</code> will be an integer representation of
<code>d</code>. Except for the case where <code>d</code> is
<code>0.0</code>, the bit representation of <code>u</code> will
<strong>be very different from that of <code>d</code></strong>.</p>
<p>&#x2003;&#x2003;However, if we use unions:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">long</span> <span class="title function_">double2bits</span><span class="params">(<span class="type">double</span> d)</span> {</span><br><span class="line">    <span class="class"><span class="keyword">union</span> {</span></span><br><span class="line">        <span class="type">double</span> d;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">long</span> u;</span><br><span class="line">    } temp;</span><br><span class="line">    temp.d = d;</span><br><span class="line">    <span class="keyword">return</span> temp.u;</span><br><span class="line">};</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;The result will be that <strong><code>u</code> will have the same
bit representation as <code>d</code></strong>, including fields for the
sign bit, the exponent, and the significand.</p>
<p>&#x2003;&#x2003;And with this characteristic, we can design the following program
that gets the words of a double number:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">double</span> <span class="title function_">uu2double</span><span class="params">(<span class="type">unsigned</span> word0, <span class="type">unsigned</span> word1)</span> {</span><br><span class="line">    <span class="class"><span class="keyword">union</span> {</span></span><br><span class="line">        <span class="type">double</span> d;</span><br><span class="line">        <span class="type">unsigned</span> u[<span class="number">2</span>];</span><br><span class="line">    } temp;</span><br><span class="line">    temp.u[<span class="number">0</span>] = word0; <span class="comment">// low-order 4 bytes</span></span><br><span class="line">    temp.u[<span class="number">1</span>] = word1; <span class="comment">// high-order 4 bytes</span></span><br><span class="line">    <span class="keyword">return</span> temp.d;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="3data-alignment">3.Data Alignment</h3>
<p>&#x2003;&#x2003;<em>Data alignment</em> is operation that <strong>enforce the
address of some objects must be a multiple of some valueK (typically 2,
4, or 8)</strong>.</p>
<p><img src="/2024/07/17/3-9-Heterogeneous-Data-Structures/image-1.png"></p>
<ul>
<li>The align operation can be declared by the following statement:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.align 8</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;This ensures that <strong>the data following it will start with an
address that is a multiple of 8</strong>.</p>
<p>&#x2003;&#x2003;To do data alignment, the compiler uses these two techniques. Take
the following C struction as an example:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S1</span> {</span></span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="type">char</span> c;</span><br><span class="line">    <span class="type">int</span> j;</span><br><span class="line">};</span><br></pre></td></tr></table></figure>
<ol type="1">
<li><em>Byte gap</em>:</li>
</ol>
<p><img src="/2024/07/17/3-9-Heterogeneous-Data-Structures/image-2.png"></p>
<ol start="2" type="1">
<li><em>End padding</em>: This is to ensure that the latter data will
also be aligned:</li>
</ol>
<p><img src="/2024/07/17/3-9-Heterogeneous-Data-Structures/image-3.png"></p>
<blockquote>
<p><span class="math inline">\(p.s.\)</span>Each type of data has its
own alignment requirement, so we can minimize the wasted place by
<strong>rearrange the fields of structure</strong>. Note that <strong>we
don&apos;t have to make all variables applied to an only alignment
rule</strong>!</p>
</blockquote>
<p><span class="math inline">\(e.g.\)</span> The structure:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">    <span class="type">int</span> *a;</span><br><span class="line">    <span class="type">float</span> b;</span><br><span class="line">    <span class="type">char</span> c;</span><br><span class="line">    <span class="type">short</span> d;</span><br><span class="line">    <span class="type">long</span> e;</span><br><span class="line">    <span class="type">double</span> f;</span><br><span class="line">    <span class="type">int</span> g;</span><br><span class="line">    <span class="type">char</span> *h;</span><br><span class="line">} rec;</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;is rearranged to the structure below:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">    <span class="type">double</span> f;   <span class="comment">// 8 bytes</span></span><br><span class="line">    <span class="type">long</span> e;     <span class="comment">// 8 bytes</span></span><br><span class="line">    <span class="type">int</span> *a;     <span class="comment">// 8 bytes</span></span><br><span class="line">    <span class="type">char</span> *h;    <span class="comment">// 8 bytes</span></span><br><span class="line">    <span class="type">int</span> g;      <span class="comment">// 4 bytes</span></span><br><span class="line">    <span class="type">float</span> b;    <span class="comment">// 4 bytes</span></span><br><span class="line">    <span class="type">short</span> d;    <span class="comment">// 2 bytes</span></span><br><span class="line">    <span class="type">char</span> c;     <span class="comment">// 1 byte</span></span><br><span class="line">    <span class="comment">// 3 bytes padding to make the total size a multiple of 8</span></span><br><span class="line">} rec;</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;Following the strategy of <strong>putting the fields required for
larger alignment first</strong>.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/07/17/3-8-Array-Allocation-and-Access/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/07/17/3-8-Array-Allocation-and-Access/" class="post-title-link" itemprop="url">3.8.Array Allocation and Access</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>
      

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-07-17 17:32:22 / &#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;22:13:52" itemprop="dateCreated datePublished" datetime="2024-07-17T17:32:22+08:00">2024-07-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CSAPP/" itemprop="url" rel="index"><span itemprop="name">CSAPP</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CSAPP/Chapter-3-Machine-level-Representation-of-Program/" itemprop="url" rel="index"><span itemprop="name">Chapter 3.Machine-level Representation of Program</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>878</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>3 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="38array-allocation-and-access"><span class="math inline">\(3.8.\)</span>Array Allocation and Access</h1>
<h3 id="1pointer-arithmetic">1.Pointer Arithmetic</h3>
<p>&#x2003;&#x2003;Suppose the starting address of integer array <code>E</code> and
integer index <code>i</code> are stored in registers <code>%rdx</code>
and <code>%rcx</code>. Below are some assembly-code implementation of
array expressions, with the result being stored in either
<code>%eax</code>(for data) or register <code>%rax</code>(for
pointers):</p>
<p><img src="/2024/07/17/3-8-Array-Allocation-and-Access/image.png"></p>
<blockquote>
<p>The dereference of a pointer is through
<code>(register_name)</code>.</p>
</blockquote>
<blockquote>
<p>The final example shows that one can compute the difference of two
pointers within the same data structure, with the result being data
having type long and value equal to <strong>the difference of the two
addresses divided by the size of the data type</strong>.</p>
</blockquote>
<h3 id="2nested-arrays">2.Nested Arrays</h3>
<p>&#x2003;&#x2003;The array elements are ordered in memory in row-major order:</p>
<p><img src="/2024/07/17/3-8-Array-Allocation-and-Access/image-1.png"></p>
<p>&#x2003;&#x2003;Array element <code>M[i][j]</code> can be easily reached through a
series of arithmetic operations. For example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># A in %rdi, i in %rsi, and j in %rdx</span><br><span class="line">leaq (%rsi,%rsi,2), %rax  # Compute 3i</span><br><span class="line">leaq (%rdi,%rax,4), %rax  # Compute xA + 12i</span><br><span class="line">movl (%rax,%rdx,4), %eax  # Read from M[xA + 12i + 4]</span><br></pre></td></tr></table></figure>
<h3 id="3fixed-sized-arrays">3.Fixed-sized Arrays</h3>
<p>&#x2003;&#x2003;The C compiler is able to make many optimizations for code
operating on multi-dimensional arrays of fixed size. Take the inner
product calculation program as an example. The original form is as
below:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Compute i,k of fixed matrix product */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">fix_prod_ele</span><span class="params">(fix_matrix A, fix_matrix B, <span class="type">long</span> i, <span class="type">long</span> k)</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">long</span> j;</span><br><span class="line">    <span class="type">int</span> result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; N; j++)</span><br><span class="line">        result += A[i][j] * B[j][k];</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;The optimized C code is as below:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Compute i,k of fixed matrix product */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">fix_prod_ele_opt</span><span class="params">(fix_matrix A, fix_matrix B, <span class="type">long</span> i, <span class="type">long</span> k)</span> {</span><br><span class="line">    <span class="type">int</span> *Aptr = &amp;A[i][<span class="number">0</span>]; <span class="comment">/* Points to elements in row i of A */</span></span><br><span class="line">    <span class="type">int</span> *Bptr = &amp;B[<span class="number">0</span>][k]; <span class="comment">/* Points to elements in column k of B */</span></span><br><span class="line">    <span class="type">int</span> *Bend = &amp;B[N][k]; <span class="comment">/* Marks stopping point for Bptr */</span></span><br><span class="line">    <span class="type">int</span> result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span> {                         <span class="comment">/* No need for initial test */</span></span><br><span class="line">        result += *Aptr * *Bptr; <span class="comment">/* Add next product to sum */</span></span><br><span class="line">        Aptr ++;                 <span class="comment">/* Move Aptr to next column */</span></span><br><span class="line">        Bptr += N;               <span class="comment">/* Move Bptr to next row */</span></span><br><span class="line">    } <span class="keyword">while</span> (Bptr != Bend);      <span class="comment">/* Test for stopping point */</span></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;The optimization follows the following steps:</p>
<ol type="1">
<li><p>Generating a pointer, which we have named <code>Aptr</code>, that
points to successive elements in row <code>i</code> of
<code>A</code>.</p></li>
<li><p>Generating a pointer, which we have named <code>Bptr</code>, that
points to successive elements in column <code>k</code> of
<code>B</code>.</p></li>
<li><p>Generating a pointer, which we have named <code>Bend</code>, that
equals the value <code>Bptr</code> will have <strong>when it is time to
terminate the loop</strong>.</p></li>
</ol>
<p>&#x2003;&#x2003;The key points of optimization are as below:</p>
<ol type="1">
<li><p>Decide the <strong>starting address and end address of the
array</strong>.</p></li>
<li><p>Decide <strong>how to move the address forward</strong>.</p></li>
</ol>
<p>&#x2003;&#x2003;<span class="math inline">\(e.g.\)</span>The C program below:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Set all diagonal elements to val */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">fix_set_diag</span><span class="params">(fix_matrix A, <span class="type">int</span> val)</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">long</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">        A[i][i] = val;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;With the properties:</p>
<ul>
<li><p>Starting address: <code>&amp;A[0][0]</code>.</p></li>
<li><p>Ending address: <code>&amp;A[N+1][0]</code>.</p></li>
<li><p>Moving stride: <code>index += N + 1</code>.</p></li>
</ul>
<p>&#x2003;&#x2003;And the optimized program:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">fix_set_diag_opt</span><span class="params">(fix_matrix A, <span class="type">int</span> val)</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">int</span> *Abase = &amp;A[<span class="number">0</span>][<span class="number">0</span>];</span><br><span class="line">    <span class="type">long</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="type">long</span> iend = N * (N + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">do</span> {</span><br><span class="line">        Abase[i] = val;</span><br><span class="line">        i += (N + <span class="number">1</span>);</span><br><span class="line">    } <span class="keyword">while</span> (i != iend);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="4variable-size-arrays">4.Variable-Size Arrays</h3>
<p>&#x2003;&#x2003;Programmers requiring variable-size arrays had to allocate storage
for these arrays using functions such as <code>malloc</code> or
<code>calloc</code>, and they had to explicitly encode the mapping of
multidimensional arrays into single-dimension ones via row-major
indexing.</p>
<p>&#x2003;&#x2003;If we declare an array <code>int A[exp1][exp2]</code>, the
dimensions of the array are determined by evaluating the expressions
<code>expr1</code> and <code>expr2</code> <strong>at the time the
declaration is encountered</strong>.</p>
<p>&#x2003;&#x2003;For example, the following C program:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">var_ele</span><span class="params">(<span class="type">long</span> n, <span class="type">int</span> A[n][n], <span class="type">long</span> i, <span class="type">long</span> j)</span> {</span><br><span class="line">    <span class="keyword">return</span> A[i][j];</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;can be translated into the following assembly code:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var_ele:</span><br><span class="line">    imulq %rdx, %rdi          # Compute n * i</span><br><span class="line">    leaq (%rsi,%rdi,4), %rax  # Compute xA + 4(n * i)</span><br><span class="line">    movl (%rax,%rcx,4), %eax  # Read from M[xA + 4(n * i) + 4 * j]</span><br><span class="line">    ret</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;<strong>Instead of using <code>leaq</code>, the dynamic version
must use <code>imul</code> to scale <code>i</code> by
<code>n</code></strong>. This is because we don&apos;t know the exact size of
array until encounter the declaration.</p>
<p>&#x2003;&#x2003;The optimization of variable-size arrays is similar to that of the
fixed-size:</p>
<p>&#x2003;&#x2003;For example, the C program:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">var_prod_ele</span><span class="params">(<span class="type">long</span> n, <span class="type">int</span> A[n][n], <span class="type">int</span> B[n][n], <span class="type">long</span> i, <span class="type">long</span> k)</span> {</span><br><span class="line">    <span class="type">long</span> j;</span><br><span class="line">    <span class="type">int</span> result = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; n; j++)</span><br><span class="line">        result += A[i][j] * B[j][k];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;can be optimized as:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Compute i,k of variable matrix product */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">var_prod_ele_opt</span><span class="params">(<span class="type">long</span> n, <span class="type">int</span> A[n][n], <span class="type">int</span> B[n][n], <span class="type">long</span> i, <span class="type">long</span> k)</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">int</span> *Arow = A[i];</span><br><span class="line">    <span class="type">int</span> *Bptr = &amp;B[<span class="number">0</span>][k];</span><br><span class="line">    <span class="type">int</span> result = <span class="number">0</span>;</span><br><span class="line">    <span class="type">long</span> j;</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; n; j++)</span><br><span class="line">    {</span><br><span class="line">        result += Arow[j] * *Bptr;</span><br><span class="line">        Bptr += n;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<blockquote>
<p>We can see that <code>GCC</code> is able to recognize patterns that
arise when a program steps through the elements of a multidimensional
array, and generate the <strong>pointer-based code</strong> or the
<strong>array-based code</strong> to <strong>avoid direct multiple
calculation</strong>.</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/07/16/3-7-Procedures/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/07/16/3-7-Procedures/" class="post-title-link" itemprop="url">3.7.Procedure</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-07-16 16:30:22" itemprop="dateCreated datePublished" datetime="2024-07-16T16:30:22+08:00">2024-07-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-07-17 17:31:59" itemprop="dateModified" datetime="2024-07-17T17:31:59+08:00">2024-07-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CSAPP/" itemprop="url" rel="index"><span itemprop="name">CSAPP</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CSAPP/Chapter-3-Machine-level-Representation-of-Program/" itemprop="url" rel="index"><span itemprop="name">Chapter 3.Machine-level Representation of Program</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>1.4k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>5 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="37procedure"><span class="math inline">\(3.7.\)</span>Procedure</h1>
<h3 id="1procedure-in-a-highprospective">1.Procedure in A High
Prospective</h3>
<ul>
<li>Procedures are a key abstraction in software. They provide a way to
<strong>package code that implements some functionality with a
designated set of arguments and an optional return value</strong>.</li>
</ul>
<p>&#x2003;&#x2003;Well-designed software uses procedures as an abstraction mechanism,
<strong>hiding the detailed implementation of some action</strong> while
p<strong>roviding a clear and concise interface definition of what
values will be computed and what effects the procedure will have on the
program state</strong>.</p>
<p>&#x2003;&#x2003;To provide machine-level support for procedures, we need to take
the following aspect into consideration:</p>
<ol type="1">
<li><p><em>Passing control</em>.</p></li>
<li><p><em>Passing data</em>.</p></li>
<li><p><em>Allocating and deallocating memory</em>.</p></li>
</ol>
<h3 id="2the-run-time-stack">2.The Run-time Stack</h3>
<ul>
<li><p>A program can manage the storage required by its procedures using
a stack, where the stack and the program registers <strong>store the
information required for passing control and data, and for allocating
memory</strong>. As P calls Q, <strong>control and data information are
added to the end of the stack</strong>. This information <strong>gets
deallocated when P returns</strong>.</p></li>
<li><p>When an x86-64 procedure requires storage beyond what it can hold
in registers, it <strong>allocates space on the stack</strong>. This
region is referred to as the procedure&apos;s <strong>stack
frame</strong>.</p>
<ul>
<li>When procedure P calls procedure Q, it will <strong>push the return
address onto the stack</strong>, indicating where <strong>within P the
program should resume</strong> execution once Q returns. We consider the
return address to be <strong>part of P&apos;s stack frame</strong>, since it
holds state relevant to P.</li>
</ul></li>
</ul>
<p>&#x2003;&#x2003;The stack frames for most procedures are <strong>of fixed
size</strong>, allocated at the beginning of the procedure. Some
procedures, however, require variable-size frames.</p>
<h3 id="3control-transfer">3.Control Transfer</h3>
<ul>
<li><p>Passing control from function P to function Q involves simply
<strong>setting the program counter (PC) to the starting address of the
code for Q</strong>. This information is recorded in x86-64 machines by
invoking procedure Q with the instruction <code>call Q</code>.</p>
<ul>
<li>This instruction <strong>pushes an address A onto the stack</strong>
and <strong>sets the PC to the beginning of Q</strong>. The pushed
address A is referred to as <strong>the return address</strong> and is
computed as <strong>the address of the instruction immediately following
the call instruction</strong>.</li>
</ul></li>
</ul>
<p>&#x2003;&#x2003;The general forms of the <code>call</code> and <code>ret</code>
instructions are as below:</p>
<p><img src="/2024/07/16/3-7-Procedures/image.png"></p>
<p><img src="/2024/07/16/3-7-Procedures/image-1.png"></p>
<h3 id="4data-transfer">4.Data Transfer</h3>
<p>&#x2003;&#x2003;In x86-64, data passing to and from a procedure takes place via
registers.</p>
<p>&#x2003;&#x2003;<strong>Up to six</strong> integral (i.e., integer and pointer)
arguments can be passed via registers. The registers are used in a
specified order:</p>
<p><img src="/2024/07/16/3-7-Procedures/image-2.png"></p>
<p>&#x2003;&#x2003;Arguments are allocated to these registers according to
<strong>their ordering in the argument list</strong>, and arguments
smaller than 64 bits can be accessed using the appropriate
<strong>subsection of the 64-bit register</strong>.</p>
<p>&#x2003;&#x2003;When a function has more than six integral arguments, the other
ones are passed <strong>on the stack</strong>. When passing parameters
on the stack, all data size <strong>are rounded up to be multiples of
8</strong>.</p>
<p>&#x2003;&#x2003;Let&apos;s take the following code as an example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># void proc(a1, a1p, a2, a2p, a3, a3p, a4, a4p)</span><br><span class="line"># Arguments passed as follows:</span><br><span class="line"># a1 in %rdi (64 bits)</span><br><span class="line"># a1p in %rsi (64 bits)</span><br><span class="line"># a2 in %edx (32 bits)</span><br><span class="line"># a2p in %rcx (64 bits)</span><br><span class="line"># a3 in %r8w (16 bits)</span><br><span class="line"># a3p in %r9 (64 bits)</span><br><span class="line"># a4 at %rsp+8 ( 8 bits)</span><br><span class="line"># a4p at %rsp+16 (64 bits)</span><br><span class="line"></span><br><span class="line">proc:</span><br><span class="line">    movq 16(%rsp), %rax # Fetch a4p (64 bits)</span><br><span class="line">    addq %rdi, (%rsi)   # *a1p += a1 (64 bits)</span><br><span class="line">    addl %edx, (%rcx)   # *a2p += a2 (32 bits)</span><br><span class="line">    addw %r8w, (%r9)    # *a3p += a3 (16 bits)</span><br><span class="line">    movl 8(%rsp), %edx  # Fetch a4 (8 bits)</span><br><span class="line">    addb %dl, (%rax)    # *a4p += a4 (8 bits)</span><br><span class="line">    ret                 # Return</span><br></pre></td></tr></table></figure>
<p><img src="/2024/07/16/3-7-Procedures/image-3.png"></p>
<h3 id="5local-storage-on-the-stack">5.Local Storage on the Stack</h3>
<p>&#x2003;&#x2003;In most cases, local data is stored in registers. However, there
are cases that local data must be stored in memory:</p>
<ol type="1">
<li><p>There are not enough registers to hold all of the local
data.</p></li>
<li><p>The address operator &apos;&amp;&apos; is applied to a local variable, and
hence we must be able to <strong>generate an address for it</strong>.
However, data that is stored in register doesn&apos;t have unique
address.</p></li>
<li><p>Some of the local variables are arrays or structures and hence
must be accessed by array or structure references.</p></li>
</ol>
<p>&#x2003;&#x2003;Take the following program as an example:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="title function_">swap_add</span><span class="params">(<span class="type">long</span> *xp, <span class="type">long</span> *yp)</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">long</span> x = *xp;</span><br><span class="line">    <span class="type">long</span> y = *yp;</span><br><span class="line">    *xp = y;</span><br><span class="line">    *yp = x;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="title function_">caller</span><span class="params">()</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">long</span> arg1 = <span class="number">534</span>;</span><br><span class="line">    <span class="type">long</span> arg2 = <span class="number">1057</span>;</span><br><span class="line">    <span class="type">long</span> sum = swap_add(&amp;arg1, &amp;arg2);</span><br><span class="line">    <span class="type">long</span> diff = arg1 - arg2;</span><br><span class="line">    <span class="keyword">return</span> sum * diff;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># long caller()</span><br><span class="line">caller:</span><br><span class="line">subq $16, %rsp       # Allocate 16 bytes for stack frame</span><br><span class="line">movq $534, (%rsp)    # Store 534 in arg1</span><br><span class="line">movq $1057, 8(%rsp)  # Store 1057 in arg2</span><br><span class="line">leaq 8(%rsp), %rsi   # Compute &amp;arg2 as second argument</span><br><span class="line">movq %rsp, %rdi      # Compute &amp;arg1 as first argument</span><br><span class="line">call swap_add        # Call swap_add(&amp;arg1, &amp;arg2)</span><br><span class="line">movq (%rsp), %rdx    # Get arg1</span><br><span class="line">subq 8(%rsp), %rdx   # Compute diff = arg1 - arg2</span><br><span class="line">imulq %rdx, %rax     # Compute sum * diff</span><br><span class="line">addq $16, %rsp       # Deallocate stack frame</span><br><span class="line">ret                  # Return</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;Because we need to use the address of <code>arg1</code> and
<code>arg2</code>, we need to store them in memory. We do this by
leaving enough place in the stack and push the arguments onto the
stack:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">subq $16, %rsp       # Allocate 16 bytes for stack frame</span><br><span class="line">movq $534, (%rsp)    # Store 534 in arg1</span><br><span class="line">movq $1057, 8(%rsp)  # Store 1057 in arg2</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;Once we need to use the value, we fetch it from the stacK:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">leaq 8(%rsp), %rsi   # Compute &amp;arg2 as second argument</span><br><span class="line">movq %rsp, %rdi      # Compute &amp;arg1 as first argument</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;The following program is a more complicated one. It includes the
details of setting up the stack frame for the local variables and
function parameters:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">call_proc:</span><br><span class="line"></span><br><span class="line">    # set up arguments to proc</span><br><span class="line">    subq $32, %rsp          # Allocate 32-byte stack frame</span><br><span class="line">    movq $1, 24(%rsp)       # Store 1 in &amp;x1</span><br><span class="line">    movl $2, 20(%rsp)       # Store 2 in &amp;x2</span><br><span class="line">    movw $3, 18(%rsp)       # Store 3 in &amp;x3</span><br><span class="line">    movb $4, 17(%rsp)       # Store 4 in &amp;x4</span><br><span class="line">    leaq 17(%rsp), %rax     # Create &amp;x4</span><br><span class="line">    movq %rax, 8(%rsp)      # Store &amp;x4 as argument 8</span><br><span class="line">    movl $4, (%rsp)         # Store 4 as argument 7</span><br><span class="line">    leaq 18(%rsp), %r9      # Pass &amp;x3 as argument 6</span><br><span class="line">    movl $3, %r8d           # Pass 3 as argument 5</span><br><span class="line">    leaq 20(%rsp), %rcx     # Pass &amp;x2 as argument 4</span><br><span class="line">    movl $2, %edx           # Pass 2 as argument 3</span><br><span class="line">    leaq 24(%rsp), %rsi     # Pass &amp;x1 as argument 2</span><br><span class="line">    movl $1, %edi           # Pass 1 as argument 1</span><br><span class="line"></span><br><span class="line">    # call proc</span><br><span class="line">    call proc               # Call proc</span><br><span class="line"></span><br><span class="line">    # retrieve changes to memory</span><br><span class="line">    movslq 20(%rsp), %rdx   # Get x2 and convert to long</span><br><span class="line">    addq 24(%rsp), %rdx     # Compute x1+x2</span><br><span class="line">    movswl 18(%rsp), %eax   # Get x3 and convert to int</span><br><span class="line">    movsbl 17(%rsp), %ecx   # Get x4 and convert to int</span><br><span class="line">    subl %ecx, %eax         # Compute x3-x4</span><br><span class="line">    cltq                    # Convert to long</span><br><span class="line">    imulq %rdx, %rax        # Compute (x1+x2) * (x3-x4)</span><br><span class="line">    addq $32, %rsp          # Deallocate stack frame</span><br><span class="line">    ret                     # Return</span><br></pre></td></tr></table></figure>
<h3 id="6local-storage-in-registers">6.Local Storage in Registers</h3>
<p>&#x2003;&#x2003;When calling another procedure, we must make sure that <strong>the
callee does not overwrite some register value that the caller planned to
use later</strong>.</p>
<ul>
<li><p>By convention, registers <code>%rbx</code>, <code>%rbp</code>,
and <code>%r12&#xFFFD;C%r15</code> are classified as <strong>callee saved
registers</strong>.</p>
<ul>
<li>When procedure P calls procedure Q, <strong>Q must preserve the
values of these registers</strong>, ensuring that they have the same
values when Q returns to P as they did when Q was called.</li>
</ul></li>
<li><p>Procedure Q can preserve a register value by either <strong>not
changing it at all</strong> or by <strong>pushing the original value on
the stack, altering it, and then popping the old value from the stack
before returning</strong>.</p></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pushq %rbp  # Save %rbp</span><br><span class="line">pushq %rbx  # Save %rbx</span><br><span class="line">...</span><br><span class="line">popq %rbx   # Restore %rbx</span><br><span class="line">popq %rbp   # Restore %rbp</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note how they are popped is <strong>in the reverse order
from</strong> how they were pushed, to account for the last-in,
first-out discipline of a stack.</p>
</blockquote>
<ul>
<li>All other registers, except for the stack pointer <code>%rsp</code>,
are classified as <strong>caller saved registers</strong>.</li>
</ul>
<h3 id="7recursive-procedures">7.Recursive Procedures</h3>
<p>&#x2003;&#x2003;The stack discipline of allocation and deallocation naturally
matches the call-return ordering of functions. So the recursive
procedures is the same as other procedures:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="title function_">rfact</span><span class="params">(<span class="type">long</span> n)</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">long</span> result;</span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">1</span>)</span><br><span class="line">        result = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        result = n * rfact(n - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">rfact:</span><br><span class="line">    pushq %rbx              # Save %rbx</span><br><span class="line">    movq %rdi, %rbx         # Store n in callee-saved register</span><br><span class="line">    movl $1, %eax           # Set return value = 1</span><br><span class="line">    cmpq $1, %rdi           # Compare n:1</span><br><span class="line">    jle .L35                # If &lt;=, goto done</span><br><span class="line">    leaq -1(%rdi), %rdi     # Compute n-1</span><br><span class="line">    call rfact              # Call rfact(n-1)</span><br><span class="line">    imulq %rbx, %rax        # Multiply result by n</span><br><span class="line">.L35: done:</span><br><span class="line">    popq %rbx               # Restore %rbx</span><br><span class="line">    ret                     # Return</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/07/15/3-6-Control/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/07/15/3-6-Control/" class="post-title-link" itemprop="url">3.6.Control</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-07-15 16:30:22" itemprop="dateCreated datePublished" datetime="2024-07-15T16:30:22+08:00">2024-07-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-07-16 16:35:46" itemprop="dateModified" datetime="2024-07-16T16:35:46+08:00">2024-07-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CSAPP/" itemprop="url" rel="index"><span itemprop="name">CSAPP</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CSAPP/Chapter-3-Machine-level-Representation-of-Program/" itemprop="url" rel="index"><span itemprop="name">Chapter 3.Machine-level Representation of Program</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>1.4k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>5 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="36-control"><span class="math inline">\(3.6.\)</span> Control</h1>
<h3 id="1condition-code">1.Condition Code</h3>
<p>&#x2003;&#x2003;In addition to the integer registers, the CPU maintains <em>a set
of single-bit condition code registers</em> <strong>describing
attributes of the most recent arithmetic or logical operation</strong>.
These registers can then be tested to perform conditional branches</p>
<p><img src="/2024/07/15/3-6-Control/image.png"></p>
<ul>
<li><p>The <code>leaq</code> instruction <strong>doesn&apos;t alter any
condition codes</strong>, since it is intended to be used in address
computations.</p></li>
<li><p>For the logical operations, such as <code>xor</code>, <strong>the
carry and overflow flags are set to zero</strong>.</p></li>
<li><p>For the shift operations, <strong>the carry flag is set to the
last bit shifted out</strong>, while <strong>the overflow flag is set to
zero</strong>.</p></li>
<li><p>The <code>inc</code> and <code>dec</code> instructions
<strong>set the overflow and zero flags</strong>, but they <strong>leave
the carry flag unchanged</strong>.</p></li>
</ul>
<p>&#x2003;&#x2003;There are two instruction classes that set condition codes without
altering any other registers:</p>
<p><img src="/2024/07/15/3-6-Control/image-1.png"></p>
<ul>
<li>In <code>TEST</code>, typically, <strong>the same operand is
repeated</strong> (e.g., <code>testq %rax,%rax</code> to see whether
<code>%rax</code> is negative, zero, or positive), or <strong>one of the
operands is a mask indicating which bits should be tested</strong>.</li>
</ul>
<h3 id="2accessing-condition-codes">2.Accessing Condition Codes</h3>
<p><img src="/2024/07/15/3-6-Control/image-2.png"></p>
<ul>
<li><p>A set instruction has either one of the low-order single-byte
register elements or a single-byte memory location as its destination,
<strong>setting this byte to either 0 or 1</strong>.</p></li>
<li><p>To generate a 32-bit or 64-bit result, we must also <strong>clear
the high-order bits</strong>. For example:</p></li>
</ul>
<p><img src="/2024/07/15/3-6-Control/image-3.png"></p>
<p>&#x2003;&#x2003;The <code>movzbl</code> not only set the high-order 3 bytes of
<code>%eax</code> to 0, but also set the high-order 4 bytes of
<code>%rax</code> to 0 due to the 32-bit <code>mov</code>
convention.</p>
<blockquote>
<p>It is important to understand that assembly code does not keep track
of the type of a program value. Instead, <strong>the different
instructions determine the operand sizes and whether they are signed or
unsigned</strong>:</p>
<p><span class="math inline">\(e.g.\)</span></p>
<p><img src="/2024/07/15/3-6-Control/image-4.png"></p>
<p><img src="/2024/07/15/3-6-Control/image-5.png"></p>
</blockquote>
<h3 id="3jump-instructions">3.Jump Instructions</h3>
<p><img src="/2024/07/15/3-6-Control/image-6.png"></p>
<p>&#x2003;&#x2003;There are two kinds of jump instructions:</p>
<ul>
<li><p><em>Direct jump</em>: It jumps to a label. The jump target is
encoded as part of the instructions.</p></li>
<li><p><em>Indirect jump</em>: It is written <strong>using
<code>*</code> followed by an operand specifier</strong>.</p>
<ul>
<li><p><code>jmp *%rax</code> uses <strong>the value in
<code>%rax</code></strong> as the jump target.</p></li>
<li><p><code>jmp *(%rax)</code> reads the jump target from memory, using
the value in <code>%rax</code> <strong>as the read
address</strong>.</p></li>
</ul></li>
</ul>
<h3 id="4jump-instruction-encodings">4.Jump Instruction Encodings</h3>
<p>&#x2003;&#x2003;There are several kinds of encoding jump targets:</p>
<ol type="1">
<li><p><em>PC relative</em>. They encode <strong>the difference between
the address of the target instruction and the address of the instruction
immediately following the jump</strong>.</p></li>
<li><p>A second encoding method is to <strong>give an &#xFFFD;&#xFFFD;absolute&#xFFFD;&#xFFFD;
address</strong>, using 4 bytes to directly specify the target.</p></li>
</ol>
<p>&#x2003;&#x2003;Let&apos;s look at an PC relative example:</p>
<p><img src="/2024/07/15/3-6-Control/image-7.png"></p>
<p>&#x2003;&#x2003;In the annotations on the right, the jump targets are indicated as
<code>0x8</code> for the jump instruction on line 2, which is equal to
<code>0x5+0x3</code>. This is because the encoding is calculated by
<strong><span class="math inline">\(the\;address\;of\;next\;instruction+offset\)</span></strong>.</p>
<p>&#x2003;&#x2003;In this case, the address of next instruction is 3+2=5, and the
offset is <code>03</code>, as is shown in the assembly code.</p>
<p>&#x2003;&#x2003;Even though the instructions may be relocated to different
addresses, the encoding of the target <strong>remain unchanged</strong>.
This is because the relative position between instructions remains
unchanged.</p>
<h3 id="5conditional-move">5.Conditional Move</h3>
<p>&#x2003;&#x2003;The conventional way to implement conditional operations is through
a <em>conditional transfer of control</em>, where the program follows
one execution path when a condition holds and another when it does
not:</p>
<p><img src="/2024/07/15/3-6-Control/image-8.png"></p>
<p>&#x2003;&#x2003;An alternate strategy is through <em>condition transfer of
data</em>. This approach <strong>computes both outcomes of a conditional
operation</strong> and then <strong>selects one based on whether or not
the condition holds</strong>:</p>
<p><img src="/2024/07/15/3-6-Control/image-9.png"></p>
<p>&#x2003;&#x2003;This strategy makes sense only in restricted cases, but it can then
be implemented by a simple conditional move instruction that is better
matched to the performance characteristics of modern processors due to
the pipelining.</p>
<blockquote>
<p>However, due to the preprocess, If <strong>one of those two
expressions could possibly generate an error condition or a side
effect</strong>, this could lead to invalid behavior.</p>
</blockquote>
<p>&#x2003;&#x2003;The conditional move instructions are as below:</p>
<p><img src="/2024/07/15/3-6-Control/image-10.png"></p>
<ul>
<li><p>The instructions has two operands: <strong>a source register or
memory location S</strong>, and <strong>a destination register
R</strong>.</p></li>
<li><p>The assembler can infer the operand length of a conditional move
instruction, so it doesn&apos;t need suffix.</p></li>
</ul>
<h3 id="6loops">6.Loops</h3>
<h4 id="ado-while">&#x2003;&#x2003;<span class="math inline">\(a.\)</span><code>do-while</code></h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span></span><br><span class="line">    body-statement</span><br><span class="line">    <span class="title function_">while</span> <span class="params">(test-expr)</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">loop:</span><br><span class="line">    body-statement</span><br><span class="line">    t = test-expr;</span><br><span class="line">    if (t)</span><br><span class="line">        goto loop;</span><br></pre></td></tr></table></figure>
<h4 id="bwhile">&#x2003;&#x2003;<span class="math inline">\(b.\)</span><code>while</code></h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (test-expr)</span><br><span class="line">    body-statement</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    goto test;</span><br><span class="line">loop:</span><br><span class="line">    body-statement</span><br><span class="line">test:</span><br><span class="line">    t = test-expr;</span><br><span class="line">    if (t)</span><br><span class="line">        goto loop;</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;The second translation method is called <em>guarded do</em>, which
uses a <code>do-while</code> style loop:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">t = test-expr;</span><br><span class="line">if (!t)</span><br><span class="line">    goto done;</span><br><span class="line"></span><br><span class="line">loop:</span><br><span class="line">    body-statement</span><br><span class="line">    t = test-expr;</span><br><span class="line">    if (t)</span><br><span class="line">        goto loop;</span><br><span class="line">done:</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;By this way, we only need to check the condition once before we
enter the loop. This reduce the possibility of branch prediction
failure.</p>
<h4 id="cfor">&#x2003;&#x2003;<span class="math inline">\(c.\)</span><code>for</code></h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (init-expr; test-expr; update-expr)</span><br><span class="line">    body-statement</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;is equal to the following <code>while</code> statements:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">init-expr;</span><br><span class="line"><span class="keyword">while</span> (test-expr) {</span><br><span class="line">    body-statement</span><br><span class="line">    update-expr;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;And there are also two forms of <code>for</code> translation:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    init-expr;</span><br><span class="line">    goto test;</span><br><span class="line">loop:</span><br><span class="line">    body-statement</span><br><span class="line">    update-expr;</span><br><span class="line">test:</span><br><span class="line">    t = test-expr;</span><br><span class="line">    if (t)</span><br><span class="line">        goto loop;</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;and:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    init-expr;</span><br><span class="line">    t = test-expr;</span><br><span class="line">    if (!t)</span><br><span class="line">        goto done;</span><br><span class="line">loop:</span><br><span class="line">    body-statement</span><br><span class="line">    update-expr;</span><br><span class="line">    t = test-expr;</span><br><span class="line">    if (t)</span><br><span class="line">        goto loop;</span><br><span class="line">done:</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;However, the simple translation from <code>for</code> to
<code>while</code> will be a little tricky. Take the
<code>continue</code> statement as an example:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> sum = <span class="number">0</span>;</span><br><span class="line"><span class="type">long</span> i;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) {</span><br><span class="line">    <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    sum += i;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;If we simply use <code>continue</code>, this will lead to an
infinite loop:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> sum = <span class="number">0</span>;</span><br><span class="line"><span class="type">long</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (i &lt; <span class="number">10</span>) {</span><br><span class="line">    <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">    <span class="comment">/* This will cause an infinite loop */</span></span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">    sum += i;</span><br><span class="line">    i ++;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;The general solution is to replace the continue statement with a
goto statement that skips the rest of the loop body and goes directly to
the update portion:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> sum = <span class="number">0</span>;</span><br><span class="line"><span class="type">long</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (i &lt; <span class="number">10</span>) {</span><br><span class="line">    <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">goto</span> update;</span><br><span class="line">    sum += i;</span><br><span class="line"></span><br><span class="line">update:</span><br><span class="line">    i++;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="7switch-statements">7.Switch Statements</h3>
<p>&#x2003;&#x2003;The ordinary <code>switch</code> statements looks like this:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">switch_eg</span><span class="params">(<span class="type">long</span> x, <span class="type">long</span> n, <span class="type">long</span> *dest)</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">long</span> val = x;</span><br><span class="line">    <span class="keyword">switch</span> (n)</span><br><span class="line">    {</span><br><span class="line">    <span class="keyword">case</span> <span class="number">100</span>:</span><br><span class="line">        val *= <span class="number">13</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">102</span>:</span><br><span class="line">        val += <span class="number">10</span>;</span><br><span class="line">    <span class="comment">/* Fall through */</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">103</span>:</span><br><span class="line">        val += <span class="number">11</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">104</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">106</span>:</span><br><span class="line">        val *= val;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        val = <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    *dest = val;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;We can rewrite this using a <em>jump table</em>. A jump table is an
array where entry i is the address of a code segment the program should
take when the switch index equals i.</p>
<p>&#x2003;&#x2003;With jump table, the previous program will looks like this:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">switch_eg_impl</span><span class="params">(<span class="type">long</span> x, <span class="type">long</span> n, <span class="type">long</span> *dest)</span></span><br><span class="line">{</span><br><span class="line">    <span class="comment">/* Table of code pointers */</span></span><br><span class="line">    <span class="type">static</span> <span class="type">void</span> *jt[<span class="number">7</span>] = {</span><br><span class="line">        &amp;&amp;loc_A, &amp;&amp;loc_def, &amp;&amp;loc_B,</span><br><span class="line">        &amp;&amp;loc_C, &amp;&amp;loc_D, &amp;&amp;loc_def,</span><br><span class="line">        &amp;&amp;loc_D};</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> index = n - <span class="number">100</span>;</span><br><span class="line">    <span class="type">long</span> val;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (index &gt; <span class="number">6</span>)</span><br><span class="line">        <span class="keyword">goto</span> loc_def;</span><br><span class="line">    <span class="comment">/* Multiway branch */</span></span><br><span class="line">    <span class="keyword">goto</span> *jt[index];</span><br><span class="line"></span><br><span class="line">loc_A: <span class="comment">/* Case 100 */</span></span><br><span class="line">    val = x * <span class="number">13</span>;</span><br><span class="line">    <span class="keyword">goto</span> done;</span><br><span class="line">loc_B: <span class="comment">/* Case 102 */</span></span><br><span class="line">    x = x + <span class="number">10</span>;</span><br><span class="line"><span class="comment">/* Fall through */</span></span><br><span class="line">loc_C: <span class="comment">/* Case 103 */</span></span><br><span class="line">    val = x + <span class="number">11</span>;</span><br><span class="line">    <span class="keyword">goto</span> done;</span><br><span class="line">loc_D: <span class="comment">/* Cases 104, 106 */</span></span><br><span class="line">    val = x * x;</span><br><span class="line">    <span class="keyword">goto</span> done;</span><br><span class="line">loc_def: <span class="comment">/* Default case */</span></span><br><span class="line">    val = <span class="number">0</span>;</span><br><span class="line">done:</span><br><span class="line">    *dest = val;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<ul>
<li><p>The <code>switch</code> locations are defined by <strong>the
labels prefixed by <code>&amp;&amp;</code></strong>.
<code>&amp;&amp;</code>is used to create a pointer for a code
location.</p></li>
<li><p>To simplify, the case value is subtracted by 100.</p></li>
</ul>
<p>&#x2003;&#x2003;In the assembly code, we use this statement to access the jump
table:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jmp *.L4(, %rsi, 8)  #Goto *jg[index]</span><br></pre></td></tr></table></figure>
<ul>
<li><p>The base address is <code>L4</code>, which is the base address of
the jump table array.</p></li>
<li><p>The <code>(, %rsi, 8)</code> is the index, judging which case to
switch to.</p></li>
</ul>
<p>&#x2003;&#x2003;In the assembly code, the jump table is indicated by the following
declarations:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.section.rodata</span><br><span class="line">    .align 8  # Align address to multiple of 8</span><br><span class="line">    .L4 :</span><br><span class="line">    .quad.L3  # Case 100 : loc_A</span><br><span class="line">    .quad.L8  # Case 101 : loc_def</span><br><span class="line">    .quad.L5  # Case 102 : loc_B</span><br><span class="line">    .quad.L6  # Case 103 : loc_C</span><br><span class="line">    .quad.L7  # Case 104 : loc_D</span><br><span class="line">    .quad.L8  # Case 105 : loc_def</span><br><span class="line">    .quad.L7  # Case 106 : loc_D</span><br></pre></td></tr></table></figure>
<ul>
<li><p>The <code>rodata</code> refers to <em>read-only
data</em>.</p></li>
<li><p><code>L4</code> marks the start of the allocation.</p></li>
</ul>
<p>&#x2003;&#x2003;In assembly code, the number of <code>case</code> is judged by
<strong>the offset of the label in the jump table</strong>.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/07/15/3-5-Arithmetic-and-Logical-Operations/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/07/15/3-5-Arithmetic-and-Logical-Operations/" class="post-title-link" itemprop="url">3.5.Arithmetic and Logical Operations</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>
      

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-07-15 09:30:22 / &#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;17:11:58" itemprop="dateCreated datePublished" datetime="2024-07-15T09:30:22+08:00">2024-07-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CSAPP/" itemprop="url" rel="index"><span itemprop="name">CSAPP</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CSAPP/Chapter-3-Machine-level-Representation-of-Program/" itemprop="url" rel="index"><span itemprop="name">Chapter 3.Machine-level Representation of Program</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>503</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="35arithmetic-and-logicaloperations"><span class="math inline">\(3.5.\)</span>Arithmetic and Logical
Operations</h1>
<p><img src="/2024/07/15/3-5-Arithmetic-and-Logical-Operations/image.png"></p>
<h3 id="1load-effective-address">1.Load Effective Address</h3>
<ul>
<li>The <code>leaq</code> instruction <strong>doesn&apos;t reference memory
at all</strong>. Instead of reading from the designated location, it
<strong>copies the effective address to the destination</strong>.</li>
</ul>
<p>&#x2003;&#x2003;The instruction can be used to <strong>generate pointers for later
memory reference</strong>. For example, if register <code>%rdx</code>
represents <span class="math inline">\(x\)</span>, then
<code>leaq 7(%rdx, %rdx, 4), %rdx</code> will set <code>%rdx</code> to
<span class="math inline">\(5x+7\)</span>.</p>
<p><img src="/2024/07/15/3-5-Arithmetic-and-Logical-Operations/image-1.png"></p>
<h3 id="2unary-amp-binary-operations">2.Unary &amp; Binary Operations</h3>
<p><img src="/2024/07/15/3-5-Arithmetic-and-Logical-Operations/image-2.png"></p>
<p>&#x2003;&#x2003;Operations in the first group are unary operations:</p>
<ul>
<li><p>The single operand serves as both source and
destination.</p></li>
<li><p>This operand can be either a register or a memory
location.</p></li>
</ul>
<p>&#x2003;&#x2003;The second group consists of binary operations.</p>
<ul>
<li>The second operand is used as both a source and a destination, the
first operand is another operand.</li>
</ul>
<blockquote>
<p>This syntax is reminiscent of the C assignment operators, such as
<code>x -= y</code>.</p>
</blockquote>
<ul>
<li>The first operand can be either an immediate value, a register, or a
memory location. The second can be either a register or a memory
location.</li>
</ul>
<blockquote>
<p>The operation: <code>xor %rcx %rcx</code> is simply to set</p>
</blockquote>
<h3 id="3shift-operations">3.Shift operations</h3>
<p><img src="/2024/07/15/3-5-Arithmetic-and-Logical-Operations/image-3.png"></p>
<ul>
<li><p>The shift amount is either <strong>an immediate value</strong> or
<strong>a single-byte register <code>%cl</code></strong>.</p></li>
<li><p>In x86-64, if the data values are <span class="math inline">\(w\)</span> bits, then its shift amount will be
<strong>the low-order <span class="math inline">\(m\)</span> bits of
<code>%cl</code>, where <span class="math inline">\(2^m=w\)</span></strong>. For example, when
<code>%cl</code> has value 0xFF, then <code>salb</code> would shift by
7, while <code>salw</code> would shift by 15.</p></li>
</ul>
<p>&#x2003;&#x2003;<span class="math inline">\(e.g.\)</span>(Convert 64-bits into
32-bits)</p>
<p><img src="/2024/07/15/3-5-Arithmetic-and-Logical-Operations/image-4.png"></p>
<p>&#x2003;&#x2003;<span class="math inline">\(solution:\)</span></p>
<p><img src="/2024/07/15/3-5-Arithmetic-and-Logical-Operations/image-5.png"></p>
<ul>
<li>The <code>movl %esi %ecx</code> is worth noting. Because we only
need 4 bytes of data, we can use <code>movl</code> operation to set the
low-order 32 bits of <code>rcx</code> to <code>%esi</code> while
high-order 32 bits to 0. Since we only need the low-order 4 bytes, doing
this implies that the high-order 4 bytes is meaningless, which makes
code safer, more accurate and more readable.</li>
</ul>
<h3 id="4special-arithmeticoperations">4.Special Arithmetic
Operations</h3>
<p><img src="/2024/07/15/3-5-Arithmetic-and-Logical-Operations/image-6.png"></p>
<h4 id="aone-operand-multiply">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&quot;One-operand&quot; multiply</h4>
<p>&#x2003;&#x2003;The <code>mulq</code>(unsigned) and <code>imulq</code>(signed) can
also act as &quot;one-operand&quot; instructions to <strong>compute the full
128-bits product of 2 64-bits values</strong>.</p>
<ul>
<li><p><strong>One of the multiplicand is value in
<code>%rax</code></strong>, another is the operand.</p></li>
<li><p>The product is stored in <code>%rdx</code> (high-order 64 bits)
and <code>%rax</code> (low-order 64 bits).</p></li>
</ul>
<p>&#x2003;&#x2003;We will need to take two steps to store an oct word:</p>
<p>&#x2003;&#x2003;<span class="math inline">\(e.g.\)</span></p>
<p><img src="/2024/07/15/3-5-Arithmetic-and-Logical-Operations/image-7.png"></p>
<h4 id="bdivision">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Division</h4>
<p><img src="/2024/07/15/3-5-Arithmetic-and-Logical-Operations/image-8.png"></p>
<ul>
<li><p>For a division, <code>%rdx</code> stores the remainder and
<code>%rax</code> stores the quotient.</p></li>
<li><p>For most applications of 64-bit addition, the dividend is given
as a 64-bit value. The bits of <code>%rdx</code> should then be set to
either <strong>all zeros (unsigned arithmetic) or the sign bit of %rax
(signed arithmetic)</strong>.</p>
<ul>
<li><p>The former can be implemented by <code>movl $0 %reg</code>, this
can set upper 8 bytes of diviend to 0.</p></li>
<li><p>The latter can be implemented by <code>cqto</code>. It takes no
operands, implicitly reads the sign bit from %rax and copies it across
all of %rdx.</p></li>
</ul></li>
</ul>
<p>&#x2003;&#x2003;<span class="math inline">\(e.g.\)</span>(Signed and Unsigned)</p>
<p><img src="/2024/07/15/3-5-Arithmetic-and-Logical-Operations/image-9.png"></p>
<p><img src="/2024/07/15/3-5-Arithmetic-and-Logical-Operations/image-10.png"></p>
<p><img src="/2024/07/15/3-5-Arithmetic-and-Logical-Operations/image-11.png"></p>
<p><img src="/2024/07/15/3-5-Arithmetic-and-Logical-Operations/image-12.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/07/14/3-4-Accessing%20Information/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/07/14/3-4-Accessing%20Information/" class="post-title-link" itemprop="url">3.4.Accessing Information</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-07-14 15:30:22" itemprop="dateCreated datePublished" datetime="2024-07-14T15:30:22+08:00">2024-07-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-07-15 10:40:34" itemprop="dateModified" datetime="2024-07-15T10:40:34+08:00">2024-07-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CSAPP/" itemprop="url" rel="index"><span itemprop="name">CSAPP</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CSAPP/Chapter-3-Machine-level-Representation-of-Program/" itemprop="url" rel="index"><span itemprop="name">Chapter 3.Machine-level Representation of Program</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>628</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="34accessing-information"><span class="math inline">\(3.4.\)</span>Accessing Information</h1>
<h3 id="1machine-code-properties">1.Machine code properties</h3>
<ul>
<li><p>x86-64 instructions can range in length from 1 to 15 bytes, it
isn&apos;t fixed.</p></li>
<li><p>The instruction format is designed to insure that <strong>there&apos;s
a unique decoding of the bytes into machine instructions</strong>. For
example, only <code>pushq %rbx</code> can start with <code>53</code>(can
be analogied with opcode in RISC-V).</p></li>
<li><p>The disassembler determines the assembly code based
<strong>purely on the byte sequences in the machine-code
file</strong>.</p></li>
</ul>
<h3 id="2registers">2.Registers</h3>
<p><img src="/2024/07/14/3-4-Accessing%20Information/image-1.png"></p>
<ul>
<li><p>When we present instructions copying and generating 1-, 2-, 4-,
8-byte values, we follow the two conventions:</p>
<ul>
<li><p>Those that generate 1- or 2-byte quantities <strong>leave the
remaining bytes unchanged</strong>.</p></li>
<li><p>Those that generate 4-byte quantities <strong>set the upper 4
bytes of the register to zero</strong>.</p></li>
</ul></li>
<li><p>A function returns a value by <strong>storing it in register
<code>%rax</code></strong>, or <strong>in one of the low-order portions
of this register</strong>.</p></li>
</ul>
<h3 id="3operand-specifiers">3.Operand specifiers</h3>
<p><img src="/2024/07/14/3-4-Accessing%20Information/image-2.png"></p>
<p>&#x2003;&#x2003;There are three types of operand possibilities:</p>
<ul>
<li><p><em>Immediate</em>: It refers to constant value. In ATT format
assembly code, it is written with a <code>$</code> along with an
integer.</p></li>
<li><p><em>Register</em>: It denotes the content of a register. We use
the notation <span class="math inline">\(r_a\)</span> to denote a
register <span class="math inline">\(a\)</span> and indicate its value
with <span class="math inline">\(R{[r_{a}]}\)</span>.</p></li>
<li><p><em>Memory</em>: The most general form of it is <span class="math inline">\(Imm({r_b},{r_i},s)\)</span>, which is computed as
<span class="math inline">\(Imm+R[{r_b}]+R[{r_s}] \cdot s\)</span>.</p>
<ul>
<li><span class="math inline">\(Imm\)</span> is the immediate offset,
<span class="math inline">\(r_b\)</span> is the base register, <span class="math inline">\(r_i\)</span> is the index register.</li>
</ul></li>
</ul>
<p>&#x2003;&#x2003;<span class="math inline">\(e.g.\)</span></p>
<p><img src="/2024/07/14/3-4-Accessing%20Information/image-3.png"></p>
<p><img src="/2024/07/14/3-4-Accessing%20Information/image-4.png"></p>
<h3 id="4data-movement-instructions">4.Data Movement Instructions</h3>
<h4 id="asimple-data-movement-instructions">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>Simple data movement instructions</h4>
<p><img src="/2024/07/14/3-4-Accessing%20Information/image-5.png"></p>
<ul>
<li><p>The source operand designates a value that is <strong>immediate,
stored in a register, or stored in memory</strong>.</p></li>
<li><p>The destination operand designates a location that is
<strong>either a register or a memory address</strong>.</p></li>
<li><p>The value is first passed <strong>from source to a register, then
from the register to the destination</strong>.</p></li>
</ul>
<blockquote>
<p>The regular <code>movq</code> instruction can only have immediate
source operands that can be represented as 32-bit two&#xFFFD;s-complement
numbers. This value is then sign extended to produce the 64-bit value
for the destination. The <code>movabsq</code> instruction can have an
<strong>arbitrary 64-bit immediate value</strong> as its source operand
and can only have a register as a destination.</p>
</blockquote>
<blockquote>
<p>In x86-64, any instruction that generates a 32-bit value for a
register also <strong>sets the high-order portion of the register to
0</strong>.</p>
</blockquote>
<h4 id="bbit-extending-data-movementinstructions">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Bit-extending data movement
instructions</h4>
<p><img src="/2024/07/14/3-4-Accessing%20Information/image-6.png"></p>
<p><img src="/2024/07/14/3-4-Accessing%20Information/image-7.png"></p>
<ul>
<li><p>Each instruction name has <strong>size designators</strong> as
its final two characters&#xFFFD;the first specifying the source size, and the
second specifying the destination size.</p></li>
<li><p>The source can be either a register or stored in memory.</p></li>
<li><p>The destination is a register.</p></li>
</ul>
<p>&#x2003;&#x2003;<span class="math inline">\(e.g.\)</span>(Suffix decision)</p>
<p><img src="/2024/07/14/3-4-Accessing%20Information/image-8.png"></p>
<p>&#x2003;&#x2003;<span class="math inline">\(solution:\)</span>There are several
points to note:</p>
<ol type="1">
<li><p>In x86-64, we always <strong>give quad word registers to memory
reference</strong>, such as <code>%rax</code>.</p></li>
<li><p>We <strong>first decide which suffix to use by the
destination</strong>. For example, <code>movb $0xFF %bl</code>.</p></li>
<li><p>If <strong>the destination is a memory address(such as
<code>(%rax)</code>)</strong>, we <strong>decide which suffix to use by
the source</strong>.</p></li>
</ol>
<blockquote>
<p>Note that if both the source and the destination are from memory,
<strong>we can use all four suffix</strong>. The x86-64 imposes the
restriction that <strong>a move instruction cannot have both operands
refer to memory locations</strong>.</p>
</blockquote>
<h4 id="cdata-movement-example">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>Data movement example</h4>
<p><img src="/2024/07/14/3-4-Accessing%20Information/image-9.png"></p>
<ul>
<li><p>Procedure parameters <code>xp</code> and <code>y</code> are
stored in registers <code>%rdi</code> and <code>%rsi</code>.</p></li>
<li><p>Dereferencing a pointer involves <strong>copying that pointer
into a register</strong>, and then <strong>using this register in a
memory reference</strong>.</p></li>
</ul>
<p>&#x2003;&#x2003;<span class="math inline">\(e.g.\)</span>(Casting)</p>
<p><img src="/2024/07/14/3-4-Accessing%20Information/image-10.png"> <img src="/2024/07/14/3-4-Accessing%20Information/image-11.png"> <img src="/2024/07/14/3-4-Accessing%20Information/image-12.png"></p>
<p>&#x2003;&#x2003;<span class="math inline">\(solution:\)</span>The casting is in
fact <strong>the extension of bits</strong>. For example, if we want to
convert <code>char</code> to <code>int</code>, because <code>char</code>
takes word bits while <code>int</code> takes 32 bits, we use
<code>movsbl</code> to implement operations
like<code>int x = (int) char_element</code>:</p>
<p><img src="/2024/07/14/3-4-Accessing%20Information/image-13.png"> <img src="/2024/07/14/3-4-Accessing%20Information/image-14.png"></p>
<h4 id="dstack-operation">&#x2003;&#x2003;<span class="math inline">\(d.\)</span>Stack operation</h4>
<p><img src="/2024/07/14/3-4-Accessing%20Information/image-15.png"></p>
<p><img src="/2024/07/14/3-4-Accessing%20Information/image-16.png"> <img src="/2024/07/14/3-4-Accessing%20Information/image-17.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/07/14/3-2-Program-Encoding/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/07/14/3-2-Program-Encoding/" class="post-title-link" itemprop="url">3.2.Program Encoding</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-07-14 09:30:22" itemprop="dateCreated datePublished" datetime="2024-07-14T09:30:22+08:00">2024-07-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-07-15 10:29:41" itemprop="dateModified" datetime="2024-07-15T10:29:41+08:00">2024-07-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CSAPP/" itemprop="url" rel="index"><span itemprop="name">CSAPP</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CSAPP/Chapter-3-Machine-level-Representation-of-Program/" itemprop="url" rel="index"><span itemprop="name">Chapter 3.Machine-level Representation of Program</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>265</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="32program-encoding"><span class="math inline">\(3.2.\)</span>Program Encoding</h1>
<h3 id="1program-execution-process">1.Program execution process</h3>
<p>&#x2003;&#x2003;Say we want to compile two C program <code>p1.c</code> and
<code>p2.c</code>, we input the command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">linux&gt; gcc -0g -o p p1.c p2.c</span><br></pre></td></tr></table></figure>
<ol type="1">
<li><p>The C preprocessor expands the source code to <strong>include any
files specified with <code>#include</code> commands and with
<code>#define</code> declarations</strong>.</p></li>
<li><p>Compiler generates assembly code having name <code>p1.s</code>
and <code>p2.s</code>.</p></li>
<li><p>Assembler converts the assembly code into <em>binary
object-code</em> files <code>p1.o</code> and <code>p2.o</code>.</p></li>
</ol>
<blockquote>
<p>The object code contains binary representations of all instructions,
but doesn&apos;t include the address of the global value.</p>
</blockquote>
<ol start="4" type="1">
<li>Linker merges these two object-code files along with <em>code
implementing library functions</em> (e.g., <code>printf</code>) and
generates the final executable code file <code>p</code>(specified by
<code>-o p</code>).</li>
</ol>
<h3 id="2machine-code">2.Machine code</h3>
<h4 id="aprogram-memory">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>Program memory</h4>
<p>&#x2003;&#x2003;The program memory contains:</p>
<ul>
<li><p>the executable machine code for the program</p></li>
<li><p>some information required by the operating system</p></li>
<li><p>a run-time stack for managing procedure calls and
returns</p></li>
<li><p>blocks of memory allocated by the user (e.g., by using the
<code>malloc</code> library function).</p></li>
</ul>
<h4 id="bsomecommand">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Some
command</h4>
<p>&#x2003;&#x2003;We use <code>-S</code> to see the assembly code generated by the
compiler:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -0g -S mstore.c</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;We use <code>-c</code> to both compile and assemble the code:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -0g -c mstore.c</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;This will generate an object-code file <code>mstore.o</code>.</p>
<p>&#x2003;&#x2003;To inspect the contents of machine-code, we can use the
<em>disassembler</em>. The program <code>objdump</code> can serve the
role:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objdump -d mstore.o</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;The result is as below:</p>
<p><img src="/2024/07/14/3-2-Program-Encoding/image.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/06/29/5-6-Cache-coherence/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/06/29/5-6-Cache-coherence/" class="post-title-link" itemprop="url">5.6.Cache Coherence</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>
      

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-06-29 15:30:22 / &#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;16:22:57" itemprop="dateCreated datePublished" datetime="2024-06-29T15:30:22+08:00">2024-06-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/" itemprop="url" rel="index"><span itemprop="name">CS61C Great Ideas in Computer Architecture</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/Module-5-Parallelism/" itemprop="url" rel="index"><span itemprop="name">Module 5.Parallelism</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>401</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="56cache-coherence">5.6.Cache Coherence</h1>
<h3 id="1cache-model">1.Cache model</h3>
<p><img src="/2024/06/29/5-6-Cache-coherence/image.png"></p>
<p><img src="/2024/06/29/5-6-Cache-coherence/image-1.png"></p>
<h3 id="2coherence-concept">2.Coherence concept</h3>
<h4 id="acoherence-in-detail">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>Coherence in detail</h4>
<p>&#x2003;&#x2003;Caching shared data introduces a new problem. The following is an
example:</p>
<p><img src="/2024/06/29/5-6-Cache-coherence/image-2.png"></p>
<p>&#x2003;&#x2003;The two different processors have two different values for the same
location, this is referred to as <em>cache coherence problem</em>.</p>
<p>&#x2003;&#x2003;Informally, we could say that a memory system is coherent if
<strong>any read of a data item returns the most recently written value
of that data item</strong>. This simple concept contains two different
aspects of memory system behaviour:</p>
<ul>
<li><em>coherence</em>: defines <em>what</em> values can be returned by
a read.</li>
<li><em>consistency</em>: determines <em>when</em> a written value will
be returned by a read.</li>
</ul>
<p>&#x2003;&#x2003;A memory system is coherent if:</p>
<ol type="1">
<li>A read by a processor P to location X that follows <em>only one
write</em> by P to X always returns the value written by P.</li>
</ol>
<blockquote>
<p>This preserves program order.</p>
</blockquote>
<ol start="2" type="1">
<li>A read by a processor to location X that follows <em>only one
write</em> by another processor to X returns the written value if the
read and write are sufficiently separated in time.</li>
</ol>
<blockquote>
<p>This defines memory coherence.</p>
</blockquote>
<ol start="3" type="1">
<li>Writes to the same location are <strong>serialized</strong>; that
is, two writes to the same location by any two processors <strong>are
seen in the same order by all processors</strong>. For example, if CPU B
stores 2 into memory at address X after time step 3, processors can
never read the value at location X as 2 and then later read it as
1.</li>
</ol>
<h4 id="bsnooping-based-cache-coherence">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Snooping-based cache coherence</h4>
<p>&#x2003;&#x2003;One method of enforcing coherence is to ensure that a processor
<strong>has exclusive access to a data item</strong> before it writes
that item. This style of protocol is called a <em>write invalidate
protocol</em> because it <strong>invalidates copies in other caches on a
write</strong>.</p>
<p>&#x2003;&#x2003;Take the same example before, when we write 1 into location X by
CPU A, the CPU B will get a cache miss, and is forced to fetch a new
copy of data:</p>
<p><img src="/2024/06/29/5-6-Cache-coherence/image-3.png"></p>
<blockquote>
<p>Block size plays an important role in cache coherency. Large blocks
can cause what&apos;s called <em>false sharing</em>, when two unrelated
shared variables are located in the same cache block, the whole block is
exchanged between processors even though the processors are accessing
different variables.</p>
</blockquote>
<h3 id="3mosel-cache-coherencyprotocol">3.MOSEL cache coherency
protocol:</h3>
<h4 id="aprotocol-design">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>Protocol design</h4>
<p><img src="/2024/06/29/5-6-Cache-coherence/image-7.png"></p>
<hr>
<p><img src="/2024/06/29/5-6-Cache-coherence/image-8.png"></p>
<h4 id="bbasicconcepts">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Basic
concepts</h4>
<p><img src="/2024/06/29/5-6-Cache-coherence/image-5.png"></p>
<p><img src="/2024/06/29/5-6-Cache-coherence/image-6.png"></p>
<p><img src="/2024/06/29/5-6-Cache-coherence/image-4.png"></p>
<hr>
<p><img src="/2024/06/29/5-6-Cache-coherence/image-9.png"></p>
<h4 id="cexample">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>Example</h4>
<p><img src="/2024/06/29/5-6-Cache-coherence/image-10.png"></p>
<p><img src="/2024/06/29/5-6-Cache-coherence/image-11.png"></p>
<p><img src="/2024/06/29/5-6-Cache-coherence/image-12.png"></p>
<p><img src="/2024/06/29/5-6-Cache-coherence/image-13.png"></p>
<p><img src="/2024/06/29/5-6-Cache-coherence/image-14.png"></p>
<p><img src="/2024/06/29/5-6-Cache-coherence/image-15.png"></p>
<p><img src="/2024/06/29/5-6-Cache-coherence/image-16.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/06/29/5-5-Synchronization/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/06/29/5-5-Synchronization/" class="post-title-link" itemprop="url">5.5.Synchronization</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>
      

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-06-29 11:55:22 / &#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;14:56:03" itemprop="dateCreated datePublished" datetime="2024-06-29T11:55:22+08:00">2024-06-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/" itemprop="url" rel="index"><span itemprop="name">CS61C Great Ideas in Computer Architecture</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/Module-5-Parallelism/" itemprop="url" rel="index"><span itemprop="name">Module 5.Parallelism</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>450</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="55synchronization">5.5.Synchronization</h1>
<h3 id="1some-concepts">1.Some concepts</h3>
<p><img src="/2024/06/29/5-5-Synchronization/image.png"></p>
<h3 id="2lock-synchronization">2.Lock synchronization</h3>
<p><img src="/2024/06/29/5-5-Synchronization/image-1.png"></p>
<p><img src="/2024/06/29/5-5-Synchronization/image-2.png"></p>
<h3 id="3hardware-synchronization">3.Hardware synchronization</h3>
<h4 id="apossible-lock-problem">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>Possible lock problem</h4>
<p><img src="/2024/06/29/5-5-Synchronization/image-3.png"></p>
<p>&#x2003;&#x2003;To solve the problem, the multiprocessor must have the ability ot
<strong>atomically read and modify a memory location</strong>. That is,
<strong>nothing else can interpose itself between the read and the write
of the memory location</strong>.</p>
<blockquote>
<p>For example, consider two processors that each try to do
<code>lw</code> operation. This race is prevented, since exactly one of
the processors will perform <code>lw</code> first, returning 0, and the
second processor will return 1 when it does this. This is because
<strong>the operation is atomic: the exchange is indivisible, and two
simultaneous exchanges will be ordered by the hardware.</strong></p>
</blockquote>
<p><img src="/2024/06/29/5-5-Synchronization/image-4.png"></p>
<h4 id="binstruction-pair">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>instruction pair</h4>
<p>&#x2003;&#x2003;To implement atomical property, we can <strong>set a pair of
instructions</strong> in which the second instruction <strong>returns a
value showing whether the pair of instructions was executed as if the
pair was atomic</strong>.</p>
<p>&#x2003;&#x2003;In RISC-V, this pair of instructions includes a
<code>(lr, d)</code> and a <code>(sc, d)</code>:</p>
<p><img src="/2024/06/29/5-5-Synchronization/image-5.png"></p>
<ul>
<li>Thus, <code>sc.d</code> specifies three registers: one to hold the
address, one to indicate whether the atomic operation failed or
succeeded, and one to hold the value to be stored in memory if it
succeeded.</li>
</ul>
<blockquote>
<p>Notice that <code>(lr, d)</code> operation not only load a word into
pointed memory, but also <strong>record the memory address
internally</strong>, namely <em>reservation</em>. That&apos;s why we can use
<code>(sc, d)</code> to check if the operation is atomical.</p>
</blockquote>
<p>&#x2003;&#x2003;We can use this pair to implement atomic swap:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">again: lr.d x10, (x20)</span><br><span class="line">       sc.d x11, x23, (x20)</span><br><span class="line">       bne x11, x0, again   // branch if store fails</span><br><span class="line">       addi x23, x10, 0     // put loaded value in x23</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;Any time a processor intervenes and modifies the value in memory
between the <code>lr.d</code> and <code>sc.d</code> instructions, the
<code>sc.d</code> writes a nonzero value into <code>x11</code>, causing
the code sequence to try again.</p>
<blockquote>
<p>Since the store-conditional will fail after either another attempted
store to the load reservation address or any exception, care must be
taken in choosing which instructions are inserted between the two
instructions. In particular, only <strong>integer arithmetic, forward
branches, and backward branches out of the
load-reserved/store-conditional block</strong> can safely be permitted;
otherwise, it is possible to create <em>deadlock situations</em> where
the processor can never complete the sc.d because of repeated page
faults. In addition, the number of instructions between the
load-reserved and the store-conditional should be small to minimize the
probability that <strong>either an unrelated event or a competing
processor causes the store-conditional to fail frequently</strong>.</p>
</blockquote>
<p>&#x2003;&#x2003;Other atomic memory operations can be built using
<code>lr/sc</code> pairs, some are listed below:</p>
<p><img src="/2024/06/29/5-5-Synchronization/image-6.png"></p>
<h4 id="ctest-and-set-instruction">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>Test-and-Set instruction</h4>
<p><img src="/2024/06/29/5-5-Synchronization/image-7.png"></p>
<p><img src="/2024/06/29/5-5-Synchronization/image-8.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/06/29/5-4-Multicore-and-Other-Shared-Memory-Multiprocessors/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/06/29/5-4-Multicore-and-Other-Shared-Memory-Multiprocessors/" class="post-title-link" itemprop="url">5.4.Multicore and Other Shared Memory Multiprocessors</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>
      

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-06-29 11:22:22 / &#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;11:53:17" itemprop="dateCreated datePublished" datetime="2024-06-29T11:22:22+08:00">2024-06-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/" itemprop="url" rel="index"><span itemprop="name">CS61C Great Ideas in Computer Architecture</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/Module-5-Parallelism/" itemprop="url" rel="index"><span itemprop="name">Module 5.Parallelism</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>155</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="54multicoreand-other-shared-memory-multiprocessors">5.4.Multicore
and Other Shared Memory Multiprocessors</h1>
<h3 id="1amdarls-law">1.Amdarl&apos;s Law</h3>
<p><img src="/2024/06/29/5-4-Multicore-and-Other-Shared-Memory-Multiprocessors/image-6.png"></p>
<p><img src="/2024/06/29/5-4-Multicore-and-Other-Shared-Memory-Multiprocessors/image-7.png"></p>
<h3 id="2multiprocessor-design">2.Multiprocessor design</h3>
<p>&#x2003;&#x2003;There are two kinds of multiprocessor designs: one is to
<strong>provide a single physical address space that all processors can
share</strong>, another is to <strong>have a separate address space per
processor that requires that sharing must be explicit</strong>.</p>
<p>&#x2003;&#x2003;A <em>Shared memory multiprocessor(SMP)</em> is one that offers the
programmer <strong>a single physical address space across all
processors</strong>:</p>
<p><img src="/2024/06/29/5-4-Multicore-and-Other-Shared-Memory-Multiprocessors/image-8.png"></p>
<p>&#x2003;&#x2003;In this multiprocessor, Processors communicate through shared
variables in memory, with all processors capable of accessing any memory
location via loads and stores.</p>
<h3 id="3multiprocessor-operations">3.Multiprocessor operations</h3>
<p>&#x2003;&#x2003;Processors need to coordinate when operating on shared data, which
is called <em>synchronization</em>. One way is to <strong>use a lock for
a shared variable</strong>: <strong>Only one processor r at a time can
acquire the lock, and other processors interested in shared data must
wait until the original processor unlocks the variable.</strong></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/06/29/5-3-Hardware-Multithreading/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/06/29/5-3-Hardware-Multithreading/" class="post-title-link" itemprop="url">5.3.Hardware Multithreading</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>
      

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-06-29 10:38:22 / &#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;15:30:21" itemprop="dateCreated datePublished" datetime="2024-06-29T10:38:22+08:00">2024-06-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/" itemprop="url" rel="index"><span itemprop="name">CS61C Great Ideas in Computer Architecture</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/Module-5-Parallelism/" itemprop="url" rel="index"><span itemprop="name">Module 5.Parallelism</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>259</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="53hardware-multithreading">5.3.Hardware Multithreading</h1>
<h3 id="1basic-concepts-of-threads">1.Basic concepts of threads</h3>
<p><img src="/2024/06/29/5-3-Hardware-Multithreading/image.png"></p>
<p><img src="/2024/06/29/5-3-Hardware-Multithreading/image-1.png"></p>
<h3 id="2multithreading-intro">2.Multithreading intro</h3>
<p><img src="/2024/06/29/5-3-Hardware-Multithreading/image-2.png"></p>
<p>&#x2003;&#x2003;Hardware multithreading allows multiple threads to <strong>share
the functional units of a single processor in an overlapping
fashion</strong> to try to utilize the hardware resources
efficiently.</p>
<p>&#x2003;&#x2003;To permit this sharing, the processor must <strong>duplicate the
independent state of each thread</strong>.</p>
<p><img src="/2024/06/29/5-3-Hardware-Multithreading/image-3.png"></p>
<hr>
<p><img src="/2024/06/29/5-3-Hardware-Multithreading/image-4.png"></p>
<h3 id="3types-of-hardwaremultithreading">3.Types of hardware
multithreading</h3>
<p>&#x2003;&#x2003;There are 3 types of hardware multithreading approaches:</p>
<ul>
<li><p><em>Fine-grained multithreading</em>: It <strong>switches between
threads on each instruction</strong>, resulting in interleaved execution
of multiple threads.</p>
<ul>
<li><p>It&apos;s advantage is that it can hide the throughput losses that
arise from both short and long stalls, since instructions from other
threads can be executed when one thread stalls. Also, since it switches
threads frequently, it doesn&apos;t need to clear the pipeline
everytime.</p></li>
<li><p>However, it slows down the execution of the individual
threads.</p></li>
</ul></li>
<li><p><em>Coarse-grained multithreading</em>: It switch threads
<strong>only on expensive stalls</strong>, such as last-level cache
misses.</p>
<ul>
<li><p>It&apos;s much less likely to slow down individual execution.</p></li>
<li><p>However, it is limited from overcoming throughput losses for
pipeline start-up time.</p></li>
</ul></li>
<li><p><em>Simultaneous multithreading</em>: It uses a multiple-issue,
dynamically scheduled <em>pipelined processor</em> to <strong>exploit
thread-level parallelism while exploiting ILP</strong>.</p></li>
</ul>
<blockquote>
<p>With register renaming and dynamic scheduling, multiple instructions
from independent threads can be issued without regard to the dependences
among them; <strong>the resolution of the dependences can be handled by
the dynamic scheduling capability</strong>.</p>
</blockquote>
<p>&#x2003;&#x2003;SMT is always executing instructions from multiple threads, leaving
it up to the hardware to associate instruction slots and renamed
registers with their proper threads.</p>
<p><img src="/2024/06/29/5-3-Hardware-Multithreading/image-5.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/06/29/5-1-Parallelism-via-Instructions/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/06/29/5-1-Parallelism-via-Instructions/" class="post-title-link" itemprop="url">5.1.Parallelism via Instruction</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>
      

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-06-29 09:16:22 / &#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;09:11:34" itemprop="dateCreated datePublished" datetime="2024-06-29T09:16:22+08:00">2024-06-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/" itemprop="url" rel="index"><span itemprop="name">CS61C Great Ideas in Computer Architecture</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/Module-5-Parallelism/" itemprop="url" rel="index"><span itemprop="name">Module 5.Parallelism</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>1.6k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>6 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="51parallelism-via-instructions"><span class="math inline">\(5.1.\)</span>Parallelism via Instructions</h1>
<h3 id="1pipelining">1.Pipelining</h3>
<p>&#x2003;&#x2003;Exploiting the potential parallelism among instructions is called
<em>instruction-level parallelism</em>.</p>
<ul>
<li><p>The first is <strong>increasing the depth of the pipeline to
overlap more instructions</strong>.</p></li>
<li><p>We also need to <strong>reblance the remaining steps so they are
the same length</strong>.</p></li>
<li><p>Another approach is to <strong>replicate the internal components
so that it can launch multiple instruction in every pipeline
stage</strong>. The general name of this approach is <em>multiple
issue</em>.</p></li>
</ul>
<h3 id="2multiple-issue-processor">2.Multiple issue processor</h3>
<p>&#x2003;&#x2003;There are two main ways to implement a multiple-issue processor,
with the major difference being <strong>the division of work between the
compiler and the hardware</strong>. One is called <em>static multiple
issue</em> and the other <em>dynamic multiple issue</em>.</p>
<p>&#x2003;&#x2003;There are two primary distinct responsibilities within a
multiple-issue pipeline:</p>
<ol type="1">
<li><p>Packaging instructions into <em>issue slots</em>. It refers to
<strong>the position from which instructions could issue in a given
clock cycle</strong>. In dynamic multiple issue, it is normally dealt
with <strong>at runtime by processor</strong>.</p></li>
<li><p>Dealing with data and control hazards. The compiler handles it
statically. In contrast, most dynamic issue processors attempt to
alleviate them <strong>using hardware techniques operation at execution
time</strong>.</p></li>
</ol>
<h3 id="3speculationconceptsextracted-from-textbook">3.Speculation
concepts(extracted from textbook)</h3>
<p>&#x2003;&#x2003;Speculation is an approach that <strong>allows the
compilator/processor to &quot;guess&quot; about the properties of an
instruction</strong>. Any speculation mechanism must include both a
method to <strong>check if the guess was right</strong> and a method to
<strong>unroll or back out the effects of the instructions that were
executed speculatively</strong>.</p>
<p>&#x2003;&#x2003;Speculation may be done in the compiler or by the hardware. For
example,the compiler can use speculation to <strong>reorder
instructions, moving an instruction across a branch or a load across a
store</strong>. The processor hardware can perform the same
transformation at runtime using techniques we discuss later in this
section.</p>
<p>&#x2003;&#x2003;The recovery mechanisms used for incorrect speculation are rather
different. In the case of speculation in software, the compiler usually
<strong>inserts additional instructions that check the accuracy of the
speculation and provide a fix-up routine to use when the speculation is
wrong</strong>. In hardware speculation, the processor usually
<strong>buffers the speculative results until it knows they are no
longer speculative</strong>. If the speculation is correct, the
instructions are completed by <strong>allowing the contents of the
buffers to be written to the registers or memory</strong>. If the
speculation is incorrect, the hardware flushes the buffers and
re-executes the correct instruction sequence. Misspeculation typically
requires the pipeline to be flushed, or at least stalled, and thus
further reduces performance.</p>
<p>&#x2003;&#x2003;Speculation introduces one other possible problem: speculating on
certain instructions may <strong>introduce exceptions that were formerly
not present</strong>. For example, suppose a load instruction is moved
in a speculative manner, but the address it uses is not within bounds
when the speculation is incorrect. The result would be that an exception
that should not have occurred would occur. The problem is complicated by
the fact that if the load instruction were not speculative, then the
exception must occur! In compiler-based speculation, such problems are
avoided by <strong>adding special speculation support that allows such
exceptions to be ignored until it is clear that they really should
occur</strong>. In hardware-based speculation, <strong>exceptions are
simply buffered until it is clear that the instruction causing them is
no longer speculative and is ready to complete;</strong> at that point,
the exception is raised,and normal exception handling proceeds.</p>
<h3 id="4static-multiple-issue">4.Static multiple issue</h3>
<p>&#x2003;&#x2003;Static multiple-issue processors all use the compiler to assist
with packaging instructions and handling hazards. In a static issue
processor, we can think of the set of instructions issued in a given
clock cycle called <em>issue packet</em>. And it&apos;s useful to think of
the issue packet as a single instuction allowing weveral operations in
certain predefined fields.</p>
<p>&#x2003;&#x2003;When it comes to the certain instructions:</p>
<ul>
<li><p>We require that the instructions <strong>be paired and aligned on
a 64-bit boundary</strong>.</p></li>
<li><p>If on instruction of the pair cannot be used, we require that
<strong>it be replaced with nop</strong>.</p></li>
</ul>
<p>&#x2003;&#x2003;However, the overlapping of instructions <strong>increase the
relative performance loss from data and control hazards</strong>.</p>
<blockquote>
<p>For example, in our simple five-stage pipeline, loads have a use
latency of one clock cycle, which <strong>prevents one instruction from
using the result without stalling</strong>. In the two-issue, five-stage
pipeline the result of a load instruction <strong>cannot be used on the
next clock cycle</strong>. This means that the next two instructions
cannot use the load result without stalling.</p>
</blockquote>
<p>&#x2003;&#x2003;An important compiler technique to get more performance from loops
is <em>loop unrolling</em>:</p>
<ul>
<li>Say we are going to deal with this program:</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) {</span><br><span class="line">    A[i] = B[i] + C[i];</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Loop:</span><br><span class="line">    ld  x1, 0(xA)       ; Load A[i]</span><br><span class="line">    ld  x2, 0(xB)       ; Load B[i]</span><br><span class="line">    ld  x3, 0(xC)       ; Load C[i]</span><br><span class="line">    add x4, x2, x3      ; A[i] = B[i] + C[i]</span><br><span class="line">    sd  0(xA), x4       ; Store A[i]</span><br><span class="line">    addi xA, xA, 8      ; Increment A pointer</span><br><span class="line">    addi xB, xB, 8      ; Increment B pointer</span><br><span class="line">    addi xC, xC, 8      ; Increment C pointer</span><br><span class="line">    addi xI, xI, 1      ; Increment loop counter</span><br><span class="line">    blt  xI, 8, Loop    ; Branch if loop counter &lt; 8</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;We can do this iteration part for more times:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i += <span class="number">4</span>) {</span><br><span class="line">    A[i]   = B[i]   + C[i];</span><br><span class="line">    A[i+<span class="number">1</span>] = B[i+<span class="number">1</span>] + C[i+<span class="number">1</span>];</span><br><span class="line">    A[i+<span class="number">2</span>] = B[i+<span class="number">2</span>] + C[i+<span class="number">2</span>];</span><br><span class="line">    A[i+<span class="number">3</span>] = B[i+<span class="number">3</span>] + C[i+<span class="number">3</span>];</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Loop:</span><br><span class="line">    ld  x1, 0(xA)       ; Load A[i]</span><br><span class="line">    ld  x2, 0(xB)       ; Load B[i]</span><br><span class="line">    ld  x3, 0(xC)       ; Load C[i]</span><br><span class="line">    add x4, x2, x3      ; A[i] = B[i] + C[i]</span><br><span class="line">    sd  0(xA), x4       ; Store A[i]</span><br><span class="line"></span><br><span class="line">    ld  x5, 8(xA)       ; Load A[i+1]</span><br><span class="line">    ld  x6, 8(xB)       ; Load B[i+1]</span><br><span class="line">    ld  x7, 8(xC)       ; Load C[i+1]</span><br><span class="line">    add x8, x6, x7      ; A[i+1] = B[i+1] + C[i+1]</span><br><span class="line">    sd  8(xA), x8       ; Store A[i+1]</span><br><span class="line"></span><br><span class="line">    ld  x9, 16(xA)      ; Load A[i+2]</span><br><span class="line">    ld  x10, 16(xB)     ; Load B[i+2]</span><br><span class="line">    ld  x11, 16(xC)     ; Load C[i+2]</span><br><span class="line">    add x12, x10, x11   ; A[i+2] = B[i+2] + C[i+2]</span><br><span class="line">    sd  16(xA), x12     ; Store A[i+2]</span><br><span class="line"></span><br><span class="line">    ld  x13, 24(xA)     ; Load A[i+3]</span><br><span class="line">    ld  x14, 24(xB)     ; Load B[i+3]</span><br><span class="line">    ld  x15, 24(xC)     ; Load C[i+3]</span><br><span class="line">    add x16, x14, x15   ; A[i+3] = B[i+3] + C[i+3]</span><br><span class="line">    sd  24(xA), x16     ; Store A[i+3]</span><br><span class="line"></span><br><span class="line">    addi xA, xA, 32     ; Increment A pointer by 4</span><br><span class="line">    addi xB, xB, 32     ; Increment B pointer by 4</span><br><span class="line">    addi xC, xC, 32     ; Increment C pointer by 4</span><br><span class="line">    addi xI, xI, 4      ; Increment loop counter by 4</span><br><span class="line">    blt  xI, 8, Loop    ; Branch if loop counter &lt; 8</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;This operation has the following advantages:</p>
<ol type="1">
<li><p><strong>Reduce cycle control overhead</strong>: cycle control
operations are less frequent when the cycle is expanded. In the above
example, the loop control operation is reduced from one generation per
generation to one generation per four.</p></li>
<li><p><strong>Increase instruction level parallelism</strong>: the more
instructions expanded, the compiler can better schedule these
instructions, improve parallelism.</p></li>
<li><p><strong>Reduced branch prediction failure</strong>: the
probability of branch prediction failure is reduced due to the reduction
in the number of branch instructions and the frequency of loop control
operations.</p></li>
</ol>
<p>&#x2003;&#x2003;During the unrolling process, the compiler introduce additional
registers. The goal of the process, called <em>register renaming</em>,
it to <strong>eliminate dependences that are not true data
dependences</strong>, but could either lead to potential hazards or
prevent the compiler from flexibly scheduling the code.</p>
<h3 id="5dynamic-multiple-issueprocessor">5.Dynamic multiple-issue
processor</h3>
<p>&#x2003;&#x2003;Dynamic multiple-issue processors are also known as <em>superscalar
processors</em>.</p>
<p>&#x2003;&#x2003;Many superscalars extend the basic framework of dynamic issue
decisions to include <em>dynamic pipeline scheduling</em>. Dynamic
pipeline scheduling <strong>chooses which instructions to execute in a
given clock cycle while trying to avoid hazards and stalls</strong>.</p>
<ul>
<li><p><em>Dynamic pipeline scheduling</em> <strong>chooses which
instructions to execute next, possibly reordering them to avoid
stalls</strong>. The pipeline is divided into three major units: an
instruction fetch and issue unit, multiple functional units, and a
commit unit.</p>
<ul>
<li><p>The first unit fetch instructions, decodes them and sends them to
corresponding function unit for execution.</p></li>
<li><p>Each function unit has <em>buffers</em> called <em>reservation
stations</em>, which <strong>hold the operands and the
operation</strong>. As soon as the buffer contains all its operands and
the functional unit is ready to execute, the result calculated. The
result is sent to <strong>any reservation stations waiting for this
particular result</strong> and <strong>the commit
unit</strong>.</p></li>
<li><p>The commit unit <strong>buffers the result until it&apos;s safe to put
the result into the register file/memory</strong>. The buffer in the
commit unit, often called the <em>reorder buffer</em>, is also used to
supply operands.</p></li>
<li><p>Once a result is committed to the register file, it can be
fetched directly from there like in a normal pipeline.</p></li>
</ul></li>
</ul>
<p><img src="/2024/06/29/5-1-Parallelism-via-Instructions/image-23.png"></p>
<blockquote>
<p>If an operand is not in the register file or reorder buffer, it must
<strong>be waiting to be produced by a functional unit</strong>.
<strong>The name of the functional unit that will produce the result is
tracked</strong>. When that unit eventually produces the result,
<strong>it is copied directly into the waiting reservation
statio</strong>n from the functional unit bypassing the registers.</p>
</blockquote>
<p>&#x2003;&#x2003;We may think of a dynamically scheduled pipeline as an
<em>out-of-order execution</em>. To make programs behave as if they were
running on a simple in-order pipeline, the instruction fetch and decode
unit is required to <strong>issue instructions in order</strong>, which
allows dependences to be tracked, and the commit unit is required to
<strong>write results to registers and memory in program fetch
order</strong>. This conservative mode is called <em>in-order
commit</em>. Hence, if an exception occurs, the computer can point to
the last instruction executed.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/06/29/5-2-SIMD-MIMD-SIMD-SPMD-and-Vector/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/06/29/5-2-SIMD-MIMD-SIMD-SPMD-and-Vector/" class="post-title-link" itemprop="url">5.2.SIMD, MIMD, SIMD, SPMD and Vector</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>
      

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-06-29 09:16:22 / &#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;10:32:25" itemprop="dateCreated datePublished" datetime="2024-06-29T09:16:22+08:00">2024-06-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/" itemprop="url" rel="index"><span itemprop="name">CS61C Great Ideas in Computer Architecture</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/Module-5-Parallelism/" itemprop="url" rel="index"><span itemprop="name">Module 5.Parallelism</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>473</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="52simd-mimd-simd-spmd-andvector"><span class="math inline">\(5.2.\)</span>SIMD, MIMD, SIMD, SPMD and
Vector</h1>
<h3 id="1basic-concepts">1.Basic concepts</h3>
<p><img src="/2024/06/29/5-2-SIMD-MIMD-SIMD-SPMD-and-Vector/image.png"></p>
<p><img src="/2024/06/29/5-2-SIMD-MIMD-SIMD-SPMD-and-Vector/image-1.png"></p>
<ul>
<li><p>In SIMD, all the parallel execution units are
<strong>synchronized</strong>, and they all respond to a single
instruction <strong>that emanates from a single program
counter</strong>.</p></li>
<li><p>Each execution unit <strong>has its own address register, and so
have different data address</strong>.</p></li>
</ul>
<blockquote>
<p>The original motivation behind SIMD was to <strong>amortize the cost
of the control unit over execution units</strong>. The SIMD can also
save instrustion bandwidth and space: SIMD needs <strong>only one copy
of the code that is being simultaneously executed</strong>.</p>
</blockquote>
<blockquote>
<p>Since the instruction is single, SIMD works best when dealing with
<strong>identically structured data</strong>, which is called
<em>data-level parallelism</em>, e.g., for loop.</p>
</blockquote>
<p><img src="/2024/06/29/5-2-SIMD-MIMD-SIMD-SPMD-and-Vector/image-2.png"></p>
<ul>
<li><p>SPMD: The programmer write a single program that runs on all
processors of a <em>MIMD computer</em>, relying on conditional
statements when different processors should execute distinct section of
code.</p></li>
<li><p>The SIMD computers operate on <strong>vectors of
data</strong>.</p></li>
</ul>
<h3 id="2vector">2.Vector</h3>
<h4 id="aconcepts-and-characteristics">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>Concepts and characteristics</h4>
<p>&#x2003;&#x2003;The basic philosophy of vector architecture is to <strong>collect
data elements from memory, put them in order into a large set of
registers</strong>, and operate on them sequentially in registers using
<em>pipelined execution units</em>.</p>
<ul>
<li>A key feature of vector architectures is <strong>a set of vector
registers</strong>.</li>
</ul>
<p>&#x2003;&#x2003;Take the following expression as an example(it&apos;s called DAXPY
loop):</p>
<p><span class="math display">\[
Y = a \times X + Y
\]</span></p>
<p>&#x2003;&#x2003;In conventional RISC-V, it&apos;s written as below:</p>
<p><img src="/2024/06/29/5-2-SIMD-MIMD-SIMD-SPMD-and-Vector/image-3.png"></p>
<p>&#x2003;&#x2003;By using vector, we can write it in a more concise way:</p>
<p><img src="/2024/06/29/5-2-SIMD-MIMD-SIMD-SPMD-and-Vector/image-4.png"></p>
<p>&#x2003;&#x2003;No only does the code reduce the dynamic instruction bandwidth, but
also the pipeline stalls are required only <strong>once per vector
operation</strong>, rather than once per vector element.</p>
<p>&#x2003;&#x2003;Vector also holds the following characteristic:</p>
<ol type="1">
<li><p>The compiler indicates that <strong>the computation of each
result in the vector is independent</strong>. So compiler doesn&apos;t have
to check for data hazards within an instruction.</p></li>
<li><p>Since the element in a vector is adjacent, <strong>the cost of
the latency to main memory is seen only once for the entire
vector</strong>.</p></li>
<li><p>Because a complete loop is replaced by a vector instruction whose
<strong>behaviour is predetermined</strong>, control hazards are
nonexistent.</p></li>
</ol>
<h4 id="brelated-architecture">&#x2003;&#x2003; <span class="math inline">\(b.\)</span>Related architecture</h4>
<ul>
<li>Unlike multimedia extensions, the number of elements in a vector
operation isn&apos;t in the opcode but in <strong>a separate
register</strong>.</li>
</ul>
<blockquote>
<p>This means different versions of the vector architecture can simply
be implemented by changing the contents of the register, thus retain
binary compatibility.</p>
</blockquote>
<ul>
<li>The parallel semantics of a vector instruction allows using a
<em>deeply pipelined functional unit</em> to execute vector
operations:</li>
</ul>
<p><img src="/2024/06/29/5-2-SIMD-MIMD-SIMD-SPMD-and-Vector/image-5.png"></p>
<p>&#x2003;&#x2003;Vector arithmetic instructions only allow element N of one vector
register to take part in operations with element N from other vector
registers, and the structure is called <em>vector lanes</em>:</p>
<p><img src="/2024/06/29/5-2-SIMD-MIMD-SIMD-SPMD-and-Vector/image-6.png"></p>
<p>&#x2003;&#x2003;As with a traffic highway, we can increase the peak throughput of a
vector unit by <strong>adding more lanes</strong>.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/06/14/4-1-Caches/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/06/14/4-1-Caches/" class="post-title-link" itemprop="url">4.1.Caches</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-06-14 08:36:22" itemprop="dateCreated datePublished" datetime="2024-06-14T08:36:22+08:00">2024-06-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-15 15:07:48" itemprop="dateModified" datetime="2024-06-15T15:07:48+08:00">2024-06-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/" itemprop="url" rel="index"><span itemprop="name">CS61C Great Ideas in Computer Architecture</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/Module-4-Cache/" itemprop="url" rel="index"><span itemprop="name">Module 4.Cache</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>2.9k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>11 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="41caches"><span class="math inline">\(4.1.\)</span>Caches</h1>
<h3 id="1-some-concepts-amp-libraryanalogy">1. Some concepts &amp; Library
analogy</h3>
<blockquote>
<p>Suppose you were a student writing a term paper on important
historical developments in computer hardware. You are sitting at a desk
in a library with a collection of books that you have pulled from the
shelves and are examining. You find that several of the important
computers that you need to write about are described in the books you
have, but there is nothing about the EDSAC. Therefore, you go back to
the shelves and look for an additional book. You find a book on early
British computers that covers the EDSAC. Once you have a good selection
of books on the desk in front of you, there is a high probability that
<strong>many of the topics you need can be found in them, and you may
spend most of your time just using the books on the desk without
returning to the shelves</strong>. Having several books on the desk in
front of you saves time compared to having only one book there and
constantly having to go back to the shelves to return it and take out
another.</p>
<p>The same principle allows us to create the illusion of a large memory
that we can access as fast as a very small memory. Just as you did not
need to access all the books in the library at once with equal
probability, <strong>a program does not access all of its code or data
at once with equal probability</strong>. Otherwise,it would be
impossible to make most memory accesses fast and still have large memory
in computers, just as it would be impossible for you to fit all the
library books on your desk and still find what you wanted quickly.</p>
</blockquote>
<p>&#x2003;&#x2003;The above line illustrates the <em>principel of locality</em>.
There are two kinds of localities:</p>
<ul>
<li><p>Temporal locality(locality in time): <strong>If an item is
referenced, it will tend to be referenced again soon.</strong> (If you
recently brought a book to your desk to look at, you will probably need
to look at it again soon.)</p></li>
<li><p>Spatial locality (locality in space): <strong>If an item is
referenced, items whose addresses are close by will tend to be
referenced soon.</strong> (For example, when you brought out the book on
early English computers to learn about the EDSAC, you also noticed that
there was another book shelved next to it about early mechanical
computers, so you likewise brought back that book and, later on, found
something useful in that book.)</p></li>
</ul>
<p>&#x2003;&#x2003;We take advantage of the principle of locality by implementing the
memory as a <em>memory hierarchy</em>. It contains multiple levels, but
<strong>data are copied between only two adjacent levels at a
time</strong>.</p>
<p><img src="/2024/06/14/4-1-Caches/image.png"></p>
<p><img src="/2024/06/14/4-1-Caches/image-1.png"></p>
<blockquote>
<p>The faster memories are <strong>more expensive per bit</strong> than
the slower and thus are <strong>smaller</strong>.</p>
</blockquote>
<p><img src="/2024/06/14/4-1-Caches/image-2.png"></p>
<ul>
<li>If <strong>the data requested by the processor appear in some block
in the upper level</strong>, it&apos;s called a <em>hit</em>(like you find a
book on your desk). Else it&apos;s called a <em>miss</em>.</li>
</ul>
<p><img src="/2024/06/14/4-1-Caches/image-28.png"></p>
<h3 id="2memory-technologies">2.Memory technologies</h3>
<p><img src="/2024/06/14/4-1-Caches/image-3.png"></p>
<h3 id="3caches-basics">3.Caches basics</h3>
<h4 id="adirect-mapped-structure">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>Direct-mapped structure</h4>
<p>&#x2003;&#x2003;For each word, we can assign a location in cache based on the
<em>address</em> of the word in memory, and this is called
<strong>direct-mapped</strong>.</p>
<p>&#x2003;&#x2003;The struction uses this mapping to find a block:</p>
<p><span class="math display">\[
(blockAddress)\mod (numberOfBlockInCache)
\]</span></p>
<ul>
<li>We add a set of <em>tags</em> to the cache to judge if the data in
the cache corresponds to a requested word. The tag needs to contain
<strong>the upper portion of the address</strong>:</li>
</ul>
<p><img src="/2024/06/14/4-1-Caches/image-4.png"></p>
<ul>
<li><p>We add a <em>valid bit</em> to <strong>indicate whether an entry
contains a valid address</strong>. If the bit isn&apos;s set, there cannot be
a match for this block.</p></li>
<li><p>A <em>cache index</em> is used to <strong>select the
block</strong>.</p></li>
</ul>
<p><img src="/2024/06/14/4-1-Caches/image-5.png"></p>
<p>&#x2003;&#x2003;The digit capacity of tage field and the total number of bits in
the struction can be calculated by the following steps:</p>
<p><img src="/2024/06/14/4-1-Caches/image-6.png"></p>
<h4 id="bdealing-with-missing-rate">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Dealing with missing rate</h4>
<ul>
<li><p><strong>Larger blocks exploit spatial locality to lower miss
rates</strong>. This is because larger blocks <strong>contain more
adjacent data</strong>, taking advantage of locality of reference,
making it more likely that programs will hit the cache when they access
the data.</p></li>
<li><p>However, the miss rate may go up eventually if <strong>the block
size becomes a significant fraction of the cache size</strong>, for
<strong>there will be a great deal of competition for those
blocks</strong>. As a result, a block will be bumped out of the cache
before its words are accessed.</p></li>
<li><p>Also, enlarging the block size makes the <em>miss penalty</em>
larger.</p>
<ul>
<li><p>The miss penalty is determined by <strong>the time required to
fetch the block from the next lower level of the hierarchy and load it
into the cache</strong>.</p></li>
<li><p>The time to fetch the block has two parts: <strong>the latency to
the first word</strong> and <strong>the transfer time for the rest of
the block</strong>.</p></li>
</ul></li>
</ul>
<h3 id="4handling-cache-misses">4.Handling cache misses</h3>
<p>&#x2003;&#x2003;The cache miss handling is done in collaboration with the
<em>process control unit</em> and with a separate <em>controller</em>
that initiates the memory access and refills the cache.</p>
<ul>
<li>The control unit in cache must detect a miss and process the miss by
fetching the requested data from memory. If the cache reports a hit, it
uses the data as usual.</li>
</ul>
<p>&#x2003;&#x2003;To handle the <em>instruction misses</em>, we need to:</p>
<ol type="1">
<li><p>Send the original PC value to the memory. It equals to
<code>PC-4</code>.</p></li>
<li><p>Instruct main memory to perform a read and wait for the memory to
complete its access.</p></li>
<li><p>Write the cache entry, putting the data from memory in the data
portion of the entry, writing the upper bits of the address(from the
ALU)into the tag field, and turning the valid bit on.</p></li>
<li><p><strong>Restart the instruction execution at the first
step</strong>, which will refetch the instruction, this time
<strong>finding it in the cache</strong>.</p></li>
</ol>
<h3 id="5handling-writes">5.Handling writes</h3>
<h4 id="awrite-through">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>Write-through</h4>
<p>&#x2003;&#x2003;One simple way to deal with write hit is <strong>always to write
the data into both the memory and the cache</strong>. However, the write
to main memory takes a long time, thus reduce the performance.</p>
<p>&#x2003;&#x2003;One solution is to use a <em>write buffer</em>. It <strong>stores
the data while they are waiting to be written to memory</strong>.</p>
<ul>
<li><p>After writing the data into the cache and the write buffer, the
processor continues execution.</p></li>
<li><p>When a write to main memory completes, the entry in the write
buffer is freed.</p></li>
<li><p>If the write buffer is full when the processor reaches a write,
the processor must <strong>stall until there&apos;s an empty position in the
buffer</strong>.</p></li>
</ul>
<h4 id="bwrite-back">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Write-back</h4>
<p>&#x2003;&#x2003;When a write occurs, the new value is written only to the block in
the cache. The modified block is written to the lower level of the
hierarchy when <strong>it&apos;s replaced</strong>. This scheme is called
<em>write-back</em>. It can improve performance especially if
<strong>processors can generate writes faster than writes can be handled
by the main memory</strong>.</p>
<ul>
<li><p>In the write-through process, we can simply overwrite the block.
But in a write-back process, if we overwrite a block <strong>before we
knew whether the store had hit the cache</strong>, we may destroy the
contents of the block which isn&apos;t backed up. To avoid this, we take the
two methods:</p>
<ul>
<li><p>We use two cycles, one to <strong>check for hit</strong> and one
to <strong>perform the write</strong>.</p></li>
<li><p>Or we can use a <em>store buffer</em> to hold the data. When it&apos;s
used, the processor does the cache lookup and <strong>places the data in
the store buffer during the normal cache access cycle</strong>. The new
data <strong>are written from the store buffer into the cache on the
next unused cache access cycle</strong>.</p></li>
</ul></li>
</ul>
<blockquote>
<p>By comparison, we can always use one cycle to do writing in
write-through process. We read the tag and write the data portion of the
selected block. If the tag matches the address of the current block, the
processor continues normally, since the correct block has been updated.
Otherwise, the processor <strong>generates a write miss to fetch the
rest of the block corresponding to that address</strong>.</p>
</blockquote>
<p>&#x2003;&#x2003;Many write-back caches also include <em>write buffers</em> that are
used to <strong>reduce the miss penalty when a miss replaces a modified
block</strong>. In such a case, <strong>the modified block is moved to a
write-back buffer associated with the cache</strong> while the requested
block is read from memory. The write-back buffer is later written back
to memory.</p>
<blockquote>
<p>The main idea is not to touch the main memory as much as
possible.</p>
</blockquote>
<p><img src="/2024/06/14/4-1-Caches/image-11.png"></p>
<hr>
<p><img src="/2024/06/14/4-1-Caches/image-20.png"></p>
<h4 id="cwrite-allocate-amp-nowrite-allocate">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>Write-allocate &amp; No
write-allocate</h4>
<p>&#x2003;&#x2003;In write-through process, to deal with the write miss, we
<strong>allocate a block in the cache called write allocate</strong>.
The block is fetched from memory and then the appropriate portion of the
block is overwritten.</p>
<blockquote>
<p>This reduces the number of accesses to main memory and increases the
speed of access.</p>
</blockquote>
<p>&#x2003;&#x2003;Another strategy is to update the portion of the block <strong>in
memory but not put it in the cache</strong>. This is because sometimes
we need to write in the entire blocks of data, and in such situation
writing in cache is unnecessary.</p>
<p><img src="/2024/06/14/4-1-Caches/image-21.png"></p>
<p><img src="/2024/06/14/4-1-Caches/image-22.png"></p>
<blockquote>
<p>Since write-through strategy ensures the consistence between memory
and cache, if we use write-allocate strategy, the cache will contain
reduntant data block, which makes cache management more difficult.</p>
<p>And for write-back, this ensures the data consistence.</p>
</blockquote>
<h4 id="danexample">&#x2003;&#x2003;<span class="math inline">\(d.\)</span>An
example</h4>
<p><img src="/2024/06/14/4-1-Caches/image-7.png"></p>
<p>&#x2003;&#x2003;In this design, the steps for reading request are as follows:</p>
<ol type="1">
<li><p>Send the address to the appropriate cache.</p></li>
<li><p>If the cache signal hit, the requested word is available on the
data lines. A <em>block index</em> field is used to control the
multiplexor to select the required word from the 16 words in the indexed
block.</p></li>
<li><p>If the cache signals miss, <strong>we send the address to the
main memory. When the memory returns with the data</strong>, we write it
into the cache and then read it to fulfill the request.</p></li>
</ol>
<h3 id="6cache-performanceimprovement">6.Cache performance
improvement</h3>
<p>&#x2003;&#x2003;There are two different techniques to improve cache performance.
One focuses on reducing the miss rate by <strong>reducing the
probability that two distinct memory blocks will contend for the same
cache location</strong>. The other reduces the miss penalty by
<strong>adding an additional level to the hierarchy</strong>. The second
technique is called <em>multilevel caching</em>.</p>
<h4 id="amore-flexible-placement-of-blocks">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>More flexible placement of blocks</h4>
<ul>
<li><p><em>Fully associative</em>: In this scheme, a block can be placed
in <strong>any location in the cache</strong>, that is, <strong>the
block may be associated with any entry in the cache</strong>.</p>
<ul>
<li><p>To find a given block in a fully-associative cache, <strong>all
the entries in the cache must be searched</strong>.</p></li>
<li><p>This process is done <strong>in parallel with a comparator
associated with each cache entry</strong>. This comparators
significantly increase the hardware cost, so the scheme only suits for
caches with small numbers of blocks.</p></li>
</ul></li>
<li><p><em>Set associative</em>: In this scheme, there are a fixed
number of locations where each block can be placed. An <em>n-way set
associative</em> cache consists of a number of sets, each of which has
<span class="math inline">\(n\)</span> blocks.</p></li>
</ul>
<p><img src="/2024/06/14/4-1-Caches/image-8.png"></p>
<p>&#x2003;&#x2003;The advantage of increasing the degree of associativity is that
<strong>it usually decrease the miss rate</strong>. However, there&apos;s
little further improvement in going to rather higher associativity.</p>
<h4 id="blocating-a-block-in-the-cache">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Locating a block in the cache</h4>
<p>&#x2003;&#x2003;Let&apos;s first take a block in a set-associative cache for
example:</p>
<p><img src="/2024/06/14/4-1-Caches/image-9.png"></p>
<ul>
<li><p>The <em>tag</em> is checked to see <strong>if it matches the
block address from the processor</strong>.</p></li>
<li><p>The <em>index</em> is used to <strong>select the set containing
the address of interest</strong>.</p></li>
<li><p>All the tags in the selected set are searched <strong>in
parallel</strong>.</p></li>
</ul>
<p>&#x2003;&#x2003;In a direct-mapped cache, only a single comparator is needed, and
we access the cache simply by indexing. In a <em>four-way
set-associative</em> cache, four comparators are needed, together with a
<strong>4-to-1 multiplexor to choose among the four potential
sets</strong>. The cache access consists of indexing the appropriate set
and then searching the tags of the set.</p>
<p><img src="/2024/06/14/4-1-Caches/image-10.png"></p>
<p>&#x2003;&#x2003;The choice among these three scheme depends on <strong>the cost of
a miss</strong> versus <strong>the cost of implementing
associativity</strong>.</p>
<h4 id="cchoosing-which-block-to-replace">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>Choosing which block to replace</h4>
<p>&#x2003;&#x2003;There are two primary strategies for replacement in set-associative
or fully associative caches:</p>
<ul>
<li><p><em>Random</em>: Candidate blocks are randomly selected, possibly
using some hardware assistance.</p></li>
<li><p><em>Least recently used</em>(LRU): The block replaced is the one
that has been unused for the longest time.</p></li>
</ul>
<p>&#x2003;&#x2003;In practice, LRU is too costly to implement for hierarchies with
more than a small degree of associativity, since <strong>tracking the
usage information is expensive</strong>.</p>
<h5 id="iapproximate-lru">&#x2003;&#x2003;<span class="math inline">\(i.\)</span>Approximate LRU</h5>
<p><img src="/2024/06/14/4-1-Caches/image-23.png"></p>
<hr>
<p><img src="/2024/06/14/4-1-Caches/image-24.png"></p>
<h4 id="dmultilevel-caches">&#x2003;&#x2003;<span class="math inline">\(d.\)</span>Multilevel caches</h4>
<p>&#x2003;&#x2003;To close the gap between the fast clock rates of processors and the
long time to access DRAMs, most microprocessors support <strong>an
addition level of caching</strong>.</p>
<ul>
<li><p>The second-level cache is normally on the chip, and is access
<strong>whenever a miss occurs in the primary cache</strong>.</p></li>
<li><p>If the second-level cache contains the desired data, the miss
penalty for the first-level cache will be <strong>the access time of the
second-level cache</strong>, which is much less time.</p></li>
</ul>
<p>&#x2003;&#x2003;The design considerations for a primary and secondary cache are
different. This two-level structure allows the primary cache to focus on
<strong>minimizing hit time</strong> to yield a shorter clock cycle or
fewer pipeline stages, while allowing the second cache to focus on
<strong>miss rate</strong> to reduce the penalty of long memory access
times.</p>
<ul>
<li><p>The primary cache is <strong>smaller</strong>, and may use
<strong>a smaller block size</strong> to go with the smaller cache size
and reduce miss penalty.</p></li>
<li><p>The second cache will be <strong>much larger than in a
single-level cache</strong>. It also use higher associativity than the
primary cache, both for reducing the miss rates.</p></li>
</ul>
<hr>
<p><img src="/2024/06/14/4-1-Caches/image-41.png"></p>
<h3 id="7three-cs">7.Three Cs</h3>
<p>&#x2003;&#x2003;In the hierarchy model, all misses are classified into one of three
categories:</p>
<ul>
<li><p>Compulsory misses: These are cache misses caused by <strong>the
first access to a block that has never been in the cache</strong>. These
are also called cold-start misses.</p></li>
<li><p>Capacity misses: These are cache misses caused when <strong>the
cache cannot contain all the blocks needed during execution of a
program</strong>. Capacity misses occur <strong>when blocks are replaced
and then later retrieved</strong>.</p></li>
<li><p>Conflict misses: These are cache misses that occur in
set-associative or direct-mapped caches when <strong>multiple blocks
compete for the same set</strong>. These cache misses are also called
collision misses.</p></li>
</ul>
<hr>
<ul>
<li><p>Increasing associativity reduces conflict misses, but
associativity may <strong>slow access time</strong>, leading to lower
overall performance.</p></li>
<li><p>Capacity misses can be reduced by enlarging the cache(so
second-level caches is large). Meanwhile, when we make the cache larger,
we must also be careful about <strong>increasing the access
time</strong>(so the first-level caches is small).</p></li>
<li><p>Since compulsory misses are generated by the first reference to a
block, we can simple increase the block size to reduce the block
number.</p></li>
</ul>
<h3 id="8using-fsm-to-control-acache">8.Using FSM to control a
cache</h3>
<h4 id="afinite-state-machines">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>Finite-State Machines</h4>
<p>&#x2003;&#x2003;A FSM consists of a set of states and directions on how to change
states.</p>
<ul>
<li><p>The directions are defined by a <em>next-state function</em>,
which maps the current state and the inputs to a new state.</p></li>
<li><p>Each state of FSM specifies a set of outputs that are asserted
when the machine is in this state.</p></li>
<li><p>A FSM can be implemented with a temporary register that
<strong>holds the current state</strong> and <strong>a block of
combinatinoal logic</strong> that determines both the data-path signals
to be asserted and the next state.</p></li>
</ul>
<p><img src="/2024/06/14/4-1-Caches/image-12.png"></p>
<h4 id="bcontroller">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Controller</h4>
<p><img src="/2024/06/14/4-1-Caches/image-13.png"></p>
<ul>
<li><p><em>Ideal</em>: This state <strong>waits for a valid read or
write request from the processor</strong>, which <strong>moves the FSM
to the Compare Tag state</strong>.</p></li>
<li><p><em>Compare Tag</em>: This state tests to see <strong>if the
requested read or write is a hit or a miss</strong>. The index portion
of the address <strong>selects the tag to be compared</strong>. If the
data in the cache block referred to by the index portion of the address
are valid, and the tag portion of the address matches the tag, then it
is a hit. Either the data are read from the selected word if it is a
load or written to the selected word if it is a store. The Cache Ready
signal is then set. <strong>If it is a write,the dirty bit is set to
1</strong>. Note that a write hit also sets the valid bit and the tag
field; while it seems unnecessary, it is included because the tag is a
single memory, so <strong>to change the dirty bit we likewise need to
change the valid and tag fields</strong>. If it is a hit and the block
is valid, the FSM <strong>returns to the idle state</strong>. A miss
<strong>first updates the cache tag</strong> and then goes either to the
Write-Back state, if the block at this location has dirty bit value of
1, or to the Allocate state if it is 0.</p></li>
<li><p><em>Write-Back</em>: This state writes the 128-bit block to
memory using <strong>the address composed from the tag and cache
index</strong>. We remain in this state waiting for the Ready signal
from memory. When the memory write is complete, the FSM <strong>goes to
the Allocate state</strong>.</p></li>
<li><p><em>Allocate</em>: The new block <strong>is fetched from
memory</strong>. We <strong>remain in this state waiting for the Ready
signal from memory</strong>. When the memory read is complete, the FSM
goes to the Compare Tag state.</p></li>
</ul>
<h3 id="9fully-associative-cacheintroduction">9.Fully associative cache
introduction</h3>
<p><img src="/2024/06/14/4-1-Caches/image-14.png"></p>
<hr>
<p><img src="/2024/06/14/4-1-Caches/image-15.png"></p>
<h3 id="10direct-mapped-cacheintroduction">10.Direct-mapped cache
introduction</h3>
<p><img src="/2024/06/14/4-1-Caches/image-16.png"></p>
<p><img src="/2024/06/14/4-1-Caches/image-17.png"></p>
<hr>
<p><img src="/2024/06/14/4-1-Caches/image-29.png"></p>
<hr>
<p><img src="/2024/06/14/4-1-Caches/image-30.png"></p>
<p><img src="/2024/06/14/4-1-Caches/image-31.png"></p>
<p><img src="/2024/06/14/4-1-Caches/image-32.png"></p>
<hr>
<p><img src="/2024/06/14/4-1-Caches/image-33.png"></p>
<h3 id="11set-associativeintroduction">11.Set-associative
introduction</h3>
<p><img src="/2024/06/14/4-1-Caches/image-18.png"></p>
<p><img src="/2024/06/14/4-1-Caches/image-19.png"></p>
<hr>
<p><img src="/2024/06/14/4-1-Caches/image-34.png"></p>
<hr>
<p><img src="/2024/06/14/4-1-Caches/image-35.png"></p>
<h3 id="12fully-associativeintroduction">12.Fully-associative
introduction</h3>
<p><img src="/2024/06/14/4-1-Caches/image-25.png"></p>
<p><img src="/2024/06/14/4-1-Caches/image-26.png"></p>
<p><img src="/2024/06/14/4-1-Caches/image-27.png"></p>
<h3 id="13analyzing-cache-performance">13.Analyzing cache performance</h3>
<p><img src="/2024/06/14/4-1-Caches/image-36.png"></p>
<p><img src="/2024/06/14/4-1-Caches/image-37.png"></p>
<p><img src="/2024/06/14/4-1-Caches/image-38.png"></p>
<hr>
<p><img src="/2024/06/14/4-1-Caches/image-39.png"></p>
<p><img src="/2024/06/14/4-1-Caches/image-40.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/06/07/3-5-Pipelined-Datapath-and-Control/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/06/07/3-5-Pipelined-Datapath-and-Control/" class="post-title-link" itemprop="url">3.5.Pipelined Datapath and Control</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-06-07 11:36:22" itemprop="dateCreated datePublished" datetime="2024-06-07T11:36:22+08:00">2024-06-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-29 09:08:24" itemprop="dateModified" datetime="2024-06-29T09:08:24+08:00">2024-06-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/" itemprop="url" rel="index"><span itemprop="name">CS61C Great Ideas in Computer Architecture</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/Module-3-Program-Process/" itemprop="url" rel="index"><span itemprop="name">Module 3.Program Process</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>1.7k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>6 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="35pipelined-datapath-and-control"><span class="math inline">\(3.5.\)</span>Pipelined Datapath and Control</h1>
<h3 id="1some-point">1.Some point</h3>
<ul>
<li><p>All the instructions go from left to right through the datapath
except the write-back stage and the selection of the next value of PC,
and they never move backward.</p>
<ul>
<li>So the first right-to-left flow of data can lead to data hazards
while the second leads to control hazards.</li>
</ul></li>
<li><p>One way to show what happens in pipelined execution is to pretend
that each instruction has its own datapath, and then to place these
datapaths on a timeline to show their relationship:</p></li>
</ul>
<p><img src="/2024/06/07/3-5-Pipelined-Datapath-and-Control/image.png"></p>
<p>&#x2003;&#x2003;All instructions advance during each clock cycle from one pipeline
register to the next.</p>
<h3 id="2pipeline-registers">2.Pipeline registers</h3>
<ul>
<li><p>A separate pipeline register is redundant to the state that is
updated. For example, a load instruction will place its result in one of
the 32 registers, and any later instruction that needs that data will
<strong>simply read the appropriate register</strong>.</p>
<ul>
<li>Every instruction updates PC, and the PC can be thought of as a
pipeline register: one <strong>that feeds the IF stage of the
pipeline</strong>.</li>
</ul></li>
</ul>
<p><img src="/2024/06/07/3-5-Pipelined-Datapath-and-Control/image-1.png"></p>
<p>&#x2003;&#x2003;We use the command <code>ld</code> to illustrate the pipe stage
that is active in each stage:</p>
<ol type="1">
<li><em>Instruction fetch</em>: The PC is saved in the IF/ID pipeline
register in case it&apos;s needed later for an instruction. This stage occurs
<strong>before the instruction is identified</strong>.</li>
</ol>
<blockquote>
<p>The computer cannot know which type of instruction is being fetched,
so it must <strong>prepare for any instruction, passing potentially
needed information down the pipeline</strong>.</p>
</blockquote>
<ol start="2" type="1">
<li><em>Instruction decode and register file read</em>: Both the two
read value and sign-extended immediate are stored in the ID/EX pipeline
register, along with PC address.</li>
</ol>
<p><img src="/2024/06/07/3-5-Pipelined-Datapath-and-Control/image-2.png"></p>
<ol start="3" type="1">
<li><em>Execute/address calculation</em>: It reads the information from
the ID/EX pipeline register and add then using ALU. The result is placed
in EX/MEM pipeline register.</li>
</ol>
<p><img src="/2024/06/07/3-5-Pipelined-Datapath-and-Control/image-3.png"></p>
<ol start="4" type="1">
<li><em>Memory access</em>: It uses the data from EX/MEM register and
loads the data into MEM/WB pipeline register.</li>
</ol>
<p><img src="/2024/06/07/3-5-Pipelined-Datapath-and-Control/image-4.png"></p>
<p><img src="/2024/06/07/3-5-Pipelined-Datapath-and-Control/image-5.png"></p>
<ol start="5" type="1">
<li><em>Write back</em>: There&apos;s nothing to do in this stage.</li>
</ol>
<p><img src="/2024/06/07/3-5-Pipelined-Datapath-and-Control/image-6.png"></p>
<p>&#x2003;&#x2003;From the analysis above, we can get some key point:</p>
<ul>
<li><p>The information must be placed in a pipeline register, otherwise,
<strong>the information is lost when the next instruction enters that
pipeline stage</strong>.</p></li>
<li><p>Each logical component of the datapath(ALU, data memory, etc),
can be used <strong>only within a single pipeline stage</strong>. That
is, <strong>each pipeline register can only be used by one phase in one
clock cycle</strong>, which ensures that <strong>no more than one
instruction can access the same hardware resources simultaneously in one
clock cycle</strong>, thus avoiding structural dangers.</p></li>
</ul>
<p>&#x2003;&#x2003;We know that the instruction in IF/ID pipeline register supplies
the writer register number, but the instruction fetch procedure occurs
after the <code>ld</code> instruction(because it is conducted before an
instruction is identified, so only when we complete the <code>ld</code>
instruction will this step be done)! Hence, we need to <strong>preserve
the distination register number in the <code>ld</code>
instruction</strong>. The <code>ld</code> must pass the register number
from ID/EX through EX/MEM to the MEM/WB pipeline register for use in the
WB stage.</p>
<h3 id="3data-hazards-amp-forwarding">3.Data hazards &amp; forwarding</h3>
<h4 id="adatahazards">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>Data
hazards</h4>
<p><img src="/2024/06/07/3-5-Pipelined-Datapath-and-Control/image-7.png"></p>
<h4 id="bdetact-hazards">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Detact hazards</h4>
<p>&#x2003;&#x2003;We first introduce a notation: we use &quot;ID/EX.RegisterRs1&quot; to refer
to the number of 1 register whose value is found in the pipeline
register ID/EX.</p>
<p><img src="/2024/06/07/3-5-Pipelined-Datapath-and-Control/image-8.png"></p>
<p>&#x2003;&#x2003;Using this notation, the two pairs of hazard conditions are:</p>
<p><img src="/2024/06/07/3-5-Pipelined-Datapath-and-Control/image-9.png"></p>
<ul>
<li>The <code>sub-and</code> is a type 1a hazard:</li>
</ul>
<p><span class="math display">\[
MEM/WB.RegisterRd=ID/EX.RegisterRs2=x2
\]</span></p>
<ul>
<li><p>The <code>sub-or</code> is a type 2a hazard.</p></li>
<li><p>There&apos;s no data hazard between <code>sub</code> and
<code>sd</code> because <strong><code>sd</code> reads <code>x2</code>
the clock cycle after <code>sub</code> writes
<code>x2</code></strong>.</p></li>
</ul>
<blockquote>
<p>Pay attention to the clock cycle, not the name!!!</p>
</blockquote>
<p>&#x2003;&#x2003;One way to detact the hazards is simple <strong>check if the
<code>RegWrite</code> signal is active</strong>. This can be done by
<strong>examing the <code>WB</code> control field of the pipeline
register during the <code>EX</code> and <code>MEM</code>
stages</strong>.</p>
<blockquote>
<p>Recall that RISC-V requires that <code>x0</code> is taken as an
oprand value of 0, if an instruction in the pipeline has <code>x0</code>
as its destination, we want to <strong>avoid forwarding its possibly
nonzero value</strong>.</p>
</blockquote>
<h4 id="csolution">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>Solution</h4>
<p>&#x2003;&#x2003;If we can take the inputs to the ALU <strong>from any pipeline
register rather than just ID/EX</strong>, then we can forward the
correct data.</p>
<p>&#x2003;&#x2003;By <strong>adding multiplexors to the input of the ALU, and with
the proper controls</strong>, we can run the pipeline at full speed in
the presence of these data hazards:</p>
<p><img src="/2024/06/07/3-5-Pipelined-Datapath-and-Control/image-10.png"></p>
<p><img src="/2024/06/07/3-5-Pipelined-Datapath-and-Control/image-11.png"></p>
<blockquote>
<p>Before forwarding, the ID/EX register has no need to include space to
hold the rs1 and rs2 fields, so they are added to ID/EX.</p>
</blockquote>
<h4 id="ddetailed-detection-ampresolution">&#x2003;&#x2003;<span class="math inline">\(d.\)</span>Detailed detection &amp;
resolution</h4>
<ul>
<li><p>EX hazard:</p>
<ul>
<li>If there&apos;s a write operation and a load operation at the same time,
and the loaded object is under writting, then there&apos;s an EX hazard:</li>
</ul></li>
</ul>
<p><img src="/2024/06/07/3-5-Pipelined-Datapath-and-Control/image-12.png"></p>
<p>&#x2003;&#x2003;This case forwards the result from the previous instruction to
either input of the ALU instead of the pipeline register EX/MEM</p>
<ul>
<li><p>MEM hazard</p>
<ul>
<li>If the writting part is just loaded.</li>
</ul></li>
</ul>
<p><img src="/2024/06/07/3-5-Pipelined-Datapath-and-Control/image-13.png"> <img src="/2024/06/07/3-5-Pipelined-Datapath-and-Control/image-14.png"></p>
<blockquote>
<p>What happens when a register is read and written in the same clock
cycle? We assume that <strong>the write is in the first half of the
clock cycle and the read is in the second half</strong>, so the read
delivers what is written. As is the case for many implementations of
register files, we have no data hazard in this case.</p>
<p>As mentioned above, there is no hazard in the WB stage, because
<strong>we assume that the register file supplies the correct
result</strong> if the instruction in the ID stage reads the same
register written by the instruction in the WB stage.</p>
</blockquote>
<p>&#x2003;&#x2003;One complication occurs when we all read and write to a same
register:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">add x1 x1 x2</span><br><span class="line">add x1 x1 x3</span><br><span class="line">add x1 x1 x4</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;In this case, <strong>the result should be forwarded from the MEM
stage, because the MEM stage is the more recent result</strong>. Thus,
the control for the MEM should be:</p>
<p><img src="/2024/06/07/3-5-Pipelined-Datapath-and-Control/image-15.png"></p>
<blockquote>
<p>Why <code>not EX/MEM.RegisterRd = ID/EX.RegisterRs1</code>? Because
if this is true, then <strong>the instruction of EX/MEM should be
written back into the register</strong>(because it&apos;s the most current),
and it will cover the result of MEM/WB. So we take EX/MEM first.</p>
</blockquote>
<p><img src="/2024/06/07/3-5-Pipelined-Datapath-and-Control/image-16.png"></p>
<h4 id="estalls">&#x2003;&#x2003;<span class="math inline">\(e.\)</span>Stalls</h4>
<p>&#x2003;&#x2003;One case where forwarding cannot help is when <strong>an
instruction tries to read a register following a load instruction that
writes the same register</strong>:</p>
<p><img src="/2024/06/07/3-5-Pipelined-Datapath-and-Control/image-17.png"></p>
<blockquote>
<p>The RAM is used by <code>add</code> before it&apos;s updated, and it won&apos;t
be updated until the <code>lw</code> ends. Since it must be used in the
first step, forwarding cannot help.</p>
</blockquote>
<p>&#x2003;&#x2003;Hence, we also need a <em>hazard detection unit</em>. It operates
during the ID stage so that it can insert the stall between the load and
the instruction depentent on it:</p>
<ul>
<li>If it&apos;s in a load process, and the being-loaded object involves in
other process.</li>
</ul>
<p><img src="/2024/06/07/3-5-Pipelined-Datapath-and-Control/image-18.png"></p>
<p>&#x2003;&#x2003;If the instruction in the ID stage is stalled, then the instruction
in the IF stage must also be stalled, or we will lose the fetch of
instruction. Therefore, <strong>the instruction in the IF stage will
continue to be read using the same PC</strong>. The EX stage must also
be doing something, so we let it <strong>execute instructions that have
no effect: nops</strong>.</p>
<p>&#x2003;&#x2003;<strong>Deasserting all seven control signals(setting them to 0) in
the EX, MEM, WB stages</strong> will create a nop instruction:</p>
<p><img src="/2024/06/07/3-5-Pipelined-Datapath-and-Control/image-19.png"></p>
<ul>
<li><p>The forwarding unit controls the ALU multiplexor s to replace the
value from a general-purpose register with that in the pipeline
register.</p></li>
<li><p>The hazard detection unit controls the writing of the PC and
IF/ID registers plus the multiplexor that choose between the real
control values and all 0s.</p></li>
</ul>
<p><img src="/2024/06/07/3-5-Pipelined-Datapath-and-Control/image-20.png"></p>
<h3 id="4control-hazards">4.Control hazards</h3>
<h4 id="aassume-branch-not-taken">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>Assume branch not taken</h4>
<p>&#x2003;&#x2003;We can assume the branch is not taken. If the condition branch is
taken instead, <strong>the instructions that are being fetched and
decoded must be discarded</strong>.</p>
<p>&#x2003;&#x2003;To discard instructions, we merely change the original control
values to 0s. Notice that we must also change the three instructions in
the IF, ID and EX stages when the branch reaches the MEM stage, which is
called <em>flush</em>.</p>
<p>&#x2003;&#x2003;To flush instructions in the IF, we <strong>add a control line
called IF.Flush</strong>, it zeros the instruction field of the IF/ID
pipeline register.</p>
<h4 id="breducing-the-delay-of-branches">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Reducing the delay of branches</h4>
<p>&#x2003;&#x2003;One way to improve conditional branch performance is to reduce the
cost of taken branch. We have assumed that the next PC for a branch is
selected in the MEM stage, but <strong>if we move the conditional branch
execution earlier in the pipeline, then fewer instructions need be
flushed</strong>.</p>
<p>&#x2003;&#x2003;Moving the branch decision up requires two actions to occur
earlier: computing the branch target address and evaluating the branch
decision.</p>
<p>&#x2003;&#x2003;Moving up the address calculation is easy, we can <strong>move the
branch adder from EX stage to ID stage</strong>.</p>
<p>&#x2003;&#x2003;The harder part is branch decision itself. We must deal with two
complicate factors:</p>
<ol type="1">
<li><p>The introduction of equlity test unit.</p></li>
<li><p>Because <strong>the value in a branch comparison is needed during
ID but may be produced later in time</strong>, it is possible that a
data hazard can occur and a stall will be needed.</p></li>
</ol>
<h3 id="5dynamic-branch-prediction">5.Dynamic branch prediction</h3>
<ul>
<li>This method looks up the address of the instruction to see
<strong>if the conditional branch was taken the last time this
instruction was executed</strong>, and, if so, to <strong>begin fetching
new instructions from the same place as the last time</strong>.</li>
</ul>
<p>&#x2003;&#x2003;One implementation of this approach is a <em>branch prediction
buffer</em> or <em>branch history table</em>. A branch prediction buffer
is a small memory indexed by the lower portion of the address of the
branch instruction. The memory contains <strong>a bit that says whether
the branch was recently taken or not</strong>.</p>
<ul>
<li>Fetching begins in the predicted direction. If the predition turns
out to be wrong, the incorrectly predicted instructions are deleted, the
predition bit is inverted and stored back, and the proper sequence is
fetched and executed.</li>
</ul>
<blockquote>
<p>&#x2003;&#x2003;To improve the accuracy, the <em>2-bit prediction schemes</em> are
often used. In a 2-bit scheme, <strong>a prediction must be wrong twive
before it is changed</strong>:</p>
<p><img src="/2024/06/07/3-5-Pipelined-Datapath-and-Control/image-21.png"></p>
</blockquote>
<hr>
<p><img src="/2024/06/07/3-5-Pipelined-Datapath-and-Control/image-22.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/06/05/3-4-Building-a-Datapath/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/06/05/3-4-Building-a-Datapath/" class="post-title-link" itemprop="url">3.4.Building a Datapath</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-06-05 10:26:12" itemprop="dateCreated datePublished" datetime="2024-06-05T10:26:12+08:00">2024-06-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-06 17:52:05" itemprop="dateModified" datetime="2024-06-06T17:52:05+08:00">2024-06-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/" itemprop="url" rel="index"><span itemprop="name">CS61C Great Ideas in Computer Architecture</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/Module-3-Program-Process/" itemprop="url" rel="index"><span itemprop="name">Module 3.Program Process</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>527</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="34building-a-datapath"><span class="math inline">\(3.4.\)</span>Building a Datapath</h1>
<h3 id="1basic-devices">1.Basic devices</h3>
<ul>
<li><p><em>Registers</em>: It contains:</p>
<ul>
<li><p>Two data words from the register file, and <strong>write one data
word into the register file</strong> for each instruction.</p></li>
<li><p>An input. It <strong>specifies the register number to be
read</strong>.</p></li>
<li><p>An output. It <strong>carries the value that has been read from
the register</strong>.</p></li>
<li><p>To write a data word, we need two more inputs: one to
<strong>specify the register number to be written</strong> and one to
<strong>supply the data to be written into the
register</strong>.</p></li>
</ul></li>
</ul>
<p><img src="/2024/06/05/3-4-Building-a-Datapath/image.png"></p>
<ul>
<li><em>ALU</em></li>
</ul>
<p><img src="/2024/06/05/3-4-Building-a-Datapath/image-1.png"></p>
<ul>
<li><em>Immediate generation unit</em>: In operations like
<code>addi x1 x2 10</code>, the immediate number <code>10</code> is
written in 12-bit offset in the instruction. So we need to
<strong>sign-extend the number to a 64-bit signed value</strong>. The
Imm-Gen does the job:</li>
</ul>
<p><img src="/2024/06/05/3-4-Building-a-Datapath/image-4.png"></p>
<h3 id="2basic-phases-ofinstruction-execution">2.Basic phases of
instruction execution</h3>
<p>&#x2003;&#x2003;The phases of instruction execution can be divided into 5
parts:</p>
<p><img src="/2024/06/05/3-4-Building-a-Datapath/image-2.png"></p>
<hr>
<p><img src="/2024/06/05/3-4-Building-a-Datapath/image-3.png"></p>
<h3 id="3implementation-ofdifferent-statement">3.Implementation of
different statement</h3>
<h4 id="aaddinstruction">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>Add
instruction</h4>
<p>&#x2003;&#x2003;The <code>add</code> is simple, we just get value from
<code>DataA</code> and <code>DataB</code>, and calculate the result by
ALU.</p>
<p><img src="/2024/06/05/3-4-Building-a-Datapath/image-7.png"></p>
<p>&#x2003;&#x2003;To perform <code>addi</code>, we get one of out input from Imm-Gen
rather than <code>DataB</code>. The source of Imm-Gen is from
<code>IMEM</code>, from which we can get the instruction, and
<code>inst[31:20]</code> is the immediate we want:</p>
<p><img src="/2024/06/05/3-4-Building-a-Datapath/image-8.png"></p>
<h4 id="bload-ampsave-instruction">&#x2003;&#x2003;<span class="math inline">\(b.\)</span><code>load</code> &amp;
<code>save</code> instruction</h4>
<p>&#x2003;&#x2003;To implement the instructions, we can add a <code>DMEM</code> to
read or write data.</p>
<ul>
<li><code>DMEM</code>: It&apos;s input is <code>Addr</code> and outputs
<code>DataR</code>. When in &quot;read&quot; mode, it gets information from the
address. Else, it writes the information into the address:</li>
</ul>
<p><img src="/2024/06/05/3-4-Building-a-Datapath/image-10.png"></p>
<p><img src="/2024/06/05/3-4-Building-a-Datapath/image-11.png"></p>
<h4 id="cbranch-instruction">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>Branch instruction</h4>
<p>&#x2003;&#x2003;The basic form of branch instruction is
<code>beq x1 x2 offset</code>. To implement this instruction, we must
compute the branch target address by <strong>adding the sign- extended
offset field of the instruction to the PC</strong>. There are two
details in the definition of branch instructions to which we must pay
attention:</p>
<ul>
<li><p>The instruction set architecture specifies that <strong>the base
for the branch address calculation is the address of the branch
instruction</strong>.</p></li>
<li><p>The architecture also states that <strong>the offset field is
shifted left 1 bit so that it is a half word offset</strong>; this shift
<strong>increases the effective range of the offset field by a factor of
2</strong>.</p></li>
</ul>
<p>&#x2003;&#x2003;If the branch condtion is true, the branch target address becomes
the new PC, and we say the branch is <strong>taken</strong>. Else, we
say the branch is <strong>not taken</strong>.</p>
<p>&#x2003;&#x2003;We first get the address of <code>PC+4</code> and branch through
this struction:</p>
<p><img src="/2024/06/05/3-4-Building-a-Datapath/image-5.png"></p>
<p>&#x2003;&#x2003;To select from multiple address, we use a multiplexor and control
signal</p>
<p><img src="/2024/06/05/3-4-Building-a-Datapath/image-6.png"></p>
<p>&#x2003;&#x2003;Combined with the previous struction, we get this design:</p>
<p><img src="/2024/06/05/3-4-Building-a-Datapath/image-9.png"></p>
<h4 id="djal-ampjalr-instructions">&#x2003;&#x2003;<span class="math inline">\(d.\)</span><code>jal</code> &amp;
<code>jalr</code> instructions</h4>
<p>&#x2003;&#x2003;<code>jalr</code> does the following things:</p>
<ol type="1">
<li><p>Set <code>PC=Reg[rs1]+immediate</code></p>
<ul>
<li>Uses same immediate as arithmetic and loads. <strong>No multiple by
2 bytes!</strong></li>
</ul></li>
<li><p>Set <code>PC=PC+offset</code></p>
<ul>
<li>Since the offset is calculated by ALU, we <strong>connect the output
of ALU with input of PC</strong>.</li>
</ul></li>
</ol>
<p><img src="/2024/06/05/3-4-Building-a-Datapath/image-12.png"></p>
<p>&#x2003;&#x2003;<code>jal</code> does the following things:</p>
<ol type="1">
<li>Save <code>PC+4</code> in <code>Reg[rd]</code>(namely
<code>DataD</code>)</li>
<li>Set <code>PC=PC+offset</code></li>
</ol>
<p><img src="/2024/06/05/3-4-Building-a-Datapath/image-13.png"></p>
<h3 id="4datapath-control">4.Datapath control</h3>
<p><img src="/2024/06/05/3-4-Building-a-Datapath/image-14.png"></p>
<p><img src="/2024/06/05/3-4-Building-a-Datapath/image-15.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/06/05/3-3-Synchronous-Digital-Systems/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/06/05/3-3-Synchronous-Digital-Systems/" class="post-title-link" itemprop="url">3.3.Synchronous Digital Systems</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-06-05 08:29:11" itemprop="dateCreated datePublished" datetime="2024-06-05T08:29:11+08:00">2024-06-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-06 17:48:39" itemprop="dateModified" datetime="2024-06-06T17:48:39+08:00">2024-06-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/" itemprop="url" rel="index"><span itemprop="name">CS61C Great Ideas in Computer Architecture</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/Module-3-Program-Process/" itemprop="url" rel="index"><span itemprop="name">Module 3.Program Process</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>419</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="33synchronous-digital-systems"><span class="math inline">\(3.3.\)</span>Synchronous Digital Systems</h1>
<h3 id="1clock-concepts">1.Clock concepts</h3>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image.png"></p>
<h3 id="2d-flip-flops">2.D Flip-flops</h3>
<h4 id="a-dffconcept">&#x2003;&#x2003;<span class="math inline">\(a.\)</span> DFF
concept</h4>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image-1.png"></p>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image-2.png"></p>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image-3.png"></p>
<blockquote>
<p>The <span class="math inline">\(Q\)</span> is the output of DFF, the
<span class="math inline">\(D\)</span> is the data input.</p>
</blockquote>
<blockquote>
<p>DFF only responds to the input signal on the rising edge of the clock
signal, it captures and latches the value of data input. <strong>It will
hold the value until the next rising edge of the clock
signal</strong>.</p>
</blockquote>
<ul>
<li><p><em>Clock-to-Q delay</em> is <strong>the amount of time that it
take for the input to propagate to the output after the clock
trigger</strong>.</p></li>
<li><p><em>Setup time</em> is the amount of time that the input needs to
be stable BEFORE the clock trigger</p></li>
</ul>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image-4.png"></p>
<ul>
<li><em>Hold time</em> is the amount of time that the input needs to be
stable AFTER the clock trigger</li>
</ul>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image-6.png"></p>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image-5.png"></p>
<h3 id="3register">3.Register</h3>
<h4 id="asomeconcept">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>Some
concept</h4>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image-7.png"></p>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image-8.png"></p>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image-9.png"></p>
<hr>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image-10.png"></p>
<hr>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image-11.png"></p>
<blockquote>
<p>Why this? Because the max hold time is to <strong>ensure that data
input D remains stable for a period of time after the rising edge of the
clock arrives</strong>. And the period of time equals to the delay of
<span class="math inline">\(A\)</span> plus the combinational delay.</p>
</blockquote>
<hr>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image-12.png"></p>
<blockquote>
<p>Why this? Because the min clock cycle is to <strong>ensure that the
signal is properly transmitted during the clock cycle and captured by
the next register</strong>. So we must take the longest time into
consideration.</p>
</blockquote>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image-13.png"></p>
<h3 id="4transitor">4.Transitor</h3>
<h4 id="ametal-oxide-semiconductor-field-effecttransistormosfet">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>Metal-Oxide Semiconductor Field Effect
Transistor(MOSFET)</h4>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image-14.png"></p>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image-15.png"></p>
<p>&#x2003;&#x2003;To know how the result comes from, we can <strong>view the value of
<span class="math inline">\(S\)</span>, <span class="math inline">\(G\)</span> and <span class="math inline">\(D\)</span> as the voltage</strong>. Take this as
an example:</p>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image-16.png"></p>
<ul>
<li><p>First we need to know <strong>whether the switch is
closed</strong>. <strong>If the switch is closed, then the state of
<span class="math inline">\(D\)</span> is decided by the outside
circuits</strong>.</p></li>
<li><p>When the switch is on, we then judge <strong>if the voltage of
<span class="math inline">\(S\)</span> is higher than that of <span class="math inline">\(G\)</span></strong>. If it&apos;s true, then the FET is
conducting, and vice versa.</p></li>
</ul>
<p>&#x2003;&#x2003;In this example, the voltage of <span class="math inline">\(S\)</span> is lower than <span class="math inline">\(G\)</span>, so the <span class="math inline">\(D\)</span> can&apos;t get the electronic, thus it&apos;s
0.</p>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image-17.png"></p>
<h4 id="bvddand-ground">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Vdd
and Ground</h4>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image-18.png"></p>
<h4 id="cbuilding-an-inverter">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>Building an Inverter</h4>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image-19.png"></p>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image-20.png"></p>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image-21.png"></p>
<hr>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image-22.png"></p>
<h4 id="dbuilding-other-gates">&#x2003;&#x2003;<span class="math inline">\(d.\)</span>Building other gates</h4>
<p>&#x2003;&#x2003;To build a CMOS, we:</p>
<ol type="1">
<li><p>Implement the pull-up network and pull-down network separately to
fit the truth table.</p>
<ul>
<li>It&apos;s OK to get the opposite of truth table. <strong>We can simply
convert it through an invertor</strong>.</li>
</ul></li>
<li><p>Connect the pull-up with Vdd, and the pull-down with
Ground.</p></li>
</ol>
<p>&#x2003;&#x2003;We take the <code>NAND</code> gate for example:</p>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image-23.png"></p>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image-24.png"></p>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image-25.png"></p>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image-26.png"></p>
<hr>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image-27.png"></p>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image-28.png"></p>
<hr>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image-29.png"></p>
<h4 id="ethe-use-of-demorgans-law">&#x2003;&#x2003;<span class="math inline">\(e.\)</span>The use of DeMorgan&apos;s Law</h4>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image-30.png"></p>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image-31.png"></p>
<p><img src="/2024/06/05/3-3-Synchronous-Digital-Systems/image-32.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/06/04/3-2-Introduction-to-Digital-System/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/06/04/3-2-Introduction-to-Digital-System/" class="post-title-link" itemprop="url">3.2.Introduction to Digital System</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-06-04 23:03:11" itemprop="dateCreated datePublished" datetime="2024-06-04T23:03:11+08:00">2024-06-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-05 08:19:08" itemprop="dateModified" datetime="2024-06-05T08:19:08+08:00">2024-06-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/" itemprop="url" rel="index"><span itemprop="name">CS61C Great Ideas in Computer Architecture</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/Module-3-Program-Process/" itemprop="url" rel="index"><span itemprop="name">Module 3.Program Process</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>208</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="32introduction-to-digital-system"><span class="math inline">\(3.2.\)</span>Introduction to Digital System</h1>
<h3 id="1logic-gate-representation">1.Logic gate representation</h3>
<p><img src="/2024/06/04/3-2-Introduction-to-Digital-System/image.png"></p>
<p><img src="/2024/06/04/3-2-Introduction-to-Digital-System/image-1.png"></p>
<p><img src="/2024/06/04/3-2-Introduction-to-Digital-System/image-2.png"></p>
<p><img src="/2024/06/04/3-2-Introduction-to-Digital-System/image-3.png"></p>
<p><img src="/2024/06/04/3-2-Introduction-to-Digital-System/image-4.png"></p>
<p><img src="/2024/06/04/3-2-Introduction-to-Digital-System/image-5.png"></p>
<p><img src="/2024/06/04/3-2-Introduction-to-Digital-System/image-6.png"></p>
<p><img src="/2024/06/04/3-2-Introduction-to-Digital-System/image-7.png"></p>
<h3 id="2using-booleanalgebra-to-simplify-circuits">2.Using boolean
algebra to simplify circuits</h3>
<p><img src="/2024/06/04/3-2-Introduction-to-Digital-System/image-8.png"></p>
<p><img src="/2024/06/04/3-2-Introduction-to-Digital-System/image-9.png"></p>
<h3 id="3build-an-adder">3.Build an Adder</h3>
<h4 id="ahalfadder">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>Half
adder</h4>
<p>&#x2003;&#x2003;A half adder&apos;s output consists of:</p>
<ul>
<li>The <em>sum</em>. It can be computed by <code>xor</code>
method.</li>
<li>The <em>carry</em>. It can be computed by <code>and</code>
method.</li>
</ul>
<p><img src="/2024/06/04/3-2-Introduction-to-Digital-System/image-10.png"></p>
<h4 id="bfulladder">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Full
adder</h4>
<p>&#x2003;&#x2003;To implement full adder, we just need to add <code>A</code>,
<code>B</code> and the carry at the position <span class="math inline">\(C_i\)</span>.</p>
<p>&#x2003;&#x2003;The output of a full adder is the same as the half adder. Then how
can we calculate each of them?</p>
<ul>
<li><p>For <span class="math inline">\(C_0\)</span>, it&apos;s decided by the
sum of <code>A</code> and <code>B</code> &amp; the current carry in the
position. There are two cases that make the carry 1:</p>
<ol type="1">
<li><code>A + B</code> is 1, and current carry is 1.</li>
<li><code>A + B</code> is 2, and current carry can be 0 or 1.</li>
</ol></li>
</ul>
<p>&#x2003;&#x2003;So we can compute <span class="math inline">\(C_0\)</span> by this
expression:</p>
<p><span class="math display">\[
C_0 = C_i(A+B) + AB
\]</span></p>
<ul>
<li>The sum is easy, it becomes 1 when 1 or 3 of <code>A</code>,
<code>B</code> and current carry is 1:</li>
</ul>
<p><span class="math display">\[
S = A \; xor B \; xor C_i
\]</span></p>
<p><img src="/2024/06/04/3-2-Introduction-to-Digital-System/image-11.png"></p>
<h4 id="c4-bit-adder">&#x2003;&#x2003;{{c.}}4-bit Adder</h4>
<p>&#x2003;&#x2003;To make a multi-bit Adder, we simply <strong>connect full adder
together</strong>:</p>
<p><img src="/2024/06/04/3-2-Introduction-to-Digital-System/image-12.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/06/03/3-1-Translating-Starting-a-Program/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/06/03/3-1-Translating-Starting-a-Program/" class="post-title-link" itemprop="url">3.1.Translating &amp; Starting a Program</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 22:15:12" itemprop="dateCreated datePublished" datetime="2024-06-03T22:15:12+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-04 08:19:21" itemprop="dateModified" datetime="2024-06-04T08:19:21+08:00">2024-06-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/" itemprop="url" rel="index"><span itemprop="name">CS61C Great Ideas in Computer Architecture</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/Module-3-Program-Process/" itemprop="url" rel="index"><span itemprop="name">Module 3.Program Process</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>1k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>4 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="31translating-amp-starting-aprogram"><span class="math inline">\(3.1.\)</span>Translating &amp; Starting a
Program</h1>
<h3 id="1a-complex-example">1.A complex example</h3>
<p><img src="/2024/06/03/3-1-Translating-Starting-a-Program/image.png"></p>
<p>&#x2003;&#x2003;When we are going to translate the program, we should follow the
following process:</p>
<ol type="1">
<li><p>Need to decide on what variables go in what registers</p></li>
<li><p>Need to determine which registers we need to save on function
entry (the function preamble/prolog)</p>
<ol type="1">
<li>Decrement the stack</li>
<li>Save all the callee saved registers we will use</li>
<li>Save ra or any other caller saved registers we need to live across
calls to other functions</li>
</ol></li>
<li><p>Translate the code itself</p></li>
<li><p>Restore all the registers necessary (the function
postamble/epilog)</p>
<ol type="1">
<li>Restore the callee saved registers we used</li>
<li>Restore <code>ra</code></li>
<li>Increment the stack</li>
</ol></li>
<li><p>Return using <code>jr</code></p></li>
</ol>
<p>&#x2003;&#x2003;There are some points in the process:</p>
<ul>
<li>Return <code>null</code>:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">li a0 0</span><br><span class="line">j postamble</span><br></pre></td></tr></table></figure>
<ul>
<li>When calling function, we can <strong>use the <code>call</code>
pseudo-instruction for <code>jal ra (location)</code></strong>. For
example, <code>call malloc</code>.</li>
</ul>
<h3 id="2interpretation">2.Interpretation</h3>
<ul>
<li><p>Interpreter <strong>directly executes a program in the source
language</strong>.</p></li>
<li><p>Since interpreter <strong>is closer to high-level</strong>, it
can give better error messages during interpreting.</p></li>
<li><p>Because the interpreter executes intermediate representations
rather than direct machine code, <strong>the same source code can be run
from one machine to another without modification of the source
code</strong>.</p></li>
</ul>
<h3 id="3calling-chain">3.Calling chain</h3>
<p><img src="/2024/06/03/3-1-Translating-Starting-a-Program/image-1.png"></p>
<p><img src="/2024/06/03/3-1-Translating-Starting-a-Program/image-2.png"></p>
<h3 id="4compilation">4.Compilation</h3>
<h4 id="aconcepts">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>Concepts</h4>
<p>&#x2003;&#x2003;The compiler transforms the C program into <strong>an assembly
language program</strong>, a symbolic form of what the machine
understands. High-level language programs take many fewer lines of code
than assembly language, so programmer productivity is much higher.</p>
<p><img src="/2024/06/03/3-1-Translating-Starting-a-Program/image-3.png"></p>
<h4 id="bassembler">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Assembler</h4>
<ul>
<li><p>The assembler <strong>converts the assembly language instruction
into machine language</strong>. It turns the assembly language program
into an <strong>object file, which is a combination of machine language
instructions, data, and information needed to place instructions
properly in memory.</strong></p></li>
<li><p>Assembler will also <strong>accept numbers in a variety of
bases</strong>.</p></li>
</ul>
<p>&#x2003;&#x2003;To produce the binary version of each instruction in the assembly
language program, the assembler must determine the address corresponding
to all labels. This is done by a <strong>symbol table</strong>.</p>
<ul>
<li><p>The object file for UNIX mainly consists of:</p>
<ul>
<li><p>The object file header describes <strong>the size and position of
the other pieces of the object file</strong>.</p></li>
<li><p>The text segment contains <strong>the machine language
code</strong>.</p></li>
<li><p>The static data segment contains <strong>data allocated for the
life of the program</strong>.</p></li>
<li><p>The relocation information identifies instructions and data words
that <strong>depend on absolute addresses when the program is loaded
into memory</strong>.</p></li>
<li><p>The symbol table contains <strong>the remaining labels that are
not defined</strong>, such as external references.</p>
<ul>
<li>Use <strong>dummy &quot;placeholders&quot;</strong> for unresolved absolute
and external references.</li>
</ul></li>
<li><p>The debugging information contains <strong>a concise description
of how the modules were compiled</strong>.</p></li>
</ul></li>
</ul>
<hr>
<p><img src="/2024/06/03/3-1-Translating-Starting-a-Program/image-4.png"></p>
<blockquote>
<p><span class="math inline">\(p.s.\)</span> The <code>auipc</code>
instruction <strong>adds an immediate number to the current PC
value</strong>. This means that the generated address <strong>is
relative to the current instruction</strong>. It add an offset to the PC
(upper 20 bits to the left of the instant number by 12 bits), and use
<code>addi</code> to load the lower 12 bits.</p>
<p><code>lui</code> instructions are used to generate absolute
addresses, which are fixed addresses of data in memory. This approach
works for memory addresses that do not move. It loads an instant number
to the upper 20 bits of the register.</p>
</blockquote>
<h4 id="clinker">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>Linker</h4>
<p>&#x2003;&#x2003;Linker is used for <strong>compiling and assembling each procedure
independently</strong>, so that a change to one line would require
resolving only one procedure. It&apos;s a system that <strong>combines
independently assembled machine language programs</strong> and
<strong>resolves all undefined labels into an executable
file</strong>.</p>
<p>&#x2003;&#x2003;There are three steps for the linker:</p>
<ol type="1">
<li>Place code and data modules symbolically in memory.</li>
<li>Determine the addresses of data and instruction labels.</li>
<li>Patch both the internal and external references.</li>
</ol>
<p>&#x2003;&#x2003;The linker uses the relocation information and symbol table in each
object module to <strong>resolve all undefined labels</strong>.</p>
<ul>
<li>For each entry in the relocation table, it replaces it with
<strong>the actual address for the symbol table of the item</strong> we
are linking to.</li>
</ul>
<p>&#x2003;&#x2003;If all external references are resolved, the linker next
<strong>determines the memory locations each module will
occupy</strong>. Since the files were assembled in isolation,
<strong>the assembler couldn&apos;t know where a module&apos;s instructions and
data would be placed relative to other modules</strong>. So when the
linker places a module in memory, all <strong>absolute references, that
is, memory addresses that are not relative to a register</strong>, must
<strong>be relocated to reflect its true location</strong>.</p>
<p><img src="/2024/06/03/3-1-Translating-Starting-a-Program/image-7.png"></p>
<h4 id="dtype-of-addressing">&#x2003;&#x2003;<span class="math inline">\(d.\)</span>Type of addressing</h4>
<p><img src="/2024/06/03/3-1-Translating-Starting-a-Program/image-5.png"></p>
<p><img src="/2024/06/03/3-1-Translating-Starting-a-Program/image-6.png"></p>
<h4 id="eloader">&#x2003;&#x2003;<span class="math inline">\(e.\)</span>Loader</h4>
<p><img src="/2024/06/03/3-1-Translating-Starting-a-Program/image-8.png"></p>
<h3 id="5dynamically-linkedlibraries">5.Dynamically linked
libraries</h3>
<p>&#x2003;&#x2003;In tradition, before the program is run, the library has been
linked. Although this static approach is the fastest way to call library
routines,it has a few disadvantages:</p>
<ol type="1">
<li><p>The library routines become <strong>part of the executable
code</strong>. If a new version of the library is released, <strong>the
statically linked program keeps using the old version</strong>.</p></li>
<li><p>It loads <strong>all routines in the library that are called
anywhere in the executable</strong>, even if those calls are not
executed.</p></li>
</ol>
<p>&#x2003;&#x2003;A replacement of it is called <em>dynamically linked
libraries</em>, where the library routines are not linked and loaded
<strong>until the program is run</strong>.</p>
<ol type="1">
<li><p>The first time the library routine is called, the program
<strong>calls the dummy entry and follows the indirect branch</strong>,
which points to a piece of code.</p></li>
<li><p>The code <strong>puts a number in a register</strong> to
<strong>identify the desired library routine</strong>.</p></li>
<li><p>Then it branches to the dynamic linker/loader.</p></li>
<li><p>The linker/loader finds the wanted routine, <strong>remaps it
into the memory</strong>, and <strong>changes the address in the
indirect branch location to point to that routine</strong>. Then it
branches to it.</p></li>
</ol>
<blockquote>
<p>The dynamic linker loads the library function into memory on the
first call and updates the indirect branch address. In this way, if the
following call to the library function, the program can directly jump to
the correct memory address, avoid repeated symbol parsing and address
calculation, which improves the efficiency of the program.</p>
</blockquote>
<ol start="5" type="1">
<li>When the routine completes, it <strong>returns to the original
calling site</strong>.</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/1.1-1.5%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%A6%82%E5%BF%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/1.1-1.5%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%A6%82%E5%BF%B5/" class="post-title-link" itemprop="url">1.1~1.5&#x7684;&#x4E00;&#x4E9B;&#x6982;&#x5FF5;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 13:23:57" itemprop="dateModified" datetime="2024-06-02T13:23:57+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SICP-in-python/" itemprop="url" rel="index"><span itemprop="name">SICP in python</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SICP-in-python/Chapter-1-Building-Abstractions-with-Functions/" itemprop="url" rel="index"><span itemprop="name">Chapter 1.Building Abstractions with Functions</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>382</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="someconceptsinfrom11to15"><span class="math inline">\(some\;concepts\;in\;from\;1.1\;to\;1.5\)</span></h1>
<h3 id="1environment">1.<span class="math inline">\(Environment\)</span></h3>
<blockquote>
<p>&#x2003;&#x2003;An environment in which an expression is evaluated consists of a
sequence of frames, depicted as boxes. Each frame contains bindings,
each of which associates a name with its corresponding value. Assignment
and import statements add entries to the first frame of the current
environment.</p>
</blockquote>
<h3 id="2function-as-abstractions">2.<span class="math inline">\(Function\)</span> <span class="math inline">\(as\)</span> <span class="math inline">\(abstractions\)</span></h3>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x4EE5;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x7A0B;&#x5E8F;&#x4E3A;&#x4F8B;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> add, mul</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">square</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> mul(x, x)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sum_squares</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="keyword">return</span> add(square(x), square(y))</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;<strong>&#x5199;&#x51FA;&#x6C42;&#x548C;&#x5E73;&#x65B9;&#xFF0C;&#x800C;&#x4E0D;&#x5FC5;&#x8003;&#x8651;&#x5982;&#x4F55;&#x6C42;&#x4E00;&#x4E2A;&#x6570;&#x7684;&#x5E73;&#x65B9;</strong>&#x3002;&#x5982;&#x4F55;&#x8BA1;&#x7B97;&#x5E73;&#x65B9;&#x7684;&#x7EC6;&#x8282;&#x53EF;&#x4EE5;&#x53BB;&#x6389;&#xFF0C;&#x4EE5;&#x540E;&#x518D;&#x8003;&#x8651;&#x3002;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;&#x5C31;<span class="math inline">\(sum\_square\)</span>&#x800C;&#x8A00;&#xFF0C;<span class="math inline">\(square\)</span>&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x7279;&#x5B9A;&#x7684;&#x51FD;&#x6570;&#x4F53;&#xFF0C;&#x800C;&#x662F;<strong>&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x62BD;&#x8C61;&#xFF0C;&#x5373;&#x51FD;&#x6570;&#x62BD;&#x8C61;</strong>&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C06;<span class="math inline">\(square\)</span>&#x770B;&#x4F5C;&#x4E00;&#x4E2A;&#x201C;&#x9ED1;&#x5323;&#x5B50;&#x201D;&#xFF0C;&#x6211;&#x4EEC;&#x653E;&#x5165;&#x4E00;&#x4E2A;&#x503C;&#xFF0C;&#x7136;&#x540E;&#x51FD;&#x6570;&#x8F93;&#x51FA;&#x4E00;&#x4E2A;&#x503C;&#xFF0C;&#x800C;<strong>&#x4E2D;&#x95F4;&#x7684;&#x5B9E;&#x73B0;&#x7EC6;&#x8282;&#x6211;&#x4EEC;&#x5E76;&#x4E0D;&#x5173;&#x5FC3;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x4E3A;&#x4E86;&#x638C;&#x63E1;&#x51FD;&#x6570;&#x62BD;&#x8C61;&#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x8003;&#x8651;&#x5B83;&#x7684;&#x4E09;&#x4E2A;&#x6838;&#x5FC3;&#x5C5E;&#x6027;&#x901A;&#x5E38;&#x662F;&#x6709;&#x7528;&#x7684;&#xFF1A;</p>
<ul>
<li><strong>&#x51FD;&#x6570;&#x7684;&#x57DF;(domain)</strong> &#x662F;&#x5B83;&#x53EF;&#x4EE5;&#x63A5;&#x53D7;&#x7684;&#x4E00;&#x7EC4;&#x53C2;&#x6570;&#x3002;</li>
<li><strong>&#x51FD;&#x6570;&#x7684;&#x8303;&#x56F4;(range)</strong> &#x662F;&#x5B83;&#x53EF;&#x4EE5;&#x8FD4;&#x56DE;&#x7684;&#x503C;&#x7684;&#x96C6;&#x5408;&#x3002;</li>
<li><strong>&#x51FD;&#x6570;&#x7684;&#x76EE;&#x7684;(intent)</strong>
&#x662F;&#x5B83;&#x8BA1;&#x7B97;&#x8F93;&#x5165;&#x548C;&#x8F93;&#x51FA;&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;(&#x4EE5;&#x53CA;&#x5B83;&#x53EF;&#x80FD;&#x4EA7;&#x751F;&#x7684;&#x4EFB;&#x4F55;&#x526F;&#x4F5C;&#x7528;)&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x4F5C;&#x662F;&#x8F93;&#x5165;&#x5230;&#x8F93;&#x51FA;&#x7684;&#x62BD;&#x8C61;&#x6620;&#x5C04;&#x3002;</li>
</ul>
<p>&#x2003;&#x2003;&#x4F8B;&#x5982;&#x5BF9;&#x4E8E;<span class="math inline">\(sum\_square\)</span>&#xFF0C;&#x5176;&#xFF1A;</p>
<ul>
<li><span class="math inline">\(domain\)</span>&#xFF1A;&#x4E24;&#x4E2A;&#x6570;&#x3002;</li>
<li><span class="math inline">\(range\)</span>&#xFF1A;&#x975E;&#x8D1F;&#x5B9E;&#x6570;&#x3002;</li>
<li><span class="math inline">\(intent\)</span>&#xFF1A;&#x8FD4;&#x56DE;&#x4E24;&#x4E2A;&#x6570;&#x7684;&#x5E73;&#x65B9;&#x548C;&#x3002;</li>
</ul>
<p>&#x2003;&#x2003;&#x8FD9;&#x4E9B;&#x5C5E;&#x6027;&#x6CA1;&#x6709;&#x6307;&#x5B9A;&#x5982;&#x4F55;&#x6267;&#x884C;&#x610F;&#x56FE;&#xFF1B;<strong>&#x8FD9;&#x4E9B;&#x7EC6;&#x8282;&#x88AB;&#x62BD;&#x8C61;&#x6389;&#x4E86;</strong>&#x3002;</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/1.6.%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/1.6.%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0/" class="post-title-link" itemprop="url">1.6.&#x9AD8;&#x9636;&#x51FD;&#x6570;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 13:01:17" itemprop="dateModified" datetime="2024-06-02T13:01:17+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SICP-in-python/" itemprop="url" rel="index"><span itemprop="name">SICP in python</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SICP-in-python/Chapter-1-Building-Abstractions-with-Functions/" itemprop="url" rel="index"><span itemprop="name">Chapter 1.Building Abstractions with Functions</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>3.4k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>12 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="16&#x9AD8;&#x9636;&#x51FD;&#x6570;"><span class="math inline">\(1.6\)</span>&#x9AD8;&#x9636;&#x51FD;&#x6570;</h1>
<h3 id="1&#x5F15;&#x5165;">1.&#x5F15;&#x5165;</h3>
<p>&#x2003;&#x2003;&#x7531;&#x524D;&#x9762;&#x7684;&#x8BB2;&#x89E3;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#xFF0C;<strong>&#x51FD;&#x6570;&#x662F;&#x4E00;&#x79CD;&#x62BD;&#x8C61;&#x65B9;&#x6CD5;&#xFF0C;&#x5B83;&#x63CF;&#x8FF0;&#x72EC;&#x7ACB;&#x4E8E;&#x5176;&#x53C2;&#x6570;&#x7684;&#x7279;&#x5B9A;&#x503C;&#x7684;&#x590D;&#x5408;&#x64CD;&#x4F5C;&#x3002;</strong>
&#x4F8B;&#x5982;&#x5BF9;&#x51FD;&#x6570;<span class="math inline">\(square\)</span>&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">square</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> x*x</span><br></pre></td></tr></table></figure>
&#x2003;&#x2003;&#x6211;&#x4EEC;&#x8BA8;&#x8BBA;&#x7684;&#x5E76;&#x4E0D;&#x662F;&#x67D0;&#x4E2A;&#x7279;&#x5B9A;&#x7684;&#x6570;&#x7684;&#x5E73;&#x65B9;&#xFF0C;&#x800C;&#x662F;&#x5BF9;&#x4EFB;&#x4F55;&#x6570;&#x7684;&#x5E73;&#x65B9;&#x7684;&#x666E;&#x904D;&#x89C4;&#x5F8B;&#x3002;&#x540C;&#x65F6;&#xFF0C;&#x51FD;&#x6570;&#x4E2D;&#x7684;<code>*</code>&#x4E5F;&#x662F;&#x4E00;&#x79CD;&#x62BD;&#x8C61;&#x6620;&#x5C04;&#xFF0C;&#x4EE3;&#x8868;&#x4E58;&#x6CD5;&#x3002;&#x5F53;&#x62BD;&#x8C61;&#x6620;&#x5C04;&#x8F83;&#x7B80;&#x5355;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x7528;&#x7B26;&#x53F7;&#x6765;&#x8868;&#x793A;&#xFF1B;&#x4F46;&#x5F53;&#x62BD;&#x8C61;&#x6620;&#x5C04;&#x975E;&#x5E38;&#x590D;&#x6742;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x4F1A;<strong>&#x7528;&#x4E00;&#x4E2A;&#x7279;&#x5B9A;&#x51FD;&#x6570;&#x6765;&#x5B9E;&#x73B0;&#x8FD9;&#x4E2A;&#x62BD;&#x8C61;&#x6620;&#x5C04;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x7136;&#x800C;&#xFF0C;&#x5728;&#x5C06;&#x76F8;&#x5E94;&#x7684;&#x62BD;&#x8C61;&#x6620;&#x5C04;&#x8F6C;&#x5316;&#x4E3A;&#x7279;&#x5B9A;&#x51FD;&#x6570;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x8981;<strong>&#x5C06;&#x8FD9;&#x4E2A;&#x7279;&#x5B9A;&#x51FD;&#x6570;&#x653E;&#x5165;&#x539F;&#x6709;&#x51FD;&#x6570;&#x4E2D;&#xFF0C;&#x6784;&#x9020;&#x51FA;&#x80FD;&#x591F;&#x63A5;&#x53D7;&#x8BE5;&#x7279;&#x5B9A;&#x51FD;&#x6570;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x6216;&#x8FD4;&#x56DE;&#x51FD;&#x6570;&#x4F5C;&#x4E3A;&#x503C;&#x7684;&#x51FD;&#x6570;</strong>&#x3002;&#x8FD9;&#x6837;&#x7684;&#x51FD;&#x6570;&#x5373;&#x88AB;&#x79F0;&#x4E3A;<strong>&#x9AD8;&#x9636;&#x51FD;&#x6570;</strong>&#x3002;</p>
<h3 id="2&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x7684;&#x51FD;&#x6570;">2.&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x7684;&#x51FD;&#x6570;</h3>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x8003;&#x8651;&#x5BF9;&#x4E0B;&#x9762;&#x4E09;&#x79CD;&#x6C42;&#x548C;&#x7684;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#xFF1A;</p>
<ul>
<li><p><span class="math inline">\(1+2+\cdots +n\)</span>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">sum1</span>(<span class="params">n</span>):</span><br><span class="line">    tot,k=<span class="number">0</span>,<span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> k&lt;=n:</span><br><span class="line">        tot,k=tot+k,k+<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> tot</span><br></pre></td></tr></table></figure></p></li>
<li><p><span class="math inline">\(1^3+2^3+\cdots +n^3\)</span>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">sum2</span>(<span class="params">n</span>):</span><br><span class="line">    tot,k=<span class="number">0</span>,<span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> k&lt;=n:</span><br><span class="line">        tot,k=tot+k,k+<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> tot </span><br></pre></td></tr></table></figure></p></li>
<li><p><span class="math inline">\({4\over{1&#xB7;3}}+{4\over{3&#xB7;5}}+\cdots+{4\over{(2n-1)&#xB7;(2n+1)}}\)</span>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">sum2</span>(<span class="params">n</span>):</span><br><span class="line">    tot,k=<span class="number">0</span>,<span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> k&lt;=n:</span><br><span class="line">        tot,k=tot+<span class="number">4</span>/((<span class="number">2</span>*k-<span class="number">1</span>)*(<span class="number">2</span>*k+<span class="number">1</span>)),k+<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> tot</span><br></pre></td></tr></table></figure> &#x2003;&#x2003;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x4E0A;&#x8FF0;&#x6C42;&#x548C;&#x90FD;&#x53EF;&#x4EE5;&#x5F52;&#x7EB3;&#x4E3A;&#x4EE5;&#x4E0B;&#x6A21;&#x5F0F;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">sum</span>(<span class="params">n</span>):</span><br><span class="line">    tot,k=<span class="number">0</span>,<span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> k&lt;=n:</span><br><span class="line">        tot,k=f(k),k+<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> tot</span><br></pre></td></tr></table></figure>
&#x2003;&#x2003;&#x8FD9;&#x79CD;<strong>&#x516C;&#x5171;&#x6A21;&#x5F0F;&#x7684;&#x5B58;&#x5728;&#x5F3A;&#x6709;&#x529B;&#x5730;&#x8BC1;&#x660E;&#x4E86;&#x6709;&#x4E00;&#x4E2A;&#x6709;&#x7528;&#x7684;&#x62BD;&#x8C61;&#x6B63;&#x7B49;&#x5F85;&#x7740;&#x88AB;&#x63D0;&#x51FA;&#x6765;&#x3002;</strong>&#x901A;&#x8FC7;&#x66F4;&#x8FDB;&#x4E00;&#x6B65;&#x7684;&#x62BD;&#x8C61;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x51FD;&#x6570;&#x5C06;&#x4E0D;&#x6B62;&#x80FD;&#x6C42;&#x89E3;&#x8FD9;&#x4E9B;&#x7279;&#x5B9A;&#x7C7B;&#x578B;&#x7684;&#x6C42;&#x548C;&#xFF0C;&#x800C;&#x662F;&#x53EF;&#x4EE5;&#x6C42;&#x51FA;&#x6240;&#x6709;&#x666E;&#x904D;&#x610F;&#x4E49;&#x4E0A;&#x7684;&#x6C42;&#x548C;&#x3002;&#x4E8E;&#x662F;&#x6211;&#x4EEC;<strong>&#x4F7F;&#x7528;&#x51FD;&#x6570;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;</strong>&#xFF0C;&#x5C06;&#x539F;&#x6765;&#x7A0B;&#x5E8F;&#x6539;&#x5199;&#x5982;&#x4E0B;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">sum_abstraction</span>(<span class="params">n,f</span>):</span><br><span class="line">    tot,k=<span class="number">0</span>,<span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> k&lt;=n:</span><br><span class="line">        tot,k=tot+f(k),k+<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> tot</span><br><span class="line"></span><br><span class="line"><span class="comment">#&#x4EE5;&#x7B2C;2&#x4E2A;&#x6C42;&#x548C;&#x4E3A;&#x4F8B;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f2</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">return</span> n*n*n</span><br><span class="line"><span class="comment">#&#x5219;sum2&#x53EF;&#x4EE5;&#x5199;&#x6210;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sum2</span>:</span><br><span class="line">    <span class="keyword">return</span> sum_abstraction(n,f2)</span><br></pre></td></tr></table></figure></p></li>
</ul>
<h3 id="3&#x4F5C;&#x4E3A;&#x4E00;&#x822C;&#x65B9;&#x6CD5;&#x7684;&#x51FD;&#x6570;">3.&#x4F5C;&#x4E3A;&#x4E00;&#x822C;&#x65B9;&#x6CD5;&#x7684;&#x51FD;&#x6570;</h3>
<p>&#x2003;&#x2003;&#x4E0A;&#x4E00;&#x8282;&#x201C;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x7684;&#x51FD;&#x6570;&#x201D;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x7528;&#x51FD;&#x6570;&#x8868;&#x793A;&#x67D0;&#x79CD;&#x62BD;&#x8C61;&#x6570;&#x503C;&#x8FD0;&#x7B97;&#x6A21;&#x5F0F;&#xFF0C;&#x5C06;&#x67D0;&#x4E2A;&#x5177;&#x4F53;&#x7684;&#x8FD0;&#x7B97;&#x62BD;&#x8C61;&#x5316;&#x3002;&#x5728;&#x8FD9;&#x4E00;&#x8282;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;<strong>&#x5C06;&#x8BBE;&#x8BA1;&#x4E00;&#x4E9B;&#x51FD;&#x6570;&#x6765;&#x8868;&#x793A;&#x4E00;&#x822C;&#x7684;&#x8BA1;&#x7B97;&#x65B9;&#x6CD5;&#xFF0C;&#x5B83;&#x4EEC;&#x72EC;&#x7ACB;&#x4E8E;&#x8C03;&#x7528;&#x5B83;&#x4EEC;&#x7684;&#x51FD;&#x6570;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x8003;&#x8651;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x6C42;&#x89E3;&#x9EC4;&#x91D1;&#x5206;&#x5272;&#x6BD4;<span class="math inline">\(\varphi\)</span>&#x7684;&#x7A0B;&#x5E8F;&#x3002;&#x6211;&#x4EEC;&#x91C7;&#x7528;&#x8FED;&#x4EE3;&#x7684;&#x6C42;&#x6CD5;&#x6765;&#x6C42;&#x3002;&#x51FD;&#x6570;&#x7684;&#x4E3B;&#x4F53;&#x4E3A;&#x8FED;&#x4EE3;&#x51FD;&#x6570;<span class="math inline">\(update\)</span>&#x4E0E;&#x68C0;&#x67E5;&#x51FD;&#x6570;<span class="math inline">\(close\)</span>&#xFF0C;&#x8FD9;&#x91CC;&#x7684;&#x6BCF;&#x4E2A;&#x51FD;&#x6570;&#x90FD;&#x5BF9;&#x5E94;&#x7740;&#x4E00;&#x4E2A;&#x4E00;&#x822C;&#x65B9;&#x6CD5;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5BF9;&#x4E8E;&#x8FED;&#x4EE3;&#x51FD;&#x6570;&#xFF0C;&#x7531;&#x9EC4;&#x91D1;&#x5206;&#x5272;&#x6BD4;&#x7684;&#x6027;&#x8D28;&#xFF1A;<span class="math inline">\(\varphi=1+{1\over{1+{1\over{1+{1\over{\cdots}}}}}}\)</span>&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x5982;&#x4E0B;&#x7A0B;&#x5E8F;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">guess</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> check(guess):</span><br><span class="line">        guess=<span class="number">1</span>/guess+<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> guess</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5BF9;&#x4E8E;<span class="math inline">\(check\)</span>&#x51FD;&#x6570;&#xFF0C;&#x4E5F;&#x5373;<span class="math inline">\(update\)</span>&#x7684;&#x8FB9;&#x754C;&#x51FD;&#x6570;&#xFF0C;&#x7531;&#x9EC4;&#x91D1;&#x5206;&#x5272;&#x6BD4;&#x6EE1;&#x8DB3;&#x7684;&#x65B9;&#x7A0B;&#xFF1A;<span class="math inline">\(x^2=x+1\)</span>&#x53EF;&#x5F97;&#x5982;&#x4E0B;&#x7A0B;&#x5E8F;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">guess</span>):</span><br><span class="line">    <span class="keyword">return</span> close(guess*guess,guess+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">close</span>(<span class="params">a,b,tolerance=<span class="number">1e-15</span></span>):</span><br><span class="line">    <span class="keyword">return</span>(<span class="built_in">abs</span>(a-b)&lt;tolerance)</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x4ECE;&#x800C;&#x5F97;&#x5230;&#x6700;&#x7EC8;&#x7684;&#x7A0B;&#x5E8F;&#x5982;&#x4E0B;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>(<span class="params">update,check,guess=<span class="number">1</span></span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> check(guess):</span><br><span class="line">        guess=update(guess)</span><br><span class="line">    <span class="keyword">return</span> guess</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x901A;&#x8FC7;&#x672C;&#x9898;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x6A21;&#x5757;&#x5316;&#x7F16;&#x7A0B;&#x601D;&#x60F3;&#x7684;&#x91CD;&#x8981;&#x6027;&#xFF1A;&#x6211;&#x4EEC;<strong>&#x5C06;&#x6574;&#x4E2A;&#x7A0B;&#x5E8F;&#x62C6;&#x6210;&#x51E0;&#x4E2A;&#x5C0F;&#x7684;&#x7EC4;&#x4EF6;&#xFF0C;&#x5728;&#x7F16;&#x5199;&#x5B8C;&#x6BCF;&#x4E2A;&#x7EC4;&#x4EF6;&#x540E;&#x518D;&#x8FDB;&#x884C;&#x5408;&#x5E76;&#xFF0C;&#x5B9E;&#x73B0;&#x590D;&#x6742;&#x7684;&#x529F;&#x80FD;&#x3002;</strong>&#x540C;&#x65F6;&#x6211;&#x4EEC;&#x5728;&#x7F16;&#x5199;&#x7EC4;&#x4EF6;&#x65F6;&#xFF0C;&#x5BF9;&#x6BCF;&#x4E2A;&#x62BD;&#x8C61;&#x8FC7;&#x7A0B;&#x90FD;&#x53EF;&#x4EE5;<strong>&#x5148;&#x547D;&#x540D;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x628A;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x62BD;&#x8C61;&#x5316;</strong>&#xFF0C;&#x7136;&#x540E;&#x518D;&#x5B9E;&#x73B0;&#x8FD9;&#x4E00;&#x8FC7;&#x7A0B;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x6709;&#x6548;&#x964D;&#x4F4E;&#x51FD;&#x6570;&#x7684;&#x590D;&#x6742;&#x6027;&#x3002;</p>
<h3 id="4&#x51FD;&#x6570;&#x7684;&#x5D4C;&#x5957;&#x5B9A;&#x4E49;">4.&#x51FD;&#x6570;&#x7684;&#x5D4C;&#x5957;&#x5B9A;&#x4E49;</h3>
<p>&#x2003;&#x2003;&#x4E0A;&#x9762;&#x7684;&#x793A;&#x4F8B;&#x6F14;&#x793A;&#x4E86;<strong>&#x5C06;&#x51FD;&#x6570;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x4F20;&#x9012;</strong>&#x7684;&#x505A;&#x6CD5;&#x5982;&#x4F55;&#x5C06;<strong>&#x6BCF;&#x4E2A;&#x4E00;&#x822C;&#x6982;&#x5FF5;&#x6216;&#x65B9;&#x7A0B;&#x90FD;&#x6620;&#x5C04;&#x5230;&#x5B83;&#x81EA;&#x5DF1;&#x7684;&#x77ED;&#x51FD;&#x6570;&#x4E0A;</strong>&#x3002;&#x4F46;&#x5728;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x7531;&#x4E8E;&#x6BCF;&#x4E2A;&#x77ED;&#x51FD;&#x6570;&#x662F;&#x5728;&#x5168;&#x5C40;&#x72EC;&#x7ACB;&#x5B9A;&#x4E49;&#x7684;&#xFF0C;&#x5168;&#x5C40;&#x6846;&#x67B6;&#x4F1A;&#x56E0;&#x4E3A;&#x4F17;&#x591A;&#x51FD;&#x6570;&#x7684;&#x52A0;&#x5165;&#x53D8;&#x5F97;&#x6742;&#x4E71;&#x65E0;&#x7AE0;&#x3002;&#x540C;&#x65F6;&#xFF0C;&#x5728;&#x67D0;&#x4E9B;&#x573A;&#x5408;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8BA9;&#x51FD;&#x6570;&#x53EA;&#x4FDD;&#x6301;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x8FD9;&#x65F6;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8003;&#x8651;&#x5EFA;&#x7ACB;&#x5D4C;&#x5957;&#x51FD;&#x6570;&#x3002;</p>
<p>&#x2003;&#x2003;&#x4EE5;&#x5E73;&#x65B9;&#x6839;&#x7684;&#x8BA1;&#x7B97;&#x4E3A;&#x4F8B;&#x3002;&#x6211;&#x4EEC;&#x4E00;&#x822C;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x7A0B;&#x5E8F;&#x8FED;&#x4EE3;&#x5B9E;&#x73B0;&#x5E73;&#x65B9;&#x6839;&#x7684;&#x8BA1;&#x7B97;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">average</span>(<span class="params">x,y</span>):</span><br><span class="line">    <span class="keyword">return</span> (x+y)/<span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sqrt_update</span>(<span class="params">x,a</span>):</span><br><span class="line">    <span class="keyword">return</span> average(x,a/x)</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#x90FD;&#x662F;&#x53CC;&#x53C2;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x800C;&#x5F85;&#x5B9E;&#x73B0;&#x7684;<span class="math inline">\(sqrt\)</span>&#x662F;&#x5355;&#x53C2;&#x51FD;&#x6570;&#xFF1B;&#x5E76;&#x4E14;&#x8FD9;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#x5355;&#x72EC;&#x8C03;&#x7528;&#x53EA;&#x80FD;&#x5B9E;&#x73B0;&#x4E00;&#x6B21;&#x66F4;&#x65B0;&#x3002;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x7684;&#x65B9;&#x6CD5;&#x662F;<strong>&#x5C06;&#x51FD;&#x6570;&#x5B9A;&#x4E49;&#x653E;&#x5728;&#x5176;&#x4ED6;&#x5B9A;&#x4E49;&#x7684;&#x4E3B;&#x4F53;&#x4E2D;&#x3002;</strong>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">sqrt</span>(<span class="params">a</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">x</span>):</span><br><span class="line">        <span class="keyword">return</span> average(x,a/x)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">x</span>):</span><br><span class="line">        <span class="keyword">return</span> close(x*x,a)</span><br><span class="line">    <span class="keyword">return</span> solve(update,close)</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x4E0E;&#x5C40;&#x90E8;&#x8D4B;&#x503C;&#x4E00;&#x6837;&#xFF0C;&#x5C40;&#x90E8;<span class="math inline">\(def\)</span>&#x8BED;&#x53E5;&#x53EA;&#x5F71;&#x54CD;&#x5F53;&#x524D;&#x7684;&#x5C40;&#x90E8;&#x5185;&#x5BB9;&#x3002;&#x5F53;<span class="math inline">\(sqrt\)</span>&#x88AB;&#x8BA1;&#x7B97;&#x65F6;&#xFF0C;&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x53EA;&#x5728;&#x4F5C;&#x7528;&#x57DF;&#x4E2D;&#x3002;&#x4E0E;&#x6211;&#x4EEC;&#x7684;&#x8BA1;&#x7B97;&#x8FC7;&#x7A0B;&#x4E00;&#x81F4;&#xFF0C;<strong>&#x5728;&#x8C03;&#x7528;<span class="math inline">\(sqrt\)</span>&#x4E4B;&#x524D;&#xFF0C;&#x8FD9;&#x4E9B;&#x672C;&#x5730;<span class="math inline">\(def\)</span>&#x8BED;&#x53E5;&#x751A;&#x81F3;&#x4E0D;&#x4F1A;&#x88AB;&#x8BA1;&#x7B97;</strong>&#x3002;&#x7531;&#x6B64;&#x53EF;&#x5F15;&#x51FA;&#x65B0;&#x6982;&#x5FF5;&#xFF1A;</p>
<blockquote>
<p>&#x2003;&#x2003;<strong>&#x8BCD;&#x6CD5;&#x8303;&#x56F4;</strong>&#xFF1A;&#x5728;&#x51FD;&#x6570;&#x5185;&#x90E8;&#x88AB;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x5171;&#x4EAB;&#x5B9A;&#x4E49;&#x5B83;&#x4EEC;&#x7684;&#x51FD;&#x6570;&#x7684;&#x53C2;&#x6570;&#x3002;&#x4F8B;&#x5982;&#x672C;&#x4F8B;&#x7684;<span class="math inline">\(update\)</span>&#xFF0C;&#x5176;&#x5F15;&#x7528;&#x53C2;&#x6570;<span class="math inline">\(a\)</span>&#x5C31;&#x662F;&#x5C01;&#x95ED;&#x51FD;&#x6570;<span class="math inline">\(sqrt\)</span>&#x7684;&#x53C2;&#x6570;&#x3002;&#x5BF9;&#x4E8E;&#x5728;&#x5C01;&#x95ED;&#x51FD;&#x6570;&#x5185;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;&#xFF0C;<span class="math inline">\(a\)</span>&#x5C31;&#x76F8;&#x5F53;&#x4E8E;&#x4E00;&#x4E2A;&#x53EF;&#x4EE5;&#x4EFB;&#x610F;&#x8C03;&#x7528;&#x7684;&#x5E38;&#x6570;&#x3002;</p>
</blockquote>
<p>&#x2003;&#x2003;&#x7531;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x53D8;&#x91CF;&#x73AF;&#x5883;&#x5C31;&#x5206;&#x6210;&#x4E86;&#x4E24;&#x4E2A;&#x73AF;&#x5883;&#xFF1A;</p>
<ul>
<li>&#x6BCF;&#x4E2A;&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x51FD;&#x6570;&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x7236;&#x73AF;&#x5883;&#xFF1A;<strong>&#x5B9A;&#x4E49;&#x5B83;&#x7684;&#x73AF;&#x5883;</strong></li>
<li>&#x5F53;&#x8C03;&#x7528;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x51FD;&#x6570;&#x65F6;&#xFF0C;<strong>&#x8C03;&#x7528;&#x51FD;&#x6570;&#x7684;&#x5185;&#x90E8;&#x6269;&#x5C55;&#x51FA;&#x7684;&#x65B0;&#x73AF;&#x5883;</strong></li>
</ul>
<p>&#x2003;&#x2003;&#x4ECD;&#x7136;&#x4EE5;<span class="math inline">\(sqrt\)</span>&#x4E3A;&#x4F8B;&#x8BB2;&#x89E3;&#x5D4C;&#x5957;&#x51FD;&#x6570;&#x3002;&#x5229;&#x7528;&#x5D4C;&#x5957;&#x51FD;&#x6570;&#x5B9E;&#x73B0;&#x7684;<span class="math inline">\(sqrt\)</span>&#x8BA1;&#x7B97;&#x5982;&#x4E0B;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">average</span>(<span class="params">x,y</span>):</span><br><span class="line">    <span class="keyword">return</span> (x+y)/<span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>(<span class="params">update,check,guess=<span class="number">1</span></span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> check(guess):</span><br><span class="line">        guess=update(guess)</span><br><span class="line">    <span class="keyword">return</span> guess</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">eq</span>(<span class="params">x,y,tolerance=<span class="number">1e-15</span></span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">abs</span>(x-y)&lt;tolerance</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sqrt</span>(<span class="params">a</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">x,a/x</span>):</span><br><span class="line">        <span class="keyword">return</span> average(x,a/x)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check</span>:</span><br><span class="line">        <span class="keyword">return</span> eq(x*x,a)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> solve(update,check)</span><br><span class="line"></span><br><span class="line">result=sqrt(<span class="number">256</span>)</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8BE5;&#x51FD;&#x6570;&#x7684;&#x6267;&#x884C;&#x6D41;&#x7A0B;&#x53CA;&#x5BF9;&#x5E94;&#x8303;&#x56F4;&#x5982;&#x4E0B;&#xFF1A; 1.
&#x5B9A;&#x4E49;&#x51FD;&#x6570;&#xFF0C;&#x6B64;&#x65F6;&#x6240;&#x6709;&#x51FD;&#x6570;&#x5747;&#x4E3A;&#x5168;&#x5C40;&#x8303;&#x56F4; 2. &#x8C03;&#x7528;<span class="math inline">\(sqrt\)</span>&#xFF0C;&#x6B64;&#x65F6;<span class="math inline">\(def\)</span>&#x5185;&#x90E8;&#x7684;<span class="math inline">\(update\)</span>&#x3001;<span class="math inline">\(check\)</span>&#x51FD;&#x6570;&#x4E3A;&#x8BCD;&#x6CD5;&#x8303;&#x56F4;&#xFF0C;&#x540C;&#x65F6;<span class="math inline">\(update\)</span>&#x3001;<span class="math inline">\(check\)</span>&#x7EE7;&#x627F;&#x8BCD;&#x6CD5;&#x8303;&#x56F4;&#x5185;&#x7684;&#x53D8;&#x91CF;<span class="math inline">\(a\)</span> 3. &#x6267;&#x884C;<span class="math inline">\(solve\)</span>&#xFF0C;&#x901A;&#x8FC7;&#x8FED;&#x4EE3;&#x8BA1;&#x7B97;&#x51FA;<span class="math inline">\(sqrt\)</span>&#x7684;&#x503C;&#x3002;</p>
<p><img src="/2024/05/31/1.6.%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0/image-1.png"></p>
<p>&#x2003;&#x2003;&#x901A;&#x8FC7;&#x672C;&#x4F8B;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x4E86;&#x89E3;&#x62D3;&#x5C55;&#x73AF;&#x5883;&#x7684;&#x6982;&#x5FF5;&#xFF1A;</p>
<blockquote>
<p>&#x2003;&#x2003;<strong>&#x62D3;&#x5C55;&#x73AF;&#x5883;</strong>&#xFF1A;&#x4E00;&#x4E2A;&#x73AF;&#x5883;&#x53EF;&#x4EE5;<strong>&#x7531;&#x4EFB;&#x610F;&#x957F;&#x7684;&#x6846;&#x67B6;&#x94FE;&#x7EC4;&#x6210;&#xFF0C;&#x6846;&#x67B6;&#x94FE;&#x603B;&#x662F;&#x4EE5;&#x5168;&#x5C40;&#x6846;&#x67B6;&#x7ED3;&#x675F;</strong>&#x3002;&#x5728;<span class="math inline">\(sqrt\)</span>&#x4E4B;&#x524D;&#xFF0C;&#x73AF;&#x5883;&#x6700;&#x591A;&#x53EA;&#x6709;&#x4E24;&#x4E2A;&#x5E27;:
&#x5C40;&#x90E8;&#x5E27;&#x548C;&#x5168;&#x5C40;&#x5E27;&#x3002;&#x901A;&#x8FC7;&#x8C03;&#x7528;&#x5728;&#x5176;&#x4ED6;&#x51FD;&#x6570;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x901A;&#x8FC7;&#x5D4C;&#x5957;&#x7684;<span class="math inline">\(def\)</span>&#x8BED;&#x53E5;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x66F4;&#x957F;&#x7684;&#x94FE;&#x3002;&#x8C03;&#x7528; <span class="math inline">\(update\)</span>&#x7684;&#x73AF;&#x5883;&#x7531;&#x4E09;&#x4E2A;&#x6846;&#x67B6;&#x7EC4;&#x6210;:
<strong>&#x5C40;&#x90E8;<span class="math inline">\(update\)</span>&#x6846;&#x67B6;&#x3001;&#x5B9A;&#x4E49; <span class="math inline">\(update\)</span>&#x7684;<span class="math inline">\(sqrt\)</span>&#x6846;&#x67B6;&#x548C;&#x5168;&#x5C40;&#x6846;&#x67B6;</strong>&#x3002;</p>
</blockquote>
<p>&#x2003;&#x2003;&#x7531;&#x4E0A;&#x8FF0;&#x6846;&#x67B6;&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F97;&#x51FA;&#x6846;&#x67B6;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#xFF1A;<span class="math inline">\(update\)</span>&#x5148;&#x5728;&#x672C;&#x5730;&#x6846;&#x67B6;&#x4E2D;&#x627E;<span class="math inline">\(a\)</span>&#x7684;&#x503C;&#xFF0C;&#x6CA1;&#x627E;&#x5230;&#xFF1B;&#x4E8E;&#x662F;<span class="math inline">\(update\)</span>&#x53BB;&#x5B9A;&#x4E49;<span class="math inline">\(update\)</span>&#x7684;<span class="math inline">\(sqrt\)</span>&#x6846;&#x67B6;&#x627E;&#xFF0C;&#x627E;&#x5230;<span class="math inline">\(256\)</span>&#xFF0C;&#x4E8E;&#x662F;<span class="math inline">\(a=256\)</span>&#x3002;</p>
<p>&#x2003;&#x2003;&#x7531;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x5F97;&#x51FA;&#x4E86;&#x8BCD;&#x6CD5;&#x8303;&#x56F4;&#x7684;&#x4F18;&#x70B9;&#xFF1A;</p>
<ul>
<li><p>&#x5C40;&#x90E8;&#x51FD;&#x6570;&#x7684;&#x540D;&#x79F0;&#x4E0D;&#x4F1A;&#x5E72;&#x6270;&#x5B9A;&#x4E49;&#x5B83;&#x7684;&#x51FD;&#x6570;&#x7684;&#x5916;&#x90E8;&#x540D;&#x79F0;&#xFF0C;<strong>&#x56E0;&#x4E3A;&#x5C40;&#x90E8;&#x51FD;&#x6570;&#x540D;&#x79F0;&#x5C06;&#x7ED1;&#x5B9A;&#x5728;&#x5B9A;&#x4E49;&#x5B83;&#x7684;&#x5F53;&#x524D;&#x5C40;&#x90E8;&#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5168;&#x5C40;&#x73AF;&#x5883;&#x4E2D;&#x3002;</strong></p></li>
<li><p>&#x5C40;&#x90E8;&#x51FD;&#x6570;<strong>&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x5C01;&#x95ED;&#x51FD;&#x6570;&#x7684;&#x73AF;&#x5883;</strong>&#xFF0C;&#x56E0;&#x4E3A;&#x5C40;&#x90E8;&#x51FD;&#x6570;&#x4F53;&#x662F;&#x5728;&#x6269;&#x5C55;&#x5176;&#x5B9A;&#x4E49;&#x7684;&#x5C01;&#x95ED;&#x51FD;&#x6570;&#x73AF;&#x5883;&#x4E2D;&#x8FDB;&#x884C;&#x5B9A;&#x4E49;&#x7684;&#x3002;</p></li>
</ul>
<p>&#x2003;&#x2003;&#x8FD9;&#x79CD;&#x5728;&#x672C;&#x5730;&#x6846;&#x67B6;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;&#x88AB;&#x79F0;&#x4E3A;<strong>&#x95ED;&#x5305;</strong>&#xFF0C;&#x4F8B;&#x5982;&#x672C;&#x9898;&#x4E2D;&#x7684;<span class="math inline">\(sqrt\)</span>&#x51FD;&#x6570;&#x3002;&#x5728;&#x95ED;&#x5305;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x95ED;&#x5305;&#x5185;&#x7684;&#x6570;&#x636E;&#x4FE1;&#x606F;&#xFF0C;&#x800C;&#x4E14;&#x95ED;&#x5305;&#x5185;&#x7684;&#x4FE1;&#x606F;&#x662F;&#x5C01;&#x95ED;&#x7684;&#x3001;&#x4E0D;&#x4F1A;&#x6CC4;&#x9732;&#x5230;&#x5916;&#x90E8;&#x73AF;&#x5883;&#x4E2D;&#x3002;</p>
<h3 id="5&#x4F5C;&#x4E3A;&#x8FD4;&#x56DE;&#x503C;&#x7684;&#x51FD;&#x6570;">5.&#x4F5C;&#x4E3A;&#x8FD4;&#x56DE;&#x503C;&#x7684;&#x51FD;&#x6570;</h3>
<p>&#x2003;&#x2003;&#x8BCD;&#x6CD5;&#x8303;&#x56F4;&#x7684;&#x4E00;&#x4E2A;&#x91CD;&#x8981;&#x7279;&#x6027;&#x662F;&#xFF1A;<strong>&#x672C;&#x5730;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;&#x5728;&#x8FD4;&#x56DE;&#x65F6;&#x7EF4;&#x62A4;&#x5176;&#x7236;&#x73AF;&#x5883;</strong>&#x3002;&#x4E0B;&#x9762;&#x4E3E;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x8BE5;&#x7279;&#x6027;&#x7684;&#x4F8B;&#x5B50;&#x3002;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">combine</span>(<span class="params">f,g</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">h</span>(<span class="params">x</span>):</span><br><span class="line">        <span class="keyword">return</span> f(g(x))</span><br><span class="line">    <span class="keyword">return</span> h</span><br></pre></td></tr></table></figure>
&#x2003;&#x2003;&#x8FD9;&#x662F;&#x590D;&#x5408;&#x51FD;&#x6570;&#x7684;&#x7A0B;&#x5E8F;&#x3002;&#x6B63;&#x662F;&#x901A;&#x8FC7;&#x672C;&#x5730;&#x5B9A;&#x4E49;&#x51FD;&#x6570;&#x7EE7;&#x627F;&#x7236;&#x73AF;&#x5883;&#x7684;&#x6027;&#x8D28;&#xFF0C;&#x8BE5;&#x51FD;&#x6570;&#x5B9E;&#x73B0;&#x4E86;&#x591A;&#x4E2A;&#x51FD;&#x6570;&#x95F4;&#x7684;&#x590D;&#x5408;&#x3002;</p>
<p>&#x2003;&#x2003;&#x4E00;&#x822C;&#x5730;&#xFF0C;&#x8FD4;&#x56DE;&#x51FD;&#x6570;&#x7684;&#x51FD;&#x6570;&#x5177;&#x6709;&#x4EE5;&#x4E0B;&#x4F18;&#x70B9;&#xFF1A;</p>
<ul>
<li><p><strong>&#x7075;&#x6D3B;&#x6027;&#x548C;&#x53EF;&#x590D;&#x7528;&#x6027;</strong>&#xFF1A;
&#x51FD;&#x6570;&#x4F5C;&#x4E3A;&#x8FD4;&#x56DE;&#x503C;&#x53EF;&#x4EE5;&#x589E;&#x52A0;&#x4EE3;&#x7801;&#x7684;&#x7075;&#x6D3B;&#x6027;&#x3002;&#x901A;&#x8FC7;&#x8FD4;&#x56DE;&#x51FD;&#x6570;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x9700;&#x8981;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x52A8;&#x6001;&#x9009;&#x62E9;&#x8FD4;&#x56DE;&#x4E0D;&#x540C;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x4F7F;&#x5F97;&#x4EE3;&#x7801;&#x66F4;&#x52A0;&#x7075;&#x6D3B;&#x548C;&#x53EF;&#x590D;&#x7528;&#x3002;</p></li>
<li><p><strong>&#x5C01;&#x88C5;&#x548C;&#x62BD;&#x8C61;</strong>&#xFF1A;
&#x51FD;&#x6570;&#x4F5C;&#x4E3A;&#x8FD4;&#x56DE;&#x503C;&#x6709;&#x52A9;&#x4E8E;&#x5C01;&#x88C5;&#x548C;&#x62BD;&#x8C61;&#x4EE3;&#x7801;&#x3002;&#x4F60;&#x53EF;&#x4EE5;&#x5C06;&#x4E00;&#x4E9B;&#x590D;&#x6742;&#x7684;&#x903B;&#x8F91;&#x5C01;&#x88C5;&#x5728;&#x51FD;&#x6570;&#x5185;&#x90E8;&#xFF0C;&#x7136;&#x540E;&#x8FD4;&#x56DE;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x4ECE;&#x800C;&#x9690;&#x85CF;&#x5185;&#x90E8;&#x5B9E;&#x73B0;&#x7EC6;&#x8282;&#xFF0C;&#x4F7F;&#x5F97;&#x63A5;&#x53E3;&#x66F4;&#x52A0;&#x7B80;&#x6D01;&#xFF0C;&#x63D0;&#x9AD8;&#x4EE3;&#x7801;&#x7684;&#x53EF;&#x7EF4;&#x62A4;&#x6027;&#x3002;</p></li>
<li><p><strong>&#x5EF6;&#x8FDF;&#x6267;&#x884C;</strong>&#xFF1A;
&#x8FD4;&#x56DE;&#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x652F;&#x6301;&#x5EF6;&#x8FDF;&#x6267;&#x884C;&#x7684;&#x6A21;&#x5F0F;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x5BF9;&#x8C61;&#xFF0C;&#x8BE5;&#x5BF9;&#x8C61;&#x5728;&#x8C03;&#x7528;&#x65F6;&#x624D;&#x4F1A;&#x6267;&#x884C;&#x5177;&#x4F53;&#x7684;&#x903B;&#x8F91;&#x3002;&#x8FD9;&#x79CD;&#x5EF6;&#x8FDF;&#x6267;&#x884C;&#x7684;&#x65B9;&#x5F0F;&#x6709;&#x52A9;&#x4E8E;&#x63D0;&#x9AD8;&#x6027;&#x80FD;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5728;&#x6D89;&#x53CA;&#x6602;&#x8D35;&#x8BA1;&#x7B97;&#x6216;&#x8005;&#x9700;&#x8981;&#x4ECE;&#x5916;&#x90E8;&#x83B7;&#x53D6;&#x8D44;&#x6E90;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x3002;</p></li>
<li><p><strong>&#x51FD;&#x6570;&#x5C01;&#x88C5;</strong>&#xFF1A;
&#x8FD4;&#x56DE;&#x51FD;&#x6570;&#x7684;&#x80FD;&#x529B;&#x4F7F;&#x5F97;&#x51FD;&#x6570;&#x6210;&#x4E3A;&#x4E00;&#x79CD;&#x51FD;&#x6570;&#x5DE5;&#x5382;&#x3002;&#x4F60;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x4E00;&#x4E9B;&#x53C2;&#x6570;&#x6216;&#x8005;&#x6761;&#x4EF6;&#x8FD4;&#x56DE;&#x4E0D;&#x540C;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x4ECE;&#x800C;&#x5B9E;&#x73B0;&#x66F4;&#x52A0;&#x901A;&#x7528;&#x548C;&#x53EF;&#x914D;&#x7F6E;&#x7684;&#x4EE3;&#x7801;&#x7ED3;&#x6784;&#x3002;</p></li>
</ul>
<h3 id="6&#x9AD8;&#x9636;&#x51FD;&#x6570;&#x7684;&#x7ECF;&#x5178;&#x5E94;&#x7528;">6.&#x9AD8;&#x9636;&#x51FD;&#x6570;&#x7684;&#x7ECF;&#x5178;&#x5E94;&#x7528;</h3>
<h4 id="a&#x725B;&#x987F;&#x8FED;&#x4EE3;&#x6CD5;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&#x725B;&#x987F;&#x8FED;&#x4EE3;&#x6CD5;</h4>
<h5 id="i&#x725B;&#x987F;&#x8FED;&#x4EE3;&#x7684;&#x539F;&#x7406;">&#x2003;&#x2003;<span class="math inline">\(i.\)</span>&#x725B;&#x987F;&#x8FED;&#x4EE3;&#x7684;&#x539F;&#x7406;</h5>
<p><img src="/2024/05/31/1.6.%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0/image.png"></p>
<h5 id="ii&#x725B;&#x987F;&#x8FED;&#x4EE3;&#x6CD5;&#x7684;&#x5B9E;&#x73B0;">&#x2003;&#x2003;<span class="math inline">\(ii.\)</span>&#x725B;&#x987F;&#x8FED;&#x4EE3;&#x6CD5;&#x7684;&#x5B9E;&#x73B0;</h5>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x8003;&#x8651;&#x5B9E;&#x73B0;<span class="math inline">\(\sqrt[n]{a}\)</span>&#x7684;&#x8BA1;&#x7B97;&#x3002;&#x9996;&#x5148;&#x4EE4;<span class="math inline">\(\sqrt[n]{a}=x\)</span>&#xFF0C;&#x5219;&#x95EE;&#x9898;&#x8F6C;&#x5316;&#x4E3A;&#x6C42;<span class="math inline">\(x^n=a\)</span>&#x7684;&#x5B9E;&#x6839;&#x3002;&#x6211;&#x4EEC;&#x6839;&#x636E;&#x725B;&#x987F;&#x8FED;&#x4EE3;&#x6CD5;&#x5C06;&#x7A0B;&#x5E8F;&#x62C6;&#x5206;&#x4E3A;&#x4EE5;&#x4E0B;&#x6A21;&#x5757;&#xFF1A;
*
&#x725B;&#x987F;&#x8FED;&#x4EE3;&#x51FD;&#x6570;&#x7684;&#x5B9E;&#x73B0;&#xFF1A;&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x8981;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x5C01;&#x88C5;&#xFF0C;&#x91C7;&#x7528;&#x8FD4;&#x56DE;&#x51FD;&#x6570;&#x7684;&#x9AD8;&#x9636;&#x51FD;&#x6570;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">newton_update</span>(<span class="params">f,df</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">x</span>):</span><br><span class="line">        <span class="keyword">return</span> x-f(x)/df(x)</span><br><span class="line">    <span class="keyword">return</span> update</span><br></pre></td></tr></table></figure> &#x2003;&#x2003;&#x6211;&#x4EEC;&#x5C06;&#x62BD;&#x8C61;&#x8FC7;&#x7A0B;<span class="math inline">\(f\)</span>&#x4E0E;<span class="math inline">\(df\)</span>&#x547D;&#x540D;&#x4E3A;&#x4E86;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x4E0B;&#x9762;&#x8003;&#x8651;&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x4E24;&#x8005;&#x3002;</p>
<ul>
<li><p><span class="math inline">\(f\)</span>&#xFF1A;<span class="math inline">\(f\)</span>&#x5373;&#x4E3A;<span class="math inline">\(x^n\)</span> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> power(x,n)</span><br><span class="line">```   </span><br><span class="line">&amp;emsp;&amp;emsp;&#x540C;&#x7406;&#xFF1A;</span><br><span class="line">```python</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">df</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> n*power(x,n-<span class="number">1</span>)</span><br></pre></td></tr></table></figure> &#x2003;&#x2003;&#x63A5;&#x4E0B;&#x6765;&#x662F;&#x5B9E;&#x73B0;<span class="math inline">\(power\)</span>&#xFF1A;</p></li>
<li><p><span class="math inline">\(power\)</span>:&#x7B80;&#x5355;&#x7684;&#x8FDE;&#x4E58;&#x5373;&#x53EF;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">power</span>(<span class="params">x,n</span>):</span><br><span class="line">    mul,cnt=<span class="number">1</span>,<span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> cnt&lt;n:</span><br><span class="line">        mul,cnt=mul*x,cnt+<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> mul</span><br></pre></td></tr></table></figure></p></li>
<li><p>&#x5BFB;&#x627E;&#x96F6;&#x70B9;&#x51FD;&#x6570;&#x7684;&#x5B9E;&#x73B0;&#xFF1A;&#x5BFB;&#x627E;&#x96F6;&#x70B9;&#x5206;&#x4E3A;&#x4E24;&#x6B65;&#xFF1A;&#x68C0;&#x9A8C;&#x662F;&#x5426;&#x4E3A;&#x96F6;&#x70B9;&#x4E0E;&#x725B;&#x987F;&#x8FED;&#x4EE3;&#x3002;&#x6211;&#x4EEC;&#x5206;&#x522B;&#x5B9E;&#x73B0;&#x8FD9;&#x4E24;&#x4E2A;&#x529F;&#x80FD;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x5B83;&#x4EEC;&#x5C01;&#x88C5;&#x4E3A;&#x5BFB;&#x627E;&#x96F6;&#x70B9;&#x51FD;&#x6570;&#xFF1A;</p>
<ul>
<li>&#x68C0;&#x9A8C;&#x662F;&#x5426;&#x4E3A;&#x96F6;&#x70B9;&#xFF1A;&#x5224;&#x65AD;<span class="math inline">\(f(x)-a\)</span>&#x662F;&#x5426;&#x5728;&#x8BEF;&#x5DEE;&#x8303;&#x56F4;&#x5373;&#x53EF;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">iszero</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> eq(f(x),<span class="number">0</span>)</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li><p>&#x51FD;&#x6570;&#x5C01;&#x88C5;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>(<span class="params">update, is_zero</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">iteratively_solve</span>(<span class="params">x</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> is_approx_zero(x):</span><br><span class="line">            x = update(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line">    <span class="keyword">return</span> iteratively_solve</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_zero</span>(<span class="params">f,df</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_zero</span>(<span class="params">x</span>):</span><br><span class="line">        <span class="keyword">return</span> eq(f(x),<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> solve(newton_update(f,df),is_zero)</span><br></pre></td></tr></table></figure></p></li>
<li><p>&#x6700;&#x7EC8;&#x51FD;&#x6570;&#x5C01;&#x88C5;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">nth_root_of_a</span>(<span class="params">n,a</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x</span>):</span><br><span class="line">        <span class="keyword">return</span> power(x,n)-a</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">df</span>(<span class="params">x</span>):</span><br><span class="line">        <span class="keyword">return</span> n*power(x,n-<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> find_zero(f,df)</span><br></pre></td></tr></table></figure> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">newton_update</span>(<span class="params">f, df</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">x</span>):</span><br><span class="line">        <span class="keyword">return</span> x - f(x) / df(x)</span><br><span class="line">    <span class="keyword">return</span> update</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">improve</span>(<span class="params">update, is_approx_zero, max_iter=<span class="number">1000</span></span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">iteratively_improve</span>(<span class="params">x</span>):</span><br><span class="line">        iteration = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> is_approx_zero(x) <span class="keyword">and</span> iteration &lt; max_iter:</span><br><span class="line">            x = update(x)</span><br><span class="line">            iteration += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line">    <span class="keyword">return</span> iteratively_improve</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_zero</span>(<span class="params">f, df</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">near_zero</span>(<span class="params">x</span>):</span><br><span class="line">        <span class="keyword">return</span> approx_eq(f(x), <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> improve(newton_update(f, df), near_zero)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">power</span>(<span class="params">x, n</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Return x * x * x * ... * x for x repeated n times.&quot;&quot;&quot;</span></span><br><span class="line">    product, k = <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> k &lt; n:</span><br><span class="line">        product, k = product * x, k + <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> product</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">approx_eq</span>(<span class="params">a, b, epsilon=<span class="number">1e-6</span></span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">abs</span>(a - b) &lt; epsilon</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">nth_root_of_a</span>(<span class="params">n, a</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x</span>):</span><br><span class="line">        <span class="keyword">return</span> power(x, n) - a</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">df</span>(<span class="params">x</span>):</span><br><span class="line">        <span class="keyword">return</span> n * power(x, n-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> find_zero(f, df)</span><br><span class="line"></span><br></pre></td></tr></table></figure></p></li>
</ul>
<h4 id="bcurry&#x5316;">&#x2003;&#x2003;<span class="math inline">\(b.\)</span><span class="math inline">\(Curry\)</span>&#x5316;</h4>
<h5 id="i&#x4E00;&#x822C;&#x7684;curry&#x5316;">&#x2003;&#x2003;<span class="math inline">\(i.\)</span>&#x4E00;&#x822C;&#x7684;<span class="math inline">\(Curry\)</span>&#x5316;</h5>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x9AD8;&#x9636;&#x51FD;&#x6570;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x4E00;&#x4E2A;&#x6709;&#x5F88;&#x591A;&#x53C2;&#x6570;&#x7684;&#x51FD;&#x6570;&#x62C6;&#x5206;&#x6210;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x94FE;&#xFF0C;&#x6BCF;&#x4E2A;&#x51FD;&#x6570;&#x94FE;&#x8282;&#x90FD;&#x662F;&#x5355;&#x53C2;&#x51FD;&#x6570;&#x3002;</p>
<p>&#x2003;&#x2003;&#x4EE5;&#x53CC;&#x53C2;&#x51FD;&#x6570;<span class="math inline">\(pow(a,n)\)</span>&#x4E3A;&#x4F8B;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;&#x4EE5;&#x4E0B;&#x7A0B;&#x5E8F;&#x5C06;<span class="math inline">\(pow(a,n)\)</span>&#x8F6C;&#x5316;&#x4E3A;<span class="math inline">\(h(a)(n)\)</span>&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">curried_pow</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">h</span>(<span class="params">y</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">pow</span>(x,y)</span><br><span class="line">    <span class="keyword">return</span> h</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>curried_pow(<span class="number">2</span>)(<span class="number">3</span>)</span><br><span class="line"><span class="number">8</span></span><br></pre></td></tr></table></figure>
&#x2003;&#x2003;&#x9664;&#x4E86;&#x6EE1;&#x8DB3;&#x5355;&#x53C2;&#x7684;&#x9700;&#x6C42;&#xFF0C;&#x7531;&#x4E8E;&#x5C06;&#x539F;&#x51FD;&#x6570;&#x62C6;&#x6210;&#x4E86;&#x591A;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;<span class="math inline">\(Curry\)</span>&#x5316;&#x7684;&#x51FD;&#x6570;&#x8FD8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6539;&#x52A8;&#x67D0;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x4F7F;<span class="math inline">\(Curry\)</span>&#x5316;&#x540E;&#x7684;&#x51FD;&#x6570;&#x80FD;&#x5B9E;&#x73B0;&#x4E0D;&#x540C;&#x7684;&#x529F;&#x80FD;&#x3002;&#x4F8B;&#x5982;&#x4E0B;&#x9762;&#x8BA1;&#x7B97;<span class="math inline">\(2^1\sim 2^{10}\)</span>&#x7684;&#x7A0B;&#x5E8F;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">map_to_range</span>(<span class="params">start,end,f</span>):</span><br><span class="line">    <span class="keyword">while</span> start&lt;end:</span><br><span class="line">        <span class="built_in">print</span>(f(start))</span><br><span class="line">        start+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">map_to_range(<span class="number">1</span>,<span class="number">10</span>,<span class="built_in">pow</span>(<span class="number">2</span>))</span><br></pre></td></tr></table></figure>
&#x2003;&#x2003;&#x8FD9;&#x91CC;&#xFF0C;<span class="math inline">\(Curry\)</span>&#x51FD;&#x6570;<span class="math inline">\(pow(2)\)</span>&#x53EA;&#x6267;&#x884C;&#x201C;&#x4EE5;<span class="math inline">\(2\)</span>&#x4E3A;&#x5E95;&#x201D;&#x8FD9;&#x4E00;&#x6A21;&#x5757;&#x3002;&#x800C;&#x53E6;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x201C;<span class="math inline">\(n\)</span>&#x6B21;&#x5E42;&#x201D;&#x5219;&#x7531;<span class="math inline">\(map\_to\_range\)</span>&#x4F20;&#x9012;&#x3002;</p>
<h5 id="ii&#x81EA;&#x52A8;&#x5316;">&#x2003;&#x2003;<span class="math inline">\(ii.\)</span>&#x81EA;&#x52A8;&#x5316;</h5>
<p>&#x2003;&#x2003;&#x4EE5;&#x4E0B;&#x7A0B;&#x5E8F;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x5BF9;&#x8F93;&#x5165;&#x51FD;&#x6570;&#x7684;<span class="math inline">\(Curry\)</span>&#x5316;&#x4E0E;<span class="math inline">\(Uncurry\)</span>&#x5316;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">curry</span>(<span class="params">f</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">g</span>(<span class="params">x</span>):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">h</span>(<span class="params">y</span>):</span><br><span class="line">            <span class="keyword">return</span> f(x,y)</span><br><span class="line">        <span class="keyword">return</span> h</span><br><span class="line">    <span class="keyword">return</span> g</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">uncurry</span>(<span class="params">g</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x,y</span>):</span><br><span class="line">        <span class="keyword">return</span> g(x)(y)</span><br><span class="line">    <span class="keyword">return</span> f</span><br><span class="line"><span class="comment">#&#x8C03;&#x7528;</span></span><br><span class="line">pow_curried=curry(<span class="built_in">pow</span>)</span><br><span class="line"><span class="built_in">pow</span>=uncurry(pow_curried)</span><br></pre></td></tr></table></figure></p>
<h4 id="clambda&#x8868;&#x8FBE;&#x5F0F;">&#x2003;&#x2003;<span class="math inline">\(c.\)</span><span class="math inline">\(lambda\)</span>&#x8868;&#x8FBE;&#x5F0F;</h4>
<p>&#x2003;&#x2003;<span class="math inline">\(lambda\)</span>&#x8868;&#x8FBE;&#x5F0F;&#x53EF;&#x4EE5;&#x5728;&#x4E0D;&#x58F0;&#x660E;&#x51FD;&#x6570;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5C06;&#x53D8;&#x91CF;&#x8F6C;&#x6362;&#x4E3A;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x3002;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x7A0B;&#x5E8F;&#x5C31;&#x662F;<span class="math inline">\(lambda\)</span>&#x8868;&#x8FBE;&#x5F0F;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">composel</span>(<span class="params">f,g</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">lambda</span> x:f(g(x))</span><br></pre></td></tr></table></figure>
&#x2003;&#x2003;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;&#x5982;&#x4E0B;&#x8868;&#x683C;&#x7406;&#x89E3;<span class="math inline">\(lambda\)</span>&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x6982;&#x5FF5;&#xFF1A;</p>
<p><img src="/2024/05/31/1.6.%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0/image-2.png"></p>
<p>&#x2003;&#x2003;<span class="math inline">\(lambda\)</span>&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x79F0;&#x4F5C;
<strong><span class="math inline">\(lambda\)</span>&#x51FD;&#x6570;</strong> &#x3002;<span class="math inline">\(lambda\)</span>&#x51FD;&#x6570;&#x6CA1;&#x6709;&#x5185;&#x7F6E;&#x540D;&#x79F0;&#xFF0C;&#x4F46;&#x53EF;&#x4EE5;&#x548C;&#x666E;&#x901A;&#x7684;&#x51FD;&#x6570;&#x4E00;&#x6837;&#x8C03;&#x7528;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="keyword">lambda</span> x: x * x</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line">&lt;function &lt;<span class="keyword">lambda</span>&gt; at <span class="number">0xf3f490</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s(<span class="number">12</span>)</span><br><span class="line"><span class="number">144</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5BF9;&#x4E8E;&#x8F83;&#x7B80;&#x5355;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x5229;&#x7528;<span class="math inline">\(lambda\)</span>&#x8868;&#x8FBE;&#x5F0F;&#x53EF;&#x4EE5;&#x7B80;&#x5316;&#x4EE3;&#x7801;&#xFF1B;&#x4F46;&#x5982;&#x679C;&#x51FD;&#x6570;&#x8F83;&#x4E3A;&#x590D;&#x6742;&#xFF0C;<span class="math inline">\(lambda\)</span>&#x5C31;&#x5F88;&#x53EF;&#x80FD;&#x7ED9;&#x4EBA;&#x5E26;&#x6765;&#x7406;&#x89E3;&#x4E0A;&#x7684;&#x56F0;&#x96BE;&#x3002;&#x56E0;&#x6B64;&#x5728;&#x4EE3;&#x7801;&#x8F83;&#x590D;&#x6742;&#x3001;&#x5C42;&#x5C42;&#x5D4C;&#x5957;&#x65F6;&#xFF0C;&#x8FD8;&#x662F;&#x7528;&#x4F20;&#x7EDF;&#x7684;<code>def</code>&#x4E3A;&#x4F73;&#x3002;</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/1.7.%E9%80%92%E5%BD%92%E5%87%BD%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/1.7.%E9%80%92%E5%BD%92%E5%87%BD%E6%95%B0/" class="post-title-link" itemprop="url">1.7.&#x9012;&#x5F52;&#x51FD;&#x6570;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 13:23:57" itemprop="dateModified" datetime="2024-06-02T13:23:57+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SICP-in-python/" itemprop="url" rel="index"><span itemprop="name">SICP in python</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SICP-in-python/Chapter-1-Building-Abstractions-with-Functions/" itemprop="url" rel="index"><span itemprop="name">Chapter 1.Building Abstractions with Functions</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>1.5k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>5 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="17&#x9012;&#x5F52;&#x51FD;&#x6570;"><span class="math inline">\(1.7\)</span>&#x9012;&#x5F52;&#x51FD;&#x6570;</h1>
<h2 id="&#x4E00;-&#x9012;&#x5F52;&#x51FD;&#x6570;&#x7684;&#x6982;&#x5FF5;&#x4E0E;&#x5206;&#x7C7B;">&#x4E00;&#x3001;&#x9012;&#x5F52;&#x51FD;&#x6570;&#x7684;&#x6982;&#x5FF5;&#x4E0E;&#x5206;&#x7C7B;</h2>
<h3 id="1&#x6982;&#x5FF5;">1.&#x6982;&#x5FF5;</h3>
<p>&#x2003;&#x2003;&#x5982;&#x679C;<strong>&#x51FD;&#x6570;&#x4F53;&#x76F4;&#x63A5;&#x6216;&#x95F4;&#x63A5;&#x8C03;&#x7528;&#x51FD;&#x6570;&#x672C;&#x8EAB;</strong>&#xFF0C;&#x5219;&#x51FD;&#x6570;&#x79F0;&#x4E3A;&#x9012;&#x5F52;&#x51FD;&#x6570;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x6267;&#x884C;&#x9012;&#x5F52;&#x51FD;&#x6570;&#x4F53;&#x7684;&#x8FC7;&#x7A0B;&#x53EF;&#x80FD;&#x53CD;&#x8FC7;&#x6765;&#x53C8;&#x9700;&#x8981;&#x518D;&#x6B21;&#x5E94;&#x7528;&#x8BE5;&#x51FD;&#x6570;&#x3002;</p>
<h3 id="2&#x9012;&#x5F52;&#x7684;&#x539F;&#x7406;">2.&#x9012;&#x5F52;&#x7684;&#x539F;&#x7406;</h3>
<p>&#x2003;&#x2003;&#x4E00;&#x822C;&#x7684;&#x9012;&#x5F52;&#x7531;&#x4EE5;&#x4E0B;&#x7ED3;&#x6784;&#x6784;&#x6210;&#xFF1A;</p>
<ul>
<li>&#x57FA;&#x672C;&#x60C5;&#x51B5;&#xFF1A;&#x5F53;&#x9012;&#x5F52;&#x51FD;&#x6570;&#x9012;&#x5F52;&#x5230;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x57FA;&#x672C;&#x60C5;&#x51B5;&#x65F6;&#xFF0C;&#x51FD;&#x6570;&#x5C06;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x67D0;&#x4E2A;&#x503C;&#xFF0C;&#x8DF3;&#x51FA;&#x9012;&#x5F52;</li>
<li>&#x9012;&#x5F52;&#x8C03;&#x7528;&#xFF1A;&#x968F;&#x7740;&#x9012;&#x5F52;&#x8C03;&#x7528;&#xFF0C;&#x95EE;&#x9898;&#x9010;&#x6E10;&#x5F97;&#x5230;&#x7B80;&#x5316;</li>
</ul>
<p>&#x2003;&#x2003;&#x4EE5;&#x9636;&#x4E58;&#x7684;&#x6C42;&#x89E3;&#x4E3A;&#x4F8B;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">fact</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">if</span> n==<span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> n==<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> n*f(n-<span class="number">1</span>)</span><br></pre></td></tr></table></figure> &#x2003;&#x2003;&#x9012;&#x5F52;&#x51FD;&#x6570;<span class="math inline">\(fact\)</span>&#x7528;&#x4E00;&#x4E2A;&#x66F4;&#x7B80;&#x5355;&#x7684;&#x95EE;&#x9898;&#xFF1A;<span class="math inline">\(fact(n-1)\)</span>&#x8868;&#x793A;&#x4E86;<span class="math inline">\(fact(n)\)</span>&#x3002;&#x8BE5;&#x9012;&#x5F52;&#x7684;&#x57FA;&#x672C;&#x60C5;&#x51B5;&#x662F;<span class="math inline">\(1!=1,0!=1\)</span>&#x3002;</p>
<p>&#x2003;&#x2003;&#x5F53;&#x9012;&#x5F52;<strong>&#x901A;&#x8FC7;&#x9012;&#x5F52;&#x51FD;&#x6570;&#x7684;&#x8FDE;&#x7EED;&#x8C03;&#x7528;&#x201C;&#x5C55;&#x5F00;&#x201D;&#x5230;&#x8D8A;&#x6765;&#x8D8A;&#x7B80;&#x5355;&#x7684;&#x95EE;&#x9898;&#x65F6;&#xFF0C;&#x7ED3;&#x679C;&#x6700;&#x7EC8;&#x4F1A;&#x4ECE;&#x57FA;&#x672C;&#x60C5;&#x51B5;&#x5F00;&#x59CB;&#x6784;&#x5EFA;</strong>&#x3002;&#x9012;&#x5F52;&#x7ED3;&#x675F;&#x65F6;&#x5C06;&#x53C2;&#x6570;<span class="math inline">\(1\)</span>&#x4F20;&#x9012;&#x7ED9;<span class="math inline">\(fact\)</span>;
<strong>&#x6BCF;&#x4E2A;&#x8C03;&#x7528;&#x7684;&#x7ED3;&#x679C;&#x53D6;&#x51B3;&#x4E8E;&#x4E0B;&#x4E00;&#x4E2A;&#x8C03;&#x7528;&#xFF0C;&#x76F4;&#x5230;&#x8FBE;&#x5230;&#x57FA;&#x672C;&#x60C5;&#x51B5;&#x3002;</strong></p>
<p>&#x2003;&#x2003;&#x5728;&#x6211;&#x4EEC;&#x5229;&#x7528;&#x4EE5;&#x4E0A;&#x8BA1;&#x7B97;&#x6A21;&#x578B;&#x5F97;&#x51FA;&#x9012;&#x5F52;&#x7684;&#x6700;&#x7EC8;&#x7ED3;&#x679C;&#x65F6;&#xFF0C;&#x4E5F;&#x53EF;<strong>&#x5C06;&#x9012;&#x5F52;&#x8C03;&#x7528;&#x770B;&#x4F5C;&#x51FD;&#x6570;&#x62BD;&#x8C61;</strong>&#x3002;&#x5728;&#x9636;&#x4E58;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x5173;&#x5FC3;<span class="math inline">\(fact(n-1)\)</span>&#x662F;&#x600E;&#x4E48;&#x8BA1;&#x7B97;&#x51FA;&#x6765;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x7B80;&#x5355;&#x5730;&#x76F8;&#x4FE1;&#x5B83;&#x8BA1;&#x7B97;&#x7684;&#x662F;<span class="math inline">\(n-1\)</span>&#x7684;&#x9636;&#x4E58;&#x3002;&#x8FD9;&#x79CD;&#x5BF9;&#x9012;&#x5F52;&#x51FD;&#x6570;&#x7684;&#x770B;&#x6CD5;&#x88AB;&#x79F0;&#x4F5C;<span class="math inline">\(recursive\;leap\;of\;faith\)</span>&#xFF0C;&#x5373;<strong>&#x6211;&#x4EEC;&#x76F8;&#x4FE1;&#x9012;&#x5F52;&#x8C03;&#x7528;&#x7B80;&#x5355;&#x60C5;&#x51B5;&#x65F6;&#x51FD;&#x6570;&#x4F1A;&#x5F97;&#x51FA;&#x6B63;&#x786E;&#x7ED3;&#x679C;&#xFF0C;&#x5728;&#x8FD9;&#x4E2A;&#x8BA4;&#x77E5;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x53BB;&#x8BA1;&#x7B97;&#x590D;&#x6742;&#x60C5;&#x51B5;</strong>&#x3002;&#x4F8B;&#x5982;&#x8BA1;&#x7B97;&#x9636;&#x4E58;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x76F8;&#x4FE1;<span class="math inline">\(fact(n-1)\)</span>&#x80FD;&#x6B63;&#x786E;&#x8BA1;&#x7B97;&#x51FA;<span class="math inline">\((n-1)!\)</span>&#xFF0C;<strong>&#x53EA;&#x9700;&#x68C0;&#x67E5;<span class="math inline">\(n!\)</span>&#x5728;&#x8FD9;&#x4E2A;&#x5047;&#x8BBE;&#x6210;&#x7ACB;&#x4E0B;&#x662F;&#x5426;&#x80FD;&#x5F97;&#x5230;&#x6B63;&#x786E;&#x8BA1;&#x7B97;</strong>&#x3002;&#x901A;&#x8FC7;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#xFF0C;&#x9A8C;&#x8BC1;&#x9012;&#x5F52;&#x51FD;&#x6570;&#x7684;&#x6B63;&#x786E;&#x6027;&#x662F;&#x4E00;&#x79CD;<strong>&#x6570;&#x5B66;&#x5F52;&#x7EB3;&#x6CD5;</strong>&#x3002;</p>
<h3 id="3&#x9012;&#x5F52;&#x4E0E;&#x5FAA;&#x73AF;&#x51FD;&#x6570;&#x7684;&#x533A;&#x522B;">3.&#x9012;&#x5F52;&#x4E0E;&#x5FAA;&#x73AF;&#x51FD;&#x6570;&#x7684;&#x533A;&#x522B;</h3>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x4EE5;&#x9636;&#x4E58;&#x51FD;&#x6570;&#x7684;&#x5FAA;&#x73AF;&#x5199;&#x6CD5;&#x4E3A;&#x4F8B;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">fact_iter</span>(<span class="params">n</span>):</span><br><span class="line">        total, k = <span class="number">1</span>, <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> k &lt;= n:</span><br><span class="line">            total, k = total * k, k + <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> total</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x4ECE;&#x4E24;&#x4E2A;&#x89D2;&#x5EA6;&#x770B;&#x5F85;&#x5B83;&#x4EEC;&#x7684;&#x533A;&#x522B;&#xFF1A;</p>
<h4 id="a&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#xFF1A;</h4>
<p>&#x2003;&#x2003;&#x9636;&#x4E58;&#x7684;&#x5FAA;&#x73AF;&#x5199;&#x6CD5;&#x662F;&#x901A;&#x8FC7;&#x9010;&#x9879;&#x76F8;&#x4E58;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x800C;&#x9636;&#x4E58;&#x7684;&#x9012;&#x5F52;&#x5199;&#x6CD5;&#x662F;&#x901A;&#x8FC7;&#x5F53;&#x524D;&#x9879;<span class="math inline">\(fact(n)\)</span>&#x4E0E;&#x524D;&#x4E00;&#x9879;<span class="math inline">\(fact(n-1)\)</span>&#x7684;&#x5173;&#x7CFB;&#x5B9E;&#x73B0;&#x7684;&#x3002;</p>
<h4 id="b&#x8C03;&#x7528;&#x53C2;&#x6570;">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>&#x8C03;&#x7528;&#x53C2;&#x6570;</h4>
<p>&#x2003;&#x2003;&#x9636;&#x4E58;&#x7684;&#x5FAA;&#x73AF;&#x5199;&#x6CD5;&#x9700;&#x8981;&#x8C03;&#x7528;&#x4E24;&#x4E2A;&#x989D;&#x5916;&#x53C2;&#x6570;<span class="math inline">\(total,k\)</span>&#xFF0C;&#x800C;&#x9012;&#x5F52;&#x5219;&#x6CA1;&#x6709;&#x8FD9;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#x3002;&#x5728;&#x9012;&#x5F52;&#x4E2D;&#xFF0C;<span class="math inline">\(fact(n)\)</span>&#x672C;&#x8EAB;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x53CA;&#x76F8;&#x5F53;&#x4E8E;&#x5FAA;&#x73AF;&#x4E2D;&#x7684;<span class="math inline">\(total\)</span>&#xFF0C;&#x800C;<span class="math inline">\(n\)</span>&#x5219;&#x7528;&#x6765;&#x9690;&#x5F0F;&#x5730;&#x8DDF;&#x8E2A;<span class="math inline">\(n!\)</span>&#x8BA1;&#x7B97;&#x5230;&#x54EA;&#x4E00;&#x6B65;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x5FAA;&#x73AF;&#x4E2D;&#x7684;<span class="math inline">\(k\)</span>&#x3002;</p>
<h2 id="&#x4E8C;-&#x76F8;&#x4E92;&#x9012;&#x5F52;&#x8C03;&#x7528;">&#x4E8C;&#x3001;&#x76F8;&#x4E92;&#x9012;&#x5F52;&#x8C03;&#x7528;</h2>
<h3 id="1&#x6982;&#x5FF5;">1.&#x6982;&#x5FF5;</h3>
<p>&#x2003;&#x2003;&#x5F53;&#x4E00;&#x4E2A;&#x9012;&#x5F52;&#x8FC7;&#x7A0B;&#x5206;&#x4E3A;<strong>&#x4E24;&#x4E2A;&#x76F8;&#x4E92;&#x8C03;&#x7528;&#x7684;&#x51FD;&#x6570;</strong>&#x65F6;&#xFF0C;&#x8FD9;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#x88AB;&#x79F0;&#x4E3A;&#x76F8;&#x4E92;&#x9012;&#x5F52;&#x7684;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5BF9;&#x4E8E;<strong>&#x591A;&#x4E3B;&#x4F53;</strong>&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5229;&#x7528;&#x76F8;&#x4E92;&#x9012;&#x5F52;&#x8C03;&#x7528;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x5F88;&#x5B8C;&#x7F8E;&#x7684;&#x89E3;&#x51B3;&#x3002;</p>
<h3 id="2&#x5B9E;&#x4F8B;&#x8BB2;&#x89E3;">2.&#x5B9E;&#x4F8B;&#x8BB2;&#x89E3;</h3>
<p>&#x2003;&#x2003;<span class="math inline">\(e.g.1.\)</span>&#x8003;&#x8651;&#x5982;&#x4E0B;&#x6240;&#x8FF0;&#x5BF9;&#x4E8E;&#x5947;&#x5076;&#x7684;&#x5B9A;&#x4E49;&#xFF1A;</p>
<ul>
<li><span class="math inline">\(0\)</span>&#x4E3A;&#x5076;&#x6570;</li>
<li>&#x82E5;<span class="math inline">\(n-1\)</span>&#x4E3A;&#x5076;&#x6570;&#xFF0C;&#x5219;<span class="math inline">\(n\)</span>&#x4E3A;&#x5947;&#x6570;</li>
<li>&#x82E5;<span class="math inline">\(n-1\)</span>&#x4E3A;&#x5947;&#x6570;&#xFF0C;&#x5219;<span class="math inline">\(n\)</span>&#x4E3A;&#x5076;&#x6570; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">is_even</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">if</span>(n==<span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> is_odd(n-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_odd</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">if</span>(n==<span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> is_even(n-<span class="number">1</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<p>&#x2003;&#x2003;<span class="math inline">\(p.s.\)</span>&#x901A;&#x8FC7;<strong>&#x6253;&#x7834;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#x4E4B;&#x95F4;&#x7684;&#x62BD;&#x8C61;&#x8FB9;&#x754C;</strong>&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x76F8;&#x4E92;&#x9012;&#x5F52;&#x7684;&#x51FD;&#x6570;&#x8F6C;&#x6362;&#x4E3A;&#x5355;&#x4E2A;&#x9012;&#x5F52;&#x51FD;&#x6570;&#x3002;&#x5982;&#x4E0A;&#x8FF0;&#x51FD;&#x6570;&#x53EF;&#x5982;&#x4E0B;&#x6539;&#x5199;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">is_even</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> (n-<span class="number">1</span>) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> is_even((n-<span class="number">1</span>)-<span class="number">1</span>)</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;<span class="math inline">\(e.g.2.\)</span>&#x8003;&#x8651;&#x4E00;&#x4E2A;&#x4E24;&#x4EBA;&#x535A;&#x5F08;&#xFF0C;&#x5728;&#x8FD9;&#x4E2A;&#x535A;&#x5F08;&#x4E2D;&#xFF0C;&#x4E00;&#x5F20;&#x684C;&#x5B50;&#x4E0A;&#x6709;
<span class="math inline">\(n\)</span>&#x4E2A;&#x521D;&#x59CB;&#x5375;&#x77F3;&#x3002;&#x73A9;&#x5BB6;&#x8F6E;&#x6D41;&#x4ECE;&#x684C;&#x5B50;&#x4E0A;&#x79FB;&#x8D70;&#x4E00;&#x4E2A;&#x6216;&#x4E24;&#x4E2A;&#x9E45;&#x5375;&#x77F3;&#xFF0C;&#x79FB;&#x8D70;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x9E45;&#x5375;&#x77F3;&#x7684;&#x73A9;&#x5BB6;&#x83B7;&#x80DC;&#x3002;&#x5047;&#x8BBE;&#x7231;&#x4E3D;&#x4E1D;&#x548C;&#x9C8D;&#x52C3;&#x73A9;&#x8FD9;&#x4E2A;&#x6E38;&#x620F;&#xFF0C;&#x6BCF;&#x4E2A;&#x4EBA;&#x90FD;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x7B56;&#x7565;:</p>
<ul>
<li>&#x7231;&#x4E3D;&#x4E1D;&#x603B;&#x662F;&#x62FF;&#x8D70;&#x4E00;&#x5757;&#x9E45;&#x5375;&#x77F3;</li>
<li>&#x5982;&#x679C;&#x684C;&#x5B50;&#x4E0A;&#x7684;&#x9E45;&#x5375;&#x77F3;&#x6570;&#x91CF;&#x662F;&#x5076;&#x6570;&#xFF0C;&#x90A3;&#x4E48;&#x9C8D;&#x52C3;&#x5C31;&#x4F1A;&#x79FB;&#x9664;&#x4E24;&#x4E2A;&#x9E45;&#x5375;&#x77F3;&#xFF0C;&#x53E6;&#x4E00;&#x4E2A;&#x662F;&#x5076;&#x6570;</li>
</ul>
<p>&#x2003;&#x2003;&#x7ED9;&#x5B9A;<span class="math inline">\(n\)</span>&#x4E2A;&#x6700;&#x521D;&#x7684;&#x5375;&#x77F3;&#x548C;&#x7231;&#x4E3D;&#x4E1D;&#x5F00;&#x59CB;&#xFF0C;&#x8C01;&#x8D62;&#x5F97;&#x4E86;&#x6BD4;&#x8D5B;&#xFF1F;</p>
<p>&#x2003;&#x2003;<span class="math inline">\(solve\)</span>&#xFF1A;&#x8FD9;&#x91CC;&#x7231;&#x4E3D;&#x4E1D;&#x4E0E;&#x9C8D;&#x52C3;&#x662F;&#x4E0D;&#x540C;&#x4E3B;&#x4F53;&#xFF0C;&#x5206;&#x8BBE;&#x4E3A;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#x5373;&#x53EF;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">alice</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">if</span>(n==<span class="number">0</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Bob wins&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> bob(n-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bob</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">if</span>(n==<span class="number">0</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Alice wins&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> alice(n-<span class="number">1</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="&#x4E09;-&#x6811;&#x5F62;&#x9012;&#x5F52;">&#x4E09;&#x3001;&#x6811;&#x5F62;&#x9012;&#x5F52;</h2>
<h3 id="1&#x6811;&#x5F62;&#x9012;&#x5F52;&#x7684;&#x6982;&#x5FF5;">1.&#x6811;&#x5F62;&#x9012;&#x5F52;&#x7684;&#x6982;&#x5FF5;</h3>
<p>&#x2003;&#x2003;&#x6811;&#x5F62;&#x9012;&#x5F52;&#x662F;&#x4E00;&#x79CD;&#x5E38;&#x7528;&#x7684;&#x9012;&#x5F52;&#xFF0C;&#x5728;&#x6811;&#x5F62;&#x9012;&#x5F52;&#x4E2D;&#xFF0C;&#x9012;&#x5F52;&#x51FD;&#x6570;&#x88AB;&#x8C03;&#x7528;&#x4E0D;&#x6B62;&#x4E00;&#x6B21;&#x3002;</p>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x4EE5;&#x6590;&#x6CE2;&#x90A3;&#x5951;&#x6570;&#x5217;&#x7684;&#x9012;&#x5F52;&#x6C42;&#x89E3;&#x4E3A;&#x4F8B;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">fib</span>(<span class="params">n</span>):</span><br><span class="line">	<span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">	    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">	<span class="keyword">if</span> n == <span class="number">2</span>:</span><br><span class="line">	    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> fib(n-<span class="number">2</span>) + fib(n-<span class="number">1</span>)</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x9012;&#x5F52;&#x7684;&#x5199;&#x6CD5;&#x4E0E;&#x6590;&#x6CE2;&#x90A3;&#x5951;&#x7684;&#x5B9A;&#x4E49;<span class="math inline">\(Fib_n=Fib_{n-1}+Fib_{n-2}\)</span>&#x662F;&#x5B8C;&#x5168;&#x5951;&#x5408;&#x7684;&#x3002;</p>
<h3 id="2&#x5B9E;&#x4F8B;&#x8BB2;&#x89E3;">2.&#x5B9E;&#x4F8B;&#x8BB2;&#x89E3;</h3>
<p>&#x2003;&#x2003;<span class="math inline">\(e.g.1.\)</span>&#x5C06;<span class="math inline">\(n\)</span>&#x5206;&#x89E3;&#x4E3A;&#x67D0;&#x4E2A;&#x5355;&#x8C03;&#x9012;&#x589E;&#x7684;&#x5E8F;&#x5217;&#xFF0C;&#x4E14;&#x5E8F;&#x5217;&#x4E2D;&#x6570;&#x7684;&#x6700;&#x5927;&#x503C;&#x4E0D;&#x8D85;&#x8FC7;<span class="math inline">\(m\)</span>&#x3002;&#x7ED9;&#x51FA;<span class="math inline">\(n,m\)</span>&#xFF0C;&#x6C42;&#x51FA;&#x6EE1;&#x8DB3;&#x6761;&#x4EF6;&#x5E8F;&#x5217;&#x7684;&#x6570;&#x91CF;&#x3002;</p>
<p>&#x2003;&#x2003;<span class="math inline">\(solve\)</span>&#xFF1A;&#x6211;&#x4EEC;&#x8003;&#x8651;&#x4E0B;&#x9762;&#x4E24;&#x4EF6;&#x4E8B;&#xFF1A;</p>
<ol type="1">
<li><p>&#x5206;&#x7EC4;&#x65B9;&#x6CD5;&#xFF1A;&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x4E0D;&#x91CD;&#x4E0D;&#x6F0F;&#xFF0C;&#x6211;&#x4EEC;&#x4ECE;&#x5E8F;&#x5217;&#x4E2D;&#x6700;&#x5927;&#x503C;<span class="math inline">\(m\)</span>&#x5165;&#x624B;&#xFF0C;&#x53EF;&#x5206;&#x4E3A;&#x4EE5;&#x4E0B;&#x60C5;&#x51B5;&#xFF1A;</p>
<ul>
<li>&#x9009;&#x4E00;&#x4E2A;<span class="math inline">\(m\)</span>&#xFF0C;&#x7136;&#x540E;&#x5BF9;<span class="math inline">\(n-m\)</span>&#x6267;&#x884C;&#x76F8;&#x540C;&#x64CD;&#x4F5C;</li>
<li>&#x4E0D;&#x9009;<span class="math inline">\(m\)</span>&#xFF0C;&#x6B64;&#x65F6;&#x5E8F;&#x5217;&#x4E2D;&#x6700;&#x5927;&#x503C;&#x53D8;&#x4E3A;<span class="math inline">\(m-1\)</span>&#xFF0C;&#x7136;&#x540E;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x76F8;&#x540C;&#x64CD;&#x4F5C;</li>
</ul></li>
<li><p>&#x57FA;&#x672C;&#x60C5;&#x51B5;&#xFF1A;</p>
<ul>
<li><code>n==0</code>&#xFF1A;<span class="math inline">\(return
1\)</span></li>
<li><code>n&lt;0</code>&#xFF1A;<span class="math inline">\(return
0\)</span></li>
<li><code>m==0</code>&#xFF1A;<span class="math inline">\(return
0\)</span></li>
</ul></li>
</ol>
<p>&#x2003;&#x2003;&#x4E8E;&#x662F;&#x53EF;&#x5199;&#x51FA;&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">div</span>(<span class="params">n,m</span>):</span><br><span class="line">    <span class="keyword">if</span> n==<span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> n&lt;<span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> m==<span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> div(n-m,m)+div(n,m-<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
&#x2003;&#x2003;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x628A;&#x4E00;&#x4E2A;&#x6811;&#x5F62;&#x9012;&#x5F52;&#x51FD;&#x6570;&#x770B;&#x4F5C;&#x662F;&#x5728;<strong>&#x63A2;&#x7D22;&#x4E0D;&#x540C;&#x7684;&#x53EF;&#x80FD;&#x6027;</strong>&#x3002;&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x63A2;&#x7D22;&#x4E86;&#x4F7F;&#x7528;<span class="math inline">\(m\)</span>&#x7684;&#x53EF;&#x80FD;&#x6027;&#x4EE5;&#x53CA;&#x4E0D;&#x4F7F;&#x7528;&#x7684;&#x53EF;&#x80FD;&#x6027;&#x3002;&#x7B2C;&#x4E00;&#x4E2A;&#x548C;&#x7B2C;&#x4E8C;&#x4E2A;&#x9012;&#x5F52;&#x8C03;&#x7528;&#x5BF9;&#x5E94;&#x4E8E;&#x8FD9;&#x4E9B;&#x53EF;&#x80FD;&#x6027;&#x3002;</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/10.1.Binary%20Search%20Trees/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/10.1.Binary%20Search%20Trees/" class="post-title-link" itemprop="url">10.1.&#x4E8C;&#x53C9;&#x641C;&#x7D22;&#x6811;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 18:06:20" itemprop="dateModified" datetime="2024-06-02T18:06:20+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/10-Trees/" itemprop="url" rel="index"><span itemprop="name">10.Trees</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>670</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="101&#x4E8C;&#x53C9;&#x641C;&#x7D22;&#x6811;"><span class="math inline">\(10.1\)</span>&#x4E8C;&#x53C9;&#x641C;&#x7D22;&#x6811;</h1>
<h3 id="1bst&#x76F8;&#x5173;&#x6982;&#x5FF5;">1.<span class="math inline">\(BST\)</span>&#x76F8;&#x5173;&#x6982;&#x5FF5;</h3>
<ul>
<li>The tree is made up of <span class="math inline">\(nodes\)</span>
that contain <span class="math inline">\(links\)</span> that are either
<span class="math inline">\(null\)</span> or references to other
nodes.</li>
<li>Every node is pointed to by just one other node, which is called its
<span class="math inline">\(parent\)</span> (except for one node, the
<span class="math inline">\(root\)</span>, which has no nodes pointing
to it).</li>
<li>Each node has exactly two links, which are called its <span class="math inline">\(left\)</span> and <span class="math inline">\(right\)</span> links, that point to nodes called
its <span class="math inline">\(left child\)</span> and <span class="math inline">\(right child\)</span>.</li>
<li>we can define a binary tree as a either a null link or a node with a
left link and a right link, each references to (disjoint) subtrees that
are themselves <span class="math inline">\(binary trees\)</span>. In a
binary search tree, each node also has a key and a value, with an
ordering restriction to support efficient search</li>
</ul>
<p><img src="/2024/05/31/10.1.Binary%20Search%20Trees/image.png"></p>
<p>&#x2003;&#x2003;<span class="math inline">\(BST\)</span>&#x4E5F;&#x9075;&#x5FAA;&#x5982;&#x4E0B;&#x7684;&#x6027;&#x8D28;&#xFF1A;</p>
<p><img src="/2024/05/31/10.1.Binary%20Search%20Trees/image-1.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">BST</span>&lt;Key&gt; {</span><br><span class="line">    <span class="keyword">private</span> Key key;</span><br><span class="line">    <span class="keyword">private</span> BST left;</span><br><span class="line">    <span class="keyword">private</span> BST right;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BST</span><span class="params">(Key key, BST lf, BST rt)</span> {</span><br><span class="line">        <span class="built_in">this</span>.key = key;</span><br><span class="line">        <span class="built_in">this</span>.left = lf;</span><br><span class="line">        <span class="built_in">this</span>.right = rt;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BST</span><span class="params">(Key key)</span> {</span><br><span class="line">        <span class="built_in">this</span>.key = key;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="2bst&#x64CD;&#x4F5C;">2.<span class="math inline">\(BST\)</span>&#x64CD;&#x4F5C;</h3>
<h4 id="afind">&#x2003;&#x2003;<span class="math inline">\(a.\)</span><code>find</code></h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> BST <span class="title function_">find</span><span class="params">(BST T, Key sk)</span> {</span><br><span class="line">    <span class="keyword">if</span> (T == <span class="literal">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (sk.equals(T.key)) {</span><br><span class="line">        <span class="keyword">return</span> T;</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (sk &lt; T.key) {</span><br><span class="line">        <span class="keyword">return</span> find(T.left, sk);</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">return</span> find(T.right, sk);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h4 id="binsert">&#x2003;&#x2003;<span class="math inline">\(b.\)</span><code>insert</code></h4>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x6C38;&#x8FDC;&#x53EA;&#x63D2;&#x5165;&#x5DE6;&#x8282;&#x70B9;&#xFF01; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> BST <span class="title function_">insert</span><span class="params">(BST T, Key sk)</span> {</span><br><span class="line">    <span class="keyword">if</span> (T == <span class="literal">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BST</span>(sk);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (sk &lt; T.key) {</span><br><span class="line">        T.left = insert(T.left, sk);</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (sk &gt; T.key) {</span><br><span class="line">        T.right = insert(T.right, sk);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> T;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h4 id="cdelete">&#x2003;&#x2003;<span class="math inline">\(c.\)</span><code>delete</code></h4>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5C06;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x66FF;&#x4EE3;&#x4E3A;&#x5B83;&#x7684;&#x540E;&#x7EE7;&#x8282;&#x70B9;&#xFF0C;&#x6765;&#x5B9E;&#x73B0;&#x8BE5;&#x8282;&#x70B9;&#x7684;&#x5220;&#x9664;&#x3002;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x7684;&#x540E;&#x7EE7;&#x8282;&#x70B9;(<span class="math inline">\(successor\)</span>)&#x662F;&#x5B83;&#x53F3;&#x5B50;&#x6811;&#x7684;&#x6700;&#x5C0F;&#x8282;&#x70B9;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#x5B9E;&#x73B0;<code>delete</code>&#xFF1A;</p>
<ol type="1">
<li>&#x4FDD;&#x5B58;&#x5F85;&#x5220;&#x9664;&#x8282;&#x70B9;(<span class="math inline">\(x\)</span>)&#x7684;&#x94FE;&#x63A5;(<span class="math inline">\(link\)</span>)&#x3002;</li>
<li>&#x8BA9;<span class="math inline">\(x\)</span>&#x6307;&#x5411;&#x540E;&#x7EE7;&#x8282;&#x70B9;(<span class="math inline">\(y\)</span>)&#x3002;</li>
<li>&#x5C06;<span class="math inline">\(x\)</span>&#x7684;&#x53F3;&#x94FE;&#x63A5;&#x6307;&#x5411;<code>deleteMin(t.right)</code>&#xFF0C;&#x5176;&#x4E2D;<code>deleteMin</code>&#x4F1A;&#x8FD4;&#x56DE;&#x6307;&#x5411;&#x53F3;&#x5B50;&#x6811;&#x7684;&#x94FE;&#x63A5;&#xFF0C;&#x800C;&#x53F3;&#x5B50;&#x6811;&#x4E2D;&#x6240;&#x6709;&#x5143;&#x7D20;&#x90FD;&#x5927;&#x4E8E;(<span class="math inline">\(x\)</span>)&#x3002;</li>
<li>&#x8BA9;&#x540E;&#x7EE7;&#x8282;&#x70B9;&#x7684;&#x5DE6;&#x94FE;&#x63A5;&#x6307;&#x5411;<span class="math inline">\(x\)</span>&#x7684;&#x5DE6;&#x5B50;&#x6811;&#x3002;</li>
</ol>
<p>&#x2003;&#x2003;&#x4E0B;&#x9762;&#x662F;&#x8BE5;&#x8FC7;&#x7A0B;&#x7684;&#x56FE;&#x793A;&#xFF1A;</p>
<p><img src="/2024/05/31/10.1.Binary%20Search%20Trees/image-2.png"></p>
<p>&#x2003;&#x2003;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x5206;&#x90E8;&#x5B9E;&#x73B0;<code>delete</code>&#x64CD;&#x4F5C;&#x3002;</p>
<h5 id="ideletemin">&#x2003;&#x2003;<span class="math inline">\(i.\)</span><code>deleteMin</code></h5>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5982;&#x4E0B;&#x65B9;&#x5F0F;&#x9012;&#x5F52;&#x5B9E;&#x73B0;<code>deleteMin</code>&#xFF1A;</p>
<ol type="1">
<li>&#x627E;&#x5230;&#x6700;&#x5C0F;&#x7684;&#x8282;&#x70B9;&#xFF0C;&#x7136;&#x540E;&#x8FD4;&#x56DE;&#x5B83;&#x7684;&#x7236;&#x4EB2;&#x7684;&#x53F3;&#x513F;&#x5B50;(&#x628A;&#x6307;&#x5411;&#x5B83;&#x7684;&#x94FE;&#x63A5;&#x7ED9;&#x5FFD;&#x7565;&#x6389;&#x4E86;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x76F8;&#x5F53;&#x4E8E;&#x5220;&#x6389;&#x8FD9;&#x4E2A;&#x5143;&#x7D20;&#x4E86;)&#x3002;</li>
<li>&#x628A;&#x7236;&#x8282;&#x70B9;&#x7684;&#x5DE6;&#x94FE;&#x63A5;&#x6307;&#x5411;&#x8FD4;&#x56DE;&#x7684;&#x8282;&#x70B9;&#x3002;</li>
<li>&#x66F4;&#x65B0;&#x5B50;&#x6811;&#x7684;&#x5927;&#x5C0F;&#x3002; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteMin</span><span class="params">()</span> {</span><br><span class="line">    root = deleteMin(root);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">deleteMin</span><span class="params">(Node p)</span> {</span><br><span class="line">    <span class="keyword">if</span> (p.left == <span class="literal">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> p.right;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    p.left = deleteMin(p.left);</span><br><span class="line">    p.size = p.left.size + p.right.size + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="ii&#x6700;&#x5C0F;&#x8282;&#x70B9;">&#x2003;&#x2003;<span class="math inline">\(ii.\)</span>&#x6700;&#x5C0F;&#x8282;&#x70B9;</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Node <span class="title function_">min</span><span class="params">(Node p)</span> {</span><br><span class="line">    <span class="keyword">if</span> (p.left == <span class="literal">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> min(p.left);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h5 id="iiidelete&#x64CD;&#x4F5C;">&#x2003;&#x2003;<span class="math inline">\(iii\)</span><code>delete</code>&#x64CD;&#x4F5C;</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(Key key)</span> {</span><br><span class="line">    root = delete(root, key);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Node <span class="title function_">delete</span><span class="params">(Node p, Key key)</span> {</span><br><span class="line">    <span class="keyword">if</span> (p == <span class="literal">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">cmp</span> <span class="operator">=</span> key.compareTo(p.key);</span><br><span class="line">    <span class="keyword">if</span> (cmp &gt; <span class="number">0</span>) {</span><br><span class="line">        p.right = delete(p.right, key);</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (cmp &lt; <span class="number">0</span>) {</span><br><span class="line">        p.left = delete(p.left, key);</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="comment">// solve the one-node condition.</span></span><br><span class="line">        <span class="keyword">if</span> (p.right == <span class="literal">null</span>) <span class="keyword">return</span> p.left;</span><br><span class="line">        <span class="keyword">if</span> (p.left == <span class="literal">null</span>) <span class="keyword">return</span> p.right;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//store the to-delete node, so that we can connect its subtree.</span></span><br><span class="line">        <span class="type">Node</span> <span class="variable">t</span> <span class="operator">=</span> p;</span><br><span class="line">        p = min(t.right);</span><br><span class="line">        p.right = deleteMin(t.right);</span><br><span class="line">        p.left = t.left;</span><br><span class="line">    }</span><br><span class="line">    p.size = p.left.size + p.right.size + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/11.1%20Some%20concepts/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/11.1%20Some%20concepts/" class="post-title-link" itemprop="url">11.1.&#x4E00;&#x4E9B;&#x6982;&#x5FF5;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 18:12:07" itemprop="dateModified" datetime="2024-06-02T18:12:07+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/11-Balanced-Trees/" itemprop="url" rel="index"><span itemprop="name">11.Balanced Trees</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>228</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="111&#x4E00;&#x4E9B;&#x6982;&#x5FF5;"><span class="math inline">\(11.1\)</span>&#x4E00;&#x4E9B;&#x6982;&#x5FF5;</h1>
<h3 id="1o&#x4E0E;&#x6700;&#x574F;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x7684;&#x533A;&#x522B;">1.<span class="math inline">\(O()\)</span>&#x4E0E;&#x6700;&#x574F;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x7684;&#x533A;&#x522B;</h3>
<p>&#x2003;&#x2003;&#x5927;<span class="math inline">\(O\)</span>&#x4E0D;&#x7B49;&#x4E8E;&#x6700;&#x574F;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#xFF01;<span class="math inline">\(O\)</span>&#x8868;&#x793A;&#x7684;&#x662F;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x7684;&#x4E0A;&#x754C;&#xFF0C;&#x53EA;&#x8981;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x5C0F;&#x4E8E;<span class="math inline">\(O(times)\)</span>&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x5C31;&#x7B97;&#x5728;<span class="math inline">\(O\)</span>&#x5185;&#x3002;&#x6700;&#x574F;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x6BD4;<span class="math inline">\(O\)</span>&#x66F4;&#x4E3A;&#x4E25;&#x82DB;&#xFF0C;&#x56E0;&#x4E3A;&#x5BF9;&#x4E8E;&#x6700;&#x574F;&#x8FD0;&#x884C;&#x65F6;&#x95F4;<span class="math inline">\(worst_time\)</span>&#xFF0C;&#x51FD;&#x6570;&#x5FC5;&#x987B;&#x80FD;&#x53D6;&#x5230;&#x8FD9;&#x4E2A;&#x65F6;&#x95F4;&#x3001;&#x800C;&#x975E;&#x4EC5;&#x4EC5;&#x5C0F;&#x4E8E;&#x7B49;&#x4E8E;&#x8FD9;&#x4E2A;&#x65F6;&#x95F4;&#x3002;</p>
<h3 id="2&#x5BF9;bst&#x6027;&#x80FD;&#x7684;&#x8861;&#x91CF;">2.&#x5BF9;<span class="math inline">\(BST\)</span>&#x6027;&#x80FD;&#x7684;&#x8861;&#x91CF;</h3>
<p>&#x2003;&#x2003;<span class="math inline">\(BST\)</span>&#x6027;&#x80FD;&#x7684;&#x8861;&#x91CF;&#x9700;&#x8981;&#x8003;&#x8651;&#x4EE5;&#x4E0B;&#x6982;&#x5FF5;&#xFF1A;</p>
<ul>
<li>&#x6DF1;&#x5EA6;(<span class="math inline">\(depth\)</span>)&#xFF1A;&#x8282;&#x70B9;&#x5230;&#x6811;&#x6839;&#x95F4;&#x94FE;&#x63A5;&#x7684;&#x6570;&#x91CF;&#x3002;</li>
<li>&#x9AD8;&#x5EA6;(<span class="math inline">\(height\)</span>)&#xFF1A;&#x6811;&#x7684;&#x6700;&#x5927;&#x6DF1;&#x5EA6;&#x3002;</li>
<li>&#x5E73;&#x5747;&#x6DF1;&#x5EA6;(<span class="math inline">\(average\)</span>)&#xFF1A;&#x6811;&#x6240;&#x6709;&#x6DF1;&#x5EA6;&#x7684;&#x5E73;&#x5747;&#x503C;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;<span class="math inline">\({\sum_{i=0}^D d_in_i}\over N\)</span>&#xFF0C;<span class="math inline">\(d_i\)</span>&#x4EE3;&#x8868;&#x6DF1;&#x5EA6;&#xFF0C;<span class="math inline">\(n_i\)</span>&#x4EE3;&#x8868;&#x8282;&#x70B9;&#x7684;&#x6570;&#x5B57;&#x3002;</li>
</ul>
<p>&#x2003;&#x2003;<span class="math inline">\(BST\)</span>&#x7684;&#x9AD8;&#x5EA6;&#x4EE3;&#x8868;&#x4E86;&#x5B83;&#x7684;&#x6700;&#x574F;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#xFF0C;&#x800C;&#x5E73;&#x5747;&#x6DF1;&#x5EA6;&#x51B3;&#x5B9A;&#x4E86;&#x5B83;&#x7684;&#x5E73;&#x5747;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x3002;</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/11.2%20B-Trees/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/11.2%20B-Trees/" class="post-title-link" itemprop="url">11.2.B&#x6811;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 18:16:52" itemprop="dateModified" datetime="2024-06-02T18:16:52+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/11-Balanced-Trees/" itemprop="url" rel="index"><span itemprop="name">11.Balanced Trees</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>491</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="112b&#x6811;"><span class="math inline">\(11.2\)</span><span class="math inline">\(B\)</span>&#x6811;</h1>
<h3 id="1b&#x6811;&#x7684;&#x5F15;&#x5165;">1.<span class="math inline">\(B\)</span>&#x6811;&#x7684;&#x5F15;&#x5165;</h3>
<p>&#x2003;&#x2003;&#x5BFC;&#x81F4;<span class="math inline">\(BST\)</span>&#x6700;&#x574F;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x7684;&#x539F;&#x56E0;&#x662F;&#xFF1A;&#x6BCF;&#x6B21;<code>insert</code>&#x64CD;&#x4F5C;&#xFF0C;&#x6211;&#x4EEC;&#x90FD;&#x9009;&#x62E9;&#x5728;&#x53F6;&#x5B50;&#x4E0A;&#x8FDB;&#x884C;&#xFF0C;&#x8FD9;&#x5BFC;&#x81F4;&#x4E86;&#x6811;&#x7684;&#x9AD8;&#x5EA6;&#x7684;&#x589E;&#x52A0;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x4E00;&#x4E2A;&#x81EA;&#x7136;&#x7684;&#x60F3;&#x6CD5;&#x662F;&#xFF1A;&#x80FD;&#x5426;&#x5728;&#x4E0D;&#x589E;&#x52A0;&#x6811;&#x7684;&#x9AD8;&#x5EA6;&#x7684;&#x524D;&#x63D0;&#x4E0B;&#x63D2;&#x5165;&#x8282;&#x70B9;&#x3002;</p>
<p>&#x2003;&#x2003;&#x4E3A;&#x4E86;&#x8FBE;&#x5230;&#x8FD9;&#x4E2A;&#x76EE;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x4E00;&#x4E2A;&#x53F6;&#x5B50;&#x4E2D;&#x63D2;&#x5165;&#x591A;&#x4E2A;&#x8282;&#x70B9;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x4E0D;&#x4F1A;&#x5BFC;&#x81F4;&#x53F6;&#x5B50;&#x9AD8;&#x5EA6;&#x7684;&#x589E;&#x52A0;&#x4E86;&#x3002;</p>
<p>&#x2003;&#x2003;&#x4F46;&#x5982;&#x679C;&#x65E0;&#x9650;&#x5236;&#x5730;&#x5728;&#x4E00;&#x4E2A;&#x53F6;&#x5B50;&#x4E2D;&#x63D2;&#x5165;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x53F6;&#x5B50;&#x5C31;&#x4F1A;&#x9000;&#x5316;&#x6210;&#x4E00;&#x4E2A;&#x94FE;&#x8868;&#x4E86;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5BF9;&#x5355;&#x4E2A;&#x53F6;&#x5B50;&#x80FD;&#x591F;&#x88C5;&#x5165;&#x8282;&#x70B9;&#x7684;&#x6570;&#x91CF;&#x8BBE;&#x7F6E;&#x9650;&#x5EA6;(<span class="math inline">\(limit\)</span>)&#xFF0C;&#x4F8B;&#x5982;<span class="math inline">\(4\)</span>&#x3002;&#x5F53;&#x53F6;&#x5B50;&#x4E2D;&#x8282;&#x70B9;&#x4E2A;&#x6570;&#x8D85;&#x8FC7;<span class="math inline">\(4\)</span>&#x4E2A;&#x65F6;&#xFF0C;&#x5C31;&#x901A;&#x8FC7;&#x5F39;&#x51FA;&#x4E2D;&#x95F4;&#x7684;&#x8282;&#x70B9;&#xFF0C;&#x628A;&#x8FD9;&#x4E2A;&#x53F6;&#x5B50;&#x5206;&#x5F00;(<span class="math inline">\(split\)</span>)&#x3002;</p>
<h3 id="22-3&#x641C;&#x7D22;&#x6811;">2.<span class="math inline">\(2-3\)</span>&#x641C;&#x7D22;&#x6811;</h3>
<p>&#x2003;&#x2003;&#x4E00;&#x68F5;<span class="math inline">\(2-3\)</span>&#x641C;&#x7D22;&#x6811;&#x662F;&#x6EE1;&#x8DB3;&#x5982;&#x4E0B;&#x6761;&#x4EF6;&#x7684;&#x6811;&#xFF1A;</p>
<ul>
<li>&#x7A7A;&#x7684;(<span class="math inline">\(empty\)</span>)&#x3002;</li>
<li>&#x4E00;&#x4E2A;&#x53F6;&#x5B50;&#x5B58;&#x50A8;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#xFF0C;&#x540C;&#x65F6;&#x6709;&#x4E24;&#x4E2A;&#x94FE;&#x63A5;(<span class="math inline">\(link\)</span>)&#xFF0C;&#x548C;<span class="math inline">\(BST\)</span>&#x7C7B;&#x4F3C;&#x3002;</li>
<li>&#x4E00;&#x4E2A;&#x53F6;&#x5B50;&#x5B58;&#x50A8;&#x4E8C;&#x4E2A;&#x8282;&#x70B9;&#xFF0C;&#x540C;&#x65F6;&#x6709;&#x4E09;&#x4E2A;&#x94FE;&#x63A5;&#x3002;&#x8BBE;&#x4E8C;&#x4E2A;&#x8282;&#x70B9;&#x5206;&#x522B;&#x4E3A;<span class="math inline">\(x,y\)</span>&#xFF0C;&#x5219;&#x4E09;&#x4E2A;&#x94FE;&#x63A5;&#x6240;&#x6307;&#x5411;&#x7684;&#x5176;&#x5B83;&#x53F6;&#x5B50;&#x5206;&#x522B;&#x6EE1;&#x8DB3;<span class="math inline">\(a_i\leq x,x\leq a_i\leq y,a_i\leq
y\)</span>&#x3002;</li>
</ul>
<p><img src="/2024/05/31/11.2%20B-Trees/image.png"></p>
<h3 id="3&#x67E5;&#x627E;&#x6D41;&#x7A0B;">3.&#x67E5;&#x627E;&#x6D41;&#x7A0B;</h3>
<p>&#x2003;&#x2003;<span class="math inline">\(2-3\)</span>&#x641C;&#x7D22;&#x6811;&#x67E5;&#x627E;&#x8282;&#x70B9;&#x7684;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="/2024/05/31/11.2%20B-Trees/image-1.png"></p>
<h3 id="4&#x63D2;&#x5165;&#x6D41;&#x7A0B;">4.&#x63D2;&#x5165;&#x6D41;&#x7A0B;</h3>
<p>&#x2003;&#x2003;<span class="math inline">\(2-3\)</span>&#x641C;&#x7D22;&#x6811;&#x63D2;&#x5165;&#x8282;&#x70B9;&#x7684;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;</p>
<ol type="1">
<li>&#x6211;&#x4EEC;&#x4ECD;&#x7136;&#x4E00;&#x76F4;&#x5728;&#x5DE6;&#x53F6;&#x5B50;&#x8FDB;&#x884C;&#x63D2;&#x5165;&#x64CD;&#x4F5C;&#x3002;</li>
<li>&#x5C06;&#x8282;&#x70B9;&#x63D2;&#x5165;&#x5BF9;&#x5E94;&#x7684;&#x53F6;&#x5B50;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x8BE5;&#x53F6;&#x5B50;&#x7684;&#x8282;&#x70B9;&#x4E2A;&#x6570;&#x5927;&#x4E8E;<span class="math inline">\(3\)</span>&#xFF0C;&#x5219;&#x5F39;&#x51FA;&#x4E2D;&#x95F4;&#x9760;&#x5DE6;&#x7684;&#x8282;&#x70B9;(&#x5982;&#x679C;&#x662F;&#x5947;&#x6570;&#x4E2A;&#x8282;&#x70B9;&#x5C31;&#x76F4;&#x63A5;&#x5F39;&#x51FA;&#x4E2D;&#x95F4;&#x7684;)&#xFF0C;&#x7136;&#x540E;&#x76F8;&#x5E94;&#x5730;&#x91CD;&#x65B0;&#x6392;&#x5217;&#x5B50;&#x6811;&#x3002;</li>
<li>&#x91CD;&#x590D;&#x4E0A;&#x8FF0;&#x6B65;&#x9AA4;&#xFF0C;&#x76F4;&#x5230;&#x627E;&#x5230;&#x4E00;&#x4E2A;&#x6709;&#x7A7A;&#x4F4D;&#x7684;&#x7236;&#x8282;&#x70B9;&#x6216;&#x8005;&#x904D;&#x5386;&#x5230;&#x6839;&#x8282;&#x70B9;&#x3002;</li>
</ol>
<p>&#x2003;&#x2003;&#x4E00;&#x4E9B;&#x63D2;&#x5165;&#x60C5;&#x51B5;&#x5BF9;&#x5E94;&#x7684;&#x56FE;&#x793A;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="/2024/05/31/11.2%20B-Trees/image-2.png"></p>
<p><img src="/2024/05/31/11.2%20B-Trees/image-3.png"></p>
<p>&#x2003;&#x2003;&#x5206;&#x5F00;&#x53F6;&#x5B50;&#x7684;&#x56FE;&#x793A;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="/2024/05/31/11.2%20B-Trees/image-4.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/11.3.%20B-Tree%20invariants/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/11.3.%20B-Tree%20invariants/" class="post-title-link" itemprop="url">11.3.B-&#x6811;&#x7684;&#x4E0D;&#x53D8;&#x91CF;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 18:11:21" itemprop="dateModified" datetime="2024-06-02T18:11:21+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/11-Balanced-Trees/" itemprop="url" rel="index"><span itemprop="name">11.Balanced Trees</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>233</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="113b-&#x6811;&#x7684;&#x4E0D;&#x53D8;&#x91CF;"><span class="math inline">\(11.3\)</span><span class="math inline">\(B\)</span>-&#x6811;&#x7684;&#x4E0D;&#x53D8;&#x91CF;</h1>
<h3 id="1b-&#x6811;&#x7684;&#x6027;&#x8D28;">1.<span class="math inline">\(B\)</span>-&#x6811;&#x7684;&#x6027;&#x8D28;</h3>
<p>&#x2003;&#x2003;&#x7531;&#x4E8E;<span class="math inline">\(B\)</span>-&#x6811;&#x4F1A;&#x5728;&#x53F6;&#x5B50;&#x5BB9;&#x91CF;&#x8FC7;&#x5927;&#x65F6;&#x5C06;&#x53F6;&#x5B50;&#x5BF9;&#x534A;&#x5206;&#x5F00;&#x3001;&#x7136;&#x540E;&#x91CD;&#x6784;&#x5B50;&#x6811;&#xFF0C;&#x8FD9;&#x4F7F;&#x5F97;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4EE5;&#x4EFB;&#x610F;&#x6B21;&#x5E8F;&#x63D2;&#x5165;&#x5143;&#x7D20;&#xFF0C;&#x800C;&#x4E0D;&#x7528;&#x62C5;&#x5FC3;&#x6700;&#x574F;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x7684;&#x53D1;&#x751F;&#x3002;</p>
<p>&#x2003;&#x2003;&#x4E00;&#x68F5;<span class="math inline">\(B\)</span>-&#x6811;&#x5177;&#x6709;&#x5982;&#x4E0B;&#x6709;&#x7528;&#x7684;&#x6027;&#x8D28;&#xFF1A;</p>
<ul>
<li>&#x6BCF;&#x4E2A;&#x53F6;&#x5B50;&#x5230;&#x5B83;&#x7684;&#x6E90;&#x5934;(<span class="math inline">\(source\)</span>)&#x7684;&#x8DDD;&#x79BB;&#x5FC5;&#x987B;&#x76F8;&#x7B49;&#x3002;</li>
<li>&#x4E00;&#x4E2A;&#x6709;<span class="math inline">\(k\)</span>&#x4E2A;&#x5143;&#x7D20;&#x7684;&#x975E;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#xFF0C;&#x5B83;&#x5FC5;&#x987B;&#x6709;<span class="math inline">\(k+1\)</span>&#x4E2A;&#x5B69;&#x5B50;&#x3002;</li>
</ul>
<h3 id="2b-&#x6811;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x5206;&#x6790;">2.<span class="math inline">\(B\)</span>-&#x6811;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x5206;&#x6790;</h3>
<p>&#x2003;&#x2003;<span class="math inline">\(B\)</span>-&#x6811;&#x7684;&#x6700;&#x574F;&#x8FD0;&#x884C;&#x60C5;&#x51B5;&#x662F;&#xFF1A;&#x5728;&#x6811;&#x7684;&#x5E95;&#x90E8;&#x7684;&#x53F6;&#x5B50;&#x7684;&#x6700;&#x53F3;&#x4FA7;&#x7684;&#x8282;&#x70B9;&#x627E;&#x5230;&#x67D0;&#x4E2A;&#x5143;&#x7D20;&#x3002;&#x7531;&#x4E8E;<span class="math inline">\(B\)</span>-&#x6811;&#x7684;&#x6784;&#x9020;&#x65B9;&#x5F0F;&#xFF0C;&#x6811;&#x7684;&#x6DF1;&#x5EA6;<span class="math inline">\(O(\log
n)\)</span>&#xFF0C;&#x800C;&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x9650;&#x5236;&#x4E86;&#x6BCF;&#x4E2A;&#x53F6;&#x5B50;&#x7ED3;&#x70B9;&#x627F;&#x8F7D;&#x5143;&#x7D20;&#x7684;&#x6570;&#x91CF;&#xFF0C;&#x56E0;&#x6B64;&#x4ECE;&#x53F6;&#x5B50;&#x5DE6;&#x7AEF;&#x5230;&#x53F3;&#x7AEF;&#x7684;&#x641C;&#x7D22;&#x65F6;&#x95F4;&#x4E3A;&#x5E38;&#x6570;&#x3002;&#x5219;&#x603B;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x4E3A;<span class="math inline">\(O(\log n)\)</span>&#x3002;</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/11.4.Rotating%20Trees/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/11.4.Rotating%20Trees/" class="post-title-link" itemprop="url">11.4.&#x6811;&#x7684;&#x65CB;&#x8F6C;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 18:18:06" itemprop="dateModified" datetime="2024-06-02T18:18:06+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/11-Balanced-Trees/" itemprop="url" rel="index"><span itemprop="name">11.Balanced Trees</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>153</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="114&#x6811;&#x7684;&#x65CB;&#x8F6C;"><span class="math inline">\(11.4\)</span>&#x6811;&#x7684;&#x65CB;&#x8F6C;</h1>
<p>&#x2003;&#x2003;The formal definition of rotation is:</p>
<ul>
<li><p><code>rotateLeft(G): Let x be the right child of G. Make G the new left child of x.</code></p></li>
<li><p><code>rotateRight(G): Let x be the left child of G. Make G the new right child of x.</code></p></li>
</ul>
<p>&#x2003;&#x2003;As in the picture, it means:</p>
<ul>
<li><span class="math inline">\(RotateLeft(G)\)</span>: G moves left,
promote its right child in the only natural way.(Promoting P means P is
the new parent of G.)</li>
<li><span class="math inline">\(RotateRight(P)\)</span>: P moves right,
promote its left child in the only natural way.</li>
</ul>
<p><img src="/2024/05/31/11.4.Rotating%20Trees/image-5.png"></p>
<p><img src="/2024/05/31/11.4.Rotating%20Trees/image-6.png"></p>
<p>&#x2003;&#x2003;We can implement these operations by following codes:
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Node <span class="title function_">rotateLeft</span><span class="params">(Node h)</span> {</span><br><span class="line">    <span class="comment">// assert (h != null) &amp;&amp; isRed(h.left);</span></span><br><span class="line">    <span class="type">Node</span> <span class="variable">x</span> <span class="operator">=</span> h.left;</span><br><span class="line">    h.left = x.right;</span><br><span class="line">    x.right = h;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// make a right-leaning link lean to the left</span></span><br><span class="line"><span class="keyword">private</span> Node <span class="title function_">rotateLeft</span><span class="params">(Node h)</span> {</span><br><span class="line">    <span class="comment">// assert (h != null) &amp;&amp; isRed(h.right);</span></span><br><span class="line">    <span class="type">Node</span> <span class="variable">x</span> <span class="operator">=</span> h.right;</span><br><span class="line">    h.right = x.left;</span><br><span class="line">    x.left = h;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/11.5.Red-Black%20Trees/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/11.5.Red-Black%20Trees/" class="post-title-link" itemprop="url">11.5.&#x7EA2;&#x9ED1;&#x6811;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 18:15:04" itemprop="dateModified" datetime="2024-06-02T18:15:04+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/11-Balanced-Trees/" itemprop="url" rel="index"><span itemprop="name">11.Balanced Trees</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>437</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="115&#x7EA2;&#x9ED1;&#x6811;&#x672A;&#x5B8C;&#x7ED3;"><span class="math inline">\(11.5\)</span>&#x7EA2;&#x9ED1;&#x6811;(&#x672A;&#x5B8C;&#x7ED3;)</h1>
<h3 id="1&#x7EA2;&#x9ED1;&#x6811;&#x7684;&#x5F15;&#x5165;&#x4E0E;&#x76F8;&#x5173;&#x6982;&#x5FF5;">1.&#x7EA2;&#x9ED1;&#x6811;&#x7684;&#x5F15;&#x5165;&#x4E0E;&#x76F8;&#x5173;&#x6982;&#x5FF5;</h3>
<p>&#x2003;&#x2003;&#x524D;&#x9762;&#x4ECB;&#x7ECD;&#x7684;<span class="math inline">\(B\)</span>-&#x6811;&#x5F88;&#x7B26;&#x5408;&#x6211;&#x4EEC;&#x5BF9;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x7684;&#x7684;&#x9700;&#x8981;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x5F88;&#x96BE;&#x7528;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x8BBE;&#x60F3;&#x521B;&#x9020;&#x4E00;&#x79CD;&#x6811;&#xFF0C;&#x5B83;&#x5229;&#x7528;<span class="math inline">\(BST\)</span>&#x5B9E;&#x73B0;&#xFF0C;&#x4F46;&#x7ED3;&#x6784;&#x4E0A;&#x4E0E;<span class="math inline">\(B\)</span>-&#x6811;&#x7B49;&#x4EF7;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5728;<span class="math inline">\(2-3\)</span>&#x6811;&#x4E2D;&#xFF0C;&#x53F6;&#x5B50;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x7684;&#x60C5;&#x51B5;&#x548C;<span class="math inline">\(BST\)</span>&#x662F;&#x5B8C;&#x5168;&#x4E00;&#x6837;&#x7684;&#x3002;&#x800C;&#x5BF9;&#x4E8E;&#x4E24;&#x4E2A;&#x8282;&#x70B9;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x6211;&#x4EEC;&#x8003;&#x8651;&#x5C06;&#x94FE;&#x63A5;&#x5206;&#x6210;&#x4E24;&#x79CD;&#x7C7B;&#x578B;&#xFF1A;&#x7EA2;&#x8272;(<span class="math inline">\(red\)</span>)&#x7684;&#x548C;&#x9ED1;&#x8272;(<span class="math inline">\(black\)</span>)&#x7684;&#x3002;&#x5BF9;&#x4E8E;&#x4E00;&#x4E2A;&#x53F6;&#x5B50;&#x4E09;&#x4E2A;&#x8282;&#x70B9;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;&#x5982;&#x4E0B;&#x7684;&#x5F62;&#x5F0F;&#x8868;&#x793A;&#xFF1A;</p>
<p><img src="/2024/05/31/11.5.Red-Black%20Trees/image-7.png"></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x4E48;&#x5904;&#x7406;&#x7684;&#x597D;&#x5904;&#x662F;&#xFF1A;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4E0D;&#x4FEE;&#x6539;&#x539F;&#x6709;&#x7684;<span class="math inline">\(BST\)</span>&#x6765;&#x5B9E;&#x73B0;<span class="math inline">\(2-3\)</span>&#x6811;&#x3002;&#x7ED9;&#x5B9A;&#x4EFB;&#x610F;&#x4E00;&#x4E2A;<span class="math inline">\(2-3\)</span>&#x6811;&#xFF0C;&#x6211;&#x4EEC;&#x90FD;&#x53EF;&#x4EE5;&#x7ACB;&#x5373;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x5BF9;&#x5E94;&#x7684;<span class="math inline">\(BST\)</span>&#x3002;&#x4F8B;&#x5982;&#x4E0B;&#x9762;&#x7684;<span class="math inline">\(2-3\)</span>&#x6811;&#x5230;&#x7EA2;&#x9ED1;&#x6811;&#x7684;&#x8F6C;&#x6362;&#xFF1A;</p>
<p><img src="/2024/05/31/11.5.Red-Black%20Trees/image-9.png"></p>
<h3 id="2&#x5DE6;&#x659C;&#x7EA2;&#x9ED1;&#x6811;&#x7684;&#x6027;&#x8D28;">2.&#x5DE6;&#x659C;&#x7EA2;&#x9ED1;&#x6811;&#x7684;&#x6027;&#x8D28;</h3>
<p>&#x2003;&#x2003;&#x4E3A;&#x4E86;&#x6A21;&#x62DF;<span class="math inline">\(2-3\)</span>&#x6811;&#xFF0C;&#x7EA2;&#x9ED1;&#x6811;&#x5FC5;&#x987B;&#x5177;&#x6709;&#x4EE5;&#x4E0B;&#x6027;&#x8D28;&#xFF1A;</p>
<ol type="1">
<li>&#x7EA2;&#x8272;&#x94FE;&#x63A5;&#x5DE6;&#x659C;&#x3002;</li>
<li>&#x6CA1;&#x6709;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x4E0E;&#x4E24;&#x4E2A;&#x7EA2;&#x8272;&#x94FE;&#x63A5;&#x76F8;&#x8FDE;&#x3002;</li>
<li>&#x7EA2;&#x9ED1;&#x6811;&#x5177;&#x6709;&#x5B8C;&#x7F8E;&#x7684;&#x201C;&#x9ED1;&#x8272;&#x5E73;&#x8861;&#x201D;&#xFF1A;&#x4ECE;&#x6839;&#x8282;&#x70B9;&#x5230;&#x7A7A;&#x8282;&#x70B9;&#x95F4;&#x7684;&#x6BCF;&#x4E2A;&#x8DEF;&#x5F84;&#x90FD;&#x5177;&#x6709;&#x76F8;&#x540C;&#x6570;&#x91CF;&#x7684;&#x8910;&#x8272;&#x94FE;&#x63A5;&#x3002;</li>
</ol>
<p>&#x2003;&#x2003;&#x5982;&#x679C;&#x5C06;&#x7EA2;&#x8272;&#x94FE;&#x63A5;&#x753B;&#x6210;&#x6C34;&#x5E73;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x4E0B;&#x9762;&#x7684;&#x56FE;&#x793A;&#xFF0C;&#x8FD9;&#x548C;<span class="math inline">\(2-3\)</span>&#x6811;&#x51E0;&#x4E4E;&#x4E00;&#x81F4;&#xFF1A;</p>
<p><img src="/2024/05/31/11.5.Red-Black%20Trees/image-10.png"></p>
<h3 id="2&#x7EA2;&#x9ED1;&#x6811;&#x7684;&#x65CB;&#x8F6C;&#x64CD;&#x4F5C;">2.&#x7EA2;&#x9ED1;&#x6811;&#x7684;&#x65CB;&#x8F6C;&#x64CD;&#x4F5C;</h3>
<p>&#x2003;&#x2003;&#x7EA2;&#x9ED1;&#x6811;&#x7684;&#x5DE6;&#x65CB;&#x64CD;&#x4F5C;&#x5982;&#x4E0B;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Node <span class="title function_">rotateLeft</span><span class="params">(Node h)</span> {</span><br><span class="line">    <span class="type">Node</span> <span class="variable">x</span> <span class="operator">=</span> h.right;</span><br><span class="line">    h.right = x.left;</span><br><span class="line">    x.left = h;</span><br><span class="line">    x.color = h.color;</span><br><span class="line">    h.color = RED;</span><br><span class="line">    x.N = h.N;</span><br><span class="line">    h.N = <span class="number">1</span> + size(h.left) + size(h.right);</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p><img src="/2024/05/31/11.5.Red-Black%20Trees/image-11.png"></p>
<p><img src="/2024/05/31/11.5.Red-Black%20Trees/image-12.png"></p>
<p>&#x2003;&#x2003;&#x7EA2;&#x9ED1;&#x6811;&#x7684;&#x53F3;&#x65CB;&#x64CD;&#x4F5C;&#x5982;&#x4E0B;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Node <span class="title function_">rotateRight</span><span class="params">(Node h)</span> {</span><br><span class="line">    <span class="type">Node</span> <span class="variable">x</span> <span class="operator">=</span> h.left;</span><br><span class="line">    h.left = x.right;</span><br><span class="line">    x.right = h;</span><br><span class="line">    x.color = h.color;</span><br><span class="line">    h.color = RED;</span><br><span class="line">    x.N = h.N;</span><br><span class="line">    h.N = <span class="number">1</span> + size(h.left) + size(h.right);</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">}</span><br></pre></td></tr></table></figure> <img src="/2024/05/31/11.5.Red-Black%20Trees/image-13.png"></p>
<p><img src="/2024/05/31/11.5.Red-Black%20Trees/image-14.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/12.1.The%20introduction%20of%20Hashing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/12.1.The%20introduction%20of%20Hashing/" class="post-title-link" itemprop="url">12.1.Hashing&#x7684;&#x5F15;&#x5165;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 18:25:40" itemprop="dateModified" datetime="2024-06-02T18:25:40+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/12-Hashing/" itemprop="url" rel="index"><span itemprop="name">12.Hashing</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>391</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="121hashing&#x7684;&#x5F15;&#x5165;"><span class="math inline">\(12.1\)</span><span class="math inline">\(Hashing\)</span>&#x7684;&#x5F15;&#x5165;</h1>
<h3 id="1hasing&#x7684;&#x5F15;&#x5165;">1.<span class="math inline">\(Hasing\)</span>&#x7684;&#x5F15;&#x5165;</h3>
<p>&#x2003;&#x2003;&#x5728;&#x5148;&#x524D;&#x7684;&#x6811;&#x7ED3;&#x6784;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x4E86;&#x5BF9;&#x6570;&#x636E;&#x7684;&#x9AD8;&#x6548;&#x67E5;&#x627E;&#x3002;&#x4F46;&#x6811;&#x7684;&#x4F7F;&#x7528;&#x6709;&#x4EE5;&#x4E0B;&#x7684;&#x9650;&#x5236;&#xFF1A;</p>
<ol type="1">
<li>&#x6811;&#x9700;&#x8981;&#x5BF9;&#x8C61;&#x5177;&#x6709;&#x53EF;&#x6BD4;&#x8F83;&#x6027;(<span class="math inline">\(comparable\)</span>)&#x3002;&#x5BF9;&#x4E8E;&#x67D0;&#x4E9B;&#x5143;&#x7D20;(&#x6BD4;&#x5982;&#x5B57;&#x7B26;&#x4E32;)&#xFF0C;&#x5B83;&#x4EEC;&#x4E0D;&#x80FD;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#xFF0C;&#x56E0;&#x6B64;&#x5C31;&#x65E0;&#x6CD5;&#x63D2;&#x5165;<span class="math inline">\(BST\)</span>&#x4E2D;&#x4E86;&#x3002;</li>
<li><span class="math inline">\(BST\)</span>&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x4E3A;<span class="math inline">\(\Theta(\log
N)\)</span>&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x6709;&#x66F4;&#x4F18;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x3002;</li>
</ol>
<p>&#x2003;&#x2003;&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x5B9E;&#x73B0;&#x5BF9;&#x6574;&#x6570;&#x7684;&#x67E5;&#x627E;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x68C0;&#x6D4B;&#x6570;&#x7EC4;&#x7B2C;<span class="math inline">\(i\)</span>&#x4F4D;&#x662F;&#x5426;&#x4E3A;<span class="math inline">\(1\)</span>&#xFF0C;&#x4ECE;&#x800C;&#x5F97;&#x5230;&#x8BE5;&#x6574;&#x6570;&#x662F;&#x5426;&#x5B58;&#x5728;&#x3002;&#x8BE5;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x5982;&#x4E0B;&#x5B9E;&#x73B0;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataIndexedIntegerSet</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span>[] present;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DataIndexedIntegerSet</span><span class="params">()</span> {</span><br><span class="line">        present = <span class="keyword">new</span> <span class="title class_">boolean</span>[<span class="number">2000000000</span>];</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> x)</span> {</span><br><span class="line">        present[i] = <span class="literal">true</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">contains</span><span class="params">(<span class="type">int</span> x)</span> {</span><br><span class="line">        <span class="keyword">return</span> present[i];</span><br><span class="line">    }</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8BE5;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x7684;&#x67E5;&#x627E;&#x4E0E;&#x63D2;&#x5165;&#x90FD;&#x53EA;&#x9700;&#x8981;<span class="math inline">\(\Theta(1)\)</span>&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x5B83;&#x6709;&#x4EE5;&#x4E0B;&#x7684;&#x95EE;&#x9898;&#xFF1A;</p>
<ol type="1">
<li>&#x7A7A;&#x95F4;&#x6D6A;&#x8D39;&#x8F83;&#x5927;&#x3002;</li>
<li>&#x4E0D;&#x5177;&#x6709;&#x666E;&#x9002;&#x6027;&#x3002;&#x8BE5;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x53EA;&#x9002;&#x7528;&#x4E8E;&#x6574;&#x6570;&#x3002;</li>
</ol>
<h3 id="2&#x5B57;&#x7B26;&#x4E32;&#x5230;&#x6574;&#x6570;&#x7684;&#x8F6C;&#x6362;">2.&#x5B57;&#x7B26;&#x4E32;&#x5230;&#x6574;&#x6570;&#x7684;&#x8F6C;&#x6362;</h3>
<p>&#x2003;&#x2003;&#x4EE5;&#x5B57;&#x7B26;&#x4E32;&#x4E3A;&#x4F8B;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8003;&#x8651;&#x5C06;&#x5B57;&#x7B26;&#x4E32;&#x6309;&#x5982;&#x4E0B;&#x7684;&#x65B9;&#x5F0F;&#x8F6C;&#x6362;&#x6210;&#x4E00;&#x4E2A;&#x6574;&#x6570;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">letterNum</span><span class="params">(String s, <span class="type">int</span> i)</span> {</span><br><span class="line">    <span class="comment">/** Converts ith character of String to a letter number.</span></span><br><span class="line"><span class="comment">    * e.g. &apos;a&apos; -&gt; 1, &apos;b&apos; -&gt; 2, &apos;z&apos; -&gt; 26 */</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">ithChar</span> <span class="operator">=</span> s.charAt(i)</span><br><span class="line">    <span class="keyword">if</span> ((ithChar &lt; <span class="string">&apos;a&apos;</span>) || (ithChar &gt; <span class="string">&apos;z&apos;</span>)) {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ithChar - <span class="string">&apos;a&apos;</span> + <span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">englishToInt</span><span class="params">(String s)</span> {</span><br><span class="line">    <span class="type">int</span> <span class="variable">intRep</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0l</span> i &lt; s.length(); i += <span class="number">1</span>) {</span><br><span class="line">        intRep = intRep * <span class="number">26</span>;</span><br><span class="line">        intRep += letterNum(s, i);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> intRep;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x5B9E;&#x73B0;&#x4E86;&#x5B57;&#x7B26;&#x4E32;&#x5230;&#x6574;&#x6570;&#x7684;&#x8F6C;&#x6362;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x8FD9;&#x5E76;&#x672A;&#x89E3;&#x51B3;&#x6211;&#x4EEC;&#x63D0;&#x51FA;&#x7684;&#x95EE;&#x9898;&#x3002;</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/12.2.The%20solution%20to%20Hashing%20problems(1)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/12.2.The%20solution%20to%20Hashing%20problems(1)/" class="post-title-link" itemprop="url">12.2.Hashing&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;(1)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 18:25:42" itemprop="dateModified" datetime="2024-06-02T18:25:42+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/12-Hashing/" itemprop="url" rel="index"><span itemprop="name">12.Hashing</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>341</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="122hashing&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;1"><span class="math inline">\(12.2\)</span><span class="math inline">\(Hashing\)</span>&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;(1)</h1>
<h3 id="1&#x6574;&#x6570;&#x6EA2;&#x51FA;">1.&#x6574;&#x6570;&#x6EA2;&#x51FA;</h3>
<p>&#x2003;&#x2003;&#x5728;&#x5148;&#x524D;&#x5C06;&#x5B57;&#x7B26;&#x4E32;&#x8F6C;&#x6362;&#x4E3A;&#x6574;&#x6570;&#x7684;&#x64CD;&#x4F5C;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5FFD;&#x7565;&#x4E86;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF1A;&#x8F6C;&#x6362;&#x5F97;&#x5230;&#x7684;&#x6574;&#x6570;&#x8FC7;&#x5927;&#x5BFC;&#x81F4;&#x6EA2;&#x51FA;&#x600E;&#x4E48;&#x529E;&#xFF1F;&#x4F8B;&#x5982;&#xFF0C;&#x6EA2;&#x51FA;&#x540E;&#x7684;<code>melt banana</code>&#x4E0E;<code>subterresetrial anticosmetic</code>&#x7684;<span class="math inline">\(Hash\)</span>&#x503C;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x6BD4;&#x8F83;&#x5B83;&#x4EEC;&#x7684;<span class="math inline">\(Hash\)</span>&#x503C;&#x6765;&#x786E;&#x5B9A;&#x5B83;&#x4EEC;&#x662F;&#x5426;&#x76F8;&#x7B49;&#xFF0C;&#x4F1A;&#x5F97;&#x5230;&#x76F8;&#x53CD;&#x7684;&#x7B54;&#x6848;&#x3002;</p>
<p>&#x2003;&#x2003;&#x6574;&#x6570;&#x7684;&#x6EA2;&#x51FA;&#x662F;&#x65E0;&#x6CD5;&#x907F;&#x514D;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;<span class="math inline">\(Java\)</span>&#x80FD;&#x591F;&#x8868;&#x793A;&#x7684;&#x6700;&#x5927;&#x6574;&#x6570;&#x53EA;&#x6709;<span class="math inline">\(2147483647\)</span>&#x3002;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x5F15;&#x5165;&#x4E0B;&#x9762;&#x7684;&#x65B9;&#x6CD5;&#xFF1A;</p>
<h3 id="2hashcodes">2.<span class="math inline">\(Hash\;Codes\)</span></h3>
<p>&#x2003;&#x2003;&#x5728;<span class="math inline">\(Java\)</span>&#x4E2D;&#xFF0C;&#x6BCF;&#x4E2A;&#x5BF9;&#x8C61;&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x9ED8;&#x8BA4;&#x7684;<code>.hashcode()</code>&#x65B9;&#x6CD5;&#x3002;<span class="math inline">\(Java\)</span>&#x901A;&#x8FC7;&#x8BE5;&#x5BF9;&#x8C61;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x4F4D;&#x7F6E;&#x6765;&#x5F97;&#x51FA;&#x5B83;&#x7684;<span class="math inline">\(hashCode\)</span>&#x3002;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x5BF9;&#x6BCF;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;&#x5BF9;&#x8C61;&#x90FD;&#x4F1A;&#x7ED9;&#x51FA;&#x4E0D;&#x91CD;&#x590D;&#x7684;<span class="math inline">\(hashCode\)</span>&#x3002;</p>
<p>&#x2003;&#x2003;&#x6709;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x4F1A;&#x81EA;&#x5DF1;&#x5B9A;&#x4E49;<code>.hashcode()</code>&#x65B9;&#x6CD5;&#xFF0C;&#x6765;&#x6EE1;&#x8DB3;&#x81EA;&#x5DF1;&#x5B9A;&#x4E49;&#x7684;&#x4E00;&#x4E9B;&#x7C7B;&#x7684;&#x9700;&#x8981;&#x3002;</p>
<p>&#x2003;&#x2003;<span class="math inline">\(hashCode\)</span>&#x5177;&#x6709;&#x5982;&#x4E0B;&#x6027;&#x8D28;&#xFF1A;</p>
<ol type="1">
<li>&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x6574;&#x6570;</li>
<li>&#x5BF9;&#x540C;&#x4E00;&#x5BF9;&#x8C61;&#x591A;&#x6B21;&#x8C03;&#x7528;<code>.hashcode()</code>&#xFF0C;&#x5F97;&#x5230;&#x7684;&#x7ED3;&#x679C;&#x90FD;&#x76F8;&#x540C;&#x3002;</li>
<li>&#x4E24;&#x4E2A;<code>.equal()</code> &#x7684;&#x5BF9;&#x8C61;&#x5FC5;&#x987B;&#x5177;&#x6709;&#x76F8;&#x540C;&#x7684;<span class="math inline">\(hashCode\)</span>&#x3002;</li>
</ol>
<p>&#x2003;&#x2003;&#x7136;&#x800C;&#xFF0C;&#x5E76;&#x4E0D;&#x662F;&#x6240;&#x6709;<span class="math inline">\(hashCode\)</span>&#x76F8;&#x7B49;&#x7684;&#x5BF9;&#x8C61;&#x90FD;<code>.equal()</code>&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x5E94;&#x5F53;&#x8BA9;&#x5BF9;&#x8C61;&#x7684;<span class="math inline">\(.hashode()\)</span>&#x65B9;&#x6CD5;&#x751F;&#x6210;&#x7684;<span class="math inline">\(hashCode\)</span>&#x5C3D;&#x53EF;&#x80FD;&#x5206;&#x5E03;&#x5747;&#x5300;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5230;&#x6B64;&#x4E3A;&#x6B62;&#xFF0C;&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x4E86;<span class="math inline">\(Hashing\)</span>&#x7684;&#x666E;&#x9002;&#x6027;&#x3002;</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/12.3.The%20solution%20to%20Hashing%20problems(2)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/12.3.The%20solution%20to%20Hashing%20problems(2)/" class="post-title-link" itemprop="url">12.3.Hashing&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;(2)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 18:25:09" itemprop="dateModified" datetime="2024-06-02T18:25:09+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/12-Hashing/" itemprop="url" rel="index"><span itemprop="name">12.Hashing</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>344</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="123hashing&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;2"><span class="math inline">\(12.3\)</span><span class="math inline">\(Hashing\)</span>&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;(2)</h1>
<h3 id="1&#x51B2;&#x7A81;&#x5904;&#x7406;">1.&#x51B2;&#x7A81;&#x5904;&#x7406;</h3>
<p>&#x2003;&#x2003;&#x5047;&#x5982;&#x6211;&#x4EEC;&#x5F97;&#x5230;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;<span class="math inline">\(hashCode\)</span>&#x4E3A;<span class="math inline">\(h\)</span>&#xFF1A;</p>
<ul>
<li>&#x5F53;<span class="math inline">\(h\)</span>&#x7D22;&#x5F15;&#x4E0D;&#x5B58;&#x5728;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x5BF9;<span class="math inline">\(h\)</span>&#x7D22;&#x5F15;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;<code>LinkedList</code>&#xFF0C;&#x5E76;&#x628A;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x63D2;&#x5165;&#x94FE;&#x8868;&#x4E2D;&#x3002;</li>
<li>&#x5F53;<span class="math inline">\(h\)</span>&#x7D22;&#x5F15;&#x5B58;&#x5728;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x5C06;&#x5BF9;&#x8C61;&#x63D2;&#x5165;&#x5DF2;&#x6709;&#x7684;&#x94FE;&#x8868;&#x4E2D;&#x3002;</li>
</ul>
<blockquote>
<p>&#x2003;&#x2003;<span class="math inline">\(p.s.\)</span>&#x6211;&#x4EEC;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x662F;&#x4E0D;&#x5141;&#x8BB8;&#x91CD;&#x590D;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x5728;&#x63D2;&#x5165;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x5C06;&#x5F85;&#x63D2;&#x5165;&#x5BF9;&#x8C61;&#x4E0E;&#x94FE;&#x8868;&#x4E2D;&#x6240;&#x6709;&#x5DF2;&#x63D2;&#x5165;&#x5BF9;&#x8C61;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#x3002;&#x5F53;&#x8BE5;&#x5BF9;&#x8C61;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x65F6;&#xFF0C;&#x5C31;&#x76F4;&#x63A5;&#x8DF3;&#x8FC7;&#x3002;&#x8FD9;&#x8BF4;&#x660E;&#x6211;&#x4EEC;&#x4F1A;&#x9700;&#x8981;&#x904D;&#x5386;&#x6574;&#x4E2A;&#x94FE;&#x8868;&#x3002;</p>
</blockquote>
<p>&#x2003;&#x2003;&#x8FD9;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5F97;&#x5230;<span class="math inline">\(Hashing\)</span>&#x7684;&#x5177;&#x4F53;&#x6D41;&#x7A0B;&#x4E86;&#xFF1A;</p>
<ul>
<li><p><code>add</code> item</p>
<ul>
<li>Get hashcode (i.e., index) of item.</li>
<li>If index has no item, create new List, and place item there.</li>
<li>If index has a List already, check the List to see if item is
already in there. If not, add item to List.</li>
</ul></li>
<li><p><code>contains</code> item</p>
<ul>
<li>Get hashcode (i.e., index) of item.</li>
<li>If index is empty, return <code>false</code>.</li>
<li>Otherwise, check all items in the List at that index, and if the
item exists, return true.</li>
</ul></li>
</ul>
<h3 id="2&#x5185;&#x5B58;&#x7684;&#x5904;&#x7406;">2.&#x5185;&#x5B58;&#x7684;&#x5904;&#x7406;</h3>
<p>&#x2003;&#x2003;&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x4F7F;&#x7528;&#x8FC7;&#x5927;&#x7684;&#x6570;&#x7EC4;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x56FA;&#x5B9A;&#x6570;&#x7EC4;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x7136;&#x540E;&#x91C7;&#x7528;&#x53D6;&#x6A21;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x8BA9;&#x6240;&#x6709;&#x7684;<span class="math inline">\(hashCode\)</span>&#x90FD;&#x843D;&#x5165;&#x8BE5;&#x6570;&#x7EC4;&#x7684;&#x7D22;&#x5F15;&#x8303;&#x56F4;&#x5185;(&#x7C7B;&#x4F3C;&#x6211;&#x4EEC;&#x5728;<span class="math inline">\(ArrayList\)</span>&#x4E2D;&#x4F7F;&#x7528;&#x7684;&#x65B9;&#x6CD5;)&#x3002;&#x5C31;&#x7B97;&#x6B64;&#x65F6;&#x53D1;&#x751F;&#x4E86;&#x54C8;&#x5E0C;&#x51B2;&#x7A81;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x4E0A;&#x9762;&#x7684;&#x65B9;&#x6CD5;&#x5904;&#x7406;&#x5B83;&#x3002;</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/12.4.Final%20Data%20Structure/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/12.4.Final%20Data%20Structure/" class="post-title-link" itemprop="url">12.4.&#x6570;&#x636E;&#x7ED3;&#x6784;&#x7684;&#x6700;&#x7EC8;&#x5B9E;&#x73B0;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 18:25:11" itemprop="dateModified" datetime="2024-06-02T18:25:11+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/12-Hashing/" itemprop="url" rel="index"><span itemprop="name">12.Hashing</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>450</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="124&#x6570;&#x636E;&#x7ED3;&#x6784;&#x7684;&#x6700;&#x7EC8;&#x5B9E;&#x73B0;"><span class="math inline">\(12.4\)</span>&#x6570;&#x636E;&#x7ED3;&#x6784;&#x7684;&#x6700;&#x7EC8;&#x5B9E;&#x73B0;</h1>
<h3 id="1&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x7684;&#x4F18;&#x5316;">1.&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x7684;&#x4F18;&#x5316;</h3>
<p>&#x2003;&#x2003;&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x5B58;&#x653E;&#x7D22;&#x5F15;&#x7684;&#x6570;&#x7EC4;&#x7684;&#x5927;&#x5C0F;&#x4E3A;<span class="math inline">\(5\)</span>&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x63D2;&#x5165;<span class="math inline">\(100\)</span>&#x4E2A;&#x5143;&#x7D20;&#x65F6;&#xFF0C;&#x6700;&#x574F;&#x7684;&#x60C5;&#x51B5;&#x662F;&#xFF1A;&#x6240;&#x6709;&#x5143;&#x7D20;&#x7684;&#x7D22;&#x5F15;&#x90FD;&#x662F;&#x4E00;&#x81F4;&#x7684;&#x3002;&#x8FD9;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x5F97;&#x5230;&#x4E86;&#x4E00;&#x4E2A;&#x957F;&#x5EA6;&#x4E3A;<span class="math inline">\(100\)</span>&#x7684;&#x94FE;&#x8868;&#x3002;</p>
<p>&#x2003;&#x2003;&#x8FD9;&#x663E;&#x7136;&#x4E0D;&#x662F;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x770B;&#x5230;&#x7684;&#x60C5;&#x51B5;&#x3002;&#x5BF9;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x6709;&#x4E24;&#x79CD;&#x5904;&#x7406;&#x65B9;&#x6CD5;&#xFF1A;</p>
<ol type="1">
<li>&#x52A8;&#x6001;&#x5730;&#x6269;&#x5927;&#x6211;&#x4EEC;&#x7684;&#x54C8;&#x5E0C;&#x8868;&#x3002;</li>
<li>&#x6539;&#x8FDB;&#x6211;&#x4EEC;&#x7684;<span class="math inline">\(hashCode\)</span>&#x3002;</li>
</ol>
<h4 id="a&#x52A8;&#x6001;&#x6269;&#x5BB9;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&#x52A8;&#x6001;&#x6269;&#x5BB9;</h4>
<p>&#x2003;&#x2003;&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x6709;<span class="math inline">\(M\)</span>&#x4E2A;&#x7B50;&#x548C;<span class="math inline">\(N\)</span>&#x4E2A;&#x5143;&#x7D20;&#xFF0C;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x8D1F;&#x8F7D;&#x7CFB;&#x6570;(<span class="math inline">\(load\;factor\)</span>)&#x4E3A;<span class="math inline">\(N\over M\)</span>(&#x8FD9;&#x5373;&#x662F;&#x6211;&#x4EEC;&#x7684;&#x6700;&#x4F73;&#x8FD0;&#x884C;&#x65F6;&#x95F4;)&#x3002;</p>
<p>&#x2003;&#x2003;&#x4E3A;&#x4E86;&#x8BA9;&#x6211;&#x4EEC;&#x7684;&#x8D1F;&#x8F7D;&#x7CFB;&#x6570;&#x7EF4;&#x6301;&#x5728;&#x4E00;&#x4E2A;&#x8F83;&#x4F4E;&#x7684;&#x8303;&#x56F4;&#x5185;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8BA9;<span class="math inline">\(M\)</span>&#x53D8;&#x4E3A;<span class="math inline">\(2M\)</span>&#xFF0C;&#x5E76;&#x8FDB;&#x884C;&#x5982;&#x4E0B;&#x64CD;&#x4F5C;&#xFF1A;</p>
<ul>
<li><p>&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x5BB9;&#x91CF;&#x4E3A;<span class="math inline">\(2M\)</span>&#x7684;&#x54C8;&#x5E0C;&#x8868;&#x3002;</p></li>
<li><p>&#x8FED;&#x4EE3;&#x904D;&#x5386;&#x539F;&#x6709;&#x7684;&#x54C8;&#x5E0C;&#x8868;&#xFF0C;&#x7136;&#x540E;&#x628A;&#x539F;&#x6709;&#x7684;&#x5143;&#x7D20;&#x590D;&#x5236;&#x5230;&#x65B0;&#x7684;&#x54C8;&#x5E0C;&#x8868;&#x4E2D;&#x3002;</p>
<ul>
<li>&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x4E00;&#x4E2A;&#x590D;&#x5236;&#x5143;&#x7D20;&#xFF0C;&#x662F;&#x56E0;&#x4E3A;&#x54C8;&#x5E0C;&#x8868;&#x7684;&#x5BB9;&#x91CF;&#x6539;&#x53D8;&#x4E86;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x7684;&#x6A21;&#x6570;&#x4E5F;&#x53D8;&#x4E86;&#xFF0C;&#x4ECE;&#x800C;&#x9700;&#x8981;&#x7528;&#x65B0;&#x7684;&#x6A21;&#x6570;&#x4E00;&#x4E2A;&#x4E00;&#x4E2A;&#x5C06;&#x5143;&#x7D20;&#x590D;&#x5236;&#x5230;&#x65B0;&#x54C8;&#x5E0C;&#x8868;&#x5BF9;&#x5E94;&#x7684;&#x4F4D;&#x7F6E;&#x3002;</li>
</ul></li>
</ul>
<p>&#x2003;&#x2003;&#x8FD9;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x5F97;&#x5230;&#x4E86;&#x4E00;&#x4E2A;&#x8FD0;&#x884C;&#x65F6;&#x95F4;<span class="math inline">\(\Theta(N\over
M)\)</span>&#x7684;&#x54C8;&#x5E0C;&#x8868;&#x3002;&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x9650;&#x5B9A;<span class="math inline">\(N\over
M\)</span>&#x5FC5;&#x987B;&#x5C0F;&#x4E8E;&#x4E00;&#x4E2A;&#x5E38;&#x6570;&#xFF0C;&#x56E0;&#x6B64;&#x6700;&#x4F18;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x4E3A;<span class="math inline">\(\Theta(N\over M)=\Theta(1)\)</span>&#x3002;</p>
<h4 id="b&#x6539;&#x8FDB;hashcode">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>&#x6539;&#x8FDB;<span class="math inline">\(hashCode\)</span></h4>
<ul>
<li><p>Use a &apos;base&apos; strategy similar to the one we developed
earlier.</p></li>
<li><p>Use a &apos;base&apos; that&apos;s a small prime.</p>
<ul>
<li>Base 126 isn&apos;t actually very good, because using base 126 means that
any string that ends in the same last 32 characters has the same
hashcode.</li>
<li>This happens because of overflow.</li>
<li>Using prime numbers helps avoid overflow issues (i.e., collisions
due to overflow).</li>
<li>Why a small prime? Because it&apos;s easier to compute.</li>
</ul></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/13.1.PQ%20Interface/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/13.1.PQ%20Interface/" class="post-title-link" itemprop="url">13.1.&#x4F18;&#x5148;&#x961F;&#x5217;&#x63A5;&#x53E3;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 21:08:57" itemprop="dateModified" datetime="2024-06-02T21:08:57+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/13-Heap-Priority-Queue/" itemprop="url" rel="index"><span itemprop="name">13.Heap &amp; Priority Queue</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>392</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="131&#x4F18;&#x5148;&#x961F;&#x5217;&#x63A5;&#x53E3;"><span class="math inline">\(13.1\)</span>&#x4F18;&#x5148;&#x961F;&#x5217;&#x63A5;&#x53E3;</h1>
<h3 id="1&#x4F18;&#x5148;&#x961F;&#x5217;&#x7684;&#x5F15;&#x5165;">1.&#x4F18;&#x5148;&#x961F;&#x5217;&#x7684;&#x5F15;&#x5165;</h3>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x77E5;&#x9053;<span class="math inline">\(BST\)</span>&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x6570;&#x636E;&#x7684;&#x5FEB;&#x901F;&#x641C;&#x7D22;&#xFF0C;&#x90A3;&#x4E48;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x53EA;&#x5173;&#x5FC3;&#x5BF9;&#x6700;&#x5927;(&#x6700;&#x5C0F;)&#x5143;&#x7D20;&#x7684;&#x67E5;&#x627E;&#x5462;&#xFF1F;</p>
<p>&#x2003;&#x2003;&#x8FD9;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5F15;&#x5165;&#x4F18;&#x5148;&#x961F;&#x5217;(<span class="math inline">\(Priority\;Queue\)</span>)&#x7684;<span class="math inline">\(ADT\)</span>&#x3002;&#x5728;&#x4F18;&#x5148;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x80FD;&#x5BF9;&#x4E00;&#x7EC4;&#x6570;&#x636E;&#x4E2D;&#x7684;&#x6700;&#x5C0F;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** (Min) Priority Queue: Allowing tracking and removal of </span></span><br><span class="line"><span class="comment">  * the smallest item in a priority queue. */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MinPQ</span>&lt;Item&gt; {</span><br><span class="line">    <span class="comment">/** Adds the item to the priority queue. */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Item x)</span>;</span><br><span class="line">    <span class="comment">/** Returns the smallest item in the priority queue. */</span></span><br><span class="line">    <span class="keyword">public</span> Item <span class="title function_">getSmallest</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">/** Removes the smallest item from the priority queue. */</span></span><br><span class="line">    <span class="keyword">public</span> Item <span class="title function_">removeSmallest</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">/** Returns the size of the priority queue. */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="2&#x4F18;&#x5148;&#x961F;&#x5217;&#x7684;&#x5B9E;&#x73B0;">2.&#x4F18;&#x5148;&#x961F;&#x5217;&#x7684;&#x5B9E;&#x73B0;</h3>
<p>&#x2003;&#x2003;&#x5047;&#x5982;&#x6211;&#x4EEC;&#x7528;&#x94FE;&#x8868;&#x5B9E;&#x73B0;&#x4EE5;&#x4E0B;&#x7684;&#x95EE;&#x9898;&#xFF1A;</p>
<p>&#x2003;&#x2003;<span class="math inline">\(question:\)</span></p>
<ul>
<li>Consider the scenario where we are monitoring text messages between
citizens and want to keep track of unharmonious conversations.</li>
<li>Each day, you prepare a report of <span class="math inline">\(M\)</span> messages that are the most unharmonious
using a HarmoniousnessComparator.</li>
</ul>
<p>&#x2003;&#x2003;&#x7528;&#x94FE;&#x8868;&#x5C06;&#x5F97;&#x5230;&#x5982;&#x4E0B;&#x5B9E;&#x73B0;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;String&gt; <span class="title function_">unharmoniousTexts</span><span class="params">(Sniffer sniffer, <span class="type">int</span> M)</span> {</span><br><span class="line">    ArrayList&lt;String&gt;allMessages = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">Timer</span> <span class="variable">timer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Timer</span>(); timer.hours() &lt; <span class="number">24</span>; ) {</span><br><span class="line">        allMessages.add(sniffer.getNextMessage());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    Comparator&lt;String&gt; cmptr = <span class="keyword">new</span> <span class="title class_">HarmoniousnessComparator</span>();</span><br><span class="line">    Collections.sort(allMessages, cmptr, Collections.reverseOrder());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> allMessages.sublist(<span class="number">0</span>, M);</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x7136;&#x800C;&#xFF0C;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x7684;&#x5F0A;&#x7AEF;&#x4E3A;&#xFF1A;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;<span class="math inline">\(\Theta(M)\)</span>&#x7A7A;&#x95F4;&#x5185;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x4F46;&#x8BE5;&#x65B9;&#x6CD5;&#x4F7F;&#x7528;&#x4E86;<span class="math inline">\(\Theta(N)\)</span>&#x7684;&#x7A7A;&#x95F4;&#x3002;</p>
<p>&#x2003;&#x2003;&#x4E3A;&#x4E86;&#x4F18;&#x5316;&#x5185;&#x5B58;&#x7684;&#x5360;&#x7528;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C1D;&#x8BD5;&#x7528;&#x4E0B;&#x9762;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x5B9E;&#x73B0;&#x4F18;&#x5148;&#x961F;&#x5217;&#xFF1A;</p>
<ul>
<li>Ordered Array
<ul>
<li><code>add</code>:<span class="math inline">\(\Theta(N)\)</span></li>
<li><code>getSmallest</code>:<span class="math inline">\(\Theta(1)\)</span></li>
<li><code>removeSmallest</code>:<span class="math inline">\(\Theta(N)\)</span></li>
</ul></li>
<li>Bushy BST
<ul>
<li><code>add</code>:<span class="math inline">\(\Theta(\log
N)\)</span></li>
<li><code>getSmallest</code>:<span class="math inline">\(\Theta(\log
N)\)</span></li>
<li><code>removeSmallest</code>:<span class="math inline">\(\Theta(\log
N)\)</span></li>
</ul></li>
<li>HashTable
<ul>
<li><code>add</code>:<span class="math inline">\(\Theta(1)\)</span></li>
<li><code>getSmallest</code>:<span class="math inline">\(\Theta(N)\)</span></li>
<li><code>removeSmallest</code>:<span class="math inline">\(\Theta(N)\)</span></li>
</ul></li>
</ul>
<p>&#x2003;&#x2003;&#x90A3;&#x4E48;&#xFF0C;&#x6211;&#x4EEC;&#x6709;&#x66F4;&#x4F18;&#x79C0;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;&#x5417;&#xFF1F;</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/13.2.Heap%20Structure/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/13.2.Heap%20Structure/" class="post-title-link" itemprop="url">13.2.&#x5806;&#x7ED3;&#x6784;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 21:11:05" itemprop="dateModified" datetime="2024-06-02T21:11:05+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/13-Heap-Priority-Queue/" itemprop="url" rel="index"><span itemprop="name">13.Heap &amp; Priority Queue</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>539</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="132&#x5806;&#x7ED3;&#x6784;"><span class="math inline">\(13.2\)</span>&#x5806;&#x7ED3;&#x6784;</h1>
<h3 id="1&#x5806;&#x7ED3;&#x6784;&#x7684;&#x5F15;&#x5165;">1.&#x5806;&#x7ED3;&#x6784;&#x7684;&#x5F15;&#x5165;</h3>
<p>&#x2003;&#x2003;&#x7531;&#x5148;&#x524D;&#x7684;&#x5206;&#x6790;&#xFF0C;&#x6211;&#x4EEC;&#x5F97;&#x51FA;&#x62E5;&#x6709;&#x6700;&#x4F73;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x7684;&#x662F;<span class="math inline">\(BST\)</span>&#x3002;&#x7136;&#x800C;&#xFF0C;&#x5BF9;<span class="math inline">\(BST\)</span>&#x8FDB;&#x884C;&#x4FEE;&#x9970;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x66F4;&#x597D;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x3002;</p>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x6211;&#x4EEC;&#x7684;&#x4E8C;&#x53C9;&#x5806;&#x9075;&#x5FAA;&#x4EE5;&#x4E0B;&#x6027;&#x8D28;&#xFF1A;</p>
<ul>
<li>&#x6700;&#x5C0F;&#x6027;&#xFF1A;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x90FD;&#x5C0F;&#x4E8E;&#x7B49;&#x4E8E;&#x5B83;&#x7684;&#x513F;&#x5B50;&#x8282;&#x70B9;&#x3002;</li>
<li>&#x5B8C;&#x5168;&#x6027;&#xFF1A;&#x7F3A;&#x5931;&#x7684;&#x5143;&#x7D20;&#x53EA;&#x80FD;&#x4F4D;&#x4E8E;&#x5806;&#x7684;&#x5E95;&#x90E8;&#xFF1B;&#x5806;&#x4E2D;&#x5143;&#x7D20;&#x6392;&#x5217;&#x5E94;&#x5C3D;&#x53EF;&#x80FD;&#x5DE6;&#x504F;&#x3002;</li>
</ul>
<p>&#x2003;&#x2003;&#x5982;&#x56FE;&#xFF0C;&#x7EFF;&#x8272;&#x7684;&#x5806;&#x662F;&#x7B26;&#x5408;&#x6761;&#x4EF6;&#x7684;&#xFF0C;&#x800C;&#x7EA2;&#x8272;&#x7684;&#x662F;&#x4E0D;&#x7B26;&#x5408;&#x6761;&#x4EF6;&#x7684;&#x3002;</p>
<p><img src="/2024/05/31/13.2.Heap%20Structure/image.png"></p>
<h3 id="2&#x6811;&#x7684;&#x8868;&#x793A;">2.&#x6811;&#x7684;&#x8868;&#x793A;</h3>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;&#x5982;&#x4E0B;&#x7684;&#x65B9;&#x5F0F;&#x8868;&#x793A;&#x4E00;&#x68F5;&#x6811;&#xFF1A; * <span class="math inline">\(Tree1A\)</span>&#xFF1A;&#x7528;&#x6307;&#x9488;&#x8868;&#x793A;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Tree1A</span>&lt;Key&gt; {</span><br><span class="line">  Key k;</span><br><span class="line">  Tree1A left;</span><br><span class="line">  Tree1A middle;</span><br><span class="line">  Tree1A right;</span><br><span class="line">  ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p><img src="/2024/05/31/13.2.Heap%20Structure/image-1.png"></p>
<ul>
<li><span class="math inline">\(Tree1B\)</span>&#xFF1A;&#x7528;&#x7236;&#x8282;&#x70B9;&#x5143;&#x7D20;&#x4E0E;&#x6570;&#x7EC4;&#x6DF7;&#x5408;&#x8868;&#x793A;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Tree1B</span>&lt;Key&gt; {</span><br><span class="line">  Key k;</span><br><span class="line">  Tree1B[] children;</span><br><span class="line">  ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/2024/05/31/13.2.Heap%20Structure/image-2.png"></p>
<ul>
<li><span class="math inline">\(Tree1C\)</span>&#xFF1A;&#x7528;&#x7236;&#x8282;&#x70B9;&#x5143;&#x7D20;&#x3001;&#x6307;&#x5411;&#x7B2C;&#x4E00;&#x4E2A;&#x5B69;&#x5B50;&#x7684;&#x5143;&#x7D20;&#x548C;<span class="math inline">\(next\)</span>&#x6307;&#x9488;(<span class="math inline">\(sibling\)</span>)&#x8868;&#x793A;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Tree1C</span>&lt;Key&gt; {</span><br><span class="line">  Key k;</span><br><span class="line">  Tree1C favoredChild;</span><br><span class="line">  Tree1C sibling;</span><br><span class="line">  ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/2024/05/31/13.2.Heap%20Structure/image-3.png"></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x4E9B;&#x8868;&#x793A;&#x6811;&#x7684;&#x65B9;&#x5F0F;&#x90FD;&#x76F4;&#x63A5;&#x5F15;&#x7528;(<span class="math inline">\(explicit\;reference\)</span>)&#x4E86;&#x8282;&#x70B9;&#x7684;&#x513F;&#x5B50;&#x3002;&#x4E0B;&#x9762;&#x4ECB;&#x7ECD;&#x4E00;&#x4E9B;&#x4E0D;&#x5B58;&#x50A8;&#x5BF9;&#x513F;&#x5B50;&#x7684;&#x5F15;&#x7528;&#x7684;&#x8868;&#x793A;&#x65B9;&#x5F0F;&#xFF1A;</p>
<ul>
<li><span class="math inline">\(Approach\;2\)</span>
<ul>
<li>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;&#x7C7B;&#x4F3C;&#x5E76;&#x67E5;&#x96C6;&#x7684;&#x8868;&#x793A;&#x65B9;&#x5F0F;&#xFF0C;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<span class="math inline">\(parents\)</span>&#x6570;&#x7EC4;&#x548C;&#x4E00;&#x4E2A;<span class="math inline">\(key\)</span>&#x6570;&#x7EC4;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Tree2</span>&lt;Key&gt; {</span><br><span class="line">  Key[] keys;</span><br><span class="line">  <span class="type">int</span>[] parents;</span><br><span class="line">  ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure></li>
</ul></li>
</ul>
<p><img src="/2024/05/31/13.2.Heap%20Structure/image-4.png"></p>
<p>&#x2003;&#x2003;&#x5F53;&#x6211;&#x4EEC;&#x5047;&#x5B9A;&#x6211;&#x4EEC;&#x7684;&#x5806;&#x662F;&#x5B8C;&#x5168;&#x7684;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x53EA;&#x7528;&#x4E00;&#x4E2A;&#x4E00;&#x7EF4;&#x6570;&#x7EC4;&#x6765;&#x8868;&#x793A;&#xFF1A; *
<span class="math inline">\(Approach\;3\)</span> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TreeC</span>&lt;Key&gt; {</span><br><span class="line">  Key[] keys;</span><br><span class="line">  ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p><img src="/2024/05/31/13.2.Heap%20Structure/image-5.png"></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x79CD;&#x6811;&#x7684;&#x8868;&#x793A;&#x65B9;&#x6CD5;&#x5341;&#x5206;&#x7B80;&#x4FBF;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x5806;&#x7684;&#x5B9E;&#x73B0;&#x4E2D;&#x5C06;&#x4F7F;&#x7528;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x3002;</p>
<h3 id="3swim&#x65B9;&#x6CD5;">3.<code>swim</code>&#x65B9;&#x6CD5;</h3>
<p>&#x2003;&#x2003;&#x5728;&#x5806;&#x7684;&#x6784;&#x5EFA;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x5982;&#x4E0B;&#x7684;<code>swim</code>&#x65B9;&#x6CD5;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">swim</span><span class="params">(<span class="type">int</span> k)</span> {</span><br><span class="line">    <span class="keyword">if</span> (keys[parent(k)] &#x227B; keys[k]) {</span><br><span class="line">       swap(k, parent(k));</span><br><span class="line">       swim(parent(k));              </span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5982;&#x679C;&#x5BF9;<span class="math inline">\(Approach\;3\)</span>&#x8FDB;&#x884C;&#x89C2;&#x5BDF;&#x7684;&#x8BDD;&#xFF0C;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x5982;&#x4E0B;&#x89C4;&#x5F8B;&#xFF1A;</p>
<p><span class="math display">\[
\begin{cases}
parent=i\\
leftchild=2i+1\\
rightchild=2i+2
\end{cases}
\]</span></p>
<p>&#x2003;&#x2003;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x8BA9;&#x6570;&#x7EC4;&#x7684;<span class="math inline">\(0\)</span>&#x4F4D;&#x7F6E;&#x4E3A;&#x7A7A;(&#x4E0D;&#x653E;&#x7F6E;&#x5143;&#x7D20;)&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x66F4;&#x7B80;&#x6D01;&#x7684;&#x89C4;&#x5F8B;&#xFF1A;</p>
<p><span class="math display">\[
\begin{cases}
parent=i\\
leftchild=2i\\
rightchild=2i+1
\end{cases}
\]</span></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5C06;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x5143;&#x7D20;&#x4E0E;&#x6811;&#x4E0A;&#x7684;&#x5143;&#x7D20;&#x4E00;&#x4E00;&#x5BF9;&#x5E94;&#x4E86;&#x3002;</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/13.3.The%20Implementation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/13.3.The%20Implementation/" class="post-title-link" itemprop="url">13.3.&#x4F18;&#x5148;&#x961F;&#x5217;&#x7684;&#x5B9E;&#x73B0;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 21:13:13" itemprop="dateModified" datetime="2024-06-02T21:13:13+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/13-Heap-Priority-Queue/" itemprop="url" rel="index"><span itemprop="name">13.Heap &amp; Priority Queue</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>315</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="133&#x4F18;&#x5148;&#x961F;&#x5217;&#x7684;&#x5B9E;&#x73B0;"><span class="math inline">\(13.3\)</span>&#x4F18;&#x5148;&#x961F;&#x5217;&#x7684;&#x5B9E;&#x73B0;</h1>
<p>(&#x6CE8;&#xFF1A;&#x8FD9;&#x91CC;&#x5B9E;&#x73B0;&#x7684;&#x662F;&#x5927;&#x6839;&#x5806;)</p>
<h3 id="1&#x4F18;&#x5148;&#x961F;&#x5217;&#x7684;&#x521D;&#x59CB;&#x5316;">1.&#x4F18;&#x5148;&#x961F;&#x5217;&#x7684;&#x521D;&#x59CB;&#x5316;</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MaxPQ</span>&lt;Key <span class="keyword">extends</span> <span class="title class_">Comparable</span>&lt;Key&gt;&gt; </span><br><span class="line">{</span><br><span class="line">    <span class="keyword">private</span> Key[] pq; <span class="comment">// heap-ordered complete binary tree</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">N</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">// in pq[1..N] with pq[0] unused</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MaxPQ</span><span class="params">(<span class="type">int</span> maxN)</span> { </span><br><span class="line">        pq = (Key[]) <span class="keyword">new</span> <span class="title class_">Comparable</span>[maxN+<span class="number">1</span>]; </span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> { </span><br><span class="line">        <span class="keyword">return</span> N == <span class="number">0</span>; </span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span> { </span><br><span class="line">        <span class="keyword">return</span> N; </span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(Key v)</span> { </span><br><span class="line">        pq[++N] = v;</span><br><span class="line">        swim(N);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Key <span class="title function_">delMax</span><span class="params">()</span> { </span><br><span class="line">        <span class="type">Key</span> <span class="variable">max</span> <span class="operator">=</span> pq[<span class="number">1</span>]; <span class="comment">// Retrieve max key from top.</span></span><br><span class="line">        swap(<span class="number">1</span>, N--); <span class="comment">// Exchange with last item.</span></span><br><span class="line">        pq[N+<span class="number">1</span>] = <span class="literal">null</span>; <span class="comment">// Avoid loitering.</span></span><br><span class="line">        sink(<span class="number">1</span>); <span class="comment">// Restore heap property.</span></span><br><span class="line">        <span class="keyword">return</span> max;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">less</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swim</span><span class="params">(<span class="type">int</span> k)</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sink</span><span class="params">(<span class="type">int</span> k)</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="2&#x8F85;&#x52A9;&#x65B9;&#x6CD5;&#x7684;&#x5B9E;&#x73B0;">2.&#x8F85;&#x52A9;&#x65B9;&#x6CD5;&#x7684;&#x5B9E;&#x73B0;</h3>
<h4 id="aless-swap&#x65B9;&#x6CD5;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span><code>less</code>&#x3001;<code>swap</code>&#x65B9;&#x6CD5;</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">less</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> {</span><br><span class="line">    <span class="keyword">return</span> pq[i].compareTo(pq[j]) &lt; <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> {</span><br><span class="line">    <span class="type">Ket</span> <span class="variable">t</span> <span class="operator">=</span> pq[i];</span><br><span class="line">    pq[i] = pq[j];</span><br><span class="line">    pq[j] = t;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h4 id="bswim&#x65B9;&#x6CD5;">&#x2003;&#x2003;<span class="math inline">\(b.\)</span><code>swim</code>&#x65B9;&#x6CD5;</h4>
<p>&#x2003;&#x2003;<code>swim</code>&#x65B9;&#x6CD5;&#x7528;&#x4E8E;&#x5C06;&#x5806;&#x5E95;&#x90E8;&#x7684;&#x5143;&#x7D20;&#x5411;&#x4E0A;&#x6D04;&#x6E38;&#xFF0C;&#x4EE5;&#x7EF4;&#x62A4;&#x5806;&#x7684;&#x6027;&#x8D28;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swim</span><span class="params">(<span class="type">int</span> k)</span> {</span><br><span class="line">    <span class="keyword">while</span> (k &gt; <span class="number">1</span> &amp;&amp; less(k / <span class="number">2</span>, k)) {</span><br><span class="line">        swap(k / <span class="number">2</span>, k);</span><br><span class="line">        k = k / <span class="number">2</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p><img src="/2024/05/31/13.3.The%20Implementation/image-7.png"></p>
<h4 id="csink&#x65B9;&#x6CD5;">&#x2003;&#x2003;<span class="math inline">\(c.\)</span><code>sink</code>&#x65B9;&#x6CD5;</h4>
<p>&#x2003;&#x2003;<code>sink</code>&#x65B9;&#x6CD5;&#x7528;&#x4E8E;&#x5C06;&#x5806;&#x9876;&#x90E8;&#x7684;&#x5143;&#x7D20;&#x4E0B;&#x6C89;&#xFF0C;&#x4EE5;&#x7EF4;&#x62A4;&#x5806;&#x7684;&#x6027;&#x8D28;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sink</span><span class="params">(<span class="type">int</span> k)</span> {</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">2</span> * k &lt;= N) {</span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">2</span> * k;</span><br><span class="line">        <span class="comment">//assure that the parent is the biggest of its children</span></span><br><span class="line">        <span class="keyword">if</span> (j &lt; N &amp;&amp; less(j, j + <span class="number">1</span>)) {</span><br><span class="line">            swap (j, j + <span class="number">1</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (!less(k, j)) {</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        swap (k, j);</span><br><span class="line">        k = j;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p><img src="/2024/05/31/13.3.The%20Implementation/image-6.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/15.2.Implementation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/15.2.Implementation/" class="post-title-link" itemprop="url">15.2.Trie&#x7684;&#x5B9E;&#x73B0;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 21:17:56" itemprop="dateModified" datetime="2024-06-02T21:17:56+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/15-Tries/" itemprop="url" rel="index"><span itemprop="name">15.Tries</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>771</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>3 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="152trie&#x7684;&#x5B9E;&#x73B0;"><span class="math inline">\(15.2\)</span><span class="math inline">\(Trie\)</span>&#x7684;&#x5B9E;&#x73B0;</h1>
<h3 id="1trie&#x7684;&#x4ECB;&#x7ECD;">1.<span class="math inline">\(Trie\)</span>&#x7684;&#x4ECB;&#x7ECD;</h3>
<p>&#x2003;&#x2003;&#x5728;<span class="math inline">\(Trie\)</span>&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x7684;&#x8BA1;&#x7B56;&#x6765;&#x5B58;&#x50A8;&#x4E00;&#x7CFB;&#x5217;&#x5355;&#x8BCD;(&#x5B57;&#x7B26;&#x4E32;)&#xFF1A;</p>
<ol type="1">
<li>&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x53EA;&#x5B58;&#x50A8;&#x4E00;&#x4E2A;&#x5B57;&#x6BCD;&#x3002;</li>
<li>&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x53EF;&#x4EE5;&#x88AB;&#x591A;&#x4E2A;&#x952E;&#x5171;&#x7528;&#x3002;</li>
</ol>
<p>&#x2003;&#x2003;&#x4E0B;&#x9762;&#x7684;&#x6811;&#x7ED3;&#x6784;&#x5373;&#x662F;&#x4E00;&#x7EC4;&#x5355;&#x8BCD;&#x7684;<span class="math inline">\(Trie\)</span>&#xFF0C;&#x84DD;&#x8272;&#x610F;&#x5473;&#x7740;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5355;&#x8BCD;&#x7684;&#x7ED3;&#x5C3E;&#xFF1A;</p>
<p><img src="/2024/05/31/15.2.Implementation/image.png"></p>
<p>&#x2003;&#x2003;&#x540C;&#x6837;&#x5730;&#xFF0C;<span class="math inline">\(Trie\)</span>&#x4EA6;&#x53EF;&#x7528;&#x4F5C;<span class="math inline">\(map\)</span>&#xFF1A;</p>
<p><img src="/2024/05/31/15.2.Implementation/image-1.png"></p>
<p>&#x2003;&#x2003;&#x9700;&#x8981;&#x6CE8;&#x610F;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5904;&#x7406;&#x67D0;&#x4E2A;&#x7279;&#x5B9A;(<span class="math inline">\(specificity\)</span>)&#x7684;&#x95EE;&#x9898;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6539;&#x8FDB;&#x6211;&#x4EEC;&#x539F;&#x6709;&#x7684;&#x3001;&#x901A;&#x7528;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;(&#x901A;&#x5E38;&#x662F;&#x5BF9;&#x5176;&#x52A0;&#x4EE5;&#x9650;&#x5236;(<span class="math inline">\(constraint\)</span>))&#xFF0C;&#x6765;&#x66F4;&#x597D;&#x5730;&#x5B9E;&#x73B0;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x7684;&#x529F;&#x80FD;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x7528;<span class="math inline">\(HashMap\)</span>&#x6765;&#x5B9E;&#x73B0;&#x5BF9;&#x5355;&#x8BCD;&#x7684;&#x5B58;&#x653E;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x7684;&#x67E5;&#x627E;&#x5C31;&#x9700;&#x8981;&#x904D;&#x5386;&#x6240;&#x6709;&#x5DF2;&#x6709;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x6548;&#x7387;&#x663E;&#x7136;&#x5F88;&#x4F4E;&#x3002;</p>
<ul>
<li><p><span class="math inline">\(ADT\)</span>&#x4E0E;&#x7279;&#x6B8A;&#x5B9E;&#x73B0;(<span class="math inline">\(specific\;implementations\)</span>)&#x662F;&#x6709;&#x533A;&#x522B;&#x7684;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5E76;&#x67E5;&#x96C6;&#x662F;&#x4E00;&#x79CD;<span class="math inline">\(ADT\)</span>&#xFF0C;&#x5B83;&#x5177;&#x6709;<code>connect(x, y)</code>&#x4E0E;<code>isConnected(x, y)</code>&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;&#x3002;&#x800C;&#x8FD9;&#x6765;&#x4E2A;&#x65B9;&#x6CD5;&#x6709;&#x56DB;&#x79CD;&#x4E0D;&#x540C;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#xFF1A;<span class="math inline">\(Quick\;find\)</span>&#x3001;<span class="math inline">\(Quick\;union\)</span>&#x3001;<span class="math inline">\(Weight\;QU\)</span>&#x3001;<span class="math inline">\(WQUPC\)</span>&#x3002;</p></li>
<li><p>&#x5728;&#x8FD9;&#x91CC;&#xFF0C;<span class="math inline">\(Trie\)</span>&#x5C31;&#x662F;&#x5F53;<span class="math inline">\(Set\)</span>&#x6216;<span class="math inline">\(Map\)</span>&#x5B58;&#x50A8;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x662F;&#x5B57;&#x7B26;&#x4E32;&#x65F6;&#x7684;&#x7279;&#x6B8A;&#x5B9E;&#x73B0;&#xFF1A;</p>
<ul>
<li>We give each node a single character and each node can be a part of
several keys inside of the trie.</li>
<li>Searching will only fail if we hit an unmarked node or we fall off
the tree</li>
<li>Short for Retrieval tree, almost everyone pronounces it as &quot;try&quot; but
Edward Fredkin suggested it be pronounced as &quot;tree&quot;</li>
</ul></li>
</ul>
<h3 id="2trie&#x7684;&#x6784;&#x5EFA;">2.<span class="math inline">\(Trie\)</span>&#x7684;&#x6784;&#x5EFA;</h3>
<p>&#x2003;&#x2003;&#x5229;&#x7528;&#x5148;&#x524D;&#x7684;&#x7B56;&#x7565;&#xFF0C;&#x6211;&#x4EEC;&#x8BA9;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x5B58;&#x50A8;&#x5B57;&#x6BCD;&#x3001;&#x5B69;&#x5B50;&#x548C;&#x989C;&#x8272;&#x3002;&#x7531;&#x4E8E;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x90FD;&#x662F;&#x4E00;&#x4E2A;&#x5B57;&#x6BCD;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;<code>DataIndexedCharMap</code>&#x6765;&#x5B58;&#x50A8;&#x8282;&#x70B9;&#x7684;&#x6240;&#x6709;&#x5B69;&#x5B50;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataIndexedCharMap</span>&lt;V&gt; {</span><br><span class="line">    <span class="keyword">private</span> V[] items;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DataIndexedCharMap</span><span class="params">(<span class="type">int</span> R)</span> {</span><br><span class="line">        items = (V[]) <span class="keyword">new</span> <span class="title class_">Object</span>[R];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(<span class="type">char</span> c, V val)</span> {</span><br><span class="line">        items[c] = val;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> V <span class="title function_">get</span><span class="params">(<span class="type">char</span> c)</span> {</span><br><span class="line">        <span class="keyword">return</span> items[c];</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TrieSet</span> {</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">R</span> <span class="operator">=</span> <span class="number">128</span>; <span class="comment">// ASCII</span></span><br><span class="line">   <span class="keyword">private</span> Node root;    <span class="comment">// root of trie</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span> {</span><br><span class="line">      <span class="keyword">private</span> <span class="type">char</span> ch;  </span><br><span class="line">      <span class="keyword">private</span> <span class="type">boolean</span> isKey;   </span><br><span class="line">      <span class="keyword">private</span> DataIndexedCharMap next;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">private</span> <span class="title function_">Node</span><span class="params">(<span class="type">char</span> c, <span class="type">boolean</span> blue, <span class="type">int</span> R)</span> {</span><br><span class="line">         ch = c; </span><br><span class="line">         isKey = blue;</span><br><span class="line">         next = <span class="keyword">new</span> <span class="title class_">DataIndexedCharMap</span>&lt;Node&gt;(R);</span><br><span class="line">      }</span><br><span class="line">   }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p><img src="/2024/05/31/15.2.Implementation/image-2.png"></p>
<p>&#x2003;&#x2003;&#x7136;&#x800C;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x7684;&#x8282;&#x70B9;&#x53EA;&#x6709;&#x5F88;&#x5C11;&#x7684;&#x5B69;&#x5B50;&#x65F6;&#xFF0C;&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x4E86;<span class="math inline">\(128\)</span>&#x4E2A;&#x7A7A;&#x95F4;&#xFF0C;&#x53EA;&#x6709;&#x5F88;&#x5C11;&#x7684;&#x7A7A;&#x95F4;&#x662F;&#x771F;&#x6B63;&#x88AB;&#x4F7F;&#x7528;&#x7684;&#x3002;</p>
<p>&#x2003;&#x2003;&#x6CE8;&#x610F;&#x5230;&#x4E24;&#x4E2A;&#x8282;&#x70B9;&#x95F4;&#x5B58;&#x5728;&#x94FE;&#x63A5;&#x5F53;&#x4E14;&#x4EC5;&#x5F53;&#x4E24;&#x4E2A;&#x8282;&#x70B9;&#x90FD;&#x5B58;&#x50A8;&#x4E86;&#x5B57;&#x7B26;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5220;&#x6389;<span class="math inline">\(Node\)</span>&#x7684;<span class="math inline">\(ch\)</span>&#x53D8;&#x91CF;&#xFF0C;&#x800C;&#x7528;&#x8BE5;&#x8282;&#x70B9;&#x5728;&#x7236;&#x8282;&#x70B9;&#x7684;<span class="math inline">\(next\)</span>&#x4E2D;&#x7684;&#x4F4D;&#x7F6E;&#x6765;&#x8868;&#x5F81;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TrieSet</span> {</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">R</span> <span class="operator">=</span> <span class="number">128</span>; <span class="comment">// ASCII</span></span><br><span class="line">   <span class="keyword">private</span> Node root;    <span class="comment">// root of trie</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span> {</span><br><span class="line">      <span class="keyword">private</span> <span class="type">boolean</span> isKey;   </span><br><span class="line">      <span class="keyword">private</span> DataIndexedCharMap next;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">private</span> <span class="title function_">Node</span><span class="params">(<span class="type">boolean</span> blue, <span class="type">int</span> R)</span> {</span><br><span class="line">         isKey = blue;</span><br><span class="line">         next = <span class="keyword">new</span> <span class="title class_">DataIndexedCharMap</span>&lt;Node&gt;(R);</span><br><span class="line">      }</span><br><span class="line">   }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p><img src="/2024/05/31/15.2.Implementation/image-3.png"></p>
<p>&#x2003;&#x2003;&#x540C;&#x65F6;&#xFF0C;&#x4E3A;&#x4E86;&#x51CF;&#x5C11;&#x7A7A;&#x95F4;&#x6D6A;&#x8D39;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;<span class="math inline">\(HashMap\)</span>&#x4EE3;&#x66FF;<span class="math inline">\(DataIndexedCharMap\)</span>&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TrieSet</span> {</span><br><span class="line">    <span class="keyword">private</span> Node root;    <span class="comment">// root of trie</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span> {</span><br><span class="line">        <span class="keyword">private</span> <span class="type">boolean</span> isKey;</span><br><span class="line">        <span class="keyword">private</span> Map&lt;Character, Node&gt; next;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">Node</span><span class="params">(<span class="type">boolean</span> isKey)</span> {</span><br><span class="line">            <span class="built_in">this</span>.isKey = isKey;</span><br><span class="line">            <span class="built_in">this</span>.next = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h3 id="3trie&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x95F4;">3.<span class="math inline">\(Trie\)</span>&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x95F4;</h3>
<p>&#x2003;&#x2003;&#x7ED9;&#x5B9A;&#x5B57;&#x7B26;&#x4E32;&#x7684;<span class="math inline">\(Trie\)</span>&#xFF0C;&#x5176;&#x5BF9;&#x5E94;&#x7684;<span class="math inline">\(Map\)</span>&#x3001;<span class="math inline">\(Set\)</span>&#x64CD;&#x4F5C;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li><code>add</code>&#xFF1A;<span class="math inline">\(\Theta(1)\)</span></li>
<li><code>contains</code>&#xFF1A;<span class="math inline">\(\Theta(1)\)</span></li>
</ul>
<p>&#x2003;&#x2003;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;<span class="math inline">\(Trie\)</span>&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x53EA;&#x53D6;&#x51B3;&#x4E8E;&#x5355;&#x8BCD;&#x7684;&#x957F;&#x5EA6;&#xFF0C;&#x800C;&#x4E0E;<span class="math inline">\(Trie\)</span>&#x4E2D;&#x952E;&#x7684;&#x591A;&#x5C11;&#x65E0;&#x5173;&#x3002;&#x6211;&#x4EEC;&#x5728;&#x67E5;&#x8BE2;&#x65F6;&#x53EA;&#x4F1A;&#x904D;&#x5386;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7684;&#x5355;&#x8BCD;&#x3002;</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/15.3.Trie%20String%20Operations/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/15.3.Trie%20String%20Operations/" class="post-title-link" itemprop="url">15.3.&#x5B57;&#x7B26;&#x4E32;&#x64CD;&#x4F5C;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 21:17:56" itemprop="dateModified" datetime="2024-06-02T21:17:56+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/15-Tries/" itemprop="url" rel="index"><span itemprop="name">15.Tries</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>424</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="153&#x5B57;&#x7B26;&#x4E32;&#x64CD;&#x4F5C;"><span class="math inline">\(15.3\)</span>&#x5B57;&#x7B26;&#x4E32;&#x64CD;&#x4F5C;</h1>
<h3 id="1&#x952E;&#x7684;&#x6536;&#x96C6;&#x4E0E;&#x524D;&#x7F00;&#x5339;&#x914D;">1.&#x952E;&#x7684;&#x6536;&#x96C6;&#x4E0E;&#x524D;&#x7F00;&#x5339;&#x914D;</h3>
<p>&#x2003;&#x2003;&#x7531;&#x4E8E;&#x5728;<span class="math inline">\(trie\)</span>&#x4E2D;&#xFF0C;&#x5B57;&#x7B26;&#x548C;&#x952E;(<span class="math inline">\(key\)</span>)&#x90FD;&#x662F;&#x88AB;&#x9690;&#x6027;&#x8868;&#x793A;&#x7684;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x60F3;&#x8BA9;&#x6211;&#x4EEC;&#x7684;&#x952E;&#x53D8;&#x5F97;&#x53EF;&#x8FED;&#x4EE3;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x80FD;&#x53EA;&#x5728;<span class="math inline">\(trie\)</span>&#x4E2D;&#x76F4;&#x63A5;&#x5BFB;&#x627E;&#x5B83;&#x4EEC;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;&#x4E00;&#x4E2A;&#x53EF;&#x8FED;&#x4EE3;&#x7684;<code>collect</code>&#x65B9;&#x6CD5;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x4F1A;&#x7EF4;&#x62A4;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x5B83;&#x7528;&#x4E8E;&#x50A8;&#x5B58;&#x8DEF;&#x5F84;&#x4E0A;&#x7684;&#x5B57;&#x7B26;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">get</span><span class="params">(String key)</span> {</span><br><span class="line">    <span class="type">Node</span> <span class="variable">x</span> <span class="operator">=</span> get(root, key, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (x == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">return</span> x.value;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Node <span class="title function_">get</span><span class="params">(Node x, String key, <span class="type">int</span> d)</span> {</span><br><span class="line">    <span class="keyword">if</span> (x == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (d == key.length()) <span class="keyword">return</span> x;</span><br><span class="line">    <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> key.charAt(d);<span class="comment">// use dth key char of key to find subtrie</span></span><br><span class="line">    <span class="keyword">return</span> get(x.next[c], key, d + <span class="number">1</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Iterable&lt;String&gt; <span class="title function_">keys</span><span class="params">()</span> { </span><br><span class="line">    <span class="keyword">return</span> keysWithPrefix(<span class="string">&quot;&quot;</span>); </span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//collect keys in a trie.</span></span><br><span class="line"><span class="comment">//the &quot;get&quot; method will return the node containing the prefix</span></span><br><span class="line"><span class="comment">//so we can collect any string that starts from this node</span></span><br><span class="line"><span class="keyword">public</span> Iterable&lt;String&gt; <span class="title function_">keysWithPrefix</span><span class="params">(String pre)</span> {</span><br><span class="line">    Queue&lt;String&gt; q = <span class="keyword">new</span> <span class="title class_">Queue</span>&lt;String&gt;();</span><br><span class="line">    collect(get(root, pre, <span class="number">0</span>), pre, q);</span><br><span class="line">    <span class="keyword">return</span> q;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">collect</span><span class="params">(Node x, String pre, Queue&lt;String&gt; q)</span> {</span><br><span class="line">    <span class="keyword">if</span> (x == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (x.value != <span class="literal">null</span>) q.enqueue(pre);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> <span class="number">0</span>; c &lt; R; c += <span class="number">1</span>) {</span><br><span class="line">        collect(x.next[c], pre + c, q);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x6574;&#x4E2A;&#x641C;&#x7D22;&#x952E;&#x7684;&#x8FC7;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="/2024/05/31/15.3.Trie%20String%20Operations/image-4.png"></p>
<p>&#x2003;&#x2003;<code>keysWithPrefix</code>&#x65B9;&#x6CD5;&#x7684;&#x6267;&#x884C;&#x8FC7;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="/2024/05/31/15.3.Trie%20String%20Operations/image-5.png"></p>
<h3 id="2&#x901A;&#x914D;&#x7B26;&#x5339;&#x914D;">2.&#x901A;&#x914D;&#x7B26;&#x5339;&#x914D;</h3>
<p>&#x2003;&#x2003;&#x4E3A;&#x4E86;&#x5B9E;&#x73B0;<code>keysThatMatch()</code>&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x7C7B;&#x4F3C;&#x7684;&#x7A0B;&#x5E8F;&#xFF0C;&#x4F46;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x53C2;&#x6570;<span class="math inline">\(pat\)</span>&#x6765;&#x8868;&#x793A;&#x6211;&#x4EEC;&#x9700;&#x8981;<span class="math inline">\(collect()\)</span>&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x3002;&#x5F53;&#x6A21;&#x5F0F;&#x5B57;&#x7B26;&#x662F;&#x901A;&#x914D;&#x7B26;(<span class="math inline">\(wildcard\)</span>)&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x8C03;&#x7528;&#x5B83;&#x7684;&#x6240;&#x6709;&#x94FE;&#x63A5;&#xFF1B;&#x5426;&#x5219;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x8C03;&#x7528;&#x548C;&#x901A;&#x914D;&#x7B26;&#x76F8;&#x5173;&#x7684;&#x94FE;&#x63A5;&#x3002;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Iterable&lt;String&gt; <span class="title function_">keysThatMatch</span><span class="params">(String pat)</span> {</span><br><span class="line">    Queue&lt;String&gt; q = <span class="keyword">new</span> <span class="title class_">Queue</span>&lt;String&gt;();</span><br><span class="line">    collect(root, <span class="string">&quot;&quot;</span>, pat, q);</span><br><span class="line">    <span class="keyword">return</span> q;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">collect</span><span class="params">(Node x, String pre, String pat, Queue&lt;String&gt; q)</span> {</span><br><span class="line">    <span class="type">int</span> <span class="variable">d</span> <span class="operator">=</span> pre.length();</span><br><span class="line">    <span class="keyword">if</span> (x == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (d == pat.length() &amp;&amp; x.val != <span class="literal">null</span>) q.enqueue(pre);</span><br><span class="line">    <span class="keyword">if</span> (d == pat.length()) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> <span class="variable">next</span> <span class="operator">=</span> pat.charAt(d);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> <span class="number">0</span>; c &lt; R; c += <span class="number">1</span>) {</span><br><span class="line">        <span class="keyword">if</span> (next == <span class="string">&apos;.&apos;</span> || next == c) {</span><br><span class="line">            collect(x.next[c]. pre + c, pat, q);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/16.1.QuadTrees/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/16.1.QuadTrees/" class="post-title-link" itemprop="url">16.1.&#x56DB;&#x53C9;&#x6811;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 21:25:26" itemprop="dateModified" datetime="2024-06-02T21:25:26+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/16-QuadTrees/" itemprop="url" rel="index"><span itemprop="name">16.QuadTrees</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>567</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="161&#x56DB;&#x53C9;&#x6811;"><span class="math inline">\(16.1\)</span>&#x56DB;&#x53C9;&#x6811;</h1>
<h3 id="1&#x95EE;&#x9898;&#x7684;&#x5F15;&#x5165;">1.&#x95EE;&#x9898;&#x7684;&#x5F15;&#x5165;</h3>
<p>&#x2003;&#x2003;&#x8003;&#x8651;&#x8FD9;&#x6837;&#x7684;&#x95EE;&#x9898;&#xFF1A;&#x7ED9;&#x5B9A;&#x4E0B;&#x9762;&#x4E00;&#x7CFB;&#x5217;&#x70B9;&#xFF0C;&#x6C42;&#x843D;&#x5165;&#x77E9;&#x5F62;&#x533A;&#x57DF;&#x7684;&#x70B9;&#x7684;&#x6570;&#x91CF;&#x3002;</p>
<p><img src="/2024/05/31/16.1.QuadTrees/image.png"></p>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x4E0D;&#x7528;&#x904D;&#x5386;&#x6240;&#x6709;&#x7684;&#x70B9;&#xFF0C;&#x4E00;&#x4E2A;&#x81EA;&#x7136;&#x7684;&#x60F3;&#x6CD5;&#x662F;&#x5229;&#x7528;<span class="math inline">\(BST\)</span>&#x7684;&#x6027;&#x8D28;&#x8FDB;&#x884C;&#x641C;&#x7D22;&#x3002;&#x5728;&#x5BF9;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x70B9;&#x5750;&#x6807;<span class="math inline">\((x,y)\)</span>&#x6784;&#x5EFA;<span class="math inline">\(BST\)</span>&#x65F6;&#x3002;&#x5BF9;&#x4E8E;&#x5355;&#x4E2A;&#x7684;<span class="math inline">\(x\)</span>&#x5750;&#x6807;&#x6216;<span class="math inline">\(y\)</span>&#x5750;&#x6807;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F88;&#x5BB9;&#x6613;&#x5730;&#x6784;&#x5EFA;&#x51FA;&#x5BF9;&#x5E94;&#x7684;<span class="math inline">\(BST\)</span>&#x3002;&#x4F46;&#x5BF9;&#x4E8E;&#x4E8C;&#x7EF4;&#x7684;&#x5750;&#x6807;&#xFF0C;&#x5F53;&#x4E00;&#x4E2A;&#x70B9;&#x7684;<span class="math inline">\(x\)</span>&#x5750;&#x6807;&#x5927;&#x4E8E;&#x53E6;&#x4E00;&#x4E2A;&#x70B9;&#x3001;&#x800C;<span class="math inline">\(y\)</span>&#x5750;&#x6807;&#x5C0F;&#x4E8E;&#x53E6;&#x4E00;&#x4E2A;&#x70B9;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x8BE5;&#x600E;&#x4E48;&#x6392;&#x5E8F;&#x5462;&#xFF1F;</p>
<h3 id="2&#x56DB;&#x53C9;&#x6811;">2.&#x56DB;&#x53C9;&#x6811;</h3>
<p>&#x2003;&#x2003;&#x8BE5;&#x95EE;&#x9898;&#x7684;&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#x4E3A;&#xFF1A;&#x8BA9;&#x6211;&#x4EEC;&#x7684;&#x6811;&#x4ECE;&#x56DB;&#x4E2A;&#x65B9;&#x5411;&#x540C;&#x65F6;(<span class="math inline">\(simultaneously\)</span>)&#x5206;&#x5272;&#x7A7A;&#x95F4;&#xFF0C;&#x5B9E;&#x73B0;&#x8FD9;&#x4E00;&#x64CD;&#x4F5C;&#x7684;&#x7ED3;&#x6784;&#x79F0;&#x4F5C;&#x56DB;&#x53C9;&#x6811;&#x3002;</p>
<h4 id="a&#x56DB;&#x53C9;&#x6811;&#x7684;&#x6784;&#x5EFA;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&#x56DB;&#x53C9;&#x6811;&#x7684;&#x6784;&#x5EFA;</h4>
<p>&#x2003;&#x2003;&#x56DB;&#x53C9;&#x6811;&#x5177;&#x6709;&#x56DB;&#x4E2A;&#x6307;&#x9488;&#xFF0C;&#x6BCF;&#x4E2A;&#x6307;&#x9488;&#x5206;&#x522B;&#x6307;&#x5411;&#x4E1C;&#x5357;&#x3001;&#x4E1C;&#x5317;&#x3001;&#x897F;&#x5357;&#x3001;&#x897F;&#x5317;&#x533A;&#x57DF;&#x3002;&#x5047;&#x5982;&#x6211;&#x4EEC;&#x4EE5;<span class="math inline">\(A\)</span>&#x4E3A;&#x6839;&#x8282;&#x70B9;&#xFF0C;&#x5219;&#x521D;&#x59CB;&#x7684;&#x56DB;&#x53C9;&#x6811;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="/2024/05/31/16.1.QuadTrees/image-1.png"></p>
<p>&#x2003;&#x2003;&#x5BF9;&#x5E94;&#x7684;&#x4E8C;&#x7EF4;&#x7A7A;&#x95F4;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="/2024/05/31/16.1.QuadTrees/image-2.png"></p>
<p>&#x2003;&#x2003;&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x6211;&#x4EEC;&#x63D2;&#x5165;<span class="math inline">\(B(2,2)\)</span>&#x8FD9;&#x4E2A;&#x8282;&#x70B9;&#x3002;&#x7531;&#x4E8E;<span class="math inline">\(B\)</span>&#x5728;<span class="math inline">\(A\)</span>&#x7684;&#x4E1C;&#x5317;&#x65B9;&#x5411;&#xFF0C;<span class="math inline">\(A\)</span>&#x7684;<span class="math inline">\(NE\)</span>&#x6307;&#x9488;&#x6307;&#x5411;<span class="math inline">\(B\)</span>&#xFF1A;</p>
<p><img src="/2024/05/31/16.1.QuadTrees/image-3.png"></p>
<p>&#x2003;&#x2003;&#x6B64;&#x65F6;&#x5BF9;&#x5E94;&#x7684;&#x4E8C;&#x7EF4;&#x7A7A;&#x95F4;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="/2024/05/31/16.1.QuadTrees/image-4.png"></p>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x4EE5;&#x540C;&#x6837;&#x5730;&#x65B9;&#x5F0F;&#x63D2;&#x5165;<span class="math inline">\(C\)</span>&#x3001;<span class="math inline">\(D\)</span>&#x3001;<span class="math inline">\(E\)</span>&#xFF0C;&#x53EF;&#x5F97;&#x5230;&#x4EE5;&#x4E0B;&#x7684;&#x56DB;&#x53C9;&#x6811;&#x548C;&#x4E8C;&#x7EF4;&#x7A7A;&#x95F4;&#xFF1A;</p>
<p><img src="/2024/05/31/16.1.QuadTrees/image-5.png"></p>
<p><img src="/2024/05/31/16.1.QuadTrees/image-6.png"></p>
<h4 id="b&#x56DB;&#x53C9;&#x6811;&#x7684;&#x641C;&#x7D22;">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>&#x56DB;&#x53C9;&#x6811;&#x7684;&#x641C;&#x7D22;</h4>
<p>&#x2003;&#x2003;&#x56DE;&#x5230;&#x5F00;&#x7BC7;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x7528;&#x6211;&#x4EEC;&#x6784;&#x5EFA;&#x7684;&#x56DB;&#x53C9;&#x6811;&#x6765;&#x641C;&#x7D22;&#x7B26;&#x5408;&#x6761;&#x4EF6;&#x7684;&#x8282;&#x70B9;&#x3002;</p>
<ol type="1">
<li>&#x4ECE;&#x6839;&#x8282;&#x70B9;<span class="math inline">\(A\)</span>&#x5F00;&#x59CB;&#x641C;&#x7D22;&#x3002;<span class="math inline">\(A\)</span>&#x4E0D;&#x5C5E;&#x4E8E;&#x77E9;&#x5F62;&#x533A;&#x57DF;&#xFF0C;&#x6545;&#x8FD4;&#x56DE;<span class="math inline">\(null\)</span>&#x3002;</li>
<li>&#x7136;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x8003;&#x8651;&#xFF1A;<span class="math inline">\(A\)</span>&#x7684;&#x54EA;&#x4E2A;&#x5B50;&#x7A7A;&#x95F4;(<span class="math inline">\(subspace\)</span>)&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x7B26;&#x5408;&#x6761;&#x4EF6;&#x7684;&#x70B9;&#xFF1F;&#x7531;&#x4E8E;&#x77E9;&#x5F62;&#x533A;&#x57DF;&#x5728;<span class="math inline">\(A\)</span>&#x7684;&#x4E1C;&#x5317;&#x65B9;&#x5411;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x641C;&#x7D22;<span class="math inline">\(A\)</span>&#x7684;<span class="math inline">\(NE\)</span>&#x5B50;&#x6811;&#xFF1A;</li>
</ol>
<p><img src="/2024/05/31/16.1.QuadTrees/image-7.png"></p>
<ol start="3" type="1">
<li>&#x63A5;&#x7740;&#x6211;&#x4EEC;&#x641C;&#x7D22;<span class="math inline">\(B\)</span>&#x8282;&#x70B9;&#xFF0C;<span class="math inline">\(B\)</span>&#x5728;&#x77E9;&#x5F62;&#x533A;&#x57DF;&#x5185;&#xFF0C;&#x6240;&#x4EE5;&#x8FD4;&#x56DE;&#x5B83;&#x7684;&#x5750;&#x6807;&#x3002;</li>
<li>&#x63A5;&#x7740;&#x6211;&#x4EEC;&#x8003;&#x8651;&#xFF1A;<span class="math inline">\(B\)</span>&#x7684;&#x54EA;&#x4E2A;&#x5B50;&#x7A7A;&#x95F4;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x7B26;&#x5408;&#x6761;&#x4EF6;&#x7684;&#x70B9;&#xFF1F;&#x53EF;&#x4EE5;&#x770B;&#x5230;<span class="math inline">\(B\)</span>&#x7684;&#x56DB;&#x4E2A;&#x65B9;&#x5411;&#x90FD;&#x7B26;&#x5408;&#x6761;&#x4EF6;&#x3002;</li>
<li>......</li>
</ol>
<p>&#x2003;&#x2003;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x56DB;&#x53C9;&#x6811;&#x5177;&#x6709;&#x826F;&#x597D;&#x7684;&#x526A;&#x679D;(<span class="math inline">\(pruning\)</span>)&#x6548;&#x679C;&#xFF0C;&#x8FD9;&#x63D0;&#x9AD8;&#x4E86;&#x6211;&#x4EEC;&#x7684;&#x641C;&#x7D22;&#x6548;&#x7387;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x9012;&#x5F52;&#x8FDB;&#x884C;&#x6211;&#x4EEC;&#x7684;&#x641C;&#x7D22;&#x6D41;&#x7A0B;&#x3002;</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/16.2.K-D%20Trees/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/16.2.K-D%20Trees/" class="post-title-link" itemprop="url">16.2.K-D&#x6811;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 21:25:26" itemprop="dateModified" datetime="2024-06-02T21:25:26+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/16-QuadTrees/" itemprop="url" rel="index"><span itemprop="name">16.QuadTrees</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>415</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="162k-dtrees"><span class="math inline">\(16.2\)</span><span class="math inline">\(K-D\;Trees\)</span></h1>
<h3 id="1&#x5F15;&#x5165;">1.&#x5F15;&#x5165;</h3>
<p>&#x2003;&#x2003;&#x5BF9;&#x4E8E;&#x4E8C;&#x7EF4;&#x7684;&#x7A7A;&#x95F4;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x56DB;&#x53C9;&#x6811;&#x5B8C;&#x6210;&#x641C;&#x7D22;&#x3002;&#x90A3;&#x5BF9;&#x4E8E;&#x66F4;&#x9AD8;&#x7EF4;&#x7684;&#x7A7A;&#x95F4;&#x5462;&#xFF1F;&#x6BD4;&#x5982;&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;</p>
<ul>
<li><p>Example: Want to find songs with the following features:</p>
<ul>
<li>Length between 3 minutes and 6 minutes.</li>
<li>Between 1000 and 20,000 listens.</li>
<li>Between 120 to 150 BPM.</li>
<li>Were recorded after 2004.</li>
</ul></li>
</ul>
<p>&#x2003;&#x2003;&#x8FD9;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x91C7;&#x7528;<span class="math inline">\(K-D\;Tree\)</span>&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x6765;&#x5BF9;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x5212;&#x5206;&#xFF0C;&#x4ECE;&#x800C;&#x4F18;&#x5316;&#x641C;&#x7D22;&#x3002;</p>
<h4 id="2k-d&#x6811;&#x7684;&#x539F;&#x7406;&#x4E0E;&#x6784;&#x9020;">2.<span class="math inline">\(K-D\)</span>&#x6811;&#x7684;&#x539F;&#x7406;&#x4E0E;&#x6784;&#x9020;</h4>
<p>&#x2003;&#x2003;&#x4EE5;&#x4E8C;&#x7EF4;&#x5750;&#x6807;&#x4E3A;&#x4F8B;&#xFF0C;&#x6211;&#x4EEC;&#x6309;&#x7167;&#x4EE5;&#x4E0B;&#x7684;&#x89C4;&#x5219;&#x6784;&#x5EFA;<span class="math inline">\(K-D\;Tree\)</span>&#xFF1A;</p>
<ul>
<li><p>Each level has a &quot;cutting dimension&quot;</p></li>
<li><p>Cycle through the dimensions as you walk down the tree.</p></li>
<li><p>Each node contains a point P = (x,y)</p></li>
<li><p>To find (x&apos;,y&apos;) you only compare coordinate from the cutting
dimension</p>
<ul>
<li>e.g. if cutting dimension is x, then you ask: is x&#x2019; &lt; x</li>
</ul></li>
</ul>
<p>&#x2003;&#x2003;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x90FD;&#x62E5;&#x6709;&#x4E24;&#x4E2A;&#x5B50;&#x7A7A;&#x95F4;&#x3002;&#x5728;&#x641C;&#x7D22;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x50CF;&#x5728;&#x56DB;&#x53C9;&#x6811;&#x4E2D;&#x505A;&#x7684;&#x4E00;&#x6837;&#xFF0C;&#x53EA;&#x5728;&#x53EF;&#x80FD;&#x6709;&#x6700;&#x4F18;&#x89E3;&#x7684;&#x5B50;&#x7A7A;&#x95F4;&#x8FDB;&#x884C;&#x641C;&#x7D22;&#x3002;</p>
<p>&#x2003;&#x2003;&#x4F8B;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5982;&#x4E0B;&#x63D2;&#x5165;&#x4EE5;&#x4E0B;&#x5750;&#x6807;&#xFF1A;</p>
<p><img src="/2024/05/31/16.2.K-D%20Trees/image-8.png"></p>
<h4 id="3k-d&#x6811;&#x7684;&#x641C;&#x7D22;">3.<span class="math inline">\(K-D\)</span>&#x6811;&#x7684;&#x641C;&#x7D22;</h4>
<p>&#x2003;&#x2003;&#x4EE5;&#x641C;&#x7D22;&#x5230;&#x67D0;&#x4E2A;&#x70B9;&#x8DDD;&#x79BB;&#x6700;&#x5C0F;&#x7684;&#x70B9;&#x4E3A;&#x4F8B;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6309;&#x7167;&#x4EE5;&#x4E0B;&#x7684;&#x6B65;&#x9AA4;&#x8FDB;&#x884C;&#x641C;&#x7D22;&#xFF1A;</p>
<ul>
<li><p>Start at the root and store that point as the &quot;best so far&quot;.
Compute its distance to the query point, and save that as the &quot;score to
beat&quot;. In the image above, we start at A whose distance to the flagged
point is 4.5.</p></li>
<li><p>This node partitions the space around it into two subspaces. For
each subspace, ask: &quot;Can a better point be possibly found inside of this
space?&quot; This question can be answered by computing the shortest distance
between the query point and the edge of our subspace (see dotted purple
line below).</p></li>
<li><p>Continue recursively for each subspace identified as containing a
possibly better point.</p></li>
<li><p>In the end, our &quot;best so far&quot; is the best point; the point
closest to the query point.</p></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/17.1.The%20construction%20of%20Graphs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/17.1.The%20construction%20of%20Graphs/" class="post-title-link" itemprop="url">17.1.&#x56FE;&#x7684;&#x6784;&#x5EFA;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 21:32:25" itemprop="dateModified" datetime="2024-06-02T21:32:25+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/17-Graphs/" itemprop="url" rel="index"><span itemprop="name">17.Graphs</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>205</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="171&#x56FE;&#x7684;&#x6784;&#x5EFA;"><span class="math inline">\(17.1\)</span>&#x56FE;&#x7684;&#x6784;&#x5EFA;</h1>
<h3 id="1&#x56FE;&#x7684;api">1.&#x56FE;&#x7684;<span class="math inline">\(API\)</span></h3>
<p><img src="/2024/05/31/17.1.The%20construction%20of%20Graphs/image.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Graph</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> V;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> E;</span><br><span class="line">    <span class="keyword">private</span> Bag&lt;Integer&gt;[] adj;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Graph</span><span class="params">(<span class="type">int</span> V)</span> {</span><br><span class="line">        <span class="built_in">this</span>.V = V;</span><br><span class="line">        <span class="built_in">this</span>.E = <span class="number">0</span>;</span><br><span class="line">        adj = (Bag&lt;Integer&gt;[])<span class="keyword">new</span> <span class="title class_">Bag</span>[V];<span class="comment">// Create array of lists.</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">v</span> <span class="operator">=</span> <span class="number">0</span>; v &lt; V; v += <span class="number">1</span>) {</span><br><span class="line">            adj[v] = <span class="keyword">new</span> <span class="title class_">Bag</span>&lt;Integer&gt;();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Graph</span><span class="params">(In in)</span> {</span><br><span class="line">        <span class="built_in">this</span>(in.readInt()); <span class="comment">// Read V and construct this graph.</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">E</span> <span class="operator">=</span> in.readInt(); <span class="comment">// Read E.</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; E; i++) { <span class="comment">// Add an edge.</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">v</span> <span class="operator">=</span> in.readInt(); <span class="comment">// Read a vertex,</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">w</span> <span class="operator">=</span> in.readInt(); <span class="comment">// read another vertex,</span></span><br><span class="line">            addEdge(v, w); <span class="comment">// and add edge connecting them.</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">V</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> V;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">E</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> E;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addEdge</span><span class="params">(<span class="type">int</span> v, <span class="type">int</span> w)</span> {</span><br><span class="line">        adj[v].add(w);</span><br><span class="line">        adj[w].add(v);</span><br><span class="line">        E += <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Iterable&lt;Integer&gt; <span class="title function_">adj</span><span class="params">(<span class="type">int</span> v)</span> {</span><br><span class="line">        <span class="keyword">return</span> adj[v];</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="2dfs">2.<span class="math inline">\(dfs\)</span></h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DepthFirstSearch</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span>[] marked;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> count;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DepthFirstSearch</span><span class="params">(Graph G, <span class="type">int</span> s)</span> {</span><br><span class="line">        marked = <span class="keyword">new</span> <span class="title class_">boolean</span>[G.V];</span><br><span class="line">        dfs(G, s);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(Graph G, <span class="type">int</span> v)</span> {</span><br><span class="line">        marked[v] = <span class="literal">true</span>;</span><br><span class="line">        count += <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> w : G.adj[v]) {</span><br><span class="line">            <span class="keyword">if</span> (!marked[w]) dfs(G, w);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">marked</span><span class="params">(<span class="type">int</span> w)</span> {</span><br><span class="line">        <span class="keyword">return</span> marked[w];</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">count</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="3&#x8DEF;&#x5F84;&#x7684;&#x5BFB;&#x627E;">3.&#x8DEF;&#x5F84;&#x7684;&#x5BFB;&#x627E;</h3>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/18.1.Selection%20Sort/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/18.1.Selection%20Sort/" class="post-title-link" itemprop="url">18.1.&#x9009;&#x62E9;&#x6392;&#x5E8F;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 21:38:27" itemprop="dateModified" datetime="2024-06-02T21:38:27+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/18-Basic-Sorting/" itemprop="url" rel="index"><span itemprop="name">18.Basic Sorting</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>302</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="181selection-sort"><span class="math inline">\(18.1\)</span>Selection Sort</h1>
<h3 id="1the-step-of-selection-sort">1.The step of Selection sort</h3>
<p>&#x2003;&#x2003;In selection sort, we basically do these three things:</p>
<ol type="1">
<li>Find the smallest item.</li>
<li>Move it to the front.</li>
<li>Selection sort the rest(using recursion).</li>
</ol>
<p>&#x2003;&#x2003;For each step, we can design an individual method to implement
it.</p>
<h3 id="2step-implementation">2.Step implementation</h3>
<p>&#x2003;&#x2003;As the moving step requires the index of the to-moving element, the
value we return should be index of elements, too.</p>
<h4 id="afind">&#x2003;&#x2003;<span class="math inline">\(a.\)</span><code>Find</code></h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">Find</span><span class="params">(<span class="type">int</span>[] arr)</span> {</span><br><span class="line">    <span class="type">int</span> <span class="variable">minIndex</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; arr.length; i += <span class="number">1</span>) {</span><br><span class="line">        <span class="keyword">if</span> (arr[i] &lt; arr[minIndex]) {</span><br><span class="line">            i = minIndex;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> minIndex;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;Given that we may need to <code>Find</code> the minimun in asked
range, we may improve our method by passing an extra parameter which
point to the start index(We&apos;ll use it in the following procedure)&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">Find</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> st)</span> {</span><br><span class="line">    <span class="keyword">if</span> (st &gt;= arr.length) {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IndexOutOfBoundsException</span>();</span><br><span class="line">    }</span><br><span class="line">    <span class="type">int</span> <span class="variable">minIndex</span> <span class="operator">=</span> st;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; arr.length; i += <span class="number">1</span>) {</span><br><span class="line">        <span class="keyword">if</span> (arr[i] &lt; arr[minIndex]) {</span><br><span class="line">            i = minIndex;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> minIndex;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h4 id="bswap">&#x2003;&#x2003;<span class="math inline">\(b.\)</span><code>swap</code></h4>
<p>&#x2003;&#x2003;We are going to implement the method by manipulating the index of
the elements: <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> x, <span class="type">int</span> y)</span> {</span><br><span class="line">    <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> arr[x];</span><br><span class="line">    arr[x] = arr[y];</span><br><span class="line">    arr[y] = tmp;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h4 id="cmainmethod">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>Main
method</h4>
<p>&#x2003;&#x2003;Since we would like to do the sorting recursively, we may introduce
a helper method and invoke it recursively: <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Sort</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] arr)</span> {</span><br><span class="line">        sortHelper(arr, index);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sortHelper</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> index)</span> {</span><br><span class="line">        <span class="comment">//basic situation</span></span><br><span class="line">        <span class="keyword">if</span> (index == arr.length()) <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">//find the smallest item</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">minIndex</span> <span class="operator">=</span> find(arr, index);</span><br><span class="line">        <span class="comment">//Move it to the front</span></span><br><span class="line">        swap(arr, index, minIndex);</span><br><span class="line">        <span class="comment">//Recursively call the method</span></span><br><span class="line">        sortHelper(arr, index + <span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/18.2.Heap%20Sort/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/18.2.Heap%20Sort/" class="post-title-link" itemprop="url">18.2.&#x5806;&#x6392;&#x5E8F;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 22:05:31" itemprop="dateModified" datetime="2024-06-02T22:05:31+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/18-Basic-Sorting/" itemprop="url" rel="index"><span itemprop="name">18.Basic Sorting</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>276</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="182heapsort"><span class="math inline">\(18.2\)</span>Heap
Sort</h1>
<h3 id="1the-step-of-heap-sorting">1.The step of Heap Sorting</h3>
<p>&#x2003;&#x2003;The simplest method to implement sorting via heap is to put the
whole array into a heap, and pick out top of the heap one by one.</p>
<p>&#x2003;&#x2003;However, this method will lead to unnecessarily memory waste, for
we can do heap sorting in place without creating a new heap.</p>
<h3 id="2step-impletation">2.Step impletation</h3>
<h4 id="abasic-heap-operation">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>Basic Heap operation</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sink</span><span class="params">(Comparable[] pq, <span class="type">int</span> k, <span class="type">int</span> n)</span> {</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">2</span> * k &lt;= n) {</span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">2</span> * k;<span class="comment">//left child</span></span><br><span class="line">        <span class="keyword">if</span> (j &lt; n &amp;&amp; less(pq, j, j + <span class="number">1</span>)) j += <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (!less(pq, k, j)) <span class="keyword">break</span>;</span><br><span class="line">        swap(pq, k, j);</span><br><span class="line">        k = j;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">less</span><span class="params">(Comparable[] pq, <span class="type">int</span> i, <span class="type">int</span> j)</span> {</span><br><span class="line">    <span class="keyword">return</span> pq[i - <span class="number">1</span>].compareTo(pq[j - <span class="number">1</span>]) &lt; <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(Object[] pq, <span class="type">int</span> i, <span class="type">int</span> j)</span> {</span><br><span class="line">    <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> pq[i - <span class="number">1</span>];</span><br><span class="line">    pq[i - <span class="number">1</span>] = pq[j - <span class="number">1</span>];</span><br><span class="line">    pq[j - <span class="number">1</span>] = o;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h4 id="bheapsorting">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Heap
Sorting</h4>
<p>&#x2003;&#x2003;The in place heap sorting use the following step: 1. Sink the
element in the array one by one, so that the array forms a heap.</p>
<p><img src="/2024/05/31/18.2.Heap%20Sort/image.png"></p>
<p><img src="/2024/05/31/18.2.Heap%20Sort/image-1.png"></p>
<ol start="2" type="1">
<li>Pop the front element one by one, and move the popped element to the
back of the array.</li>
</ol>
<p><img src="/2024/05/31/18.2.Heap%20Sort/image-2.png"></p>
<p><img src="/2024/05/31/18.2.Heap%20Sort/image-3.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(Comparable[] pq)</span> {</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> pq.length;</span><br><span class="line">    <span class="comment">//heapify</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> n / <span class="number">2</span>; k &gt;= <span class="number">1</span>; k --) sink(pq, k, n);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//sort and swap</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> n;</span><br><span class="line">    <span class="keyword">while</span> (k &gt; <span class="number">1</span>) {</span><br><span class="line">        <span class="comment">//pop the heaptop</span></span><br><span class="line">        swap(pq, <span class="number">1</span>, k--);</span><br><span class="line">        <span class="comment">//why k--?Because the kth element is sorted, so we only need to care about the k-1 th</span></span><br><span class="line">        <span class="comment">//maintain the heap property</span></span><br><span class="line">        sink(pq, <span class="number">1</span>, k);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/18.3.Merge%20Sort/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/18.3.Merge%20Sort/" class="post-title-link" itemprop="url">18.3.&#x5F52;&#x5E76;&#x6392;&#x5E8F;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 22:01:43" itemprop="dateModified" datetime="2024-06-02T22:01:43+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/18-Basic-Sorting/" itemprop="url" rel="index"><span itemprop="name">18.Basic Sorting</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>155</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="183mergesort"><span class="math inline">\(18.3.\)</span>Merge
Sort</h1>
<h3 id="1the-step-of-merge-sort">1.The step of Merge Sort</h3>
<ul>
<li>Split items into 2 roughly even pieces.</li>
<li>Mergesort each half (steps not shown, this is a recursive
algorithm!)</li>
<li>Merge the two sorted halves to form the final result.</li>
</ul>
<h3 id="2step-implementation">2.Step implementation</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">double</span> <span class="title function_">merge</span><span class="params">(<span class="type">double</span>[] a, <span class="type">double</span>[] b)</span> {</span><br><span class="line">    <span class="type">double</span>[] c = <span class="keyword">new</span> <span class="title class_">double</span>[a.length + b.length];</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; c.length; k += <span class="number">1</span>) {</span><br><span class="line">        <span class="keyword">if</span> (k &gt;= a.length) c[k] = b[j++];</span><br><span class="line">        <span class="keyword">if</span> (k &gt;= b.length) c[k] = a[i++];</span><br><span class="line">        <span class="keyword">if</span> (a[i] &lt;= b[j]) c[k] = a[i++];</span><br><span class="line">        <span class="keyword">else</span> c[k] = b[j++]; </span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">double</span>[] mergeSort(<span class="type">double</span>[] input) {</span><br><span class="line">    <span class="type">int</span> <span class="variable">N</span> <span class="operator">=</span> input.length;</span><br><span class="line">    <span class="keyword">if</span> (N &lt;= <span class="number">1</span>) <span class="keyword">return</span> input;</span><br><span class="line">    <span class="type">double</span>[] a = <span class="type">double</span>[N / <span class="number">2</span>];</span><br><span class="line">    <span class="type">double</span>[] b = <span class="type">double</span>[N - N / <span class="number">2</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; a.length; i += <span class="number">1</span>) a[i] = input[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; b.length; j += <span class="number">1</span>) b[j] = input[j + N / <span class="number">2</span>];</span><br><span class="line">    <span class="keyword">return</span> merge(mergeSort(a), mergeSort(b));</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/18.4.Insertion%20Sort/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/18.4.Insertion%20Sort/" class="post-title-link" itemprop="url">18.4.&#x63D2;&#x5165;&#x6392;&#x5E8F;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 22:02:34" itemprop="dateModified" datetime="2024-06-02T22:02:34+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/18-Basic-Sorting/" itemprop="url" rel="index"><span itemprop="name">18.Basic Sorting</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>323</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="184insertion-sort"><span class="math inline">\(18.4.\)</span>Insertion Sort</h1>
<h3 id="1the-step-of-insertion-sort">1.The step of Insertion Sort</h3>
<p>&#x2003;&#x2003;The insertion sort follows these general strategies:</p>
<ul>
<li>Starting with an empty output sequence.</li>
<li>Add each item from input, inserting into output at right
places.</li>
</ul>
<p>&#x2003;&#x2003;Also, this method requires a new array, which takes up some
memory.As a result, we may try in place sorting by using swapping
method.</p>
<p>&#x2003;&#x2003;Take the below array as example.Suppose we have sorted the first
two elements.It&apos;s worth noting that we use a <span class="math inline">\(j\)</span> to track the current spot of the
travelling element:</p>
<p><img src="/2024/05/31/18.4.Insertion%20Sort/image-4.png"></p>
<p>&#x2003;&#x2003;The <span class="math inline">\(2\)</span> element will experience
the following steps:</p>
<p><img src="/2024/05/31/18.4.Insertion%20Sort/image-5.png"></p>
<p><img src="/2024/05/31/18.4.Insertion%20Sort/image-6.png"></p>
<p>&#x2003;&#x2003;After these steps, the <span class="math inline">\(2\)</span>
element reach its right place, and we get the first third elements
sorted:</p>
<p><img src="/2024/05/31/18.4.Insertion%20Sort/image-7.png"></p>
<p>&#x2003;&#x2003;Do it recursively, then we can get a sorted array.</p>
<h3 id="2step-implementation">2.Step implementation</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(Comparable[] a)</span> {</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> a.length;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; i ++) {</span><br><span class="line">        <span class="comment">//compare with its front element, if it&apos;s not in order, swap it</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i; j &gt; <span class="number">0</span> &amp;&amp; less(a[j], a[j - <span class="number">1</span>]); j --) {</span><br><span class="line">            swap(a, j, j - <span class="number">1</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(Comparable[] a, <span class="type">int</span> lo, <span class="type">int</span> hi)</span> {</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> lo + <span class="number">1</span>; i &lt; hi; i++) {</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i; j &gt; lo &amp;&amp; less(a[j], a[j-<span class="number">1</span>]); j--) {</span><br><span class="line">                swap(a, j, j - <span class="number">1</span>);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>
<h3 id="3some-property-of-insertionsort">3.Some property of Insertion
Sort</h3>
<p>&#x2003;&#x2003;Since the principle of insertion sort is to maintain the order of
each subsequence, for arrays that are almost sorted, we only need to do
few swaps, thus makes sorting fast.</p>
<p>&#x2003;&#x2003;Suppose that there are <span class="math inline">\(K\)</span>
inversions in the array, the runtime of Insertion Sort is <span class="math inline">\(\Theta (N+K)\)</span>.</p>
<p>&#x2003;&#x2003;Moreover, we can define an almost sorted array as one in which
numbers of inversions <span class="math inline">\(\leq\;cN\)</span>,
insertion sort is excellent on these arrays.</p>
<p>&#x2003;&#x2003;Ususally, for small arrays(with N less than 15), insertion sort is
fast.</p>
<h3 id="4sorting-summary">4.Sorting Summary</h3>
<p><img src="/2024/05/31/18.4.Insertion%20Sort/image-8.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/18.5.Radix%20Sort/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/18.5.Radix%20Sort/" class="post-title-link" itemprop="url">18.6.&#x57FA;&#x6570;&#x6392;&#x5E8F;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 22:04:02" itemprop="dateModified" datetime="2024-06-02T22:04:02+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/18-Basic-Sorting/" itemprop="url" rel="index"><span itemprop="name">18.Basic Sorting</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>342</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="186radixsort"><span class="math inline">\(18.6.\)</span>Radix
Sort</h1>
<h3 id="1counting-sort">1.Counting Sort</h3>
<p>&#x2003;&#x2003; In the previous text, we have proved that sorting using comparison
has a worst case running time of <span class="math inline">\(\Theta(n\log n)\)</span>.However, what if we don&apos;t
compare at all?</p>
<p>&#x2003;&#x2003;Suppose we have a couple of characters, saying <span class="math inline">\(acdsjlfkm\)</span>, we can sort them in alphabet
order through the following steps:</p>
<ol type="1">
<li>Creat an array with the same size of an alphabet(<span class="math inline">\(26\)</span>).</li>
<li>For each character, put it in the <span class="math inline">\(ch-&apos;a&apos;\)</span> index.</li>
<li>Scan the whole array, and the former character are always less than
the latter. Insert the character into a new array in order, then we get
a sorted array.</li>
</ol>
<p>&#x2003;&#x2003;This kind of sorting method is called counting sort. If the length
of data is <span class="math inline">\(N\)</span>, and the size of
alphabet is <span class="math inline">\(R\)</span>, then the runtime of
counting sort is <span class="math inline">\(\Theta(N+R)\)</span>. It&apos;s
liner runtime!</p>
<p><img src="/2024/05/31/18.5.Radix%20Sort/image-9.png"></p>
<p>&#x2003;&#x2003;However, the algorithm falls to sort hard-to-count items like
String, so we need improvement.</p>
<h3 id="2lsd-radix-sort">2.LSD Radix Sort</h3>
<p>&#x2003;&#x2003;The LSD(Least Significant Digit) radix sort sort each digit of the
item independently form rightmost digit towards left, take the below
table as example:</p>
<p><img src="/2024/05/31/18.5.Radix%20Sort/image-10.png"></p>
<p>&#x2003;&#x2003;The runtime of LSD radix sort is <span class="math inline">\(\Theta(WN+WR)\)</span>,where N is Number of items,
R is size of alphabet, and W is the maximun length of these items.</p>
<p>&#x2003;&#x2003;What if the length of each item isn&apos;t same? We can treat empty
spaces as less than all other characters:</p>
<p><img src="/2024/05/31/18.5.Radix%20Sort/image-11.png"></p>
<h3 id="3msd-radix-sort">3.MSD Radix Sort</h3>
<p>&#x2003;&#x2003;The MSD(Most Significant Digit) radix sort is similiar to LSD radix
sort. However, it sorts from the left digit to the right.</p>
<p>&#x2003;&#x2003;After first sorting process, we may get items as below:</p>
<p><img src="/2024/05/31/18.5.Radix%20Sort/image-12.png"></p>
<p>&#x2003;&#x2003;The items are not in correct order yet! To solve this, we can treat
items with same left digit as a group, and compare the next left
character within groups:</p>
<p><img src="/2024/05/31/18.5.Radix%20Sort/image-13.png"></p>
<p>&#x2003;&#x2003;The runtime of MSD radix sort is the same as LSD radix sort.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/2.1.Mystery%20of%20the%20Walrus/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/2.1.Mystery%20of%20the%20Walrus/" class="post-title-link" itemprop="url">2.1.Java&#x8BED;&#x8A00;&#x7279;&#x6027;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 16:36:17" itemprop="dateModified" datetime="2024-06-02T16:36:17+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/2-List/" itemprop="url" rel="index"><span itemprop="name">2.List</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>2k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>7 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="21-java&#x8BED;&#x8A00;&#x7279;&#x6027;"><span class="math inline">\(2.1\)</span> <span class="math inline">\(Java\)</span>&#x8BED;&#x8A00;&#x7279;&#x6027;</h1>
<h3 id="1&#x6BD4;&#x7279;bit">1.&#x6BD4;&#x7279;(<span class="math inline">\(bit\)</span>)</h3>
<p>&#x2003;&#x2003;&#x5728;&#x8BA1;&#x7B97;&#x673A;&#x4E2D;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x4FE1;&#x606F;&#x90FD;<strong>&#x4EE5;<span class="math inline">\(01\)</span>&#x4E32;&#x7684;&#x5F62;&#x5F0F;</strong>&#x5B58;&#x50A8;&#x4E8E;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</p>
<ul>
<li><span class="math inline">\(72\)</span>&#x88AB;&#x5B58;&#x50A8;&#x4E3A;<code>01001000</code></li>
<li><span class="math inline">\(H\)</span>&#x5B57;&#x6BCD;&#x88AB;&#x5B58;&#x50A8;&#x4E3A;<code>01001000</code></li>
</ul>
<p>&#x2003;&#x2003;<span class="math inline">\(72\)</span>&#x548C;<span class="math inline">\(H\)</span>&#x7684;<span class="math inline">\(01\)</span>&#x4E32;&#x662F;&#x76F8;&#x540C;&#x7684;&#xFF0C;<span class="math inline">\(Java\)</span>&#x4EE3;&#x7801;&#x901A;&#x8FC7;&#x6570;&#x636E;&#x7C7B;&#x578B;(<span class="math inline">\(tyep\)</span>)&#x533A;&#x5206;&#x5B83;&#x4EEC;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> c=<span class="string">&apos;H&apos;</span>;</span><br><span class="line"><span class="type">int</span> x=c;</span><br><span class="line">System.out.println(c);</span><br><span class="line">System.out.println(x);</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">H</span><br><span class="line"><span class="number">72</span></span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;<code>x</code>&#x548C;<code>c</code>&#x53D8;&#x91CF;&#x90FD;&#x6709;&#x76F8;&#x540C;&#x7684;<span class="math inline">\(01\)</span>&#x4E32;&#xFF0C;&#x4F46;&#x89E3;&#x91CA;&#x5668;&#x4F1A;&#x5728;&#x6253;&#x5370;&#x5B83;&#x4EEC;&#x7684;&#x65F6;&#x5019;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x4E0D;&#x540C;&#x7684;&#x5904;&#x7406;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5728;<span class="math inline">\(Java\)</span>&#x4E2D;&#xFF0C;&#x6709;<span class="math inline">\(8\)</span>&#x79CD;&#x57FA;&#x672C;&#x6570;&#x636E;&#x7C7B;&#x578B;&#xFF1A;<code>byte</code>&#xFF0C;<code>short</code>&#xFF0C;<code>int</code>&#xFF0C;<code>long</code>&#xFF0C;<code>float</code>&#xFF0C;<code>double</code>&#xFF0C;<code>boolean</code>&#xFF0C;<code>char</code>&#x3002;</p>
<h3 id="2&#x53D8;&#x91CF;&#x7684;&#x58F0;&#x660E;&#x7B80;&#x5316;">2.&#x53D8;&#x91CF;&#x7684;&#x58F0;&#x660E;(&#x7B80;&#x5316;)</h3>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C06;&#x8BA1;&#x7B97;&#x673A;&#x60F3;&#x8C61;&#x6210;&#x4E00;&#x4E2A;&#x4E00;&#x4E2A;&#x62E5;&#x6709;&#x5927;&#x91CF;&#x8BB0;&#x5FC6;&#x6BD4;&#x7279;(<span class="math inline">\(memory\;bits\)</span>)&#x6765;&#x5B58;&#x50A8;&#x4FE1;&#x606F;&#x7684;&#x673A;&#x5668;&#xFF0C;<strong>&#x6BCF;&#x4E2A;&#x6BD4;&#x7279;&#x90FD;&#x6709;&#x72EC;&#x7ACB;&#x7684;&#x5730;&#x5740;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x5728;&#x58F0;&#x660E;&#x67D0;&#x4E00;&#x57FA;&#x672C;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x7684;&#x53D8;&#x91CF;&#x65F6;&#xFF0C;<span class="math inline">\(Java\)</span>&#x4F1A;<strong>&#x627E;&#x5230;&#x4E00;&#x4E2A;&#x533A;&#x57DF;(<span class="math inline">\(blocks\)</span>)</strong>&#xFF0C;&#x8FD9;&#x4E2A;&#x533A;&#x57DF;&#x6709;&#x8DB3;&#x591F;&#x7684;&#x6BD4;&#x7279;&#x6765;&#x5B58;&#x50A8;&#x8BE5;&#x7C7B;&#x578B;&#x7684;&#x4FE1;&#x606F;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x628A;&#x8FD9;&#x4E9B;&#x533A;&#x57DF;&#x6BD4;&#x55BB;&#x4E3A;
<strong>&#x4E00;&#x4E2A;&#x88C5;&#x7740;&#x6BD4;&#x7279;&#x7684;&#x76D2;&#x5B50;(<span class="math inline">\(box\)</span>)</strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x9664;&#x4E86;&#x5B89;&#x7F6E;&#x5185;&#x5B58;&#xFF0C;<span class="math inline">\(Java\)</span>&#x89E3;&#x91CA;&#x5668;&#x8FD8;&#x4F1A;<strong>&#x521B;&#x9020;&#x4E00;&#x4E2A;&#x5185;&#x90E8;&#x8868;&#x683C;&#x7684;&#x5165;&#x53E3;(<span class="math inline">\(entry\)</span>)</strong>&#xFF0C;&#x5B83;<strong>&#x5C06;&#x6BCF;&#x4E2A;&#x53D8;&#x91CF;&#x7684;&#x540D;&#x5B57;&#x4E0E;&#x5B83;&#x4EEC;&#x5BF9;&#x5E94;&#x76D2;&#x5B50;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x6BD4;&#x7279;&#x76F8;&#x5BF9;&#x5E94;(<span class="math inline">\(map\)</span>)</strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x4F8B;&#x5982;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x58F0;&#x660E;<code>int x</code>&#x548C;<code>double y</code>&#x8FD9;&#x4E24;&#x4E2A;&#x53D8;&#x91CF;&#x65F6;&#xFF0C;<span class="math inline">\(Java\)</span>&#x53EF;&#x80FD;&#x4F1A;&#x51B3;&#x5B9A;&#x7528;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x7B2C;<span class="math inline">\(352\)</span>&#x5230;&#x7B2C;<span class="math inline">\(384\)</span>&#x4F4D;&#x6BD4;&#x7279;&#x6765;&#x5B58;&#x50A8;<code>x</code>&#xFF0C;&#x7528;&#x7B2C;<span class="math inline">\(20800\)</span>&#x5230;&#x7B2C;<span class="math inline">\(20864\)</span>&#x4F4D;&#x6BD4;&#x7279;&#x6765;&#x5B58;&#x50A8;<code>y</code>&#x3002;&#x89E3;&#x91CA;&#x5668;&#x4F1A;&#x63A5;&#x7740;&#x8BB0;&#x5F55;<code>x</code>&#x4ECE;&#x7B2C;<span class="math inline">\(352\)</span>&#x4F4D;&#x6BD4;&#x7279;&#x5F00;&#x59CB;&#x5B58;&#x50A8;&#xFF0C;<code>y</code>&#x4ECE;&#x7B2C;<span class="math inline">\(20800\)</span>&#x4F4D;&#x6BD4;&#x7279;&#x5F00;&#x59CB;&#x5B58;&#x50A8;&#x3002;&#x5728;&#x6267;&#x884C;&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x540E;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> x;</span><br><span class="line"><span class="type">double</span> y;</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x4F1A;&#x5F97;&#x5230;&#x4E0B;&#x9762;&#x4E24;&#x4E2A;<span class="math inline">\(32\)</span>&#x4F4D;&#x548C;<span class="math inline">\(64\)</span>&#x4F4D;&#x7684;&#x76D2;&#x5B50;&#xFF1A;</p>
<p><img src="/2024/05/31/2.1.Mystery%20of%20the%20Walrus/image.png"></p>
<p>&#x2003;&#x2003;<span class="math inline">\(java\)</span>&#x8BED;&#x8A00;<strong>&#x5E76;&#x6CA1;&#x6709;&#x50CF;<span class="math inline">\(C\)</span>&#x8BED;&#x8A00;&#x4E00;&#x6837;&#x63D0;&#x4F9B;&#x8BBF;&#x95EE;&#x76D2;&#x5B50;&#x5730;&#x5740;&#x7684;&#x9014;&#x5F84;</strong>&#x3002;&#x8FD9;&#x867D;&#x7136;&#x963B;&#x6B62;&#x4E86;&#x67D0;&#x4E9B;&#x7C7B;&#x578B;&#x4F18;&#x5316;&#xFF0C;&#x4F46;&#x4E5F;&#x9632;&#x6B62;&#x4E86;&#x4E00;&#x5927;&#x7C7B;&#x975E;&#x5E38;&#x68D8;&#x624B;&#x7684;&#x7F16;&#x7A0B;&#x9519;&#x8BEF;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5728;&#x53D8;&#x91CF;&#x58F0;&#x660E;&#x540E;&#xFF0C;<span class="math inline">\(Java\)</span>&#x5E76;&#x4E0D;&#x4F1A;&#x5728;&#x9884;&#x7559;&#x7684;&#x76D2;&#x5B50;&#x91CC;&#x5199;&#x5165;&#x4EFB;&#x4F55;&#x9ED8;&#x8BA4;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;<strong>&#x6BCF;&#x4E2A;&#x53D8;&#x91CF;&#x5E76;&#x6CA1;&#x6709;&#x9ED8;&#x8BA4;&#x503C;</strong>&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5728;&#x8FD9;&#x4E2A;&#x76D2;&#x5B50;&#x88AB;&#x901A;&#x8FC7;<code>=</code>&#x8FD0;&#x7B97;&#x7B26;&#x88C5;&#x6EE1;&#x6BD4;&#x7279;&#x4E4B;&#x524D;&#xFF0C;<span class="math inline">\(Java\)</span>&#x89E3;&#x91CA;&#x5668;&#x4F1A;&#x963B;&#x6B62;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x3002;&#x800C;<strong>&#x5F53;&#x6211;&#x4EEC;&#x5BF9;&#x5185;&#x5B58;&#x76D2;&#x5B50;(<span class="math inline">\(memory\;box\)</span>)&#x8FDB;&#x884C;&#x8D4B;&#x503C;&#x540E;&#xFF0C;&#x8FD9;&#x4E2A;&#x76D2;&#x5B50;&#x5C31;&#x4F1A;&#x88C5;&#x5165;&#x6211;&#x4EEC;&#x6307;&#x5B9A;&#x7684;&#x503C;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x4F8B;&#x5982;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x6267;&#x884C;&#x4E0B;&#x9762;&#x7684;&#x7A0B;&#x5E8F;&#x65F6;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x = -<span class="number">1431195969</span>;</span><br><span class="line">y = <span class="number">567213.112</span>;</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x6BCF;&#x4E2A;&#x53D8;&#x91CF;&#x7684;&#x5185;&#x5B58;&#x76D2;&#x5B50;&#x4F1A;&#x50CF;&#x4E0B;&#x9762;&#x8FD9;&#x6837;&#x88AB;&#x586B;&#x6EE1;&#x3002;&#x8FD9;&#x79CD;&#x6807;&#x8BB0;&#x88AB;&#x53EB;&#x505A;&#x76D2;&#x5B50;&#x6807;&#x8BB0;&#x6CD5;(<span class="math inline">\(box\;notation\)</span>)&#xFF1A;</p>
<p><img src="/2024/05/31/2.1.Mystery%20of%20the%20Walrus/image-1.png"></p>
<p>&#x2003;&#x2003;&#x4E3A;&#x4E86;&#x7B80;&#x5316;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x76D2;&#x5B50;&#x6807;&#x8BB0;&#x7B80;&#x5316;&#x4E3A;&#x5982;&#x4E0B;&#x683C;&#x5F0F;&#xFF1A;</p>
<p><img src="/2024/05/31/2.1.Mystery%20of%20the%20Walrus/image-2.png"></p>
<h3 id="3&#x7B49;&#x5F0F;&#x7684;&#x9EC4;&#x91D1;&#x89C4;&#x5219;groe">3.&#x7B49;&#x5F0F;&#x7684;&#x9EC4;&#x91D1;&#x89C4;&#x5219;(<span class="math inline">\(GRoE\)</span>)</h3>
<p>&#x2003;&#x2003;<strong>&#x5F53;&#x6211;&#x4EEC;&#x5199;&#x4E0B;<code>y=x</code>&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x544A;&#x8BC9;<span class="math inline">\(Java\)</span>&#x89E3;&#x91CA;&#x5668;&#x628A;<code>x</code>&#x7684;&#x6BD4;&#x7279;&#x590D;&#x5236;&#x7ED9;<code>y</code></strong>&#x3002;&#x8FD9;&#x4E2A;&#x89C4;&#x5219;&#x662F;&#x7406;&#x89E3;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x8C1C;&#x9898;&#x7684;&#x57FA;&#x7840;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Walrus</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Walrus</span>(<span class="number">1000</span>, <span class="number">8.3</span>);</span><br><span class="line">Walrus b;</span><br><span class="line">b = a;</span><br><span class="line">b.weight = <span class="number">5</span>;</span><br><span class="line">System.out.println(a);</span><br><span class="line">System.out.println(b);</span><br></pre></td></tr></table></figure></p>
<h3 id="4&#x5F15;&#x7528;&#x7C7B;&#x578B;referencetype">4.&#x5F15;&#x7528;&#x7C7B;&#x578B;(<span class="math inline">\(reference\;type\)</span>)</h3>
<p>&#x2003;&#x2003;&#x5728;&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x4ECB;&#x7ECD;&#x4E86;<span class="math inline">\(Java\)</span>&#x7684;&#x57FA;&#x672C;&#x7C7B;&#x578B;&#xFF0C;&#x9664;&#x4E86;&#x57FA;&#x672C;&#x7C7B;&#x578B;&#x5916;&#x7684;&#x5176;&#x4ED6;&#x7C7B;&#x578B;&#xFF0C;&#x5982;&#x6570;&#x7EC4;&#xFF0C;&#x88AB;&#x79F0;&#x4E3A;<strong>&#x5F15;&#x7528;&#x7C7B;&#x578B;</strong>&#x3002;</p>
<h4 id="a&#x5BF9;&#x8C61;&#x5B9E;&#x4F8B;&#x5316;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&#x5BF9;&#x8C61;&#x5B9E;&#x4F8B;&#x5316;</h4>
<p>&#x2003;&#x2003;&#x5F53;&#x6211;&#x4EEC;&#x5229;&#x7528;<code>new</code>&#x8BED;&#x53E5;&#x5C06;&#x67D0;&#x4E2A;&#x5BF9;&#x8C61;&#x5B9E;&#x4F8B;&#x5316;(<span class="math inline">\(instantiate\)</span>)&#x540E;&#xFF0C;<span class="math inline">\(Java\)</span>&#x4F1A;&#x5148;<strong>&#x7ED9;&#x8FD9;&#x4E2A;&#x7C7B;(<span class="math inline">\(class\)</span>)&#x7684;&#x6BCF;&#x4E2A;&#x5B9E;&#x4F8B;&#x53D8;&#x91CF;&#x5206;&#x914D;&#x4E00;&#x4E2A;&#x76D2;&#x5B50;</strong>&#xFF0C;&#x7136;&#x540E;<strong>&#x5728;&#x76D2;&#x5B50;&#x91CC;&#x9762;&#x88C5;&#x4E00;&#x4E2A;&#x9ED8;&#x8BA4;&#x503C;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x4F8B;&#x5982;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x7684;<span class="math inline">\(Warlus\)</span>&#x7C7B;&#x5982;&#x4E0B;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Walrus</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> weight;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> tuskSize;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Walrus</span><span class="params">(<span class="type">int</span> w, <span class="type">double</span> ts)</span> {</span><br><span class="line">          weight = w;</span><br><span class="line">          tuskSize = ts;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5E76;&#x4E14;&#x6211;&#x4EEC;&#x521B;&#x9020;&#x4E86;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;<code>new Walrus(1000,8.3)</code>&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5C31;&#x4F1A;&#x5F97;&#x5230;&#x4E0B;&#x9762;&#x8FD9;&#x4E24;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;&#x76D2;&#x5B50;&#xFF1A;</p>
<p><img src="/2024/05/31/2.1.Mystery%20of%20the%20Walrus/image-3.png"></p>
<h4 id="b&#x5F15;&#x7528;&#x7C7B;&#x578B;&#x53D8;&#x91CF;&#x7684;&#x58F0;&#x660E;">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>&#x5F15;&#x7528;&#x7C7B;&#x578B;&#x53D8;&#x91CF;&#x7684;&#x58F0;&#x660E;</h4>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x4E0A;&#x9762;&#x6240;&#x4E3E;&#x7684;&#x4F8B;&#x5B50;&#x662F;&#x533F;&#x540D;&#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x5B83;&#x6CA1;&#x6709;&#x88AB;&#x5B58;&#x50A8;&#x5230;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#x4E2D;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5F53;&#x6211;&#x4EEC;&#x58F0;&#x660E;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x5F15;&#x7528;&#x7C7B;&#x578B;&#x7684;&#x53D8;&#x91CF;&#x65F6;&#xFF0C;<span class="math inline">\(Java\)</span><strong>&#x4F1A;&#x7ED9;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x5206;&#x914D;&#x4E00;&#x4E2A;<span class="math inline">\(64\)</span>&#x6BD4;&#x7279;&#x7684;&#x76D2;&#x5B50;&#xFF0C;&#x4E0D;&#x7BA1;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x662F;&#x4EC0;&#x4E48;&#x7C7B;&#x578B;&#x7684;</strong>&#x3002;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#xFF1A;&#x8FD9;&#x4E2A;<span class="math inline">\(64\)</span>&#x6BD4;&#x7279;&#x7684;&#x76D2;&#x5B50;&#x5E76;&#x4E0D;&#x662F;&#x88C5;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;(&#x4F8B;&#x5982;<span class="math inline">\(Walrus\)</span>)&#x7684;&#x5177;&#x4F53;&#x6570;&#x636E;&#x7684;&#xFF0C;&#x800C;&#x662F;&#x88C5;<strong>&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x5730;&#x5740;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x4F8B;&#x5982;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x5982;&#x4E0B;&#x8C03;&#x7528;&#x53D8;&#x91CF;&#x65F6;&#xFF1A; <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Walrus someWalrus;</span><br><span class="line">someWalrus = new Walrus(1000, 8.3);</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x5047;&#x8BBE;<span class="math inline">\(Walrus\)</span>&#x7684;<code>weight</code>&#x5B58;&#x50A8;&#x5728;&#x5F00;&#x59CB;&#x4E8E;<code>5051956592385990207</code>&#x7684;&#x6BD4;&#x7279;&#x91CC;&#xFF0C;&#x800C;<code>tuskSize</code>&#x5B58;&#x50A8;&#x5728;&#x5F00;&#x59CB;&#x4E8E;<code>5051956592385990239</code>&#x7684;&#x6BD4;&#x7279;&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;<strong>&#x628A;<code>5051956592385990207</code>&#x5B58;&#x50A8;&#x5728;<span class="math inline">\(Walrus\)</span>&#x53D8;&#x91CF;&#x4E2D;</strong>&#xFF1A;</p>
<p><img src="/2024/05/31/2.1.Mystery%20of%20the%20Walrus/image-4.png"></p>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x5BF9;&#x5F15;&#x7528;&#x53D8;&#x91CF;&#x8D4B;&#x4E88;&#x7279;&#x6B8A;&#x503C;<code>null</code>&#xFF1A;</p>
<p><img src="/2024/05/31/2.1.Mystery%20of%20the%20Walrus/image-5.png"></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x6837;&#x8868;&#x793A;&#x5F15;&#x7528;&#x53D8;&#x91CF;&#x7684;&#x6BD4;&#x7279;&#x8F83;&#x4E3A;&#x590D;&#x6742;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x5F15;&#x5165;&#x7BAD;&#x5934;&#x6807;&#x8BB0;&#xFF1A;</p>
<ul>
<li>&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x5730;&#x5740;&#x5168;&#x90E8;&#x4E3A;&#x7A7A;&#xFF0C;&#x5C31;&#x7528;<code>null</code>&#x6765;&#x8868;&#x793A;&#x3002;</li>
<li><strong>&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x5730;&#x5740;&#x975E;&#x7A7A;&#xFF0C;&#x5C31;&#x7528;&#x7BAD;&#x5934;&#x6307;&#x5411;&#x5B83;&#x6240;&#x4EE3;&#x6307;&#x7684;&#x5BF9;&#x8C61;&#x5B9E;&#x4F8B;</strong>&#x3002;</li>
</ul>
<p><img src="/2024/05/31/2.1.Mystery%20of%20the%20Walrus/image-6.png"></p>
<p>&#x2003;&#x2003;&#x56DE;&#x5230;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Walrus</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Walrus</span>(<span class="number">1000</span>, <span class="number">8.3</span>);</span><br><span class="line">Walrus b;</span><br><span class="line">b = a;</span><br><span class="line">b.weight = <span class="number">5</span>;</span><br><span class="line">System.out.println(a);</span><br><span class="line">System.out.println(b);</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x6267;&#x884C;&#x5B8C;&#x4E0B;&#x9762;&#x7684;&#x8BED;&#x53E5;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x4E0B;&#x9762;&#x7684;&#x6807;&#x8BB0;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Walrus</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Walrus</span>(<span class="number">1000</span>, <span class="number">8.3</span>);</span><br><span class="line">Walrus b;</span><br><span class="line">b = a;</span><br></pre></td></tr></table></figure></p>
<p><img src="/2024/05/31/2.1.Mystery%20of%20the%20Walrus/image-7.png"></p>
<h3 id="5&#x53C2;&#x6570;&#x4F20;&#x9012;">5.&#x53C2;&#x6570;&#x4F20;&#x9012;</h3>
<p>&#x2003;&#x2003;&#x5F53;&#x6211;&#x4EEC;&#x7ED9;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x4F20;&#x9012;&#x53C2;&#x6570;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x53EA;&#x662F;<strong>&#x5C06;&#x53C2;&#x6570;&#x7684;&#x6BD4;&#x7279;&#x590D;&#x5236;&#x8FC7;&#x53BB;</strong>&#x3002;<span class="math inline">\(GRoE\)</span>&#x539F;&#x5219;&#x540C;&#x6837;&#x9002;&#x7528;&#x4E8E;&#x53C2;&#x6570;&#x7684;&#x4F20;&#x9012;&#x3002;&#x6BD4;&#x7279;&#x590D;&#x5236;&#x4E5F;&#x88AB;&#x79F0;&#x4F5C;&#x4F20;&#x9012;&#x6570;&#x503C;(<span class="math inline">\(passing\;by\;value\)</span>)&#x3002;&#x5728;<span class="math inline">\(Java\)</span>&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x7ECF;&#x5E38;&#x4F7F;&#x7528;&#x8FD9;&#x79CD;&#x505A;&#x6CD5;&#x3002;</p>
<p>&#x2003;&#x2003;&#x6CE8;&#x610F;&#x5230;&#xFF0C;<strong>&#x5BF9;&#x4E8E;&#x57FA;&#x672C;&#x7C7B;&#x578B;&#x53D8;&#x91CF;&#xFF0C;&#x6BD4;&#x7279;&#x8868;&#x793A;&#x7684;&#x662F;&#x5B83;&#x4EEC;&#x7684;&#x6570;&#x503C;&#x800C;&#x975E;&#x5730;&#x5740;</strong>&#xFF1B;&#x800C;<strong>&#x5BF9;&#x4E8E;&#x5F15;&#x7528;&#x7C7B;&#x578B;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x6BD4;&#x7279;&#x8868;&#x793A;&#x7684;&#x662F;&#x5B83;&#x4EEC;&#x7684;&#x5730;&#x5740;</strong>&#xFF0C;&#x56E0;&#x6B64;<strong>&#x51FD;&#x6570;&#x5BF9;&#x4E24;&#x8005;&#x7684;&#x4F5C;&#x7528;&#x5E76;&#x4E0D;&#x76F8;&#x540C;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x8003;&#x8651;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PassByValueFigure</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">           <span class="type">Walrus</span> <span class="variable">walrus</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Walrus</span>(<span class="number">3500</span>, <span class="number">10.5</span>);</span><br><span class="line">           <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">9</span>;</span><br><span class="line"></span><br><span class="line">           doStuff(walrus, x);</span><br><span class="line">           System.out.println(walrus);</span><br><span class="line">           System.out.println(x);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">doStuff</span><span class="params">(Walrus W, <span class="type">int</span> x)</span> {</span><br><span class="line">           W.weight = W.weight - <span class="number">100</span>;</span><br><span class="line">           x = x - <span class="number">5</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure> &#x2003;&#x2003;&#x8BE5;&#x4F8B;&#x5B50;&#x5BF9;&#x5E94;&#x7684;&#x6807;&#x8BB0;&#x56FE;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="/2024/05/31/2.1.Mystery%20of%20the%20Walrus/image-8.png"></p>
<p>&#x2003;&#x2003;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;<span class="math inline">\(doStuff\)</span>&#x53EA;&#x5BF9;<span class="math inline">\(Walrus\)</span>&#x7684;&#x5BF9;&#x8C61;&#x6709;&#x4F5C;&#x7528;&#xFF0C;&#x5BF9;<code>x</code>&#x5E76;&#x65E0;&#x4F5C;&#x7528;&#x3002;</p>
<h3 id="6&#x6570;&#x7EC4;&#x7684;&#x5B9E;&#x4F8B;&#x5316;">6.&#x6570;&#x7EC4;&#x7684;&#x5B9E;&#x4F8B;&#x5316;</h3>
<p>&#x2003;&#x2003;&#x50CF;&#x5148;&#x524D;&#x5BF9;&#x5F15;&#x7528;&#x53D8;&#x91CF;&#x7684;&#x8BB2;&#x89E3;&#xFF0C;&#x7528;&#x4E8E;&#x5B58;&#x50A8;&#x6570;&#x7EC4;&#x7684;&#x53D8;&#x91CF;&#x4E5F;&#x9075;&#x5FAA;&#x76F8;&#x540C;&#x7684;&#x89C4;&#x5219;&#x3002;&#x4F8B;&#x5982;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x6574;&#x6570;&#x6570;&#x7EC4;&#x7684;&#x521B;&#x5EFA;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="keyword">new</span> <span class="title class_">int</span>[]{<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">95</span>, <span class="number">4</span>};</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x91CC;&#x7684;<code>new</code>&#x5173;&#x952E;&#x8BCD;&#x4F1A;&#x521B;&#x5EFA;<span class="math inline">\(5\)</span>&#x4E2A;<span class="math inline">\(32\)</span>&#x6BD4;&#x7279;&#x7684;&#x76D2;&#x5B50;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;&#x8D4B;&#x503C;&#x7ED9;<code>x</code>&#x7684;&#x6574;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x5730;&#x5740;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5982;&#x679C;&#x4E22;&#x5931;&#x4E86;&#x548C;&#x5BF9;&#x8C61;&#x7684;&#x5730;&#x5740;&#x76F8;&#x5173;&#x7684;&#x6BD4;&#x7279;&#xFF0C;&#x5BF9;&#x8C61;&#x53EF;&#x80FD;&#x88AB;&#x9057;&#x5931;&#x3002;&#x4F8B;&#x5982;&#x5982;&#x679C;&#x4E0A;&#x4F8B;&#x7684;<code>x</code>&#x662F;&#x53F3;&#x4FA7;&#x6570;&#x7EC4;&#x552F;&#x4E00;&#x7684;&#x5907;&#x4EFD;(<span class="math inline">\(copy\)</span>)&#xFF0C;&#x90A3;&#x4E48;<code>x=null</code>&#x7684;&#x8D4B;&#x503C;&#x8BED;&#x53E5;&#x4F1A;&#x5BFC;&#x81F4;&#x539F;&#x5148;&#x6570;&#x7EC4;&#x7684;&#x4E22;&#x5931;&#x3002;&#x8FD9;&#x5E76;&#x975E;&#x574F;&#x4E8B;&#xFF0C;&#x56E0;&#x4E3A;&#x6709;&#x65F6;&#x6211;&#x4EEC;&#x7684;&#x786E;&#x9700;&#x8981;&#x9057;&#x5FD8;&#x4E00;&#x4E9B;&#x5BF9;&#x8C61;&#x3002;</p>
<h3 id="7&#x6574;&#x578B;&#x94FE;&#x8868;intlist">7.&#x6574;&#x578B;&#x94FE;&#x8868;(<span class="math inline">\(IntList\)</span>)</h3>
<h4 id="a&#x6574;&#x578B;&#x94FE;&#x8868;&#x7684;&#x6784;&#x5EFA;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&#x6574;&#x578B;&#x94FE;&#x8868;&#x7684;&#x6784;&#x5EFA;</h4>
<p>&#x2003;&#x2003;&#x7C7B;&#x4F3C;<span class="math inline">\(python\)</span>&#x4E2D;&#x7684;<span class="math inline">\(Linked\;list\)</span>&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x9012;&#x5F52;&#x7684;&#x65B9;&#x5F0F;&#x5B9E;&#x73B0;&#x521D;&#x6B65;&#x7684;&#x6574;&#x578B;&#x94FE;&#x8868;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IntList</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> first;</span><br><span class="line">    <span class="keyword">public</span> IntList rest;        </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">IntList</span><span class="params">(<span class="type">int</span> f, IntList r)</span> {</span><br><span class="line">        first = f;</span><br><span class="line">        rest = r;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x79CD;&#x5F62;&#x5F0F;&#x7684;&#x94FE;&#x8868;&#x4F7F;&#x7528;&#x8D77;&#x6765;&#x975E;&#x5E38;&#x4E0D;&#x65B9;&#x4FBF;&#x3001;&#x5BB9;&#x6613;&#x51FA;&#x9519;&#xFF0C;&#x4E4B;&#x540E;&#x6211;&#x4EEC;&#x5C06;&#x4F1A;&#x901A;&#x8FC7;&#x5728;&#x7C7B;&#x4E2D;&#x6DFB;&#x52A0;&#x8F85;&#x52A9;&#x65B9;&#x6CD5;(<span class="math inline">\(helper\;method\)</span>)&#x7684;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x7F16;&#x7A0B;&#x7B56;&#x7565;&#x6765;&#x4F18;&#x5316;&#x5B83;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">IntList</span> <span class="variable">L</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IntList</span>(<span class="number">5</span>, <span class="literal">null</span>);</span><br><span class="line">L.rest = <span class="keyword">new</span> <span class="title class_">IntList</span>(<span class="number">10</span>, <span class="literal">null</span>);</span><br><span class="line">L.rest.rest = <span class="keyword">new</span> <span class="title class_">IntList</span>(<span class="number">15</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">IntList</span> <span class="variable">L</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IntList</span>(<span class="number">15</span>, <span class="literal">null</span>);</span><br><span class="line">L = <span class="keyword">new</span> <span class="title class_">IntList</span>(<span class="number">10</span>, L);</span><br><span class="line">L = <span class="keyword">new</span> <span class="title class_">IntList</span>(<span class="number">5</span>, L);</span><br></pre></td></tr></table></figure></p>
<h4 id="bsize&#x51FD;&#x6570;&#x7684;&#x9012;&#x5F52;&#x4E0E;&#x8FED;&#x4EE3;&#x5B9E;&#x73B0;">&#x2003;&#x2003;<span class="math inline">\(b.\)</span><span class="math inline">\(Size\)</span>&#x51FD;&#x6570;&#x7684;&#x9012;&#x5F52;&#x4E0E;&#x8FED;&#x4EE3;&#x5B9E;&#x73B0;</h4>
<p>&#x2003;&#x2003;&#x6574;&#x578B;&#x94FE;&#x8868;&#x7684;<span class="math inline">\(Size\)</span>&#x51FD;&#x6570;&#x7684;&#x9012;&#x5F52;&#x5B9E;&#x73B0;&#x5982;&#x4E0B;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Return the size of the list using... recursion! */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">if</span> (rest == <span class="literal">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> + <span class="built_in">this</span>.rest.size();</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x91CC;&#x6709;&#x4E00;&#x4E2A;&#x8981;&#x70B9;&#xFF1A;&#x4E3A;&#x4EC0;&#x4E48;&#x9012;&#x5F52;&#x7684;&#x57FA;&#x672C;&#x6761;&#x4EF6;&#x4E0D;&#x5199;<code>if(this == null)</code>&#x5462;&#xFF1F;&#x95EE;&#x9898;&#x51FA;&#x5728;<code>L == null</code>&#x8FD9;&#x79CD;&#x7279;&#x6B8A;&#x60C5;&#x51B5;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x80FD;&#x5BF9;&#x4E00;&#x4E2A;<code>null</code>&#x5BF9;&#x8C61;&#x4F7F;&#x7528;&#x5B9E;&#x4F8B;&#x65B9;&#x6CD5;&#x3002;</p>
<p>&#x2003;&#x2003;<span class="math inline">\(Size\)</span>&#x51FD;&#x6570;&#x7684;&#x8FED;&#x4EE3;&#x5B9E;&#x73B0;&#x5982;&#x4E0B;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Return the size of the list using no recursion! */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">iterativeSize</span><span class="params">()</span> {</span><br><span class="line">    <span class="type">IntList</span> <span class="variable">p</span> <span class="operator">=</span> <span class="built_in">this</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">totalSize</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (p != <span class="literal">null</span>) {</span><br><span class="line">        totalSize += <span class="number">1</span>;</span><br><span class="line">        p = p.rest;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> totalSize;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x9700;&#x8981;&#x6CE8;&#x610F;&#xFF0C;&#x5728;&#x8FED;&#x4EE3;&#x65F6;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x6307;&#x9488;<code>p</code>&#xFF0C;&#x56E0;&#x4E3A;&#x5728;<span class="math inline">\(java\)</span>&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x80FD;&#x91CD;&#x65B0;&#x5206;&#x914D;(<span class="math inline">\(reassign\)</span>)<code>this</code>&#x3002;</p>
<blockquote>
<p><code>this</code>refers to the current object. It&apos;s like saying: &quot;I
am&quot; or &quot;my name is&quot;. You can&apos;t change who you are.</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/2.2.SLLists/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/2.2.SLLists/" class="post-title-link" itemprop="url">2.2.&#x5355;&#x94FE;&#x8868;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 16:39:07" itemprop="dateModified" datetime="2024-06-02T16:39:07+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/2-List/" itemprop="url" rel="index"><span itemprop="name">2.List</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>1.6k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>6 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="22&#x5355;&#x94FE;&#x8868;"><span class="math inline">\(2.2\)</span>&#x5355;&#x94FE;&#x8868;</h1>
<p>&#x2003;&#x2003;&#x5728;&#x524D;&#x4E00;&#x7AE0;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x642D;&#x5EFA;&#x4E86;&#x6574;&#x578B;&#x94FE;&#x8868;<span class="math inline">\(IntList\)</span>&#xFF0C;&#x4F46;&#x5728;&#x5B9E;&#x9645;&#x5E94;&#x7528;&#x4E2D;&#xFF0C;<span class="math inline">\(IntList\)</span>&#x8F83;&#x96BE;&#x4F7F;&#x7528;&#xFF0C;&#x5E76;&#x4E14;&#x4F1A;&#x5BFC;&#x81F4;&#x4EE3;&#x7801;&#x96BE;&#x4EE5;&#x7406;&#x89E3;&#x4E0E;&#x7EF4;&#x62A4;&#x3002;</p>
<p>&#x2003;&#x2003;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x7684;&#x6765;&#x6E90;&#x662F;&#xFF1A;<span class="math inline">\(IntList\)</span>&#x662F;&#x4E00;&#x4E2A;&#x88F8;&#x88F8;&#x9012;&#x5F52;&#x7ED3;&#x6784;&#xFF1A;<span class="math inline">\(IntList\)</span>&#x5728;&#x51FD;&#x6570;&#x5185;&#x90E8;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x81EA;&#x8EAB;&#x7684;&#x9012;&#x5F52;&#xFF0C;&#x800C;&#x6CA1;&#x6709;&#x5176;&#x4ED6;&#x8F85;&#x52A9;&#x64CD;&#x4F5C;&#x6216;&#x6761;&#x4EF6;&#x68C0;&#x67E5;&#x3002;</p>
<p>&#x2003;&#x2003;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x5BF9;<span class="math inline">\(IntList\)</span>&#x8FDB;&#x884C;&#x4E00;&#x7CFB;&#x5217;&#x4F18;&#x5316;&#xFF0C;&#x6765;&#x642D;&#x5EFA;&#x65B0;&#x7684;&#x7C7B;<span class="math inline">\(SLList\)</span>&#x3002;</p>
<h3 id="1&#x91CD;&#x6784;">1.&#x91CD;&#x6784;</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IntNode</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> item;</span><br><span class="line">    <span class="keyword">public</span> IntNode next;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">IntNode</span><span class="params">(<span class="type">int</span> i, IntNode n)</span> {</span><br><span class="line">        item = i;</span><br><span class="line">        next = n;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;&#x4E3A;&#x4E86;&#x907F;&#x514D;<span class="math inline">\(IntList\)</span>&#x7684;&#x590D;&#x6742;&#x4F7F;&#x7528;&#xFF0C;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;<span class="math inline">\(SLList\)</span>&#x7C7B;&#x7ED9;&#x7528;&#x6237;&#x4F7F;&#x7528;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SLList</span> {</span><br><span class="line">    <span class="keyword">public</span> IntNode first;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SLList</span><span class="params">(<span class="type">int</span> x)</span> {</span><br><span class="line">        first = <span class="keyword">new</span> <span class="title class_">IntNode</span>(x, <span class="literal">null</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;<span class="math inline">\(SLList\)</span>&#x7684;&#x5B9E;&#x73B0;&#x9690;&#x85CF;&#x4E86;<span class="math inline">\(IntList\)</span>&#x7684;&#x4E00;&#x4E9B;&#x7EC6;&#x8282;&#xFF0C;&#x4F7F;&#x5F97;&#x5B9A;&#x4E49;&#x94FE;&#x8868;&#x53D8;&#x5F97;&#x66F4;&#x7B80;&#x6D01;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">IntList</span> <span class="variable">L1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IntList</span>(<span class="number">5</span>, <span class="literal">null</span>);</span><br><span class="line"><span class="type">SLList</span> <span class="variable">L2</span>  <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SLList</span>(<span class="number">5</span>);</span><br></pre></td></tr></table></figure></p>
<h3 id="2addfirstgetfirst">2.<code>addFirst</code>&#xFF0C;<code>getFirst</code></h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFirst</span><span class="params">(<span class="type">int</span> x)</span> {</span><br><span class="line">    first = <span class="keyword">new</span> <span class="title class_">IntNode</span>(x, first);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getFirst</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> first.item;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;&#x8FD9;&#x6837;&#x4F18;&#x5316;&#x540E;&#x7684;&#x94FE;&#x8868;&#x5F88;&#x65B9;&#x4FBF;&#x4F7F;&#x7528;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SLList</span> <span class="variable">L</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SLList</span>(<span class="number">15</span>);</span><br><span class="line">L.addFirst(<span class="number">10</span>);</span><br><span class="line">L.addFirst(<span class="number">5</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> L.getFirst();</span><br><span class="line"></span><br><span class="line"><span class="comment">//compared with IntList//</span></span><br><span class="line"><span class="type">IntList</span> <span class="variable">L</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IntList</span>(<span class="number">15</span>, <span class="literal">null</span>);</span><br><span class="line">L = <span class="keyword">new</span> <span class="title class_">IntList</span>(<span class="number">10</span>, L);</span><br><span class="line">L = <span class="keyword">new</span> <span class="title class_">IntList</span>(<span class="number">5</span>, L);</span><br><span class="line"><span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> L.first;</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;<span class="math inline">\(SLList\)</span>&#x7C7B;&#x626E;&#x6F14;&#x4E86;&#x94FE;&#x8868;&#x4F7F;&#x7528;&#x8005;&#x548C;&#x88F8;&#x9012;&#x5F52;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x95F4;&#x4E2D;&#x4ECB;&#x4EBA;&#x7684;&#x89D2;&#x8272;&#x3002;</p>
<h3 id="3public&#x548C;private">3.<code>public</code>&#x548C;<code>private</code></h3>
<p>&#x2003;&#x2003;&#x5148;&#x524D;&#x5B9A;&#x4E49;&#x7684;<span class="math inline">\(SLList\)</span>&#x6709;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF1A;&#x7528;&#x6237;&#x7684;&#x4E00;&#x4E9B;&#x64CD;&#x4F5C;&#x4F1A;&#x5BFC;&#x81F4;&#x94FE;&#x8868;&#x7684;&#x5F02;&#x5E38;&#x3002;&#x4F8B;&#x5982;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SLList</span> <span class="variable">L</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SLList</span>(<span class="number">15</span>);</span><br><span class="line">L.addFirst(<span class="number">10</span>);</span><br><span class="line">L.first.next.next = L.first.next;</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x4F1A;&#x5BFC;&#x81F4;&#x94FE;&#x8868;&#x7684;&#x65E0;&#x9650;&#x5EF6;&#x957F;&#xFF0C;&#x800C;&#x8FD9;&#x662F;&#x6211;&#x4EEC;&#x4E0D;&#x5E0C;&#x671B;&#x770B;&#x5230;&#x7684;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x91C7;&#x7528;&#x4E0B;&#x9762;&#x7684;&#x65B9;&#x6CD5;&#x6765;&#x675C;&#x7EDD;&#x8FD9;&#x4EF6;&#x4E8B;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SLList</span> {</span><br><span class="line">    <span class="keyword">private</span> IntNode first;</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;<code>private</code>&#x53D8;&#x91CF;&#x548C;&#x65B9;&#x6CD5;&#x53EA;&#x80FD;&#x88AB;&#x540C;&#x4E00;&#x4E2A;<code>.java</code>&#x6587;&#x4EF6;&#x5185;&#x7684;&#x4EE3;&#x7801;&#x8BBF;&#x95EE;&#xFF0C;&#x5176;&#x4ED6;&#x6587;&#x4EF6;&#x8BBF;&#x95EE;&#x5B83;&#x65F6;&#xFF0C;&#x4F1A;&#x8FD4;&#x56DE;<code>first has private access in SLList</code>&#x7684;&#x9519;&#x8BEF;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5728;&#x8F6F;&#x4EF6;&#x5DE5;&#x7A0B;&#x4E2D;&#xFF0C;<code>private</code>&#x5173;&#x952E;&#x5B57;&#x8868;&#x660E;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;&#x5E94;&#x8BE5;&#x88AB;&#x7528;&#x6237;&#x5FFD;&#x7565;&#x3001;&#x4E5F;&#x4E0D;&#x9700;&#x8981;&#x88AB;&#x7528;&#x6237;&#x7406;&#x89E3;&#x3002;<code>public</code>&#x5173;&#x952E;&#x5B57;&#x5219;&#x58F0;&#x660E;&#x4E86;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x662F;&#x53EF;&#x7528;&#x7684;&#x3001;&#x5E76;&#x4E14;&#x6C38;&#x8FDC;&#x4E0D;&#x4F1A;&#x51FA;&#x9519;(&#x4E0D;&#x7BA1;&#x7528;&#x6237;&#x505A;&#x51FA;&#x4EC0;&#x4E48;&#x66F4;&#x6539;)&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x8981;&#x8C28;&#x614E;&#x4F7F;&#x7528;<code>public</code>&#x5173;&#x952E;&#x5B57;&#x3002;</p>
<blockquote>
<p>&#x2003;&#x2003;As an analogy, a car has certain public features, e.g. the
accelerator and brake pedals. Under the hood, there are private details
about how these operate. In a gas powered car, the accelerator pedal
might control some sort of fuel injection system, and in a battery
powered car, it may adjust the amount of battery power being delivered
to the motor. While the private details may vary from car to car, we
expect the same behavior from all accelerator pedals. Changing these
would cause great consternation from users, and quite possibly terrible
accidents.</p>
</blockquote>
<h3 id="4&#x5D4C;&#x5957;&#x7C7B;">4.&#x5D4C;&#x5957;&#x7C7B;</h3>
<p>&#x2003;&#x2003;&#x76EE;&#x524D;&#x4E3A;&#x6B62;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x4E86;&#x4E24;&#x4E2A;&#x7C7B;&#xFF1A;<span class="math inline">\(IntNode\)</span>&#x548C;<span class="math inline">\(SLList\)</span>&#xFF0C;&#x4F46;&#x662F;<span class="math inline">\(IntNode\)</span>&#x5B9E;&#x9645;&#x4E0A;&#x53EA;&#x662F;&#x8F85;&#x52A9;<span class="math inline">\(SLList\)</span>&#x7684;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5BF9;&#x6B64;&#xFF0C;<span class="math inline">\(Java\)</span>&#x5141;&#x8BB8;&#x6211;&#x4EEC;&#x5728;&#x4E00;&#x4E2A;&#x7C7B;&#x91CC;&#x9762;&#x5B9A;&#x4E49;&#x5176;&#x4ED6;&#x7C7B;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SLList</span> {</span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IntNode</span> {</span><br><span class="line">            <span class="keyword">public</span> <span class="type">int</span> item;</span><br><span class="line">            <span class="keyword">public</span> IntNode next;</span><br><span class="line">            <span class="keyword">public</span> <span class="title function_">IntNode</span><span class="params">(<span class="type">int</span> i, IntNode n)</span> {</span><br><span class="line">                item = i;</span><br><span class="line">                next = n;</span><br><span class="line">            }</span><br><span class="line">       }</span><br><span class="line"></span><br><span class="line">       <span class="keyword">private</span> IntNode first; </span><br><span class="line"></span><br><span class="line">       <span class="keyword">public</span> <span class="title function_">SLList</span><span class="params">(<span class="type">int</span> x)</span> {</span><br><span class="line">           first = <span class="keyword">new</span> <span class="title class_">IntNode</span>(x, <span class="literal">null</span>);</span><br><span class="line">       } </span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5D4C;&#x5957;&#x7C7B;&#x4E0E;&#x5206;&#x5F00;&#x5B9A;&#x4E49;&#x4E24;&#x4E2A;&#x7C7B;&#x7684;&#x6548;&#x679C;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x53EA;&#x662F;&#x524D;&#x8005;&#x80FD;&#x8BA9;&#x4EE3;&#x7801;&#x770B;&#x8D77;&#x6765;&#x66F4;&#x4E3A;&#x6574;&#x9F50;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5982;&#x679C;&#x5D4C;&#x5957;&#x7C7B;&#x4E0D;&#x9700;&#x8981;&#x4F7F;&#x7528;<span class="math inline">\(SLList\)</span>&#x4E2D;&#x7684;&#x4EFB;&#x4F55;&#x5B9E;&#x4F8B;&#x65B9;&#x6CD5;&#x6216;&#x8005;&#x53D8;&#x91CF;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;<code>static</code>&#x6765;&#x58F0;&#x660E;&#x5B83;&#x3002;<code>static</code>&#x5173;&#x952E;&#x5B57;&#x8BF4;&#x660E;&#x9759;&#x6001;&#x7C7B;(<span class="math inline">\(static\;class\)</span>)&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#x4E0D;&#x80FD;&#x8BBF;&#x95EE;&#x4EFB;&#x4F55;&#x5728;&#x5C01;&#x95ED;&#x7C7B;&#x4E2D;&#x7684;&#x6210;&#x5458;&#x3002;&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740;<span class="math inline">\(IntNode\)</span>&#x4E0D;&#x80FD;&#x591F;&#x8BBF;&#x95EE;<code>first</code>&#xFF0C;<code>addFirst</code>&#x6216;&#x8005;<code>getFirst</code>&#x3002;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SLList</span> {</span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">IntNode</span> {</span><br><span class="line">            <span class="keyword">public</span> <span class="type">int</span> item;</span><br><span class="line">            <span class="keyword">public</span> IntNode next;</span><br><span class="line">            <span class="keyword">public</span> <span class="title function_">IntNode</span><span class="params">(<span class="type">int</span> i, IntNode n)</span> {</span><br><span class="line">                item = i;</span><br><span class="line">                next = n;</span><br><span class="line">            }</span><br><span class="line">       }</span><br><span class="line"></span><br><span class="line">       <span class="keyword">private</span> IntNode first;</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x6837;&#x7684;&#x505A;&#x6CD5;&#x53EF;&#x4EE5;&#x8282;&#x7EA6;&#x4E00;&#x4E9B;&#x5185;&#x5B58;&#xFF0C;&#x56E0;&#x4E3A;&#x4E4B;&#x540E;<span class="math inline">\(IntNode\)</span>&#x5C31;&#x4E0D;&#x9700;&#x8981;&#x518D;&#x8FFD;&#x8E2A;&#x5B83;&#x600E;&#x4E48;&#x8BBF;&#x95EE;&#x5B83;&#x6240;&#x5904;&#x7684;<span class="math inline">\(SLList\)</span>&#x4E86;&#xFF0C;&#x4ECE;&#x800C;<span class="math inline">\(IntNode\)</span>&#x4E0D;&#x4F1A;&#x8C03;&#x7528;<span class="math inline">\(SLList\)</span>&#x3002;</p>
<blockquote>
<p>&#x2003;&#x2003;if you don&apos;t use any instance members of the outer class, make the
nested class static.</p>
</blockquote>
<h3 id="5addlast-size">5.<code>addLast</code>&#x3001;<code>size</code></h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Adds an item to the end of the list. */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addLast</span><span class="params">(<span class="type">int</span> x)</span> {</span><br><span class="line">    <span class="type">IntNode</span> <span class="variable">p</span> <span class="operator">=</span> first;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Advance p to the end of the list. */</span></span><br><span class="line">    <span class="keyword">while</span> (p.next != <span class="literal">null</span>) {</span><br><span class="line">        p = p.next;</span><br><span class="line">    }</span><br><span class="line">    p.next = <span class="keyword">new</span> <span class="title class_">IntNode</span>(x, <span class="literal">null</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Returns the size of the list starting at IntNode p. */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">(IntNode p)</span> {</span><br><span class="line">    <span class="keyword">if</span> (p.next == <span class="literal">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> + size(p.next);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;&#x8FD9;&#x4E2A;<span class="math inline">\(size\)</span>&#x51FD;&#x6570;&#x4E5F;&#x662F;<span class="math inline">\(O(n)\)</span>&#x590D;&#x6742;&#x5EA6;&#x7684;&#x3002;&#x4E3A;&#x4E86;&#x51CF;&#x5C11;&#x65F6;&#x95F4;&#x6D88;&#x8017;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x50CF;&#x521B;&#x5EFA;<span class="math inline">\(SLList\)</span>&#x4E00;&#x6837;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x201C;&#x4E2D;&#x4ECB;&#x4EBA;&#x201D;&#xFF0C;&#x6765;&#x5B9E;&#x73B0;&#x7528;&#x6237;&#x5BF9;<span class="math inline">\(Size\)</span>&#x7684;&#x8BBF;&#x95EE;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Returns the size of the list starting at IntNode p. */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">(IntNode p)</span> {</span><br><span class="line">    <span class="keyword">if</span> (p.next == <span class="literal">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> + size(p.next);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> size(first);</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x91CC;&#x51FA;&#x73B0;&#x4E86;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x540D;&#x79F0;&#x90FD;&#x53EB;<span class="math inline">\(size\)</span>&#x3002;&#x8FD9;&#x662F;&#x5141;&#x8BB8;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x6709;&#x4E0D;&#x540C;&#x7684;&#x53C2;&#x6570;&#x3002;&#x6211;&#x4EEC;&#x628A;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x540D;&#x5B57;&#x76F8;&#x540C;&#x3001;&#x53C2;&#x6570;&#x4E0D;&#x540C;&#x7684;&#x65B9;&#x6CD5;&#x79F0;&#x4F5C;&#x91CD;&#x8F7D;(<span class="math inline">\(overloaded\)</span>)&#x3002;</p>
<h3 id="6&#x7F13;&#x5B58;cashing">6.&#x7F13;&#x5B58;<span class="math inline">\(cashing\)</span></h3>
<p>&#x2003;&#x2003;&#x9664;&#x4E86;&#x7528;&#x4E0A;&#x9762;&#x7684;&#x65B9;&#x6CD5;&#x8BA1;&#x7B97;<span class="math inline">\(size\)</span>&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x5728;<span class="math inline">\(SLList\)</span>&#x7C7B;&#x4E2D;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;<span class="math inline">\(size\)</span>&#x53D8;&#x91CF;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SLList</span> {</span><br><span class="line">    ... <span class="comment">/* IntNode declaration omitted. */</span></span><br><span class="line">    <span class="keyword">private</span> IntNode first;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SLList</span><span class="params">(<span class="type">int</span> x)</span> {</span><br><span class="line">        first = <span class="keyword">new</span> <span class="title class_">IntNode</span>(x, <span class="literal">null</span>);</span><br><span class="line">        size = <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFirst</span><span class="params">(<span class="type">int</span> x)</span> {</span><br><span class="line">        first = <span class="keyword">new</span> <span class="title class_">IntNode</span>(x, first);</span><br><span class="line">        size += <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    }</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x79CD;&#x901A;&#x8FC7;&#x4FDD;&#x5B58;&#x5173;&#x952E;&#x4FE1;&#x606F;&#x6765;&#x52A0;&#x901F;&#x68C0;&#x7D22;&#x7684;&#x65B9;&#x6CD5;&#x88AB;&#x79F0;&#x4E3A;&#x7F13;&#x5B58;(<span class="math inline">\(cashing\)</span>)&#x3002;</p>
<h3 id="7&#x7A7A;&#x94FE;&#x8868;">7.&#x7A7A;&#x94FE;&#x8868;</h3>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;<span class="math inline">\(SLList\)</span>&#x7684;&#x6846;&#x67B6;&#x53EF;&#x4EE5;&#x8F7B;&#x677E;&#x5730;&#x521D;&#x59CB;&#x5316;&#x94FE;&#x8868;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">SLList</span><span class="params">()</span> {</span><br><span class="line">    first = <span class="literal">null</span>;</span><br><span class="line">    size = <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h3 id="8&#x54E8;&#x5175;&#x8282;&#x70B9;sentinel">8.&#x54E8;&#x5175;&#x8282;&#x70B9;(<span class="math inline">\(sentinel\)</span>)</h3>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6309;&#x7167;&#x4E0A;&#x4E00;&#x7AE0;&#x7684;&#x65B9;&#x6CD5;&#x5B9E;&#x73B0;<code>addLast</code>&#x65B9;&#x6CD5;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addLast</span><span class="params">(<span class="type">int</span> x)</span> {</span><br><span class="line">    size += <span class="number">1</span>;</span><br><span class="line">    <span class="type">IntNode</span> <span class="variable">p</span> <span class="operator">=</span> first;</span><br><span class="line">    <span class="keyword">while</span> (p.next != <span class="literal">null</span>) {</span><br><span class="line">        p = p.next;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    p.next = <span class="keyword">new</span> <span class="title class_">IntNode</span>(x, <span class="literal">null</span>);</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x4F46;&#x662F;&#xFF0C;&#x5F53;&#x4F20;&#x5165;&#x7684;&#x94FE;&#x8868;&#x662F;&#x7A7A;&#x94FE;&#x8868;&#x65F6;&#xFF0C;&#x7531;&#x4E8E;<code>first == null</code>&#xFF0C;<code>while(p.next != null),p.next</code>&#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x90FD;&#x4F1A;&#x5BFC;&#x81F4;<code>null pointer exceptation</code>&#x7684;&#x9519;&#x8BEF;&#x3002;</p>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5355;&#x72EC;&#x8BA8;&#x8BBA;<code>first == null</code>&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x4F46;&#x8FD9;&#x6837;&#x4F1A;&#x8BA9;&#x7A0B;&#x5E8F;&#x53D8;&#x5F97;&#x590D;&#x6742;&#x3002;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x8BBE;&#x6CD5;&#x5C06;&#x6240;&#x6709;&#x7684;&#x94FE;&#x8868;&#x90FD;&#x7EDF;&#x4E00;&#x6210;&#x4E00;&#x79CD;&#x60C5;&#x51B5;&#x3002;</p>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x94FE;&#x8868;&#x7684;&#x5F00;&#x5934;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#xFF0C;&#x53EB;&#x4F5C;&#x54E8;&#x5175;&#x8282;&#x70B9;(<span class="math inline">\(sentinel\;node\)</span>)&#xFF0C;&#x4E0D;&#x7BA1;&#x94FE;&#x8868;&#x662F;&#x5426;&#x4E3A;&#x7A7A;&#xFF0C;&#x8FD9;&#x4E2A;&#x8282;&#x70B9;&#x90FD;&#x5B58;&#x5728;&#x3002;</p>
<p><img src="/2024/05/31/2.2.SLLists/image-9.png"></p>
<p><img src="/2024/05/31/2.2.SLLists/image-10.png"></p>
<p>&#x2003;&#x2003;&#x5728;&#x5C06;&#x6240;&#x6709;&#x60C5;&#x51B5;&#x7EDF;&#x4E00;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x66F4;&#x597D;&#x5730;&#x5B9E;&#x73B0;<code>addLast</code>&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addLast</span><span class="params">(<span class="type">int</span> x)</span> {</span><br><span class="line">    size += <span class="number">1</span>;</span><br><span class="line">    <span class="type">IntNode</span> <span class="variable">p</span> <span class="operator">=</span> sentinel;</span><br><span class="line">    <span class="keyword">while</span>(p.next != <span class="literal">null</span>) {</span><br><span class="line">        p = p.next;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    p.next = <span class="keyword">new</span> <span class="title class_">IntNode</span>(x, <span class="literal">null</span>);</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h3 id="9&#x4E0D;&#x53D8;&#x91CF;invarient">9.&#x4E0D;&#x53D8;&#x91CF;<span class="math inline">\(invarient\)</span></h3>
<p>&#x2003;&#x2003;&#x4E0D;&#x53D8;&#x91CF;&#xFF0C;&#x5C31;&#x662F;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x4E2D;&#x5FC5;&#x987B;&#x8981;&#x9075;&#x5B88;&#x7684;&#x4E8B;&#x5B9E;(<span class="math inline">\(fact\;that\;is\;guaranteed\;to\;be\;true\)</span>)&#x3002;</p>
<p>&#x2003;&#x2003;&#x4E00;&#x4E2A;<span class="math inline">\(SLList\)</span>&#x81F3;&#x5C11;&#x8981;&#x9075;&#x5FAA;&#x4EE5;&#x4E0B;&#x4E0D;&#x53D8;&#x91CF;&#xFF1A;</p>
<ul>
<li><code>sentinel</code>&#x603B;&#x662F;&#x6307;&#x5411;&#x54E8;&#x5175;&#x8282;&#x70B9;&#x3002;</li>
<li>&#x94FE;&#x8868;&#x6700;&#x524D;&#x9762;&#x7684;&#x5143;&#x7D20;(&#x5982;&#x679C;&#x5B58;&#x5728;&#x7684;&#x8BDD;)&#x6C38;&#x8FDC;&#x662F;<code>sentinel.next.item</code>&#x3002;</li>
<li><code>size</code>&#x53D8;&#x91CF;&#x6C38;&#x8FDC;&#x4EE3;&#x6307;&#x88AB;&#x52A0;&#x5165;&#x94FE;&#x8868;&#x7684;&#x5143;&#x7D20;&#x7684;&#x6570;&#x91CF;&#x3002;</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/2.2.%E6%95%B0%E6%8D%AE%E6%8A%BD%E8%B1%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/2.2.%E6%95%B0%E6%8D%AE%E6%8A%BD%E8%B1%A1/" class="post-title-link" itemprop="url">2.2.&#x6570;&#x636E;&#x62BD;&#x8C61;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 14:42:02" itemprop="dateModified" datetime="2024-06-02T14:42:02+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SICP-in-python/" itemprop="url" rel="index"><span itemprop="name">SICP in python</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SICP-in-python/Chapter-2-Building-Abstraction-with-Data/" itemprop="url" rel="index"><span itemprop="name">Chapter 2.Building Abstraction with Data</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>1.5k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>5 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="22&#x6570;&#x636E;&#x62BD;&#x8C61;"><span class="math inline">\(2.2\)</span>&#x6570;&#x636E;&#x62BD;&#x8C61;</h1>
<h3 id="1&#x6570;&#x636E;&#x62BD;&#x8C61;&#x7684;&#x6982;&#x5FF5;">1.&#x6570;&#x636E;&#x62BD;&#x8C61;&#x7684;&#x6982;&#x5FF5;</h3>
<p>&#x2003;&#x2003;&#x5C06;&#x6570;&#x636E;&#x5206;&#x5F00;&#x8868;&#x793A;&#x4E3A;&#x5982;&#x4F55;&#x8868;&#x793A;&#x6570;&#x636E;&#x7684;&#x90E8;&#x5206;<span class="math inline">\(constructor\)</span>&#x4E0E;&#x5982;&#x4F55;&#x64CD;&#x4F5C;&#x6570;&#x636E;&#x7684;&#x90E8;&#x5206;<span class="math inline">\(operator\)</span>&#x7684;&#x65B9;&#x6CD5;&#x88AB;&#x79F0;&#x4E3A;<strong>&#x6570;&#x636E;&#x62BD;&#x8C61;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x6570;&#x636E;&#x62BD;&#x8C61;&#x5728;&#x6982;&#x5FF5;&#x4E0A;&#x4E0E;&#x51FD;&#x6570;&#x62BD;&#x8C61;&#x7C7B;&#x4F3C;&#x3002;&#x5F53;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x51FD;&#x6570;&#x62BD;&#x8C61;&#x65F6;&#xFF0C;&#x51FD;&#x6570;&#x5B9E;&#x73B0;&#x7684;&#x7EC6;&#x8282;&#x53EF;&#x4EE5;&#x88AB;&#x6291;&#x5236;&#xFF0C;&#x7279;&#x5B9A;&#x51FD;&#x6570;&#x672C;&#x8EAB;&#x53EF;&#x4EE5;&#x88AB;&#x5177;&#x6709;&#x76F8;&#x540C;&#x6574;&#x4F53;&#x884C;&#x4E3A;&#x7684;&#x4EFB;&#x4F55;&#x5176;&#x4ED6;&#x51FD;&#x6570;&#x66FF;&#x6362;&#x3002;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;<strong>&#x5236;&#x4F5C;&#x4E00;&#x4E2A;&#x62BD;&#x8C61;&#xFF0C;&#x5C06;&#x51FD;&#x6570;&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#x4E0E;&#x51FD;&#x6570;&#x7684;&#x5B9E;&#x73B0;&#x7EC6;&#x8282;&#x5206;&#x5F00;</strong>&#x3002;&#x800C;&#x6570;&#x636E;&#x62BD;&#x8C61;&#x4E5F;&#x5C06;&#x5BF9;<strong>&#x590D;&#x5408;&#x6570;&#x636E;&#x7684;&#x5904;&#x7406;&#x65B9;&#x5F0F;</strong>&#x4E0E;<strong>&#x5BF9;&#x590D;&#x5408;&#x6570;&#x636E;&#x7684;&#x6784;&#x9020;&#x65B9;&#x5F0F;</strong>&#x5206;&#x79BB;&#x5F00;&#x6765;&#x3002;</p>
<p>&#x2003;&#x2003;&#x6570;&#x636E;&#x62BD;&#x8C61;&#x7684;&#x57FA;&#x672C;&#x601D;&#x60F3;&#x662F;&#x7EC4;&#x7EC7;&#x7A0B;&#x5E8F;&#xFF0C;&#x4F7F;&#x5B83;&#x4EEC;&#x80FD;&#x591F;&#x5728;&#x62BD;&#x8C61;&#x7684;&#x6570;&#x636E;&#x4E0A;&#x8FD0;&#x884C;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x7A0B;&#x5E8F;&#x4F7F;&#x7528;&#x6570;&#x636E;&#x7684;&#x65B9;&#x5F0F;&#x5E94;&#x8BE5;&#x5C3D;&#x53EF;&#x80FD;&#x5C11;&#x5730;&#x5BF9;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x5047;&#x8BBE;(&#x5373;&#x57FA;&#x672C;&#x7684;&#x64CD;&#x4F5C;&#x6B65;&#x9AA4;&#x5C3D;&#x53EF;&#x80FD;&#x5C11;)&#x3002;&#x540C;&#x65F6;&#x5C06;&#x5177;&#x4F53;&#x7684;&#x6570;&#x636E;&#x8868;&#x793A;&#x5B9A;&#x4E49;&#x4E3A;&#x7A0B;&#x5E8F;&#x7684;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x90E8;&#x5206;&#x3002;</p>
<p>&#x2003;&#x2003;&#x7A0B;&#x5E8F;&#x64CD;&#x4F5C;&#x62BD;&#x8C61;&#x6570;&#x636E;&#x7684;&#x90E8;&#x5206;&#x548C;&#x5B9A;&#x4E49;&#x6570;&#x636E;&#x8868;&#x793A;&#x7684;&#x90E8;&#x5206;&#xFF0C;&#x7531;&#x4E00;&#x5C0F;&#x7EC4;&#x51FD;&#x6570;&#x8FDE;&#x63A5;&#x8D77;&#x6765;&#xFF0C;&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x6839;&#x636E;&#x5177;&#x4F53;&#x8868;&#x793A;&#x5B9E;&#x73B0;&#x62BD;&#x8C61;&#x6570;&#x636E;&#x3002;&#x4E0B;&#x4E3E;&#x4E00;&#x4F8B;&#x8BF4;&#x660E;&#x6570;&#x636E;&#x62BD;&#x8C61;&#x6D41;&#x7A0B;&#x7684;&#x5B9E;&#x73B0;&#x3002;</p>
<h3 id="2&#x5B9E;&#x4F8B;&#x8BB2;&#x89E3;&#x5BF9;&#x6709;&#x7406;&#x6570;&#x64CD;&#x4F5C;&#x7684;&#x5B9E;&#x73B0;">2.&#x5B9E;&#x4F8B;&#x8BB2;&#x89E3;&#x2014;&#x2014;&#x5BF9;&#x6709;&#x7406;&#x6570;&#x64CD;&#x4F5C;&#x7684;&#x5B9E;&#x73B0;&#xFF1A;</h3>
<p>&#x2003;&#x2003;&#x6709;&#x7406;&#x6570;&#x7684;&#x5B9A;&#x4E49;&#x662F;&#x4E24;&#x4E2A;&#x6574;&#x6570;&#x7684;&#x548C;&#x3002;&#x7531;&#x4E8E;&#x8BA1;&#x7B97;&#x673A;&#x7684;&#x6D6E;&#x70B9;&#x6570;&#x8BA1;&#x7B97;&#x4F1A;&#x964D;&#x4F4E;&#x8FD0;&#x7B97;&#x7CBE;&#x5EA6;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x5206;&#x6570;&#x5B9E;&#x73B0;&#x6709;&#x7406;&#x6570;&#x7684;&#x8868;&#x793A;&#x4E0E;&#x8FD0;&#x7B97;&#x3002;</p>
<h4 id="a&#x901A;&#x8FC7;&#x5047;&#x8BBE;&#x5B9E;&#x73B0;operator">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&#x901A;&#x8FC7;&#x5047;&#x8BBE;&#x5B9E;&#x73B0;<span class="math inline">\(operator\)</span></h4>
<p>&#x2003;&#x2003;&#x901A;&#x8FC7;&#x5148;&#x524D;&#x7684;&#x51FD;&#x6570;&#x62BD;&#x8C61;&#xFF0C;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#xFF0C;&#x5728;&#x5B9E;&#x73B0;&#x7A0B;&#x5E8F;&#x7684;&#x67D0;&#x4E9B;&#x90E8;&#x5206;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x6709;&#x6548;&#x5730;&#x5F00;&#x59CB;&#x7F16;&#x7A0B;&#x3002;&#x8BA9;&#x6211;&#x4EEC;<strong>&#x5148;&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#xFF0C;&#x53EF;&#x4EE5;&#x4ECE;&#x5206;&#x5B50;&#x548C;&#x5206;&#x6BCD;&#x6784;&#x9020;&#x51FA;&#x4E00;&#x4E2A;&#x6709;&#x7406;&#x6570;</strong>&#x3002;&#x6211;&#x4EEC;&#x8FD8;&#x5047;&#x8BBE;&#xFF0C;<strong>&#x7ED9;&#x5B9A;&#x4E00;&#x4E2A;&#x6709;&#x7406;&#x6570;&#xFF0C;&#x6211;&#x4EEC;&#x6709;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#x6765;&#x9009;&#x62E9;&#x5B83;&#x7684;&#x5206;&#x5B50;&#x548C;&#x5206;&#x6BCD;&#x5206;&#x91CF;</strong>&#x3002;&#x6211;&#x4EEC;<strong>&#x8FDB;&#x4E00;&#x6B65;&#x5047;&#x8BBE;&#x6784;&#x9020;&#x51FD;&#x6570;&#x548C;&#x9009;&#x62E9;&#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x4EE5;&#x4E0B;&#x4E09;&#x4E2A;&#x51FD;&#x6570;&#x4F7F;&#x7528;:</strong></p>
<ul>
<li><code>ration(n,d)</code>&#xFF1A;&#x8FD4;&#x56DE;<span class="math inline">\(n\over
d\)</span>&#x8868;&#x793A;&#x7684;&#x6709;&#x7406;&#x6570;</li>
<li><code>numer(x)</code>&#xFF1A;&#x8FD4;&#x56DE;<span class="math inline">\(x\)</span>&#x7684;&#x5206;&#x5B50;</li>
<li><code>denom(x)</code>&#xFF1A;&#x8FD4;&#x56DE;<span class="math inline">\(x\)</span>&#x7684;&#x5206;&#x6BCD;</li>
</ul>
<p>&#x2003;&#x2003;&#x5728;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x7528;&#x5230;&#x4E86;&#x7A0B;&#x5E8F;&#x8BBE;&#x8BA1;&#x7684;&#x91CD;&#x8981;&#x601D;&#x60F3;&#xFF1A;<span class="math inline">\(wishful\;thinking\)</span>&#x3002;&#x6211;&#x4EEC;&#x5E76;&#x4E0D;&#x77E5;&#x9053;&#x8FD9;&#x4E09;&#x4E2A;&#x51FD;&#x6570;&#x5177;&#x4F53;&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x5047;&#x8BBE;&#x5B83;&#x4EEC;&#x5DF2;&#x7ECF;&#x5B9E;&#x73B0;&#x4E86;&#xFF0C;&#x4E8E;&#x662F;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5047;&#x8BBE;&#x5B9E;&#x73B0;&#x52A0;&#x3001;&#x51CF;&#x3001;&#x4E58;&#x3001;&#x9664;&#x7B49;&#x57FA;&#x672C;&#x64CD;&#x4F5C;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">add_rationals</span>(<span class="params">x, y</span>):</span><br><span class="line">    nx, dx = numer(x), denom(x)</span><br><span class="line">    ny, dy = numer(y), denom(y)</span><br><span class="line">    <span class="keyword">return</span> rational(nx * dy + ny * dx, dx * dy)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mul_rationals</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="keyword">return</span> rational(numer(x) * numer(y), denom(x) * denom(y))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_rational</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="built_in">print</span>(numer(x), <span class="string">&apos;/&apos;</span>, denom(x))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rationals_are_equal</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="keyword">return</span> numer(x) * denom(y) == numer(y) * denom(x)</span><br><span class="line"><span class="comment">#&#x8FD9;&#x662F;&#x672A;&#x7EA6;&#x5206;&#x540E;&#x7684;&#xFF0C;&#x7EA6;&#x5206;&#x540E;&#x7ED3;&#x679C;&#x9664;&#x4EE5;gcd&#x5373;&#x53EF;</span></span><br></pre></td></tr></table></figure> &#x2003;&#x2003;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x4E86;&#x57FA;&#x4E8E;<span class="math inline">\(selector\)</span>&#x53D8;&#x91CF;&#x4E0E;<span class="math inline">\(constructor\)</span>&#x53D8;&#x91CF;&#x7684;<span class="math inline">\(operator\)</span>&#x51FD;&#x6570;&#xFF0C;&#x5269;&#x4E0B;&#x7684;&#x4EFB;&#x52A1;&#x5C31;&#x662F;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x6211;&#x4EEC;&#x7684;&#x5047;&#x8BBE;&#x3002;</p>
<h4 id="bselector&#x4E0E;constructor&#x7684;&#x5B9E;&#x73B0;">&#x2003;&#x2003;<span class="math inline">\(b.\)</span><span class="math inline">\(selector\)</span>&#x4E0E;<span class="math inline">\(constructor\)</span>&#x7684;&#x5B9E;&#x73B0;</h4>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x5229;&#x7528;<span class="math inline">\(python\)</span>&#x81EA;&#x5E26;&#x7684;<span class="math inline">\(list\)</span>&#x529F;&#x80FD;&#x5B9E;&#x73B0;<span class="math inline">\(pair\)</span>&#x7684;&#x6784;&#x5EFA;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">rational</span>(<span class="params">n, d</span>):</span><br><span class="line">    <span class="keyword">return</span> [n, d]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">numer</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> x[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">denom</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> x[<span class="number">1</span>]</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x6837;&#xFF0C;&#x5229;&#x7528;&#x6211;&#x4EEC;&#x7684;&#x6570;&#x636E;&#x62BD;&#x8C61;&#x4E0E;&#x57FA;&#x672C;&#x64CD;&#x4F5C;&#xFF0C;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x6709;&#x7406;&#x6570;&#x7684;&#x5927;&#x591A;&#x6570;&#x64CD;&#x4F5C;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>half = rational(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print_rational(half)</span><br><span class="line"><span class="number">1</span> / <span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>third = rational(<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print_rational(mul_rationals(half, third))</span><br><span class="line"><span class="number">1</span> / <span class="number">6</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print_rational(add_rationals(third, third))</span><br><span class="line"><span class="number">6</span> / <span class="number">9</span></span><br></pre></td></tr></table></figure></p>
<h3 id="3&#x62BD;&#x8C61;&#x5C4F;&#x969C;">3.&#x62BD;&#x8C61;&#x5C4F;&#x969C;</h3>
<p>&#x2003;&#x2003;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x6570;&#x636E;&#x62BD;&#x8C61;&#x7684;&#x57FA;&#x672C;&#x601D;&#x60F3;&#x662F;<strong>&#x786E;&#x5B9A;&#x4E00;&#x7EC4;&#x57FA;&#x672C;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x4EE5;&#x6B64;&#x6765;&#x8868;&#x793A;&#x5BF9;&#x67D0;&#x79CD;&#x503C;&#x7684;&#x6240;&#x6709;&#x64CD;&#x4F5C;&#xFF0C;&#x7136;&#x540E;&#x53EA;&#x4F7F;&#x7528;&#x8FD9;&#x4E9B;&#x64CD;&#x4F5C;&#x6765;&#x64CD;&#x4F5C;&#x6570;&#x636E;</strong>&#x3002;&#x901A;&#x8FC7;&#x4EE5;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x9650;&#x5236;&#x64CD;&#x4F5C;&#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x66F4;&#x5BB9;&#x6613;&#x5728;&#x4E0D;&#x6539;&#x53D8;&#x7A0B;&#x5E8F;&#x884C;&#x4E3A;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x6539;&#x53D8;&#x62BD;&#x8C61;&#x6570;&#x636E;&#x7684;&#x8868;&#x793A;&#x3002;&#x5BF9;&#x6709;&#x7406;&#x6570;&#x7684;&#x57FA;&#x672C;&#x64CD;&#x4F5C;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="/2024/05/31/2.2.%E6%95%B0%E6%8D%AE%E6%8A%BD%E8%B1%A1/image.png"></p>
<p>&#x2003;&#x2003;&#x5728;&#x4E0A;&#x9762;&#x7684;&#x6BCF;&#x4E00;&#x5C42;&#x4E2D;&#xFF0C;<strong>&#x6700;&#x540E;&#x4E00;&#x5217;&#x4E2D;&#x7684;&#x51FD;&#x6570;&#x5F3A;&#x5236;&#x6267;&#x884C;&#x62BD;&#x8C61;&#x5C4F;&#x969C;</strong>&#x3002;&#x8FD9;&#x4E9B;&#x51FD;&#x6570;<strong>&#x7531;&#x8F83;&#x9AD8;&#x7EA7;&#x522B;&#x8C03;&#x7528;&#xFF0C;&#x5E76;&#x4F7F;&#x7528;&#x8F83;&#x4F4E;&#x62BD;&#x8C61;&#x7EA7;&#x522B;&#x5B9E;&#x73B0;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x4F8B;&#x5982;&#xFF0C;&#x5B9E;&#x73B0;&#x6709;&#x7406;&#x6570;&#x7684;&#x5E73;&#x65B9;&#x548C;&#x5E94;&#x5982;&#x4E0B;&#x4E66;&#x5199;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">square_rational</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> mul_rational(x, x)</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x62BD;&#x8C61;&#x5C4F;&#x969C;&#x4F7F;&#x7A0B;&#x5E8F;&#x66F4;&#x5BB9;&#x6613;&#x7EF4;&#x62A4;&#x548C;&#x4FEE;&#x6539;&#x3002;<strong>&#x4F9D;&#x8D56;&#x4E8E;&#x7279;&#x5B9A;&#x8868;&#x793A;&#x5F62;&#x5F0F;&#x7684;&#x51FD;&#x6570;&#x8D8A;&#x5C11;&#xFF0C;&#x60F3;&#x8981;&#x66F4;&#x6539;&#x8BE5;&#x8868;&#x793A;&#x5F62;&#x5F0F;&#x65F6;&#x6240;&#x9700;&#x7684;&#x66F4;&#x6539;&#x5C31;&#x8D8A;&#x5C11;</strong>&#x3002;&#x6309;&#x7167;&#x5982;&#x4E0A;&#x65B9;&#x5F0F;&#x5B9A;&#x4E49;&#x7684;&#x5E73;&#x65B9;&#x548C;&#x51FD;&#x6570;&#xFF0C;&#x5728;&#x7EF4;&#x62A4;&#x548C;&#x4FEE;&#x6539;&#x65F6;&#x53EA;&#x9700;&#x8981;&#x8C03;&#x6574;<span class="math inline">\(mul\)</span>&#x51FD;&#x6570;&#x5373;&#x53EF;&#x3002;</p>
<h3 id="4&#x6570;&#x636E;&#x7684;&#x5C5E;&#x6027;">4.&#x6570;&#x636E;&#x7684;&#x5C5E;&#x6027;</h3>
<p>&#x2003;&#x2003;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E00;&#x7EC4;&#x9009;&#x62E9;&#x5668;<span class="math inline">\(selector\)</span>&#x548C;&#x6784;&#x9020;&#x51FD;&#x6570;<span class="math inline">\(constructor\)</span>&#x4EE5;&#x53CA;&#x4E00;&#x4E9B;&#x884C;&#x4E3A;&#x6761;&#x4EF6;<span class="math inline">\(operator\)</span>&#x6765;&#x8868;&#x793A;&#x62BD;&#x8C61;&#x6570;&#x636E;&#x3002;&#x53EA;&#x8981;<strong>&#x6EE1;&#x8DB3;&#x884C;&#x4E3A;&#x6761;&#x4EF6;</strong>(&#x5982;&#x4E0A;&#x9762;&#x7684;&#x9664;&#x6CD5;&#x5C5E;&#x6027;)
&#xFF0C;<strong>&#x9009;&#x62E9;&#x5668;&#x548C;&#x6784;&#x9020;&#x5668;&#x5C31;&#x6784;&#x6210;&#x4E86;&#x4E00;&#x79CD;&#x6570;&#x636E;&#x7684;&#x6709;&#x6548;&#x8868;&#x793A;</strong>&#x3002;&#x62BD;&#x8C61;&#x5C4F;&#x969C;&#x4E4B;&#x4E0B;&#x7684;&#x5B9E;&#x73B0;&#x7EC6;&#x8282;&#x53EF;&#x80FD;&#x4F1A;&#x6539;&#x53D8;&#xFF0C;&#x4F46;<strong>&#x5982;&#x679C;&#x884C;&#x4E3A;&#x6CA1;&#x6709;&#x6539;&#x53D8;&#xFF0C;&#x90A3;&#x4E48;&#x62BD;&#x8C61;&#x5316;&#x4ECD;&#x7136;&#x6709;&#x6548;</strong>&#xFF0C;&#x5E76;&#x4E14;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x62BD;&#x8C61;&#x5316;&#x7F16;&#x5199;&#x7684;&#x4EFB;&#x4F55;&#x7A0B;&#x5E8F;&#x90FD;&#x5C06;&#x4FDD;&#x6301;&#x6B63;&#x786E;&#x3002;</p>
<p>&#x2003;&#x2003;&#x4F8B;&#x5982;&#x4E0A;&#x8FF0;&#x5BF9;&#x6709;&#x7406;&#x6570;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x6211;&#x4EEC;&#x5E76;&#x6CA1;&#x6709;&#x8BF4;&#x660E;&#x4EC0;&#x4E48;&#x662F;<span class="math inline">\(pair\)</span>&#xFF0C;&#x53EA;&#x662F;&#x8BF4;&#x8BE5;&#x6570;&#x636E;&#x63D0;&#x4F9B;&#x4E86;&#x7528;&#x4E24;&#x4E2A;&#x5143;&#x7D20;&#x521B;&#x5EFA;&#x548C;&#x64CD;&#x4F5C;&#x5217;&#x8868;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5B9E;&#x73B0;&#x4E00;&#x5BF9;&#x7684;&#x884C;&#x4E3A;&#x662F;&#x5C06;&#x4E24;&#x4E2A;&#x503C;&#x7C98;&#x5408;&#x5728;&#x4E00;&#x8D77;&#xFF0C;&#x5E76;&#x4E14;&#x80FD;&#x591F;&#x5206;&#x522B;&#x8C03;&#x7528;&#x4E24;&#x503C;&#x4E2D;&#x7684;&#x4EFB;&#x610F;&#x4E00;&#x4E2A;&#x3002;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x5982;&#x4E0B;&#x51FD;&#x6570;&#x5B9E;&#x73B0;&#x8FD9;&#x4E2A;&#x64CD;&#x4F5C;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">pair</span>(<span class="params">x, y</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Return a function that represents a pair.&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">index</span>):</span><br><span class="line">            <span class="keyword">if</span> index == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">return</span> x</span><br><span class="line">            <span class="keyword">elif</span> index == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> y</span><br><span class="line">        <span class="keyword">return</span> get</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">select</span>(<span class="params">p, i</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Return the element at index i of pair p.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> p(i)</span><br><span class="line"></span><br><span class="line">p = pair(<span class="number">20</span>, <span class="number">14</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>select(p, <span class="number">0</span>)</span><br><span class="line"><span class="number">20</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x7531;&#x6B64;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x6211;&#x4EEC;&#x5BF9;&#x6570;&#x636E;&#x7684;&#x62BD;&#x8C61;&#x5316;&#x6709;&#x5F88;&#x591A;&#x79CD;&#x8868;&#x793A;&#x65B9;&#x5F0F;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x591A;&#x79CD;&#x8868;&#x8FBE;&#x65B9;&#x5F0F;&#x4E2D;&#x81EA;&#x7531;&#x5207;&#x6362;&#x3002;</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/2.3.DLLists/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/2.3.DLLists/" class="post-title-link" itemprop="url">2.3.&#x53CC;&#x94FE;&#x8868;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 16:41:15" itemprop="dateModified" datetime="2024-06-02T16:41:15+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/2-List/" itemprop="url" rel="index"><span itemprop="name">2.List</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>477</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="23&#x53CC;&#x94FE;&#x8868;"><span class="math inline">\(2.3\)</span>&#x53CC;&#x94FE;&#x8868;</h1>
<h3 id="1&#x5BF9;addlast&#x7684;&#x4F18;&#x5316;">1.&#x5BF9;<code>addLast</code>&#x7684;&#x4F18;&#x5316;</h3>
<p>&#x2003;&#x2003;&#x8BA9;&#x6211;&#x4EEC;&#x56DE;&#x987E;&#x4E00;&#x4E0B;<span class="math inline">\(SLList\)</span>&#x7684;<code>addList</code>&#x65B9;&#x6CD5;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addLast</span><span class="params">(<span class="type">int</span> x)</span> {</span><br><span class="line">    size += <span class="number">1</span>;</span><br><span class="line">    <span class="type">IntNode</span> <span class="variable">p</span> <span class="operator">=</span> sentinel;</span><br><span class="line">    <span class="keyword">while</span> (p.next != <span class="literal">null</span>) {</span><br><span class="line">        p = p.next;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    p.next = <span class="keyword">new</span> <span class="title class_">IntNode</span>(x, <span class="literal">null</span>);</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x7684;&#x95EE;&#x9898;&#x5728;&#x4E8E;&#x901F;&#x5EA6;&#x592A;&#x6162;&#x3002;&#x5BF9;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x50CF;&#x5904;&#x7406;<span class="math inline">\(size\)</span>&#x4E00;&#x6837;&#xFF0C;&#x5728;&#x94FE;&#x8868;&#x4E2D;&#x591A;&#x5B58;&#x50A8;&#x4E00;&#x4E2A;&#x5173;&#x952E;&#x4FE1;&#x606F;<span class="math inline">\(last\)</span>&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SLList</span> {</span><br><span class="line">    <span class="keyword">private</span> IntNode sentinel;</span><br><span class="line">    <span class="keyword">private</span> IntNode last;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addLast</span><span class="params">(<span class="type">int</span> x)</span> {</span><br><span class="line">        last.next = <span class="keyword">new</span> <span class="title class_">IntNode</span>(x, <span class="literal">null</span>);</span><br><span class="line">        last = last.next;</span><br><span class="line">        size += <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x4F46;&#x8FD9;&#x6837;&#x4F1A;&#x8BA9;<code>deleteLast</code>&#x7684;&#x64CD;&#x4F5C;&#x53D8;&#x5F97;&#x56F0;&#x96BE;&#xFF0C;&#x56E0;&#x4E3A;&#x8981;&#x5220;&#x9664;<span class="math inline">\(last\)</span>&#xFF0C;&#x5FC5;&#x987B;&#x77E5;&#x9053;<span class="math inline">\(last\)</span>&#x524D;&#x9762;&#x7684;&#x5143;&#x7D20;&#x3002;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x518D;&#x7F13;&#x5B58;<span class="math inline">\(secondlast\)</span>&#xFF0C;&#x5C31;&#x76F8;&#x5E94;&#x5730;&#x9700;&#x8981;&#x7F13;&#x5B58;<span class="math inline">\(thirdlast\)</span>...&#x8FD9;&#x8BF4;&#x660E;&#x7F13;&#x5B58;&#x5E76;&#x4E0D;&#x80FD;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#xFF0C;&#x8FD9;&#x5F15;&#x51FA;&#x4E86;&#x6211;&#x4EEC;&#x4E0B;&#x9762;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF1A;</p>
<h3 id="2&#x6307;&#x5411;&#x524D;&#x9762;&#x5143;&#x7D20;&#x7684;&#x6307;&#x9488;">2.&#x6307;&#x5411;&#x524D;&#x9762;&#x5143;&#x7D20;&#x7684;&#x6307;&#x9488;</h3>
<p>&#x2003;&#x2003;&#x4E0A;&#x9762;&#x95EE;&#x9898;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x5C31;&#x662F;&#x7ED9;<span class="math inline">\(IntNode\)</span>&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x6307;&#x5411;&#x524D;&#x9762;&#x5143;&#x7D20;&#x7684;&#x6307;&#x9488;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IntNode</span> {</span><br><span class="line">    <span class="keyword">public</span> IntNode prev;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> item;</span><br><span class="line">    <span class="keyword">public</span> IntNode next;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x901A;&#x8FC7;&#x8FD9;&#x79CD;&#x64CD;&#x4F5C;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x94FE;&#x8868;&#x5C31;&#x4E0E;&#x524D;&#x540E;&#x4E24;&#x4E2A;&#x8282;&#x70B9;&#x90FD;&#x4EA7;&#x751F;&#x4E86;&#x94FE;&#x63A5;&#x3002;&#x8FD9;&#x79CD;&#x94FE;&#x8868;&#x88AB;&#x79F0;&#x4E3A;&#x53CC;&#x94FE;&#x8868;(<span class="math inline">\(double\;linked\;list\)</span>)&#x3002;&#x4E0B;&#x9762;&#x7684;&#x56FE;&#x793A;&#x663E;&#x793A;&#x4E86;&#x53CC;&#x94FE;&#x8868;&#x7684;&#x5177;&#x4F53;&#x6784;&#x5EFA;&#xFF1A;</p>
<p><img src="/2024/05/31/2.3.DLLists/image-11.png"></p>
<h3 id="3&#x54E8;&#x5175;&#x8282;&#x70B9;&#x7684;&#x6539;&#x8FDB;">3.&#x54E8;&#x5175;&#x8282;&#x70B9;&#x7684;&#x6539;&#x8FDB;</h3>
<p>&#x2003;&#x2003;&#x5411;&#x540E;&#x7684;&#x6307;&#x9488;&#x6709;&#x65F6;&#x4F1A;&#x6307;&#x5411;&#x54E8;&#x5175;&#x8282;&#x70B9;&#xFF0C;&#x6709;&#x65F6;&#x4F1A;&#x6307;&#x5411;&#x771F;&#x5B9E;&#x8282;&#x70B9;&#xFF0C;&#x5728;&#x7279;&#x6B8A;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD9;&#x4F1A;&#x5BFC;&#x81F4;&#x539F;&#x5148;&#x4EE3;&#x7801;&#x7684;&#x9519;&#x8BEF;&#x3002;&#x5BF9;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x6709;&#x4E24;&#x79CD;&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#xFF1A;</p>
<ol type="1">
<li>&#x5728;&#x524D;&#x540E;&#x5404;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x54E8;&#x5175;&#x8282;&#x70B9;&#xFF1A;</li>
</ol>
<p><img src="/2024/05/31/2.3.DLLists/image-12.png"></p>
<ol start="2" type="1">
<li>&#x5C06;&#x94FE;&#x8868;&#x53D8;&#x4E3A;&#x5FAA;&#x73AF;&#x94FE;&#x8868;&#xFF1A;</li>
</ol>
<p><img src="/2024/05/31/2.3.DLLists/image-13.png"></p>
<h3 id="4&#x901A;&#x7528;&#x578B;&#x94FE;&#x8868;">4.&#x901A;&#x7528;&#x578B;&#x94FE;&#x8868;</h3>
<p>&#x2003;&#x2003;&#x6709;&#x65F6;&#xFF0C;&#x94FE;&#x8868;&#x4E2D;&#x7684;&#x5143;&#x7D20;&#x4E0D;&#x6B62;&#x662F;<span class="math inline">\(int\)</span>&#x578B;&#xFF0C;&#x8FD8;&#x53EF;&#x80FD;&#x662F;&#x5176;&#x4ED6;&#x7C7B;&#x578B;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;&#x4EE5;&#x4E0B;&#x8BED;&#x53E5;&#x58F0;&#x660E;&#x80FD;&#x8868;&#x793A;&#x4EFB;&#x4F55;&#x5F15;&#x7528;&#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*create a class able to contain any type*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DLList</span>&lt;T&gt; () {</span><br><span class="line">    <span class="comment">//create an item able to carry any type</span></span><br><span class="line">    <span class="keyword">public</span> T item;</span><br><span class="line">    <span class="comment">//create an array able to carry any type</span></span><br><span class="line">    <span class="keyword">public</span> T[] arr = (T[])<span class="keyword">new</span> <span class="title class_">Object</span>[capacity]; </span><br><span class="line">    <span class="comment">//print this type of item</span></span><br><span class="line">    System.out.println(item);</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/2.3.%E5%BA%8F%E5%88%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/2.3.%E5%BA%8F%E5%88%97/" class="post-title-link" itemprop="url">2.3.&#x5E8F;&#x5217;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 15:21:58" itemprop="dateModified" datetime="2024-06-02T15:21:58+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SICP-in-python/" itemprop="url" rel="index"><span itemprop="name">SICP in python</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SICP-in-python/Chapter-2-Building-Abstraction-with-Data/" itemprop="url" rel="index"><span itemprop="name">Chapter 2.Building Abstraction with Data</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>3.4k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>12 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="23&#x5E8F;&#x5217;"><span class="math inline">\(2.3.\)</span>&#x5E8F;&#x5217;</h1>
<h3 id="1&#x5E8F;&#x5217;&#x7684;&#x6982;&#x5FF5;">1.&#x5E8F;&#x5217;&#x7684;&#x6982;&#x5FF5;</h3>
<p>&#x2003;&#x2003;&#x5E8F;&#x5217;&#x662F;&#x4E00;&#x7CFB;&#x5217;<strong>&#x6709;&#x5E8F;</strong>&#x7684;&#x503C;&#x7684;<strong>&#x96C6;&#x5408;</strong>&#x3002;&#x5E8F;&#x5217;&#x6709;&#x5F88;&#x591A;&#x79CD;&#x4E0D;&#x540C;&#x7684;&#x8868;&#x793A;&#x5F62;&#x5F0F;&#xFF0C;&#x4F46;&#x5B83;&#x4EEC;&#x90FD;&#x6709;&#x4EE5;&#x4E0B;&#x5171;&#x540C;&#x7684;&#x6027;&#x8D28;&#xFF1A;</p>
<ul>
<li><strong>&#x957F;&#x5EA6;</strong>&#xFF1A;&#x5E8F;&#x5217;&#x90FD;&#x6709;&#x6709;&#x9650;&#x7684;&#x957F;&#x5EA6;</li>
<li><strong>&#x5143;&#x7D20;&#x9009;&#x62E9;</strong>&#x3002;&#x5E8F;&#x5217;&#x7684;&#x4EFB;&#x610F;&#x5143;&#x7D20;<strong>&#x6709;&#x4E00;&#x4E2A;&#x5C0F;&#x4E8E;&#x5176;&#x957F;&#x5EA6;&#x7684;&#x7D22;&#x5F15;&#x5143;&#x7D20;</strong>&#xFF0C;&#x5BF9;&#x4E8E;&#x7B2C;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x4ECE;<span class="math inline">\(0\)</span>&#x5F00;&#x59CB;&#x3002;</li>
</ul>
<h2 id="&#x4E8C;-&#x5E8F;&#x5217;&#x57FA;&#x7840;">&#x4E8C;&#x3001;&#x5E8F;&#x5217;&#x57FA;&#x7840;</h2>
<h3 id="1lists&#x7684;&#x6982;&#x5FF5;&#x53CA;&#x64CD;&#x4F5C;">1.<span class="math inline">\(Lists\)</span>&#x7684;&#x6982;&#x5FF5;&#x53CA;&#x64CD;&#x4F5C;</h3>
<p>&#x2003;&#x2003;<span class="math inline">\(list\)</span>&#x662F;&#x4E00;&#x4E2A;<strong>&#x53EF;&#x4EE5;&#x5177;&#x6709;&#x4EFB;&#x610F;&#x957F;&#x5EA6;</strong>&#x7684;&#x5E8F;&#x5217;&#x3002;<span class="math inline">\(list\)</span>&#x5177;&#x6709;&#x5927;&#x91CF;&#x7684;&#x5185;&#x7F6E;&#x884C;&#x4E3A;&#xFF0C;&#x4EE5;&#x53CA;&#x8868;&#x793A;&#x8FD9;&#x4E9B;&#x884C;&#x4E3A;&#x7684;&#x7279;&#x5B9A;&#x8BED;&#x6CD5;&#x3002;&#x5982;&#x4E0B;&#x662F;&#x51E0;&#x4E2A;<span class="math inline">\(list\)</span>&#x7684;&#x4F8B;&#x5B50;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">digits=[<span class="number">1</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">8</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(digits)</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>digits[<span class="number">3</span>]</span><br><span class="line"><span class="number">8</span></span><br></pre></td></tr></table></figure> &#x2003;&#x2003;&#x521D;&#x59CB;&#x5316;<span class="math inline">\(list\)</span>&#x3001;&#x6784;&#x9020;&#x4E00;&#x4E2A;&#x7A7A;<span class="math inline">\(list\)</span>&#x7684;&#x6B65;&#x9AA4;&#x5982;&#x4E0B;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">result = [[] <span class="keyword">for</span> i <span class="keyword">in</span> player_indices]<span class="comment">#&#x521D;&#x59CB;&#x5316;&#x4E3A;&#x7A7A;&#x5217;&#x8868;</span></span><br><span class="line">result = [[<span class="number">0</span> <span class="keyword">for</span> m <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(n)-<span class="number">1</span>)] <span class="keyword">for</span> n <span class="keyword">in</span> times_per_player]<span class="comment">#&#x521D;&#x59CB;&#x5316;&#x4E3A;0</span></span><br></pre></td></tr></table></figure>
&#x2003;&#x2003;&#x5BF9;&#x4E8E;<span class="math inline">\(list\)</span>&#xFF0C;&#x52A0;&#x6CD5;&#x548C;&#x4E58;&#x6CD5;&#x4E0E;&#x6570;&#x5B66;&#x8FD0;&#x7B97;&#x4E2D;&#x4E0D;&#x540C;&#xFF0C;&#x800C;&#x662F;<strong>&#x7EC4;&#x5408;&#x548C;&#x590D;&#x5236;&#x5E8F;&#x5217;&#x672C;&#x8EAB;</strong>&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x8FD0;&#x7B97;&#x7B26;&#x6A21;&#x5757;(&#x548C;<code>+</code>&#x8FD0;&#x7B97;&#x7B26;)&#x4E2D;&#x7684;<code>add</code>&#x51FD;&#x6570;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x5217;&#x8868;&#xFF0C;&#x8BE5;&#x5217;&#x8868;&#x662F;&#x6240;&#x6DFB;&#x52A0;&#x53C2;&#x6570;&#x7684;&#x4E32;&#x8054;&#x3002;&#x8FD0;&#x7B97;&#x7B26;&#x4E2D;&#x7684;<code>mul</code>&#x51FD;&#x6570;(&#x4EE5;&#x53CA;<code>*</code>&#x8FD0;&#x7B97;&#x7B26;)&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x4E00;&#x4E2A;&#x5217;&#x8868;&#x548C;&#x4E00;&#x4E2A;&#x6574;&#x6570;<span class="math inline">\(k\)</span>&#xFF0C;&#x4EE5;&#x8FD4;&#x56DE;&#x7531;&#x539F;&#x59CB;&#x5217;&#x8868;&#x7684;<span class="math inline">\(k\)</span>&#x91CD;&#x590D;&#x7EC4;&#x6210;&#x7684;&#x5217;&#x8868;&#x3002; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>[<span class="number">2</span>,<span class="number">7</span>] + digits * <span class="number">2</span></span><br><span class="line">[<span class="number">2</span>,<span class="number">7</span>,<span class="number">1</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">1</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">8</span>]</span><br></pre></td></tr></table></figure>
&#x2003;&#x2003;&#x540C;&#x65F6;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;<span class="math inline">\(list\)</span>&#x4E2D;&#x5D4C;&#x5957;<span class="math inline">\(list\)</span>&#xFF0C;&#x5D4C;&#x5957;&#x4E0E;&#x8BBF;&#x95EE;&#x7684;&#x65B9;&#x5F0F;&#x5982;&#x4E0B;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pairs=[[<span class="number">10</span>,<span class="number">20</span>],[<span class="number">30</span>,<span class="number">40</span>]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pairs[<span class="number">1</span>]</span><br><span class="line">[<span class="number">30</span>,<span class="number">40</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pairs[<span class="number">1</span>][<span class="number">0</span>]</span><br><span class="line"><span class="number">30</span></span><br></pre></td></tr></table></figure></p>
<h3 id="2&#x5E8F;&#x5217;&#x8FED;&#x4EE3;">2.&#x5E8F;&#x5217;&#x8FED;&#x4EE3;</h3>
<p>&#x2003;&#x2003;&#x5728;&#x8BB8;&#x591A;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;<strong>&#x5BF9;&#x5E8F;&#x5217;&#x7684;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x8FED;&#x4EE3;&#xFF0C;&#x5E76;&#x4F9D;&#x6B21;&#x4E3A;&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#x6267;&#x884C;&#x4E00;&#x4E9B;&#x8BA1;&#x7B97;</strong>&#x3002;</p>
<h4 id="afor&#x8BED;&#x53E5;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span><span class="math inline">\(for\)</span>&#x8BED;&#x53E5;</h4>
<p>&#x2003;&#x2003;<span class="math inline">\(for\)</span>&#x8BED;&#x53E5;&#x7684;&#x58F0;&#x660E;&#x5982;&#x4E0B;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> &lt;name&gt; <span class="keyword">in</span> &lt;expression&gt;:</span><br><span class="line">    &lt;suite&gt;</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;<span class="math inline">\(for\)</span>&#x8BED;&#x53E5;&#x7684;&#x6267;&#x884C;&#x8FC7;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;</p>
<ol type="1">
<li><p>&#x8BA1;&#x7B97;<span class="math inline">\(expression\)</span>&#xFF0C;<span class="math inline">\(expression\)</span>&#x5FC5;&#x987B;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x53EF;&#x8FED;&#x4EE3;&#x7684;&#x503C;&#x3002;</p></li>
<li><p>&#x5BF9;&#x4E8E;&#x53EF;&#x8FED;&#x4EE3;&#x503C;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x503C;&#x6267;&#x884C;&#xFF1A;</p>
<ol type="1">
<li>&#x5C06;<code>&lt;name&gt;</code>&#x7ED1;&#x5B9A;&#x5230;&#x5F53;&#x524D;&#x6846;&#x67B6;&#x4E2D;&#x7684;&#x503C;&#x3002;</li>
<li>&#x6267;&#x884C;<code>&lt;suite&gt;</code>&#x3002;</li>
</ol></li>
</ol>
<h4 id="brange&#x8BED;&#x53E5;">&#x2003;&#x2003;<span class="math inline">\(b.\)</span><span class="math inline">\(range\)</span>&#x8BED;&#x53E5;</h4>
<p>&#x2003;&#x2003;<span class="math inline">\(range\)</span>&#x7684;&#x58F0;&#x660E;&#x5982;&#x4E0B;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">range</span>(<span class="number">1</span>,<span class="number">10</span>) <span class="comment"># Includes 1, but not 10</span></span><br></pre></td></tr></table></figure> &#x2003;&#x2003;&#x5728;<span class="math inline">\(list\)</span>&#x4E2D;&#x8C03;&#x7528;<span class="math inline">\(range\)</span>&#x53EF;&#x8FD4;&#x56DE;<span class="math inline">\(range\)</span>&#x8303;&#x56F4;&#x5185;&#x7684;<span class="math inline">\(list\)</span>&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">5</span>,<span class="number">8</span>))</span><br><span class="line">[<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>]</span><br></pre></td></tr></table></figure> &#x2003;&#x2003;&#x5982;&#x679C;<span class="math inline">\(range\)</span>&#x51FD;&#x6570;&#x53EA;&#x4F20;&#x4E86;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x8FD4;&#x56DE;&#x4ECE;<span class="math inline">\(0\)</span>&#x5230;<span class="math inline">\(i-1\)</span>&#x95F4;&#x7684;&#x5E8F;&#x5217;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">4</span>))</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure> &#x2003;&#x2003;<span class="math inline">\(range\)</span>&#x7ECF;&#x5E38;&#x4E0E;<span class="math inline">\(for\)</span>&#x7ED3;&#x5408;&#xFF0C;&#x4EE5;&#x8FBE;&#x5230;&#x8FED;&#x4EE3;<span class="math inline">\(list\)</span>&#x7684;&#x4E00;&#x90E8;&#x5206;&#x7684;&#x76EE;&#x7684;&#x3002;&#x8FD9;&#x91CC;&#x6709;&#x4E00;&#x79CD;&#x7279;&#x6B8A;&#x60C5;&#x51B5;&#xFF1A;&#x5F53;<code>&lt;name&gt;=&apos;_&apos;</code>&#x65F6;&#xFF0C;&#x6574;&#x4E2A;&#x5E8F;&#x5217;&#x4F1A;&#x88AB;&#x91CD;&#x590D;<span class="math inline">\(i\)</span>&#x6B21;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&apos;Go Bears!&apos;</span>)</span><br><span class="line"></span><br><span class="line">Go Bears!</span><br><span class="line">Go Bears!</span><br><span class="line">Go Bears!</span><br></pre></td></tr></table></figure></p>
<h4 id="c&#x5E8F;&#x5217;&#x89E3;&#x5305;">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>&#x5E8F;&#x5217;&#x89E3;&#x5305;</h4>
<p>&#x2003;&#x2003;&#x5F53;&#x67D0;&#x4E2A;<span class="math inline">\(list\)</span>&#x7684;&#x5185;&#x90E8;&#x4ECD;&#x7136;&#x4E3A;<span class="math inline">\(list\)</span>&#xFF0C;&#x4F46;&#x5185;&#x90E8;&#x7684;<span class="math inline">\(list\)</span>&#x957F;&#x5EA6;&#x56FA;&#x5B9A;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x8C03;&#x7528;<span class="math inline">\(for\)</span>&#x5FAA;&#x73AF;&#x65F6;&#x4F7F;&#x7528;&#x591A;&#x4E2A;<code>&lt;name&gt;</code>&#xFF0C;&#x4EE5;&#x6253;&#x5F00;&#x5185;&#x90E8;&#x7684;<span class="math inline">\(list\)</span>&#xFF0C;&#x8BFB;&#x53D6;&#x5176;&#x4E2D;&#x5143;&#x7D20;&#x3002;&#x4E0B;&#x4E3E;&#x4E00;&#x4F8B;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pairs=[[<span class="number">1</span>,<span class="number">2</span>],[<span class="number">2</span>,<span class="number">2</span>],[<span class="number">2</span>,<span class="number">3</span>],[<span class="number">4</span>,<span class="number">4</span>]]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x,y <span class="keyword">in</span> pairs:</span><br><span class="line">    <span class="keyword">if</span>(x==y):</span><br><span class="line">        same_count+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>same_count</span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x4E00;&#x64CD;&#x4F5C;&#x4E0E;&#x6211;&#x4EEC;&#x5728;&#x5C06;&#x591A;&#x4E2A;&#x540D;&#x79F0;&#x7ED1;&#x5B9A;&#x5230;&#x591A;&#x4E2A;&#x503C;&#x7684;&#x8D4B;&#x503C;&#x8BED;&#x53E5;&#x4E2D;&#x770B;&#x5230;&#x7684;&#x6A21;&#x5F0F;&#x76F8;&#x540C;&#x3002;</p>
<h2 id="&#x4E09;-&#x5BF9;&#x5E8F;&#x5217;&#x7684;&#x57FA;&#x672C;&#x5904;&#x7406;">&#x4E09;&#x3001;&#x5BF9;&#x5E8F;&#x5217;&#x7684;&#x57FA;&#x672C;&#x5904;&#x7406;</h2>
<h3 id="1&#x5217;&#x8868;&#x89E3;&#x6790;listcomprehension">1.&#x5217;&#x8868;&#x89E3;&#x6790;<span class="math inline">\(List\;Comprehension\)</span></h3>
<p>&#x2003;&#x2003;&#x6709;&#x65F6;&#x6211;&#x4EEC;&#x8981;&#x5BF9;&#x5E8F;&#x5217;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x5143;&#x7D20;&#x6267;&#x884C;&#x4E00;&#x4E2A;&#x7EDF;&#x4E00;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x5E76;&#x8F93;&#x51FA;&#x5904;&#x7406;&#x540E;&#x7684;&#x5E8F;&#x5217;&#x3002;&#x8FD9;&#x65F6;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;<strong>&#x5217;&#x8868;&#x89E3;&#x6790;</strong>&#x7684;&#x65B9;&#x6CD5;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&#x6539;&#x53D8;&#x5217;&#x8868;&#x5143;&#x7D20;&#x7684;&#x503C;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>odds=[<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">9</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[x+<span class="number">1</span> <span class="keyword">for</span> x <span class="keyword">in</span> odds]</span><br><span class="line">[<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">10</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#&#x5C06;&#x5217;&#x8868;&#x5143;&#x7D20;&#x5F52;&#x5230;&#x5176;&#x4ED6;&#x7ED3;&#x6784;&#x91CC;&#x9762;</span></span><br><span class="line">&gt;&gt;&gt;s=[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">&gt;&gt;&gt;t=[<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">[[s[i]+t[i]]<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s))]</span><br><span class="line">&gt;&gt;&gt;[[<span class="number">1</span>, <span class="number">4</span>], [<span class="number">2</span>, <span class="number">5</span>], [<span class="number">3</span>, <span class="number">6</span>]]</span><br></pre></td></tr></table></figure> &#x2003;&#x2003;&#x8FD9;&#x91CC;&#x7684;<span class="math inline">\(for\)</span>&#x5E76;&#x4E0D;&#x662F;<span class="math inline">\(for\)</span>&#x8BED;&#x53E5;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x800C;&#x662F;&#x5217;&#x8868;&#x89E3;&#x6790;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x3002;</p>
<p>&#x2003;&#x2003;&#x540C;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;<strong>&#x53EA;&#x89E3;&#x6790;&#x5E8F;&#x5217;&#x7B26;&#x5408;&#x8981;&#x6C42;&#x7684;&#x90E8;&#x5206;</strong>&#xFF0C;&#x5373;&#x539F;&#x5E8F;&#x5217;&#x7684;<strong>&#x5B50;&#x96C6;</strong>&#xFF0C;&#x4E0B;&#x4E3E;&#x4E00;&#x4F8B;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>[x <span class="keyword">for</span> x <span class="keyword">in</span> odds <span class="keyword">if</span> <span class="number">25</span> % x == <span class="number">0</span>]</span><br><span class="line">[<span class="number">1</span>,<span class="number">5</span>]</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5217;&#x8868;&#x89E3;&#x6790;&#x7684;&#x4E00;&#x822C;&#x5F62;&#x5F0F;&#x4E3A;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&lt;<span class="built_in">map</span> expression&gt; <span class="keyword">for</span> &lt;name&gt; <span class="keyword">in</span> &lt;sequence expression&gt; <span class="keyword">if</span> &lt;<span class="built_in">filter</span> expression&gt;]</span><br></pre></td></tr></table></figure>
&#x2003;&#x2003;&#x5F53;&#x8981;&#x8868;&#x8FBE;&#x4E0D;&#x540C;&#x5206;&#x652F;&#x65F6;&#xFF0C;&#x53EF;&#x5982;&#x4E0B;&#x4E66;&#x5199;&#x5217;&#x8868;&#x89E3;&#x6790;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&lt;<span class="built_in">map</span> expression&gt; <span class="keyword">if</span> &lt;expression&gt; <span class="keyword">else</span> &lt;<span class="built_in">map</span> expression&gt; <span class="keyword">for</span> &lt;name&gt; <span class="keyword">in</span> &lt;seq&gt;]</span><br></pre></td></tr></table></figure></p>
<h3 id="2&#x6570;&#x636E;&#x5408;&#x5E76;">2.&#x6570;&#x636E;&#x5408;&#x5E76;</h3>
<p>&#x2003;&#x2003;&#x6570;&#x636E;&#x5408;&#x5E76;&#xFF0C;&#x987E;&#x540D;&#x601D;&#x4E49;&#xFF0C;&#x5C31;&#x662F;<strong>&#x5C06;&#x5E8F;&#x5217;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x6570;&#x636E;&#x6700;&#x7EC8;&#x5408;&#x5E76;&#x6210;&#x4E00;&#x4E2A;&#x6570;&#x636E;</strong>&#x3002;&#x5E38;&#x89C1;&#x7684;<span class="math inline">\(min\)</span>&#x3001;<span class="math inline">\(max\)</span>&#x3001;<span class="math inline">\(sum\)</span>&#x51FD;&#x6570;&#x90FD;&#x5C5E;&#x4E8E;&#x6570;&#x636E;&#x5408;&#x5E76;&#x3002;</p>
<h3 id="3&#x5229;&#x7528;&#x9AD8;&#x9636;&#x51FD;&#x6570;&#x62BD;&#x8C61;&#x5E8F;&#x5217;&#x57FA;&#x672C;&#x64CD;&#x4F5C;">3.&#x5229;&#x7528;&#x9AD8;&#x9636;&#x51FD;&#x6570;&#x62BD;&#x8C61;&#x5E8F;&#x5217;&#x57FA;&#x672C;&#x64CD;&#x4F5C;</h3>
<p>&#x2003;&#x2003;&#x4E0A;&#x8FF0;&#x5E8F;&#x5217;&#x64CD;&#x4F5C;&#x53EF;&#x901A;&#x8FC7;&#x9AD8;&#x9636;&#x51FD;&#x6570;&#x3001;&#x4EE5;&#x51FD;&#x6570;&#x4E3A;&#x53C2;&#x6570;&#x7684;&#x624B;&#x6BB5;&#x6765;&#x62BD;&#x8C61;&#x51FA;&#x66F4;&#x666E;&#x9002;&#x7684;&#x6A21;&#x5F0F;&#xFF1A;</p>
<ul>
<li><p>&#x5BF9;&#x5E8F;&#x5217;&#x5168;&#x4F53;&#x5143;&#x7D20;&#x7684;&#x6620;&#x5C04;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">apply_to_all</span>(<span class="params">map_f,s</span>):</span><br><span class="line">    <span class="keyword">return</span> [map_f(i) <span class="keyword">for</span> i <span class="keyword">in</span> s]</span><br></pre></td></tr></table></figure></p></li>
<li><p>&#x7B5B;&#x9009;&#x5143;&#x7D20;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">keep_if</span>(<span class="params">filter_f,s</span>):</span><br><span class="line">    <span class="keyword">return</span> [i <span class="keyword">for</span> i <span class="keyword">in</span> s <span class="keyword">if</span> filter_f(i)]</span><br></pre></td></tr></table></figure></p></li>
<li><p>&#x6570;&#x636E;&#x5408;&#x5E76;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">reduce</span>(<span class="params">reduce_f,s,init</span>):</span><br><span class="line">    reduced=init</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">        reduced=reduce_f(reduced,i)</span><br><span class="line">    <span class="keyword">return</span> reduced</span><br></pre></td></tr></table></figure></p></li>
</ul>
<h3 id="4&#x5E8F;&#x5217;&#x57FA;&#x672C;&#x5904;&#x7406;&#x7684;&#x5E94;&#x7528;">4.&#x5E8F;&#x5217;&#x57FA;&#x672C;&#x5904;&#x7406;&#x7684;&#x5E94;&#x7528;</h3>
<p>&#x2003;&#x2003;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x4E0A;&#x8FF0;&#x5E8F;&#x5217;&#x57FA;&#x672C;&#x5904;&#x7406;&#x624B;&#x6BB5;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x5E8F;&#x5217;&#x5904;&#x7406;&#x5F88;&#x591A;&#x95EE;&#x9898;&#x3002;</p>
<p>&#x2003;&#x2003;<span class="math inline">\(e.g.\)</span>&#x6C42;&#x51FA;<span class="math inline">\(1\sim 1000\)</span>&#x5185;&#x7684;&#x6240;&#x6709;&#x5B8C;&#x5168;&#x6570;&#x3002;</p>
<p>&#x2003;&#x2003;<span class="math inline">\(solve\)</span>&#xFF1A;&#x5148;&#x5229;&#x7528;&#x5217;&#x8868;&#x89E3;&#x6790;&#x5199;&#x51FA;&#x6C42;&#x67D0;&#x4E2A;&#x6570;&#x56E0;&#x6570;&#x7684;&#x51FD;&#x6570;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">div</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">return</span> [<span class="number">1</span>]+[i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,n) <span class="keyword">if</span> n%i==<span class="number">0</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>divisors(<span class="number">12</span>)</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>]</span><br></pre></td></tr></table></figure> &#x2003;&#x2003;&#x6C42;&#x51FA;&#x6240;&#x6709;&#x56E0;&#x6570;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x6240;&#x6709;&#x56E0;&#x6570;&#x5408;&#x5E76;&#x4E3A;<span class="math inline">\(sum\)</span>&#xFF0C;&#x7EE7;&#x7EED;&#x5229;&#x7528;&#x5217;&#x8868;&#x89E3;&#x6790;&#x7B5B;&#x9009;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">perfect</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">return</span> [<span class="number">1</span>]+[i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">1000</span>) <span class="keyword">if</span> <span class="built_in">sum</span>(div(i))==i]</span><br><span class="line">&gt;&gt;&gt;[<span class="number">6</span>, <span class="number">28</span>, <span class="number">496</span>]</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x540C;&#x65F6;&#x6211;&#x4EEC;&#x7684;<span class="math inline">\(div\)</span>&#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x590D;&#x7528;&#x4EE5;&#x89E3;&#x51B3;&#x4EE5;&#x4E0B;&#x95EE;&#x9898;&#xFF1A;</p>
<p>&#x2003;&#x2003;<span class="math inline">\(e.g.\)</span>&#x7ED9;&#x5B9A;&#x77E9;&#x5F62;&#x9762;&#x79EF;&#xFF0C;&#x6C42;&#x77E9;&#x5F62;&#x7684;&#x6700;&#x5C0F;&#x5468;&#x957F;&#x3002;</p>
<p>&#x2003;&#x2003;<span class="math inline">\(solve\)</span>&#xFF1A;&#x77E9;&#x5F62;&#x7684;&#x8FB9;&#x957F;&#x53EA;&#x53EF;&#x80FD;&#x662F;<span class="math inline">\(div(area)\)</span>&#x4E2D;&#x7684;&#x67D0;&#x4E2A;&#x6570;&#xFF0C;&#x4E8E;&#x662F;&#x53EF;&#x5199;&#x51FA;&#x5982;&#x4E0B;&#x7A0B;&#x5E8F;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">width</span>(<span class="params">area,hei</span>):</span><br><span class="line">    <span class="keyword">assert</span> area%hei==<span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> area//hei</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">perimeter</span>(<span class="params">hei,width</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>*hei+<span class="number">2</span>*width</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">min_per</span>(<span class="params">area</span>):</span><br><span class="line">    hei=div(area):</span><br><span class="line">    per=[perimeter(h,width(area,h)) <span class="keyword">for</span> h <span class="keyword">in</span> hei]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">min</span>(per)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>area=<span class="number">80</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>width(area,<span class="number">5</span>)</span><br><span class="line"><span class="number">16</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>perimeter(<span class="number">10</span>, <span class="number">8</span>)</span><br><span class="line"><span class="number">36</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>min_per(area)</span><br><span class="line"><span class="number">36</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[minimum_perimeter(n) <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10</span>)]</span><br><span class="line">[<span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">16</span>, <span class="number">12</span>, <span class="number">12</span>]</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x4E9B;&#x64CD;&#x4F5C;&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x5B9A;&#x9700;&#x8981;&#x5E8F;&#x5217;&#x6765;&#x5B9E;&#x73B0;&#xFF0C;&#x4F46;&#x662F;&#x5E8F;&#x5217;&#x4E0A;&#x8FF0;&#x57FA;&#x672C;&#x64CD;&#x4F5C;&#x7684;&#x5B58;&#x5728;&#x6781;&#x5927;&#x5730;&#x964D;&#x4F4E;&#x4E86;&#x5B9E;&#x73B0;&#x7684;&#x96BE;&#x5EA6;&#x3002;<strong>&#x5C06;&#x95EE;&#x9898;&#x5E8F;&#x5217;&#x5316;</strong>&#x4E0D;&#x5931;&#x4E3A;&#x4E00;&#x79CD;&#x89E3;&#x9898;&#x7B56;&#x7565;&#x3002;</p>
<h2 id="&#x56DB;-&#x5E8F;&#x5217;&#x62BD;&#x8C61;">&#x56DB;&#x3001;&#x5E8F;&#x5217;&#x62BD;&#x8C61;</h2>
<p>&#x2003;&#x2003;&#x5E8F;&#x5217;&#x62BD;&#x8C61;&#x5206;&#x4E3A;&#x4EE5;&#x4E0B;&#x90E8;&#x5206;(&#x524D;&#x4E24;&#x70B9;&#x524D;&#x6587;&#x5DF2;&#x63D0;&#x53CA;)&#xFF1A;</p>
<h3 id="1&#x5E8F;&#x5217;&#x957F;&#x5EA6;">1.&#x5E8F;&#x5217;&#x957F;&#x5EA6;</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>digits = [<span class="number">1</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">8</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(digits)</span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure>
<h3 id="2&#x5E8F;&#x5217;&#x9009;&#x62E9;">2.&#x5E8F;&#x5217;&#x9009;&#x62E9;</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>digits[<span class="number">3</span>]</span><br><span class="line"><span class="number">8</span></span><br></pre></td></tr></table></figure>
<h3 id="3&#x5224;&#x65AD;&#x662F;&#x5426;&#x4E3A;&#x5E8F;&#x5217;&#x6210;&#x5458;">3.&#x5224;&#x65AD;&#x662F;&#x5426;&#x4E3A;&#x5E8F;&#x5217;&#x6210;&#x5458;</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>digits</span><br><span class="line">[<span class="number">1</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">8</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">2</span> <span class="keyword">in</span> digits</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1828</span> <span class="keyword">not</span> <span class="keyword">in</span> digits</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
<h3 id="4&#x526A;&#x5207;&#x5E8F;&#x5217;&#x7247;&#x6BB5;">4.&#x526A;&#x5207;&#x5E8F;&#x5217;&#x7247;&#x6BB5;</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>digits[<span class="number">0</span>:<span class="number">2</span>]</span><br><span class="line">[<span class="number">1</span>, <span class="number">8</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>digits[<span class="number">1</span>:]</span><br><span class="line">[<span class="number">8</span>, <span class="number">2</span>, <span class="number">8</span>]</span><br></pre></td></tr></table></figure>
<h2 id="&#x4E94;-string">&#x4E94;&#x3001;<span class="math inline">\(string\)</span></h2>
<h2 id="&#x516D;-trees">&#x516D;&#x3001;<span class="math inline">\(Trees\)</span></h2>
<h3 id="1&#x5F15;&#x5165;&#x95ED;&#x5305;&#x6027;&#x8D28;">1.&#x5F15;&#x5165;&#x2014;&#x2014;&#x95ED;&#x5305;&#x6027;&#x8D28;</h3>
<p>&#x2003;&#x2003;&#x5728;<span class="math inline">\(list\)</span>&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<span class="math inline">\(list\)</span>&#x4F5C;&#x4E3A;<span class="math inline">\(list\)</span>&#x7684;&#x5143;&#x7D20;&#xFF0C;&#x8FD9;&#x79CD;&#x6570;&#x636E;&#x7684;&#x7EC4;&#x5408;&#x65B9;&#x5F0F;&#x88AB;&#x79F0;&#x4E3A;<strong>&#x6570;&#x636E;&#x7684;&#x95ED;&#x5305;&#x6027;&#x8D28;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x5728;&#x4EFB;&#x4F55;&#x7EC4;&#x5408;&#x65B9;&#x5F0F;&#x4E2D;&#xFF0C;&#x95ED;&#x5305;&#x6027;&#x8D28;&#x90FD;&#x662F;&#x7EC4;&#x5408;&#x7684;&#x5173;&#x952E;&#xFF0C;&#x56E0;&#x4E3A;<strong>&#x5B83;&#x5141;&#x8BB8;&#x6211;&#x4EEC;&#x521B;&#x9020;&#x4E00;&#x79CD;&#x7EC4;&#x5408;&#x65B9;&#x5F0F;&#x7684;&#x7B49;&#x7EA7;&#x7ED3;&#x6784;</strong>&#x2014;&#x2014;&#x4E00;&#x79CD;&#x7EC4;&#x5408;&#x7531;&#x4E0E;&#x5B83;&#x76F8;&#x540C;&#x7684;&#x5B50;&#x7EC4;&#x5408;&#x6784;&#x6210;&#xFF0C;&#x800C;&#x5B50;&#x7EC4;&#x5408;&#x53C8;&#x7531;&#x66F4;&#x5C0F;&#x7684;&#x5B50;&#x7EC4;&#x5408;&#x6784;&#x6210;...&#x5982;&#x4E0B;&#x5373;&#x4E3A;<span class="math inline">\(list\)</span>&#x7684;&#x7B49;&#x7EA7;&#x7ED3;&#x6784;&#x793A;&#x610F;&#x56FE;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">one_two = [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">    nested = [[<span class="number">1</span>, <span class="number">2</span>], [],</span><br><span class="line">    [[<span class="number">3</span>, <span class="literal">False</span>, <span class="literal">None</span>],</span><br><span class="line">    [<span class="number">4</span>, <span class="keyword">lambda</span>: <span class="number">5</span>]]]</span><br></pre></td></tr></table></figure></p>
<p><img src="/2024/05/31/2.3.%E5%BA%8F%E5%88%97/image-1.png"></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x79CD;&#x5D4C;&#x5957;&#x7ED3;&#x6784;&#x4F1A;&#x5F15;&#x5165;&#x590D;&#x6742;&#x6027;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x80FD;&#x66F4;&#x597D;&#x5730;&#x5904;&#x7406;&#x590D;&#x6742;&#x7684;&#x6570;&#x636E;&#x3002;<span class="math inline">\(Trees\)</span>&#x548C;&#x4E4B;&#x540E;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x90FD;&#x662F;&#x8FD9;&#x6837;&#x7684;&#x5D4C;&#x5957;&#x7ED3;&#x6784;</p>
<h3 id="2&#x6811;&#x7684;&#x6982;&#x5FF5;">2.&#x6811;&#x7684;&#x6982;&#x5FF5;</h3>
<p>&#x2003;&#x2003;&#x6811;&#x662F;&#x7531;&#x6811;&#x6839;&#x4E0E;&#x6811;&#x679D;&#x5E8F;&#x5217;&#x7EC4;&#x6210;&#x7684;&#x3002;&#x6811;&#x7684;&#x6BCF;&#x6839;&#x6811;&#x679D;&#x4E5F;&#x662F;&#x4E00;&#x68F5;&#x6811;&#x3002;&#x6CA1;&#x6709;&#x6811;&#x679D;&#x7684;&#x8282;&#x70B9;&#x88AB;&#x79F0;&#x4E3A;&#x53F6;&#x5B50;&#x7ED3;&#x70B9;&#x3002;&#x6BCF;&#x68F5;&#x6811;&#x7684;&#x6811;&#x6839;&#x88AB;&#x79F0;&#x4F5C;&#x6839;&#x8282;&#x70B9;&#x3002;</p>
<h3 id="3&#x6811;&#x7684;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;">3.&#x6811;&#x7684;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;</h3>
<h4 id="a&#x6811;&#x7684;&#x76F8;&#x5173;&#x6982;&#x5FF5;&#x7684;&#x5B9E;&#x73B0;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&#x6811;&#x7684;&#x76F8;&#x5173;&#x6982;&#x5FF5;&#x7684;&#x5B9E;&#x73B0;</h4>
<p>&#x2003;&#x2003;&#x6811;&#x8FD9;&#x79CD;&#x6570;&#x636E;&#x62BD;&#x8C61;&#x5F62;&#x5F0F;&#x7684;&#x5B9E;&#x73B0;&#x7531;<span class="math inline">\(constructor\)</span><code>tree</code>&#x4E0E;<span class="math inline">\(selector\)</span><code>branches&#xFF0C;root</code>&#x6784;&#x6210;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">tree</span>(<span class="params">root_label,branches=[]</span>):<span class="comment">#&#x5C06;branches&#x5F3A;&#x5236;&#x8F6C;&#x5316;&#x4E3A;list&#x7ED3;&#x6784;</span></span><br><span class="line">    <span class="keyword">for</span> branch <span class="keyword">in</span> branches:</span><br><span class="line">        <span class="keyword">assert</span> is_tree(branch),<span class="string">&apos;branches must be trees&apos;</span></span><br><span class="line">    <span class="keyword">return</span> [root_label]+<span class="built_in">list</span>(branches)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">label</span>(<span class="params">tree</span>):</span><br><span class="line">    <span class="keyword">return</span> tree[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">branches</span>(<span class="params">tree</span>):</span><br><span class="line">    <span class="keyword">return</span> tree[<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_tree</span>(<span class="params">tree</span>):</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">type</span>(tree)!=<span class="built_in">list</span> <span class="keyword">or</span> <span class="built_in">len</span>(tree)&lt;<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> branch <span class="keyword">in</span> branches(tree):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> is_tree(branch):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_leaf</span>(<span class="params">tree</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">not</span> branches(tree)</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x6811;&#x53EF;&#x4EE5;&#x7531;&#x5D4C;&#x5957;&#x8868;&#x8FBE;&#x5F0F;&#x6784;&#x9020;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = tree(<span class="number">3</span>, [tree(<span class="number">1</span>), tree(<span class="number">2</span>, [tree(<span class="number">1</span>), tree(<span class="number">1</span>)])])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t</span><br><span class="line">[<span class="number">3</span>, [<span class="number">1</span>], [<span class="number">2</span>, [<span class="number">1</span>], [<span class="number">1</span>]]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>label(t)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>branches(t)</span><br><span class="line">[[<span class="number">1</span>], [<span class="number">2</span>, [<span class="number">1</span>], [<span class="number">1</span>]]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>label(branches(t)[<span class="number">1</span>])</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>is_leaf(t)</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>is_leaf(branches(t)[<span class="number">0</span>])</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure></p>
<h4 id="b&#x6811;&#x5F62;&#x9012;&#x5F52;&#x7684;&#x4F7F;&#x7528;">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>&#x6811;&#x5F62;&#x9012;&#x5F52;&#x7684;&#x4F7F;&#x7528;</h4>
<p>&#x2003;&#x2003;&#x7531;&#x4E8E;&#x6811;&#x672C;&#x8EAB;&#x7684;&#x5C42;&#x6B21;&#x6027;&#xFF0C;&#x5229;&#x7528;&#x6811;&#x5F62;&#x9012;&#x5F52;&#x4E5F;&#x53EF;&#x5F97;&#x51FA;&#x6811;&#x7684;&#x4E00;&#x4E9B;&#x6027;&#x8D28;&#x3002;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">count_leaves</span>(<span class="params">tree</span>):</span><br><span class="line">    <span class="keyword">if</span> is_leaf(tree):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        branches_count=[count_leaves(b) <span class="keyword">for</span> b <span class="keyword">in</span> branches(tree)]</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(branch_counts)</span><br></pre></td></tr></table></figure> &#x2003;&#x2003;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x6211;&#x4EEC;&#x5BF9;&#x6811;&#x7ED3;&#x6784;&#x7684;&#x5904;&#x7406;&#x662F;&#x5728;<span class="math inline">\(list\)</span>&#x7684;&#x5C42;&#x9762;&#x4E0A;&#x5904;&#x7406;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8BFB;&#x53D6;&#x5177;&#x4F53;&#x7684;&#x7ED3;&#x679C;&#x65F6;&#x624D;&#x5229;&#x7528;&#x6570;&#x636E;&#x5408;&#x5E76;&#x7684;&#x64CD;&#x4F5C;<span class="math inline">\(return\)</span>&#x4E00;&#x4E2A;&#x6574;&#x6570;&#x3002;</p>
<h4 id="c&#x9650;&#x5236;&#x6811;&#x7684;&#x6811;&#x679D;&#x6570;">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>&#x9650;&#x5236;&#x6811;&#x7684;&#x6811;&#x679D;&#x6570;</h4>
<p>&#x2003;&#x2003;&#x4E3A;&#x9650;&#x5236;&#x6811;&#x7684;&#x6811;&#x679D;&#x6570;&#xFF0C;&#x4EE5;&#x6784;&#x5EFA;&#x4E8C;&#x53C9;&#x6811;&#x4E3A;&#x4F8B;&#xFF0C;&#x5F53;&#x6811;&#x679D;&#x957F;&#x5EA6;&#x8D85;&#x8FC7;<span class="math inline">\(2\)</span>&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;<strong>&#x5C06;&#x6811;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x4FDD;&#x6301;&#x4E0D;&#x53D8;&#xFF0C;&#x800C;&#x5C06;&#x5176;&#x4F59;&#x5143;&#x7D20;&#x4F5C;&#x4E3A;&#x53F3;&#x5206;&#x652F;&#x7684;&#x5B50;&#x6811;&#x3002;</strong>&#x5373;&#x53EF;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">right_binarize</span>(<span class="params">tree</span>):</span><br><span class="line">    <span class="keyword">if</span> is_leaf(tree):</span><br><span class="line">        <span class="keyword">return</span> tree</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(tree)&gt;<span class="number">2</span>:</span><br><span class="line">        tree=[tree[<span class="number">0</span>],tree[<span class="number">1</span>:]]</span><br><span class="line">    <span class="keyword">return</span> [right_binarize(b) <span class="keyword">for</span> b <span class="keyword">in</span> tree]</span><br></pre></td></tr></table></figure>
&#x2003;&#x2003;&#x6CE8;&#x610F;&#x8BE5;&#x51FD;&#x6570;&#x7684;&#x76EE;&#x6807;&#x662F;&#x5BF9;&#x6574;&#x68F5;&#x6811;&#x8FDB;&#x884C;&#x53F3;&#x5206;&#x652F;&#x91CD;&#x5EFA;&#xFF0C;&#x56E0;&#x6B64;&#x662F;<code>for b in tree</code>&#x3002;</p>
<h4 id="d&#x6811;&#x7684;&#x5217;&#x8868;&#x5316;&#x5904;&#x7406;">&#x2003;&#x2003;<span class="math inline">\(d.\)</span>&#x6811;&#x7684;&#x5217;&#x8868;&#x5316;&#x5904;&#x7406;</h4>
<p>&#x2003;&#x2003;&#x5F53;&#x6211;&#x4EEC;&#x8981;&#x5BF9;&#x6811;&#x7684;&#x67D0;&#x4E00;&#x5C42;&#x8282;&#x70B9;&#x6267;&#x884C;&#x4E00;&#x4E9B;&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x8003;&#x8651;&#x5982;&#x4E0B;&#x601D;&#x8DEF;&#xFF1A;</p>
<ol type="1">
<li>&#x5C06;&#x6240;&#x6709;&#x8282;&#x70B9;&#x88C5;&#x8FDB;&#x4E00;&#x4E2A;<span class="math inline">\(list\)</span>&#x4E2D;</li>
<li>&#x5229;&#x7528;&#x5E8F;&#x5217;&#x64CD;&#x4F5C;&#x5BF9;<span class="math inline">\(list\)</span>&#x8FDB;&#x884C;&#x5904;&#x7406;</li>
<li>&#x5C06;<span class="math inline">\(list\)</span>&#x56DE;&#x5E26;&#x5230;&#x6811;&#x4E0A;</li>
</ol>
<p>&#x2003;&#x2003;&#x8FD9;&#x79CD;<strong>&#x5C06;&#x4E00;&#x79CD;&#x5E8F;&#x5217;&#x7C7B;&#x578B;&#x8F6C;&#x5316;&#x4E3A;&#x5176;&#x4ED6;&#x7C7B;&#x578B;&#x7684;&#x5E8F;&#x5217;</strong>&#x4ECE;&#x800C;&#x7B80;&#x5316;&#x64CD;&#x4F5C;&#x7684;&#x65B9;&#x6CD5;&#x503C;&#x5F97;&#x5B66;&#x4E60;&#x3002;</p>
<p>&#x2003;&#x2003;<span class="math inline">\(e.g.\)</span>Write a function
reverse_other that mutates the tree such that labels on every other
(odd-depth) level are reversed. For example, Tree(1,[Tree(2, [Tree(4)]),
Tree(3)]) becomes Tree(1,[Tree(3, [Tree(4)]), Tree(2)]). Notice that the
nodes themselves are not reversed; only the labels are.
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">reverse_other</span>(<span class="params">t</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">helper</span>(<span class="params">t,index</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> t.is_leaf():</span><br><span class="line">            <span class="keyword">if</span> index%<span class="number">2</span>==<span class="number">0</span>:</span><br><span class="line">                treelist=[]</span><br><span class="line">                <span class="keyword">for</span> b <span class="keyword">in</span> t.branches:</span><br><span class="line">                    treelist.append(b.label)</span><br><span class="line">                treelist.reverse()</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(t.branches)):</span><br><span class="line">                    t.branches[i].label=treelist[i]</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> b <span class="keyword">in</span> t.branches:</span><br><span class="line">                helper(b,index+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    helper(t,<span class="number">0</span>)</span><br></pre></td></tr></table></figure></p>
<h3 id="3&#x6811;&#x7684;&#x5E94;&#x7528;">3.&#x6811;&#x7684;&#x5E94;&#x7528;</h3>
<p>&#x2003;&#x2003;&#x5229;&#x7528;&#x6811;&#x5F62;&#x9012;&#x5F52;&#x6C42;&#x89E3;&#x7684;&#x95EE;&#x9898;&#x90FD;&#x53EF;&#x4EE5;&#x8F6C;&#x5316;&#x5230;&#x6811;&#x7ED3;&#x6784;&#x4E0A;&#x3002;&#x4EE5;&#x4E4B;&#x524D;&#x7684;<span class="math inline">\(Fib\)</span>&#x6570;&#x5217;&#x548C;&#x6570;&#x7684;&#x5206;&#x89E3;&#x4E3A;&#x4F8B;&#xFF1A;</p>
<h4 id="afib&#x6570;&#x5217;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span><span class="math inline">\(Fib\)</span>&#x6570;&#x5217;</h4>
<p>&#x2003;&#x2003;<span class="math inline">\(Fib\)</span>&#x6570;&#x5217;&#x7684;&#x6811;&#x7ED3;&#x6784;&#x642D;&#x5EFA;&#x5982;&#x4E0B;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">fib_tree</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">if</span>(n==<span class="number">0</span> <span class="keyword">or</span> n==<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        left,right=fib_tree(n-<span class="number">1</span>),fib_tree(n-<span class="number">2</span>)</span><br><span class="line">        fib_n=label(left)+label(right)<span class="comment">#&#x6839;&#x8282;&#x70B9;&#x4E3A;&#x5DE6;&#x53F3;&#x6839;&#x8282;&#x70B9;&#x7684;&#x548C;</span></span><br><span class="line">        <span class="keyword">return</span> tree(fib_n,[left,right])</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fib_tree(<span class="number">5</span>)</span><br><span class="line">[<span class="number">5</span>, [<span class="number">2</span>, [<span class="number">1</span>], [<span class="number">1</span>, [<span class="number">0</span>], [<span class="number">1</span>]]], [<span class="number">3</span>, [<span class="number">1</span>, [<span class="number">0</span>], [<span class="number">1</span>]], [<span class="number">2</span>, [<span class="number">1</span>], [<span class="number">1</span>, [<span class="number">0</span>], [<span class="number">1</span>]]]]]</span><br></pre></td></tr></table></figure> &#x2003;&#x2003;&#x8FD9;&#x6837;&#xFF0C;&#x6BCF;&#x68F5;&#x6811;&#x7684;&#x6839;&#x8282;&#x70B9;&#x5C31;&#x8868;&#x793A;&#x5BF9;&#x5E94;&#x7684;<span class="math inline">\(Fib\)</span>&#x6570;&#x5217;&#x7684;&#x503C;&#x4E86;&#x3002;</p>
<h4 id="b&#x5206;&#x89E3;&#x6811;">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>&#x5206;&#x89E3;&#x6811;</h4>
<p>&#x2003;&#x2003;&#x5728;&#x5148;&#x524D;&#x7684;&#x5206;&#x89E3;&#x6570;&#x5B57;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x6570;&#x5B57;&#x5206;&#x89E3;&#x5206;&#x4E3A;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#xFF1A;</p>
<ul>
<li>&#x9009;&#x4E00;&#x4E2A;<span class="math inline">\(m\)</span>&#xFF0C;&#x7136;&#x540E;&#x5BF9;<span class="math inline">\(n-m\)</span>&#x6267;&#x884C;&#x76F8;&#x540C;&#x64CD;&#x4F5C;</li>
<li>&#x4E0D;&#x9009;<span class="math inline">\(m\)</span>&#xFF0C;&#x6B64;&#x65F6;&#x5E8F;&#x5217;&#x4E2D;&#x6700;&#x5927;&#x503C;&#x53D8;&#x4E3A;<span class="math inline">\(m-1\)</span>&#xFF0C;&#x7136;&#x540E;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x76F8;&#x540C;&#x64CD;&#x4F5C;</li>
</ul>
<p>&#x2003;&#x2003;&#x8FD9;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#x5206;&#x522B;&#x5BF9;&#x5E94;&#x6839;&#x8282;&#x70B9;&#x7684;&#x4E24;&#x4E2A;&#x6811;&#x679D;&#xFF1A;</p>
<ul>
<li>&#x5DE6;&#x6811;&#x679D;&#xFF1A;&#x6240;&#x6709;&#x81F3;&#x5C11;&#x7528;&#x4E00;&#x4E2A;<span class="math inline">\(m\)</span>&#x7684;&#x5206;&#x89E3;<span class="math inline">\(n\)</span>&#x7684;&#x65B9;&#x6CD5;</li>
<li>&#x53F3;&#x6811;&#x679D;&#xFF1A;&#x6700;&#x5927;&#x4E3A;<span class="math inline">\(m-1\)</span>&#x7684;&#x5206;&#x89E3;<span class="math inline">\(n\)</span>&#x7684;&#x65B9;&#x6CD5;</li>
<li>&#x6839;&#x8282;&#x70B9;&#xFF1A;<span class="math inline">\(m\)</span></li>
</ul>
<p>&#x2003;&#x2003;&#x4E8E;&#x662F;&#x53EF;&#x4EE5;&#x5199;&#x51FA;&#x5BF9;&#x5E94;&#x7684;&#x6811;&#x7684;&#x6784;&#x5EFA;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">partition_tree</span>(<span class="params">n,m</span>):</span><br><span class="line">    <span class="keyword">if</span> n==<span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> tree(<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">elif</span> n&lt;<span class="number">0</span> <span class="keyword">or</span> m&lt;<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> tree(<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        left=partition_tree(n-m,m)</span><br><span class="line">        right=partition_tree(n,m-<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> tree(m,[left,right])</span><br><span class="line">    </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>partition_tree(<span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line">[<span class="number">2</span>, [<span class="literal">True</span>], [<span class="number">1</span>, [<span class="number">1</span>, [<span class="literal">True</span>], [<span class="literal">False</span>]], [<span class="literal">False</span>]]]</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x82E5;&#x8981;&#x6253;&#x5370;&#x8BE5;&#x6811;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x6811;&#x7684;&#x6839;&#x8282;&#x70B9;&#x8F6C;&#x5316;&#x4E3A;<span class="math inline">\(string\)</span>&#x7C7B;&#x578B;&#xFF0C;&#x7136;&#x540E;&#x9012;&#x5F52;&#x6253;&#x5370;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">print_parts</span>(<span class="params">tree,partition=[]</span>):</span><br><span class="line">    <span class="keyword">if</span> is_leaf(tree):</span><br><span class="line">        <span class="keyword">if</span> label(tree):<span class="comment">#&#x5982;&#x679C;&#x4E0D;&#x662F;&#x7A7A;&#x8282;&#x70B9;</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&apos;+&apos;</span>.join(partition))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        left,right=branches(tree)//&#x5E8F;&#x5217;&#x89E3;&#x5305;</span><br><span class="line">        m=<span class="built_in">str</span>(label(tree))</span><br><span class="line">        print_parts(left,partition+m)</span><br><span class="line">        print_parts(right,partition+m)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print_parts(partition_tree(<span class="number">6</span>, <span class="number">4</span>))</span><br><span class="line"><span class="number">4</span> + <span class="number">2</span></span><br><span class="line"><span class="number">4</span> + <span class="number">1</span> + <span class="number">1</span></span><br><span class="line"><span class="number">3</span> + <span class="number">3</span></span><br><span class="line"><span class="number">3</span> + <span class="number">2</span> + <span class="number">1</span></span><br><span class="line"><span class="number">3</span> + <span class="number">1</span> + <span class="number">1</span> + <span class="number">1</span></span><br><span class="line"><span class="number">2</span> + <span class="number">2</span> + <span class="number">2</span></span><br><span class="line"><span class="number">2</span> + <span class="number">2</span> + <span class="number">1</span> + <span class="number">1</span></span><br><span class="line"><span class="number">2</span> + <span class="number">1</span> + <span class="number">1</span> + <span class="number">1</span> + <span class="number">1</span></span><br><span class="line"><span class="number">1</span> + <span class="number">1</span> + <span class="number">1</span> + <span class="number">1</span> + <span class="number">1</span> + <span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<h2 id="&#x4E03;-linkedlists">&#x4E03;&#x3001;<span class="math inline">\(Linked\;lists\)</span></h2>
<h3 id="1&#x94FE;&#x8868;&#x7684;&#x6982;&#x5FF5;">1.&#x94FE;&#x8868;&#x7684;&#x6982;&#x5FF5;</h3>
<p>&#x2003;&#x2003;&#x5982;&#x4E0B;&#x6240;&#x793A;&#x7684;&#x5E8F;&#x5217;&#x7ED3;&#x6784;&#x5C31;&#x662F;&#x94FE;&#x8868;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">four = [<span class="number">1</span>, [<span class="number">2</span>, [<span class="number">3</span>, [<span class="number">4</span>, <span class="string">&apos;empty&apos;</span>]]]]</span><br></pre></td></tr></table></figure></p>
<p><img src="/2024/05/31/2.3.%E5%BA%8F%E5%88%97/image-2.png"></p>
<p>&#x2003;&#x2003;&#x94FE;&#x8868;&#x8868;&#x793A;&#x82E5;&#x5E72;&#x4E2A;<span class="math inline">\(pair\)</span>&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;<span class="math inline">\(pair\)</span>&#x5305;&#x62EC;&#x7B2C;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x548C;&#x4E00;&#x4E2A;&#x5B50;&#x94FE;&#x8868;&#xFF0C;&#x4EE5;&#x6B64;&#x7C7B;&#x63A8;&#xFF1B;&#x6700;&#x540E;&#x4E00;&#x4E2A;<span class="math inline">\(pair\)</span>&#x5305;&#x542B;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x548C;&#x7A7A;&#x94FE;&#x8868;<code>empty</code>&#x3002;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x94FE;&#x8868;&#x5177;&#x6709;<strong>&#x9012;&#x5F52;&#x7684;&#x7ED3;&#x6784;</strong>&#x3002;</p>
<h3 id="2&#x94FE;&#x8868;&#x7684;&#x64CD;&#x4F5C;">2.&#x94FE;&#x8868;&#x7684;&#x64CD;&#x4F5C;</h3>
<h4 id="a&#x94FE;&#x8868;&#x7684;&#x57FA;&#x672C;&#x5143;&#x7D20;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&#x94FE;&#x8868;&#x7684;&#x57FA;&#x672C;&#x5143;&#x7D20;</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">first</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">return</span> s[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rest</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">return</span> s[<span class="number">1</span>]</span><br></pre></td></tr></table></figure>
<h4 id="b&#x94FE;&#x8868;&#x7684;&#x957F;&#x5EA6;&#x4E0E;&#x5143;&#x7D20;&#x8BBF;&#x95EE;">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>&#x94FE;&#x8868;&#x7684;&#x957F;&#x5EA6;&#x4E0E;&#x5143;&#x7D20;&#x8BBF;&#x95EE;</h4>
<p>&#x2003;&#x2003;&#x4F5C;&#x4E3A;&#x5E8F;&#x5217;&#x7684;&#x4E00;&#x79CD;&#x5F62;&#x5F0F;&#xFF0C;&#x5E8F;&#x5217;&#x62BD;&#x8C61;&#x7684;&#x64CD;&#x4F5C;&#x5728;&#x94FE;&#x8868;&#x4E2D;&#x4EA6;&#x53EF;&#x5B9E;&#x73B0;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">len_link</span>(<span class="params">s</span>):</span><br><span class="line">    length=<span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> s!=empty:</span><br><span class="line">        s,length=rest(s),length+<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> length</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getitem_link</span>(<span class="params">s,i</span>):</span><br><span class="line">    <span class="keyword">while</span> i&gt;<span class="number">0</span>:</span><br><span class="line">        s,i=rest(s),i-<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> first(s)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>len_link(four)</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>getitem_link(four, <span class="number">1</span>)</span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure></p>
<h4 id="c&#x94FE;&#x8868;&#x7684;&#x5E8F;&#x5217;&#x57FA;&#x672C;&#x64CD;&#x4F5C;">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>&#x94FE;&#x8868;&#x7684;&#x201C;&#x5E8F;&#x5217;&#x57FA;&#x672C;&#x64CD;&#x4F5C;&#x201D;</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">extend_link</span>(<span class="params">s,t</span>):</span><br><span class="line">    <span class="comment">#Return a list with the elements of s followed by those of t.</span></span><br><span class="line">    <span class="keyword">assert</span> is_link(s) <span class="keyword">and</span> is_link(t)</span><br><span class="line">    <span class="keyword">if</span> s==empty:</span><br><span class="line">        <span class="keyword">return</span> t</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> link(first(s),extend_link(rest(s),t))</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>extend_link(four, four)</span><br><span class="line">[<span class="number">1</span>, [<span class="number">2</span>, [<span class="number">3</span>, [<span class="number">4</span>, [<span class="number">1</span>, [<span class="number">2</span>, [<span class="number">3</span>, [<span class="number">4</span>, <span class="string">&apos;empty&apos;</span>]]]]]]]]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">apply_to_all_link</span>(<span class="params">f,s</span>):</span><br><span class="line">    <span class="keyword">assert</span> is_link(s)</span><br><span class="line">    <span class="keyword">if</span> s==empty:</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> link(f(first(s)),apply_to_all_link(f,rest(s)))</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>apply_to_all_link(<span class="keyword">lambda</span> x: x*x, four)</span><br><span class="line">[<span class="number">1</span>, [<span class="number">4</span>, [<span class="number">9</span>, [<span class="number">16</span>, <span class="string">&apos;empty&apos;</span>]]]]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">keep_if_link</span>(<span class="params">f,s</span>):</span><br><span class="line">    <span class="comment">#Return a list with elements of s for which f(e) is true.</span></span><br><span class="line">    <span class="keyword">assert</span> is_link(s)</span><br><span class="line">    <span class="keyword">if</span> s==empty:</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        kept=keep_if_link(f,rest(s))</span><br><span class="line">        <span class="keyword">if</span> f(first(s)):</span><br><span class="line">            <span class="keyword">return</span> link(first(s)+kept)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> kept</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>keep_if_link(<span class="keyword">lambda</span> x: x%<span class="number">2</span> == <span class="number">0</span>, four)</span><br><span class="line">[<span class="number">2</span>, [<span class="number">4</span>, <span class="string">&apos;empty&apos;</span>]]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">join_link</span>(<span class="params">s,separator</span>):</span><br><span class="line">    <span class="comment">#Return a string of all elements in s separated by separator.</span></span><br><span class="line">    <span class="keyword">if</span> s==empty:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> rest(s)==empty:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(first(s))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(first(s))+separator+join_link(rest(s),separator)</span><br><span class="line">    </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>join_link(four, <span class="string">&quot;, &quot;</span>)</span><br><span class="line"><span class="string">&apos;1, 2, 3, 4&apos;</span></span><br></pre></td></tr></table></figure>
<h3 id="3&#x94FE;&#x8868;&#x7684;&#x5E94;&#x7528;">3.&#x94FE;&#x8868;&#x7684;&#x5E94;&#x7528;</h3>
<p>&#x2003;&#x2003;&#x94FE;&#x8868;&#x5728;&#x9012;&#x589E;&#x6784;&#x9020;&#x5E8F;&#x5217;&#x65B9;&#x9762;&#x975E;&#x5E38;&#x6709;&#x7528;&#xFF0C;&#x56E0;&#x4E3A;&#x94FE;&#x8868;&#x5141;&#x8BB8;&#x52A8;&#x6001;&#x6DFB;&#x52A0;&#x5143;&#x7D20;&#x3001;&#x800C;&#x4E0D;&#x5FC5;&#x4E00;&#x5F00;&#x59CB;&#x77E5;&#x9053;&#x5E8F;&#x5217;&#x5168;&#x90E8;&#x5185;&#x5BB9;</p>
<p>&#x2003;&#x2003;&#x4EE5;&#x5148;&#x524D;&#x7684;&#x6570;&#x7684;&#x5206;&#x89E3;&#x4E3A;&#x4F8B;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x5217;&#x8868;&#x5982;&#x4E0B;&#x5B9E;&#x73B0;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">partition</span>(<span class="params">n,m</span>):</span><br><span class="line">    <span class="keyword">if</span> n==<span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> link(empty,empty)</span><br><span class="line">    <span class="keyword">elif</span> n&lt;<span class="number">0</span> <span class="keyword">or</span> m&lt;<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> empty</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        using_m=partition(n-m,m)</span><br><span class="line">        with_m = apply_to_all_link(<span class="keyword">lambda</span> s: link(m, s), using_m)</span><br><span class="line">        <span class="comment"># creat a list that starts with m</span></span><br><span class="line">        without_m = partitions(n, m-<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> extend_link(with_m, without_m)</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/2.4.%E5%8F%AF%E5%8F%98%E6%95%B0%E6%8D%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/2.4.%E5%8F%AF%E5%8F%98%E6%95%B0%E6%8D%AE/" class="post-title-link" itemprop="url">2.4.&#x53EF;&#x53D8;&#x6570;&#x636E;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 15:05:35" itemprop="dateModified" datetime="2024-06-02T15:05:35+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SICP-in-python/" itemprop="url" rel="index"><span itemprop="name">SICP in python</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SICP-in-python/Chapter-2-Building-Abstraction-with-Data/" itemprop="url" rel="index"><span itemprop="name">Chapter 2.Building Abstraction with Data</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>5.5k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>20 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="24&#x53EF;&#x53D8;&#x6570;&#x636E;"><span class="math inline">\(2.4\)</span>&#x53EF;&#x53D8;&#x6570;&#x636E;</h1>
<p>&#x2003;&#x2003;&#x5728;&#x6A21;&#x5757;&#x5316;&#x7A0B;&#x5E8F;&#x8BBE;&#x8BA1;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x91CD;&#x8981;&#x6280;&#x672F;&#x662F;<strong>&#x5408;&#x5E76;&#x968F;&#x65F6;&#x95F4;&#x53D8;&#x5316;&#x7684;&#x6570;&#x636E;</strong>&#xFF0C;&#x8FD9;&#x6837;&#xFF0C;&#x5408;&#x5E76;&#x540E;&#x7684;&#x6570;&#x636E;&#x5C31;&#x53EF;&#x4EE5;&#x8868;&#x793A;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;&#x5BF9;&#x8C61;&#x3001;&#x4E0D;&#x88AB;&#x7A0B;&#x5E8F;&#x7684;&#x5176;&#x4ED6;&#x90E8;&#x5206;&#x9650;&#x5236;&#x3002;<strong>&#x5C06;&#x72B6;&#x6001;&#x52A0;&#x5165;&#x6570;&#x636E;&#x4E2D;</strong>&#x662F;&#x201C;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x7F16;&#x7A0B;&#x201D;&#x7684;&#x6838;&#x5FC3;&#x8981;&#x7D20;&#x3002;</p>
<h2 id="&#x4E00;-&#x5BF9;&#x8C61;objection&#x53CA;&#x5176;&#x76F8;&#x5173;&#x6982;&#x5FF5;">&#x4E00;&#x3001;&#x5BF9;&#x8C61;(<span class="math inline">\(objection\)</span>)&#x53CA;&#x5176;&#x76F8;&#x5173;&#x6982;&#x5FF5;</h2>
<p>&#x2003;&#x2003;&#x5BF9;&#x8C61;&#x5305;&#x542B;<strong>&#x6570;&#x636E;&#x7684;&#x503C;(<span class="math inline">\(value\)</span>)&#x4E0E;&#x6570;&#x636E;&#x884C;&#x4E3A;(<span class="math inline">\(behaviour\)</span>)</strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x4EE5;<span class="math inline">\(python\)</span>&#x5E93;&#x4E2D;&#x7684;<code>date</code>&#x4E3A;&#x4F8B;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> date</span><br></pre></td></tr></table></figure>
&#x2003;&#x2003;&#x5728;&#x8FD9;&#x91CC;&#xFF0C;<code>date</code>&#x51FD;&#x6570;&#x4E0E;<code>class</code>&#x88AB;&#x7ED1;&#x5B9A;&#x5728;&#x4E00;&#x8D77;&#x3002;<code>class</code>&#x662F;&#x4E00;&#x7C7B;&#x6570;&#x503C;&#x7684;&#x603B;&#x79F0;&#xFF0C;&#x5355;&#x72EC;&#x7684;<code>date</code>&#x662F;<code>class</code>&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#x3002;</p>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5982;&#x4E0B;&#x5BF9;<code>date</code>&#x8D4B;&#x503C;&#x4E0E;&#x5BF9;<code>date</code>&#x8FDB;&#x884C;&#x8FD0;&#x7B97;&#xFF0C;&#x50CF;&#x666E;&#x901A;&#x6570;&#x636E;&#x4E00;&#x6837;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>tues = date(<span class="number">2014</span>, <span class="number">5</span>, <span class="number">13</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(date(<span class="number">2014</span>, <span class="number">5</span>, <span class="number">19</span>) - tues)</span><br><span class="line"><span class="number">6</span> days, <span class="number">0</span>:<span class="number">00</span>:<span class="number">00</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x540C;&#x65F6;&#xFF0C;&#x5BF9;&#x8C61;&#x5177;&#x6709;<strong>&#x5C5E;&#x6027;</strong>(attribute)&#xFF0C;&#x5C5E;&#x6027;&#x5373;&#x662F;<strong>&#x5BF9;&#x8C61;&#x4E0D;&#x540C;&#x90E8;&#x5206;&#x7684;&#x6570;&#x503C;</strong>&#x3002;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5982;&#x4E0B;&#x65B9;&#x5F0F;&#x8BBF;&#x95EE;&#x5176;&#x5C5E;&#x6027;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;expression&gt;.&lt;name&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tues.year</span><br><span class="line"><span class="number">2014</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5BF9;&#x8C61;&#x8FD8;&#x5177;&#x6709;<strong>&#x65B9;&#x6CD5;</strong>(method)&#xFF0C;&#x65B9;&#x6CD5;&#x5C31;&#x662F;<strong>&#x4E00;&#x4E2A;&#x5185;&#x7F6E;&#x7684;&#x51FD;&#x6570;</strong>&#xFF0C;&#x5F53;&#x8C03;&#x7528;&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;<strong>&#x5BF9;&#x8C61;&#x4F1A;&#x81EA;&#x5DF1;&#x6267;&#x884C;&#x3001;&#x8F93;&#x51FA;&#x5BF9;&#x5E94;&#x7684;&#x7ED3;&#x679C;</strong>&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>tues.strftime(<span class="string">&apos;%A, %B %d&apos;</span>)</span><br><span class="line"><span class="string">&apos;Tuesday, May 13&apos;</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x4E0D;&#x4EC5;<code>data</code>&#xFF0C;<span class="math inline">\(python\)</span>&#x4E2D;&#x7684;&#x5176;&#x4ED6;&#x503C;(&#x5982;<code>string,numbers...</code>)&#x90FD;&#x662F;&#x5BF9;&#x8C61;&#xFF0C;&#x56E0;&#x4E3A;&#x4ED6;&#x4EEC;&#x90FD;&#x6709;<strong>&#x5C5E;&#x6027;&#x548C;&#x5BF9;&#x5E94;&#x7684;&#x884C;&#x4E3A;</strong>&#x3002;</p>
<h2 id="&#x4E09;-&#x5E8F;&#x5217;&#x5BF9;&#x8C61;">&#x4E09;&#x3001;&#x5E8F;&#x5217;&#x5BF9;&#x8C61;</h2>
<h3 id="1&#x53EF;&#x6539;&#x53D8;&#x5BF9;&#x8C61;">1.&#x53EF;&#x6539;&#x53D8;&#x5BF9;&#x8C61;</h3>
<h4 id="a&#x6982;&#x5FF5;&#x4E0E;&#x6027;&#x8D28;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&#x6982;&#x5FF5;&#x4E0E;&#x6027;&#x8D28;</h4>
<p>&#x2003;&#x2003;<strong>&#x53EF;&#x6539;&#x53D8;&#x5BF9;&#x8C61;</strong>(<span class="math inline">\(mutable\;objects\)</span>)&#x7528;&#x4E8E;<strong>&#x8868;&#x793A;&#x968F;&#x65F6;&#x95F4;&#x53D8;&#x5316;&#x7684;&#x91CF;</strong>&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6539;&#x53D8;<span class="math inline">\(list\)</span>&#x5185;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x5229;&#x7528;<span class="math inline">\(list\)</span>&#x81EA;&#x5E26;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x800C;<span class="math inline">\(number\)</span>&#x662F;&#x4E0D;&#x53EF;&#x6539;&#x53D8;&#x5BF9;&#x8C61;&#x3002;</p>
<p>&#x2003;&#x2003;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x5C55;&#x793A;&#x4E86;<span class="math inline">\(list\)</span>&#x7684;&#x53EF;&#x6539;&#x53D8;&#x6027;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">chinese = [<span class="string">&apos;coin&apos;</span>, <span class="string">&apos;string&apos;</span>, <span class="string">&apos;myriad&apos;</span>]</span><br><span class="line">suits = chinese</span><br><span class="line">suits.pop()</span><br><span class="line">suits.remove(<span class="string">&apos;string&apos;</span>)</span><br><span class="line">suits.append(<span class="string">&apos;cup&apos;</span>)</span><br><span class="line">suits.extend([<span class="string">&apos;sword&apos;</span>, <span class="string">&apos;club&apos;</span>])</span><br><span class="line">suits[<span class="number">2</span>] = <span class="string">&apos;spade&apos;</span></span><br><span class="line">suits[<span class="number">0</span>:<span class="number">2</span>] = [<span class="string">&apos;heart&apos;</span>, <span class="string">&apos;diamond&apos;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>chinese  <span class="comment"># This name co-refers with &quot;suits&quot; to the same changing list</span></span><br><span class="line">[<span class="string">&apos;heart&apos;</span>, <span class="string">&apos;diamond&apos;</span>, <span class="string">&apos;spade&apos;</span>, <span class="string">&apos;club&apos;</span>]</span><br></pre></td></tr></table></figure>
&#x2003;&#x2003;&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x4E00;&#x76F4;&#x5728;&#x6539;&#x53D8;&#x4E00;&#x4E2A;<span class="math inline">\(list\)</span>&#x800C;&#x975E;&#x521B;&#x9020;&#x4E00;&#x4E2A;&#x65B0;<span class="math inline">\(list\)</span>&#xFF0C;&#x4E0E;&#x539F;<span class="math inline">\(list\)</span>&#x7ED1;&#x5B9A;&#x7684;<code>chinese</code>&#x4E5F;&#x968F;&#x4E4B;&#x6539;&#x53D8;&#xFF0C;&#x56E0;&#x4E3A;<strong>&#x5B83;&#x4EEC;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;</strong>&#x3002;&#x56E0;&#x6B64;&#xFF0C;<strong>&#x5BF9;&#x4E8E;&#x53EF;&#x6539;&#x53D8;&#x5BF9;&#x8C61;&#xFF0C;&#x5BF9;&#x67D0;&#x4E2A;&#x540D;&#x5B57;(<span class="math inline">\(name\)</span>)&#x4F7F;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#x4E0D;&#x6539;&#x53D8;&#x53E6;&#x4E00;&#x4E2A;&#x540D;&#x5B57;&#x7684;&#x503C;&#xFF0C;&#x5F53;&#x4E14;&#x4EC5;&#x5F53;&#x5B83;&#x4EEC;&#x4E0D;&#x5171;&#x4EAB;&#x540C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;</strong>&#x3002;</p>
<blockquote>
<p>&#x2003;&#x2003;<span class="math inline">\(p.s.\)</span>&#x8FD9;&#x91CC;&#x7684;&#x201C;&#x5171;&#x4EAB;&#x201D;<strong>&#x5E76;&#x4E0D;&#x4EC5;&#x4EC5;&#x662F;&#x76F8;&#x540C;</strong>&#xFF0C;&#x5F53;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#x7684;&#x67D0;&#x4E00;&#x90E8;&#x5206;&#x7528;&#x53EF;&#x6539;&#x53D8;&#x5BF9;&#x8C61;&#x8D4B;&#x503C;&#x65F6;&#xFF0C;&#x6539;&#x53D8;&#x53EF;&#x6539;&#x53D8;&#x5BF9;&#x8C61;&#x4E5F;&#x4F1A;&#x5BFC;&#x81F4;&#x8FD9;&#x4E00;&#x53D8;&#x91CF;&#x6539;&#x53D8;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>nest = <span class="built_in">list</span>(suits)  <span class="comment"># Bind &quot;nest&quot; to a second list with the same elements</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>nest[<span class="number">0</span>] = suits     <span class="comment"># Create a nested list</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>suits.insert(<span class="number">2</span>, <span class="string">&apos;Joker&apos;</span>)  <span class="comment"># Insert an element at index 2, shifting the rest</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>nest</span><br><span class="line">[[<span class="string">&apos;heart&apos;</span>, <span class="string">&apos;diamond&apos;</span>, <span class="string">&apos;Joker&apos;</span>, <span class="string">&apos;spade&apos;</span>, <span class="string">&apos;club&apos;</span>], <span class="string">&apos;diamond&apos;</span>, <span class="string">&apos;spade&apos;</span>, <span class="string">&apos;club&apos;</span>]</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>&#x2003;&#x2003;&#x9700;&#x8981;&#x6CE8;&#x610F;&#xFF0C;<strong>&#x7ECF;&#x8FC7;&#x5E8F;&#x5217;&#x89E3;&#x6790;&#x540E;&#x5F97;&#x5230;&#x7684;&#x65B0;&#x5E8F;&#x5217;&#x4E0D;&#x4E0E;&#x5148;&#x524D;&#x5E8F;&#x5217;&#x5171;&#x4EAB;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;</strong>&#x3002;</p>
<h4 id="bis&#x8FD0;&#x7B97;">&#x2003;&#x2003;<span class="math inline">\(b.\)</span><span class="math inline">\(is\)</span>&#x8FD0;&#x7B97;</h4>
<p>&#x2003;&#x2003;&#x7531;&#x4E0A;&#x8FF0;&#x8BBA;&#x8BC1;&#xFF0C;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x8868;&#x8FBE;&#x5F0F;<span class="math inline">\(is\)</span>&#x4E3A;<strong>&#x4E24;&#x4E2A;&#x540D;&#x5B57;&#x662F;&#x5426;&#x540C;&#x5C5E;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;</strong>&#xFF0C;&#x5982;&#x4E0B;&#x4F8B;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">suits = [<span class="string">&apos;heart&apos;</span>, <span class="string">&apos;diamond&apos;</span>, <span class="string">&apos;spade&apos;</span>, <span class="string">&apos;club&apos;</span>]</span><br><span class="line">nest = <span class="built_in">list</span>(suits)</span><br><span class="line">nest[<span class="number">0</span>] = suits</span><br><span class="line">suits.insert(<span class="number">2</span>, <span class="string">&apos;Joker&apos;</span>)</span><br><span class="line">joke = nest[<span class="number">0</span>].pop(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>suits <span class="keyword">is</span> nest[<span class="number">0</span>]</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>suits <span class="keyword">is</span> [<span class="string">&apos;heart&apos;</span>, <span class="string">&apos;diamond&apos;</span>, <span class="string">&apos;spade&apos;</span>, <span class="string">&apos;club&apos;</span>]</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>suits == [<span class="string">&apos;heart&apos;</span>, <span class="string">&apos;diamond&apos;</span>, <span class="string">&apos;spade&apos;</span>, <span class="string">&apos;club&apos;</span>]</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure> &#x2003;&#x2003;&#x6B64;&#x5904;&#x7684;<span class="math inline">\(list\)</span>&#x662F;&#x65B0;&#x521B;&#x5EFA;&#x7684;<span class="math inline">\(list\)</span>,&#x56E0;&#x6B64;&#x662F;&#x65B0;&#x7684;&#x5BF9;&#x8C61;&#x3002;</p>
<h3 id="2&#x5143;&#x7EC4;&#x4E0E;&#x5B57;&#x5178;">2.&#x5143;&#x7EC4;&#x4E0E;&#x5B57;&#x5178;</h3>
<h4 id="a&#x5143;&#x7EC4;tuple">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&#x5143;&#x7EC4;(<span class="math inline">\(Tuple\)</span>)</h4>
<p>&#x2003;&#x2003;&#x4E0B;&#x9762;&#x7684;&#x51E0;&#x79CD;&#x5E8F;&#x5217;&#x5F62;&#x5F0F;&#x90FD;&#x5C5E;&#x4E8E;&#x5143;&#x7EC4;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1</span>, <span class="number">2</span> + <span class="number">3</span></span><br><span class="line">(<span class="number">1</span>, <span class="number">5</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>(<span class="string">&quot;the&quot;</span>, <span class="number">1</span>, (<span class="string">&quot;and&quot;</span>, <span class="string">&quot;only&quot;</span>))</span><br><span class="line">(<span class="string">&apos;the&apos;</span>, <span class="number">1</span>, (<span class="string">&apos;and&apos;</span>, <span class="string">&apos;only&apos;</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>( (<span class="number">10</span>, <span class="number">20</span>) )</span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">&apos;tuple&apos;</span>&gt;</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5143;&#x7EC4;&#x7684;&#x67E5;&#x8BE2;&#x64CD;&#x4F5C;&#x5982;&#x4E0B;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>code = (<span class="string">&quot;up&quot;</span>, <span class="string">&quot;up&quot;</span>, <span class="string">&quot;down&quot;</span>, <span class="string">&quot;down&quot;</span>) + (<span class="string">&quot;left&quot;</span>, <span class="string">&quot;right&quot;</span>) * <span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(code)</span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>code[<span class="number">3</span>]</span><br><span class="line"><span class="string">&apos;down&apos;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>code.count(<span class="string">&quot;down&quot;</span>)</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>code.index(<span class="string">&quot;left&quot;</span>)</span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure>
&#x2003;&#x2003;&#x7531;&#x4E8E;<strong>&#x5143;&#x7EC4;&#x662F;&#x4E0D;&#x53EF;&#x6539;&#x53D8;&#x5BF9;&#x8C61;&#xFF0C;&#x56E0;&#x6B64;<span class="math inline">\(list\)</span>&#x8BF8;&#x5982;<code>pop,insert</code>&#x7B49;&#x65B9;&#x6CD5;&#x5BF9;&#x5143;&#x7EC4;&#x90FD;&#x4E0D;&#x9002;&#x7528;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x867D;&#x7136;&#x5143;&#x7EC4;&#x662F;&#x4E0D;&#x53EF;&#x6539;&#x53D8;&#x5BF9;&#x8C61;&#xFF0C;&#x4F46;&#x5F53;&#x8C03;&#x7528;&#x5143;&#x7EC4;&#x5185;&#x90E8;&#x7684;&#x53EF;&#x6539;&#x53D8;&#x5BF9;&#x8C61;&#x65F6;&#xFF0C;&#x5B83;&#x4F9D;&#x7136;&#x662F;&#x53EF;&#x6539;&#x53D8;&#x7684;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nest = (<span class="number">10</span>, <span class="number">20</span>, [<span class="number">30</span>, <span class="number">40</span>])</span><br><span class="line">nest[<span class="number">2</span>].pop()</span><br></pre></td></tr></table></figure></p>
<h4 id="b&#x5B57;&#x5178;dictionary">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>&#x5B57;&#x5178;(<span class="math inline">\(dictionary\)</span>)</h4>
<p>&#x2003;&#x2003;&#x5B57;&#x5178;&#x662F;&#x4E00;&#x4E2A;<strong>&#x50A8;&#x5B58;&#x952E;&#x503C;&#x5BF9;&#x7684;&#x5BB9;&#x5668;</strong>&#x3002;&#x5B57;&#x5178;&#x7684;&#x4F5C;&#x7528;&#x662F;<strong>&#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x62BD;&#x8C61;&#xFF0C;&#x7528;&#x4E8E;&#x5B58;&#x50A8;&#x548C;&#x68C0;&#x7D22;&#x90A3;&#x4E9B;&#x4E0D;&#x662F;&#x901A;&#x8FC7;&#x8FDE;&#x7EED;&#x6574;&#x6570;&#x800C;&#x662F;&#x901A;&#x8FC7;&#x63CF;&#x8FF0;&#x6027;&#x952E;&#x8FDB;&#x884C;&#x7D22;&#x5F15;&#x7684;&#x503C;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x4E0B;&#x9762;&#x7684;&#x51E0;&#x79CD;&#x5E8F;&#x5217;&#x5F62;&#x5F0F;&#x90FD;&#x662F;&#x5B57;&#x5178;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>numerals = {<span class="string">&apos;I&apos;</span>: <span class="number">1.0</span>, <span class="string">&apos;V&apos;</span>: <span class="number">5</span>, <span class="string">&apos;X&apos;</span>: <span class="number">10</span>}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5B57;&#x5178;&#x7684;&#x67E5;&#x8BE2;&#x7B49;&#x64CD;&#x4F5C;&#x5982;&#x4E0B;&#xFF0C;&#x7531;&#x4E8E;&#x5B57;&#x5178;&#x662F;&#x53EF;&#x6539;&#x53D8;&#x5BF9;&#x8C61;&#xFF0C;&#x53EF;&#x4EE5;&#x5BF9;&#x5B57;&#x5178;&#x8FDB;&#x884C;&#x63D2;&#x5165;&#x3001;&#x5220;&#x6539;&#x7B49;&#x64CD;&#x4F5C;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>numerals[<span class="string">&apos;X&apos;</span>]</span><br><span class="line"><span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>numerals[<span class="string">&apos;I&apos;</span>] = <span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>numerals[<span class="string">&apos;L&apos;</span>] = <span class="number">50</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>numerals</span><br><span class="line">{<span class="string">&apos;I&apos;</span>: <span class="number">1</span>, <span class="string">&apos;X&apos;</span>: <span class="number">10</span>, <span class="string">&apos;L&apos;</span>: <span class="number">50</span>, <span class="string">&apos;V&apos;</span>: <span class="number">5</span>}</span><br></pre></td></tr></table></figure> &#x2003;&#x2003;&#x9700;&#x8981;&#x6CE8;&#x610F;&#xFF0C;&#x5B57;&#x5178;&#x5185;&#x5143;&#x7D20;&#x6709;&#x5982;&#x4E0B;&#x6027;&#x8D28;&#xFF1A;</p>
<ul>
<li>&#x5B57;&#x5178;&#x7684;&#x952E;<strong>&#x4E0D;&#x80FD;&#x662F;&#x6216;&#x5305;&#x542B;&#x53EF;&#x53D8;&#x7684;&#x503C;</strong>&#x3002;</li>
<li>&#x5BF9;&#x4E8E;&#x7ED9;&#x5B9A;&#x7684;&#x952E;&#xFF0C;<strong>&#x6700;&#x591A;&#x53EA;&#x80FD;&#x6709;&#x4E00;&#x4E2A;&#x503C;</strong>&#x3002;</li>
</ul>
<p>&#x2003;&#x2003;&#x5B57;&#x5178;&#x4E2D;&#x7684;&#x5143;&#x7D20;&#x90FD;&#x53EF;&#x901A;&#x8FC7;&#x53EF;&#x8FED;&#x4EE3;&#x7684;&#x5BF9;&#x8C61;&#x5C5E;&#x6027;<code>keys</code>&#x3001;<code>values</code>&#x3001;<code>items</code>&#x6765;&#x8BBF;&#x95EE;&#xFF0C;&#x5E76;&#x53EF;&#x7528;<span class="math inline">\(sum\)</span>&#x7B49;&#x51FD;&#x6570;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x5408;&#x5E76;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">sum</span>(numerals.values())</span><br><span class="line"><span class="number">66</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x4E00;&#x7CFB;&#x5217;&#x952E;&#x503C;&#x5BF9;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8F6C;&#x5316;&#x4E3A;&#x5B57;&#x5178;&#x7C7B;&#x578B;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">dict</span>([(<span class="number">3</span>, <span class="number">9</span>), (<span class="number">4</span>, <span class="number">16</span>), (<span class="number">5</span>, <span class="number">25</span>)])</span><br><span class="line">{<span class="number">3</span>: <span class="number">9</span>, <span class="number">4</span>: <span class="number">16</span>, <span class="number">5</span>: <span class="number">25</span>}</span><br></pre></td></tr></table></figure>
&#x2003;&#x2003;&#x5B57;&#x5178;&#x4E5F;&#x6709;&#x7C7B;&#x4F3C;&#x5217;&#x8868;&#x89E3;&#x6790;&#x7684;&#x64CD;&#x4F5C;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>{x: x*x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>,<span class="number">6</span>)}</span><br><span class="line">{<span class="number">3</span>: <span class="number">9</span>, <span class="number">4</span>: <span class="number">16</span>, <span class="number">5</span>: <span class="number">25</span>}</span><br></pre></td></tr></table></figure></p>
<h2 id="&#x56DB;-&#x5C40;&#x90E8;&#x72B6;&#x6001;localstate">&#x56DB;&#x3001;&#x5C40;&#x90E8;&#x72B6;&#x6001;(<span class="math inline">\(local\;state\)</span>)</h2>
<h3 id="1&#x5C40;&#x90E8;&#x72B6;&#x6001;&#x7684;&#x6982;&#x5FF5;">1.&#x5C40;&#x90E8;&#x72B6;&#x6001;&#x7684;&#x6982;&#x5FF5;</h3>
<p>&#x2003;&#x2003;&#x5217;&#x8868;&#x4E0E;&#x5B57;&#x5178;&#x7B49;&#x53EF;&#x6539;&#x53D8;&#x5BF9;&#x8C61;&#x5177;&#x6709;&#x7684;&#x8FD9;&#x79CD;&#x6027;&#x8D28;&#x88AB;&#x79F0;&#x4E3A;<strong>&#x5C40;&#x90E8;&#x72B6;&#x6001;</strong>&#xFF1A;&#x5728;&#x7A0B;&#x5E8F;&#x7684;&#x6267;&#x884C;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5B83;&#x4EEC;&#x7684;&#x4E00;&#x4E9B;&#x7279;&#x5B9A;&#x7684;&#x5185;&#x5BB9;&#x4F1A;&#x53D1;&#x751F;&#x6539;&#x53D8;&#x3002;&#x201C;&#x72B6;&#x6001;&#x201D;&#x4E00;&#x8BCD;&#x8BF4;&#x660E;&#x5BF9;&#x8C61;&#x7684;&#x72B6;&#x6001;&#x4F1A;&#x5728;&#x5305;&#x542B;&#x5B83;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x53D1;&#x751F;&#x6539;&#x53D8;&#x3002;</p>
<p>&#x2003;&#x2003;&#x51FD;&#x6570;&#x4E5F;&#x5177;&#x6709;&#x5C40;&#x90E8;&#x72B6;&#x6001;&#x3002;&#x6211;&#x4EEC;&#x5047;&#x8BBE;&#x4E00;&#x4E2A;&#x51FD;&#x6570;<code>withdraw</code>&#x6765;&#x6A21;&#x62DF;&#x4ECE;&#x94F6;&#x884C;&#x53D6;&#x94B1;&#x7684;&#x8FC7;&#x7A0B;&#x3002;&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x7684;&#x94F6;&#x884C;&#x8D26;&#x6237;&#x6709;<span class="math inline">\(100\)</span>&#x5143;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x901A;&#x8FC7;&#x5F15;&#x7528;<code>withdraw</code>&#x5F97;&#x5230;&#x4E0B;&#x5217;&#x5E8F;&#x5217;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>withdraw(<span class="number">25</span>)</span><br><span class="line"><span class="number">75</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>withdraw(<span class="number">25</span>)</span><br><span class="line"><span class="number">50</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>withdraw(<span class="number">60</span>)</span><br><span class="line"><span class="string">&apos;Insufficient funds&apos;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>withdraw(<span class="number">15</span>)</span><br><span class="line"><span class="number">35</span></span><br></pre></td></tr></table></figure>
&#x2003;&#x2003;&#x8868;&#x8FBE;&#x5F0F;<code>withdraw</code>&#x88AB;&#x8C03;&#x7528;&#x4E24;&#x6B21;&#xFF0C;&#x8FD4;&#x56DE;&#x4E0D;&#x540C;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x56E0;&#x6B64;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x662F;&#x975E;&#x7EAF;&#x51FD;&#x6570;&#xFF1A;&#x5F15;&#x7528;&#x8BE5;&#x51FD;&#x6570;&#x4E0D;&#x4EC5;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x503C;&#x3001;&#x8FD8;&#x5BF9;&#x51FD;&#x6570;&#x672C;&#x8EAB;&#x6709;&#x526F;&#x4F5C;&#x7528;&#x3002;</p>
<p>&#x2003;&#x2003;&#x4E3A;&#x4E86;&#x5B9E;&#x73B0;<code>withdraw</code>&#xFF0C;&#x5B83;&#x8FD8;&#x9700;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x521D;&#x59CB;&#x7684;&#x94F6;&#x884C;&#x8D26;&#x6237;&#xFF0C;&#x6211;&#x4EEC;&#x7528;&#x9AD8;&#x9636;&#x51FD;&#x6570;<code>make_withdraw</code>&#x6765;&#x5B9E;&#x73B0;&#x8FD9;&#x4E00;&#x529F;&#x80FD;&#xFF0C;&#x8BA9;<code>withdraw</code>&#x4F5C;&#x4E3A;&#x8FD4;&#x56DE;&#x7684;&#x51FD;&#x6570;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">make_withdraw</span>(<span class="params">balance</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">withdraw</span>(<span class="params">amount</span>):</span><br><span class="line">        <span class="keyword">nonlocal</span> balance</span><br><span class="line">        <span class="keyword">if</span>(amount&gt;balance):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&apos;Not enough&apos;</span></span><br><span class="line">        balance=balance-amount</span><br><span class="line">        <span class="keyword">return</span> balance</span><br><span class="line">    <span class="keyword">return</span> withdraw</span><br><span class="line"></span><br><span class="line">wd=make_withdraw(<span class="number">20</span>)</span><br><span class="line">wd(<span class="number">5</span>)</span><br><span class="line">wd(<span class="number">3</span>)</span><br></pre></td></tr></table></figure> &#x2003;&#x2003;&#x5BF9;&#x8BE5;&#x51FD;&#x6570;&#x7684;&#x6846;&#x67B6;&#x5206;&#x6790;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>&#x7B2C;&#x4E00;&#x4E2A;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;&#x5C06;<code>make_withdraw</code>&#x4E0E;&#x5168;&#x5C40;&#x6846;&#x67B6;&#x7ED1;&#x5B9A;&#x3002;</li>
<li>&#x7B2C;&#x4E8C;&#x4E2A;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;&#x662F;&#x5C40;&#x90E8;&#x5B9A;&#x4E49;&#x7684;&#xFF0C;&#x5C06;<code>withdraw</code>&#x4E0E;&#x5C40;&#x90E8;&#x6846;&#x67B6;&#x7ED1;&#x5B9A;&#x3002;</li>
<li>&#x6BCF;&#x6B21;&#x8C03;&#x7528;<code>wd</code>&#xFF0C;&#x90FD;&#x4F1A;<strong>&#x521B;&#x9020;&#x51FA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x5C40;&#x90E8;&#x6846;&#x67B6;</strong>&#x3002;</li>
</ul>
<p>&#x2003;&#x2003;&#x800C;&#x5BF9;&#x4E8E;<code>balance</code>,&#x5728;&#x6267;&#x884C;<code>nonlocal</code>&#x8BED;&#x53E5;&#x540E;&#xFF0C;<strong>&#x4EFB;&#x4F55;<code>balance</code>&#x5728;&#x5DE6;&#x4FA7;&#x7684;&#x8D4B;&#x503C;&#x8BED;&#x53E5;&#x90FD;&#x4E0D;&#x4F1A;&#x5C06;<code>balance</code>&#x4E0E;&#x5F53;&#x524D;&#x6846;&#x67B6;&#x7ED1;&#x5B9A;&#x3002;&#x76F8;&#x53CD;&#x5730;&#xFF0C;&#x5B83;&#x4F1A;&#x53BB;&#x5BFB;&#x627E;<code>balance</code>&#x5DF2;&#x7ECF;&#x88AB;&#x5B9A;&#x4E49;&#x7684;&#x6846;&#x67B6;&#xFF0C;&#x5E76;&#x628A;<code>balance</code>&#x4E0E;&#x8BE5;&#x6846;&#x67B6;&#x7ED1;&#x5B9A;&#x3002;</strong>&#x800C;&#x5F53;<code>balance</code>&#x8FD8;&#x6CA1;&#x88AB;&#x8D4B;&#x8FC7;&#x4E00;&#x4E2A;&#x503C;&#xFF0C;<code>nonlocal</code>&#x8BED;&#x53E5;&#x4FBF;&#x4F1A;&#x62A5;&#x9519;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5728;&#x5148;&#x524D;&#x5BF9;&#x5D4C;&#x5957;&#x51FD;&#x6570;&#x7684;&#x5B66;&#x4E60;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x4E00;&#x4E2A;&#x5C40;&#x90E8;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x8C03;&#x7528;&#x5C40;&#x90E8;&#x6846;&#x67B6;&#x4EE5;&#x5916;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x5E76;&#x4E0D;&#x9700;&#x8981;<code>nonlocal</code>&#x8BED;&#x53E5;&#x3002;&#x4F46;<strong>&#x53EA;&#x6709;<code>nonlocal</code>&#x53EF;&#x4EE5;&#x8BA9;&#x5C40;&#x90E8;&#x51FD;&#x6570;&#x6539;&#x53D8;&#x540D;&#x79F0;&#x7ED1;&#x5B9A;&#x7684;&#x6846;&#x67B6;</strong>&#x3002;</p>
<h3 id="2python&#x7684;&#x8BED;&#x8A00;&#x7279;&#x6027;">2.<span class="math inline">\(python\)</span>&#x7684;&#x8BED;&#x8A00;&#x7279;&#x6027;</h3>
<p>&#x2003;&#x2003;&#x4E0A;&#x9762;&#x8BF4;&#x5230;&#x7684;<code>nonlocal</code>&#x8BED;&#x53E5;&#x662F;<span class="math inline">\(python\)</span>&#x9AD8;&#x9636;&#x51FD;&#x6570;&#x4E0E;&#x8BCD;&#x6CD5;&#x8303;&#x56F4;&#x7684;&#x7279;&#x6027;&#x3002;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;<code>nonlocal</code>&#x8BED;&#x53E5;&#x7ECF;&#x5E38;&#x662F;&#x5176;&#x5B83;&#x7F16;&#x7A0B;&#x8BED;&#x8A00;&#x7684;&#x9ED8;&#x8BA4;&#x884C;&#x4E3A;&#x3002;</p>
<p>&#x2003;&#x2003;<span class="math inline">\(python\)</span>&#x8BED;&#x53E5;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x9650;&#x5236;&#xFF1A;<strong>&#x5728;&#x51FD;&#x6570;&#x4F53;&#x5185;&#x90E8;&#xFF0C;&#x6240;&#x6709;&#x540D;&#x5B57;(<span class="math inline">\(name\)</span>)&#x7684;&#x5B9E;&#x4F8B;&#x5FC5;&#x987B;&#x5904;&#x4E8E;&#x540C;&#x4E00;&#x6846;&#x67B6;</strong>&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5728;<span class="math inline">\(python\)</span>&#x4E2D;&#xFF0C;&#x4E00;&#x4E2A;&#x5C40;&#x90E8;&#x51FD;&#x6570;&#x4E0D;&#x80FD;&#x5728;&#x975E;&#x5C40;&#x90E8;&#x6846;&#x67B6;&#x4E2D;&#x67E5;&#x8BE2;&#x4E00;&#x4E2A;&#x540D;&#x5B57;&#x7684;&#x503C;&#x3001;&#x7136;&#x540E;&#x5C06;&#x5176;&#x7ED1;&#x5B9A;&#x5230;&#x5C40;&#x90E8;&#x6846;&#x67B6;&#x4E2D;&#xFF0C;&#x5426;&#x5219;&#x4E00;&#x4E2A;&#x540D;&#x5B57;&#x5C31;&#x5C5E;&#x4E8E;&#x4E24;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x6846;&#x67B6;&#x4E86;&#x3002;&#x8FD9;&#x4E2A;&#x9650;&#x5236;&#x5141;&#x8BB8;<span class="math inline">\(Python\)</span>&#x5728;&#x6267;&#x884C;&#x51FD;&#x6570;&#x4F53;&#x4E4B;&#x524D;&#x9884;&#x5148;&#x8BA1;&#x7B97;&#x5305;&#x542B;&#x6BCF;&#x4E2A;&#x540D;&#x79F0;&#x7684;&#x6846;&#x67B6;&#x3002;</p>
<p>&#x2003;&#x2003;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x8BF4;&#x660E;&#x4E86;<span class="math inline">\(python\)</span>&#x7684;&#x8FD9;&#x4E00;&#x7279;&#x6027;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">make_withdraw</span>(<span class="params">balance</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">withdraw</span>(<span class="params">amount</span>):</span><br><span class="line">        <span class="keyword">if</span> amount &gt; balance:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&apos;Insufficient funds&apos;</span></span><br><span class="line">            balance = balance - amount</span><br><span class="line">            <span class="keyword">return</span> balance</span><br><span class="line">        <span class="keyword">return</span> withdraw</span><br><span class="line"></span><br><span class="line">wd = make_withdraw(<span class="number">20</span>)</span><br><span class="line">wd(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;UnboundLocalError: local variable <span class="string">&apos;balance&apos;</span> referenced before assignment</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5728;<code>withdraw</code>&#x4E2D;&#xFF0C;&#x539F;&#x672C;&#x5904;&#x4E8E;<code>make_withdraw</code>&#x6846;&#x67B6;&#x4E2D;&#x7684;<code>balance</code>&#x5728;&#x5C40;&#x90E8;&#x6846;&#x67B6;&#x4E2D;&#x88AB;&#x8D4B;&#x503C;&#xFF0C;&#x8FDD;&#x53CD;&#x4E86;<span class="math inline">\(python\)</span>&#x7684;&#x9650;&#x5236;&#x3002;</p>
<h3 id="3nonlocal&#x7684;&#x597D;&#x5904;">3.<code>nonlocal</code>&#x7684;&#x597D;&#x5904;</h3>
<p>&#x2003;&#x2003;<code>nonlocal</code>&#x8BED;&#x53E5;&#x662F;&#x6211;&#x4EEC;<strong>&#x5C06;&#x7A0B;&#x5E8F;&#x89C6;&#x4E3A;&#x76F8;&#x4E92;&#x4EA4;&#x4E92;&#x800C;&#x5F7C;&#x6B64;&#x72EC;&#x7ACB;&#x7684;&#x96C6;&#x5408;</strong>&#x7684;&#x91CD;&#x8981;&#x6B65;&#x9AA4;&#x3002;</p>
<p>&#x2003;&#x2003;&#x7279;&#x522B;&#x5730;&#xFF0C;<code>nonlocal</code>&#x8BED;&#x53E5;&#x8BA9;&#x6211;&#x4EEC;<strong>&#x80FD;&#x591F;&#x7EF4;&#x62A4;&#x90A3;&#x4E9B;&#x5C5E;&#x4E8E;&#x67D0;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x5C40;&#x90E8;&#x6846;&#x67B6;&#x3001;&#x4F46;&#x968F;&#x7740;&#x8C03;&#x7528;&#x4E0D;&#x65AD;&#x66F4;&#x65B0;&#x7684;&#x72B6;&#x6001;&#x3002;</strong>&#x50CF;&#x4E0A;&#x9762;&#x7684;&#x4E0E;<code>withdraw</code>&#x8054;&#x7CFB;&#x7684;<code>balance</code>&#x5728;&#x5BF9;<code>withdraw</code>&#x7684;&#x591A;&#x6B21;&#x8C03;&#x7528;&#x4E2D;&#x5F97;&#x5230;&#x5171;&#x4EAB;&#x3002;&#x4F46;&#x662F;&#xFF0C;<strong>&#x8FD9;&#x4E2A;<code>balance</code>&#x4E0E;<code>withdraw</code>&#x7684;&#x8054;&#x7CFB;&#x5BF9;&#x51FD;&#x6570;&#x7684;&#x5176;&#x5B83;&#x90E8;&#x5206;&#x662F;&#x4E0D;&#x53EF;&#x8BBF;&#x95EE;&#x7684;&#x3001;&#x4EC5;&#x5BF9;<code>wd</code>&#x751F;&#x6548;&#x3002;</strong>&#x5F53;&#x6211;&#x4EEC;&#x518D;&#x6B21;&#x8C03;&#x7528;<code>make_withdraw</code>&#x540E;&#xFF0C;&#x5B83;&#x4F1A;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;&#x6846;&#x67B6;&#xFF0C;&#x4E0E;&#x4E00;&#x4E2A;&#x8DDF;&#x65B0;&#x7684;<code>balance</code>&#x7684;&#x72EC;&#x7279;&#x7684;&#x8054;&#x7CFB;&#x3002;</p>
<p>&#x2003;&#x2003;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x5BF9;&#x539F;&#x6765;&#x4F8B;&#x5B50;&#x7684;&#x62D3;&#x5C55;&#x5F88;&#x597D;&#x5730;&#x8BF4;&#x660E;&#x4E86;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">make_withdraw</span>(<span class="params">balance</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">withdraw</span>(<span class="params">amount</span>):</span><br><span class="line">         <span class="keyword">nonlocal</span> balance</span><br><span class="line">         <span class="keyword">if</span> amount &gt; balance:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&apos;Insufficient funds&apos;</span></span><br><span class="line">        balance = balance - amount</span><br><span class="line">        <span class="keyword">return</span> balance</span><br><span class="line">    <span class="keyword">return</span> withdraw</span><br><span class="line"></span><br><span class="line">wd = make_withdraw(<span class="number">20</span>)</span><br><span class="line">wd2 = make_withdraw(<span class="number">7</span>)</span><br><span class="line">wd2(<span class="number">6</span>)</span><br><span class="line">&gt;&gt;&gt;<span class="number">1</span></span><br><span class="line">wd(<span class="number">8</span>)</span><br><span class="line">&gt;&gt;&gt;<span class="number">12</span></span><br></pre></td></tr></table></figure>
&#x2003;&#x2003;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;&#x65B9;&#x5F0F;&#xFF0C;<strong>&#x6BCF;&#x4E2A;<code>withdraw</code>&#x7684;&#x5B9E;&#x4F8B;(<code>instance</code>)&#x90FD;&#x7EF4;&#x62A4;&#x4E86;&#x81EA;&#x5DF1;&#x72EC;&#x6709;&#x7684;<code>balance</code>&#x503C;&#xFF0C;&#x5E76;&#x4E14;&#x8FD9;&#x4E2A;&#x503C;&#x5BF9;&#x5176;&#x5B83;&#x51FD;&#x6570;&#x800C;&#x8A00;&#x662F;&#x4E0D;&#x53EF;&#x8BBF;&#x95EE;&#x7684;&#x3002;</strong>&#x8FD9;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x5B8C;&#x5168;&#x72EC;&#x7ACB;&#x7684;<span class="math inline">\(bank\;account\)</span>&#x5BF9;&#x8C61;&#x3002;</p>
<h3 id="4&#x5173;&#x4E8E;&#x76F8;&#x7B49;same&#x7684;&#x601D;&#x8003;">4.&#x5173;&#x4E8E;&#x76F8;&#x7B49;(<span class="math inline">\(same\)</span>)&#x7684;&#x601D;&#x8003;</h3>
<p>&#x2003;&#x2003;&#x5BF9;&#x4E8E;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x4EE5;&#x4E0A;&#x9762;&#x7684;<code>make_withdraw</code>&#x4E3A;&#x4F8B;&#xFF0C;<code>wd</code>&#x4E0E;<code>wd2</code>&#x7ED1;&#x5B9A;&#x7684;&#x90FD;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x51FD;&#x6570;<code>make_withdraw</code>&#xFF0C;&#x4F46;&#x662F;&#x4E24;&#x8005;&#x662F;&#x5426;&#x76F8;&#x7B49;&#x5462;&#xFF1F;&#x7531;&#x4E0A;&#x8FF0;&#x8BA8;&#x8BBA;&#x77E5;&#x4E24;&#x8005;&#x5E76;&#x4E0D;&#x76F8;&#x7B49;&#x3002;&#x4F46;&#x5BF9;&#x4E8E;&#x4EE5;&#x4E0B;&#x4F8B;&#x5B50;&#xFF0C;&#x4E24;&#x8005;&#x5C31;&#x53D8;&#x6210;&#x5B8C;&#x5168;&#x76F8;&#x7B49;&#x7684;&#x4E86;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">make_withdraw</span>(<span class="params">balance</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">withdraw</span>(<span class="params">amount</span>):</span><br><span class="line">        <span class="keyword">nonlocal</span> balance</span><br><span class="line">        <span class="keyword">if</span> amount &gt; balance:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&apos;Insufficient funds&apos;</span></span><br><span class="line">        balance = balance - amount</span><br><span class="line">        <span class="keyword">return</span> balance</span><br><span class="line">    <span class="keyword">return</span> withdraw</span><br><span class="line"></span><br><span class="line">wd = make_withdraw(<span class="number">12</span>)</span><br><span class="line">wd2 = wd</span><br><span class="line">wd2(<span class="number">1</span>)</span><br><span class="line">&gt;&gt;&gt;<span class="number">11</span></span><br><span class="line">wd(<span class="number">1</span>)</span><br><span class="line">&gt;&gt;&gt;<span class="number">10</span></span><br></pre></td></tr></table></figure>
&#x2003;&#x2003;&#x8FD9;&#x65F6;&#xFF0C;<code>make_withdraw</code>&#x7684;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#x88AB;&#x4E24;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x540D;&#x5B57;<code>wd</code>&#x548C;<code>wd2</code>&#x6240;&#x8868;&#x793A;&#xFF0C;&#x8FD9;&#x662F;&#x5F88;&#x4E0D;&#x5BFB;&#x5E38;&#x7684;&#x3002;&#x800C;&#x5206;&#x6790;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x7684;&#x5173;&#x952E;&#x5728;&#x4E8E;<strong>&#x53EA;&#x6709;&#x8C03;&#x7528;&#x51FD;&#x6570;&#x624D;&#x53EF;&#x4EE5;&#x5F15;&#x5165;&#x65B0;&#x7684;&#x6846;&#x67B6;&#xFF0C;&#x5E76;&#x4E14;&#x8D4B;&#x503C;&#x8BED;&#x53E5;&#x53EA;&#x4F1A;&#x6539;&#x53D8;&#x73B0;&#x6709;&#x6846;&#x67B6;&#x4E2D;&#x7684;&#x7ED1;&#x5B9A;&#x5173;&#x7CFB;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x8FD9;&#x5F15;&#x53D1;&#x4E86;&#x5BF9;&#x201C;&#x76F8;&#x7B49;&#x201D;&#x7684;&#x8BA8;&#x8BBA;&#x3002;&#x5728;&#x5148;&#x524D;&#x5BF9;<code>rational number</code>&#x7684;&#x5B9A;&#x4E49;&#x4E2D;&#xFF0C;&#x53EA;&#x8981;&#x5206;&#x5B50;&#x5206;&#x6BCD;&#x76F8;&#x7B49;&#x7684;&#x6570;&#x5C31;&#x662F;&#x76F8;&#x7B49;&#x7684;&#xFF1B;&#x4F46;&#x5982;&#x4ECA;&#xFF0C;<code>rational number</code>&#x53C8;&#x6709;&#x4E86;&#x4E0E;&#x5176;&#x6240;&#x5728;&#x6846;&#x67B6;&#x76F8;&#x5173;&#x7684;&#x5C5E;&#x6027;&#x2014;&#x2014;<code>identity</code>&#x3002;&#x800C;&#x5BF9;&#x4E8E;&#x4E0A;&#x9762;<span class="math inline">\(account\)</span>&#x7684;&#x4F8B;&#x5B50;&#xFF0C;<code>wd2</code>&#x4E0E;<code>wd</code>&#x7684;&#x503C;&#x5E76;&#x4E0D;&#x76F8;&#x540C;&#xFF0C;&#x4F46;&#x5B83;&#x4EEC;&#x662F;&#x540C;&#x4E00;&#x4E2A;<span class="math inline">\(account\)</span>&#x3002;&#x8FD9;&#x4E00;&#x5DEE;&#x5F02;&#x8BA9;&#x7A0B;&#x5E8F;&#x8BBE;&#x8BA1;&#x53D8;&#x5F97;&#x66F4;&#x4E3A;&#x590D;&#x6742;&#x3002;</p>
<h2 id="&#x4E94;-&#x5BF9;&#x8C61;&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x4EE5;&#x5217;&#x8868;&#x4E0E;&#x5B57;&#x5178;&#x4E3A;&#x4F8B;">&#x4E94;&#x3001;&#x5BF9;&#x8C61;&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x2014;&#x2014;&#x4EE5;&#x5217;&#x8868;&#x4E0E;&#x5B57;&#x5178;&#x4E3A;&#x4F8B;</h2>
<h3 id="1&#x5217;&#x8868;&#x7684;&#x5B9E;&#x73B0;">1.&#x5217;&#x8868;&#x7684;&#x5B9E;&#x73B0;</h3>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x5C06;&#x7528;&#x4E00;&#x4E2A;&#x4EE5;&#x94FE;&#x8868;&#x4F5C;&#x4E3A;&#x5C40;&#x90E8;&#x72B6;&#x6001;&#x7684;&#x51FD;&#x6570;&#x4EE3;&#x8868;&#x53EF;&#x53D8;&#x5217;&#x8868;&#xFF0C;&#x5148;&#x8003;&#x8651;&#x4E0B;&#x9762;&#x8FD9;&#x4E9B;&#x57FA;&#x672C;&#x7684;&#x8BBE;&#x8BA1;&#xFF1A;</p>
<ul>
<li><strong>&#x5177;&#x6709;&#x4E0E;&#x6846;&#x67B6;&#x76F8;&#x5173;&#x7684;&#x5C5E;&#x6027;&#x2014;&#x2014;<code>identity</code></strong>&#xFF0C;&#x50CF;&#x666E;&#x901A;&#x7684;&#x53EF;&#x53D8;&#x5217;&#x8868;&#x4E00;&#x6837;&#x3002;</li>
<li>&#x4E0D;&#x80FD;&#x7528;<code>None</code>&#x8868;&#x793A;&#x7A7A;&#x5217;&#x8868;&#xFF0C;&#x56E0;&#x4E3A;&#x4E24;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x7A7A;&#x5217;&#x8868;&#x4E0D;&#x662F;&#x76F8;&#x7B49;&#x7684;&#x503C;&#xFF0C;&#x4F46;<code>None is None</code>&#x3002;&#x800C;<code>empty</code>&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;<code>identity</code>&#x5C5E;&#x6027;&#x3002;</li>
</ul>
<p>&#x2003;&#x2003;&#x65E2;&#x7136;&#x662F;&#x7528;&#x51FD;&#x6570;&#x5B9E;&#x73B0;&#xFF0C;&#x90A3;&#x4E48;&#x5E94;&#x8BE5;&#x7528;&#x4EC0;&#x4E48;&#x4F5C;&#x4E3A;&#x51FD;&#x6570;&#x7684;&#x53C2;&#x6570;&#x5462;&#xFF1F;&#x8BE5;&#x95EE;&#x9898;&#x7684;&#x7B54;&#x6848;&#x63ED;&#x793A;&#x4E86;&#x7F16;&#x7A0B;&#x4E2D;&#x7684;&#x4E00;&#x822C;&#x6A21;&#x5F0F;&#xFF1A;</p>
<h4 id="a&#x5206;&#x6D3E;&#x51FD;&#x6570;dispatchfunction">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&#x5206;&#x6D3E;&#x51FD;&#x6570;(<span class="math inline">\(dispatch\;function\)</span>)</h4>
<p>&#x2003;&#x2003;&#x5206;&#x6D3E;&#x51FD;&#x6570;&#x7684;<strong>&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x662F;<code>message</code>&#x2014;&#x2014;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x7528;&#x4E8E;&#x6307;&#x6325;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x8BE5;&#x8C03;&#x7528;&#x54EA;&#x4E2A;&#x65B9;&#x6CD5;</strong>&#xFF1B;&#x5176;&#x4F59;&#x53C2;&#x6570;&#x662F;&#x5404;&#x4E2A;&#x65B9;&#x6CD5;&#x9700;&#x8981;&#x7684;&#x53C2;&#x6570;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5206;&#x6D3E;&#x51FD;&#x6570;&#x5B9E;&#x9645;&#x4E0A;&#x662F;<strong>&#x591A;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x96C6;&#x6210;&#x4F53;</strong>&#xFF1A;<code>message</code>&#x53C2;&#x6570;&#x51B3;&#x5B9A;&#x4E86;&#x51FD;&#x6570;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x5176;&#x4F59;&#x53C2;&#x6570;&#x5219;&#x5728;&#x8FD9;&#x4E2A;&#x884C;&#x4E3A;&#x4E2D;&#x88AB;&#x8C03;&#x7528;:
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">mutable_link</span>():</span><br><span class="line">    contents=empty</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dispatch</span>(<span class="params">message,value=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="keyword">nonlocal</span> contents</span><br><span class="line">        <span class="keyword">if</span> messages==<span class="string">&apos;len&apos;</span>:</span><br><span class="line">            <span class="keyword">return</span> len_link(contents)</span><br><span class="line">        <span class="keyword">elif</span> messages==<span class="string">&apos;getitem&apos;</span>:</span><br><span class="line">            <span class="keyword">return</span> getitem_link(contents,value)</span><br><span class="line">        <span class="keyword">elif</span> messages==<span class="string">&apos;push_first&apos;</span>:</span><br><span class="line">            contents=link(value,contens)</span><br><span class="line">        <span class="keyword">elif</span> message==<span class="string">&apos;pop_first&apos;</span>:</span><br><span class="line">            f=first(contents)</span><br><span class="line">            contents=rest(contens)</span><br><span class="line">            <span class="keyword">return</span> f</span><br><span class="line">        <span class="keyword">elif</span> message==<span class="string">&apos;str&apos;</span>:</span><br><span class="line">            <span class="keyword">return</span> join_link(contents,<span class="string">&quot;,&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> dispatch</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5C06;<span class="math inline">\(python\)</span>&#x5185;&#x7F6E;&#x7684;&#x5E8F;&#x5217;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x8868;&#x793A;&#x4E3A;<code>mutable_list</code>&#x7C7B;&#x578B;&#x7684;&#x51FD;&#x6570;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">to_mutable_link</span>(<span class="params">source</span>):</span><br><span class="line">    s=multible_link()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> reverse(source):</span><br><span class="line">        s(<span class="string">&apos;push_first&apos;</span>,i)</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = to_mutable_link(suits)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(s)</span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">&apos;function&apos;</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(s(<span class="string">&apos;str&apos;</span>))</span><br><span class="line">heart, diamond, spade, club</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s(<span class="string">&apos;pop_first&apos;</span>)</span><br><span class="line"><span class="string">&apos;heart&apos;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(s(<span class="string">&apos;str&apos;</span>))</span><br><span class="line">diamond, spade, club</span><br></pre></td></tr></table></figure>
&#x2003;&#x2003;&#x8FD9;&#x6837;&#xFF0C;<code>mutable list</code>&#x7684;&#x5C01;&#x88C5;&#x5C31;&#x5B8C;&#x6210;&#x4E86;&#x3002;&#x8FD9;&#x79CD;<strong>&#x901A;&#x8FC7;&#x5728;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x5185;&#x5C01;&#x88C5;&#x5BF9;&#x67D0;&#x4E2A;&#x6570;&#x636E;&#x503C;&#x7684;&#x6240;&#x6709;&#x64CD;&#x4F5C;&#x7684;&#x65B9;&#x6CD5;&#x88AB;&#x79F0;&#x4F5C;&#x4FE1;&#x606F;&#x4F20;&#x9012;&#x539F;&#x5219;(<span class="math inline">\(message\;passing\)</span>)&#x3002;&#x4E00;&#x4E2A;&#x8FD0;&#x7528;&#x4FE1;&#x606F;&#x4F20;&#x9012;&#x539F;&#x5219;&#x7684;&#x51FD;&#x6570;&#x4F1A;&#x5B9A;&#x4E49;&#x5206;&#x6D3E;&#x51FD;&#x6570;&#x3001;&#x5E76;&#x901A;&#x8FC7;&#x4F20;&#x9012;<code>message</code>&#x6765;&#x7EC4;&#x7EC7;&#x8BA1;&#x7B97;</strong>&#x3002;</p>
<h3 id="2&#x5B57;&#x5178;&#x7684;&#x5B9E;&#x73B0;">2.&#x5B57;&#x5178;&#x7684;&#x5B9E;&#x73B0;</h3>
<p>&#x2003;&#x2003;&#x5229;&#x7528;&#x4E0A;&#x9762;&#x7684;&#x903B;&#x8F91;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x5B57;&#x5178;&#x7684;&#x5C01;&#x88C5;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">dictionart</span>():</span><br><span class="line">    records=[]</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">getitem</span>(<span class="params">key</span>):</span><br><span class="line">        matches=[r <span class="keyword">for</span> r <span class="keyword">in</span> records <span class="keyword">if</span> r[<span class="number">0</span>]==key]:</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">len</span>(matches)==<span class="number">1</span>):</span><br><span class="line">            key,value=matches[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">return</span> value</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">setitem</span>(<span class="params">key,value</span>):</span><br><span class="line">        <span class="keyword">nonlocal</span> records</span><br><span class="line">        non_matches=[r <span class="keyword">for</span> r <span class="keyword">in</span> records <span class="keyword">if</span> r[<span class="number">0</span>]!=key]</span><br><span class="line">        records=non_matches+[[key,value]]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dispatch</span>(<span class="params">message,key=<span class="literal">None</span>,value=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="keyword">if</span> message==<span class="string">&apos;getitem&apos;</span>:</span><br><span class="line">            <span class="keyword">return</span> getitem(key)</span><br><span class="line">        <span class="keyword">elif</span> message==<span class="string">&apos;setitem&apos;</span>:</span><br><span class="line">            setitem(key,value)</span><br><span class="line">    <span class="keyword">return</span> dispatch</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = dictionary()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d(<span class="string">&apos;setitem&apos;</span>, <span class="number">3</span>, <span class="number">9</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d(<span class="string">&apos;setitem&apos;</span>, <span class="number">4</span>, <span class="number">16</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d(<span class="string">&apos;getitem&apos;</span>, <span class="number">3</span>)</span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d(<span class="string">&apos;getitem&apos;</span>, <span class="number">4</span>)</span><br><span class="line"><span class="number">16</span></span><br></pre></td></tr></table></figure></p>
<h2 id="&#x516D;-&#x5206;&#x6D3E;&#x5B57;&#x5178;dispatchdictionary">&#x516D;&#x3001;&#x5206;&#x6D3E;&#x5B57;&#x5178;(<span class="math inline">\(dispatch\;dictionary\)</span>)</h2>
<h3 id="1&#x5206;&#x6D3E;&#x5B57;&#x5178;&#x7684;&#x6982;&#x5FF5;">1.&#x5206;&#x6D3E;&#x5B57;&#x5178;&#x7684;&#x6982;&#x5FF5;</h3>
<p>&#x2003;&#x2003;&#x5206;&#x6D3E;&#x51FD;&#x6570;&#x662F;&#x62BD;&#x8C61;&#x6570;&#x636E;&#x4F20;&#x9012;&#x63A5;&#x53E3;&#x7684;&#x4E00;&#x79CD;&#x901A;&#x7528;&#x65B9;&#x6CD5;&#xFF0C;&#x800C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;<strong>&#x7528;&#x5B57;&#x5178;&#x8FD9;&#x79CD;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x6765;&#x5B9E;&#x73B0;&#x5206;&#x6D3E;&#x51FD;&#x6570;&#x7684;&#x5206;&#x6D3E;&#x529F;&#x80FD;</strong>&#x3002;</p>
<h3 id="2&#x5206;&#x6D3E;&#x5B57;&#x5178;&#x7684;&#x5B9E;&#x73B0;">2.&#x5206;&#x6D3E;&#x5B57;&#x5178;&#x7684;&#x5B9E;&#x73B0;</h3>
<p>&#x2003;&#x2003;&#x4EE5;&#x5148;&#x524D;&#x7684;<span class="math inline">\(account\)</span>&#x4E3A;&#x4F8B;&#xFF0C;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x53EF;&#x53D8;&#x6570;&#x636E;&#x7C7B;&#x578B;<code>account</code>&#xFF0C;&#x5B83;&#x7531;<span class="math inline">\(constructor\)</span><code>account</code>&#x4E0E;<span class="math inline">\(selector\)</span><code>check_balance</code>&#x7EC4;&#x6210;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">account</span>(<span class="params">initial_balance</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">deposit</span>(<span class="params">amount</span>):</span><br><span class="line">        dispatch[<span class="string">&apos;balance&apos;</span>]+=amount</span><br><span class="line">        <span class="keyword">return</span> dispatch[<span class="string">&apos;balance&apos;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">withdraw</span>(<span class="params">amount</span>):</span><br><span class="line">        <span class="keyword">if</span> amount&gt;dispatch[<span class="string">&apos;balance&apos;</span>]:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&apos;Insufficient funds&apos;</span></span><br><span class="line">        dispatch[<span class="string">&apos;balance&apos;</span>]-=amount</span><br><span class="line">        <span class="keyword">return</span> dispatch[<span class="string">&apos;balance&apos;</span>]</span><br><span class="line"></span><br><span class="line">    dispatch={<span class="string">&apos;deposit&apos;</span>:deposit,<span class="string">&apos;withdraw&apos;</span>:withdraw,<span class="string">&apos;balance&apos;</span>:initial_balance}</span><br><span class="line">    <span class="keyword">return</span> dispatch</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">withdraw</span>(<span class="params">account,amount</span>):</span><br><span class="line">    <span class="keyword">return</span> account[<span class="string">&apos;withdraw&apos;</span>](amount)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">deposit</span>(<span class="params">account,amount</span>):</span><br><span class="line">    <span class="keyword">return</span> account[<span class="string">&apos;deposit&apos;</span>](amount)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_balance</span>(<span class="params">account</span>):</span><br><span class="line">    <span class="keyword">return</span> account[<span class="string">&apos;balance&apos;</span>]</span><br><span class="line"></span><br><span class="line">a=account(<span class="number">20</span>)</span><br><span class="line">deposit(a,<span class="number">5</span>)</span><br><span class="line">withdraw(a,<span class="number">17</span>)</span><br><span class="line">check_balance(a)</span><br><span class="line">&gt;&gt;&gt;<span class="number">8</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5728;&#x8FD9;&#x91CC;&#xFF0C;&#x6211;&#x4EEC;<strong>&#x901A;&#x8FC7;&#x628A;<code>balance</code>&#x5B58;&#x50A8;&#x5728;&#x5B57;&#x5178;&#x4E2D;&#x800C;&#x975E;&#x76F4;&#x63A5;&#x5B58;&#x50A8;&#x5728;<code>account</code>&#x6846;&#x67B6;&#x91CC;&#xFF0C;&#x907F;&#x514D;&#x4E86;&#x4F7F;&#x7528;<code>nonlocal</code>&#x8BED;&#x53E5;</strong>&#x3002;</p>
<h2 id="&#x4E03;-&#x7EA6;&#x675F;&#x4F20;&#x9012;propagatingconstraints">&#x4E03;&#x3001;&#x7EA6;&#x675F;&#x4F20;&#x9012;(<span class="math inline">\(propagating\;constraints\)</span>)</h2>
<h3 id="1&#x65B0;&#x7684;&#x62BD;&#x8C61;&#x7CFB;&#x7EDF;&#x57FA;&#x4E8E;&#x7EA6;&#x675F;&#x7684;&#x7CFB;&#x7EDF;constraint-basedsystem">1.&#x65B0;&#x7684;&#x62BD;&#x8C61;&#x7CFB;&#x7EDF;&#x2014;&#x2014;&#x57FA;&#x4E8E;&#x7EA6;&#x675F;&#x7684;&#x7CFB;&#x7EDF;(<span class="math inline">\(constraint-based\;system\)</span>)</h3>
<p>&#x2003;&#x2003;&#x53EF;&#x6539;&#x53D8;&#x6570;&#x636E;<strong>&#x5141;&#x8BB8;&#x6211;&#x4EEC;&#x6A21;&#x62DF;&#x968F;&#x65F6;&#x6539;&#x53D8;&#x7684;&#x7CFB;&#x7EDF;</strong>&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x4E3A;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x4E86;&#x65B0;&#x7684;&#x62BD;&#x8C61;&#x65B9;&#x6CD5;&#x3002;&#x4E0B;&#x9762;&#x4ECB;&#x7ECD;&#x5229;&#x7528;<code>nonlocal</code>&#x8D4B;&#x503C;&#x3001;<span class="math inline">\(list\)</span>&#x3001;&#x5B57;&#x5178;&#x642D;&#x5EFA;&#x7684;&#x57FA;&#x4E8E;&#x7EA6;&#x675F;&#x5668;&#x7684;&#x7CFB;&#x7EDF;&#x3002;&#x8FD9;&#x662F;&#x58F0;&#x660E;&#x5F0F;&#x7F16;&#x7A0B;(<span class="math inline">\(declarative\;programming\)</span>)&#x7684;&#x91CD;&#x8981;&#x90E8;&#x5206;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5728;&#x8FD9;&#x4E2A;&#x7CFB;&#x7EDF;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;<strong>&#x7A0B;&#x5E8F;&#x8868;&#x8FBE;&#x4E3A;&#x7EA6;&#x675F;(<span class="math inline">\(constraint\)</span>)</strong>&#xFF0C;&#x786E;&#x5B9A;&#x5F85;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#x7684;&#x7ED3;&#x6784;&#xFF0C;&#x4F46;&#x5C06;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#x7684;&#x7EC6;&#x8282;&#x8FDB;&#x884C;&#x62BD;&#x8C61;&#x3002;</p>
<p>&#x2003;&#x2003;&#x8FD9;&#x4E2A;&#x7CFB;&#x7EDF;&#x7684;&#x5F15;&#x5165;&#x662F;&#x57FA;&#x4E8E;&#x8BA1;&#x7B97;&#x673A;&#x7A0B;&#x5E8F;&#x7684;&#x7279;&#x6027;&#x2014;&#x2014;<strong>&#x5355;&#x5411;&#x8BA1;&#x7B97;&#x6027;</strong>(<span class="math inline">\(one-directional\;computations\)</span>)&#x3002;&#x5728;&#x8BA1;&#x7B97;&#x673A;&#x7A0B;&#x5E8F;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x95EE;&#x9898;&#x62BD;&#x8C61;&#x4E3A;&#x4E00;&#x4E2A;&#x7CFB;&#x7EDF;&#xFF0C;&#x6A21;&#x62DF;&#x7CFB;&#x7EDF;&#x4E2D;&#x5404;&#x4E2A;&#x6570;&#x91CF;&#x7684;&#x5173;&#x7CFB;&#xFF0C;&#x5728;&#x7CFB;&#x7EDF;&#x4E2D;&#x4F20;&#x5165;&#x7ED9;&#x5B9A;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x7136;&#x540E;&#x8BA1;&#x7B97;&#x51FA;&#x60F3;&#x8981;&#x7684;&#x7B54;&#x6848;&#x3002;&#x4F46;&#x5F88;&#x591A;&#x4E8B;&#x7269;&#xFF0C;&#x5982;&#x4E0B;&#x9762;&#x7684;&#x516C;&#x5F0F;&#xFF0C;&#x5E76;&#x4E0D;&#x662F;&#x5355;&#x5411;&#x7684;&#xFF1A;</p>
<p><span class="math display">\[pV=nRT\]</span></p>
<p>&#x2003;&#x2003;&#x5728;&#x8FD9;&#x4E2A;&#x516C;&#x5F0F;&#x4E2D;&#xFF0C;&#x7ED9;&#x51FA;&#x4EFB;&#x610F;&#x56DB;&#x4E2A;&#x91CF;&#xFF0C;&#x663E;&#x7136;&#x53EF;&#x4EE5;&#x6C42;&#x51FA;&#x7B2C;&#x4E94;&#x4E2A;&#x91CF;&#x7684;&#x503C;&#x3002;&#x4F46;&#x5728;&#x8BA1;&#x7B97;&#x673A;&#x7A0B;&#x5E8F;&#x4E2D;&#xFF0C;&#x4E00;&#x4E2A;&#x8BBE;&#x8BA1;&#x597D;&#x7528;&#x6765;&#x6C42;&#x89E3;<span class="math inline">\(p\)</span>&#x7684;&#x7A0B;&#x5E8F;<strong>&#x7531;&#x4E8E;&#x53C2;&#x6570;&#x88AB;&#x56FA;&#x5B9A;&#x4E86;&#xFF0C;&#x5E76;&#x4E0D;&#x80FD;&#x7528;&#x4E8E;&#x6C42;&#x89E3;<span class="math inline">\(T\)</span>&#x6216;&#x5176;&#x4ED6;&#x91CF;</strong>&#xFF0C;&#x5373;&#x4F7F;&#x6211;&#x4EEC;&#x5DF2;&#x77E5;&#x5176;&#x4E2D;&#x56DB;&#x4E2A;&#x91CF;&#x3002;</p>
<p>&#x2003;&#x2003;&#x4E8E;&#x662F;&#x6211;&#x4EEC;&#x6784;&#x60F3;&#x4E00;&#x4E2A;&#x6A21;&#x62DF;&#x8FD9;&#x79CD;&#x7EBF;&#x6027;&#x5173;&#x7CFB;&#x7684;&#x6A21;&#x578B;&#x3002;&#x6211;&#x4EEC;&#x5148;&#x5B9A;&#x4E49;<strong>&#x4E00;&#x4E9B;&#x521D;&#x59CB;&#x7684;&#x7EA6;&#x675F;&#x5668;</strong>&#xFF0C;&#x4F8B;&#x5982;<strong>&#x52A0;&#x6CD5;&#x5668;</strong><code>adder(a,b,c)</code>&#xFF0C;&#x5B83;&#x5F3A;&#x5236;(<span class="math inline">\(enforce\)</span>)&#x4E86;&#x6570;&#x5B66;&#x7684;&#x52A0;&#x6CD5;&#x5173;&#x7CFB;<code>a+b=c</code>&#x3002;</p>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x518D;&#x5B9A;&#x4E49;&#x4E00;&#x79CD;&#x5408;&#x5E76;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x4F7F;&#x5F97;&#x521D;&#x59CB;&#x7684;&#x7EA6;&#x675F;&#x5668;&#x80FD;&#x88AB;&#x5408;&#x5E76;&#x4EE5;&#x8868;&#x8FBE;&#x66F4;&#x590D;&#x6742;&#x7684;&#x5173;&#x7CFB;&#x3002;&#x6211;&#x4EEC;<strong>&#x6784;&#x5EFA;&#x4E00;&#x4E2A;&#x7F51;&#x7EDC;(<span class="math inline">\(network\)</span>)&#xFF0C;&#x5728;&#x8FD9;&#x4E2A;&#x7F51;&#x7EDC;&#x4E2D;&#xFF0C;&#x7EA6;&#x675F;&#x5668;&#x88AB;&#x8FDE;&#x63A5;&#x5668;(<span class="math inline">\(connector\)</span>)&#x8FDE;&#x63A5;&#x5728;&#x4E00;&#x8D77;</strong>&#x3002;&#x8FDE;&#x63A5;&#x5668;<strong>&#x662F;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x9650;&#x5236;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x5B83;&#x81EA;&#x8EAB;&#x4F1A;&#x643A;&#x5E26;&#x4E00;&#x4E2A;&#x503C;</strong>&#x3002;&#x4F8B;&#x5982;&#x6444;&#x6C0F;&#x5EA6;&#x4E0E;&#x534E;&#x6C0F;&#x5EA6;&#x7684;&#x6362;&#x7B97;<span class="math inline">\(9\times
c=5\times(f-32)\)</span>&#x53EF;&#x8868;&#x793A;&#x4E3A;&#x5982;&#x4E0B;&#x7F51;&#x7EDC;&#xFF1A;</p>
<p><img src="/2024/05/31/2.4.%E5%8F%AF%E5%8F%98%E6%95%B0%E6%8D%AE/image-3.png"></p>
<p>&#x2003;&#x2003;&#x57FA;&#x4E8E;&#x8FD9;&#x4E2A;&#x7F51;&#x7EDC;&#x7684;&#x8BA1;&#x7B97;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>&#x5F53;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x5668;&#x88AB;&#x8D4B;&#x503C;&#xFF0C;&#x5B83;<strong>&#x4F1A;&#x5524;&#x9192;&#x6240;&#x6709;&#x4E0E;&#x5B83;&#x76F8;&#x8FDE;&#x7684;&#x7EA6;&#x675F;&#x5668;&#xFF0C;&#x544A;&#x8BC9;&#x5B83;&#x4EEC;&#x81EA;&#x5DF1;&#x83B7;&#x5F97;&#x4E86;&#x4E00;&#x4E2A;&#x503C;&#x3002;</strong></li>
<li>&#x6BCF;&#x4E2A;&#x7EA6;&#x675F;&#x5668;<strong>&#x68C0;&#x6D4B;(<span class="math inline">\(poll\)</span>)&#x81EA;&#x5DF1;&#x7684;&#x8FDE;&#x63A5;&#x5668;&#xFF0C;&#x770B;&#x81EA;&#x5DF1;&#x662F;&#x5426;&#x6709;&#x8DB3;&#x591F;&#x591A;&#x7684;&#x4FE1;&#x606F;&#x6765;&#x51B3;&#x5B9A;&#x8FDE;&#x63A5;&#x5668;&#x7684;&#x503C;&#x3002;</strong></li>
<li>&#x5982;&#x679C;<strong>&#x80FD;&#x51B3;&#x5B9A;&#xFF0C;&#x7EA6;&#x675F;&#x5668;&#x5C31;&#x91CD;&#x8BBE;&#x8FDE;&#x63A5;&#x5668;&#x7684;&#x503C;&#xFF0C;&#x7136;&#x540E;&#x8FDE;&#x63A5;&#x5668;&#x63A5;&#x7740;&#x6267;&#x884C;&#x5524;&#x9192;&#x64CD;&#x4F5C;&#x3002;</strong></li>
</ul>
<p>&#x2003;&#x2003;&#x5BF9;&#x4E8E;&#x6E29;&#x5EA6;&#x6362;&#x7B97;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x8BE5;&#x7F51;&#x7EDC;&#x6267;&#x884C;&#x5982;&#x4E0B;&#x64CD;&#x4F5C;&#xFF1A;</p>
<ul>
<li>&#x5148;&#x5728;<span class="math inline">\(w\)</span>&#x3001;<span class="math inline">\(x\)</span>&#x3001;<span class="math inline">\(y\)</span>&#x8FD9;&#x4E9B;&#x653E;&#x5E38;&#x6570;&#x7684;&#x76D2;&#x5B50;(<span class="math inline">\(constant\;box\)</span>)&#x91CC;&#x653E;&#x5165;&#x5E38;&#x6570;&#x3002;</li>
<li>&#x8FDE;&#x63A5;&#x5668;&#x5524;&#x9192;&#x52A0;&#x6CD5;&#x5668;<code>adder</code>&#x548C;&#x4E58;&#x6CD5;&#x5668;<code>multiplier</code></li>
<li>&#x7531;&#x4E8E;<span class="math inline">\(celsius\)</span>&#x7684;&#x8F93;&#x5165;&#xFF0C;&#x6700;&#x5DE6;&#x4FA7;&#x4E58;&#x6CD5;&#x5668;&#x5C06;&#x8FDE;&#x63A5;&#x5668;<span class="math inline">\(u\)</span>&#x7684;&#x503C;&#x91CD;&#x8BBE;&#xFF0C;&#x540C;&#x65F6;<span class="math inline">\(u\)</span>&#x5524;&#x9192;&#x53F3;&#x4FA7;&#x7684;&#x4E58;&#x6CD5;&#x5668;&#xFF1B;&#x6700;&#x53F3;&#x4FA7;&#x540C;&#x7406;&#x3002;</li>
</ul>
<h3 id="2&#x7EA6;&#x675F;&#x7CFB;&#x7EDF;&#x7684;&#x4F7F;&#x7528;">2.&#x7EA6;&#x675F;&#x7CFB;&#x7EDF;&#x7684;&#x4F7F;&#x7528;</h3>
<h4 id="a&#x8FDE;&#x63A5;&#x5668;&#x7684;&#x521B;&#x5EFA;&#x4E0E;&#x8FDE;&#x63A5;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&#x8FDE;&#x63A5;&#x5668;&#x7684;&#x521B;&#x5EFA;&#x4E0E;&#x8FDE;&#x63A5;</h4>
<p>&#x2003;&#x2003;&#x4E3A;&#x521B;&#x5EFA;&#x4E24;&#x4E2A;&#x8868;&#x793A;&#x6E29;&#x5EA6;&#x7684;&#x8FDE;&#x63A5;&#x5668;&#xFF0C;&#x6211;&#x4EEC;&#x8C03;&#x7528;<code>connector</code><span class="math inline">\(constructor\)</span>&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;celsius=connector(<span class="string">&apos;Celsius&apos;</span>)</span><br><span class="line">&gt;&gt;&gt;fahrenheit=connector(<span class="string">&apos;Fahrenheit&apos;</span>)</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x7136;&#x540E;&#x6211;&#x4EEC;&#x628A;&#x8FD9;&#x4E9B;&#x8FDE;&#x63A5;&#x5668;&#x7EC4;&#x88C5;&#x5230;&#x5982;&#x4E0A;&#x56FE;&#x7684;&#x7F51;&#x7EDC;&#x4E2D;&#x3002;&#x8FD9;&#x91CC;&#x7684;<code>converter</code>&#x51FD;&#x6570;&#x7528;&#x4E8E;&#x7EC4;&#x88C5;&#x8BE5;&#x7CFB;&#x7EDF;&#x7684;&#x8BF8;&#x591A;&#x8FDE;&#x63A5;&#x5668;&#x4E0E;&#x7EA6;&#x675F;&#x5668;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">converter</span>(<span class="params">c,f</span>):</span><br><span class="line">    u,v,w,x,y=[connector()<span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]</span><br><span class="line">    <span class="comment">#apply a new connector for each variables</span></span><br><span class="line">    multiplier(c,w,u)</span><br><span class="line">    multiplier(v,x,u)</span><br><span class="line">    adder(v,y,f)</span><br><span class="line">    constant(w,<span class="number">9</span>)</span><br><span class="line">    constant(x,<span class="number">5</span>)</span><br><span class="line">    constant(y,<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">converter(celsius,fahrenheit)</span><br></pre></td></tr></table></figure> #### &#x2003;&#x2003;<span class="math inline">\(b.\)</span>&#x8FDE;&#x63A5;&#x5668;&#x4E0E;&#x9650;&#x5236;&#x5668;&#x7684;&#x534F;&#x8C03;
&#x2003;&#x2003;&#x6211;&#x4EEC;&#x7528;&#x4E4B;&#x524D;&#x4ECB;&#x7ECD;&#x7684;<span class="math inline">\(message\;passing\)</span>&#x7CFB;&#x7EDF;&#x6765;&#x534F;&#x8C03;&#x8FDE;&#x63A5;&#x5668;&#x4E0E;&#x7EA6;&#x675F;&#x5668;&#x3002;&#x8FD9;&#x91CC;&#xFF0C;&#x7EA6;&#x675F;&#x5668;&#x662F;&#x4E0D;&#x6301;&#x6709;&#x5C40;&#x90E8;&#x72B6;&#x6001;&#x7684;&#x5B57;&#x5178;&#xFF0C;&#x5B83;&#x4EEC;&#x5BF9;<code>message</code>&#x7684;&#x56DE;&#x5E94;&#x662F;&#x4F1A;&#x6539;&#x53D8;&#x8FDE;&#x63A5;&#x5668;&#x503C;&#x7684;&#x975E;&#x7EAF;&#x51FD;&#x6570;&#x3002;</p>
<p>&#x2003;&#x2003;&#x800C;&#x8FDE;&#x63A5;&#x5668;&#x662F;<strong>&#x6301;&#x6709;&#x5F53;&#x524D;&#x503C;&#x3001;&#x5E76;&#x56DE;&#x5E94;&#x63A5;&#x6536;&#x5230;&#x7684;<code>message</code>&#x4ECE;&#x800C;&#x6539;&#x53D8;&#x5F53;&#x524D;&#x503C;&#x7684;&#x5B57;&#x5178;</strong>&#x3002;&#x7EA6;&#x675F;&#x5668;&#x4E0D;&#x4F1A;&#x7ACB;&#x5373;&#x6539;&#x53D8;&#x8FDE;&#x63A5;&#x5668;&#x7684;&#x503C;&#xFF0C;&#x800C;&#x662F;&#x53D1;&#x9001;&#x4FE1;&#x606F;&#xFF0C;&#x8FD9;&#x6837;&#x8FDE;&#x63A5;&#x5668;&#x5C31;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x6536;&#x5230;&#x7684;&#x4FE1;&#x606F;&#x6765;&#x5524;&#x9192;&#x5176;&#x4ED6;&#x7EA6;&#x675F;&#x5668;&#x3002;&#x901A;&#x8FC7;&#x8FD9;&#x4E00;&#x6D41;&#x7A0B;&#xFF0C;&#x8FDE;&#x63A5;&#x5668;&#x4E0D;&#x4EC5;&#x8868;&#x793A;&#x5F53;&#x524D;&#x503C;&#x3001;&#x800C;&#x4E14;&#x8FD8;&#x5C01;&#x88C5;&#x4E86;&#x4E00;&#x7CFB;&#x5217;&#x884C;&#x4E3A;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5411;&#x8FDE;&#x63A5;&#x5668;&#x53D1;&#x9001;&#x4FE1;&#x53F7;&#xFF0C;&#x4EE5;<code>set_val</code>&#x4E3A;&#x4F8B;&#xFF0C;&#x7684;&#x65B9;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A;(&#x8FD9;&#x91CC;&#x7684;<code>user</code>&#x662F;&#x6211;&#x4EEC;&#xFF0C;&#x53D1;&#x9001;&#x4FE1;&#x53F7;&#x7684;&#x4EBA;)
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;celsius[<span class="string">&apos;set_val&apos;</span>](<span class="string">&apos;user&apos;</span>,<span class="number">25</span>)</span><br><span class="line">celsius=<span class="number">25</span></span><br><span class="line">fahrenheit=<span class="number">77.0</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5728;<code>set_val</code>&#x88AB;&#x6267;&#x884C;&#x540E;&#xFF0C;&#x4E0D;&#x4EC5;<span class="math inline">\(celsius\)</span>&#x7684;&#x503C;&#x53D8;&#x6210;&#x4E86;<span class="math inline">\(25\)</span>&#xFF0C;&#x5B83;&#x7684;&#x503C;&#x901A;&#x8FC7;&#x7F51;&#x7EDC;&#x4F20;&#x9012;&#x5BFC;&#x81F4;&#x4E86;<span class="math inline">\(fahrenheit\)</span>&#x7684;&#x6539;&#x53D8;&#x3002;&#x8FD9;&#x4E2A;&#x6539;&#x53D8;&#x88AB;&#x6253;&#x5370;&#x51FA;&#x6765;&#xFF0C;&#x56E0;&#x4E3A;<span class="math inline">\(constructor\)</span><code>converter</code>&#x5C06;&#x4E24;&#x4E2A;&#x540D;&#x79F0;&#x7ED1;&#x5B9A;&#x5728;&#x540C;&#x4E00;&#x7F51;&#x7EDC;&#x91CC;&#x3002;</p>
<p>&#x2003;&#x2003;&#x90A3;&#x5047;&#x5982;&#x6211;&#x4EEC;&#x5BF9;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x540D;&#x79F0;&#x8F93;&#x5165;&#x4E00;&#x4E2A;&#x4E0E;&#x539F;&#x7ED3;&#x679C;&#x76F8;&#x77DB;&#x76FE;&#x7684;&#x503C;&#x5462;&#xFF1F;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>fahrenheit[<span class="string">&apos;set_val&apos;</span>](<span class="string">&apos;user&apos;</span>, <span class="number">212</span>)</span><br><span class="line">Contradiction detected: <span class="number">77.0</span> vs <span class="number">212</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x6B64;&#x65F6;&#x8FDE;&#x63A5;&#x5668;&#x62A5;&#x9519;&#x4E86;&#xFF1A;&#x5B83;&#x7684;&#x503C;&#x662F;<span class="math inline">\(77.0\)</span>&#xFF0C;&#x4F46;&#x6709;&#x4EBA;&#x60F3;&#x628A;&#x5B83;&#x53D8;&#x6210;<span class="math inline">\(212\)</span>&#x3002;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x60F3;&#x8BA9;&#x8FD9;&#x4E2A;&#x7F51;&#x7EDC;&#x91C7;&#x7EB3;&#x8FD9;&#x4E2A;&#x65B0;&#x503C;&#xFF0C;&#x5C31;&#x8981;<strong>&#x8BA9;<span class="math inline">\(celsius\)</span>&#x5FD8;&#x8BB0;&#x5B83;&#x7684;&#x65E7;&#x503C;</strong>&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>celsius[<span class="string">&apos;forget&apos;</span>](<span class="string">&apos;user&apos;</span>)</span><br><span class="line">Celsius <span class="keyword">is</span> forgotten</span><br><span class="line">Fahrenheit <span class="keyword">is</span> forgotten</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5728;&#x63A5;&#x53D7;&#x5230;<code>forget</code>&#x7684;&#x6307;&#x4EE4;&#x540E;&#xFF0C;<strong>&#x4E0D;&#x4EC5;<span class="math inline">\(celsius\)</span>&#x64A4;&#x56DE;&#x4E86;&#x539F;&#x5148;&#x7684;&#x503C;&#xFF0C;&#x8BE5;&#x6307;&#x4EE4;&#x901A;&#x8FC7;&#x7F51;&#x7EDC;&#x4F20;&#x9012;&#x7ED9;<span class="math inline">\(fahrenheit\)</span>&#xFF0C;<span class="math inline">\(fahrenheit\)</span>&#x4E5F;&#x5FD8;&#x8BB0;&#x4E86;&#x539F;&#x5148;&#x7684;&#x503C;</strong>&#x3002;&#x6B64;&#x65F6;&#x518D;&#x5BF9;<span class="math inline">\(fahrenheit\)</span>&#x8FDB;&#x884C;&#x8D4B;&#x503C;&#x5C31;&#x53EF;&#x6210;&#x7ACB;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>fahrenheit[<span class="string">&apos;set_val&apos;</span>](<span class="string">&apos;user&apos;</span>, <span class="number">212</span>)</span><br><span class="line">Fahrenheit=<span class="number">212</span></span><br><span class="line">Celsius=<span class="number">100.0</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5728;&#x8FD9;&#x6574;&#x4E2A;&#x8FC7;&#x7A0B;&#x4E2D;&#x4F53;&#x73B0;&#x51FA;&#x7684;&#x7CFB;&#x7EDF;&#x7684;<strong>&#x975E;&#x65B9;&#x5411;&#x6027;&#x662F;&#x7EA6;&#x675F;&#x7CFB;&#x7EDF;&#x7684;&#x663E;&#x8457;&#x7279;&#x5F81;</strong>&#x3002;</p>
<h3 id="3&#x7EA6;&#x675F;&#x7CFB;&#x7EDF;&#x7684;&#x5B9E;&#x73B0;">3.&#x7EA6;&#x675F;&#x7CFB;&#x7EDF;&#x7684;&#x5B9E;&#x73B0;</h3>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x60F3;&#x8BA9;&#x8FDE;&#x63A5;&#x5668;&#x5BF9;&#x5982;&#x4E0B;<code>message</code>&#x505A;&#x51FA;&#x56DE;&#x5E94;&#xFF1A;</p>
<ul>
<li><code>connector[&apos;set_val&apos;](source, value)</code>&#xFF1A;&#x4E3A;&#x8FDE;&#x63A5;&#x5668;&#x8D4B;&#x503C;&#x3002;</li>
<li><code>connector[&apos;has_val&apos;]()</code>&#xFF1A;&#x8FD4;&#x56DE;&#x662F;&#x5426;&#x6709;&#x503C;&#x3002;</li>
<li><code>connector[&apos;val&apos;]</code>&#xFF1A;&#x8F93;&#x51FA;&#x8FDE;&#x63A5;&#x5668;&#x5F53;&#x524D;&#x503C;&#x3002;</li>
<li><code>connector[&apos;forget&apos;](source)</code>&#xFF1A;&#x544A;&#x8BC9;&#x8FDE;&#x63A5;&#x5668;<code>source</code>&#x8BA9;&#x5B83;&#x5FD8;&#x8BB0;&#x5F53;&#x524D;&#x503C;&#x3002;</li>
<li><code>connector[&apos;connect&apos;](source)</code>&#xFF1A;&#x8BA9;&#x8FDE;&#x63A5;&#x5668;&#x4E0E;<code>source</code>&#x76F8;&#x8FDE;</li>
</ul>
<p>&#x2003;&#x2003;&#x7EA6;&#x675F;&#x5668;&#x4E5F;&#x662F;&#x5B57;&#x5178;&#xFF0C;&#x5B83;&#x63A5;&#x53D7;&#x8FDE;&#x63A5;&#x5668;&#x4F20;&#x6765;&#x7684;&#x4E24;&#x79CD;&#x4FE1;&#x606F;&#xFF1A;</p>
<ul>
<li><code>constraint[&apos;new_val&apos;]()</code>&#xFF1A;&#x8868;&#x660E;&#x4E0E;&#x7EA6;&#x675F;&#x5668;&#x76F8;&#x8FDE;&#x7684;&#x67D0;&#x4E2A;&#x8FDE;&#x63A5;&#x5668;&#x6709;&#x4E00;&#x4E2A;&#x65B0;&#x503C;&#x3002;</li>
<li><code>constraint[&apos;forget&apos;]()</code>&#xFF1A;&#x8868;&#x660E;&#x4E0E;&#x7EA6;&#x675F;&#x5668;&#x76F8;&#x8FDE;&#x7684;&#x67D0;&#x4E2A;&#x8FDE;&#x63A5;&#x5668;&#x5FD8;&#x8BB0;&#x4E86;&#x5B83;&#x7684;&#x503C;&#x3002;</li>
</ul>
<p>&#x2003;&#x2003;&#x5F53;&#x7EA6;&#x675F;&#x5668;&#x6536;&#x5230;<code>message</code>&#x540E;&#xFF0C;&#x4F1A;&#x5C06;&#x5B83;&#x4EEC;&#x4F20;&#x7ED9;&#x5176;&#x4ED6;&#x7684;&#x8FDE;&#x63A5;&#x5668;&#x3002;</p>
<p>&#x2003;&#x2003;&#x4E0B;&#x9762;&#x5C55;&#x793A;&#x4E00;&#x822C;&#x4E09;&#x5143;&#x7EA6;&#x675F;(<span class="math inline">\(generic\;ternary\)</span>)&#x7684;&#x5B9E;&#x73B0;&#x3002;&#x5728;&#x4E09;&#x5143;&#x7EA6;&#x675F;&#x7CFB;&#x7EDF;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x7528;&#x4E09;&#x4E2A;&#x8FDE;&#x63A5;&#x5668;&#x548C;&#x4E09;&#x4E2A;&#x4ECE;&#x52A0;&#x6CD5;&#x5668;<code>adder</code>&#x521B;&#x5EFA;&#x7684;&#x51FD;&#x6570;&#x6765;&#x521B;&#x5EFA;&#x7EA6;&#x675F;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">make_tenery_constraint</span>(<span class="params">a,b,c,ab,ca,cb</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">new_value</span>():</span><br><span class="line">        av,bv,cv=[connector[<span class="string">&apos;has_val&apos;</span>]<span class="keyword">for</span> connector <span class="keyword">in</span> (a,b,c)]</span><br><span class="line">        <span class="keyword">if</span> av <span class="keyword">and</span> bv:</span><br><span class="line">            c[<span class="string">&apos;set_val&apos;</span>](constraint,ab(a[<span class="string">&apos;val&apos;</span>],b[<span class="string">&apos;val&apos;</span>]))</span><br><span class="line">        <span class="keyword">elif</span> bv <span class="keyword">and</span> cv:</span><br><span class="line">            a[<span class="string">&apos;set_val&apos;</span>](constraint,bc(b[<span class="string">&apos;val&apos;</span>],c[<span class="string">&apos;val&apos;</span>]))</span><br><span class="line">        <span class="keyword">elif</span> av <span class="keyword">and</span> cv:</span><br><span class="line">            b[<span class="string">&apos;set_val&apos;</span>](constraint,ac(a[<span class="string">&apos;val&apos;</span>],c[<span class="string">&apos;val&apos;</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forget_value</span>():</span><br><span class="line">        <span class="keyword">for</span> connector <span class="keyword">in</span> (a,b,c):</span><br><span class="line">            connector[<span class="string">&apos;forget&apos;</span>](constraint)</span><br><span class="line">    </span><br><span class="line">    constraint=[<span class="string">&apos;new_val&apos;</span>:new_value,<span class="string">&apos;forget&apos;</span>:forget_value]</span><br><span class="line">    <span class="keyword">for</span> connector <span class="keyword">in</span>(a,b,c):</span><br><span class="line">        connectot[<span class="string">&apos;connect&apos;</span>](constraint)</span><br><span class="line">    <span class="keyword">return</span> constraint</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x91CC;&#x7684;<span class="math inline">\(constraint\)</span>&#x65E2;&#x662F;&#x5206;&#x6D3E;&#x5B57;&#x5178;&#x3001;&#x53C8;&#x662F;<span class="math inline">\(constraint\)</span>&#x5BF9;&#x8C61;&#x672C;&#x8EAB;&#xFF0C;&#x5B83;&#x8D1F;&#x8D23;&#x56DE;&#x5E94;&#x8FDE;&#x63A5;&#x5668;&#x4F20;&#x6765;&#x7684;&#x4FE1;&#x606F;&#x3002;&#x51FD;&#x6570;&#x7684;&#x5B9E;&#x73B0;&#x903B;&#x8F91;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li><span class="math inline">\(constraint\)</span>&#x7684;<code>new_value</code>&#x5C40;&#x90E8;&#x51FD;&#x6570;&#x5728;&#x7EA6;&#x675F;&#x5668;&#x88AB;&#x544A;&#x77E5;&#x5B83;&#x7684;&#x8FDE;&#x901A;&#x5668;&#x83B7;&#x5F97;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x503C;&#x65F6;&#x4F1A;&#x88AB;&#x8C03;&#x7528;&#x3002;&#x5F53;&#x5176;<strong>&#x68C0;&#x6D4B;&#x5230;&#x4E24;&#x4E2A;&#x503C;&#x65F6;&#xFF0C;&#x5B83;&#x5C31;&#x4F1A;&#x544A;&#x77E5;&#x5BF9;&#x5E94;&#x8FDE;&#x63A5;&#x5668;&#xFF1A;&#x628A;&#x503C;&#x8BBE;&#x7F6E;&#x6210;&#x4E24;&#x4E2A;&#x503C;&#x7EA6;&#x675F;&#x540E;&#x7684;&#x503C;</strong>&#x3002;</li>
<li>&#x5F53;&#x7EA6;&#x675F;&#x5668;<strong>&#x88AB;&#x544A;&#x77E5;&#x5B83;&#x7684;&#x8FDE;&#x901A;&#x5668;&#x5FD8;&#x8BB0;&#x4E86;&#x67D0;&#x4E2A;&#x503C;&#x65F6;&#xFF0C;&#x5B83;&#x8981;&#x6C42;&#x6240;&#x6709;&#x4E0E;&#x5B83;&#x76F8;&#x8FDE;&#x7684;&#x8FDE;&#x63A5;&#x5668;&#x5FD8;&#x6389;&#x5B83;&#x4EEC;&#x7684;&#x503C;</strong>&#x3002;</li>
</ul>
<p>&#x2003;&#x2003;&#x4E58;&#x6CD5;&#x5668;&#x7684;&#x5B9E;&#x73B0;&#x4E0E;&#x52A0;&#x6CD5;&#x5668;&#x7C7B;&#x4F3C;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> mul,truediv</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">muitiplier</span>(<span class="params">a,b,c</span>):</span><br><span class="line">    <span class="keyword">return</span> make_tenery_constraint(a,b,c,mul,truediv,truediv)</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5E38;&#x6570;&#x4E5F;&#x662F;&#x4E00;&#x79CD;&#x7EA6;&#x675F;&#x5668;&#xFF0C;&#x4F46;<strong>&#x5B83;&#x4E0D;&#x4F1A;&#x53D1;&#x9001;&#x4EFB;&#x4F55;&#x4FE1;&#x606F;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x521A;&#x521B;&#x5EFA;&#x65F6;&#x521B;&#x5EFA;&#x7684;&#x8FDE;&#x63A5;&#x5668;</strong>&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">constant</span>(<span class="params">connector,value</span>):</span><br><span class="line">    constraint={}</span><br><span class="line">    connector[<span class="string">&apos;set_val&apos;</span>](constraint,value)</span><br><span class="line">    <span class="keyword">return</span> constraint</span><br></pre></td></tr></table></figure></p>
<h3 id="4&#x8FDE;&#x63A5;&#x5668;&#x7684;&#x5B9E;&#x73B0;">4.&#x8FDE;&#x63A5;&#x5668;&#x7684;&#x5B9E;&#x73B0;</h3>
<p>&#x2003;&#x2003;&#x8FDE;&#x63A5;&#x5668;&#x662F;&#x4E00;&#x4E2A;&#x4E0D;&#x4EC5;&#x5305;&#x542B;&#x81EA;&#x8EAB;&#x503C;&#x3001;&#x8FD8;&#x5305;&#x542B;&#x56DE;&#x5E94;&#x51FD;&#x6570;&#x7684;&#x5B57;&#x5178;&#x3002;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x5668;&#x9700;&#x8981;&#x8DDF;&#x8E2A;&#x7ED9;&#x5B83;&#x8D4B;&#x4E88;&#x5F53;&#x524D;&#x503C;&#x7684;<code>informant</code>(<code>source</code>)&#x4E0E;&#x548C;&#x5B83;&#x76F8;&#x8FDE;&#x7684;<code>constraint</code>&#x3002;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">connector</span>(<span class="params">name=<span class="literal">None</span></span>):</span><br><span class="line">    informant=<span class="literal">None</span></span><br><span class="line">    constraint=[]</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_value</span>(<span class="params">source,value</span>):</span><br><span class="line">        <span class="keyword">nonlocal</span> informant</span><br><span class="line">        val=connect[<span class="string">&apos;val&apos;</span>]</span><br><span class="line">        <span class="keyword">if</span> val <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            informant,connector[<span class="string">&apos;val&apos;</span>]=source,value</span><br><span class="line">            <span class="keyword">if</span> name <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="built_in">print</span>(name,<span class="string">&apos;=&apos;</span>,value)</span><br><span class="line">            inform_all_except(source,<span class="string">&apos;new_val&apos;</span>,constraints)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> val!=value:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&apos;Contradiction detected:&apos;</span>,val,<span class="string">&apos;vs&apos;</span>,value)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forger_value</span>(<span class="params">source</span>):</span><br><span class="line">        <span class="keyword">nonlocal</span> informant</span><br><span class="line">        <span class="keyword">if</span> informant==source:</span><br><span class="line">            informant,connector[<span class="string">&apos;val&apos;</span>]=<span class="literal">None</span>,<span class="literal">None</span></span><br><span class="line">            <span class="keyword">if</span> name <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="built_in">print</span>(name,<span class="string">&apos;is forgotten&apos;</span>)</span><br><span class="line">            inform_all_except(source,<span class="string">&apos;forget&apos;</span>,constraints)</span><br><span class="line"></span><br><span class="line">    connector={<span class="string">&apos;val&apos;</span>:<span class="literal">None</span>,</span><br><span class="line">               <span class="string">&apos;set_val&apos;</span>:set_value,</span><br><span class="line">               <span class="string">&apos;forget&apos;</span>:forget_value,</span><br><span class="line">               <span class="string">&apos;has_val&apos;</span>:<span class="keyword">lambda</span>:connector[<span class="string">&apos;val&apos;</span>]<span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>,</span><br><span class="line">               <span class="string">&apos;connect&apos;</span>:<span class="keyword">lambda</span> source:constraints.append(source)}</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> connector</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x91CC;&#x7684;<span class="math inline">\(connector\)</span>&#x540C;&#x6837;&#x65E2;&#x662F;&#x5206;&#x6D3E;&#x5B57;&#x5178;&#x53C8;&#x662F;<span class="math inline">\(connector\)</span>&#x5BF9;&#x8C61;&#x672C;&#x8EAB;&#xFF0C;&#x5B57;&#x5178;&#x7684;&#x5176;&#x4E2D;&#x56DB;&#x9879;&#x4EE3;&#x8868;&#x65B9;&#x6CD5;&#x51FD;&#x6570;&#xFF0C;&#x6700;&#x540E;&#x4E00;&#x9879;&#x8FD4;&#x56DE;<span class="math inline">\(connector\)</span>&#x7684;&#x503C;&#x3002;&#x51FD;&#x6570;&#x7684;&#x5B9E;&#x73B0;&#x903B;&#x8F91;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>&#x5F53;<strong>&#x6536;&#x5230;&#x8BBE;&#x7F6E;&#x8FDE;&#x63A5;&#x5668;&#x5F53;&#x524D;&#x503C;&#x7684;&#x8BF7;&#x6C42;</strong>&#x65F6;&#xFF0C;<code>set_value</code>&#x88AB;&#x8C03;&#x7528;&#x3002;</li>
<li>&#x5F53;&#x6B64;&#x65F6;&#x7684;&#x8FDE;&#x63A5;&#x5668;&#x6CA1;&#x6709;&#x503C;&#x65F6;&#xFF0C;&#x5B83;<strong>&#x4F1A;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x503C;&#xFF0C;&#x5E76;&#x5C06;&#x8BF7;&#x6C42;&#x8BBE;&#x7F6E;&#x503C;&#x7684;&#x6E90;&#x7EA6;&#x675F;&#x5668;<code>source</code>&#x4F5C;&#x4E3A;<code>informant</code></strong>&#x3002;&#x7136;&#x540E;&#x8FDE;&#x63A5;&#x5668;&#x5C31;&#x4F1A;<strong>&#x544A;&#x77E5;&#x9664;&#x6E90;&#x7EA6;&#x675F;&#x5668;&#x5916;&#x7684;&#x6240;&#x6709;&#x4E0E;&#x5B83;&#x76F8;&#x8FDE;&#x7684;&#x7EA6;&#x675F;&#x5668;</strong>&#x3002;</li>
<li>&#x5F53;&#x8FDE;&#x63A5;&#x5668;&#x88AB;&#x544A;&#x77E5;&#x8981;&#x5FD8;&#x8BB0;&#x5F53;&#x524D;&#x503C;&#x65F6;&#xFF0C;&#x5B83;<strong>&#x8C03;&#x7528;<code>forget_value</code>&#xFF0C;&#x63A5;&#x7740;&#x544A;&#x77E5;&#x9664;&#x6E90;&#x7EA6;&#x675F;&#x5668;&#x5916;&#x7684;&#x6240;&#x6709;&#x4E0E;&#x5B83;&#x76F8;&#x8FDE;&#x7684;&#x7EA6;&#x675F;&#x5668;</strong>&#x3002;</li>
</ul>
<p>&#x2003;&#x2003;&#x544A;&#x77E5;&#x51FD;&#x6570;&#x53EF;&#x5982;&#x4E0B;&#x5B9E;&#x73B0;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">inform_all_except</span>(<span class="params">source,message,constraints</span>):</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> constraints:</span><br><span class="line">        <span class="keyword">if</span> c!=source:</span><br><span class="line">            c[message]()</span><br></pre></td></tr></table></figure></p>
<h3 id="5&#x7EA6;&#x675F;&#x7CFB;&#x7EDF;&#x7684;&#x6027;&#x8D28;">5.&#x7EA6;&#x675F;&#x7CFB;&#x7EDF;&#x7684;&#x6027;&#x8D28;</h3>
<p>&#x2003;&#x2003;&#x7EA6;&#x675F;&#x7CFB;&#x7EDF;&#x4E2D;&#x7684;&#x7EA6;&#x675F;&#x5668;&#x4E0E;&#x8FDE;&#x63A5;&#x5668;&#x90FD;&#x662F;<strong>&#x901A;&#x8FC7;&#x4F20;&#x9012;<code>message</code>&#x6765;&#x64CD;&#x4F5C;&#x7684;&#x5BF9;&#x8C61;</strong>&#x3002;&#x5F53;&#x67D0;&#x4E2A;&#x8FDE;&#x63A5;&#x5668;&#x7684;&#x503C;&#x88AB;&#x6539;&#x53D8;&#x65F6;&#xFF0C;&#x4F20;&#x9012;&#x7684;<code>message</code><strong>&#x4E0D;&#x4EC5;&#x6539;&#x53D8;&#x4E86;&#x8FDE;&#x63A5;&#x5668;&#x7684;&#x503C;&#xFF0C;&#x8FD8;&#x786E;&#x8BA4;&#x4E86;&#x503C;&#x7684;&#x6B63;&#x786E;&#x6027;&#x3001;&#x5C06;&#x503C;&#x7684;&#x6548;&#x679C;&#x4F20;&#x9012;&#x7ED9;&#x5176;&#x4ED6;&#x5BF9;&#x8C61;</strong>&#x3002;&#x8FD9;&#x4F7F;&#x5F97;&#x7A0B;&#x5E8F;&#x66F4;&#x4E3A;&#x5B8C;&#x5584;</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/2.5.ALists/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/2.5.ALists/" class="post-title-link" itemprop="url">2.5.&#x6570;&#x7EC4;&#x578B;&#x94FE;&#x8868;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 16:59:45" itemprop="dateModified" datetime="2024-06-02T16:59:45+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/2-List/" itemprop="url" rel="index"><span itemprop="name">2.List</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>1.1k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>4 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="25&#x6570;&#x7EC4;&#x578B;&#x94FE;&#x8868;"><span class="math inline">\(2.5\)</span>&#x6570;&#x7EC4;&#x578B;&#x94FE;&#x8868;</h1>
<h3 id="1&#x6570;&#x7EC4;&#x578B;&#x94FE;&#x8868;&#x7684;&#x5F15;&#x5165;&#x4E0E;&#x642D;&#x5EFA;">1.&#x6570;&#x7EC4;&#x578B;&#x94FE;&#x8868;&#x7684;&#x5F15;&#x5165;&#x4E0E;&#x642D;&#x5EFA;</h3>
<p>&#x2003;&#x2003;&#x5728;<span class="math inline">\(SLList\)</span>&#x4E0E;<span class="math inline">\(DLList\)</span>&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8F7B;&#x6613;&#x5730;&#x5B9E;&#x73B0;<code>getFirst</code>&#x548C;<code>getLast</code>&#xFF0C;&#x4F46;&#x53EA;&#x80FD;&#x7528;&#x7EBF;&#x6027;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x5B9E;&#x73B0;<code>get(int index)</code>&#x3002;&#x800C;&#x6570;&#x7EC4;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x5E38;&#x6570;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x7684;&#x8BBF;&#x95EE;(&#x53C2;&#x8003;<span class="math inline">\(cs61a\)</span>&#x7684;&#x61D2;&#x60F0;&#x8BA1;&#x7B97;)&#x3002;</p>
<p>&#x2003;&#x2003;&#x53EF;&#x4EE5;&#x521D;&#x6B65;&#x642D;&#x5EFA;&#x51FA;&#x4EE5;&#x4E0B;&#x7684;<span class="math inline">\(AList\)</span>&#x6846;&#x67B6;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AList</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span>[] items;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> AList {</span><br><span class="line">        items = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">100</span>];</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addLast</span><span class="params">(<span class="type">int</span> x)</span> {</span><br><span class="line">        items[size] = x;</span><br><span class="line">        size += <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span> {</span><br><span class="line">        <span class="keyword">return</span> items[i];</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x4E00;&#x5B9E;&#x73B0;&#x9075;&#x5FAA;&#x4E86;&#x4EE5;&#x4E0B;&#x4E0D;&#x53D8;&#x91CF;&#xFF1A;</p>
<ul>
<li>&#x4E0B;&#x4E00;&#x4E2A;&#x63D2;&#x5165;&#x5143;&#x7D20;&#x7684;&#x63D2;&#x5165;&#x4F4D;&#x7F6E;&#x4E00;&#x76F4;&#x662F;<span class="math inline">\(size\)</span>&#x3002;</li>
<li><span class="math inline">\(AList\)</span>&#x4E2D;&#x7684;&#x5143;&#x7D20;&#x6570;&#x91CF;&#x6C38;&#x8FDC;&#x662F;<span class="math inline">\(size\)</span>&#x3002;</li>
<li>&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x7684;&#x4F4D;&#x7F6E;&#x6C38;&#x8FDC;&#x662F;<span class="math inline">\(size-1\)</span>&#x3002;</li>
</ul>
<h3 id="2&#x5BF9;&#x94FE;&#x8868;&#x7684;&#x601D;&#x8003;">2.&#x5BF9;&#x94FE;&#x8868;&#x7684;&#x601D;&#x8003;</h3>
<p>&#x2003;&#x2003;&#x5728;&#x5B9E;&#x73B0;<code>removeLast</code>&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x5148;&#x660E;&#x786E;&#x4E00;&#x4E2A;&#x91CD;&#x8981;&#x7684;&#x53D1;&#x73B0;&#xFF1A;&#x5728;&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x67D0;&#x4E2A;&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x5BF9;&#x94FE;&#x8868;&#x7684;&#x4EFB;&#x4F55;&#x6539;&#x53D8;&#x90FD;&#x5E94;&#x8BE5;&#x5BFC;&#x81F4;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x5185;&#x5B58;&#x76D2;&#x5B50;(<span class="math inline">\(memory\;box\)</span>)&#x7684;&#x6539;&#x53D8;&#x3002;</p>
<p>&#x2003;&#x2003;&#x94FE;&#x8868;&#x662F;&#x4E00;&#x4E2A;&#x62BD;&#x8C61;&#x7684;&#x6982;&#x5FF5;&#x7528;&#x6237;&#x4F7F;&#x7528;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x7684;&#x62BD;&#x8C61;(<code>addLast</code>&#xFF0C;<code>removeLast</code>)&#x6765;&#x5BF9;&#x5217;&#x8868;&#x8FDB;&#x884C;&#x7684;&#x4EFB;&#x4F55;&#x66F4;&#x6539;&#xFF0C;&#x800C;&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x5C06;&#x8FD9;&#x4E9B;&#x66F4;&#x6539;&#x4EE5;&#x7B26;&#x5408;&#x7528;&#x6237;&#x671F;&#x671B;&#x7684;&#x65B9;&#x5F0F;&#x53CD;&#x6620;&#x5728;&#x8FD9;&#x4E9B;&#x5185;&#x5B58;&#x76D2;&#x5B50;&#x4E2D;&#x3002;&#x4E2D;&#x95F4;&#x7684;&#x8FC7;&#x7A0B;&#x5E76;&#x4E0D;&#x91CD;&#x8981;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x8BA9;&#x6570;&#x7EC4;&#x578B;&#x94FE;&#x8868;&#x7684;&#x884C;&#x4E3A;&#x4E0E;&#x7528;&#x6237;&#x6240;&#x8BBE;&#x60F3;&#x7684;&#x76F8;&#x4E00;&#x81F4;&#x5C31;&#x597D;&#x4E86;&#x3002;</p>
<p>&#x2003;&#x2003;&#x800C;<span class="math inline">\(size\)</span>&#xFF0C;<span class="math inline">\(items\)</span>&#xFF0C;<span class="math inline">\(items[i]\)</span>&#x7684;&#x5185;&#x5B58;&#x76D2;&#x5B50;(<span class="math inline">\(memory\;boxes\)</span>)&#x662F;&#x8FD9;&#x4E2A;&#x6982;&#x5FF5;&#x7684;&#x5177;&#x4F53;&#x8868;&#x793A;&#xFF0C;&#x662F;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x8BBE;&#x8BA1;&#x597D;&#x7684;&#x4E8B;&#x5B9E;&#x3002;&#x6211;&#x4EEC;&#x7684;&#x76EE;&#x6807;&#x5C31;&#x662F;&#x901A;&#x8FC7;&#x64CD;&#x4F5C;&#x8FD9;&#x4E9B;&#x5177;&#x4F53;&#x7684;&#x8868;&#x793A;&#x5F62;&#x5F0F;&#xFF0C;&#x6765;&#x5B9E;&#x73B0;&#x7528;&#x6237;&#x60F3;&#x8981;&#x7684;&#x6A21;&#x578B;&#x3002;</p>
<h3 id="3removelast&#x7684;&#x5B9E;&#x73B0;">3.<code>removeLast</code>&#x7684;&#x5B9E;&#x73B0;</h3>
<p>&#x2003;&#x2003;&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x5BF9;&#x94FE;&#x8868;&#x7684;&#x601D;&#x8003;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53EA;&#x901A;&#x8FC7;&#x6539;&#x53D8;<span class="math inline">\(size\)</span>&#x6765;&#x5B9E;&#x73B0;<code>removeLast</code>&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">removeLast</span><span class="params">()</span> {</span><br><span class="line">        <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> getLast();</span><br><span class="line">        size = size - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    }</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x79CD;<code>removeLast</code>&#x7684;&#x5B9E;&#x73B0;&#x662F;&#x57FA;&#x4E8E;<span class="math inline">\(AList\)</span>&#x7684;&#x4E0D;&#x53D8;&#x91CF;&#x7684;&#x3002;&#x53EA;&#x8981;&#x6211;&#x4EEC;&#x6539;&#x53D8;<span class="math inline">\(Size\)</span>&#xFF0C;&#x90A3;&#x4E48;&#x4E0B;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x63D2;&#x5165;&#x7684;&#x4F4D;&#x7F6E;&#x5C31;&#x4E00;&#x5B9A;&#x662F;<span class="math inline">\(size\)</span>&#xFF0C;&#x4E0D;&#x7BA1;<span class="math inline">\(size\)</span>&#x8FD9;&#x4E2A;&#x4F4D;&#x7F6E;&#x6709;&#x6CA1;&#x6709;&#x5143;&#x7D20;&#xFF0C;&#x800C;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x7684;&#x4F4D;&#x7F6E;&#x662F;<span class="math inline">\(size-1\)</span>&#xFF0C;&#x7528;&#x6237;&#x5E76;&#x4E0D;&#x80FD;&#x53BB;&#x8BBF;&#x95EE;<span class="math inline">\(size\)</span>&#x8FD9;&#x4E2A;&#x4F4D;&#x7F6E;&#x3002;&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;&#x624B;&#x6BB5;&#x5B9E;&#x73B0;&#x5143;&#x7D20;&#x7684;&#x5220;&#x9664;&#x3002;&#x81F3;&#x4E8E;<span class="math inline">\(size\)</span>&#x4F4D;&#x7F6E;&#x7684;&#x5143;&#x7D20;&#xFF0C;&#x6211;&#x4EEC;&#x60F3;&#x628A;&#x5B83;&#x6539;&#x4E3A;&#x51E0;&#x90FD;&#x53EF;&#x4EE5;&#x3002;</p>
<p>&#x2003;&#x2003;&#x4E0D;&#x8FC7;&#xFF0C;&#x4E0E;<span class="math inline">\(int\)</span>&#x578B;&#x7684;&#x94FE;&#x8868;&#x4E0D;&#x540C;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x94FE;&#x8868;&#x7684;&#x5B58;&#x50A8;&#x7C7B;&#x578B;&#x4E3A;<span class="math inline">\(generic\)</span>&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x5C06;<span class="math inline">\(size\)</span>&#x4F4D;&#x7F6E;&#x7684;&#x5143;&#x7D20;&#x7F6E;&#x4E3A;<code>null</code>&#xFF0C;&#x56E0;&#x4E3A;&#x5982;&#x679C;&#x5BF9;<span class="math inline">\(size\)</span>&#x4F4D;&#x7F6E;&#x7684;&#x5143;&#x7D20;&#x7F6E;&#x4E4B;&#x4E0D;&#x7406;&#x7684;&#x8BDD;&#xFF0C;&#x8FD9;&#x4E2A;&#x5143;&#x7D20;&#x5C31;&#x4F1A;&#x4E00;&#x76F4;&#x5360;&#x7528;&#x5185;&#x5B58;&#xFF0C;&#x5BFC;&#x81F4;&#x5185;&#x5B58;&#x7684;&#x6D6A;&#x8D39;&#x3002;&#x800C;&#x8BBE;&#x4E3A;<code>null</code>&#x540E;&#xFF0C;&#x7531;&#x4E8E;&#x5BF9;&#x5B83;&#x7684;&#x5F15;&#x7528;&#x4E22;&#x5931;&#x4E86;&#xFF0C;<span class="math inline">\(Java\)</span>&#x4F1A;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x5220;&#x6389;&#x5B83;&#x3002;</p>
<h3 id="4&#x6570;&#x7EC4;&#x5927;&#x5C0F;&#x7684;&#x8C03;&#x6574;">4.&#x6570;&#x7EC4;&#x5927;&#x5C0F;&#x7684;&#x8C03;&#x6574;</h3>
<p>&#x2003;&#x2003;&#x5728;<span class="math inline">\(Java\)</span>&#x4E2D;&#xFF0C;&#x6570;&#x7EC4;&#x5FC5;&#x987B;&#x6709;&#x56FA;&#x5B9A;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x56E0;&#x6B64;&#x5728;&#x6570;&#x7EC4;&#x5BB9;&#x91CF;&#x4E0D;&#x591F;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8C03;&#x6574;&#x6570;&#x7EC4;&#x7684;&#x5927;&#x5C0F;(<span class="math inline">\(resize\)</span>)&#x3002;</p>
<p>&#x2003;&#x2003;&#x5B9E;&#x73B0;&#x8C03;&#x6574;&#x6570;&#x7EC4;&#x7684;&#x529E;&#x6CD5;&#x5F88;&#x7B80;&#x5355;&#xFF1A;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5177;&#x6709;&#x6240;&#x9700;&#x5927;&#x5C0F;&#x7684;&#x6570;&#x7EC4;&#xFF0C;&#x7136;&#x540E;&#x628A;&#x539F;&#x6570;&#x7EC4;&#x7684;&#x5143;&#x7D20;&#x590D;&#x5236;&#x8FC7;&#x6765;&#xFF0C;&#x6700;&#x540E;&#x8FD4;&#x56DE;&#x8FD9;&#x4E2A;&#x65B0;&#x6570;&#x7EC4;&#x5373;&#x53EF;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[] a = <span class="keyword">new</span> <span class="title class_">int</span>[size + <span class="number">1</span>];</span><br><span class="line">System.arraycopy(items, <span class="number">0</span>, a, <span class="number">0</span>, size);</span><br><span class="line">a[size] = <span class="number">11</span>;</span><br><span class="line">items = a;</span><br><span class="line">size = size + <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;&#x4F46;&#x662F;&#xFF0C;&#x8FD9;&#x79CD;&#x5728;&#x9700;&#x8981;&#x6269;&#x5BB9;&#x65F6;&#x589E;&#x52A0;&#x4E00;&#x90E8;&#x5206;&#x7684;&#x505A;&#x6CD5;&#x8FC7;&#x4E8E;&#x7F13;&#x6162;&#x3002;&#x4F8B;&#x5982;&#x6211;&#x4EEC;&#x6BCF;&#x6B21;&#x6269;&#x5BB9;<span class="math inline">\(1\)</span>&#xFF0C;&#x5219;&#x5F53;&#x6570;&#x7EC4;&#x6269;&#x5BB9;&#x5230;<span class="math inline">\(n\)</span>&#x65F6;&#xFF0C;&#x7531;&#x4E8E;&#x6BCF;&#x6B21;&#x6269;&#x5BB9;&#x90FD;&#x8981;&#x5148;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x6570;&#x7EC4;&#xFF0C;&#x4E00;&#x5171;&#x521B;&#x5EFA;&#x4E86;<span class="math inline">\(\sum_{i=1}^n i ={ {n(n+1)}\over
2}\)</span>&#x4E2A;&#x5355;&#x4F4D;&#x5927;&#x5C0F;&#x7684;&#x6570;&#x7EC4;&#xFF0C;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A;<span class="math inline">\(O(n^2)\)</span>&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x6548;&#x7387;&#x5341;&#x5206;&#x4F4E;&#x3002;</p>
<p>&#x2003;&#x2003;&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x4E00;&#x822C;&#x4E0D;&#x91C7;&#x7528;&#x4E0A;&#x9762;&#x7684;&#x6269;&#x5BB9;&#x65B9;&#x5F0F;&#xFF0C;&#x800C;&#x662F;&#x5728;&#x9700;&#x8981;&#x6269;&#x5BB9;&#x7684;&#x65F6;&#x5019;&#x9002;&#x5F53;&#x5730;&#x591A;&#x6269;&#x5927;&#x4E00;&#x4E9B;&#xFF0C;&#x4EE5;&#x51CF;&#x5C11;&#x521B;&#x5EFA;&#x6570;&#x7EC4;&#x7684;&#x6B21;&#x6570;&#x3002;&#x4E00;&#x822C;&#x7684;&#x505A;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertBack</span><span class="params">(<span class="type">int</span> x)</span> {</span><br><span class="line">    <span class="keyword">if</span> (size == items.length) {</span><br><span class="line">           resize(size * RFACTOR);</span><br><span class="line">    }</span><br><span class="line">    items[size] = x;</span><br><span class="line">    size += <span class="number">1</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h3 id="5&#x5185;&#x5B58;&#x4F7F;&#x7528;&#x7387;">5.&#x5185;&#x5B58;&#x4F7F;&#x7528;&#x7387;</h3>
<p>&#x2003;&#x2003;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x5B9E;&#x9645;&#x5143;&#x7D20;&#x4E2A;&#x6570;&#x4E0E;&#x6570;&#x7EC4;&#x5927;&#x5C0F;&#x4E4B;&#x6BD4;&#x7684;&#x6570;&#x503C;&#x662F;&#x5185;&#x5B58;&#x5229;&#x7528;&#x7387;&#x3002;&#x4E0B;&#x9762;&#x7684;&#x6570;&#x7EC4;&#x7684;&#x5185;&#x5B58;&#x4F7F;&#x7528;&#x7387;&#x4E3A;<span class="math inline">\(0.04\)</span>&#xFF1A;</p>
<p><img src="/2024/05/31/2.5.ALists/image-14.png"></p>
<p>&#x2003;&#x2003;&#x5F53;&#x6570;&#x7EC4;&#x7684;&#x5185;&#x5B58;&#x4F7F;&#x7528;&#x7387;&#x8F83;&#x4F4E;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8003;&#x8651;<code>resize(size \ 2)</code>&#xFF0C;&#x7F29;&#x5C0F;&#x6570;&#x7EC4;&#x7A7A;&#x95F4;&#x6765;&#x8282;&#x7EA6;&#x5185;&#x5B58;&#x3002;&#x8FD9;&#x79CD;&#x505A;&#x6CD5;&#x88AB;&#x79F0;&#x4E3A;&#x4EE5;&#x7A7A;&#x95F4;&#x6362;&#x65F6;&#x95F4;&#x3002;</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/2.5.%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/2.5.%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/" class="post-title-link" itemprop="url">2.5.&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x7F16;&#x7A0B;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 15:26:14" itemprop="dateModified" datetime="2024-06-02T15:26:14+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SICP-in-python/" itemprop="url" rel="index"><span itemprop="name">SICP in python</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SICP-in-python/Chapter-2-Building-Abstraction-with-Data/" itemprop="url" rel="index"><span itemprop="name">Chapter 2.Building Abstraction with Data</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>3.2k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>12 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="25&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x7F16;&#x7A0B;"><span class="math inline">\(2.5\)</span>&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x7F16;&#x7A0B;</h1>
<h2 id="&#x4E00;-&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x7F16;&#x7A0B;&#x6982;&#x8FF0;">&#x4E00;&#x3001;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x7F16;&#x7A0B;&#x6982;&#x8FF0;</h2>
<p>&#x2003;&#x2003;&#x5728;&#x524D;&#x6587;&#x7684;&#x8BB2;&#x8FF0;&#x4E2D;&#xFF0C;&#x5BF9;&#x8C61;&#x5177;&#x6709;&#x5982;&#x4E0B;&#x7684;&#x7279;&#x70B9;&#xFF1A;</p>
<ul>
<li>&#x5BF9;&#x8C61;&#x95F4;<strong>&#x53EF;&#x4EE5;&#x5EFA;&#x7ACB;&#x62BD;&#x8C61;&#x5C4F;&#x969C;</strong></li>
<li>&#x5BF9;&#x8C61;<strong>&#x5177;&#x6709;&#x65E0;&#x6CD5;&#x88AB;&#x5168;&#x5C40;&#x73AF;&#x5883;&#x8BBF;&#x95EE;&#x7684;&#x5C40;&#x90E8;&#x72B6;&#x6001;</strong></li>
<li><span class="math inline">\(\cdots\)</span></li>
</ul>
<p>&#x2003;&#x2003;<span class="math inline">\(Python\)</span>&#x7684;&#x5BF9;&#x8C61;&#x7CFB;&#x7EDF;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x7F16;&#x7A0B;(<span class="math inline">\(object-oriented\;programme\)</span>)&#x8BED;&#x8A00;&#x6765;&#x8868;&#x8FF0;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5BF9;&#x8C61;&#x7CFB;&#x7EDF;&#x4E3A;&#x591A;&#x4E2A;&#x72EC;&#x7ACB;&#x4EE3;&#x7406;(<span class="math inline">\(agent\)</span>)&#x5728;&#x8BA1;&#x7B97;&#x673A;&#x5185;&#x90E8;&#x7684;&#x4E92;&#x52A8;&#x63D0;&#x4F9B;&#x4E86;&#x65B0;&#x7684;&#x9690;&#x55BB;&#x65B9;&#x6CD5;&#x3002;&#x6BCF;&#x4E2A;&#x5BF9;&#x8C61;&#x90FD;&#x5C06;&#x5C40;&#x90E8;&#x72B6;&#x6001;&#x548C;&#x884C;&#x4E3A;&#x901A;&#x8FC7;&#x62BD;&#x8C61;&#x7684;&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x7ED1;&#x5B9A;&#xFF0C;&#x4ECE;&#x800C;&#x5C06;&#x4E24;&#x8005;&#x7684;&#x590D;&#x6742;&#x6027;&#x8FDB;&#x884C;&#x62BD;&#x8C61;&#x3002;&#x5BF9;&#x8C61;&#x95F4;&#x4E92;&#x76F8;&#x4EA4;&#x6D41;&#xFF0C;&#x800C;&#x5B83;&#x4EEC;&#x4EA4;&#x6D41;&#x7684;&#x7ED3;&#x679C;&#x5F97;&#x51FA;&#x4E86;&#x6709;&#x7528;&#x7684;&#x7ED3;&#x8BBA;&#x3002;&#x5BF9;&#x8C61;&#x95F4;<strong>&#x4E0D;&#x4EC5;&#x4F20;&#x9012;&#x4FE1;&#x606F;&#xFF0C;&#x800C;&#x4E14;&#x548C;&#x5176;&#x5B83;&#x76F8;&#x540C;&#x7C7B;&#x578B;&#x7684;&#x5BF9;&#x8C61;&#x5171;&#x4EAB;&#x884C;&#x4E3A;&#x3001;&#x7EE7;&#x627F;&#x76F8;&#x540C;&#x7C7B;&#x578B;&#x5BF9;&#x8C61;&#x7684;&#x7279;&#x6027;</strong>&#x3002;</p>
<h2 id="&#x4E8C;-&#x7C7B;class">&#x4E8C;&#x3001;&#x7C7B;(<span class="math inline">\(class\)</span>)</h2>
<h3 id="1&#x7C7B;&#x7684;&#x6982;&#x5FF5;">1.&#x7C7B;&#x7684;&#x6982;&#x5FF5;</h3>
<p>&#x2003;&#x2003;&#x7C7B;&#x662F;&#x4F5C;&#x4E3A;&#x6240;&#x6709;&#x5C5E;&#x4E8E;&#x8BE5;&#x7C7B;&#x7684;&#x5BF9;&#x8C61;&#x7684;&#x6A21;&#x7248;(<span class="math inline">\(template\)</span>)&#x3002;&#x6BCF;&#x4E2A;&#x5BF9;&#x8C61;&#x90FD;&#x662F;&#x7C7B;&#x7684;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;(<span class="math inline">\(instance\)</span>)&#x3002;</p>
<p>&#x2003;&#x2003;&#x7C7B;&#x7684;&#x58F0;&#x660E;&#x5177;&#x4F53;&#x8BF4;&#x660E;&#x4E86;<strong>&#x7C7B;&#x7684;&#x5BF9;&#x8C61;&#x95F4;&#x5171;&#x4EAB;&#x7684;&#x5C5E;&#x6027;&#x4E0E;&#x65B9;&#x6CD5;</strong>&#x3002;&#x4EE5;&#x4E4B;&#x524D;&#x7684;&#x94F6;&#x884C;&#x8D26;&#x6237;<span class="math inline">\(account\)</span>&#x4E3A;&#x4F8B;&#xFF0C;&#x53EF;&#x4EE5;&#x5982;&#x4E0B;&#x58F0;&#x660E;&#x4E00;&#x4E2A;&#x7C7B;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=Account(<span class="string">&apos;Kirk&apos;</span>)</span><br></pre></td></tr></table></figure></p>
<h3 id="2&#x7C7B;&#x7684;&#x5B50;&#x6982;&#x5FF5;">2.&#x7C7B;&#x7684;&#x5B50;&#x6982;&#x5FF5;</h3>
<p>&#x2003;&#x2003;&#x7C7B;&#x7684;&#x5C5E;&#x6027;(<span class="math inline">\(attribute\)</span>)&#x662F;&#x4E00;&#x4E2A;<strong>&#x4E0E;&#x5BF9;&#x8C61;&#x76F8;&#x5173;&#x8054;&#x7684;&#x201C;&#x540D;&#x5B57;-&#x503C;&#x201D;&#x5BF9;</strong>&#xFF0C;&#x901A;&#x8FC7;&#x201C;&#x70B9;&#x6807;&#x8BB0;&#x201D;(<span class="math inline">\(dot-notation\)</span>)&#x80FD;&#x8BBF;&#x95EE;&#x7C7B;&#x7684;&#x5C5E;&#x6027;&#x3002;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.holder</span><br><span class="line"><span class="string">&apos;Kirk&apos;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.balance</span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure> &#x2003;&#x2003;&#x7C7B;&#x7684;&#x65B9;&#x6CD5;(<span class="math inline">\(method\)</span>)&#x662F;<strong>&#x4F5C;&#x7528;&#x4E8E;&#x5BF9;&#x8C61;&#x53CA;&#x5176;&#x8BA1;&#x7B97;&#x7684;&#x51FD;&#x6570;</strong>&#x3002;&#x65B9;&#x6CD5;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x4E0E;&#x526F;&#x4F5C;&#x7528;&#x53D6;&#x51B3;&#x4E8E;&#x5BF9;&#x8C61;&#x7684;&#x5C5E;&#x6027;&#x3001;&#x5E76;&#x4E14;&#x80FD;&#x6539;&#x53D8;&#x5BF9;&#x8C61;&#x7684;&#x4E00;&#x4E9B;&#x5C5E;&#x6027;&#x3002;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.deposit(<span class="number">15</span>)</span><br><span class="line"><span class="number">15</span></span><br></pre></td></tr></table></figure></p>
<h3 id="3&#x7C7B;&#x7684;&#x58F0;&#x660E;">3.&#x7C7B;&#x7684;&#x58F0;&#x660E;</h3>
<h4 id="a&#x521D;&#x59CB;&#x5316;&#x58F0;&#x660E;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&#x521D;&#x59CB;&#x5316;&#x58F0;&#x660E;</h4>
<p>&#x2003;&#x2003;&#x4E00;&#x4E2A;&#x58F0;&#x660E;&#x7C7B;&#x7684;&#x8BED;&#x53E5;&#x6709;&#x4EE5;&#x4E0B;&#x7684;&#x7ED3;&#x6784;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span>&lt;name&gt;:</span><br><span class="line">    &lt;suite&gt;</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x4E00;&#x4E2A;&#x7C7B;&#x4E3A;&#x4E86;&#x5177;&#x4F53;&#x58F0;&#x660E;&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x4F1A;<strong>&#x5185;&#x7F6E;&#x4E00;&#x4E2A;&#x521D;&#x59CB;&#x5316;&#x65B9;&#x6CD5;<code>__init__</code>&#xFF0C;&#x8FD9;&#x79F0;&#x4E3A;&#x7C7B;&#x7684;&#x6784;&#x5EFA;(<span class="math inline">\(constructor\)</span>)</strong>&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">class</span> <span class="title class_">Account</span>:</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, account_holder</span>):</span><br><span class="line">            self.balance = <span class="number">0</span></span><br><span class="line">            self.holder = account_holder</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>&#x2003;&#x2003;<span class="math inline">\(p.s.\)</span>&#x5728;<span class="math inline">\(Python\)</span>&#x4E2D;&#xFF0C;&#x65B9;&#x6CD5;&#x540D;&#x4EE5;&#x53CC;&#x4E0B;&#x5212;&#x7EBF; __
&#x5F00;&#x5934;&#x548C;&#x7ED3;&#x5C3E;&#x7684;&#x5F62;&#x5F0F;&#x88AB;&#x79F0;&#x4E3A;&#x7279;&#x6B8A;&#x65B9;&#x6CD5;(<span class="math inline">\(special\;methods)\)</span>&#x3002;<code>__init__</code>&#x662F;&#x5176;&#x4E2D;&#x4E00;&#x79CD;&#xFF0C;&#x5B83;&#x7528;&#x4E8E;&#x521D;&#x59CB;&#x5316;&#x5BF9;&#x8C61;&#x7684;&#x72B6;&#x6001;&#x3002;&#x5F53;&#x4F60;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x5B9E;&#x4F8B;&#x65F6;&#xFF0C;<span class="math inline">\(Python\)</span>&#x4F1A;&#x81EA;&#x52A8;&#x8C03;&#x7528;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x6765;&#x521D;&#x59CB;&#x5316;&#x5BF9;&#x8C61;&#x7684;&#x5C5E;&#x6027;&#x3002;</p>
</blockquote>
<p>&#x2003;&#x2003;&#x8FD9;&#x91CC;&#x7684;&#x53C2;&#x6570;<code>account_holder</code>&#x662F;&#x5C40;&#x90E8;&#x540D;&#x79F0;&#x3002;&#x4F46;<strong>&#x901A;&#x8FC7;&#x70B9;&#x6807;&#x8BB0;&#xFF0C;<code>account_holder</code>&#x88AB;&#x7ED1;&#x5B9A;&#x5230;&#x4E86;&#x8D4B;&#x503C;&#x8BED;&#x53E5;&#x4E0A;</strong>&#xFF0C;&#x56E0;&#x4E3A;&#x6B64;&#x65F6;<code>account_holder</code>&#x4F5C;&#x4E3A;<code>self</code>&#x7684;&#x5C5E;&#x6027;&#x88AB;&#x5B58;&#x50A8;&#x4E86;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5177;&#x4F53;&#x5316;<span class="math inline">\(Account\)</span>&#x7C7B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5177;&#x4F53;&#x7684;&#x7C7B;&#x7684;&#x5B9E;&#x4F8B;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = Account(<span class="string">&apos;Kirk&apos;</span>)</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x4E2A;&#x5BF9;&#x7C7B;&#x7684;&#x8C03;&#x7528;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x7684;<strong>&#x5BF9;&#x8C61;</strong>&#xFF0C;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x662F;&#x7C7B;&#x7684;&#x4E00;&#x4E2A;<strong>&#x5B9E;&#x4F8B;(<span class="math inline">\(instance\)</span>)</strong>&#x3002;<code>__init__</code>&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;<code>self</code>&#x4E0E;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x7ED1;&#x5B9A;&#x4E86;&#xFF0C;&#x4F20;&#x5165;&#x7684;&#x662F;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x7684;&#x503C;&#x3002;&#x8FD9;&#x6837;&#x4E4B;&#x540E;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x5B9E;&#x4F8B;&#x7684;&#x5C5E;&#x6027;&#x4E86;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.balance</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.holder</span><br><span class="line"><span class="string">&apos;Kirk&apos;</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x6BCF;&#x4E2A;&#x72EC;&#x7ACB;&#x58F0;&#x660E;&#x7684;&#x7C7B;&#x7684;&#x5B9E;&#x4F8B;&#x90FD;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x72EC;&#x7279;&#x8EAB;&#x4EFD;(<span class="math inline">\(identity\)</span>)&#xFF0C;&#x4F8B;&#x5982;&#x4EE5;&#x4E0B;&#x8BED;&#x53E5;&#x6240;&#x5C55;&#x793A;&#x7684;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = Account(<span class="string">&apos;Spock&apos;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b.balance = <span class="number">200</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[acc.balance <span class="keyword">for</span> acc <span class="keyword">in</span> (a, b)]</span><br><span class="line">[<span class="number">0</span>, <span class="number">200</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a <span class="keyword">is</span> a</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a <span class="keyword">is</span> <span class="keyword">not</span> b</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure></p>
<h4 id="b&#x65B9;&#x6CD5;&#x7684;&#x58F0;&#x660E;">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>&#x65B9;&#x6CD5;&#x7684;&#x58F0;&#x660E;</h4>
<p>&#x2003;&#x2003;&#x5728;<code>class</code>&#x8BED;&#x53E5;&#x5185;&#x90E8;&#x4F7F;&#x7528;<code>def</code>&#x8BED;&#x53E5;&#x5373;&#x53EF;&#x58F0;&#x660E;&#x7C7B;&#x7684;&#x65B9;&#x6CD5;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">class</span> <span class="title class_">Account</span>:</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, account_holder</span>):</span><br><span class="line">            self.balance = <span class="number">0</span></span><br><span class="line">            self.holder = account_holder</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">deposit</span>(<span class="params">self, amount</span>):</span><br><span class="line">            self.balance = self.balance + amount</span><br><span class="line">            <span class="keyword">return</span> self.balance</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">withdraw</span>(<span class="params">self, amount</span>):</span><br><span class="line">            <span class="keyword">if</span> amount &gt; self.balance:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&apos;Insufficient funds&apos;</span></span><br><span class="line">            self.balance = self.balance - amount</span><br><span class="line">            <span class="keyword">return</span> self.balance</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x867D;&#x7136;&#x65B9;&#x6CD5;&#x7684;&#x5B9A;&#x4E49;&#x4E0E;&#x666E;&#x901A;&#x51FD;&#x6570;&#x7684;&#x5B9A;&#x4E49;&#x6CA1;&#x6709;&#x5DEE;&#x522B;&#xFF0C;&#x4F46;&#x5B83;&#x4EEC;&#x6267;&#x884C;&#x540E;&#x4EA7;&#x751F;&#x7684;&#x5F71;&#x54CD;&#x5374;&#x4E0D;&#x4E00;&#x6837;&#x3002;&#x5728;<code>class</code>&#x8BED;&#x53E5;&#x4E0B;&#x5B9A;&#x4E49;&#x7684;<code>def</code>&#x8BED;&#x53E5;<strong>&#x4F5C;&#x4E3A;&#x5C5E;&#x6027;&#x5728;&#x7C7B;&#x4E2D;&#x5C40;&#x90E8;&#x7ED1;&#x5B9A;</strong>&#x3002;&#x4F8B;&#x5982;&#x4E0B;&#x9762;&#x5BF9;<span class="math inline">\(Account\)</span>&#x65B9;&#x6CD5;&#x7684;&#x8C03;&#x7528;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>spock_account = Account(<span class="string">&apos;Spock&apos;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>spock_account.deposit(<span class="number">100</span>)</span><br><span class="line"><span class="number">100</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>spock_account.withdraw(<span class="number">90</span>)</span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>spock_account.withdraw(<span class="number">90</span>)</span><br><span class="line"><span class="string">&apos;Insufficient funds&apos;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>spock_account.holder</span><br><span class="line"><span class="string">&apos;Spock&apos;</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x6BCF;&#x4E2A;&#x65B9;&#x6CD5;&#x7684;<strong>&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x90FD;&#x662F;<code>self</code>&#xFF0C;&#x8868;&#x793A;&#x8C03;&#x7528;&#x8BE5;&#x65B9;&#x6CD5;&#x7684;&#x5BF9;&#x8C61;</strong>&#x3002;&#x5F53;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x901A;&#x8FC7;&#x70B9;&#x6807;&#x8BB0;&#x88AB;&#x8C03;&#x7528;&#x540E;&#xFF0C;&#x5BF9;&#x8C61;&#x6267;&#x884C;&#x4E86;&#x4E24;&#x4E2A;&#x529F;&#x80FD;&#xFF1A;</p>
<ul>
<li><strong>&#x51B3;&#x5B9A;&#x5BF9;&#x5E94;&#x7684;&#x65B9;&#x6CD5;&#x5177;&#x4F53;&#x662F;&#x4EC0;&#x4E48;</strong>&#x3002;&#x4F8B;&#x5982;&#x793A;&#x4F8B;&#x4E2D;&#x7684;<code>withdraw</code>&#xFF0C;&#x8FD9;&#x91CC;&#x7684;<code>withdraw</code>&#x662F;&#x7C7B;&#x4E2D;&#x7684;&#x5C40;&#x90E8;&#x540D;&#x79F0;&#x3002;</li>
<li><strong>&#x4F5C;&#x4E3A;&#x65B9;&#x6CD5;&#x7684;&#x7279;&#x6B8A;&#x53C2;&#x6570;</strong>&#x3002;</li>
</ul>
<h2 id="&#x4E09;-&#x4FE1;&#x606F;&#x4F20;&#x9012;&#x4E0E;&#x70B9;&#x8868;&#x8FBE;&#x5F0F;">&#x4E09;&#x3001;&#x4FE1;&#x606F;&#x4F20;&#x9012;&#x4E0E;&#x70B9;&#x8868;&#x8FBE;&#x5F0F;</h2>
<h3 id="1&#x7C7B;&#x4E2D;&#x7684;&#x4FE1;&#x606F;&#x4F20;&#x9012;&#x6A21;&#x5F0F;">1.&#x7C7B;&#x4E2D;&#x7684;&#x4FE1;&#x606F;&#x4F20;&#x9012;&#x6A21;&#x5F0F;</h3>
<p>&#x2003;&#x2003;&#x5728;&#x7C7B;&#x4E2D;&#xFF0C;&#x5BF9;&#x8C61;&#x901A;&#x8FC7;&#x70B9;&#x6807;&#x8BB0;&#x63A5;&#x53D7;&#x4FE1;&#x606F;&#xFF0C;&#x4F46;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x4E0D;&#x518D;&#x662F;&#x5206;&#x6D3E;&#x5B57;&#x5178;&#x4E2D;&#x7684;&#x5B57;&#x7B26;&#x4E32;<code>key</code>&#x4E86;&#xFF0C;&#x800C;&#x662F;&#x7C7B;&#x5C40;&#x90E8;&#x4E0B;&#x7684;&#x540D;&#x79F0;&#x3002;&#x540C;&#x65F6;&#x7C7B;&#x4E5F;&#x6709;&#x5C40;&#x90E8;&#x72B6;&#x6001;&#x7684;&#x503C;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8FD0;&#x7528;&#x70B9;&#x6807;&#x8BB0;&#x6765;&#x8BBF;&#x95EE;&#x4E0E;&#x64CD;&#x4F5C;&#x5B83;&#x4EEC;&#x3001;&#x800C;&#x4E0D;&#x9700;&#x8981;<code>nonlocal</code>&#x8BED;&#x53E5;&#x3002;</p>
<h3 id="2&#x7C7B;&#x7684;&#x5C5E;&#x6027;&#x7684;&#x5B9E;&#x73B0;">2.&#x7C7B;&#x7684;&#x5C5E;&#x6027;&#x7684;&#x5B9E;&#x73B0;</h3>
<p>&#x2003;&#x2003;&#x7C7B;&#x7684;&#x5C5E;&#x6027;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7B80;&#x5355;&#x7684;&#x8D4B;&#x503C;&#x8BED;&#x53E5;&#x5B9E;&#x73B0;&#xFF0C;&#x4F8B;&#x5982;&#x4E0B;&#x9762;&#x5BF9;<span class="math inline">\(Account\)</span>&#x7C7B;&#x7684;<code>interest</code>&#x5C5E;&#x6027;&#x7684;&#x8D4B;&#x503C;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">class</span> <span class="title class_">Account</span>:</span><br><span class="line">        interest = <span class="number">0.02</span>            <span class="comment"># A class attribute</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, account_holder</span>):</span><br><span class="line">            self.balance = <span class="number">0</span></span><br><span class="line">            self.holder = account_holder</span><br><span class="line">        <span class="comment"># Additional methods would be defined here</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x4E2A;&#x5C5E;&#x6027;&#x53EF;&#x4EE5;<strong>&#x88AB;&#x6240;&#x6709;&#x8BE5;&#x7C7B;&#x7684;&#x5B9E;&#x4F8B;&#x83B7;&#x53D6;</strong>&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>spock_account = Account(<span class="string">&apos;Spock&apos;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>kirk_account = Account(<span class="string">&apos;Kirk&apos;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>spock_account.interest</span><br><span class="line"><span class="number">0.02</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>kirk_account.interest</span><br><span class="line"><span class="number">0.02</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x540C;&#x6837;&#x5730;&#xFF0C;<strong>&#x5F53;&#x7C7B;&#x7684;&#x5C5E;&#x6027;&#x88AB;&#x6539;&#x53D8;&#x4E86;&#xFF0C;&#x6240;&#x6709;&#x8BE5;&#x7C7B;&#x7684;&#x5B9E;&#x4F8B;&#x7684;&#x8FD9;&#x4E00;&#x5C5E;&#x6027;&#x90FD;&#x4F1A;&#x6539;&#x53D8;</strong>&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Account.interest = <span class="number">0.04</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>spock_account.interest</span><br><span class="line"><span class="number">0.04</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>kirk_account.interest</span><br><span class="line"><span class="number">0.04</span></span><br></pre></td></tr></table></figure></p>
<h3 id="2&#x70B9;&#x8868;&#x8FBE;&#x5F0F;">2.&#x70B9;&#x8868;&#x8FBE;&#x5F0F;</h3>
<p>&#x2003;&#x2003;&#x70B9;&#x8868;&#x8FBE;&#x5F0F;&#x662F;&#x5F62;&#x5982;&#x4EE5;&#x4E0B;&#x7684;&#x8BED;&#x53E5;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;expression&gt;.&lt;name&gt;</span><br></pre></td></tr></table></figure>
&#x2003;&#x2003;&#x4E00;&#x4E2A;&#x70B9;&#x8868;&#x8FBE;&#x5F0F;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x548C;&#x4E00;&#x4E2A;&#x5C5E;&#x6027;&#x7684;&#x540D;&#x5B57;(&#x901A;&#x8FC7;<code>&lt;expression&gt;</code>&#x8868;&#x8FBE;&#x5F0F;&#x5F97;&#x51FA;)&#x6765;&#x8BBF;&#x95EE;&#x5BF9;&#x8C61;&#x7684;&#x5C5E;&#x6027;&#x3001;&#x5E76;&#x8FD4;&#x56DE;&#x8BE5;&#x5C5E;&#x6027;&#x7684;&#x503C;&#x3002;</p>
<p>&#x2003;&#x2003;&#x540C;&#x65F6;&#xFF0C;&#x901A;&#x8FC7;&#x5185;&#x7F6E;&#x51FD;&#x6570;<code>getattr</code>&#x4E5F;&#x53EF;&#x7528;&#x5B57;&#x7B26;&#x4E32;&#x8BBF;&#x95EE;&#x5BF9;&#x8C61;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x50CF;&#x5206;&#x6D3E;&#x5B57;&#x5178;&#x91CC;&#x7684;&#x90A3;&#x6837;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">getattr</span>(spock_account, <span class="string">&apos;balance&apos;</span>)</span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;<code>getattr</code>&#x51FD;&#x6570;&#x8FD8;&#x53EF;&#x4EE5;&#x6D4B;&#x8BD5;&#x5BF9;&#x8C61;&#x4E2D;&#x6709;&#x65E0;&#x67D0;&#x79CD;&#x5C5E;&#x6027;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hasattr</span>(spock_account, <span class="string">&apos;deposit&apos;</span>)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure></p>
<h3 id="3&#x65B9;&#x6CD5;&#x4E0E;&#x51FD;&#x6570;&#x7684;&#x5DEE;&#x5F02;">3.&#x65B9;&#x6CD5;&#x4E0E;&#x51FD;&#x6570;&#x7684;&#x5DEE;&#x5F02;</h3>
<p>&#x2003;&#x2003;&#x5F53;&#x67D0;&#x4E2A;&#x5BF9;&#x8C61;&#x8C03;&#x7528;&#x4E86;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x4F1A;&#x76F4;&#x63A5;&#x4F5C;&#x4E3A;&#x8BE5;&#x65B9;&#x6CD5;&#x7B2C;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x53C2;&#x6570;&#x3002;&#x8FD9;&#x6837;&#x65B9;&#x6CD5;&#x7684;&#x7279;&#x6B8A;&#x53C2;&#x6570;<code>self</code>&#x4E0E;&#x5BF9;&#x8C61;&#x5C31;&#x5F97;&#x5230;&#x4E86;&#x7ED1;&#x5B9A;&#x3002;</p>
<p>&#x2003;&#x2003;&#x4E3A;&#x4E86;&#x5B9E;&#x73B0;&#x8FD9;&#x79CD;&#x81EA;&#x52A8;&#x7ED1;&#x5B9A;&#xFF0C;<span class="math inline">\(python\)</span>&#x5BF9;&#x65B9;&#x6CD5;&#x4E0E;&#x51FD;&#x6570;&#x8FDB;&#x884C;&#x4E86;&#x533A;&#x5206;&#x3002;&#x5229;&#x7528;<code>type</code>&#x51FD;&#x6570;&#x8FD0;&#x884C;&#x5982;&#x4E0B;&#x7A0B;&#x5E8F;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(Account.deposit)</span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">&apos;function&apos;</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(spock_account.deposit)</span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">&apos;method&apos;</span>&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="&#x56DB;-&#x7C7B;&#x7684;&#x5C5E;&#x6027;">&#x56DB;&#x3001;&#x7C7B;&#x7684;&#x5C5E;&#x6027;</h2>
<h3 id="1&#x7C7B;&#x7684;&#x5C5E;&#x6027;&#x7684;&#x6982;&#x5FF5;">1.&#x7C7B;&#x7684;&#x5C5E;&#x6027;&#x7684;&#x6982;&#x5FF5;</h3>
<p>&#x2003;&#x2003;&#x6709;&#x7684;&#x7C7B;&#x4E2D;&#x7684;&#x5C5E;&#x6027;&#x4F1A;&#x88AB;&#x6240;&#x6709;&#x5C5E;&#x4E8E;&#x8BE5;&#x7C7B;&#x7684;&#x5BF9;&#x8C61;&#x5171;&#x4EAB;&#xFF0C;&#x8FD9;&#x79CD;&#x5C5E;&#x6027;&#x662F;&#x4E0E;&#x7C7B;&#x76F4;&#x63A5;&#x8FDE;&#x63A5;&#x7684;&#x3001;&#x5E76;&#x4E0D;&#x662F;&#x4E0E;&#x67D0;&#x4E2A;&#x5355;&#x72EC;&#x7684;&#x7C7B;&#x7684;&#x5B9E;&#x4F8B;&#x76F8;&#x8FDE;&#x3002;</p>
<h3 id="3&#x7C7B;&#x7684;&#x5C5E;&#x6027;&#x7684;&#x8BBF;&#x95EE;">3.&#x7C7B;&#x7684;&#x5C5E;&#x6027;&#x7684;&#x8BBF;&#x95EE;</h3>
<p>&#x2003;&#x2003;&#x7C7B;&#x7684;&#x5C5E;&#x6027;&#x7684;&#x8BBF;&#x95EE;&#x4E5F;&#x53EF;&#x901A;&#x8FC7;&#x70B9;&#x8868;&#x8FBE;&#x5F0F;&#x5B9E;&#x73B0;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;expression&gt;.&lt;name&gt;</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8BBF;&#x95EE;&#x7C7B;&#x7684;&#x5C5E;&#x6027;&#x9075;&#x5FAA;&#x4EE5;&#x4E0B;&#x8FC7;&#x7A0B;&#xFF1A;</p>
<ul>
<li>&#x8BA1;&#x7B97;<code>&lt;expression&gt;</code>&#xFF0C;&#x7136;&#x540E;&#x5F97;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x5BF9;&#x8C61;&#x3002;</li>
<li><code>&lt;name&gt;</code>&#x968F;&#x540E;&#x5BF9;&#x5E94;&#x5230;&#x8BE5;&#x5BF9;&#x8C61;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x5982;&#x679C;&#x8BE5;&#x5BF9;&#x8C61;&#x5BF9;&#x5E94;&#x5C5E;&#x6027;&#x5B58;&#x5728;&#xFF0C;&#x5C31;&#x8FD4;&#x56DE;&#x8BE5;&#x5C5E;&#x6027;&#x3002;</li>
<li>&#x5982;&#x679C;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;<code>&lt;name&gt;</code>&#x5C31;&#x4F1A;&#x53BB;&#x7C7B;&#x4E2D;&#x5BFB;&#x627E;&#x5BF9;&#x5E94;&#x5C5E;&#x6027;&#xFF0C;&#x5E76;&#x8BFB;&#x53D6;&#x5BF9;&#x5E94;&#x5C5E;&#x6027;&#x3002;</li>
<li>&#x5982;&#x679C;&#x8FD9;&#x4E2A;&#x5C5E;&#x6027;&#x662F;&#x65B9;&#x6CD5;&#xFF0C;&#x5C31;&#x8FD4;&#x56DE;&#x5BF9;&#x5E94;&#x51FD;&#x6570;&#xFF1B;&#x5426;&#x5219;&#x8FD4;&#x56DE;&#x5BF9;&#x5E94;&#x503C;&#x3002;</li>
</ul>
<p>&#x2003;&#x2003;&#x5728;&#x8FD9;&#x4E00;&#x6D41;&#x7A0B;&#x4E2D;&#xFF0C;&#x5B9E;&#x4F8B;&#x81EA;&#x5DF1;&#x7684;&#x5C5E;&#x6027;&#x5148;&#x4E8E;&#x7C7B;&#x7684;&#x5C5E;&#x6027;&#x88AB;&#x67E5;&#x627E;&#xFF0C;&#x8FD9;&#x4E0E;&#x5C40;&#x90E8;&#x73AF;&#x5883;&#x5BF9;&#x5168;&#x5C40;&#x73AF;&#x5883;&#x5177;&#x6709;&#x4F18;&#x5148;&#x7EA7;&#x76F8;&#x7C7B;&#x4F3C;</p>
<h3 id="4&#x7C7B;&#x7684;&#x5C5E;&#x6027;&#x7684;&#x8D4B;&#x503C;&#x89C4;&#x5219;">4.&#x7C7B;&#x7684;&#x5C5E;&#x6027;&#x7684;&#x8D4B;&#x503C;&#x89C4;&#x5219;</h3>
<p>&#x2003;&#x2003;&#x5728;&#x7C7B;&#x7684;&#x8D4B;&#x503C;&#x8BED;&#x53E5;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x5BF9;&#x8C61;&#x662F;&#x7C7B;&#x7684;&#x8BDD;&#xFF0C;&#x8D4B;&#x503C;&#x8BED;&#x53E5;&#x5C31;&#x4F1A;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x7C7B;&#x7684;&#x5C5E;&#x6027;&#xFF1B;&#x5982;&#x679C;&#x5BF9;&#x8C61;&#x662F;&#x5B9E;&#x4F8B;&#x7684;&#x8BDD;&#xFF0C;&#x8D4B;&#x503C;&#x8BED;&#x53E5;&#x5C31;&#x4F1A;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#x7684;&#x5C5E;&#x6027;&#x3002;<strong>&#x5BF9;&#x5B9E;&#x4F8B;&#x5C5E;&#x6027;&#x7684;&#x6539;&#x53D8;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x7C7B;&#x7684;&#x5C5E;&#x6027;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5BF9;&#x5B9E;&#x4F8B;&#x7684;&#x5C5E;&#x6027;&#x91CD;&#x65B0;&#x8D4B;&#x503C;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>kirk_account.interest = <span class="number">0.08</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>kirk_account.interest</span><br><span class="line"><span class="number">0.08</span></span><br></pre></td></tr></table></figure>
&#x2003;&#x2003;&#x4F46;&#x662F;&#xFF0C;&#x7C7B;&#x7684;&#x5C5E;&#x6027;&#x4F9D;&#x7136;&#x4E0D;&#x53D8;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>spock_account.interest</span><br><span class="line"><span class="number">0.04</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;<strong>&#x6539;&#x53D8;&#x7C7B;&#x7684;&#x5C5E;&#x6027;&#x540E;&#xFF0C;&#x8BE5;&#x5B9E;&#x4F8B;&#x7684;&#x5C5E;&#x6027;&#x4E5F;&#x4E0D;&#x4F1A;&#x88AB;&#x5F71;&#x54CD;</strong>&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Account.interest = <span class="number">0.05</span>  <span class="comment"># changing the class attribute</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>spock_account.interest     <span class="comment"># changes instances without like-named instance attributes</span></span><br><span class="line"><span class="number">0.05</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>kirk_account.interest     <span class="comment"># but the existing instance attribute is unaffected</span></span><br><span class="line"><span class="number">0.08</span></span><br></pre></td></tr></table></figure></p>
<h2 id="&#x4E94;-&#x7EE7;&#x627F;">&#x4E94;&#x3001;&#x7EE7;&#x627F;</h2>
<h3 id="1&#x7EE7;&#x627F;&#x7684;&#x6982;&#x5FF5;">1.&#x7EE7;&#x627F;&#x7684;&#x6982;&#x5FF5;</h3>
<p>&#x2003;&#x2003;&#x5728;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x7684;&#x7F16;&#x7A0B;&#x4E2D;&#xFF0C;&#x4E24;&#x4E2A;&#x7C7B;&#x53EF;&#x80FD;&#x6709;&#x76F8;&#x4F3C;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x4F46;&#x4E00;&#x4E2A;&#x662F;&#x53E6;&#x4E00;&#x4E2A;&#x7684;&#x7279;&#x6B8A;&#x4F8B;&#x5B50;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x60F3;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x8DDF;&#x5148;&#x524D;&#x7684;<span class="math inline">\(Account\)</span>&#x4E0D;&#x540C;&#x7684;<span class="math inline">\(CheckingAccount\)</span>&#xFF0C;&#x8BE5;&#x7C7B;&#x7684;&#x7279;&#x6B8A;&#x5982;&#x4E0B;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ch = CheckingAccount(<span class="string">&apos;Spock&apos;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ch.interest     <span class="comment"># Lower interest rate for checking accounts</span></span><br><span class="line"><span class="number">0.01</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ch.deposit(<span class="number">20</span>)  <span class="comment"># Deposits are the same</span></span><br><span class="line"><span class="number">20</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ch.withdraw(<span class="number">5</span>)  <span class="comment"># withdrawals decrease balance by an extra charge</span></span><br><span class="line"><span class="number">14</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x91CC;&#x7684;<span class="math inline">\(CheckingAccount\)</span>&#x662F;<span class="math inline">\(Account\)</span>&#x7684;&#x7279;&#x6B8A;&#x5316;&#x3002;&#x5728;<span class="math inline">\(OOP\)</span>&#x672F;&#x8BED;&#x4E2D;&#xFF0C;<strong>&#x666E;&#x904D;&#x7684;&#x7C7B;<span class="math inline">\(Account\)</span>&#x662F;<span class="math inline">\(CheckingAccount\)</span>&#x7684;&#x57FA;&#x51C6;&#x7C7B;&#xFF0C;&#x800C;<span class="math inline">\(CheckingAccount\)</span>&#x662F;<span class="math inline">\(Account\)</span>&#x7684;&#x5B50;&#x7C7B;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x5B50;&#x7C7B;<strong>&#x4F1A;&#x7EE7;&#x627F;&#x57FA;&#x51C6;&#x7C7B;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x4F46;&#x4F1A;&#x8986;&#x76D6;&#x539F;&#x6709;&#x7684;&#x4E00;&#x4E9B;&#x5C5E;&#x6027;&#xFF0C;&#x5305;&#x62EC;&#x4E00;&#x4E9B;&#x65B9;&#x6CD5;</strong>&#x3002;&#x5728;&#x7EE7;&#x627F;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x5177;&#x4F53;&#x8BF4;&#x660E;&#x5B50;&#x7C7B;&#x4E0E;&#x57FA;&#x51C6;&#x7C7B;&#x7684;&#x5DEE;&#x522B;&#xFF0C;&#x5269;&#x4F59;&#x7684;&#x5C31;&#x9ED8;&#x8BA4;&#x4E0E;&#x57FA;&#x51C6;&#x7C7B;&#x4E00;&#x81F4;&#x3002;</p>
<p>&#x2003;&#x2003;&#x7EE7;&#x627F;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x5BF9;&#x8C61;&#x9690;&#x55BB;&#x4E2D;&#x4E5F;&#x6709;&#x7740;&#x91CD;&#x8981;&#x4F5C;&#x7528;&#xFF0C;&#x5B83;<strong>&#x63ED;&#x793A;&#x4E86;&#x5BF9;&#x8C61;&#x95F4;&#x7684;<code>is-a</code>&#x5173;&#x7CFB;</strong>&#x3002;&#x4F8B;&#x5982;<span class="math inline">\(CheckingAccount\)</span><code>is-a</code><span class="math inline">\(Account\)</span>&#x7684;&#x4E00;&#x79CD;&#x7279;&#x6B8A;&#x5F62;&#x5F0F;&#xFF0C;&#x90A3;&#x4E48;&#x7EE7;&#x627F;&#x7684;&#x64CD;&#x4F5C;&#x5C31;&#x987A;&#x7406;&#x6210;&#x7AE0;&#x4E86;&#x3002;&#x800C;&#x5982;&#x679C;&#x4E24;&#x8005;&#x53EA;&#x662F;&#x5355;&#x7EAF;&#x7684;<code>has-a</code>&#x5173;&#x7CFB;&#xFF0C;&#x90A3;&#x4E48;&#x4E24;&#x8005;&#x4E0D;&#x5E94;&#x6709;&#x7EE7;&#x627F;&#x5173;&#x7CFB;&#x3002;</p>
<h3 id="2&#x7EE7;&#x627F;&#x64CD;&#x4F5C;&#x7684;&#x5B9E;&#x73B0;">2.&#x7EE7;&#x627F;&#x64CD;&#x4F5C;&#x7684;&#x5B9E;&#x73B0;</h3>
<p>&#x2003;&#x2003;&#x9996;&#x5148;&#x6211;&#x4EEC;&#x7ED9;&#x51FA;&#x57FA;&#x51C6;&#x7C7B;&#x7684;&#x5B9E;&#x73B0;&#x4F5C;&#x4E3A;&#x57FA;&#x7840;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">class</span> <span class="title class_">Account</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;A bank account that has a non-negative balance.&quot;&quot;&quot;</span></span><br><span class="line">        interest = <span class="number">0.02</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, account_holder</span>):</span><br><span class="line">            self.balance = <span class="number">0</span></span><br><span class="line">            self.holder = account_holder</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">deposit</span>(<span class="params">self, amount</span>):</span><br><span class="line">            <span class="string">&quot;&quot;&quot;Increase the account balance by amount and return the new balance.&quot;&quot;&quot;</span></span><br><span class="line">            self.balance = self.balance + amount</span><br><span class="line">            <span class="keyword">return</span> self.balance</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">withdraw</span>(<span class="params">self, amount</span>):</span><br><span class="line">            <span class="string">&quot;&quot;&quot;Decrease the account balance by amount and return the new balance.&quot;&quot;&quot;</span></span><br><span class="line">            <span class="keyword">if</span> amount &gt; self.balance:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&apos;Insufficient funds&apos;</span></span><br><span class="line">            self.balance = self.balance - amount</span><br><span class="line">            <span class="keyword">return</span> self.balance</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x76F8;&#x5E94;&#x5730;&#x5BF9;<span class="math inline">\(CheckingAccount\)</span>&#x7684;&#x5B9E;&#x73B0;&#x5982;&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;<code>&lt;name&gt; + &lt;value&gt;/def</code>&#x7684;&#x5F62;&#x5F0F;&#x5B9A;&#x4E49;<span class="math inline">\(CheckingAccount\)</span>&#x72EC;&#x6709;&#x7684;&#x5C5E;&#x6027;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">class</span> <span class="title class_">CheckingAccount</span>(<span class="title class_ inherited__">Account</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;A bank account that charges for withdrawals.&quot;&quot;&quot;</span></span><br><span class="line">        withdraw_charge = <span class="number">1</span></span><br><span class="line">        interest = <span class="number">0.01</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">withdraw</span>(<span class="params">self, amount</span>):</span><br><span class="line">            <span class="keyword">return</span> Account.withdraw(self, amount + self.withdraw_charge)</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x4E0B;&#x9762;&#x662F;&#x8BE5;&#x5B50;&#x7C7B;&#x5BF9;&#x5E94;&#x5C5E;&#x6027;&#x7684;&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>checking = CheckingAccount(<span class="string">&apos;Sam&apos;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>checking.deposit(<span class="number">10</span>)</span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>checking.withdraw(<span class="number">5</span>)</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>checking.interest</span><br><span class="line"><span class="number">0.01</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x5F97;&#x51FA;&#x5728;&#x5B50;&#x7C7B;&#x4E2D;&#x67E5;&#x627E;<code>&lt;name&gt;</code>&#x7684;&#x6D41;&#x7A0B;&#xFF1A; *
&#x5982;&#x679C;&#x8FD9;&#x4E2A;&#x540D;&#x79F0;<strong>&#x5728;&#x5B50;&#x7C7B;&#x4E2D;&#xFF0C;&#x5C31;&#x8F93;&#x51FA;&#x5BF9;&#x5E94;&#x5C5E;&#x6027;&#x7684;&#x503C;</strong>&#x3002; *
&#x5426;&#x5219;&#xFF0C;<strong>&#x5728;&#x57FA;&#x51C6;&#x7C7B;&#x4E2D;&#x627E;&#x8FD9;&#x4E2A;&#x540D;&#x79F0;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x4F8B;&#x5982;&#x8BE5;&#x4F8B;&#x4E2D;&#x7684;<code>deposit</code>&#x5C5E;&#x6027;&#xFF0C;&#x7531;&#x4E8E;&#x53EA;&#x5728;&#x57FA;&#x51C6;&#x7C7B;&#x4E2D;&#x5F97;&#x5230;&#x5B9A;&#x4E49;&#xFF0C;&#x56E0;&#x6B64;&#x5B50;&#x7C7B;&#x5C5E;&#x6027;&#x7684;&#x6267;&#x884C;&#x4E0E;&#x57FA;&#x51C6;&#x7C7B;&#x5C5E;&#x6027;&#x7684;&#x6267;&#x884C;&#x76F8;&#x4E00;&#x81F4;&#x3002;</p>
<p>&#x2003;&#x2003;<strong>&#x5373;&#x4F7F;&#x5B50;&#x7C7B;&#x8986;&#x76D6;&#x4E86;&#x57FA;&#x51C6;&#x7C7B;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x5B50;&#x7C7B;&#x4F9D;&#x7136;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x57FA;&#x51C6;&#x7C7B;&#x7684;&#x5C5E;&#x6027;&#x3002;</strong>&#x4F8B;&#x5982;&#x5B9E;&#x73B0;&#x5B50;&#x7C7B;&#x7684;<code>withdraw</code>&#x51FD;&#x6570;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x8C03;&#x7528;&#x4E86;&#x57FA;&#x51C6;&#x7C7B;&#x7684;<code>withdraw</code>&#x3002;</p>
<p>&#x2003;&#x2003;&#x6CE8;&#x610F;&#x5230;&#x6211;&#x4EEC;&#x8C03;&#x7528;&#x7684;&#x662F;<code>self.withdraw_charge</code>&#x800C;&#x975E;<code>CheckingAccount.withdraw_charge</code>&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x65E0;&#x6CD5;&#x786E;&#x5B9A;&#x6B64;&#x65F6;&#x7684;<code>self</code>&#x4E00;&#x5B9A;&#x662F;<code>CheckingAccount</code>&#xFF0C;&#x8FD9;&#x6837;&#x786E;&#x4FDD;&#x4E86;&#x4E07;&#x65E0;&#x4E00;&#x5931;&#x3002;</p>
<h3 id="3&#x63A5;&#x53E3;">3.&#x63A5;&#x53E3;</h3>
<p>&#x2003;&#x2003;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x63A5;&#x53E3;(<span class="math inline">\(object\;interface\)</span>)&#x662F;<strong>&#x4E00;&#x4E9B;&#x88AB;&#x5171;&#x4EAB;&#x7684;&#x5C5E;&#x6027;&#x7684;&#x96C6;&#x5408;</strong>&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5BF9;&#x4E8E;&#x6240;&#x6709;&#x7684;<code>account</code>&#xFF0C;&#x90FD;&#x4F1A;&#x6709;<code>deposit</code>&#x4E0E;<code>withdraw</code>&#x65B9;&#x6CD5;&#x548C;<code>balance</code>&#x5C5E;&#x6027;&#x3002;<span class="math inline">\(Account\)</span>&#x7C7B;&#x548C;<span class="math inline">\(CheckingAccount\)</span>&#x7C7B;&#x90FD;&#x5B9E;&#x73B0;&#x4E86;&#x8FD9;&#x4E00;&#x63A5;&#x53E3;&#x3002;&#x800C;&#x7EE7;&#x627F;&#x901A;&#x8FC7;&#x8FD9;&#x4E00;&#x65B9;&#x5F0F;&#x4FC3;&#x8FDB;&#x4E86;&#x540D;&#x79F0;&#x7684;&#x5171;&#x4EAB;&#x3002;</p>
<h2 id="&#x516D;-&#x591A;&#x91CD;&#x7EE7;&#x627F;">&#x516D;&#x3001;&#x591A;&#x91CD;&#x7EE7;&#x627F;</h2>
<h3 id="1&#x591A;&#x91CD;&#x7EE7;&#x627F;&#x7684;&#x6982;&#x5FF5;&#x4E0E;&#x5B9E;&#x73B0;">1.&#x591A;&#x91CD;&#x7EE7;&#x627F;&#x7684;&#x6982;&#x5FF5;&#x4E0E;&#x5B9E;&#x73B0;</h3>
<p>&#x2003;&#x2003;<span class="math inline">\(python\)</span>&#x652F;&#x6301;&#x4E00;&#x4E2A;&#x7EE7;&#x627F;&#x4E0D;&#x540C;&#x57FA;&#x51C6;&#x7C7B;&#x7684;&#x5B50;&#x7C7B;&#x7684;&#x5B9E;&#x73B0;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x5DF2;&#x77E5;&#x4E00;&#x4E2A;&#x7EE7;&#x627F;<span class="math inline">\(Account\)</span>&#x7684;<span class="math inline">\(SavingAccount\)</span>&#xFF0C;&#x5B83;&#x4F1A;&#x5728;&#x6BCF;&#x6B21;<code>deposit</code>&#x65F6;&#x6536;&#x53D6;&#x4E00;&#x5B9A;&#x8D39;&#x7528;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">class</span> <span class="title class_">SavingsAccount</span>(<span class="title class_ inherited__">Account</span>):</span><br><span class="line">        deposit_charge = <span class="number">2</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">deposit</span>(<span class="params">self, amount</span>):</span><br><span class="line">            <span class="keyword">return</span> Account.deposit(self, amount - self.deposit_charge)</span><br></pre></td></tr></table></figure> &#x2003;&#x2003;&#x8FD9;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x8981;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x57FA;&#x4E8E;<span class="math inline">\(SavingAccount\)</span>&#x4E0E;<span class="math inline">\(CheckingAccount\)</span>&#x7684;&#x65B0;<code>account</code><span class="math inline">\(AsSeenOnTVAccount\)</span>&#xFF0C;&#x5B83;&#x540C;&#x65F6;&#x5B9E;&#x73B0;<code>check</code>&#x4E0E;<code>save</code>&#x529F;&#x80FD;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<strong>&#x7EE7;&#x627F;&#x4E24;&#x4E2A;&#x7C7B;</strong>&#x6765;&#x5B9E;&#x73B0;&#x8FD9;&#x4E00;&#x4E2A;&#x7C7B;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">class</span> <span class="title class_">AsSeenOnTVAccount</span>(CheckingAccount, SavingsAccount):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, account_holder</span>):</span><br><span class="line">            self.holder = account_holder</span><br><span class="line">            self.balance = <span class="number">1</span>           <span class="comment"># A free dollar!</span></span><br></pre></td></tr></table></figure>
&#x2003;&#x2003;&#x8FD9;&#x6837;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x8BE5;&#x5B50;&#x7C7B;&#x7684;&#x5176;&#x5B83;&#x90E8;&#x5206;&#x53EF;&#x501F;&#x52A9;&#x7EE7;&#x627F;&#x7684;&#x7C7B;&#x6765;&#x5B9E;&#x73B0;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>such_a_deal = AsSeenOnTVAccount(<span class="string">&quot;John&quot;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>such_a_deal.balance</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>such_a_deal.deposit(<span class="number">20</span>)            <span class="comment"># $2 fee from SavingsAccount.deposit</span></span><br><span class="line"><span class="number">19</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>such_a_deal.withdraw(<span class="number">5</span>)            <span class="comment"># $1 fee from CheckingAccount.withdraw</span></span><br><span class="line"><span class="number">13</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>such_a_deal.deposit_charge</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>such_a_deal.withdraw_charge</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<h3 id="2&#x591A;&#x91CD;&#x7EE7;&#x627F;&#x7684;&#x987A;&#x5E8F;&#x7ED3;&#x6784;">2.&#x591A;&#x91CD;&#x7EE7;&#x627F;&#x7684;&#x987A;&#x5E8F;&#x7ED3;&#x6784;</h3>
<p>&#x2003;&#x2003;&#x5728;&#x591A;&#x91CD;&#x7EE7;&#x627F;&#x4E2D;&#xFF0C;&#x5047;&#x5982;&#x67D0;&#x4E2A;&#x540D;&#x4E3A;<code>&lt;name&gt;</code>&#x7684;&#x5C5E;&#x6027;&#x5728;&#x4E24;&#x4E2A;&#x7EE7;&#x627F;&#x7C7B;&#x4E2D;&#x90FD;&#x6709;&#xFF0C;&#x7A0B;&#x5E8F;&#x6289;&#x62E9;&#x7684;&#x987A;&#x5E8F;&#x7ED3;&#x6784;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="/2024/05/31/2.5.%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/image-4.png"></p>
<p>&#x2003;&#x2003;&#x5BF9;&#x4E8E;&#x8FD9;&#x79CD;&#x201C;&#x94BB;&#x77F3;&#x578B;&#x201D;&#x7684;&#x7EE7;&#x627F;&#x7ED3;&#x6784;&#xFF0C;<span class="math inline">\(python\)</span>&#x4F1A;&#x91C7;&#x7528;&#x201C;<strong>&#x4ECE;&#x4E0B;&#x5F80;&#x4E0A;&#x3001;&#x4ECE;&#x5DE6;&#x5F80;&#x53F3;</strong>&#x201D;&#x7684;&#x67E5;&#x627E;&#x987A;&#x5E8F;&#xFF0C;&#x5728;&#x5404;&#x4E2A;&#x7C7B;&#x4E2D;&#x67E5;&#x627E;&#x8BE5;&#x5C5E;&#x6027;&#xFF0C;&#x76F4;&#x5230;&#x627E;&#x5230;&#x4E3A;&#x6B62;&#x3002;</p>
<h2 id="&#x4E03;-&#x5BF9;&#x5BF9;&#x8C61;&#x7684;&#x603B;&#x7ED3;">&#x4E03;&#x3001;&#x5BF9;&#x5BF9;&#x8C61;&#x7684;&#x603B;&#x7ED3;</h2>
<p>&#x2003;&#x2003;&#x50CF;&#x8FD9;&#x8282;&#x4ECB;&#x7ECD;&#x7684;&#x7C7B;&#x3001;&#x65B9;&#x6CD5;&#x3001;&#x7EE7;&#x627F;&#x3001;&#x70B9;&#x8868;&#x8FBE;&#x5F0F;&#x7B49;&#x7279;&#x6B8A;&#x8BED;&#x6CD5;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x66F4;&#x597D;&#x5730;&#x5F62;&#x8C61;&#x5316;&#x6211;&#x4EEC;&#x5BF9;&#x7A0B;&#x5E8F;&#x7684;&#x9690;&#x55BB;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5728;&#x7F16;&#x5199;&#x7A0B;&#x5E8F;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x6211;&#x4EEC;&#x7684;&#x5BF9;&#x8C61;&#x7CFB;&#x7EDF;&#x63A8;&#x52A8;&#x7A0B;&#x5E8F;&#x7684;&#x4E0D;&#x540C;&#x65B9;&#x9762;&#x5173;&#x6CE8;&#x4E0D;&#x540C;&#x7684;&#x95EE;&#x9898;&#x3002;&#x6BCF;&#x4E2A;&#x5BF9;&#x8C61;&#x5C01;&#x88C5;&#x3001;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#x7684;&#x4E00;&#x4E2A;&#x72B6;&#x6001;&#xFF0C;&#x5E76;&#x4E14;&#x6BCF;&#x4E2A;&#x7C7B;&#x7684;&#x58F0;&#x660E;&#x5B9E;&#x73B0;&#x7A0B;&#x5E8F;&#x603B;&#x4F53;&#x903B;&#x8F91;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x3002;&#x800C;&#x62BD;&#x8C61;&#x5C4F;&#x969C;&#x8BA9;&#x95EE;&#x9898;&#x7684;&#x4E0D;&#x540C;&#x65B9;&#x9762;&#x7684;&#x754C;&#x9650;&#x66F4;&#x52A0;&#x7684;&#x9C9C;&#x660E;&#x3002;</p>
<p>&#x2003;&#x2003;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x7F16;&#x7A0B;&#x5F88;&#x597D;&#x5730;&#x5951;&#x5408;&#x4E86;&#x5206;&#x4E3A;&#x72EC;&#x7ACB;&#x7684;&#x6A21;&#x5757;&#x5316;&#x7CFB;&#x7EDF;&#x3001;&#x6BCF;&#x4E2A;&#x7CFB;&#x7EDF;&#x4E92;&#x76F8;&#x4EA4;&#x4E92;&#x7684;&#x7A0B;&#x5E8F;&#x8BBE;&#x8BA1;&#x9700;&#x6C42;&#x3002;&#x4F8B;&#x5982;&#x6211;&#x4EEC;&#x5BF9;&#x793E;&#x4EA4;&#x7F51;&#x7EDC;&#x7B49;&#x751F;&#x6D3B;&#x4E2D;&#x4E8B;&#x7269;&#x7684;&#x6A21;&#x62DF;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x60F3;&#x5728;&#x7A0B;&#x5E8F;&#x4E2D;&#x5B9E;&#x73B0;&#x8FD9;&#x4E9B;&#x6A21;&#x578B;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x628A;<strong>&#x7CFB;&#x7EDF;&#x4E2D;&#x7684;&#x5BF9;&#x8C61;&#x6A21;&#x5757;&#x5316;&#x4E3A;&#x7A0B;&#x5E8F;&#x4E2D;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x540C;&#x65F6;&#x7528;&#x7C7B;&#x8868;&#x660E;&#x5B83;&#x4EEC;&#x7684;&#x7C7B;&#x522B;&#x4E0E;&#x8054;&#x7CFB;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x540C;&#x65F6;&#xFF0C;&#x5BF9;&#x8C61;&#x5E76;&#x4E0D;&#x662F;&#x552F;&#x4E00;&#x7684;&#x5B9E;&#x73B0;&#x62BD;&#x8C61;&#x7684;&#x65B9;&#x5F0F;&#x3002;<strong>&#x5BF9;&#x4E8E;&#x8F93;&#x5165;&#x8F93;&#x51FA;&#x5F0F;&#x7684;&#x62BD;&#x8C61;&#xFF0C;&#x51FD;&#x6570;&#x62BD;&#x8C61;&#x663E;&#x5F97;&#x66F4;&#x4E3A;&#x81EA;&#x7136;</strong>&#x3002;&#x8BA4;&#x8BC6;&#x5230;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x8BE5;&#x7528;&#x5BF9;&#x8C61;&#x62BD;&#x8C61;&#x7684;&#x65B9;&#x5F0F;&#x3001;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x8BE5;&#x7528;&#x51FD;&#x6570;&#x62BD;&#x8C61;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x662F;&#x7F16;&#x7A0B;&#x4E2D;&#x5173;&#x952E;&#x7684;&#x95EE;&#x9898;&#x3002;</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/2.7.%E5%AF%B9%E8%B1%A1%E6%8A%BD%E8%B1%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/2.7.%E5%AF%B9%E8%B1%A1%E6%8A%BD%E8%B1%A1/" class="post-title-link" itemprop="url">2.7.&#x5BF9;&#x8C61;&#x62BD;&#x8C61;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 15:27:56" itemprop="dateModified" datetime="2024-06-02T15:27:56+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SICP-in-python/" itemprop="url" rel="index"><span itemprop="name">SICP in python</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SICP-in-python/Chapter-2-Building-Abstraction-with-Data/" itemprop="url" rel="index"><span itemprop="name">Chapter 2.Building Abstraction with Data</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>3k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>11 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="27&#x5BF9;&#x8C61;&#x62BD;&#x8C61;"><span class="math inline">\(2.7\)</span>&#x5BF9;&#x8C61;&#x62BD;&#x8C61;</h1>
<h2 id="&#x4E00;-&#x601D;&#x60F3;&#x6982;&#x8FF0;">&#x4E00;&#x3001;&#x601D;&#x60F3;&#x6982;&#x8FF0;</h2>
<p>&#x2003;&#x2003;&#x5BF9;&#x8C61;&#x7CFB;&#x7EDF;(<span class="math inline">\(object\;system\)</span>)&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x5BF9;&#x62BD;&#x8C61;&#x6570;&#x636E;&#x7684;&#x4E0D;&#x540C;&#x8868;&#x8FBE;&#x7684;&#x5171;&#x5B58;&#x3002;</p>
<p>&#x2003;&#x2003;&#x4E3A;&#x5B9E;&#x73B0;&#x8FD9;&#x6837;&#x7684;&#x5BF9;&#x8C61;&#x7CFB;&#x7EDF;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;<strong>&#x627E;&#x5230;&#x4E00;&#x4E2A;&#x666E;&#x904D;&#x51FD;&#x6570;(<span class="math inline">\(generic\;function\)</span>)&#xFF0C;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x63A5;&#x53D7;&#x67D0;&#x4E2A;&#x503C;&#x7684;&#x5404;&#x79CD;&#x8868;&#x8FBE;</strong>&#xFF0C;&#x4E0B;&#x9762;&#x5C06;&#x4ECB;&#x7ECD;&#x5B9E;&#x73B0;&#x8FD9;&#x4E00;&#x64CD;&#x4F5C;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>
<h2 id="&#x4E8C;-&#x524D;&#x7F6E;&#x77E5;&#x8BC6;">&#x4E8C;&#x3001;&#x524D;&#x7F6E;&#x77E5;&#x8BC6;</h2>
<h3 id="1&#x5B57;&#x7B26;&#x4E32;&#x8F6C;&#x6362;">1.&#x5B57;&#x7B26;&#x4E32;&#x8F6C;&#x6362;</h3>
<p>&#x2003;&#x2003;&#x4E3A;&#x66F4;&#x9AD8;&#x6548;&#x5730;&#x8868;&#x8FBE;&#x6570;&#x636E;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x5728;<span class="math inline">\(python\)</span>&#x7684;&#x4EA4;&#x4E92;&#x5F0F;&#x5BF9;&#x8BDD;&#x4E2D;&#x81EA;&#x52A8;&#x663E;&#x793A;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x8868;&#x793A;&#x3002;</p>
<p>&#x2003;&#x2003;<span class="math inline">\(python\)</span>&#x89C4;&#x5B9A;&#xFF0C;&#x6BCF;&#x4E2A;&#x5BF9;&#x8C61;&#x90FD;&#x4F1A;&#x4EA7;&#x751F;&#x4E24;&#x79CD;&#x4E0D;&#x540C;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x8868;&#x793A;&#xFF1A;<strong>&#x4E00;&#x79CD;&#x662F;&#x4EBA;&#x7C7B;&#x53EF;&#x4EE5;&#x9605;&#x8BFB;(<span class="math inline">\(human-interpretable\)</span>)&#x7684;&#x6587;&#x672C;&#xFF0C;&#x4E00;&#x79CD;&#x662F;<span class="math inline">\(python\)</span>&#x53EF;&#x7406;&#x89E3;(<span class="math inline">\(python-interpretable\)</span>)&#x7684;&#x8868;&#x8FBE;&#x5F0F;</strong>&#x3002;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;<code>str</code>&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x4EBA;&#x7C7B;&#x53EF;&#x8BFB;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x3002;(&#x5728;&#x53EF;&#x80FD;&#x7684;&#x60C5;&#x51B5;&#x4E0B;)&#x800C;<code>repr</code>&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x7B49;&#x4EF7;&#x7684;<code>python</code>&#x8868;&#x8FBE;&#x5F0F;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">12e12</span></span><br><span class="line"><span class="number">12000000000000.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">repr</span>(<span class="number">12e12</span>))</span><br><span class="line"><span class="number">12000000000000.0</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5F53;&#x4F20;&#x5165;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x6CA1;&#x6709;&#x521D;&#x59CB;&#x503C;&#x65F6;&#xFF0C;<code>repr</code>&#x4F1A;&#x8FD4;&#x56DE;&#x5982;&#x4E0B;&#x8BED;&#x53E5;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">repr</span>(<span class="built_in">min</span>)</span><br><span class="line"><span class="string">&apos;&lt;built-in function min&gt;&apos;</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;<code>str</code>&#x7684;<span class="math inline">\(constructor\)</span>&#x4E0E;<code>repr</code>&#x8BED;&#x53E5;&#x7ECF;&#x5E38;&#x91CD;&#x5408;&#xFF0C;&#x4F46;&#x524D;&#x8005;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x4EBA;&#x7C7B;&#x66F4;&#x6613;&#x8BFB;&#x7684;&#x6587;&#x672C;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> date</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tues = date(<span class="number">2011</span>, <span class="number">9</span>, <span class="number">12</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">repr</span>(tues)</span><br><span class="line"><span class="string">&apos;datetime.date(2011, 9, 12)&apos;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">str</span>(tues)</span><br><span class="line"><span class="string">&apos;2011-09-12&apos;</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5BF9;&#x8C61;&#x7CFB;&#x7EDF;&#x4E3A;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x4E86;&#x80FD;&#x7528;&#x4E8E;&#x6240;&#x6709;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x7684;&#x65B9;&#x6CD5;&#xFF1A;<code>__repr__</code>&#x4E0E;<code>__str__</code>&#xFF0C;&#x8FD9;&#x8BA9;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4EE5;&#x70B9;&#x8868;&#x8FBE;&#x5F0F;&#x7F16;&#x5199;&#x7A0B;&#x5E8F;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>tues.__repr__()</span><br><span class="line"><span class="string">&apos;datetime.date(2011, 9, 12)&apos;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tues.__str__()</span><br><span class="line"><span class="string">&apos;2011-09-12&apos;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="2&#x7279;&#x6B8A;&#x65B9;&#x6CD5;">2.&#x7279;&#x6B8A;&#x65B9;&#x6CD5;</h3>
<p>&#x2003;&#x2003;&#x5728;<span class="math inline">\(python\)</span>&#x4E2D;&#xFF0C;&#x7279;&#x6B8A;&#x65B9;&#x6CD5;(<span class="math inline">\(special\;method\)</span>)&#x5728;&#x7279;&#x5B9A;&#x60C5;&#x51B5;&#x88AB;<span class="math inline">\(python\)</span>&#x7F16;&#x8BD1;&#x5668;&#x8C03;&#x7528;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</p>
<ul>
<li><code>__init__</code>&#x65B9;&#x6CD5;&#x4F1A;&#x5728;&#x67D0;&#x4E2A;&#x5BF9;&#x8C61;&#x88AB;&#x521B;&#x5EFA;&#x540E;&#x81EA;&#x52A8;&#x8C03;&#x7528;&#x3002;</li>
<li><code>__str__</code>&#x65B9;&#x6CD5;&#x5728;&#x6253;&#x5370;&#x7ED3;&#x679C;&#x65F6;&#x81EA;&#x52A8;&#x8C03;&#x7528;&#x3002;</li>
<li><code>__repr</code>&#x65B9;&#x6CD5;&#x5728;&#x4EA4;&#x4E92;&#x5F0F;&#x7A0B;&#x5E8F;&#x5C55;&#x793A;&#x503C;(<code>value</code>)&#x65F6;&#x81EA;&#x52A8;&#x8C03;&#x7528;&#x3002;</li>
</ul>
<p>&#x2003;&#x2003;<span class="math inline">\(python\)</span>&#x4E2D;&#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x7C7B;&#x4F3C;&#x7684;&#x7279;&#x6B8A;&#x65B9;&#x6CD5;&#x3002;</p>
<h4 id="a__bool__&#x65B9;&#x6CD5;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span><code>__bool__</code>&#x65B9;&#x6CD5;</h4>
<p>&#x2003;&#x2003;&#x4E00;&#x822C;&#x7684;<code>bool</code>&#x4F1A;&#x9ED8;&#x8BA4;<span class="math inline">\(0\)</span>&#x4E3A;<code>false</code>&#xFF0C;&#x5176;&#x4ED6;&#x503C;&#x4E3A;<code>true</code>&#x3002;&#x5BF9;&#x4E8E;&#x5BF9;&#x8C61;&#x800C;&#x8A00;&#xFF0C;<span class="math inline">\(python\)</span>&#x4E2D;&#x9ED8;&#x8BA4;&#x6240;&#x6709;&#x5BF9;&#x8C61;&#x90FD;&#x6709;<code>true</code>&#x503C;&#x3002;&#x4F46;<strong>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5229;&#x7528;<code>__bool__</code>&#x65B9;&#x6CD5;&#x6765;&#x8986;&#x76D6;&#x8FD9;&#x4E00;&#x9ED8;&#x8BA4;&#x503C;</strong>&#x3002;&#x4F8B;&#x5982;&#x6211;&#x4EEC;&#x5C06;&#x503C;&#x4E3A;<span class="math inline">\(0\)</span>&#x7684;<span class="math inline">\(Account\)</span>&#x4E3A;<code>false</code>&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;Account.__bool__=<span class="keyword">lambda</span> self:self.balance!= <span class="number">0</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5219;&#x5BF9;&#x4E8E;&#x4E0B;&#x9762;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x5B83;&#x4F1A;&#x8F93;&#x51FA;<code>false</code>&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">bool</span>(Account(<span class="string">&apos;Jack&apos;</span>))</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">if</span> <span class="keyword">not</span> Account(<span class="string">&apos;Jack&apos;</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&apos;Jack has nothing&apos;</span>)</span><br><span class="line">Jack has nothing</span><br></pre></td></tr></table></figure></p>
<h4 id="b&#x5E8F;&#x5217;&#x64CD;&#x4F5C;">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>&#x5E8F;&#x5217;&#x64CD;&#x4F5C;</h4>
<p>&#x2003;&#x2003;&#x5E8F;&#x5217;&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#x4E3B;&#x8981;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li><p><code>__len__</code> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&apos;Go Bears!&apos;</span>.__len__()</span><br><span class="line"><span class="number">9</span></span><br></pre></td></tr></table></figure></p></li>
<li><p><code>__getitem__</code> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&apos;Go Bears!&apos;</span>[<span class="number">3</span>]</span><br><span class="line"><span class="string">&apos;B&apos;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&apos;Go Bears!&apos;</span>.__getitem__(<span class="number">3</span>)</span><br><span class="line"><span class="string">&apos;B&apos;</span></span><br></pre></td></tr></table></figure></p></li>
</ul>
<h3 id="3&#x53EF;&#x8C03;&#x7528;&#x7684;&#x5BF9;&#x8C61;">3.&#x53EF;&#x8C03;&#x7528;&#x7684;&#x5BF9;&#x8C61;</h3>
<p>&#x2003;&#x2003;<strong>&#x901A;&#x8FC7;<code>__call__</code>&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8BA9;&#x5B9A;&#x4E49;&#x7684;&#x5BF9;&#x8C61;&#x50CF;&#x51FD;&#x6570;&#x4E00;&#x6837;&#x88AB;&#x8C03;&#x7528;</strong>&#xFF0C;&#x8FDB;&#x800C;&#x5B9E;&#x73B0;&#x7C7B;&#x4F3C;&#x9AD8;&#x9636;&#x51FD;&#x6570;&#x7684;&#x529F;&#x80FD;&#x3002;</p>
<p>&#x2003;&#x2003;&#x8003;&#x8651;&#x4E0B;&#x9762;&#x7684;&#x9AD8;&#x9636;&#x51FD;&#x6570;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">make_adder</span>(<span class="params">n</span>):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">adder</span>(<span class="params">k</span>):</span><br><span class="line">            <span class="keyword">return</span> n + k</span><br><span class="line">        <span class="keyword">return</span> adder</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>add_three = make_adder(<span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>add_three(<span class="number">4</span>)</span><br><span class="line"><span class="number">7</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;<code>Adder</code>&#x7C7B;&#x5B9E;&#x73B0;&#x7C7B;&#x4F3C;&#x64CD;&#x4F5C;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">class</span> <span class="title class_">Adder</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, n</span>):</span><br><span class="line">            self.n = n</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, k</span>):</span><br><span class="line">            <span class="keyword">return</span> self.n + k</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>add_three_obj = Adder(<span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>add_three_obj(<span class="number">4</span>)</span><br><span class="line"><span class="number">7</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x8BA9;&#x7C7B;&#x548C;&#x5BF9;&#x8C61;&#x8868;&#x73B0;&#x5F97;&#x50CF;&#x51FD;&#x6570;&#x4E00;&#x6837;&#xFF0C;&#x8FD9;&#x8FDB;&#x4E00;&#x6B65;&#x6A21;&#x7CCA;&#x4E86;&#x51FD;&#x6570;&#x4E0E;&#x6570;&#x636E;&#x7684;&#x754C;&#x9650;&#x3002;</p>
<h2 id="&#x4E09;-&#x591A;&#x91CD;&#x8868;&#x793A;multiplerepresentations">&#x4E09;&#x3001;&#x591A;&#x91CD;&#x8868;&#x793A;<span class="math inline">\(multiple\;representations\)</span></h2>
<p>&#x2003;&#x2003;&#x5728;&#x7F16;&#x7A0B;&#x4E2D;&#xFF0C;&#x5BF9;&#x4E8E;&#x7A0B;&#x5E8F;&#x4E2D;&#x7684;&#x67D0;&#x4E2A;&#x6570;&#x636E;&#x5BF9;&#x8C61;&#xFF0C;&#x53EF;&#x80FD;&#x5B58;&#x5728;&#x591A;&#x79CD;&#x8868;&#x8FBE;&#x65B9;&#x5F0F;&#x3002;&#x4F8B;&#x5982;&#x590D;&#x6570;(<span class="math inline">\(complex\;number\)</span>)&#xFF0C;&#x65E2;&#x53EF;&#x4EE5;&#x7528;&#x201C;&#x5B9E;&#x90E8;+&#x865A;&#x90E8;&#x201D;&#x6765;&#x8868;&#x793A;&#xFF0C;&#x53C8;&#x53EF;&#x4EE5;&#x7528;&#x201C;&#x6A21;&#x957F;+&#x8F90;&#x89D2;&#x4E3B;&#x503C;&#x201D;&#x6765;&#x8868;&#x793A;&#x3002;&#x8FD9;&#x4F7F;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x8BBE;&#x8BA1;&#x51FA;<strong>&#x80FD;&#x5904;&#x7406;&#x591A;&#x91CD;&#x8868;&#x793A;(<span class="math inline">\(multiple\;representations\)</span>)&#x7684;&#x7CFB;&#x7EDF;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x4E0B;&#x9762;&#x5373;&#x4EE5;&#x590D;&#x6570;&#x7CFB;&#x7EDF;&#x8BF4;&#x660E;&#x8FD9;&#x4E00;&#x529F;&#x80FD;&#x7684;&#x5B9E;&#x73B0;&#x3002;</p>
<h3 id="1&#x5BF9;&#x4E24;&#x79CD;&#x8868;&#x793A;&#x7684;&#x521D;&#x59CB;&#x5316;">1.&#x5BF9;&#x4E24;&#x79CD;&#x8868;&#x793A;&#x7684;&#x521D;&#x59CB;&#x5316;</h3>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;<strong>&#x4ECE;&#x6700;&#x9AD8;&#x5C42;&#x6B21;&#x7684;&#x62BD;&#x8C61;&#x7740;&#x624B;&#x642D;&#x5EFA;&#x7CFB;&#x7EDF;&#xFF0C;&#x7136;&#x540E;&#x6162;&#x6162;&#x5C06;&#x5176;&#x4E2D;&#x7684;&#x529F;&#x80FD;&#x5177;&#x4F53;&#x5316;</strong>&#x3002;&#x6240;&#x6709;&#x7684;&#x590D;&#x6570;&#x90FD;&#x5C5E;&#x4E8E;<span class="math inline">\(Number\)</span>&#xFF0C;&#x800C;&#x6570;&#x5B57;&#x53EF;&#x4EE5;&#x76F8;&#x52A0;&#x4E0E;&#x76F8;&#x4E58;&#xFF0C;&#x4E8E;&#x662F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x57FA;&#x51C6;&#x7C7B;<code>Number</code>&#x4E0E;&#x65B9;&#x6CD5;<code>__add__</code>&#x3001;<code>__mul__</code>&#xFF0C;&#x8FD9;&#x91CC;&#x7684;<code>__add__</code>&#x3001;<code>__mul__</code>&#x662F;&#x901A;&#x8FC7;<code>add</code>&#x3001;<code>mul</code>&#x7B49;&#x66F4;&#x5177;&#x4F53;&#x7684;&#x65B9;&#x6CD5;&#x5B9E;&#x73B0;&#x7684;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">class</span> <span class="title class_">Number</span>:</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__add__</span>(<span class="params">self,other</span>):</span><br><span class="line">            <span class="keyword">return</span> self.add(other)</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self,other</span>):</span><br><span class="line">            <span class="keyword">return</span> self.mul(other)</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x7136;&#x540E;&#x8003;&#x8651;&#x5728;&#x590D;&#x6570;&#x4E2D;&#x5B9E;&#x73B0;<code>add</code>&#x4E0E;<code>mul</code>&#x65B9;&#x6CD5;&#xFF0C;&#x5BF9;<code>add</code>&#x6211;&#x4EEC;&#x7528;&#x590D;&#x6570;&#x7684;&#x6807;&#x51C6;&#x5F62;&#x5F0F;&#x6765;&#x8BA1;&#x7B97;&#xFF1B;&#x5BF9;&#x4E8E;<code>mul</code>&#x6211;&#x4EEC;&#x7528;&#x590D;&#x6570;&#x7684;&#x8F90;&#x89D2;&#x5F62;&#x5F0F;&#x6765;&#x8BA1;&#x7B97;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">class</span> <span class="title class_">Complex</span>(<span class="title class_ inherited__">Number</span>):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self,other</span>):</span><br><span class="line">            <span class="keyword">return</span> ComplexRI(self.real+other.real,self.imag+other.imag)</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">mul</span>(<span class="params">self,other</span>):</span><br><span class="line">            magnitude=self.magnitude*other.magnitude</span><br><span class="line">            <span class="keyword">return</span> ComplexMA(magnitude,self.angle+other.angle)</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x79CD;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x5047;&#x8BBE;&#x4E86;&#x590D;&#x6570;&#x7684;&#x4E24;&#x79CD;&#x7C7B;&#x8868;&#x793A;&#x3002;</p>
<h3 id="2&#x63A5;&#x53E3;">2.&#x63A5;&#x53E3;</h3>
<p>&#x2003;&#x2003;<strong>&#x5BF9;&#x8C61;&#x7684;&#x5C5E;&#x6027;&#x4F5C;&#x4E3A;&#x4FE1;&#x606F;&#x4F20;&#x9012;(<span class="math inline">\(message\;passing\)</span>)&#x7684;&#x4E00;&#x79CD;&#xFF0C;&#x5141;&#x8BB8;&#x4E0D;&#x540C;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x5BF9;&#x76F8;&#x540C;&#x4FE1;&#x606F;&#x505A;&#x51FA;&#x4E0D;&#x540C;&#x53CD;&#x5E94;</strong>&#x3002;&#x8FD9;&#x79CD;<strong>&#x5728;&#x4E0D;&#x540C;&#x7684;&#x7C7B;&#x4E2D;&#x5F15;&#x53D1;&#x76F8;&#x4F3C;&#x64CD;&#x4F5C;&#x7684;&#x5171;&#x4EAB;&#x4FE1;&#x606F;&#x7EC4;(<span class="math inline">\(shared\;set\;of\;messages\)</span>)</strong>
&#x662F;&#x6709;&#x529B;&#x7684;&#x62BD;&#x8C61;&#x65B9;&#x5F0F;&#x3002;&#x800C;<strong>&#x63A5;&#x53E3;(<span class="math inline">\(interface\)</span>)&#x662F;&#x4E00;&#x7CFB;&#x5217;&#x5171;&#x4EAB;&#x7684;&#x5C5E;&#x6027;&#x540D;&#x79F0;&#x4E0E;&#x5404;&#x81EA;&#x884C;&#x4E3A;&#x7684;&#x8BE6;&#x7EC6;&#x8BF4;&#x660E;</strong>&#x3002;&#x5BF9;&#x4E8E;&#x590D;&#x6570;&#x7CFB;&#x7EDF;&#xFF0C;&#x63A5;&#x53E3;&#x9700;&#x8981;&#x5B9E;&#x73B0;&#x56DB;&#x4E2A;&#x5C5E;&#x6027;&#xFF1A;<code>real</code>&#xFF0C;<code>imag</code>&#xFF0C;<code>magnitude</code>&#xFF0C;<code>angle</code>&#x3002;</p>
<p>&#x2003;&#x2003;&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x590D;&#x6570;&#x7B97;&#x6CD5;(<span class="math inline">\(arithmic\)</span>)&#x7684;&#x6B63;&#x786E;&#x6027;&#xFF0C;&#x8FD9;&#x4E9B;&#x5C5E;&#x6027;&#x5FC5;&#x987B;&#x5177;&#x6709;&#x4E00;&#x81F4;&#x6027;&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;<code>(magnitude,angle)</code>&#x8868;&#x793A;&#x7684;&#x590D;&#x6570;&#x4E0E;<code>(real,imag)</code>&#x8868;&#x793A;&#x7684;&#x590D;&#x6570;&#x5FC5;&#x987B;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x590D;&#x6570;&#x3002;</p>
<h3 id="3properties">3.<span class="math inline">\(properties\)</span></h3>
<p>&#x2003;&#x2003;&#x8BA9;&#x591A;&#x4E2A;&#x5C5E;&#x6027;&#x7EF4;&#x7CFB;&#x4E00;&#x4E2A;&#x56FA;&#x5B9A;&#x7684;&#x5173;&#x7CFB;&#x662F;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<strong>&#x53EA;&#x5B58;&#x50A8;&#x67D0;&#x79CD;&#x5C5E;&#x6027;&#x3001;&#x5728;&#x9700;&#x8981;&#x5176;&#x4ED6;&#x5C5E;&#x6027;&#x65F6;&#x5355;&#x72EC;&#x8BA1;&#x7B97;</strong>&#x7684;&#x65B9;&#x5F0F;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;</p>
<p>&#x2003;&#x2003;<span class="math inline">\(python\)</span>&#x4E2D;&#x7684;<code>@property</code>&#x88C5;&#x9970;&#x7B26;&#x5141;&#x8BB8;&#x6211;&#x4EEC;&#x5728;&#x4E0D;&#x8C03;&#x7528;&#x8868;&#x8FBE;&#x5F0F;&#x8BED;&#x6CD5;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x8C03;&#x7528;&#x51FD;&#x6570;&#xFF0C;&#x901A;&#x8FC7;&#x96F6;&#x53C2;&#x6570;&#x7684;&#x65B9;&#x6CD5;&#x8BA1;&#x7B97;&#x5C5E;&#x6027;&#x3002;&#x4EE5;&#x590D;&#x6570;&#x7CFB;&#x7EDF;&#x4E3A;&#x4F8B;&#xFF0C;&#x6211;&#x4EEC;&#x5B58;&#x50A8;&#x590D;&#x6570;&#x7684;&#x6807;&#x51C6;&#x5F62;&#x5F0F;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> math <span class="keyword">import</span> atan2</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">class</span> <span class="title class_">ComplexRI</span>(<span class="title class_ inherited__">Complex</span>):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, real, imag</span>):</span><br><span class="line">            self.real = real</span><br><span class="line">            self.imag = imag</span><br><span class="line"><span class="meta">        @property</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">magnitude</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="keyword">return</span> (self.real**<span class="number">2</span>+self.imag**<span class="number">2</span>)**<span class="number">0.5</span></span><br><span class="line"><span class="meta">        @property</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">angle</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="keyword">return</span> atan2(self.imag, self.real)</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&apos;ComplexRI({0:g}, {1:g})&apos;</span>.<span class="built_in">format</span>(self.real, self.imag)</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x70B9;&#x8868;&#x8FBE;&#x5F0F;&#x76F4;&#x63A5;&#x8BBF;&#x95EE;&#x9664;&#x6807;&#x51C6;&#x5F62;&#x5F0F;&#x5916;&#x7684;&#x5C5E;&#x6027;&#x4E86;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ri = ComplexRI(<span class="number">5</span>, <span class="number">12</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ri.real</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ri.magnitude</span><br><span class="line"><span class="number">13.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ri.real = <span class="number">9</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ri.real</span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ri.magnitude</span><br><span class="line"><span class="number">15.0</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x540C;&#x6837;&#x5730;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x5B58;&#x50A8;&#x8F90;&#x89D2;&#x5F62;&#x5F0F;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> math <span class="keyword">import</span> sin, cos, pi</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">class</span> <span class="title class_">ComplexMA</span>(<span class="title class_ inherited__">Complex</span>):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, magnitude, angle</span>):</span><br><span class="line">            self.magnitude = magnitude</span><br><span class="line">            self.angle = angle</span><br><span class="line"><span class="meta">        @property</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">real</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="keyword">return</span> self.magnitude * cos(self.angle)</span><br><span class="line"><span class="meta">        @property</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">imag</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="keyword">return</span> self.magnitude * sin(self.angle)</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&apos;ComplexMA({0:g}, {1:g} * pi)&apos;</span>.<span class="built_in">format</span>(self.magnitude, self.angle/pi)</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5E76;&#x5F97;&#x5230;&#x4EE5;&#x4E0B;&#x7684;&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ma = ComplexMA(<span class="number">2</span>, pi/<span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ma.imag</span><br><span class="line"><span class="number">2.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ma.angle = pi</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ma.real</span><br><span class="line">-<span class="number">2.0</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x901A;&#x8FC7;&#x63A5;&#x53E3;&#x65B9;&#x5F0F;&#x5BF9;&#x591A;&#x91CD;&#x8868;&#x793A;&#x8FDB;&#x884C;&#x7F16;&#x7801;&#x6709;&#x4F18;&#x826F;&#x7684;&#x6027;&#x8D28;&#xFF1A;<strong>&#x6BCF;&#x79CD;&#x8868;&#x8FBE;&#x7684;&#x7C7B;&#x90FD;&#x53EF;&#x4EE5;&#x72EC;&#x81EA;&#x5B9A;&#x4E49;&#xFF0C;&#x5B83;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x5728;&#x5171;&#x4EAB;&#x7684;&#x5C5E;&#x6027;&#x540D;&#x79F0;&#x3001;&#x8FD9;&#x4E9B;&#x5C5E;&#x6027;&#x7684;&#x884C;&#x4E3A;&#x6761;&#x4EF6;(<span class="math inline">\(behaviour\;condition\)</span>)&#x4E0A;&#x8FBE;&#x6210;&#x4E00;&#x81F4;&#x5373;&#x53EF;</strong>&#x3002;&#x5F53;&#x53E6;&#x4E00;&#x4E2A;&#x7F16;&#x7A0B;&#x8005;&#x60F3;&#x518D;&#x52A0;&#x5165;&#x4E00;&#x4E2A;&#x8868;&#x8FBE;&#x65F6;&#xFF0C;&#x4ED6;&#x53EA;&#x9700;&#x8981;&#x518D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5177;&#x6709;&#x76F8;&#x540C;&#x5C5E;&#x6027;&#x7684;&#x7C7B;&#x5373;&#x53EF;&#x3002;</p>
<h2 id="&#x56DB;-&#x901A;&#x7528;&#x51FD;&#x6570;">&#x56DB;&#x3001;&#x901A;&#x7528;&#x51FD;&#x6570;</h2>
<h3 id="1&#x6982;&#x5FF5;amp&#x5F15;&#x5165;">1.&#x6982;&#x5FF5;&amp;&#x5F15;&#x5165;</h3>
<p>&#x2003;&#x2003;<strong>&#x901A;&#x7528;&#x51FD;&#x6570;(<span class="math inline">\(generic\;function\)</span>)&#x662F;&#x4E00;&#x79CD;&#x51FD;&#x6570;&#x65B9;&#x6CD5;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x88AB;&#x7528;&#x4E8E;&#x4E0D;&#x540C;&#x7C7B;&#x578B;&#x7684;&#x53D8;&#x91CF;&#x3002;</strong>
&#x5148;&#x524D;&#x7684;<code>Complex.add</code>&#x662F;&#x901A;&#x7528;&#x51FD;&#x6570;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x7684;<code>other</code>&#x53D8;&#x91CF;&#x65E2;&#x53EF;&#x4EE5;&#x63A5;&#x53D7;<code>ComplexRI</code>&#x578B;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x63A5;&#x53D7;<code>ComplexMA</code>&#x578B;&#x3002;</p>
<p>&#x2003;&#x2003;&#x8FD9;&#x79CD;&#x7075;&#x6D3B;&#x6027;&#x7684;&#x5B9E;&#x73B0;&#x662F;&#x57FA;&#x4E8E;
<strong><code>ComeplexRI</code>&#x4E0E;<code>ComplexMA</code>&#x5171;&#x4EAB;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;</strong>&#x7684;&#x4E8B;&#x5B9E;&#x3002;&#x9664;&#x4E86;&#x5229;&#x7528;&#x63A5;&#x53E3;&#x548C;&#x4FE1;&#x606F;&#x4F20;&#x9012;&#x6765;&#x5B9E;&#x73B0;&#x901A;&#x7528;&#x51FD;&#x6570;&#xFF0C;&#x8FD8;&#x6709;&#x4E24;&#x79CD;&#x4E0D;&#x540C;&#x65B9;&#x6CD5;&#xFF1A;&#x7C7B;&#x578B;&#x5206;&#x6D3E;&#x4E0E;&#x7C7B;&#x578B;&#x5F3A;&#x5236;&#x3002;</p>
<p>&#x2003;&#x2003;&#x73B0;&#x5728;&#xFF0C;&#x6211;&#x4EEC;&#x60F3;&#x5C06;&#x539F;&#x6765;&#x7684;&#x590D;&#x6570;&#x7CFB;&#x7EDF;&#x62D3;&#x5C55;&#x5230;&#x5B9E;&#x6570;&#x57DF;&#xFF0C;&#x5728;&#x5148;&#x524D;&#x7AE0;&#x8282;&#x4E2D;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x5B9E;&#x73B0;&#x4E86;&#x5B9E;&#x6570;&#x7C7B;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> fractions <span class="keyword">import</span> gcd</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">class</span> <span class="title class_">Rational</span>(<span class="title class_ inherited__">Number</span>):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,numer,denom</span>):</span><br><span class="line">            g = gcd(numer,denom)</span><br><span class="line">            self.numer=numer // g</span><br><span class="line">            self.denom=denom // g</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&apos;Rational({0}, {1})&apos;</span>.<span class="built_in">format</span>(self.numer, self.denom)</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self,other</span>):</span><br><span class="line">            nx,dx=self.numer, self.denom</span><br><span class="line">            ny,dy=other.numer, other.denom</span><br><span class="line">            <span class="keyword">return</span> Rational(nx*dy+ny*dx,dx*dy)</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">mul</span>(<span class="params">self,other</span>):</span><br><span class="line">            numer=self.numer*other.numer</span><br><span class="line">            denom=self.denom*other.denom</span><br><span class="line">            <span class="keyword">return</span> Rational(numer,denom)</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x901A;&#x7528;&#x51FD;&#x6570;<code>__add__</code>&#x5B9E;&#x73B0;&#x6240;&#x6709;&#x6570;&#x7684;&#x52A0;&#x6CD5;&#xFF0C;&#x540C;&#x65F6;&#x5C06;&#x5B9E;&#x6570;&#x4E0E;&#x590D;&#x6570;&#x7684;&#x6982;&#x5FF5;&#x5206;&#x79BB;&#x3002;</p>
<h3 id="2&#x7C7B;&#x578B;&#x5206;&#x6D3E;">2.&#x7C7B;&#x578B;&#x5206;&#x6D3E;</h3>
<p>&#x2003;&#x2003;&#x4E00;&#x4E2A;&#x5B9E;&#x73B0;&#x8DE8;&#x7C7B;(<span class="math inline">\(cross-type\)</span>)&#x64CD;&#x4F5C;&#x7684;&#x65B9;&#x6CD5;&#x662F;&#x57FA;&#x4E8E;&#x53C2;&#x6570;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x9009;&#x62E9;&#x9002;&#x5F53;&#x7684;&#x884C;&#x4E3A;&#x3002;&#x800C;<strong>&#x7C7B;&#x578B;&#x5206;&#x6D3E;(<span class="math inline">\(type\;dispatch\)</span>)&#x6B63;&#x662F;&#x4E3A;&#x4E86;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x68C0;&#x67E5;&#x53C2;&#x6570;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x7684;&#x51FD;&#x6570;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;<span class="math inline">\(python\)</span>&#x5185;&#x7F6E;&#x7684;<code>isinstance</code>&#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x8FD9;&#x4E00;&#x529F;&#x80FD;&#x3002;&#x5B83;<strong>&#x63A5;&#x6536;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x548C;&#x4E00;&#x4E2A;&#x7C7B;&#xFF0C;&#x8FD4;&#x56DE;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x5C5E;&#x4E8E;&#x8BE5;&#x7C7B;&#x6216;&#x5C5E;&#x4E8E;&#x8BE5;&#x7C7B;&#x7684;&#x7EE7;&#x627F;&#x7C7B;&#x7684;&#x771F;&#x5047;</strong>&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>c = ComplexRI(<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(c, ComplexRI)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(c, Complex)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(c, ComplexMA)</span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x53EF;&#x4EE5;&#x5229;&#x7528;<code>isinstance</code>&#x51FD;&#x6570;&#x5B9E;&#x73B0;&#x5BF9;&#x67D0;&#x4E2A;&#x6570;&#x662F;&#x4E0D;&#x662F;&#x5B9E;&#x6570;&#x7684;&#x5224;&#x65AD;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">is_real</span>(<span class="params">c</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Return whether c is a real number with no imaginary part.&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(c, ComplexRI):</span><br><span class="line">            <span class="keyword">return</span> c.imag == <span class="number">0</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(c, ComplexMA):</span><br><span class="line">            <span class="keyword">return</span> c.angle % pi == <span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>is_real(ComplexRI(<span class="number">1</span>, <span class="number">1</span>))</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>is_real(ComplexMA(<span class="number">2</span>, pi))</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5F53;&#x7136;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x522B;&#x7684;&#x65B9;&#x5F0F;&#x5B9E;&#x73B0;&#x7C7B;&#x578B;&#x5206;&#x6D3E;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;<strong>&#x7ED9;&#x6BCF;&#x4E00;&#x79CD;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x5C5E;&#x6027;<code>.type_tag</code></strong>&#xFF0C;&#x8C03;&#x7528;&#x8BE5;&#x5C5E;&#x6027;&#x4F1A;<strong>&#x8FD4;&#x56DE;&#x8BE5;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x8868;&#x793A;</strong>&#x3002;&#x8FD9;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x6BD4;&#x8F83;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#x7684;<code>type_tag</code>&#x4E86;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Rational.type_tag = <span class="string">&apos;rat&apos;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Complex.type_tag = <span class="string">&apos;com&apos;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Rational(<span class="number">2</span>, <span class="number">5</span>).type_tag == Rational(<span class="number">1</span>, <span class="number">2</span>).type_tag</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ComplexRI(<span class="number">1</span>, <span class="number">1</span>).type_tag == ComplexMA(<span class="number">2</span>, pi/<span class="number">2</span>).type_tag</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Rational(<span class="number">2</span>, <span class="number">5</span>).type_tag == ComplexRI(<span class="number">1</span>, <span class="number">1</span>).type_tag</span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5904;&#x7406;&#x5B8C;&#x7C7B;&#x578B;&#x5206;&#x6D3E;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x7F16;&#x5199;&#x63A5;&#x53D7;&#x5B9E;&#x6570;&#x4E0E;&#x590D;&#x6570;&#x8FDB;&#x884C;&#x8BA1;&#x7B97;&#x7684;&#x51FD;&#x6570;&#x64CD;&#x4F5C;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">add_complex_and_rational</span>(<span class="params">c, r</span>):</span><br><span class="line">        <span class="keyword">return</span> ComplexRI(c.real + r.numer/r.denom, c.imag)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">mul_complex_and_rational</span>(<span class="params">c, r</span>):</span><br><span class="line">        r_magnitude, r_angle = r.numer/r.denom, <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> r_magnitude &lt; <span class="number">0</span>:</span><br><span class="line">            r_magnitude, r_angle = -r_magnitude, pi</span><br><span class="line">        <span class="keyword">return</span> ComplexMA(c.magnitude * r_magnitude, c.angle + r_angle)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">add_rational_and_complex</span>(<span class="params">r, c</span>):</span><br><span class="line">        <span class="keyword">return</span> add_complex_and_rational(c, r)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">mul_rational_and_complex</span>(<span class="params">r, c</span>):</span><br><span class="line">        <span class="keyword">return</span> mul_complex_and_rational(c, r)</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5229;&#x7528;&#x7C7B;&#x578B;&#x5206;&#x6D3E;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x4F20;&#x5165;&#x53C2;&#x6570;&#x7684;&#x7C7B;&#x578B;&#x9009;&#x62E9;&#x9002;&#x5F53;&#x7684;&#x51FD;&#x6570;&#x64CD;&#x4F5C;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">class</span> <span class="title class_">Number</span>:</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__add__</span>(<span class="params">self, other</span>):</span><br><span class="line">            <span class="keyword">if</span> self.type_tag == other.type_tag:</span><br><span class="line">                <span class="keyword">return</span> self.add(other)</span><br><span class="line">            <span class="keyword">elif</span> (self.type_tag, other.type_tag) <span class="keyword">in</span> self.adders:</span><br><span class="line">                <span class="keyword">return</span> self.cross_apply(other, self.adders)</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self, other</span>):</span><br><span class="line">            <span class="keyword">if</span> self.type_tag == other.type_tag:</span><br><span class="line">                <span class="keyword">return</span> self.mul(other)</span><br><span class="line">            <span class="keyword">elif</span> (self.type_tag, other.type_tag) <span class="keyword">in</span> self.multipliers:</span><br><span class="line">                <span class="keyword">return</span> self.cross_apply(other, self.multipliers)</span><br><span class="line">        <span class="comment"># to tackle cross-type requirement</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">cross_apply</span>(<span class="params">self, other, cross_fns</span>):</span><br><span class="line">            cross_fn = cross_fns[(self.type_tag, other.type_tag)]</span><br><span class="line">            <span class="keyword">return</span> cross_fn(self, other)</span><br><span class="line">        <span class="comment"># dispatch dictionary</span></span><br><span class="line">        adders = {(<span class="string">&quot;com&quot;</span>, <span class="string">&quot;rat&quot;</span>): add_complex_and_rational,</span><br><span class="line">                  (<span class="string">&quot;rat&quot;</span>, <span class="string">&quot;com&quot;</span>): add_rational_and_complex}</span><br><span class="line">        multipliers = {(<span class="string">&quot;com&quot;</span>, <span class="string">&quot;rat&quot;</span>): mul_complex_and_rational,</span><br><span class="line">                       (<span class="string">&quot;rat&quot;</span>, <span class="string">&quot;com&quot;</span>): mul_rational_and_complex}</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;ComplexRI(<span class="number">1.5</span>,<span class="number">0</span>)+Rational(<span class="number">3</span>,<span class="number">2</span>)</span><br><span class="line">ComplexRI(<span class="number">3</span>,<span class="number">0</span>)</span><br><span class="line">&gt;&gt;&gt;Rational(-<span class="number">1</span>,<span class="number">2</span>)*ComplexMA(<span class="number">4</span>,pi/<span class="number">2</span>)</span><br><span class="line">ComplexMA(<span class="number">2</span>,<span class="number">1.5</span>*pi)</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5728;&#x65B0;&#x5B9A;&#x4E49;&#x7684;<code>Number</code>&#x7C7B;&#x4E2D;&#xFF0C;&#x6240;&#x6709;&#x8DE8;&#x7C7B;&#x578B;&#x51FD;&#x6570;&#x90FD;&#x4F5C;&#x4E3A;<code>adders</code>&#x4E0E;<code>multipliers</code>&#x7684;&#x7D22;&#x5F15;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5728;&#x8FD9;&#x79CD;&#x57FA;&#x4E8E;&#x5B57;&#x5178;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x662F;&#x53EF;&#x62D3;&#x5C55;&#x7684;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x8981;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;<code>Number</code>&#x7684;&#x65B0;&#x5B50;&#x7C7B;&#x65F6;&#xFF0C;&#x53EA;&#x9700;<strong>&#x7ED9;&#x5B83;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;<code>type_tag</code>&#xFF0C;&#x7136;&#x540E;&#x628A;&#x5BF9;&#x5E94;&#x7684;&#x8DE8;&#x7C7B;&#x578B;&#x64CD;&#x4F5C;&#x52A0;&#x8FDB;<code>Number.adders</code>&#x548C;<code>Number.multiplier</code>&#x4E2D;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;&#x5B50;&#x7C7B;&#x4E2D;&#x5B9A;&#x4E49;&#x81EA;&#x5DF1;&#x7684;<code>adders</code>&#x548C;<code>multipliers</code></strong>
&#x3002;</p>
<h3 id="3&#x7C7B;&#x578B;&#x5F3A;&#x5236;">3.&#x7C7B;&#x578B;&#x5F3A;&#x5236;</h3>
<p>&#x2003;&#x2003;&#x5728;&#x5BF9;&#x4E24;&#x79CD;&#x5B8C;&#x5168;&#x4E0D;&#x76F8;&#x540C;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x76F4;&#x63A5;&#x5B9E;&#x73B0;&#x8DE8;&#x7C7B;&#x578B;&#x51FD;&#x6570;&#x662F;&#x6700;&#x4F73;&#x9009;&#x62E9;&#x3002;&#x4F46;&#x6709;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5229;&#x7528;<strong>&#x7C7B;&#x578B;&#x7CFB;&#x7EDF;&#x4E2D;&#x9690;&#x6027;&#x7684;&#x9644;&#x52A0;&#x7ED3;&#x6784;</strong>&#x5F97;&#x5230;&#x66F4;&#x4F18;&#x89E3;&#x6CD5;&#x3002;</p>
<p>&#x2003;&#x2003;&#x901A;&#x5E38;&#xFF0C;<strong>&#x4E0D;&#x540C;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x5E76;&#x4E0D;&#x662F;&#x5B8C;&#x5168;&#x72EC;&#x7ACB;&#x7684;&#xFF0C;&#x4E00;&#x79CD;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x53EF;&#x80FD;&#x662F;&#x53E6;&#x4E00;&#x79CD;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x7684;&#x5B50;&#x7C7B;&#x578B;</strong>&#xFF0C;&#x4F8B;&#x5982;&#x5B9E;&#x6570;&#x5C31;&#x53EF;&#x4EE5;&#x88AB;&#x770B;&#x4F5C;&#x865A;&#x90E8;&#x4E3A;<span class="math inline">\(0\)</span>&#x7684;&#x590D;&#x6570;&#x3002;&#x8FD9;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x53EA;&#x7528;<code>Complex.add</code>&#x4E0E;<code>Complex.mul</code>&#x6765;&#x5B9E;&#x73B0;&#x5B9E;&#x6570;&#x865A;&#x6570;&#x7684;&#x8FD0;&#x7B97;&#x4E86;&#x3002;&#x50CF;&#x8FD9;&#x6837;&#x8F6C;&#x6362;&#x7C7B;&#x578B;&#x7684;&#x505A;&#x6CD5;&#x88AB;&#x79F0;&#x4F5C;<strong>&#x7C7B;&#x578B;&#x5F3A;&#x5236;(<span class="math inline">\(type\;coercion\)</span>)</strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x51FD;&#x6570;&#x5B9E;&#x73B0;&#x7C7B;&#x578B;&#x5F3A;&#x5236;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">rational_to_complex</span>(<span class="params">r</span>):</span><br><span class="line">        <span class="keyword">return</span> ComplexRI(r.numer/r.denom,<span class="number">0</span>)</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5305;&#x542B;&#x7C7B;&#x578B;&#x5F3A;&#x5236;&#x7684;<code>Number</code>&#x7C7B;&#x5B9E;&#x73B0;&#x5982;&#x4E0B;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">class</span> <span class="title class_">Number</span>:</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__add__</span>(<span class="params">self, other</span>):</span><br><span class="line">            x,y=self.coerce(other)</span><br><span class="line">            <span class="keyword">return</span> x.add(y)</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self, other</span>):</span><br><span class="line">            x,y=self.coerce(other)</span><br><span class="line">            <span class="keyword">return</span> x.mul(y)</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">coerce</span>(<span class="params">self, other</span>):</span><br><span class="line">            <span class="keyword">if</span> self.type_tag==other.type_tag:</span><br><span class="line">                <span class="keyword">return</span> self,other</span><br><span class="line">            <span class="keyword">elif</span> (self.type_tag, other.type_tag) <span class="keyword">in</span> self.coercions:</span><br><span class="line">                <span class="keyword">return</span> (self.coerce_to(other.type_tag), other)</span><br><span class="line">            <span class="keyword">elif</span> (other.type_tag, self.type_tag) <span class="keyword">in</span> self.coercions:</span><br><span class="line">                <span class="keyword">return</span> (self, other.coerce_to(self.type_tag))</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">coerce_to</span>(<span class="params">self, other_tag</span>):</span><br><span class="line">            coercion_fn=self.coercions[(self.type_tag, other_tag)]</span><br><span class="line">            <span class="keyword">return</span> coercion_fn(self)</span><br><span class="line">        coercions={(<span class="string">&apos;rat&apos;</span>, <span class="string">&apos;com&apos;</span>): rational_to_complex}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x7C7B;&#x578B;&#x5F3A;&#x5236;&#x7684;&#x65B9;&#x6CD5;&#x76F8;&#x5BF9;&#x4E8E;&#x7C7B;&#x578B;&#x5206;&#x6D3E;&#x6709;&#x65B0;&#x7684;&#x4F18;&#x52BF;&#xFF1A;&#x867D;&#x7136;&#x9700;&#x8981;&#x4E00;&#x4E2A;<code>coerce_to</code>&#x51FD;&#x6570;&#x5B9E;&#x73B0;&#x7C7B;&#x578B;&#x8F6C;&#x6362;&#xFF0C;&#x4F46;<strong>&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x5199;&#x8FD9;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5C06;&#x5176;&#x4ED6;&#x6240;&#x6709;&#x7684;&#x51FD;&#x6570;&#x5F52;&#x8FDB;&#x4E00;&#x4E2A;&#x7EDF;&#x4E00;&#x7684;&#x8303;&#x5F0F;&#x4E2D;</strong>&#x3002;&#x8FD9;&#x662F;&#x57FA;&#x4E8E;&#x4EE5;&#x4E0B;&#x601D;&#x60F3;&#xFF1A;&#x7C7B;&#x578B;&#x95F4;&#x7684;&#x8F6C;&#x6362;<strong>&#x53EA;&#x4E0E;&#x7C7B;&#x578B;&#x672C;&#x8EAB;&#x6709;&#x5173;&#x3001;&#x4E0E;&#x7C7B;&#x578B;&#x7684;&#x5177;&#x4F53;&#x64CD;&#x4F5C;&#x65E0;&#x5173;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x7C7B;&#x578B;&#x5F3A;&#x5236;&#x7ED9;&#x6211;&#x4EEC;&#x5E26;&#x6765;&#x4E86;&#x542F;&#x53D1;&#xFF1A;&#x5BF9;&#x4E8E;&#x4E24;&#x79CD;&#x6570;&#x636E;&#x7C7B;&#x578B;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;<strong>&#x8BBE;&#x6CD5;&#x627E;&#x5230;&#x4E00;&#x79CD;&#x4E2D;&#x95F4;&#x7C7B;&#x578B;(&#x5373;&#x524D;&#x6587;&#x8BF4;&#x7684;&#x201C;&#x9690;&#x6027;&#x7684;&#x9644;&#x52A0;&#x7ED3;&#x6784;&#x201D;)&#xFF0C;&#x5C06;&#x4E24;&#x79CD;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x8F6C;&#x6362;&#x6210;&#x8FD9;&#x4E2A;&#x7C7B;&#x578B;</strong>&#x3002;&#x4F8B;&#x5982;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C06;&#x77E9;&#x5F62;&#x548C;&#x83F1;&#x5F62;&#x90FD;&#x8F6C;&#x5316;&#x4E3A;&#x5E73;&#x884C;&#x56DB;&#x8FB9;&#x5F62;&#x3002;&#x7C7B;&#x4F3C;&#x7684;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x4E2D;&#x95F4;&#x7C7B;&#x578B;&#x53EF;&#x4EE5;&#x8F6C;&#x6362;&#x4E3A;&#x65B0;&#x7684;&#x4E2D;&#x95F4;&#x7C7B;&#x578B;<span class="math inline">\(\cdots\)</span>&#x901A;&#x8FC7;&#x8FD9;&#x6837;&#x7684;&#x94FE;&#x5F0F;&#x5F3A;&#x5236;(<span class="math inline">\(chaining\;coercion\)</span>)&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x51CF;&#x5C11;&#x7A0B;&#x5E8F;&#x4E2D;&#x9700;&#x8981;&#x7684;<code>coerce</code>&#x51FD;&#x6570;&#x6570;&#x91CF;&#x3002;</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/2.9.%E8%BF%AD%E4%BB%A3%E5%AF%B9%E8%B1%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/2.9.%E8%BF%AD%E4%BB%A3%E5%AF%B9%E8%B1%A1/" class="post-title-link" itemprop="url">2.9.&#x8FED;&#x4EE3;&#x5BF9;&#x8C61;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 15:30:58" itemprop="dateModified" datetime="2024-06-02T15:30:58+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SICP-in-python/" itemprop="url" rel="index"><span itemprop="name">SICP in python</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SICP-in-python/Chapter-2-Building-Abstraction-with-Data/" itemprop="url" rel="index"><span itemprop="name">Chapter 2.Building Abstraction with Data</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>1k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>4 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="29&#x8FED;&#x4EE3;&#x5BF9;&#x8C61;"><span class="math inline">\(2.9\)</span>&#x8FED;&#x4EE3;&#x5BF9;&#x8C61;</h1>
<p>&#x2003;&#x2003;&#x5BF9;&#x8C61;&#x53EF;&#x4EE5;&#x5C06;&#x5176;&#x4ED6;&#x5BF9;&#x8C61;&#x4F5C;&#x4E3A;&#x5C5E;&#x6027;&#xFF0C;&#x5F53;&#x4E00;&#x4E2A;&#x7C7B;&#x4E2D;&#x7684;&#x67D0;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x5C5E;&#x6027;&#x662F;&#x8BE5;&#x7C7B;&#x7684;&#x67D0;&#x4E2A;&#x6210;&#x5458;&#x65F6;&#xFF0C;&#x5B83;&#x5C31;&#x662F;&#x8FED;&#x4EE3;&#x5BF9;&#x8C61;(<span class="math inline">\(recursive\;object\)</span>)&#x3002;</p>
<h3 id="1&#x94FE;&#x8868;&#x7C7B;">1.&#x94FE;&#x8868;&#x7C7B;</h3>
<h4 id="a&#x94FE;&#x8868;&#x7C7B;&#x5B9A;&#x4E49;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&#x94FE;&#x8868;&#x7C7B;&#x5B9A;&#x4E49;</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">class</span> <span class="title class_">Link</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;A linked list with a first element and the rest.&quot;&quot;&quot;</span></span><br><span class="line">        empty = ()</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, first, rest=empty</span>):</span><br><span class="line">            <span class="keyword">assert</span> rest <span class="keyword">is</span> Link.empty <span class="keyword">or</span> <span class="built_in">isinstance</span>(rest, Link)</span><br><span class="line">            <span class="comment"># if rest is an empty list or is a link instance</span></span><br><span class="line">            self.first = first</span><br><span class="line">            self.rest = rest</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, i</span>):</span><br><span class="line">            <span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">return</span> self.first</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> self.rest[i-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span> + <span class="built_in">len</span>(self.rest)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = Link(<span class="number">3</span>, Link(<span class="number">4</span>, Link(<span class="number">5</span>)))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(s)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[<span class="number">1</span>]</span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure>
<h4 id="b&#x5B57;&#x7B26;&#x4E32;&#x8868;&#x793A;">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>&#x5B57;&#x7B26;&#x4E32;&#x8868;&#x793A;</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">link_expression</span>(<span class="params">s</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Return a string that would evaluate to s.&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> s.rest <span class="keyword">is</span> Link.empty:</span><br><span class="line">            rest = <span class="string">&apos;&apos;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            rest = <span class="string">&apos;, &apos;</span> + link_expression(s.rest)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&apos;Link({0}{1})&apos;</span>.<span class="built_in">format</span>(s.first, rest)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>link_expression(s)</span><br><span class="line"><span class="string">&apos;Link(3, Link(4, Link(5)))&apos;</span></span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;&#x5C06;&#x8FD9;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x8868;&#x793A;&#x51FD;&#x6570;&#x4E0E;<code>__repr__</code>&#x65B9;&#x6CD5;&#x7ED1;&#x5B9A;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x663E;&#x793A;&#x94FE;&#x8868;&#x5B9E;&#x4F8B;&#x65F6;&#x81EA;&#x52A8;&#x8C03;&#x7528;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Link.__repr__ = link_expression</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line">Link(<span class="number">3</span>, Link(<span class="number">4</span>, Link(<span class="number">5</span>)))</span><br></pre></td></tr></table></figure></p>
<h4 id="c&#x94FE;&#x8868;&#x7684;&#x6620;&#x5C04;-&#x7B5B;&#x9009;&#x4E0E;&#x5B57;&#x7B26;&#x63D2;&#x5165;">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>&#x94FE;&#x8868;&#x7684;&#x6620;&#x5C04;&#x3001;&#x7B5B;&#x9009;&#x4E0E;&#x5B57;&#x7B26;&#x63D2;&#x5165;</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">map_link</span>(<span class="params">f, s</span>):</span><br><span class="line">        <span class="keyword">if</span> s <span class="keyword">is</span> Link.empty:</span><br><span class="line">            <span class="keyword">return</span> s</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> Link(f(s.first), map_link(f, s.rest))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>map_link(square, s)</span><br><span class="line">Link(<span class="number">9</span>, Link(<span class="number">16</span>, Link(<span class="number">25</span>)))</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">filter_link</span>(<span class="params">f, s</span>):</span><br><span class="line">        <span class="keyword">if</span> s <span class="keyword">is</span> Link.empty:</span><br><span class="line">            <span class="keyword">return</span> s</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            filtered = filter_link(f, s.rest)</span><br><span class="line">            <span class="keyword">if</span> f(s.first):</span><br><span class="line">                <span class="keyword">return</span> Link(s.first, filtered)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> filtered</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>odd = <span class="keyword">lambda</span> x: x % <span class="number">2</span> == <span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>map_link(square, filter_link(odd, s))</span><br><span class="line">Link(<span class="number">9</span>, Link(<span class="number">25</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[square(x) <span class="keyword">for</span> x <span class="keyword">in</span> [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>] <span class="keyword">if</span> odd(x)]</span><br><span class="line">[<span class="number">9</span>, <span class="number">25</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">join_link</span>(<span class="params">s, separator</span>):</span><br><span class="line">        <span class="keyword">if</span> s <span class="keyword">is</span> Link.empty:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">elif</span> s.rest <span class="keyword">is</span> Link.empty:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">str</span>(s.first)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">str</span>(s.first) + separator + join_link(s.rest, separator)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>join_link(s, <span class="string">&quot;, &quot;</span>)</span><br><span class="line"><span class="string">&apos;3, 4, 5&apos;</span></span><br></pre></td></tr></table></figure>
<h4 id="d&#x94FE;&#x8868;&#x7684;&#x4E00;&#x4E9B;&#x5176;&#x5B83;&#x8FED;&#x4EE3;&#x64CD;&#x4F5C;">&#x2003;&#x2003;<span class="math inline">\(d.\)</span>&#x94FE;&#x8868;&#x7684;&#x4E00;&#x4E9B;&#x5176;&#x5B83;&#x8FED;&#x4EE3;&#x64CD;&#x4F5C;</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">extend_link</span>(<span class="params">s, t</span>):</span><br><span class="line">        <span class="keyword">if</span> s <span class="keyword">is</span> Link.empty:</span><br><span class="line">            <span class="keyword">return</span> t</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> Link(s.first, extend_link(s.rest, t))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>extend_link(s, s)</span><br><span class="line">Link(<span class="number">3</span>, Link(<span class="number">4</span>, Link(<span class="number">5</span>, Link(<span class="number">3</span>, Link(<span class="number">4</span>, Link(<span class="number">5</span>))))))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Link.__add__ = extend_link</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s + s</span><br><span class="line">Link(<span class="number">3</span>, Link(<span class="number">4</span>, Link(<span class="number">5</span>, Link(<span class="number">3</span>, Link(<span class="number">4</span>, Link(<span class="number">5</span>))))))</span><br></pre></td></tr></table></figure>
<h3 id="2&#x6811;&#x7C7B;">2.&#x6811;&#x7C7B;</h3>
<h4 id="a&#x6811;&#x7C7B;&#x5B9A;&#x4E49;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&#x6811;&#x7C7B;&#x5B9A;&#x4E49;</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">class</span> <span class="title class_">Tree</span>:</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, label, branches=(<span class="params"></span>)</span>):</span><br><span class="line">            self.label = label</span><br><span class="line">            <span class="keyword">for</span> branch <span class="keyword">in</span> branches:</span><br><span class="line">                <span class="keyword">assert</span> <span class="built_in">isinstance</span>(branch, Tree)</span><br><span class="line">            self.branches = branches</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="keyword">if</span> self.branches:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&apos;Tree({0}, {1})&apos;</span>.<span class="built_in">format</span>(self.label, <span class="built_in">repr</span>(self.branches))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&apos;Tree({0})&apos;</span>.<span class="built_in">format</span>(<span class="built_in">repr</span>(self.label))</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">is_leaf</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">not</span> self.branches</span><br></pre></td></tr></table></figure>
<h3 id="3set">3.<span class="math inline">\(set\)</span></h3>
<h4 id="a&#x6982;&#x5FF5;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&#x6982;&#x5FF5;</h4>
<p>&#x2003;&#x2003;<span class="math inline">\(set\)</span>&#x662F;<span class="math inline">\(python\)</span>&#x5185;&#x7F6E;&#x7684;&#x5BB9;&#x5668;&#xFF0C;<span class="math inline">\(set\)</span>&#x5185;&#x90E8;&#x7684;&#x5143;&#x7D20;&#x4F1A;&#x81EA;&#x52A8;&#x53BB;&#x91CD;&#x4E0E;&#x6392;&#x5E8F;&#x3002;</p>
<h4 id="b&#x57FA;&#x672C;&#x64CD;&#x4F5C;">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>&#x57FA;&#x672C;&#x64CD;&#x4F5C;</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">3</span> <span class="keyword">in</span> s</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(s)</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.union({<span class="number">1</span>, <span class="number">5</span>})</span><br><span class="line">{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>}</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.intersection({<span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>})</span><br><span class="line">{<span class="number">3</span>, <span class="number">4</span>}</span><br></pre></td></tr></table></figure>
<h3 id="4set&#x7684;&#x5B9E;&#x73B0;">4.<span class="math inline">\(set\)</span>&#x7684;&#x5B9E;&#x73B0;</h3>
<h4 id="a&#x94FE;&#x8868;&#x5B9E;&#x73B0;&#x975E;&#x6392;&#x5E8F;set">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&#x94FE;&#x8868;&#x5B9E;&#x73B0;&#x975E;&#x6392;&#x5E8F;<span class="math inline">\(set\)</span></h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">empty</span>(<span class="params">s</span>):</span><br><span class="line">        <span class="keyword">return</span> s <span class="keyword">is</span> Link.empty</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">set_contains</span>(<span class="params">s, v</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Return True if and only if set s contains v.&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> empty(s):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">elif</span> s.first == v:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> set_contains(s.rest, v)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = Link(<span class="number">4</span>, Link(<span class="number">1</span>, Link(<span class="number">5</span>)))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>set_contains(s, <span class="number">2</span>)</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>set_contains(s, <span class="number">5</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">adjoin_set</span>(<span class="params">s, v</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Return a set containing all elements of s and element v.&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> set_contains(s, v):</span><br><span class="line">            <span class="keyword">return</span> s</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> Link(v, s)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = adjoin_set(s, <span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t</span><br><span class="line">Link(<span class="number">2</span>, Link(<span class="number">4</span>, Link(<span class="number">1</span>, Link(<span class="number">5</span>))))</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">intersect_set</span>(<span class="params">set1, set2</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Return a set containing all elements common to set1 and set2.&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> keep_if_link(set1, <span class="keyword">lambda</span> v: set_contains(set2, v))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>intersect_set(t, apply_to_all_link(s, square))</span><br><span class="line">Link(<span class="number">4</span>, Link(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">union_set</span>(<span class="params">set1, set2</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Return a set containing all elements either in set1 or set2.&quot;&quot;&quot;</span></span><br><span class="line">        set1_not_set2 = keep_if_link(set1, <span class="keyword">lambda</span> v: <span class="keyword">not</span> set_contains(set2, v))</span><br><span class="line">        <span class="keyword">return</span> extend_link(set1_not_set2, set2)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>union_set(t, s)</span><br><span class="line">Link(<span class="number">2</span>, Link(<span class="number">4</span>, Link(<span class="number">1</span>, Link(<span class="number">5</span>))))</span><br></pre></td></tr></table></figure>
<h4 id="b&#x6392;&#x5E8F;&#x5BF9;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x7684;&#x5F71;&#x54CD;">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>&#x6392;&#x5E8F;&#x5BF9;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x7684;&#x5F71;&#x54CD;</h4>
<p>&#x2003;&#x2003;&#x5BF9;&#x4E8E;&#x67E5;&#x8BE2;&#x64CD;&#x4F5C;&#xFF0C;&#x975E;&#x6392;&#x5E8F;&#x5143;&#x7D20;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A;<span class="math inline">\(O(n)\)</span>&#xFF1B;&#x800C;&#x5BF9;&#x4E8E;&#x6392;&#x5E8F;&#x5143;&#x7D20;&#xFF0C;&#x67E5;&#x8BE2;&#x6700;&#x5C0F;&#x5143;&#x7D20;&#x4E3A;<span class="math inline">\(1\)</span>&#xFF0C;&#x6700;&#x5927;&#x5143;&#x7D20;&#x4E3A;<span class="math inline">\(n\)</span>&#xFF0C;&#x5E73;&#x5747;&#x590D;&#x6742;&#x5EA6;&#x4E3A;<span class="math inline">\(O({n\over 2})=O(n)\)</span>&#xFF0C;&#x867D;&#x7136;&#x540C;&#x9636;&#x4F46;&#x8F83;&#x5C0F;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5BF9;&#x4E8E;&#x5408;&#x5E76;&#x64CD;&#x4F5C;&#xFF0C;&#x975E;&#x6392;&#x5E8F;&#x5143;&#x7D20;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x662F;<span class="math inline">\(O(n,m)\)</span>&#xFF1B;&#x800C;&#x5BF9;&#x4E8E;&#x6392;&#x5E8F;&#x5143;&#x7D20;&#xFF0C;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x53CC;&#x6307;&#x9488;&#x7B97;&#x6CD5;&#x5B9E;&#x73B0;<span class="math inline">\(O(m+n)\)</span>&#x7684;&#x590D;&#x6742;&#x5EA6;&#x3002;</p>
<h4 id="c&#x5217;&#x8868;&#x5B9E;&#x73B0;&#x6392;&#x5E8F;set">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>&#x5217;&#x8868;&#x5B9E;&#x73B0;&#x6392;&#x5E8F;<span class="math inline">\(set\)</span></h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">set_contains</span>(<span class="params">s, v</span>):</span><br><span class="line">        <span class="keyword">if</span> empty(s) <span class="keyword">or</span> s.first &gt; v:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">elif</span> s.first == v:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> set_contains(s.rest, v)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>u = Link(<span class="number">1</span>, Link(<span class="number">4</span>, Link(<span class="number">5</span>)))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>set_contains(u, <span class="number">0</span>)</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>set_contains(u, <span class="number">4</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">intersect_set</span>(<span class="params">set1, set2</span>):</span><br><span class="line">        <span class="keyword">if</span> empty(set1) <span class="keyword">or</span> empty(set2):</span><br><span class="line">            <span class="keyword">return</span> Link.empty</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            e1, e2 = set1.first, set2.first</span><br><span class="line">            <span class="keyword">if</span> e1 == e2:</span><br><span class="line">                <span class="keyword">return</span> Link(e1, intersect_set(set1.rest, set2.rest))</span><br><span class="line">            <span class="keyword">elif</span> e1 &lt; e2:</span><br><span class="line">                <span class="keyword">return</span> intersect_set(set1.rest, set2)</span><br><span class="line">            <span class="keyword">elif</span> e2 &lt; e1:</span><br><span class="line">                <span class="keyword">return</span> intersect_set(set1, set2.rest)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>intersect_set(s, s.rest)</span><br><span class="line">Link(<span class="number">4</span>, Link(<span class="number">5</span>))</span><br></pre></td></tr></table></figure>
<h4 id="d&#x4E8C;&#x53C9;&#x67E5;&#x627E;&#x6811;&#x6811;&#x5B9E;&#x73B0;set">&#x2003;&#x2003;<span class="math inline">\(d.\)</span>&#x4E8C;&#x53C9;&#x67E5;&#x627E;&#x6811;&#x6811;&#x5B9E;&#x73B0;<span class="math inline">\(set\)</span></h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">set_contains</span>(<span class="params">s, v</span>):</span><br><span class="line">        <span class="keyword">if</span> s <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">elif</span> s.entry == v:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">elif</span> s.entry &lt; v:</span><br><span class="line">            <span class="keyword">return</span> set_contains(s.right, v)</span><br><span class="line">        <span class="keyword">elif</span> s.entry &gt; v:</span><br><span class="line">            <span class="keyword">return</span> set_contains(s.left, v)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">adjoin_set</span>(<span class="params">s, v</span>):</span><br><span class="line">        <span class="keyword">if</span> s <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> Tree(v)</span><br><span class="line">        <span class="keyword">elif</span> s.entry == v:</span><br><span class="line">            <span class="keyword">return</span> s</span><br><span class="line">        <span class="keyword">elif</span> s.entry &lt; v:</span><br><span class="line">            <span class="keyword">return</span> Tree(s.entry, s.left, adjoin_set(s.right, v))</span><br><span class="line">        <span class="keyword">elif</span> s.entry &gt; v:</span><br><span class="line">            <span class="keyword">return</span> Tree(s.entry, adjoin_set(s.left, v), s.right)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>adjoin_set(adjoin_set(adjoin_set(<span class="literal">None</span>, <span class="number">2</span>), <span class="number">3</span>), <span class="number">1</span>)</span><br><span class="line">Tree(<span class="number">2</span>, Tree(<span class="number">1</span>), Tree(<span class="number">3</span>))</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/3.2.scheme%E8%AF%AD%E8%A8%80%E4%BB%8B%E7%BB%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/3.2.scheme%E8%AF%AD%E8%A8%80%E4%BB%8B%E7%BB%8D/" class="post-title-link" itemprop="url">3.2.scheme&#x8BED;&#x8A00;&#x4ECB;&#x7ECD;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 15:45:48" itemprop="dateModified" datetime="2024-06-02T15:45:48+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SICP-in-python/" itemprop="url" rel="index"><span itemprop="name">SICP in python</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SICP-in-python/Chapter-3-Interpreting-Computer-Programs/" itemprop="url" rel="index"><span itemprop="name">Chapter 3.Interpreting Computer Programs</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>1k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>4 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="32scheme&#x8BED;&#x8A00;&#x4ECB;&#x7ECD;"><span class="math inline">\(3.2\;scheme\)</span>&#x8BED;&#x8A00;&#x4ECB;&#x7ECD;</h1>
<h3 id="1&#x57FA;&#x672C;&#x8868;&#x8FBE;&#x5F0F;">1.&#x57FA;&#x672C;&#x8868;&#x8FBE;&#x5F0F;</h3>
<h4 id="a&#x6570;&#x5B57;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&#x6570;&#x5B57;</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; 1234    ; integer</span><br><span class="line">1234</span><br><span class="line">scm&gt; 123.4   ; real number</span><br><span class="line">123.4</span><br></pre></td></tr></table></figure>
<h4 id="b&#x6807;&#x5FD7;symbol">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>&#x6807;&#x5FD7;<span class="math inline">\(symbol\)</span></h4>
<p>&#x2003;&#x2003;&#x6807;&#x5FD7;&#x662F;<span class="math inline">\(scheme\)</span>&#x8BED;&#x8A00;&#x7279;&#x6709;&#x7684;&#x7C7B;&#x578B;&#x3002;&#x5728;<span class="math inline">\(scheme\)</span>&#x8BED;&#x8A00;&#x4E2D;&#xFF0C;&#x6807;&#x5FD7;&#x672C;&#x8EAB;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x503C;&#xFF0C;&#x800C;&#x5728;<span class="math inline">\(python\)</span>&#x4E2D;&#x7684;&#x201C;&#x6807;&#x5FD7;&#x201D;&#x53EA;&#x662F;&#x4F5C;&#x4E3A;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x540D;&#x79F0;&#x5B58;&#x5728;&#x3002;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; quotient      ; A name bound to a built-in procedure</span><br><span class="line">#[quotient]</span><br><span class="line">scm&gt; &apos;quotient     ; An expression that evaluates to a symbol</span><br><span class="line">quotient</span><br><span class="line">scm&gt; &apos;hello-world!</span><br><span class="line">hello-world!</span><br></pre></td></tr></table></figure></p>
<h4 id="c&#x5E03;&#x5C14;&#x503C;">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>&#x5E03;&#x5C14;&#x503C;</h4>
<p>&#x2003;&#x2003;&#x5728;<span class="math inline">\(scheme\)</span>&#x8BED;&#x8A00;&#x4E2D;&#xFF0C;&#x9664;&#x4E86;<code>#f</code>&#x5916;&#x7684;&#x6240;&#x6709;&#x503C;&#x90FD;&#x662F;<span class="math inline">\(true\)</span>&#xFF0C;&#x8FD9;&#x548C;<span class="math inline">\(python\)</span>&#x7684;&#x96F6;&#x503C;&#x4E3A;<span class="math inline">\(false\)</span>&#x4E0D;&#x540C;&#x3002;<span class="math inline">\(scheme\)</span>&#x7528;<code>#t</code>&#x8868;&#x793A;<span class="math inline">\(true\)</span>&#xFF0C;&#x7528;<code>#f</code>&#x8868;&#x793A;<span class="math inline">\(false\)</span>&#xFF1A; <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; #t</span><br><span class="line">#t</span><br><span class="line">scm&gt; #f</span><br><span class="line">#f</span><br></pre></td></tr></table></figure></p>
<h3 id="2&#x8C03;&#x7528;&#x8868;&#x8FBE;&#x5F0F;">2.&#x8C03;&#x7528;&#x8868;&#x8FBE;&#x5F0F;</h3>
<p>&#x2003;&#x2003;&#x4E0E;<span class="math inline">\(Python\)</span>&#x7C7B;&#x4F3C;&#xFF0C;<span class="math inline">\(Scheme\)</span>&#x8C03;&#x7528;&#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#x7684;&#x64CD;&#x4F5C;&#x7B26;&#x4F4D;&#x4E8E;&#x6240;&#x6709;&#x64CD;&#x4F5C;&#x6570;&#x4E4B;&#x524D;&#x3002;&#x4E0E;
<span class="math inline">\(Python\)</span>&#x4E0D;&#x540C;&#xFF0C;&#x64CD;&#x4F5C;&#x7B26;&#x5305;&#x542B;&#x5728;&#x62EC;&#x53F7;&#x5185;&#xFF0C;&#x4E14;&#x64CD;&#x4F5C;&#x6570;&#x7528;&#x7A7A;&#x683C;&#x800C;&#x4E0D;&#x662F;&#x9017;&#x53F7;&#x5206;&#x9694;&#xFF0C;&#x8BA1;&#x7B97;&#x7684;&#x5177;&#x4F53;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;</p>
<ol type="1">
<li>&#x8BA1;&#x7B97;&#x64CD;&#x4F5C;&#x7B26;&#xFF0C;&#x51B3;&#x5B9A;&#x8FD0;&#x7B97;&#x89C4;&#x5219;&#x3002;</li>
<li>&#x4ECE;&#x5DE6;&#x5230;&#x53F3;&#x8003;&#x8651;&#x64CD;&#x4F5C;&#x6570;&#x3002;</li>
<li>&#x5C06;&#x8FD0;&#x7B97;&#x89C4;&#x5219;&#x4F5C;&#x7528;&#x4E8E;&#x64CD;&#x4F5C;&#x6570;&#x4E0A;&#x3002;</li>
</ol>
<p>&#x2003;&#x2003;&#x8FD9;&#x4E5F;&#x662F;<span class="math inline">\(scheme\)</span>&#x8BED;&#x53E5;&#x4E00;&#x822C;&#x5730;&#x6267;&#x884C;&#x65B9;&#x6CD5;&#x3002;&#x4F46;&#x4E4B;&#x540E;&#x8BB2;&#x89E3;&#x7684;&#x89C4;&#x5219;&#x4E0E;&#x8FD9;&#x4E2A;&#x4E0D;&#x540C;&#xFF0C;&#x88AB;&#x79F0;&#x4F5C;&#x201C;&#x7279;&#x6B8A;&#x89C4;&#x5219;&#x201D;&#x3002;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; (+ 1 2)</span><br><span class="line">3</span><br><span class="line">scm&gt; (- 10 (/ 6 2))</span><br><span class="line">7</span><br><span class="line">scm&gt; (modulo 35 4)</span><br><span class="line">3</span><br><span class="line">scm&gt; (even? (quotient 45 2))</span><br><span class="line">#t</span><br></pre></td></tr></table></figure></p>
<h3 id="3&#x63A7;&#x5236;&#x7ED3;&#x6784;">3.&#x63A7;&#x5236;&#x7ED3;&#x6784;</h3>
<h4 id="aif&#x8BED;&#x53E5;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span><code>if</code>&#x8BED;&#x53E5;</h4>
<p>&#x2003;&#x2003;<span class="math inline">\(scheme\)</span>&#x4E2D;&#x7684;<code>if</code>&#x8BED;&#x53E5;&#x7ED3;&#x6784;&#x5982;&#x4E0B;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(if &lt;predicate&gt; &lt;if-true&gt; [if-false])</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8BE5;&#x7ED3;&#x6784;&#x7684;<code>&lt;if-true&gt;</code>&#x90E8;&#x5206;&#x4E0E;<code>[if-false]</code>&#x90E8;&#x5206;&#x53EA;&#x80FD;&#x63A5;&#x53D7;&#x4E00;&#x4E2A;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x4E0E;<span class="math inline">\(python\)</span>&#x4E0D;&#x540C;&#x3002;&#x8BE5;&#x7ED3;&#x6784;&#x7684;&#x4E00;&#x4E2A;&#x8FD0;&#x884C;&#x5B9E;&#x4F8B;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="/2024/05/31/3.2.scheme%E8%AF%AD%E8%A8%80%E4%BB%8B%E7%BB%8D/image.png"></p>
<p>&#x2003;&#x2003;<span class="math inline">\(scheme\)</span>&#x4E2D;&#x6CA1;&#x6709;<code>elif</code>&#x8BED;&#x53E5;&#xFF0C;&#x5B9E;&#x73B0;&#x8BE5;&#x529F;&#x80FD;&#x53EA;&#x80FD;&#x901A;&#x8FC7;<code>if</code>&#x7684;&#x5D4C;&#x5957;&#xFF1A;</p>
<p><img src="/2024/05/31/3.2.scheme%E8%AF%AD%E8%A8%80%E4%BB%8B%E7%BB%8D/image-1.png"></p>
<h4 id="bcond&#x8868;&#x8FBE;&#x5F0F;">&#x2003;&#x2003;<span class="math inline">\(b.\)</span><code>cond</code>&#x8868;&#x8FBE;&#x5F0F;</h4>
<p>&#x2003;&#x2003;<code>cond</code>&#x8868;&#x8FBE;&#x5F0F;&#x7C7B;&#x4F3C;<code>switch</code>&#x8BED;&#x53E5;&#xFF0C;&#x5176;&#x7ED3;&#x6784;&#x5982;&#x4E0B;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(cond</span><br><span class="line">    (&lt;p1&gt; &lt;e1&gt;)</span><br><span class="line">    (&lt;p2&gt; &lt;e2&gt;)</span><br><span class="line">    ...</span><br><span class="line">    (&lt;pn&gt; &lt;en&gt;)</span><br><span class="line">    [(else &lt;else-expression&gt;)])</span><br></pre></td></tr></table></figure>
&#x2003;&#x2003;&#x6BCF;&#x4E2A;&#x4ECE;&#x53E5;&#x4E2D;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x8868;&#x8FBE;&#x5F0F;&#x5C31;&#x76F8;&#x5F53;&#x4E8E;<code>&lt;predicate&gt;</code>&#xFF0C;&#x5F53;<code>&lt;predicate&gt;</code>&#x4E3A;&#x771F;&#xFF0C;&#x5C31;&#x6267;&#x884C;&#x540E;&#x9762;&#x7684;&#x8BED;&#x53E5;&#x5E76;&#x7EC8;&#x6B62;&#x7A0B;&#x5E8F;&#x3002;&#x8BE5;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x4E00;&#x4E2A;&#x5177;&#x4F53;&#x5B9E;&#x4F8B;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="/2024/05/31/3.2.scheme%E8%AF%AD%E8%A8%80%E4%BB%8B%E7%BB%8D/image-2.png"></p>
<h3 id="4&#x6570;&#x636E;&#x7ED3;&#x6784;">4.&#x6570;&#x636E;&#x7ED3;&#x6784;</h3>
<h4 id="a&#x94FE;&#x8868;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&#x94FE;&#x8868;</h4>
<p>&#x2003;&#x2003;<span class="math inline">\(scheme\)</span>&#x4E2D;&#x7684;&#x94FE;&#x8868;&#x662F;&#x901A;&#x8FC7;&#x4E00;&#x7CFB;&#x5217;<span class="math inline">\(pair\)</span>&#x6784;&#x5EFA;&#x7684;&#xFF0C;&#x5B83;&#x901A;&#x8FC7;<span class="math inline">\(constructor\)</span><code>cons</code>&#x521B;&#x5EFA;&#x3002;</p>
<p>&#x2003;&#x2003;&#x94FE;&#x8868;&#x7684;<span class="math inline">\(rest\)</span>&#x5143;&#x7D20;&#xFF0C;&#x5373;<code>cdr</code>&#x64CD;&#x4F5C;&#xFF0C;&#x662F;&#x522B;&#x7684;&#x94FE;&#x8868;&#x6216;<code>nil</code>&#xFF0C;&#x7A7A;&#x94FE;&#x8868;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; (cons 1 (cons 2 (cons 3 nil)))</span><br><span class="line">(1 2 3)</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>car</code>&#x4E0E;<code>cdr</code>&#x8BED;&#x53E5;&#x83B7;&#x53D6;&#x94FE;&#x8868;&#x4E2D;&#x7684;&#x5143;&#x7D20;&#x503C;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; (define a (cons 1 (cons 2 (cons 3 nil))))  ; Assign the list to the name a</span><br><span class="line">a</span><br><span class="line">scm&gt; a</span><br><span class="line">(1 2 3)</span><br><span class="line">scm&gt; (car a)</span><br><span class="line">1</span><br><span class="line">scm&gt; (cdr a)</span><br><span class="line">(2 3)</span><br><span class="line">scm&gt; (car (cdr (cdr a)))</span><br><span class="line">3</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5982;&#x679C;&#x5728;<span class="math inline">\(pair\)</span>&#x4E2D;&#x4E0D;&#x4F20;&#x5165;&#x53E6;&#x4E00;&#x4E2A;<span class="math inline">\(pair\)</span>&#x6216;<code>nil</code>&#x4F5C;&#x4E3A;<code>cons</code>&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x7A0B;&#x5E8F;&#x4F1A;&#x62A5;&#x9519;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; (cons 1 2)</span><br><span class="line">Error</span><br></pre></td></tr></table></figure></p>
<h4 id="b&#x5217;&#x8868;">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>&#x5217;&#x8868;</h4>
<p>&#x2003;&#x2003;&#x521B;&#x5EFA;&#x5217;&#x8868;&#x7684;&#x65B9;&#x6CD5;&#x6709;&#x5F88;&#x591A;&#x79CD;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x7528;<code>list</code>&#x521B;&#x5EFA;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; (list 1 2 3)</span><br><span class="line">(1 2 3)</span><br><span class="line">scm&gt; (list 1 (list 2 3) 4)</span><br><span class="line">(1 (2 3) 4)</span><br><span class="line">scm&gt; (list (cons 1 (cons 2 nil)) 3 4)</span><br><span class="line">((1 2) 3 4)</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x6CE8;&#x610F;<code>cons</code>&#x51FD;&#x6570;&#x53EA;&#x80FD;&#x63A5;&#x53D7;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x5982;&#x679C;&#x8981;&#x5728;&#x4E00;&#x4E2A;&#x94FE;&#x8868;&#x91CC;&#x9762;&#x63D2;&#x5165;&#x591A;&#x4E2A;&#x5143;&#x7D20;&#xFF0C;&#x53EF;&#x4EE5;&#x91C7;&#x7528;&#x591A;&#x4E2A;<code>cons</code>&#x5D4C;&#x5957;&#x7684;&#x65B9;&#x6CD5;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(define (interleave first second)</span><br><span class="line">  &apos;YOUR-CODE-HERE</span><br><span class="line">  (cond</span><br><span class="line">  ((null? first) second)</span><br><span class="line">  ((null? second) first)</span><br><span class="line">  (else (cons (car first)</span><br><span class="line">    (cons (car second)</span><br><span class="line">      (interleave (cdr first) (cdr second))))))</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5355;&#x5F15;&#x53F7;&#x8BED;&#x53E5;&#x521B;&#x5EFA;&#xFF0C;&#x8BED;&#x53E5;&#x4E2D;&#x7684;<code>&apos;</code>&#x4E0D;&#x4F1A;&#x88AB;&#x8BFB;&#x5165;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; &apos;(1 2 3)</span><br><span class="line">(1 2 3)</span><br><span class="line">scm&gt; &apos;(cons 1 2)           ; Argument to quote is not evaluated</span><br><span class="line">(cons 1 2)</span><br><span class="line">scm&gt; &apos;(1 (2 3 4))</span><br><span class="line">(1 (2 3 4))</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5217;&#x8868;&#x6709;&#x4E0E;<span class="math inline">\(python\)</span>&#x7C7B;&#x4F3C;&#x7684;&#x64CD;&#x4F5C;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; (null? nil)                ; Checks if a value is the empty list</span><br><span class="line">True</span><br><span class="line">scm&gt; (append &apos;(1 2 3) &apos;(4 5 6)) ; Concatenates two lists</span><br><span class="line">(1 2 3 4 5 6)</span><br><span class="line">scm&gt; (length &apos;(1 2 3 4 5))      ; Returns the number of elements in a list</span><br><span class="line">5</span><br></pre></td></tr></table></figure></p>
<h3 id="5&#x5B9A;&#x4E49;&#x8BED;&#x53E5;">5.&#x5B9A;&#x4E49;&#x8BED;&#x53E5;</h3>
<p>&#x2003;&#x2003;&#x5B9A;&#x4E49;&#x8BED;&#x53E5;&#x7528;&#x4E8E;&#x5B9A;&#x4E49;&#x53D8;&#x91CF;&#x4E0E;&#x51FD;&#x6570;&#x3002;&#x5B9A;&#x4E49;&#x8BED;&#x53E5;&#x7684;&#x7ED3;&#x6784;&#x5982;&#x4E0B;&#xFF1A; <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(define &lt;name&gt; &lt;expression&gt;)</span><br></pre></td></tr></table></figure>
&#x2003;&#x2003;&#x8BE5;&#x8BED;&#x53E5;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x6D41;&#x7A0B;&#x5B9E;&#x73B0;&#xFF1A; 1. &#x8BA1;&#x7B97;<code>&lt;expression&gt;</code>&#x7684;&#x503C; 2.
&#x5C06;&#x503C;&#x4E0E;<code>name</code>&#x7ED1;&#x5B9A; 3. &#x8FD4;&#x56DE;<code>name</code></p>
<p>&#x2003;&#x2003;&#x53EA;&#x6709;&#x5728;&#x8C03;&#x7528;<code>define</code>&#x65F6;<code>&lt;body&gt;</code>&#x624D;&#x4F1A;&#x88AB;&#x6267;&#x884C;&#x3002;</p>
<h3 id="6lambdas">6.<span class="math inline">\(lambdas\)</span></h3>
<p>&#x2003;&#x2003;<span class="math inline">\(scheme\)</span>&#x4E2D;&#x7684;<span class="math inline">\(lambda\)</span>&#x8BED;&#x53E5;&#x5982;&#x4E0B;&#xFF1A; <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(lambda (&lt;param1&gt; &lt;param2&gt; ...) &lt;body&gt;)</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;<span class="math inline">\(lambda\)</span>&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x4F8B;&#x5982;&#x4E0B;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; (lambda (x y) (+ x y))        ; Returns a lambda function, but doesn&apos;t assign it to a name</span><br><span class="line">(lambda (x y) (+ x y))</span><br><span class="line">scm&gt; ((lambda (x y) (+ x y)) 3 4)  ; Create and call a lambda function in one line</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/3.4.%E5%B8%A6%E6%9C%89%E7%BB%84%E5%90%88%E7%9A%84%E8%AF%AD%E8%A8%80%E7%9A%84%E8%A7%A3%E9%87%8A%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/3.4.%E5%B8%A6%E6%9C%89%E7%BB%84%E5%90%88%E7%9A%84%E8%AF%AD%E8%A8%80%E7%9A%84%E8%A7%A3%E9%87%8A%E5%99%A8/" class="post-title-link" itemprop="url">3.4.&#x5E26;&#x6709;&#x7EC4;&#x5408;&#x7684;&#x8BED;&#x8A00;&#x7684;&#x89E3;&#x91CA;&#x5668;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 15:46:36" itemprop="dateModified" datetime="2024-06-02T15:46:36+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SICP-in-python/" itemprop="url" rel="index"><span itemprop="name">SICP in python</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SICP-in-python/Chapter-3-Interpreting-Computer-Programs/" itemprop="url" rel="index"><span itemprop="name">Chapter 3.Interpreting Computer Programs</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>2.3k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>8 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="34&#x5E26;&#x6709;&#x7EC4;&#x5408;&#x7684;&#x8BED;&#x8A00;&#x7684;&#x89E3;&#x91CA;&#x5668;interpretersforlanguageswithcombination">3.4
&#x5E26;&#x6709;&#x7EC4;&#x5408;&#x7684;&#x8BED;&#x8A00;&#x7684;&#x89E3;&#x91CA;&#x5668;(<span class="math inline">\(Interpreters\;for\;Languages\;with\;Combination\)</span>)</h1>
<h2 id="&#x4E00;-&#x6982;&#x8FF0;">&#x4E00;&#x3001;&#x6982;&#x8FF0;</h2>
<p>&#x2003;&#x2003;&#x5728;&#x7A0B;&#x5E8F;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x4EC5;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x65B0;&#x8BED;&#x8A00;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<strong>&#x6784;&#x5EFA;&#x89E3;&#x91CA;&#x5668;(<span class="math inline">\(interpreter\)</span>)</strong>
&#x6765;&#x5B9E;&#x73B0;&#x8FD9;&#x4E9B;&#x8BED;&#x8A00;&#x3002;&#x800C;<strong>&#x7F16;&#x7A0B;&#x8BED;&#x8A00;&#x7684;&#x89E3;&#x91CA;&#x5668;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x5728;&#x7528;&#x5728;&#x8868;&#x8FBE;&#x5F0F;&#x6216;&#x8BED;&#x8A00;&#x4E0A;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x8868;&#x73B0;&#x51FA;&#x76F8;&#x5E94;&#x7684;&#x884C;&#x4E3A;&#x6765;&#x6267;&#x884C;&#x5B83;&#x4EEC;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;<span class="math inline">\(scheme\)</span>&#x8BED;&#x8A00;&#x8BA1;&#x7B97;&#x5668;(<span class="math inline">\(Scheme-Syntax\;Calculator\)</span>)&#x662F;&#x7528;&#x4E8E;&#x52A0;&#x51CF;&#x4E58;&#x9664;&#x64CD;&#x4F5C;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x8BED;&#x8A00;&#x3002;&#x5B83;&#x4F7F;&#x7528;<span class="math inline">\(scheme\)</span>&#x7684;&#x53E5;&#x6CD5;&#x89C4;&#x5219;&#x4E0E;<span class="math inline">\(operator\)</span>&#x884C;&#x4E3A;&#xFF1A; <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&gt; (+ 1 2 3 4)</span><br><span class="line">10</span><br><span class="line">&gt; (+)</span><br><span class="line">0</span><br><span class="line">&gt; (* 1 2 3 4)</span><br><span class="line">24</span><br><span class="line">&gt; (*)</span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">&gt; (- 10 1 2 3)</span><br><span class="line">4</span><br><span class="line">&gt; (- 3)</span><br><span class="line">-3</span><br><span class="line">&gt; (/ 15 12)</span><br><span class="line">1.25</span><br><span class="line">&gt; (/ 30 5 2)</span><br><span class="line">3</span><br><span class="line">&gt; (/ 10)</span><br><span class="line">0.1</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8C03;&#x7528;&#x8868;&#x8FBE;&#x5F0F;(<span class="math inline">\(call\;expression\)</span>)&#x7684;&#x8BA1;&#x7B97;&#x65B9;&#x6CD5;&#x662F;<strong>&#x8BA1;&#x7B97;&#x5B83;&#x7684;&#x5B50;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x8FD0;&#x7B97;&#x7B26;&#x7528;&#x4E8E;&#x8BA1;&#x7B97;&#x540E;&#x7684;&#x7ED3;&#x679C;</strong>&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; (- 100 (* 7 (+ 8 (/ -12 -3))))</span><br><span class="line">16.0</span><br></pre></td></tr></table></figure></p>
<h2 id="&#x4E8C;-&#x8868;&#x8FBE;&#x5F0F;&#x6811;expressiontrees">&#x4E8C;&#x3001;&#x8868;&#x8FBE;&#x5F0F;&#x6811;<span class="math inline">\(Expression\;Trees\)</span></h2>
<p>&#x2003;&#x2003;&#x4E00;&#x4E2A;<strong>&#x6700;&#x539F;&#x59CB;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x662F;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;&#x6570;&#x5B57;&#x6216;&#x5B57;&#x7B26;&#x4E32;</strong>&#xFF0C;&#x5176;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x4E3A;<code>int</code>&#x6216;<code>float</code>&#x6216;<code>operator symbol</code>.&#x800C;<strong>&#x4E00;&#x4E2A;&#x8C03;&#x7528;&#x8868;&#x8FBE;&#x5F0F;&#x662F;&#x4E00;&#x4E2A;<span class="math inline">\(scheme\;list\)</span></strong>&#xFF0C;&#x8868;&#x8FBE;&#x5F0F;&#x7684;<strong>&#x7B2C;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x662F;&#x64CD;&#x4F5C;&#x7B26;<span class="math inline">\(operator\)</span></strong>&#xFF0C;&#x540E;&#x9762;<strong>&#x662F;<span class="math inline">\(0\)</span>&#x6216;&#x8005;&#x66F4;&#x591A;&#x7684;&#x64CD;&#x4F5C;&#x5143;&#x8868;&#x8FBE;&#x5F0F;(<span class="math inline">\(operand\;expression\)</span>)</strong>&#x3002;<strong>&#x6240;&#x6709;&#x7684;&#x7EC4;&#x5408;&#x8868;&#x8FBE;&#x5F0F;&#x90FD;&#x662F;&#x8C03;&#x7528;&#x8868;&#x8FBE;&#x5F0F;</strong>&#x3002;</p>
<h3 id="1pair">1.<code>Pair</code></h3>
<p>&#x2003;&#x2003;<code>List</code>&#x662F;&#x5D4C;&#x5957;&#x7684;<code>Pair</code>&#xFF0C;&#x53CD;&#x4E4B;&#x5219;&#x4E0D;&#x7136;&#x3002;&#x56E0;&#x6B64;&#x6709;&#x5FC5;&#x8981;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;<code>Pair</code>&#x578B;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5728;<span class="math inline">\(scheme\)</span>&#x4E2D;&#xFF0C;<code>Pair</code>&#x7C7B;&#x662F;&#x7528;<span class="math inline">\(python\)</span>&#x8868;&#x793A;&#x7684;<span class="math inline">\(scheme\)</span>&#x503C;&#xFF0C;&#x5B83;&#x4EEC;&#x6709;<code>repr</code>&#x7684;<span class="math inline">\(python\)</span>&#x8868;&#x8FBE;&#x5F0F;&#x548C;<code>str</code>&#x7684;<span class="math inline">\(scheme\)</span>&#x8868;&#x8FBE;&#x5F0F;&#xFF1A; <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; s = Pair(1, Pair(2, nil))</span><br><span class="line">&gt;&gt;&gt; s</span><br><span class="line">Pair(1, Pair(2, nil))</span><br><span class="line">&gt;&gt;&gt; print(s)</span><br><span class="line">(1 2)</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5B83;&#x4EEC;&#x5B9E;&#x73B0;&#x4E86;&#x957F;&#x5EA6;&#x3001;&#x5143;&#x7D20;&#x9009;&#x62E9;&#x7B49;&#x57FA;&#x672C;&#x7684;<span class="math inline">\(python\)</span>&#x5E8F;&#x5217;&#x63A5;&#x53E3;&#xFF0C;&#x5176;&#x4E2D;&#x7684;<code>map</code>&#x65B9;&#x6CD5;&#x4F1A;<strong>&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x6620;&#x5C04;&#x540E;&#x7684;<span class="math inline">\(scheme\)</span>&#x5217;&#x8868;</strong>&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(s)</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[<span class="number">1</span>]</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(s.<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x+<span class="number">4</span>))</span><br><span class="line">(<span class="number">5</span> <span class="number">6</span>)</span><br></pre></td></tr></table></figure></p>
<h3 id="2&#x5D4C;&#x5957;&#x5217;&#x8868;">2.&#x5D4C;&#x5957;&#x5217;&#x8868;</h3>
<p>&#x2003;&#x2003;&#x5D4C;&#x5957;<code>Pair</code>&#x80FD;&#x591F;&#x8868;&#x8FBE;<code>List</code>&#xFF0C;&#x800C;<code>List</code>&#x81EA;&#x8EAB;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5D4C;&#x5957;&#x5F97;&#x5230;&#x65B0;&#x7684;<code>List</code>&#x3002;&#x56E0;&#x6B64;&#xFF0C;<code>Pair</code>&#x8DB3;&#x591F;&#x8868;&#x793A;&#x6240;&#x6709;&#x7684;<code>List</code>&#x578B;&#x6570;&#x636E;&#xFF0C;&#x4E5F;&#x56E0;&#x6B64;&#x8DB3;&#x591F;&#x8868;&#x793A;&#x6240;&#x6709;&#x7684;<span class="math inline">\(Scheme\)</span>&#x8868;&#x8FBE;&#x5F0F;&#xFF1A; <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; expr = Pair(&apos;+&apos;, Pair(Pair(&apos;*&apos;, Pair(3, Pair(4, nil))), Pair(5, nil)))</span><br><span class="line">&gt;&gt;&gt; print(expr)</span><br><span class="line">(+ (* 3 4) 5)</span><br><span class="line">&gt;&gt;&gt; print(expr.second.first)</span><br><span class="line">(* 3 4)</span><br><span class="line">&gt;&gt;&gt; expr.second.first.second.first</span><br><span class="line">3</span><br></pre></td></tr></table></figure>
&#x2003;&#x2003;&#x4E0A;&#x8FF0;&#x4F8B;&#x5B50;&#x8BF4;&#x660E;&#x4E86;<strong>&#x6240;&#x6709;&#x7684;&#x8BA1;&#x7B97;&#x8868;&#x8FBE;&#x5F0F;&#x90FD;&#x662F;&#x5D4C;&#x5957;&#x7684;<span class="math inline">\(Scheme\)</span><code>List</code></strong>&#x3002;&#x6211;&#x4EEC;&#x7684;&#x8BA1;&#x7B97;&#x5668;&#x89E3;&#x91CA;&#x5668;&#x5C06;&#x4F1A;<strong>&#x8BFB;&#x5165;&#x8FD9;&#x4E9B;&#x5D4C;&#x5957;&#x7684;<span class="math inline">\(Scheme\)</span><code>List</code>&#xFF0C;&#x5C06;&#x5B83;&#x4EEC;&#x8F6C;&#x5316;&#x4E3A;&#x7528;&#x5D4C;&#x5957;<code>Pair</code>&#x5B9E;&#x4F8B;&#x4EE3;&#x8868;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x6811;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;&#x8BA1;&#x7B97;&#x8868;&#x8FBE;&#x5F0F;&#x6811;&#x6765;&#x4EA7;&#x751F;&#x503C;</strong>&#x3002;</p>
<h2 id="&#x4E09;-&#x5BF9;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x8BED;&#x6CD5;&#x5206;&#x6790;">&#x4E09;&#x3001;&#x5BF9;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x8BED;&#x6CD5;&#x5206;&#x6790;</h2>
<h3 id="1&#x6982;&#x8FF0;">1.&#x6982;&#x8FF0;</h3>
<p>&#x2003;&#x2003;&#x8BED;&#x6CD5;&#x5206;&#x6790;(<span class="math inline">\(parsing\)</span>)&#x662F;<strong>&#x4ECE;&#x539F;&#x59CB;&#x6587;&#x672C;&#x8F93;&#x5165;&#x4EA7;&#x751F;&#x8868;&#x8FBE;&#x5F0F;</strong>&#x7684;&#x8FC7;&#x7A0B;&#x3002;</p>
<p>&#x2003;&#x2003;&#x8BED;&#x6CD5;&#x7FFB;&#x8BD1;&#x5668;&#x7531;&#x4E24;&#x90E8;&#x5206;&#x6784;&#x6210;&#xFF1A;<strong>&#x8BCD;&#x6CD5;&#x5206;&#x6790;&#x5668;(<span class="math inline">\(lexical\;analyzer\)</span>)</strong>
&#x548C;<strong>&#x53E5;&#x6CD5;&#x5206;&#x6790;&#x5668;(<span class="math inline">\(syntactic\;analyzer\)</span>)</strong>&#x3002;&#x9996;&#x5148;&#xFF0C;&#x8BCD;&#x6CD5;&#x5206;&#x6790;&#x5668;<strong>&#x5C06;&#x8F93;&#x5165;&#x6587;&#x672C;&#x5206;&#x6210;&#x6807;&#x8BB0;(<span class="math inline">\(tokens\)</span>)</strong>&#x3002;&#x6807;&#x8BB0;&#x662F;<strong>&#x6700;&#x5C0F;&#x7684;&#x53E5;&#x6CD5;&#x5355;&#x5143;</strong>&#xFF0C;&#x5982;<code>name</code>&#x3001;<code>symbol</code>&#x7C7B;&#x578B;&#x3002;&#x7136;&#x540E;&#xFF0C;&#x53E5;&#x6CD5;&#x5206;&#x6790;&#x5668;<strong>&#x901A;&#x8FC7;&#x6807;&#x8BB0;&#x5E8F;&#x5217;(<span class="math inline">\(tokens\;sequence\)</span>)&#x642D;&#x5EFA;&#x8868;&#x8FBE;&#x5F0F;&#x6811;</strong>&#xFF0C;&#x6D88;&#x8017;&#x6389;&#x8BCD;&#x6CD5;&#x5206;&#x6790;&#x5668;&#x4EA7;&#x751F;&#x7684;&#x6807;&#x8BB0;&#x5E8F;&#x5217;&#x3002;</p>
<h3 id="2&#x8BCD;&#x6CD5;&#x5206;&#x6790;">2.&#x8BCD;&#x6CD5;&#x5206;&#x6790;</h3>
<p>&#x2003;&#x2003;<strong>&#x5C06;&#x5B57;&#x7B26;&#x4E32;&#x89E3;&#x91CA;&#x4E3A;&#x6807;&#x8BB0;&#x5E8F;&#x5217;</strong>&#x7684;&#x90E8;&#x5206;&#x79F0;&#x4E3A;&#x6807;&#x8BB0;&#x5668;(<span class="math inline">\(tokenizer\)</span>)&#x6216;&#x8BCD;&#x6CD5;&#x5206;&#x6790;&#x5668;&#x3002;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x5B9E;&#x73B0;&#x4E2D;&#xFF0C;&#x6807;&#x8BB0;&#x5668;&#x662F;<code>tokenize_line</code>&#x51FD;&#x6570;&#x3002;</p>
<p>&#x2003;&#x2003;<span class="math inline">\(scheme\)</span>&#x7684;&#x6807;&#x8BB0;&#x95F4;&#x7531;&#x7A7A;&#x683C;&#x3001;&#x9017;&#x53F7;&#x3001;&#x70B9;&#x7B49;&#x7B26;&#x53F7;&#x76F8;&#x9694;&#x3002;<strong>&#x6807;&#x8BB0;&#x5668;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x5730;&#x5206;&#x6790;&#x53E5;&#x5B50;&#xFF0C;&#x9A8C;&#x8BC1;&#x5176;&#x4E2D;&#x7B26;&#x53F7;(<span class="math inline">\(symbol\)</span>)&#x4E0E;&#x6570;&#x5B57;(<span class="math inline">\(numeral\)</span>)&#x7684;&#x683C;&#x5F0F;</strong>&#x3002;&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E2A;&#x6807;&#x8BB0;&#x5668;&#x7684;&#x5206;&#x6790;&#x7ED3;&#x679C;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>tokenize_line(<span class="string">&apos;(+ 1 (* 2.3 45))&apos;</span>)</span><br><span class="line">[<span class="string">&apos;(&apos;</span>, <span class="string">&apos;+&apos;</span>, <span class="number">1</span>, <span class="string">&apos;(&apos;</span>, <span class="string">&apos;*&apos;</span>, <span class="number">2.3</span>, <span class="number">45</span>, <span class="string">&apos;)&apos;</span>, <span class="string">&apos;)&apos;</span>]</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8BCD;&#x6CD5;&#x5206;&#x6790;&#x662F;&#x4E00;&#x4E2A;&#x8FED;&#x4EE3;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x72EC;&#x7ACB;&#x5730;&#x7528;&#x4E8E;&#x4E00;&#x4E2A;&#x8F93;&#x5165;&#x7A0B;&#x5E8F;&#x7684;&#x6BCF;&#x4E00;&#x884C;&#x3002;</p>
<h3 id="3&#x53E5;&#x6CD5;&#x5206;&#x6790;">3.&#x53E5;&#x6CD5;&#x5206;&#x6790;</h3>
<p>&#x2003;&#x2003;&#x5C06;<strong>&#x6807;&#x8BB0;&#x5E8F;&#x5217;&#x8F6C;&#x5316;&#x4E3A;&#x8868;&#x8FBE;&#x5F0F;&#x6811;</strong>&#x7684;&#x90E8;&#x5206;&#x88AB;&#x79F0;&#x4E3A;&#x53E5;&#x6CD5;&#x5206;&#x6790;&#x5668;&#x3002;&#x53E5;&#x6CD5;&#x5206;&#x6790;&#x662F;&#x4E00;&#x4E2A;&#x6811;&#x5F62;&#x9012;&#x5F52;(<span class="math inline">\(tree-recursive\)</span>)&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x5B83;&#x4E0D;&#x4EC5;&#x8981;&#x8003;&#x8651;&#x884C;&#x5185;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x8FD8;&#x8981;&#x8003;&#x8651;&#x6269;&#x5F20;&#x5230;&#x591A;&#x4E2A;&#x884C;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x3002;</p>
<p>&#x2003;&#x2003;&#x53E5;&#x6CD5;&#x5206;&#x6790;&#x662F;&#x901A;&#x8FC7;<code>scheme_read</code>&#x51FD;&#x6570;&#x5B9E;&#x73B0;&#x7684;&#x3002;&#x5B83;&#x662F;&#x6811;&#x5F62;&#x9012;&#x5F52;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;<strong>&#x5206;&#x6790;&#x4E00;&#x4E2A;&#x6807;&#x8BB0;&#x5E8F;&#x5217;&#x7ECF;&#x5E38;&#x9700;&#x8981;&#x5C06;&#x5B83;&#x7684;&#x4E00;&#x4E9B;&#x5B50;&#x5217;&#x5206;&#x6790;&#x8FDB;&#x4E00;&#x4E2A;&#x5B50;&#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#xFF0C;&#x5B50;&#x8868;&#x8FBE;&#x5F0F;&#x672C;&#x8EAB;&#x5145;&#x5F53;&#x8F83;&#x5927;&#x8868;&#x8FBE;&#x5F0F;&#x6811;&#x7684;&#x5206;&#x652F;</strong>&#x3002;&#x9012;&#x5F52;&#x751F;&#x6210;&#x4E86;<strong>&#x8BA1;&#x7B97;&#x5668;&#x4F7F;&#x7528;&#x7684;&#x5C42;&#x6B21;&#x7ED3;&#x6784;(<span class="math inline">\(hierarchical\;structure\)</span>)</strong>&#x3002;</p>
<p>&#x2003;&#x2003;<code>scheme_read</code>&#x51FD;&#x6570;&#x5E0C;&#x671B;&#x5B83;&#x7684;<code>src</code>&#x8F93;&#x5165;&#x662F;&#x4E00;&#x4E2A;&#x5141;&#x8BB8;&#x8BBF;&#x95EE;&#x6807;&#x8BB0;&#x5E8F;&#x5217;&#x7684;<span class="math inline">\(Buffer\)</span>&#x5B9E;&#x4F8B;&#x3002;<span class="math inline">\(Buffer\)</span>&#x4F1A;<strong>&#x5C06;&#x6269;&#x5C55;&#x5230;&#x5F88;&#x591A;&#x884C;&#x7684;&#x6807;&#x8BB0;&#x6536;&#x96C6;&#x4E3A;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;&#x5BF9;&#x8C61;</strong>&#xFF0C;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x53EF;&#x4EE5;&#x88AB;&#x8FDB;&#x884C;&#x53E5;&#x6CD5;&#x5206;&#x6790;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>lines = [<span class="string">&apos;(+ 1&apos;</span>, <span class="string">&apos;   (* 2.3 45))&apos;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>expression = scheme_read(Buffer(tokenize_lines(lines)))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>expression</span><br><span class="line">Pair(<span class="string">&apos;+&apos;</span>, Pair(<span class="number">1</span>, Pair(Pair(<span class="string">&apos;*&apos;</span>, Pair(<span class="number">2.3</span>, Pair(<span class="number">45</span>, nil))), nil)))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(expression)</span><br><span class="line">(+ <span class="number">1</span> (* <span class="number">2.3</span> <span class="number">45</span>))</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;<code>scheme_read</code>&#x51FD;&#x6570;&#x5148;&#x68C0;&#x67E5;&#x4F17;&#x591A;&#x57FA;&#x7840;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5305;&#x62EC;&#x7A7A;&#x7684;&#x8F93;&#x5165;(<span class="math inline">\(empty\;input\)</span>)(&#x8FD9;&#x4F1A;&#x5BFC;&#x81F4;<span class="math inline">\(end-of-file\)</span>&#x9519;&#x8BEF;&#xFF0C;&#x5373;<code>EOFError</code>)&#x548C;&#x57FA;&#x672C;&#x8868;&#x8FBE;&#x5F0F;&#x3002;<strong>&#x53EA;&#x8981;<code>(</code>&#x6807;&#x8BB0;&#x4E86;&#x5217;&#x8868;&#x7684;&#x5F00;&#x5934;&#xFF0C;<code>read_tail</code>&#x5C31;&#x88AB;&#x9012;&#x5F52;&#x5730;&#x8C03;&#x7528;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;<code>read_tail</code>&#x51FD;&#x6570;&#x4E5F;&#x4ECE;&#x540C;&#x6837;&#x7684;<code>src</code>&#x4E2D;&#x8BFB;&#x53D6;&#xFF0C;&#x4F46;&#x5B83;&#x5E0C;&#x671B;<strong>&#x5728;<code>List</code>&#x7684;&#x5F00;&#x5934;&#x88AB;&#x8C03;&#x7528;</strong>&#x3002;&#x5B83;&#x7684;&#x57FA;&#x672C;&#x60C5;&#x51B5;(<span class="math inline">\(base\;cases\)</span>)&#x662F;&#x4E00;&#x4E2A;<strong>&#x7A7A;&#x8F93;&#x5165;(<code>EOF</code>)&#x6216;&#x8005;&#x4E00;&#x4E2A;&#x7ED3;&#x675F;&#x62EC;&#x53F7;(<code>)</code>)&#x7EC8;&#x6B62;&#x5217;&#x8868;</strong>&#x3002;&#x5B83;&#x7684;&#x9012;&#x5F52;&#x8C03;&#x7528;&#x4F1A;<strong>&#x5148;&#x4F7F;&#x7528;<code>scheme_read</code>&#x8BFB;&#x53D6;<code>List</code>&#x4E2D;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#xFF0C;&#x518D;&#x7528;<code>read_tail</code>&#x8BFB;&#x5165;<code>List</code>&#x4E2D;&#x7684;&#x5269;&#x4F59;&#x5143;&#x7D20;&#xFF0C;&#x7136;&#x540E;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x7528;<code>Pair</code>&#x8868;&#x793A;&#x7684;&#x5217;&#x8868;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x63D0;&#x4F9B;&#x4FE1;&#x606F;&#x7684;&#x53E5;&#x6CD5;&#x9519;&#x8BEF;&#x5927;&#x5927;&#x63D0;&#x9AD8;&#x4E86;&#x89E3;&#x91CA;&#x5668;&#x7684;&#x53EF;&#x7528;&#x6027;&#xFF0C;&#x5B83;&#x5F15;&#x53D1;&#x7684;<code>SyntaxError</code>&#x5F02;&#x5E38;&#x5305;&#x62EC;&#x4E86;&#x6240;&#x9047;&#x5230;&#x95EE;&#x9898;&#x7684;&#x58F0;&#x660E;&#x3002;</p>
<h2 id="&#x56DB;-&#x8BA1;&#x7B97;&#x5668;&#x7684;&#x8BA1;&#x7B97;">&#x56DB;&#x3001;&#x8BA1;&#x7B97;&#x5668;&#x7684;&#x8BA1;&#x7B97;</h2>
<h3 id="1&#x8BA1;&#x7B97;&#x5668;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x8F6C;&#x6362;">1.&#x8BA1;&#x7B97;&#x5668;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x8F6C;&#x6362;</h3>
<p>&#x2003;&#x2003;&#x5BF9;&#x4E8E;&#x8BA1;&#x7B97;&#x5668;&#xFF0C;<strong>&#x552F;&#x4E00;&#x7684;&#x4E24;&#x4E2A;&#x5408;&#x6CD5;&#x7684;&#x53E5;&#x6CD5;&#x5F62;&#x5F0F;&#x662F;&#x6570;&#x5B57;(<span class="math inline">\(numbers\)</span>)&#x548C;&#x8C03;&#x7528;&#x8868;&#x8FBE;&#x5F0F;(<span class="math inline">\(call\;expressions\)</span>)</strong>&#xFF0C;&#x5373;&#x7ECF;&#x8FC7;&#x826F;&#x597D;&#x7EC4;&#x7EC7;&#x7684;<span class="math inline">\(scheme\)</span><code>List</code>&#xFF0C;&#x5B83;&#x4EEC;&#x662F;&#x4EE5;<code>Pair</code>&#x5F62;&#x5F0F;&#x5B58;&#x5728;&#x7684;&#x3002;&#x6570;&#x5B57;&#x81EA;&#x5DF1;&#x5C31;&#x53EF;&#x4EE5;&#x8BA1;&#x7B97;&#x51FA;&#x4E00;&#x4E2A;&#x503C;&#xFF0C;&#x5B83;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x88AB;<code>calc_eval</code>&#x8FD4;&#x56DE;&#x3002;&#x800C;<strong>&#x8C03;&#x7528;&#x8868;&#x8FBE;&#x5F0F;&#x9700;&#x8981;&#x5BF9;&#x5176;&#x5E94;&#x7528;&#x51FD;&#x6570;(<span class="math inline">\(function\;application\)</span>)&#x624D;&#x53EF;&#x8FD4;&#x56DE;&#x503C;</strong>&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">calc_eval</span>(<span class="params">exp</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Evaluate a Calculator expression.&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># number type</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">type</span>(exp) <span class="keyword">in</span> (<span class="built_in">int</span>, <span class="built_in">float</span>):</span><br><span class="line">            <span class="keyword">return</span> simplify(exp)</span><br><span class="line">        <span class="comment"># list type as pair instance</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(exp, Pair):</span><br><span class="line">            arguments = exp.second.<span class="built_in">map</span>(calc_eval)</span><br><span class="line">            <span class="keyword">return</span> simplify(calc_apply(exp.first, arguments))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> TypeError(exp + <span class="string">&apos; is not a number or call expression&apos;</span>)</span><br></pre></td></tr></table></figure> &#x2003;&#x2003;&#x8FD9;&#x91CC;&#xFF0C;&#x5F53;&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;&#x4E3A;<span class="math inline">\(call\;expression\)</span>&#x65F6;&#xFF0C;<code>argument</code>&#x5BF9;<code>Pair</code>&#x9664;&#x4E86;&#x7B2C;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x5916;&#x7684;&#x6240;&#x6709;&#x5143;&#x7D20;<strong>&#x8C03;&#x7528;<code>calc_eval</code>&#x51FD;&#x6570;&#xFF0C;&#x5E76;&#x901A;&#x8FC7;<code>map</code>&#x64CD;&#x4F5C;&#x5C06;&#x7ED3;&#x679C;&#x6620;&#x5C04;&#x5230;&#x539F;&#x6765;&#x7684;<code>Pair</code>&#x4E2D;</strong>&#xFF0C;&#x6700;&#x540E;&#x5BF9;&#x53EA;&#x6709;&#x4E24;&#x4E2A;&#x5143;&#x7D20;&#x7684;<code>Pair</code>&#x8FDB;&#x884C;&#x6700;&#x540E;&#x7684;&#x5316;&#x7B80;&#x3002;</p>
<p>&#x2003;&#x2003;<code>calc_eval</code>&#x7684;&#x7ED3;&#x6784;&#x662F;&#x6839;<strong>&#x636E;&#x7C7B;&#x578B;&#x5206;&#x6D3E;&#x7684;&#x5178;&#x578B;&#x4F8B;&#x5B50;&#xFF1A;&#x6839;&#x636E;&#x8868;&#x8FBE;&#x5F0F;&#x5F62;&#x5F0F;&#x5206;&#x6D3E;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x8FD9;&#x91CC;&#x5F15;&#x5165;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x6982;&#x5FF5;&#xFF1A;&#x4E0D;&#x9700;&#x8981;&#x591A;&#x4F59;&#x8BA1;&#x7B97;&#x6B65;&#x9AA4;&#x7684;&#x539F;&#x59CB;&#x8868;&#x8FBE;&#x5F0F;&#x53EB;&#x4F5C;&#x201C;&#x81EA;&#x6211;&#x8BA1;&#x7B97;&#x5F0F;&#x201D;(<span class="math inline">\(self-evaluating\)</span>)&#xFF0C;&#x9664;&#x4E86;&#x6570;&#x5B57;&#xFF0C;&#x5B57;&#x7B26;&#x4E32;&#x3001;&#x5E03;&#x5C14;&#x503C;&#x90FD;&#x662F;&#x81EA;&#x6211;&#x8BA1;&#x7B97;&#x5F0F;&#x3002;</p>
<h3 id="2&#x8BA1;&#x7B97;&#x5668;&#x7684;&#x8BA1;&#x7B97;">2.&#x8BA1;&#x7B97;&#x5668;&#x7684;&#x8BA1;&#x7B97;</h3>
<p>&#x2003;&#x2003;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5982;&#x4E0B;&#x7A0B;&#x5E8F;&#x5B9E;&#x73B0;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x8BA1;&#x7B97;&#xFF0C;&#x5176;&#x4E2D;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x6761;&#x4EF6;&#x8BED;&#x53E5;&#x5206;&#x522B;&#x4F5C;&#x7528;&#x4E8E;&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#x7B26;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">calc_apply</span>(<span class="params">operator, args</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Apply the named operator to a list of args.&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(operator, <span class="built_in">str</span>):</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="built_in">str</span>(operator) + <span class="string">&apos; is not a symbol&apos;</span>)</span><br><span class="line">        <span class="keyword">if</span> operator == <span class="string">&apos;+&apos;</span>:</span><br><span class="line">            <span class="keyword">return</span> reduce(add, args, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">elif</span> operator == <span class="string">&apos;-&apos;</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(args) == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">raise</span> TypeError(operator + <span class="string">&apos; requires at least 1 argument&apos;</span>)</span><br><span class="line">            <span class="keyword">elif</span> <span class="built_in">len</span>(args) == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> -args.first</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> reduce(sub, args.second, args.first)</span><br><span class="line">        <span class="keyword">elif</span> operator == <span class="string">&apos;*&apos;</span>:</span><br><span class="line">            <span class="keyword">return</span> reduce(mul, args, <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">elif</span> operator == <span class="string">&apos;/&apos;</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(args) == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">raise</span> TypeError(operator + <span class="string">&apos; requires at least 1 argument&apos;</span>)</span><br><span class="line">            <span class="keyword">elif</span> <span class="built_in">len</span>(args) == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>/args.first</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> reduce(truediv, args.second, args.first)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> TypeError(operator + <span class="string">&apos; is an unknown operator&apos;</span>)</span><br></pre></td></tr></table></figure>
&#x2003;&#x2003;<code>calc_apply</code>&#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#xFF0C;&#x4F46;&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;<strong>&#x5FC5;&#x987B;&#x662F;&#x503C;&#x7684;&#x5217;&#x8868;</strong>&#x800C;&#x4E0D;&#x662F;&#x64CD;&#x4F5C;&#x6570;&#x8868;&#x8FBE;&#x5F0F;(<span class="math inline">\(a\;list\;of\;operand\;expressions\)</span>)&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>calc_apply(<span class="string">&apos;+&apos;</span>, as_scheme_list(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>))</span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>calc_apply(<span class="string">&apos;-&apos;</span>, as_scheme_list(<span class="number">10</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>))</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>calc_apply(<span class="string">&apos;*&apos;</span>, nil)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>calc_apply(<span class="string">&apos;*&apos;</span>, as_scheme_list(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>))</span><br><span class="line"><span class="number">120</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>calc_apply(<span class="string">&apos;/&apos;</span>, as_scheme_list(<span class="number">40</span>, <span class="number">5</span>))</span><br><span class="line"><span class="number">8.0</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5148;&#x524D;&#x7684;<code>calc_eval</code>&#x7684;&#x4F5C;&#x7528;&#x662F;<strong>&#x5148;&#x8BA1;&#x7B97;&#x64CD;&#x4F5C;&#x6570;&#x5B50;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x503C;&#xFF0C;&#x7136;&#x540E;&#x51B3;&#x5B9A;&#x5408;&#x9002;&#x7684;<code>calc_apply</code>&#x8C03;&#x7528;</strong>&#x3002;&#x56E0;&#x6B64;&#xFF0C;<code>calc_eval</code><strong>&#x53EF;&#x4EE5;&#x63A5;&#x53D7;&#x5D4C;&#x5957;&#x8868;&#x8FBE;&#x5F0F;</strong>&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(exp)</span><br><span class="line">(+ (* <span class="number">3</span> <span class="number">4</span>) <span class="number">5</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>calc_eval(exp)</span><br><span class="line"><span class="number">17</span></span><br></pre></td></tr></table></figure></p>
<h3 id="3&#x8BFB;&#x53D6;-&#x8BA1;&#x7B97;-&#x6253;&#x5370;&#x6D41;&#x7A0B;">3.&#x201C;&#x8BFB;&#x53D6;-&#x8BA1;&#x7B97;-&#x6253;&#x5370;&#x201D;&#x6D41;&#x7A0B;</h3>
<h4 id="a&#x89E3;&#x91CA;&#x5668;&#x7684;&#x4E00;&#x822C;&#x8303;&#x5F0F;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&#x89E3;&#x91CA;&#x5668;&#x7684;&#x4E00;&#x822C;&#x8303;&#x5F0F;</h4>
<p>&#x2003;&#x2003;&#x4E0E;&#x89E3;&#x91CA;&#x5668;&#x4EA4;&#x4E92;&#x7684;&#x4E00;&#x822C;&#x6D41;&#x7A0B;&#x662F;
<strong>&#x201C;&#x8BFB;&#x53D6;-&#x8BA1;&#x7B97;-&#x6253;&#x5370;&#x201D;&#x6D41;&#x7A0B;</strong>&#xFF0C;&#x5373;&#xFF1A;&#x5148;&#x8BFB;&#x5165;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x518D;&#x8BA1;&#x7B97;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x6700;&#x540E;&#x6253;&#x5370;&#x8BA1;&#x7B97;&#x51FA;&#x7684;&#x503C;&#x3002;</p>
<p>&#x2003;&#x2003;&#x4E0B;&#x9762;&#x5C55;&#x793A;&#x8FD9;&#x4E00;&#x6D41;&#x7A0B;&#x7684;&#x4E00;&#x822C;&#x5B9E;&#x73B0;&#x3002;<code>read_eval_print_loop</code>&#x51FD;&#x6570;&#x5148;&#x5C06;&#x7528;&#x6237;&#x7684;&#x8F93;&#x5165;<span class="math inline">\(buffer\)</span>&#x5316;&#xFF0C;&#x7136;&#x540E;&#x7528;&#x7279;&#x5B9A;&#x8BED;&#x8A00;&#x51FD;&#x6570;(<span class="math inline">\(language-specific\)</span>)&#x6784;&#x5EFA;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x6700;&#x540E;&#x6253;&#x5370;&#x901A;&#x8FC7;<code>calc_eval</code>&#x8BA1;&#x7B97;&#x51FA;&#x7684;&#x7ED3;&#x679C;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">read_eval_print_loop</span>():</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Run a read-eval-print loop for calculator.&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            src = buffer_input()</span><br><span class="line">            <span class="keyword">while</span> src.more_on_line:</span><br><span class="line">                expression = scheme_read(src)</span><br><span class="line">                <span class="built_in">print</span>(calc_eval(expression))</span><br></pre></td></tr></table></figure> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt; (* <span class="number">1</span> <span class="number">2</span> <span class="number">3</span>)</span><br><span class="line"><span class="number">6</span></span><br><span class="line">&gt; (+)</span><br><span class="line"><span class="number">0</span></span><br><span class="line">&gt; (+ <span class="number">2</span> (/ <span class="number">4</span> <span class="number">8</span>))</span><br><span class="line"><span class="number">2.5</span></span><br><span class="line">&gt; (+ <span class="number">2</span> <span class="number">2</span>) (* <span class="number">3</span> <span class="number">3</span>)</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">9</span></span><br><span class="line">&gt; (+ <span class="number">1</span></span><br><span class="line">     (- <span class="number">23</span>)</span><br><span class="line">     (* <span class="number">4</span> <span class="number">2.5</span>))</span><br><span class="line">-<span class="number">12</span></span><br></pre></td></tr></table></figure></p>
<h4 id="b&#x4F18;&#x5316;">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>&#x4F18;&#x5316;</h4>
<p>&#x2003;&#x2003;&#x4E0A;&#x8FF0;&#x4EA4;&#x4E92;&#x63A5;&#x53E3;&#x5305;&#x542B;&#x6240;&#x6709;&#x63A5;&#x53E3;&#x5FC5;&#x987B;&#x7684;&#x8981;&#x7D20;&#xFF0C;&#x4F46;&#x662F;&#x7F3A;&#x5C11;&#x7EC8;&#x6B62;&#x4E0E;&#x9519;&#x8BEF;&#x5904;&#x7406;&#x673A;&#x5236;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5C06;&#x9519;&#x8BEF;&#x62A5;&#x544A;&#x7ED9;&#x7528;&#x6237;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x4F18;&#x5316;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">read_eval_print_loop</span>():</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Run a read-eval-print loop for calculator.&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                src = buffer_input()</span><br><span class="line">                <span class="keyword">while</span> src.more_on_line:</span><br><span class="line">                    expression = scheme_read(src)</span><br><span class="line">                    <span class="built_in">print</span>(calc_eval(expression))</span><br><span class="line">            <span class="keyword">except</span> (SyntaxError, TypeError, ValueError, ZeroDivisionError) <span class="keyword">as</span> err:</span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">type</span>(err).__name__ + <span class="string">&apos;:&apos;</span>, err)</span><br><span class="line">            <span class="keyword">except</span> (KeyboardInterrupt, EOFError):  <span class="comment"># &lt;Control&gt;-D, etc.</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&apos;Calculation completed.&apos;</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br></pre></td></tr></table></figure> &#x2003;&#x2003;&#x8FD9;&#x4E00;&#x6D41;&#x7A0B;&#x5B9E;&#x73B0;&#x62A5;&#x544A;&#x7528;&#x6237;&#x7684;&#x9519;&#x8BEF;&#xFF0C;&#x4F46;&#x4E0D;&#x9000;&#x51FA;&#x6D41;&#x7A0B;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; )</span><br><span class="line">SyntaxError: unexpected token: )</span><br><span class="line">&gt; <span class="number">2.3</span><span class="number">.4</span></span><br><span class="line">ValueError: invalid numeral: <span class="number">2.3</span><span class="number">.4</span></span><br><span class="line">&gt; +</span><br><span class="line">TypeError: + <span class="keyword">is</span> <span class="keyword">not</span> a number <span class="keyword">or</span> call expression</span><br><span class="line">&gt; (/ <span class="number">5</span>)</span><br><span class="line">TypeError: / requires exactly <span class="number">2</span> arguments</span><br><span class="line">&gt; (/ <span class="number">1</span> <span class="number">0</span>)</span><br><span class="line">ZeroDivisionError: division by zero</span><br></pre></td></tr></table></figure></p>
<h2 id="&#x4E94;-&#x603B;&#x7ED3;">&#x4E94;&#x3001;&#x603B;&#x7ED3;</h2>
<p>&#x2003;&#x2003;&#x5F53;&#x6211;&#x4EEC;&#x5C06;&#x6211;&#x4EEC;&#x7684;&#x89E3;&#x91CA;&#x5668;&#x7528;&#x4E8E;&#x65B0;&#x7684;&#x8BED;&#x8A00;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x53D1;&#x73B0;<code>read_eval_print_loop</code><strong>&#x88AB;&#x89E3;&#x6790;&#x51FD;&#x6570;&#x3001;&#x8BA1;&#x7B97;&#x51FD;&#x6570;&#x3001;&#x9519;&#x8BEF;&#x8F93;&#x51FA;&#x8BED;&#x53E5;&#x53C2;&#x6570;&#x5316;</strong>&#x4E86;&#x3002;&#x9664;&#x4E86;&#x8FD9;&#x4E9B;&#x5DEE;&#x522B;&#xFF0C;&#x6240;&#x6709;&#x7684;<span class="math inline">\(REPLs\)</span>&#x90FD;&#x53EF;&#x4EE5;&#x7528;&#x76F8;&#x540C;&#x7684;&#x6846;&#x67B6;&#x5B9E;&#x73B0;&#x3002;</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/3.5.%E5%8C%85%E5%90%AB%E6%8A%BD%E8%B1%A1%E7%9A%84%E8%AF%AD%E8%A8%80%E7%9A%84%E8%A7%A3%E9%87%8A%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/3.5.%E5%8C%85%E5%90%AB%E6%8A%BD%E8%B1%A1%E7%9A%84%E8%AF%AD%E8%A8%80%E7%9A%84%E8%A7%A3%E9%87%8A%E5%99%A8/" class="post-title-link" itemprop="url">3.5.&#x5305;&#x542B;&#x62BD;&#x8C61;&#x7684;&#x8BED;&#x8A00;&#x7684;&#x89E3;&#x91CA;&#x5668;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 15:42:33" itemprop="dateModified" datetime="2024-06-02T15:42:33+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SICP-in-python/" itemprop="url" rel="index"><span itemprop="name">SICP in python</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SICP-in-python/Chapter-3-Interpreting-Computer-Programs/" itemprop="url" rel="index"><span itemprop="name">Chapter 3.Interpreting Computer Programs</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>1.6k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>6 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="35&#x5305;&#x542B;&#x62BD;&#x8C61;&#x7684;&#x8BED;&#x8A00;&#x7684;&#x89E3;&#x91CA;&#x5668;interpretersforlanguageswithabstraction"><span class="math inline">\(3.5\)</span>&#x5305;&#x542B;&#x62BD;&#x8C61;&#x7684;&#x8BED;&#x8A00;&#x7684;&#x89E3;&#x91CA;&#x5668;(<span class="math inline">\(Interpreters\;for\;Languages\;with\;Abstraction\)</span>)</h1>
<p>&#x2003;&#x2003;&#x5148;&#x524D;<code>Calcualtor</code>&#x7684;&#x5B9E;&#x73B0;&#x5E76;&#x672A;&#x7ED9;&#x51FA;&#x5B9A;&#x4E49;&#x65B0;&#x64CD;&#x4F5C;&#x3001;&#x7ED9;&#x53D8;&#x91CF;&#x547D;&#x540D;&#x3001;&#x8868;&#x8FBE;&#x8BA1;&#x7B97;&#x7684;&#x4E00;&#x822C;&#x65B9;&#x6CD5;&#x7B49;&#x7684;&#x5B9E;&#x73B0;&#x3002;&#x4E0B;&#x9762;&#x7ED9;&#x51FA;&#x63CF;&#x8FF0;&#x6027;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;&#xFF1A;</p>
<h3 id="1&#x7ED3;&#x6784;">1.&#x7ED3;&#x6784;</h3>
<p>&#x2003;&#x2003;&#x4E00;&#x4E2A;<span class="math inline">\(scheme\)</span>&#x89E3;&#x91CA;&#x5668;&#x548C;&#x5148;&#x524D;&#x7684;&#x8BA1;&#x7B97;&#x5668;&#x89E3;&#x91CA;&#x5668;&#x6709;&#x5F88;&#x591A;&#x76F8;&#x4F3C;&#x7684;&#x7ED3;&#x6784;&#xFF1A;</p>
<ul>
<li><strong>&#x5206;&#x6790;&#x5668;</strong>&#x901A;&#x8FC7;&#x8BA1;&#x7B97;&#x5668;&#x89E3;&#x91CA;(<span class="math inline">\(evaluator\;interpretation\)</span>)&#x6765;<strong>&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x8868;&#x8FBE;&#x5F0F;</strong>&#x3002;</li>
<li><strong>&#x8BA1;&#x7B97;&#x51FD;&#x6570;&#x4FA6;&#x6D4B;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x5F62;&#x5F0F;</strong>&#xFF1B;&#x5BF9;&#x4E8E;<strong>&#x8C03;&#x7528;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x5B83;&#x4F1A;&#x8C03;&#x7528;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x7528;&#x4E8E;&#x5904;&#x7406;&#x67D0;&#x4E9B;&#x53C2;&#x6570;</strong>&#x3002;</li>
</ul>
<p>&#x2003;&#x2003;&#x4E24;&#x8005;&#x7684;&#x8BA1;&#x7B97;&#x5668;(<span class="math inline">\(evaluator\)</span>)&#x7684;&#x533A;&#x522B;&#x5B58;&#x5728;&#x4E8E;&#x7279;&#x6B8A;&#x7684;&#x5F62;&#x5F0F;(<span class="math inline">\(special\;form\)</span>)&#xFF0C;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x51FD;&#x6570;(<span class="math inline">\(user-defined\;function\)</span>)&#x548C;&#x5B9E;&#x73B0;&#x8BA1;&#x7B97;&#x6240;&#x9700;&#x7684;&#x73AF;&#x5883;&#x6A21;&#x578B;(<span class="math inline">\(the\;environment\;model\;of\;computation\)</span>)&#x3002;</p>
<h4 id="a&#x89E3;&#x6790;parsing">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&#x89E3;&#x6790;(<span class="math inline">\(Parsing\)</span>)</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; read_line(&quot;(car &apos;(1 . 2))&quot;)</span><br><span class="line">Pair(&apos;car&apos;, Pair(Pair(&apos;quote&apos;, Pair(Pair(1, 2), nil)), nil))</span><br></pre></td></tr></table></figure>
<h4 id="b&#x8BA1;&#x7B97;evaluation">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>&#x8BA1;&#x7B97;(<span class="math inline">\(evaluation\)</span>)</h4>
<p>&#x2003;&#x2003;<span class="math inline">\(Scheme\)</span>&#x6BCF;&#x6B21;&#x8BA1;&#x7B97;&#x4E00;&#x4E2A;&#x8868;&#x8FBE;&#x5F0F;&#x3002;&#x6BCF;&#x4E2A;<strong>&#x901A;&#x8FC7;<code>scheme_read</code>&#x8FD4;&#x56DE;&#x7684;&#x8868;&#x8FBE;&#x5F0F;</strong>&#x90FD;<strong>&#x4F20;&#x9012;&#x7ED9;<code>scheme_eval</code>&#x51FD;&#x6570;</strong>&#xFF0C;&#x5B83;&#x4F1A;&#x5728;&#x5F53;&#x524D;&#x73AF;&#x5883;<code>env</code>&#x4E2D;&#x8BA1;&#x7B97;&#x8868;&#x8FBE;&#x5F0F;<code>expr</code>&#x3002;</p>
<p>&#x2003;&#x2003;<code>scheme_eval</code>&#x51FD;&#x6570;&#x4F1A;&#x8BA1;&#x7B97;<span class="math inline">\(Scheme\)</span>&#x4E2D;&#x7684;&#x4E0D;&#x540C;&#x8868;&#x8FBE;&#x5F0F;&#x7C7B;&#x578B;&#xFF1A;&#x521D;&#x59CB;&#x578B;(<span class="math inline">\(primitive\)</span>)&#xFF0C;&#x7279;&#x6B8A;&#x578B;(<span class="math inline">\(special\;form\)</span>)&#x548C;&#x8C03;&#x7528;&#x8868;&#x8FBE;&#x5F0F;(<span class="math inline">\(call\;expression\)</span>)&#x3002;&#x6BCF;&#x79CD;&#x5F62;&#x5F0F;&#x90FD;&#x6709;&#x5B83;&#x4EEC;&#x5BF9;&#x5E94;&#x7684;&#x8BA1;&#x7B97;&#x6CD5;&#x5219;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">scheme_eval</span>(<span class="params">expr, env</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Evaluate Scheme expression expr in environment env.&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> scheme_symbolp(expr):</span><br><span class="line">            <span class="keyword">return</span> env[expr]</span><br><span class="line">        <span class="keyword">elif</span> scheme_atomp(expr):</span><br><span class="line">            <span class="keyword">return</span> expr</span><br><span class="line">        first, rest = expr.first, expr.second</span><br><span class="line">        <span class="keyword">if</span> first == <span class="string">&quot;lambda&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> do_lambda_form(rest, env)</span><br><span class="line">        <span class="keyword">elif</span> first == <span class="string">&quot;define&quot;</span>:</span><br><span class="line">            do_define_form(rest, env)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            procedure = scheme_eval(first, env)</span><br><span class="line">            args = rest.<span class="built_in">map</span>(<span class="keyword">lambda</span> operand: scheme_eval(operand, env))</span><br><span class="line">            <span class="keyword">return</span> scheme_apply(procedure, args, env)</span><br></pre></td></tr></table></figure></p>
<h4 id="c&#x8FC7;&#x7A0B;&#x8C03;&#x7528;procedureapplication">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>&#x8FC7;&#x7A0B;&#x8C03;&#x7528;(<span class="math inline">\(Procedure\;application\)</span>)</h4>
<p>&#x2003;&#x2003;&#x8FC7;&#x7A0B;&#x8C03;&#x7528;&#x901A;&#x8FC7;<code>scheme_apply</code>&#x5B9E;&#x73B0;&#x3002;&#x5B83;&#x6BD4;&#x8D77;&#x5148;&#x524D;&#x7684;<code>calc_apply</code>&#x66F4;&#x5177;&#x666E;&#x904D;&#x6027;&#x3002;&#x5B83;&#x63A5;&#x53D7;&#x4E24;&#x7C7B;&#x53C2;&#x6570;&#xFF1A;<code>PrimitiveProcedure</code>&#x6216;<code>LambdaProcedure</code>&#x3002;</p>
<p>&#x2003;&#x2003;<code>PrimitiveProcedure</code>&#x662F;&#x5728;<span class="math inline">\(python\)</span>&#x4E2D;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x5B83;&#x6709;&#x4E00;&#x4E2A;<code>fn</code>&#x7684;&#x5B9E;&#x4F8B;&#x5C5E;&#x6027;(<span class="math inline">\(instance\;attribute\)</span>)&#xFF0C;<strong>&#x6BCF;&#x5F53;&#x8FC7;&#x7A0B;&#x88AB;&#x8C03;&#x7528;&#xFF0C;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x5C31;&#x88AB;&#x8C03;&#x7528;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;<code>LambdaProcedure</code>&#x662F;&#x5728;<span class="math inline">\(scheme\)</span>&#x4E2D;&#x5B9E;&#x73B0;&#x7684;&#x3002;&#x5B83;&#x6709;&#x4E00;&#x4E2A;<code>body</code>&#x5C5E;&#x6027;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;<span class="math inline">\(scheme\)</span>&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;<strong>&#x6BCF;&#x5F53;&#x8FC7;&#x7A0B;&#x88AB;&#x8C03;&#x7528;&#x5B83;&#x5C31;&#x88AB;&#x8C03;&#x7528;</strong>&#x3002;&#x4E3A;&#x4E86;&#x5C06;&#x8BE5;&#x8FC7;&#x7A0B;&#x7528;&#x4E8E;&#x4E00;&#x7CFB;&#x5217;&#x53C2;&#x6570;&#xFF0C;<code>body</code>&#x8868;&#x8FBE;&#x5F0F;<strong>&#x4F1A;&#x5728;&#x4E00;&#x4E2A;&#x65B0;&#x73AF;&#x5883;&#x91CC;&#x88AB;&#x8C03;&#x7528;</strong>&#x3002;&#x4E3A;&#x4E86;&#x642D;&#x5EFA;&#x73AF;&#x5883;&#xFF0C;<strong>&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x6846;&#x67B6;&#x88AB;&#x52A0;&#x5165;&#x8FDB;&#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x5728;&#x8FD9;&#x4E2A;&#x6846;&#x67B6;&#x4E2D;&#xFF0C;&#x8FC7;&#x7A0B;&#x7684;&#x5F62;&#x5F0F;&#x53C2;&#x6570;(<span class="math inline">\(formal\;parameters\)</span>)&#x4E0E;&#x53D8;&#x91CF;(<span class="math inline">\(argument\)</span>)&#x7ED1;&#x5B9A;</strong>&#x3002;<code>body</code><strong>&#x901A;&#x8FC7;<code>scheme_eval</code>&#x8BA1;&#x7B97;</strong>&#x3002;</p>
<h4 id="d&#x9012;&#x5F52;&#x8C03;&#x7528;&#x4E0E;&#x8BA1;&#x7B97;evalapplyrecursion">&#x2003;&#x2003;<span class="math inline">\(d.\)</span>&#x9012;&#x5F52;&#x8C03;&#x7528;&#x4E0E;&#x8BA1;&#x7B97;(<span class="math inline">\(Eval/apply\;recursion\)</span>)</h4>
<p>&#x2003;&#x2003;&#x5B9E;&#x73B0;&#x8BA1;&#x7B97;&#x8FC7;&#x7A0B;&#x7684;<code>scheme_eval</code>&#x548C;<code>scheme_apply</code>&#x662F;<strong>&#x76F8;&#x4E92;&#x9012;&#x5F52;</strong>&#x7684;(<span class="math inline">\(mutually\;recursive\)</span>)&#x3002;<strong>&#x6BCF;&#x5F53;&#x4E00;&#x4E2A;&#x8C03;&#x7528;&#x8868;&#x8FBE;&#x5F0F;&#x88AB;&#x8BA1;&#x7B97;&#xFF0C;&#x8BA1;&#x7B97;&#x51FD;&#x6570;&#x90FD;&#x9700;&#x8981;&#x88AB;&#x8C03;&#x7528;</strong>&#x3002;&#x800C;<strong>&#x5E94;&#x7528;&#x51FD;&#x6570;&#x4F7F;&#x7528;&#x8BA1;&#x7B97;&#x51FD;&#x6570;&#x5C06;&#x64CD;&#x4F5C;&#x5143;&#x8868;&#x8FBE;&#x5F0F;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#xFF0C;&#x5E76;&#x8BA1;&#x7B97;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x7684;&#x8FC7;&#x7A0B;&#x8FD9;&#x4E00;&#x90E8;&#x5206;(<span class="math inline">\(user-defined\;procedures\)</span>)</strong>&#x3002;&#x8FD9;&#x4E00;&#x76F8;&#x4E92;&#x9012;&#x5F52;&#x7684;&#x8FC7;&#x7A0B;&#x662F;&#x7531;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x51B3;&#x5B9A;&#x7684;&#xFF1A;&#x8BA1;&#x7B97;&#x51FD;&#x6570;&#x662F;&#x901A;&#x8FC7;(<span class="math inline">\(in\;terms\;of\)</span>)&#x5E94;&#x7528;&#x51FD;&#x6570;&#x5B9A;&#x4E49;&#x7684;&#xFF0C;&#x800C;&#x5E94;&#x7528;&#x51FD;&#x6570;&#x53C8;&#x662F;&#x901A;&#x8FC7;&#x8BA1;&#x7B97;&#x51FD;&#x6570;&#x5B9A;&#x4E49;&#x7684;&#x3002;</p>
<p>&#x2003;&#x2003;&#x9012;&#x5F52;&#x7684;&#x5FAA;&#x73AF;<strong>&#x4EE5;&#x8BED;&#x8A00;&#x539F;&#x8BED;(<span class="math inline">\(language\;primitive\)</span>)&#x7ED3;&#x675F;</strong>&#x3002;&#x8BA1;&#x7B97;&#x51FD;&#x6570;<strong>&#x6709;&#x4E00;&#x4E2A;&#x7528;&#x4E8E;&#x8BA1;&#x7B97;&#x57FA;&#x672C;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x57FA;&#x672C;&#x60C5;&#x51B5;</strong>&#x3002;&#x4E00;&#x4E9B;&#x7279;&#x6B8A;&#x5F62;&#x5F0F;(<span class="math inline">\(special\;form\)</span>)&#x4E5F;&#x662F;&#x4E0D;&#x9700;&#x8981;&#x9012;&#x5F52;&#x8C03;&#x7528;&#x7684;&#x57FA;&#x672C;&#x60C5;&#x51B5;&#x3002;</p>
<p>&#x2003;&#x2003;&#x8FD9;&#x79CD;<strong>&#x5904;&#x7406;&#x8868;&#x8FBE;&#x5F0F;&#x5F62;&#x5F0F;(<span class="math inline">\(expression\;form\)</span>)</strong> &#x7684;<span class="math inline">\(eval\)</span>&#x51FD;&#x6570;&#x4E0E;<strong>&#x5904;&#x7406;&#x51FD;&#x6570;&#x53CA;&#x5176;&#x53C2;&#x6570;</strong>&#x7684;<span class="math inline">\(apply\)</span>&#x51FD;&#x6570;&#x76F8;&#x4E92;&#x9012;&#x5F52;&#x8C03;&#x7528;&#x7684;&#x7ED3;&#x6784;&#x7EC4;&#x6210;&#x4E86;&#x8BA1;&#x7B97;&#x8FC7;&#x7A0B;&#x7684;&#x6838;&#x5FC3;&#x3002;</p>
<h3 id="2&#x73AF;&#x5883;">2.&#x73AF;&#x5883;</h3>
<h4 id="a&#x57FA;&#x672C;&#x7ED3;&#x6784;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&#x57FA;&#x672C;&#x7ED3;&#x6784;</h4>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;<code>Frame</code>&#x7C7B;&#x6765;&#x6784;&#x5EFA;&#x73AF;&#x5883;&#x3002;<strong>&#x6BCF;&#x4E2A;<code>Frame</code>&#x7684;&#x5B9E;&#x4F8B;&#x90FD;&#x4EE3;&#x8868;&#x4E00;&#x4E2A;&#x73AF;&#x5883;</strong>&#xFF0C;&#x5728;&#x8FD9;&#x4E2A;&#x5B9E;&#x4F8B;&#x4E2D;&#xFF0C;<strong>&#x6807;&#x8BB0;(<span class="math inline">\(symbol\)</span>)&#x4E0E;&#x503C;(<span class="math inline">\(value\)</span>)&#x76F8;&#x7ED1;&#x5B9A;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;<code>Frame</code>&#x5B9E;&#x4F8B;&#x7531;<strong>&#x4E00;&#x4E2A;<code>binding</code>&#x5B57;&#x5178;&#x548C;<code>parant</code>&#x6846;&#x67B6;</strong>&#x6784;&#x6210;&#x3002;&#x5BF9;&#x4E8E;<span class="math inline">\(Global\)</span>&#x6846;&#x67B6;&#xFF0C;<code>parent=None</code>&#x3002;</p>
<h4 id="bbinding&#x548C;define">&#x2003;&#x2003;<span class="math inline">\(b.\)</span><code>binding</code>&#x548C;<code>define</code></h4>
<p>&#x2003;&#x2003;<code>binding</code>&#x5E76;&#x4E0D;&#x662F;&#x76F4;&#x63A5;&#x8BBF;&#x95EE;&#x7684;&#xFF0C;&#x5B83;&#x901A;&#x8FC7;&#x4E24;&#x4E2A;<code>Frame</code>&#x65B9;&#x6CD5;&#x8BBF;&#x95EE;&#xFF1A;<code>lookup</code>&#x548C;<code>define</code>&#x3002;<code>lookup</code>&#x8FC7;&#x7A0B;&#x4F1A;&#x5728;<strong>&#x6211;&#x4EEC;&#x7684;&#x73AF;&#x5883;&#x6A21;&#x578B;&#x4E2D;&#x6267;&#x884C;<span class="math inline">\(lookup\)</span>&#x8FC7;&#x7A0B;</strong>&#x3002;&#x7136;&#x540E;<strong>&#x7B26;&#x53F7;&#x4E0E;&#x5F53;&#x524D;<code>frame</code>&#x7684;<code>binding</code>&#x76F8;&#x5339;&#x914D;</strong>&#x3002;&#x5982;&#x679C;&#x5B83;<strong>&#x627E;&#x5230;&#x4E86;&#xFF0C;&#x5B83;&#x76F8;&#x5173;&#x8054;&#x7684;&#x503C;&#x5C31;&#x88AB;&#x8FD4;&#x56DE;</strong>&#xFF1B;&#x5426;&#x5219;&#xFF0C;<code>lookup</code>&#x8FC7;&#x7A0B;&#x4F1A;<strong>&#x5728;<code>parent frame</code>&#x7EE7;&#x7EED;&#x8BE5;&#x8FC7;&#x7A0B;</strong>&#x3002;&#x800C;<code>define</code>&#x65B9;&#x6CD5;<strong>&#x5728;&#x5F53;&#x524D;<code>frame</code>&#x4E2D;&#x5C06;&#x6807;&#x8BB0;&#x4E0E;&#x503C;&#x76F8;&#x7ED1;&#x5B9A;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x8003;&#x8651;&#x4E0B;&#x9762;&#x7684;&#x7A0B;&#x5E8F;&#xFF1A; <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(define (factorial n)</span><br><span class="line">  (if (= n 0) 1 (* n (factorial (- n 1)))))</span><br></pre></td></tr></table></figure> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(factorial 5)</span><br><span class="line">120</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5B9A;&#x4E49;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x6709;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ol type="1">
<li><strong>&#x68C0;&#x67E5;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x683C;&#x5F0F;(<span class="math inline">\(format\)</span>)</strong>&#xFF0C;&#x786E;&#x4FDD;<strong>&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x5B8C;&#x5907;&#x7684;<span class="math inline">\(Scheme\)</span>&#x5217;&#x8868;&#xFF0C;&#x81F3;&#x5C11;&#x6709;&#x4E24;&#x4E2A;&#x5143;&#x7D20;&#x4E0E;&#x5173;&#x952E;&#x5B57;<span class="math inline">\(define\)</span></strong>&#x3002;</li>
<li><strong>&#x5206;&#x6790;&#x7B2C;&#x4E00;&#x4E2A;&#x5143;&#x7D20;</strong>&#x3002;&#x5728;&#x672C;&#x4F8B;&#x4E2D;&#xFF0C;&#x5BFB;&#x627E;&#x51FD;&#x6570;&#x540D;&#x79F0;<span class="math inline">\(factorial\)</span>&#x548C;&#x5F62;&#x5F0F;&#x53C2;&#x6570;<span class="math inline">\(list(n)\)</span>&#x3002;</li>
<li><strong>&#x7528;&#x63D0;&#x4F9B;&#x7684;&#x5F62;&#x5F0F;&#x53C2;&#x6570;&#x521B;&#x9020;&#x4E00;&#x4E2A;<code>LambdaProcedure</code>&#xFF0C;<code>body</code>&#x548C;<code>parent</code>&#x73AF;&#x5883;</strong>&#x3002;</li>
<li><strong>&#x5728;&#x5F53;&#x524D;&#x73AF;&#x5883;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;<code>frame</code>&#x4E2D;&#xFF0C;&#x5C06;<span class="math inline">\(factorial\)</span>&#x6807;&#x5FD7;&#x4E0E;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x7ED1;&#x5B9A;</strong>&#x3002;</li>
</ol>
<p>&#x2003;&#x2003;&#x7B2C;&#x4E8C;&#x4E2A;&#x8F93;&#x5165;&#x662F;&#x4E00;&#x4E2A;&#x8C03;&#x7528;&#x8868;&#x8FBE;&#x5F0F;&#x3002;&#x4F20;&#x7ED9;<code>scheme_apply</code>&#x7684;&#x8FC7;&#x7A0B;&#x662F;&#x4E0E;<span class="math inline">\(factorial\)</span>&#x76F8;&#x7ED1;&#x5B9A;&#x7684;<code>LambdaProcedure</code>&#x3002;<strong>&#x4E3A;&#x4E86;&#x5E94;&#x7528;&#x8FD9;&#x4E00;&#x8FC7;&#x7A0B;&#xFF0C;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x6846;&#x67B6;&#x521B;&#x5EFA;&#x4E86;&#xFF0C;&#x6269;&#x5C55;&#x4E86;&#x539F;&#x6765;&#x7684;&#x7236;&#x6846;&#x67B6;</strong>&#x3002;&#x5728;&#x8FD9;&#x4E2A;&#x6846;&#x67B6;&#x4E2D;&#xFF0C;&#x6807;&#x5FD7;<span class="math inline">\(n\)</span>&#x4E0E;&#x503C;<span class="math inline">\(5\)</span>&#x7ED1;&#x5B9A;&#x3002;&#x7136;&#x540E;&#xFF0C;<span class="math inline">\(factorial\)</span>&#x7684;<code>body</code>&#x90E8;&#x5206;&#x5728;&#x8FD9;&#x4E2A;&#x73AF;&#x5883;&#x4E2D;&#x88AB;&#x8BA1;&#x7B97;&#xFF0C;&#x5B83;&#x7684;&#x503C;&#x4E5F;&#x88AB;&#x8FD4;&#x56DE;&#x3002;</p>
<h3 id="3&#x4F5C;&#x4E3A;&#x7A0B;&#x5E8F;&#x7684;&#x6570;&#x636E;">3.&#x4F5C;&#x4E3A;&#x7A0B;&#x5E8F;&#x7684;&#x6570;&#x636E;</h3>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4ECE;&#x6A21;&#x62DF;(<span class="math inline">\(analogy\)</span>)&#x7684;&#x89D2;&#x5EA6;&#x6765;&#x770B;&#x5F85;&#x7A0B;&#x5E8F;&#x3002;&#x5BF9;&#x7A0B;&#x5E8F;&#x542B;&#x4E49;&#x7684;&#x64CD;&#x4F5C;&#x89C2;&#x70B9;(<span class="math inline">\(optional\;view\)</span>)&#x8BA4;&#x4E3A;&#xFF1A;<strong>&#x7A0B;&#x5E8F;&#x662F;&#x5BF9;&#x4E00;&#x4E2A;&#x62BD;&#x8C61;&#x673A;&#x5668;&#x7684;&#x63CF;&#x8FF0;</strong>&#x3002;&#x4EE5;&#x5148;&#x524D;&#x7684;&#x51FD;&#x6570;&#x4E3A;&#x4F8B;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(define (factorial n)</span><br><span class="line">  (if (= n 0) 1 (* n (factorial (- n 1)))))</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C06;&#x8FD9;&#x4E2A;&#x7A0B;&#x5E8F;&#x770B;&#x4F5C;&#x5BF9;&#x4E00;&#x4E2A;&#x673A;&#x5668;&#x7684;&#x63CF;&#x8FF0;&#xFF0C;&#x8FD9;&#x4E2A;&#x673A;&#x5668;&#x5305;&#x62EC;&#x51CF;&#x6CD5;&#x3001;&#x4E58;&#x6CD5;&#x3001;&#x76F8;&#x7B49;&#x6027;&#x6D4B;&#x8BD5;&#x3001;&#x53CC;&#x5411;&#x5F00;&#x5173;&#x548C;&#x53E6;&#x4E00;&#x4E2A;<span class="math inline">\(factorial\)</span>&#x673A;&#x5668;(&#x7531;&#x4E8E;&#x4E00;&#x4E2A;&#x673A;&#x5668;&#x5185;&#x90E8;&#x53EF;&#x4EE5;&#x5D4C;&#x5957;&#x53E6;&#x4E00;&#x4E2A;&#x673A;&#x5668;&#xFF0C;&#x8FD9;&#x4E2A;&#x673A;&#x5668;&#x662F;<strong>&#x65E0;&#x9650;&#x7684;</strong>)&#xFF1A;</p>
<p><img src="/2024/05/31/3.5.%E5%8C%85%E5%90%AB%E6%8A%BD%E8%B1%A1%E7%9A%84%E8%AF%AD%E8%A8%80%E7%9A%84%E8%A7%A3%E9%87%8A%E5%99%A8/image-3.png"></p>
<p>&#x2003;&#x2003;&#x76F8;&#x4F3C;&#x5730;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C06;<span class="math inline">\(Scheme\)</span>&#x89E3;&#x91CA;&#x5668;&#x89C6;&#x4E3A;&#x4E00;&#x4E2A;&#x7279;&#x522B;&#x7684;&#x673A;&#x5668;&#xFF0C;<strong>&#x5B83;&#x5C06;&#x4E00;&#x4E2A;&#x5BF9;&#x673A;&#x5668;&#x7684;&#x63CF;&#x8FF0;&#x4F5C;&#x4E3A;&#x8F93;&#x5165;&#x3002;&#x5BF9;&#x4E8E;&#x8FD9;&#x4E2A;&#x8F93;&#x5165;&#xFF0C;&#x89E3;&#x91CA;&#x5668;&#x914D;&#x7F6E;&#x597D;&#x81EA;&#x5DF1;&#x6765;&#x6A21;&#x62DF;&#x8FD9;&#x4E2A;&#x63CF;&#x8FF0;&#x7684;&#x673A;&#x5668;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x4ECE;&#x8FD9;&#x4E2A;&#x89D2;&#x5EA6;&#xFF0C;&#x6211;&#x4EEC;&#x7684;<span class="math inline">\(Scheme\)</span>&#x89E3;&#x91CA;&#x5668;&#x662F;&#x4E00;&#x79CD;&#x5177;&#x6709;&#x666E;&#x904D;&#x6027;&#x7684;&#x673A;&#x5668;&#x3002;<strong>&#x5F53;&#x5176;&#x5B83;&#x673A;&#x5668;&#x5728;<span class="math inline">\(Scheme\)</span>&#x7A0B;&#x5E8F;&#x4E2D;&#x88AB;&#x63CF;&#x8FF0;&#x65F6;&#xFF0C;&#x89E3;&#x91CA;&#x5668;&#x4F1A;&#x6A21;&#x62DF;&#x8FD9;&#x4E9B;&#x673A;&#x5668;&#x3002;&#x5B83;&#x626E;&#x6F14;&#x7740;&#x88AB;&#x7F16;&#x7A0B;&#x8BED;&#x8A00;&#x64CD;&#x7EB5;&#x7684;&#x6570;&#x636E;&#x5BF9;&#x8C61;&#x548C;&#x7F16;&#x7A0B;&#x8BED;&#x8A00;&#x672C;&#x8EAB;&#x4E4B;&#x95F4;&#x7684;&#x6865;&#x6881;</strong>&#x3002;&#x5BF9;&#x4E8E;&#x7528;&#x6237;&#x7684;&#x8F93;&#x5165;&#xFF0C;&#x89E3;&#x91CA;&#x5668;&#x5C06;&#x5176;&#x89C6;&#x4E3A;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x53E5;&#x5B50;&#xFF0C;&#x5E76;&#x901A;&#x8FC7;&#x4E00;&#x7CFB;&#x5217;&#x5B8C;&#x5907;&#x89C4;&#x5219;&#x64CD;&#x4F5C;&#x5B83;&#x4EEC;&#x3002;</p>
<p>&#x2003;&#x2003;&#x8BA1;&#x7B97;&#x4F5C;&#x4E3A;&#x6267;&#x884C;&#x8FC7;&#x7A0B;&#x4E00;&#x90E8;&#x5206;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x662F;&#x4E00;&#x4E2A;&#x6709;&#x6D3B;&#x529B;&#x7684;&#x7F16;&#x7A0B;&#x8BED;&#x8A00;&#x6240;&#x5177;&#x7684;&#x7279;&#x70B9;&#x3002;&#x5728;&#x7A0B;&#x5E8F;&#x7684;&#x6267;&#x884C;&#x8FC7;&#x7A0B;&#x4E2D;&#x521B;&#x5EFA;&#x5E76;&#x8BA1;&#x7B97;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x80FD;&#x529B;&#x662F;&#x4E00;&#x4E2A;&#x6709;&#x529B;&#x7684;&#x5DE5;&#x5177;&#x3002;</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/4.1.interface/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/4.1.interface/" class="post-title-link" itemprop="url">4.1.&#x63A5;&#x53E3;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 17:20:00" itemprop="dateModified" datetime="2024-06-02T17:20:00+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/4-inheritance-inplements/" itemprop="url" rel="index"><span itemprop="name">4.inheritance &amp; inplements</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>984</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>4 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="41&#x63A5;&#x53E3;"><span class="math inline">\(4.1\)</span>&#x63A5;&#x53E3;</h1>
<h3 id="1&#x4E0A;&#x4F4D;&#x8BCD;-&#x4E0B;&#x4F4D;&#x8BCD;">1.&#x4E0A;&#x4F4D;&#x8BCD;&#x3001;&#x4E0B;&#x4F4D;&#x8BCD;</h3>
<p>&#x2003;&#x2003;&#x5728;&#x65E5;&#x5E38;&#x8BED;&#x8A00;&#x4E2D;&#xFF0C;&#x8BCD;&#x8BED;&#x3001;&#x5BF9;&#x8C61;&#x4E4B;&#x95F4;&#x5177;&#x6709;&#x903B;&#x8F91;&#x4E0A;&#x7684;&#x5C42;&#x6B21;&#x6027;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;&#x72D7;(<span class="math inline">\(dog\)</span>)&#x662F;&#x8D35;&#x5BBE;&#x72AC;&#x3001;&#x54C8;&#x58EB;&#x5947;&#x7B49;&#x7684;&#x4E0A;&#x4F4D;&#x8BCD;(<span class="math inline">\(hypernym\)</span>)&#xFF0C;&#x800C;&#x8D35;&#x5BBE;&#x72AC;&#x3001;&#x54C8;&#x58EB;&#x5947;&#x7B49;&#x662F;&#x72D7;&#x7684;&#x4E0B;&#x4F4D;&#x8BCD;(<span class="math inline">\(hyponyms\)</span>)&#x3002;</p>
<p>&#x2003;&#x2003;&#x4E0A;&#x4F4D;&#x8BCD;&#x4E0E;&#x4E0B;&#x4F4D;&#x8BCD;&#x63CF;&#x8FF0;&#x7684;&#x662F;&#x4E00;&#x79CD;<span class="math inline">\(is-a\)</span>&#x7684;&#x5C42;&#x6B21;&#x5173;&#x7CFB;&#xFF1A;</p>
<ul>
<li>&#x8D35;&#x5BBE;&#x72AC;<span class="math inline">\(is-a\)</span>&#x72D7;</li>
<li>&#x72D7;<span class="math inline">\(is-a\)</span>&#x52A8;&#x7269;</li>
</ul>
<p><img src="/2024/05/31/4.1.interface/image.png"></p>
<p>&#x2003;&#x2003;&#x540C;&#x6837;&#x5730;&#xFF0C;&#x6211;&#x4EEC;&#x524D;&#x9762;&#x8BB2;&#x89E3;&#x7684;<span class="math inline">\(SLList\)</span>&#x4E0E;<span class="math inline">\(AList\)</span>&#x4E5F;&#x662F;&#x94FE;&#x8868;&#x7684;&#x4E0B;&#x4F4D;&#x8BCD;&#x3002;&#x5728;<span class="math inline">\(Java\)</span>&#x4E2D;&#xFF0C;<span class="math inline">\(SLList\)</span>&#x662F;<span class="math inline">\(List61B\)</span>&#x7684;&#x5B50;&#x7C7B;(<span class="math inline">\(subclass\)</span>)&#xFF0C;<span class="math inline">\(List61B\)</span>&#x662F;<span class="math inline">\(SLList\)</span>&#x7684;&#x4E3B;&#x7C7B;(<span class="math inline">\(superclass\)</span>)&#x3002;</p>
<p><img src="/2024/05/31/4.1.interface/image-1.png"></p>
<h3 id="2&#x63A5;&#x53E3;">2.&#x63A5;&#x53E3;</h3>
<p>&#x2003;&#x2003;&#x5728;<span class="math inline">\(Java\)</span>&#x4E2D;&#xFF0C;&#x4E3A;&#x4E86;&#x8868;&#x8FBE;&#x4E0A;&#x8FF0;&#x7684;&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x8FDB;&#x884C;&#x4EE5;&#x4E0B;&#x64CD;&#x4F5C;&#xFF1A;</p>
<ul>
<li>&#x4E3A;&#x901A;&#x7528;&#x5217;&#x8868;(<span class="math inline">\(hypernym\)</span>)&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x7C7B;&#x578B;&#x2014;&#x2014;&#x6211;&#x4EEC;&#x5C06;&#x9009;&#x62E9;&#x540D;&#x79F0;<span class="math inline">\(List61B\)</span>&#x3002;</li>
<li>&#x6307;&#x5B9A;<span class="math inline">\(SLList\)</span>&#x4E0E;<span class="math inline">\(ALList\)</span>&#x662F;<span class="math inline">\(List61B\)</span>&#x7684;&#x4E0B;&#x4F4D;&#x8BCD;&#x3002;</li>
</ul>
<p>&#x2003;&#x2003;&#x8FD9;&#x91CC;&#x7684;<span class="math inline">\(List61B\)</span>&#x88AB;&#x79F0;&#x4E3A;&#x63A5;&#x53E3;(<span class="math inline">\(interface\)</span>)&#x3002;&#x5B83;&#x672C;&#x8D28;&#x4E0A;&#x662F;&#x4E00;&#x4E2A;&#x5951;&#x7EA6;(<span class="math inline">\(contract\)</span>)&#xFF0C;&#x8BB0;&#x5F55;&#x4E86;&#x4E00;&#x4E2A;&#x94FE;&#x8868;&#x5FC5;&#x987B;&#x80FD;&#x591F;&#x505A;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x4F46;&#x5B83;&#x4E0D;&#x63D0;&#x4F9B;&#x4EFB;&#x4F55;&#x65B9;&#x6CD5;&#x7684;&#x5B9E;&#x73B0;&#x3002;&#x4E0B;&#x9762;&#x662F;<span class="math inline">\(List61B\)</span>&#x7684;&#x63A5;&#x53E3;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">List61B</span>&lt;Item&gt; {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFirst</span><span class="params">(Item x)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> add <span class="title function_">Last</span><span class="params">(Item y)</span>;</span><br><span class="line">    <span class="keyword">public</span> Item <span class="title function_">getFirst</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> Item <span class="title function_">getLast</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> Item <span class="title function_">removeLast</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> Item <span class="title function_">get</span><span class="params">(<span class="type">int</span> i)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(Item x, <span class="type">int</span> position)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;<span class="math inline">\(AList\)</span>&#x7B49;&#x53EF;&#x4EE5;&#x5982;&#x4E0B;&#x5B9A;&#x4E49;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AList</span>&lt;Item&gt; <span class="keyword">implements</span> <span class="title class_">List61B</span>&lt;Item&gt;{...}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x91CC;&#x7684;<code>implements List61B&lt;Item&gt;</code>&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x4E00;&#x79CD;&#x627F;&#x8BFA;(<span class="math inline">\(promise\)</span>)&#xFF0C;&#x4FDD;&#x8BC1;<span class="math inline">\(AList\)</span>&#x5B9E;&#x73B0;&#x4E86;&#x63A5;&#x53E3;&#x8981;&#x6C42;&#x5B9E;&#x73B0;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>
<h3 id="3&#x8986;&#x76D6;">3.&#x8986;&#x76D6;</h3>
<p>&#x2003;&#x2003;&#x5728;&#x5B9E;&#x73B0;&#x63A5;&#x53E3;&#x6240;&#x9700;&#x7684;&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x5728;&#x65B9;&#x6CD5;&#x524D;&#x9762;&#x6DB5;&#x76D6;&#x4E00;&#x4E2A;<code>@Override</code>&#x7684;&#x6807;&#x8BB0;&#x662F;&#x5F88;&#x6709;&#x7528;&#x7684;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFirst</span><span class="params">(Item x)</span> {</span><br><span class="line">    insert(x, <span class="number">0</span>);</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h3 id="4&#x63A5;&#x53E3;&#x7684;&#x7EE7;&#x627F;">4.&#x63A5;&#x53E3;&#x7684;&#x7EE7;&#x627F;</h3>
<p>&#x2003;&#x2003;&#x63A5;&#x53E3;&#x7684;&#x7EE7;&#x627F;(<span class="math inline">\(inheritance\)</span>)&#x6307;&#x4EE3;&#x4E86;&#x4E00;&#x79CD;&#x5173;&#x7CFB;&#xFF0C;&#x5373;&#x5B50;&#x7C7B;&#x7EE7;&#x627F;&#x4E86;&#x4E3B;&#x7C7B;&#x7684;&#x6240;&#x6709;&#x7684;&#x65B9;&#x6CD5;&#x4E0E;&#x884C;&#x4E3A;&#x3002;&#x5728;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x7684;<span class="math inline">\(List61B\)</span>&#x4E2D;&#xFF0C;&#x63A5;&#x53E3;&#x7EE7;&#x627F;&#x4E86;&#x6240;&#x6709;&#x7684;&#x65B9;&#x6CD5;&#x7B7E;&#x540D;(<span class="math inline">\(signature\)</span>)&#xFF0C;&#x4F46;&#x4E0D;&#x5305;&#x62EC;&#x5B9E;&#x73B0;&#x3002;</p>
<h3 id="5groe">5.<span class="math inline">\(GRoE\)</span></h3>
<p>&#x2003;&#x2003;&#x5728;&#x5B9A;&#x4E49;&#x4E86;<span class="math inline">\(is-a\)</span>&#x5173;&#x7CFB;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x4EE5;&#x4E0B;&#x8BED;&#x53E5;&#x4E86;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SLList&lt;String&gt; someList = <span class="keyword">new</span> <span class="title class_">List61B</span>&lt;String&gt;();</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;<span class="math inline">\(SLList\)</span><span class="math inline">\(is-a\)</span><span class="math inline">\(List61B\)</span>&#xFF0C;&#x8FD9;&#x8BF4;&#x660E;<span class="math inline">\(SLList\)</span>&#x53EF;&#x4EE5;&#x653E;&#x8FDB;<span class="math inline">\(List61B\)</span>&#x7684;&#x5185;&#x5B58;&#x76D2;&#x5B50;&#x4E2D;&#xFF0C;&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x8FD9;&#x4E48;&#x5199;&#x3002;&#x4F46;&#x53CD;&#x8FC7;&#x6765;&#x5219;&#x4E0D;&#x5BF9;&#x3002;</p>
<h3 id="5&#x5B9E;&#x73B0;&#x7684;&#x7EE7;&#x627F;">5.&#x5B9E;&#x73B0;&#x7684;&#x7EE7;&#x627F;</h3>
<p>&#x2003;&#x2003;&#x4E4B;&#x524D;&#x5BF9;&#x63A5;&#x53E3;&#x7684;&#x8BB2;&#x89E3;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x8BF4;<span class="math inline">\(List61B\)</span>&#x4E2D;&#x53EA;&#x6709;&#x6807;&#x8BC6;<span class="math inline">\(List61B\)</span>&#x505A;&#x4EC0;&#x4E48;(<span class="math inline">\(what\)</span>)&#x7684;&#x65B9;&#x6CD5;&#x540D;&#x79F0;(<span class="math inline">\(method\;header\)</span>)&#x3002;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x5728;<span class="math inline">\(List61B\)</span>&#x4E2D;&#x5B9E;&#x73B0;&#x5177;&#x4F53;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5728;<span class="math inline">\(List61B\)</span>&#x4E2D;&#x52A0;&#x5165;&#x5982;&#x4E0B;&#x65B9;&#x6CD5;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">default</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size(); i += <span class="number">1</span>) {</span><br><span class="line">        System.out.print(get(i) + <span class="string">&quot; &quot;</span>);</span><br><span class="line">    }</span><br><span class="line">    System.out.println();</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x90A3;&#x4E48;&#xFF0C;&#x6240;&#x6709;&#x5BF9;<span class="math inline">\(List61B\)</span>&#x7684;&#x5B9E;&#x73B0;(<span class="math inline">\(implements\)</span>)&#x90FD;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x3002;</p>
<p>&#x2003;&#x2003;&#x4F46;&#x662F;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x4E2D;&#x7684;<span class="math inline">\(get(i)\)</span>&#x51FD;&#x6570;&#x5BF9;<span class="math inline">\(SLList\)</span>&#x6765;&#x8BF4;&#x6548;&#x7387;&#x8FC7;&#x4F4E;&#xFF0C;&#x4E8E;&#x662F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;<span class="math inline">\(SLList\)</span>&#x5B50;&#x7C7B;&#x4E2D;&#x8986;&#x76D6;&#x8FD9;&#x4E00;&#x65B9;&#x6CD5;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">Node</span> <span class="variable">p</span> <span class="operator">=</span> sentinel.next; p != <span class="literal">null</span>; p = p.next) {</span><br><span class="line">        System.out.print(p.item + <span class="string">&quot; &quot;</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x6837;&#xFF0C;&#x5728;&#x5BF9;<span class="math inline">\(SLList\)</span>&#x8C03;&#x7528;<span class="math inline">\(print()\)</span>&#x65F6;&#xFF0C;<span class="math inline">\(SLList\)</span>&#x5C31;&#x4F1A;&#x4F7F;&#x7528;&#x8986;&#x76D6;&#x540E;&#x7684;&#x65B9;&#x6CD5;&#x4E86;&#x3002;</p>
<h3 id="6&#x52A8;&#x6001;&#x65B9;&#x6CD5;&#x9009;&#x62E9;">6.&#x52A8;&#x6001;&#x65B9;&#x6CD5;&#x9009;&#x62E9;</h3>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#xFF0C;<span class="math inline">\(Java\)</span>&#x4E2D;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x7C7B;&#x578B;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List61B&lt;String&gt; lst = new SLList&lt;String&gt;();</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5728;&#x4E0A;&#x9762;&#x5B9E;&#x4F8B;&#x5316;&#x7684;&#x58F0;&#x660E;&#x4E2D;&#xFF0C;<span class="math inline">\(lst\)</span>&#x7684;&#x7C7B;&#x578B;&#x662F;<span class="math inline">\(List61B\)</span>&#xFF0C;&#x8FD9;&#x53EB;&#x4F5C;&#x9759;&#x6001;&#x7C7B;&#x578B;(<span class="math inline">\(static\;type\)</span>)&#x3002;</p>
<p>&#x2003;&#x2003;&#x7136;&#x800C;&#xFF0C;&#x5BF9;&#x8C61;&#x81EA;&#x5DF1;&#x4E5F;&#x6709;&#x7C7B;&#x578B;&#x3002;<span class="math inline">\(lst\)</span>&#x6307;&#x5411;&#x7684;&#x5BF9;&#x8C61;&#x5177;&#x6709;<span class="math inline">\(SLList\)</span>&#x7C7B;&#x578B;&#xFF0C;&#x540C;&#x65F6;&#x5B83;&#x4E5F;&#x662F;<span class="math inline">\(List61B\)</span>&#x7C7B;&#x578B;&#xFF0C;&#x8FD9;&#x662F;&#x7531;&#x4E8E;&#x4E24;&#x8005;&#x7684;<span class="math inline">\(is-a\)</span>&#x5173;&#x7CFB;&#x3002;&#x6211;&#x4EEC;&#x79F0;&#x5B83;&#x7684;<span class="math inline">\(List61B\)</span>&#x7C7B;&#x578B;&#x4E3A;&#x52A8;&#x6001;&#x7C7B;&#x578B;(<span class="math inline">\(dynamic\;type\)</span>)&#x3002;</p>
<blockquote>
<p>&#x2003;&#x2003;Aside: the name &#x201C;dynamic type&#x201D; is actually quite semantic in its
origin! Should lst be reassigned to point to an object of another type,
say a AList object, lst&#x2019;s dynamic type would now be AList and not
SLList! It&#x2019;s dynamic because it changes based on the type of the object
it&#x2019;s currently referring to.</p>
</blockquote>
<p>&#x2003;&#x2003;&#x8003;&#x8651;&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">peek</span><span class="params">(List61B&lt;String&gt; list)</span> {</span><br><span class="line">    System.out.println(list.getLast());</span><br><span class="line">}</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">peek</span><span class="params">(SLList&lt;String&gt; list)</span> {</span><br><span class="line">    System.out.println(list.getFirst());</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">SLList&lt;String&gt; SP = <span class="keyword">new</span> <span class="title class_">SLList</span>&lt;String&gt;();</span><br><span class="line">List61B&lt;String&gt; LP = SP;</span><br><span class="line">SP.addLast(<span class="string">&quot;elk&quot;</span>);</span><br><span class="line">SP.addLast(<span class="string">&quot;are&quot;</span>);</span><br><span class="line">SP.addLast(<span class="string">&quot;cool&quot;</span>);</span><br><span class="line">peek(SP);</span><br><span class="line">peek(LP);</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x7B2C;&#x4E00;&#x4E2A;<span class="math inline">\(peek\)</span>&#x8C03;&#x7528;&#x7684;&#x662F;&#x7B2C;&#x4E00;&#x4E2A;&#xFF0C;&#x800C;&#x7B2C;&#x4E8C;&#x4E2A;<span class="math inline">\(peek\)</span>&#x8C03;&#x7528;&#x7684;&#x662F;&#x7B2C;&#x4E8C;&#x4E2A;&#x3002;<span class="math inline">\(Java\)</span>&#x5728;&#x76F8;&#x540C;&#x540D;&#x79F0;&#x7684;&#x65B9;&#x6CD5;&#x95F4;&#x9009;&#x62E9;&#x65F6;&#xFF0C;&#x4F1A;&#x68C0;&#x67E5;&#x4E0E;&#x9759;&#x6001;&#x53D8;&#x91CF;&#x7C7B;&#x578B;&#x76F8;&#x540C;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x7136;&#x540E;&#x8C03;&#x7528;&#x5B83;&#x3002;</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/4.2.extends/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/4.2.extends/" class="post-title-link" itemprop="url">4.2.&#x6269;&#x5C55;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 17:20:00" itemprop="dateModified" datetime="2024-06-02T17:20:00+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/4-inheritance-inplements/" itemprop="url" rel="index"><span itemprop="name">4.inheritance &amp; inplements</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>1.8k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>6 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="42&#x6269;&#x5C55;"><span class="math inline">\(4.2\)</span>&#x6269;&#x5C55;</h1>
<h3 id="1&#x6269;&#x5C55;&#x7684;&#x5F15;&#x5165;">1.&#x6269;&#x5C55;&#x7684;&#x5F15;&#x5165;</h3>
<p>&#x2003;&#x2003;&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x60F3;&#x5B9E;&#x73B0;<span class="math inline">\(RotatingSLList\)</span>&#xFF0C;&#x5B83;&#x5177;&#x6709;&#x548C;<span class="math inline">\(SLList\)</span>&#x5B8C;&#x5168;&#x76F8;&#x540C;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x4F46;&#x589E;&#x6DFB;&#x4E86;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;<code>rotateRight</code>&#xFF0C;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x5C06;&#x94FE;&#x8868;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x6DFB;&#x52A0;&#x5230;&#x94FE;&#x8868;&#x524D;&#x7AEF;&#x3002;</p>
<p>&#x2003;&#x2003;&#x4E3A;&#x4E86;&#x7EE7;&#x627F;<span class="math inline">\(SLList\)</span>&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<span class="math inline">\(extend\)</span>&#x5173;&#x952E;&#x8BCD;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RotatingSLList</span>&lt;Item&gt; <span class="keyword">extends</span> <span class="title class_">SLList</span>&lt;Item&gt;</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x91CC;&#xFF0C;<span class="math inline">\(RotatingSLList\)</span>&#x548C;<span class="math inline">\(SLList\)</span>&#x95F4;&#x4E5F;&#x662F;<span class="math inline">\(is-a\)</span>&#x5173;&#x7CFB;&#xFF0C;<span class="math inline">\(extends\)</span>&#x5173;&#x952E;&#x8BCD;&#x5141;&#x8BB8;&#x6211;&#x4EEC;&#x4FDD;&#x7559;<span class="math inline">\(SLList\)</span>&#x7684;&#x539F;&#x59CB;&#x529F;&#x80FD;&#xFF0C;&#x540C;&#x65F6;&#x5141;&#x8BB8;&#x6211;&#x4EEC;&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#x5E76;&#x6DFB;&#x52A0;&#x5176;&#x4ED6;&#x7684;&#x529F;&#x80FD;(<span class="math inline">\(functionality\)</span>)&#x3002;</p>
<p><img src="/2024/05/31/4.2.extends/image-2.png"></p>
<p>&#x2003;&#x2003;&#x4F7F;&#x7528;<span class="math inline">\(extends\)</span>&#x8BED;&#x53E5;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x4FBF;&#x53EF;&#x4EE5;&#x501F;&#x52A9;<span class="math inline">\(SLList\)</span>&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#x6765;&#x5B9E;&#x73B0;<code>rotateRight</code>&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rotateRight</span><span class="params">()</span> {</span><br><span class="line">    <span class="type">Item</span> <span class="variable">x</span> <span class="operator">=</span> removeLast();</span><br><span class="line">    addFirst(x);</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5728;<span class="math inline">\(extend\)</span>&#x5173;&#x952E;&#x8BCD;&#x4E0B;&#xFF0C;&#x5B50;&#x7C7B;&#x7EE7;&#x627F;&#x4E86;&#x7236;&#x7C7B;&#x7684;&#x5927;&#x90E8;&#x5206;&#x6210;&#x5458;&#xFF1A;</p>
<ul>
<li>&#x6240;&#x6709;&#x7684;&#x5B9E;&#x4F8B;&#x548C;&#x9759;&#x6001;&#x53D8;&#x91CF;</li>
<li>&#x6240;&#x6709;&#x7684;&#x65B9;&#x6CD5;</li>
<li>&#x6240;&#x6709;&#x7684;&#x5D4C;&#x5957;&#x7C7B;</li>
</ul>
<p>&#x2003;&#x2003;&#x5F53;&#x6211;&#x4EEC;&#x8981;&#x8986;&#x76D6;&#x6240;&#x7EE7;&#x627F;&#x7684;&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x4F7F;&#x7528;<code>@Override</code>&#x5373;&#x53EF;&#x3002;&#x4F8B;&#x5982;&#x4E0B;&#x9762;<span class="math inline">\(VengefulSLList\)</span>&#x7684;&#x5B9E;&#x73B0;&#xFF1A;&#x5B83;&#x7684;<code>removeLast</code>&#x65B9;&#x6CD5;&#x5728;&#x5220;&#x53BB;&#x672B;&#x5C3E;&#x5143;&#x7D20;&#x540E;&#x4F1A;&#x5C06;&#x5176;&#x6DFB;&#x52A0;&#x5230;&#x524D;&#x7AEF;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VengefulSLList</span>&lt;Item&gt; <span class="keyword">extends</span> <span class="title class_">SLList</span>&lt;Item&gt; {</span><br><span class="line">    SLList&lt;Item&gt; deletedItems;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">VengefulSLList</span><span class="params">()</span> {</span><br><span class="line">        deletedItems = <span class="keyword">new</span> <span class="title class_">SLList</span>&lt;Item&gt;();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Item <span class="title function_">removeLast</span><span class="params">()</span> {</span><br><span class="line">        <span class="type">Item</span> <span class="variable">x</span> <span class="operator">=</span> <span class="built_in">super</span>.removeLast();</span><br><span class="line">        deletedItems.addLast(x);</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Prints deleted items. */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printLostItems</span><span class="params">()</span> {</span><br><span class="line">        deletedItems.print();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h3 id="2&#x5173;&#x4E8E;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x7684;&#x7EE7;&#x627F;">2.&#x5173;&#x4E8E;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x7684;&#x7EE7;&#x627F;</h3>
<p>&#x2003;&#x2003;&#x867D;&#x7136;&#x5B50;&#x7C7B;&#x4F1A;&#x7EE7;&#x627F;&#x7236;&#x7C7B;&#x7684;&#x5927;&#x90E8;&#x5206;&#x6210;&#x5458;&#xFF0C;&#x4F46;&#x662F;&#x5B50;&#x7C7B;&#x65E0;&#x6CD5;&#x7EE7;&#x627F;&#x7236;&#x7C7B;&#x7684;&#x6784;&#x9020;&#x65B9;&#x6CD5;(<span class="math inline">\(constructor\)</span>)&#x3002;&#x540C;&#x65F6;&#xFF0C;<span class="math inline">\(Java\)</span>&#x8981;&#x6C42;&#x6240;&#x6709;&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x5FC5;&#x987B;&#x4ECE;&#x5BF9;&#x4E00;&#x4E2A;&#x4E3B;&#x7C7B;(<span class="math inline">\(superclass\)</span>)&#x7684;&#x6784;&#x9020;&#x65B9;&#x5F0F;&#x7684;&#x8C03;&#x7528;&#x5F00;&#x59CB;&#x3002;</p>
<p>&#x2003;&#x2003;&#x4EE5;&#x4E0B;&#x9762;&#x7684;&#x4E24;&#x4E2A;&#x7C7B;&#x4E3A;&#x4F8B;&#xFF1A; <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">public class Human {...}</span><br><span class="line">public class TA extends Human {...}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x7531;<span class="math inline">\(extends\)</span>&#x8BED;&#x53E5;&#xFF0C;<span class="math inline">\(TA\)</span>&#x4F1A;&#x7EE7;&#x627F;<span class="math inline">\(Human\)</span>&#x7684;&#x5C5E;&#x6027;&#x4E0E;&#x884C;&#x4E3A;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x8FD0;&#x884C;&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">TA</span> <span class="variable">Christine</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TA</span>();</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x90A3;&#x4E48;&#x9996;&#x5148;&#xFF0C;&#x4E00;&#x4E2A;<span class="math inline">\(Human\)</span>&#x8981;&#x5148;&#x88AB;&#x521B;&#x5EFA;&#xFF0C;&#x8FD9;&#x6837;<span class="math inline">\(Human\)</span>&#x624D;&#x80FD;&#x628A;&#x81EA;&#x5DF1;&#x7684;&#x7279;&#x6027;&#x4F20;&#x9012;&#x7ED9;<span class="math inline">\(TA\)</span>&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x521B;&#x5EFA;<span class="math inline">\(Human\)</span>&#x5C31;&#x521B;&#x5EFA;<span class="math inline">\(TA\)</span>&#x663E;&#x7136;&#x662F;&#x9519;&#x8BEF;&#x7684;&#x3002;</p>
<p>&#x2003;&#x2003;&#x56E0;&#x6B64;&#xFF0C;&#x5728;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5B50;&#x7C7B;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5148;&#x7528;<span class="math inline">\(super\)</span>&#x5173;&#x952E;&#x8BCD;&#xFF0C;&#x8C03;&#x7528;&#x4E3B;&#x7C7B;&#x7684;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">VengefulSLList</span><span class="params">()</span> {</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">    deletedItems = <span class="keyword">new</span> <span class="title class_">SLList</span>&lt;Item&gt;();</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x6216;&#x8005;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4E0D;&#x8FD9;&#x4E48;&#x505A;&#xFF0C;<span class="math inline">\(Java\)</span>&#x4F1A;&#x81EA;&#x52A8;&#x8C03;&#x7528;&#x4E3B;&#x7C7B;&#x7684;&#x65E0;&#x53C2;&#x6570;(<span class="math inline">\(non-argument\)</span>)&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x3002;</p>
<p>&#x2003;&#x2003;&#x4F46;&#x6709;&#x65F6;&#x5019;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x7236;&#x7C7B;&#x7684;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#xFF0C;<span class="math inline">\(Java\)</span>&#x7684;&#x81EA;&#x52A8;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#x53EF;&#x80FD;&#x4E0D;&#x662F;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x7684;&#x3002;&#x4F8B;&#x5982;&#x6211;&#x4EEC;&#x6709;&#x4E00;&#x4E2A;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x7684;&#x5355;&#x53C2;&#x6570;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#xFF0C;<span class="math inline">\(Java\)</span>&#x81EA;&#x52A8;&#x8C03;&#x7528;&#x7684;&#x65E0;&#x53C2;&#x6570;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x4F1A;&#x8BA9;&#x6211;&#x4EEC;&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;&#x65E0;&#x6548;&#xFF01;&#x8FD9;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x5FC5;&#x987B;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7684;&#x6784;&#x9020;&#x65B9;&#x5F0F;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">VengefulSLList</span><span class="params">(Item x)</span> {</span><br><span class="line">    <span class="built_in">super</span>(x);</span><br><span class="line">    deletedItems = <span class="keyword">new</span> <span class="title class_">SLList</span>&lt;Item&gt;();</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h3 id="3&#x5BF9;&#x8C61;&#x7C7B;">3.&#x5BF9;&#x8C61;&#x7C7B;</h3>
<p>&#x2003;&#x2003;<span class="math inline">\(Java\)</span>&#x4E2D;&#x7684;&#x6240;&#x6709;&#x7C7B;&#x90FD;&#x662F;&#x5BF9;&#x8C61;&#x7C7B;(<span class="math inline">\(object\;class\)</span>)&#x7684;&#x5B50;&#x7C7B;(<span class="math inline">\(descendant\)</span>)&#xFF0C;&#x6216;&#x8005;&#x5BF9;&#x8C61;&#x7C7B;&#x7684;<span class="math inline">\(extends\)</span>&#x3002;&#x4E0D;&#x7BA1;&#x4E00;&#x4E2A;&#x7C7B;&#x6709;&#x6CA1;&#x6709;&#x663E;&#x6027;&#x7684;<span class="math inline">\(extends\)</span>&#x5173;&#x952E;&#x8BCD;&#xFF0C;&#x5B83;&#x90FD;&#x9690;&#x6027;&#x5730;&#x7EE7;&#x627F;&#x4E86;&#x5BF9;&#x8C61;&#x7C7B;&#x3002;&#x4EE5;&#x524D;&#x9762;&#x4E3A;&#x4F8B;&#xFF1A;</p>
<ul>
<li><span class="math inline">\(VengefulSLList\)</span>&#x662F;<span class="math inline">\(SLList\)</span>&#x7684;&#x663E;&#x5F0F;<span class="math inline">\(extends\)</span>&#x3002;</li>
<li><span class="math inline">\(SLList\)</span>&#x9690;&#x6027;&#x7EE7;&#x627F;&#x4E86;&#x5BF9;&#x8C61;&#x7C7B;&#x3002;</li>
</ul>
<p>&#x2003;&#x2003;&#x5BF9;&#x8C61;&#x7C7B;&#x63D0;&#x4F9B;&#x4E86;&#x5F88;&#x591A;&#x6240;&#x6709;&#x5BF9;&#x8C61;&#x90FD;&#x5E94;&#x9075;&#x5FAA;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x5982;<code>.equal(Object obj)</code>&#x3001;<code>.hashCode()</code>&#x7B49;&#x3002;</p>
<h3 id="4&#x5C01;&#x88C5;">4.&#x5C01;&#x88C5;</h3>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x9636;&#x5C42;&#x62BD;&#x8C61;(&#x62BD;&#x8C61;&#x5C4F;&#x969C;)&#x6765;&#x51CF;&#x5C0F;&#x7A0B;&#x5E8F;&#x7684;&#x590D;&#x6742;&#x6027;(<span class="math inline">\(complexity\)</span>)&#xFF0C;&#x4EE5;&#x53CA;&#x201C;&#x4E3A;&#x51C6;&#x5907;&#x4FEE;&#x6539;&#x800C;&#x7F16;&#x7A0B;&#x201D;&#x7684;&#x6982;&#x5FF5;&#x3002;&#x8FD9;&#x662F;&#x56F4;&#x7ED5;&#x7740;&#x7A0B;&#x5E8F;&#x5E94;&#x8BE5;&#x88AB;&#x5EFA;&#x9020;&#x4E3A;&#x6A21;&#x5757;&#x5316;&#x7684;&#x3001;&#x53EF;&#x5185;&#x90E8;&#x6539;&#x53D8;(<span class="math inline">\(interchangeable\)</span>)&#x7684;&#x7247;&#x6BB5;&#xFF0C;&#x5B83;&#x4EEC;&#x53EF;&#x4EE5;&#x4E92;&#x76F8;&#x4EA4;&#x6362;&#x3001;&#x5E76;&#x4E14;&#x4E0D;&#x4F1A;&#x7834;&#x574F;&#x539F;&#x6709;&#x7684;&#x7CFB;&#x7EDF;&#x3002;&#x540C;&#x65F6;&#xFF0C;&#x628A;&#x4ED6;&#x4EBA;&#x4E0D;&#x9700;&#x8981;&#x7684;&#x4FE1;&#x606F;&#x9690;&#x85CF;&#x8D77;&#x6765;&#x4E5F;&#x662F;&#x51CF;&#x5C0F;&#x7A0B;&#x5E8F;&#x590D;&#x6742;&#x6027;&#x7684;&#x91CD;&#x8981;&#x624B;&#x6BB5;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5C01;&#x88C5;&#x7684;&#x6839;&#x6E90;&#x5373;&#x5B58;&#x5728;&#x4E8E;&#x5C06;&#x4FE1;&#x606F;&#x5BF9;&#x5916;&#x9690;&#x85CF;&#x7684;&#x6982;&#x5FF5;&#x3002;&#x5728;&#x8BA1;&#x7B97;&#x673A;&#x79D1;&#x5B66;&#x4E2D;&#xFF0C;&#x4E00;&#x4E2A;&#x6A21;&#x5757;&#x53EF;&#x4EE5;&#x88AB;&#x5B9A;&#x4E49;&#x4E3A;&#x4E00;&#x7CFB;&#x5217;&#x65B9;&#x6CD5;&#xFF0C;&#x5B83;&#x4EEC;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x6574;&#x4F53;&#x5DE5;&#x4F5C;&#x6765;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#x3002;&#x5F53;&#x8FD9;&#x4E2A;&#x6A21;&#x5757;&#x7684;&#x5B9E;&#x73B0;&#x7EC6;&#x8282;&#x90FD;&#x88AB;&#x9690;&#x85CF;&#x8D77;&#x6765;&#x3001;&#x53EA;&#x80FD;&#x901A;&#x8FC7;&#x63A5;&#x53E3;&#x4E0E;&#x5176;&#x8FDB;&#x884C;&#x4EA4;&#x4E92;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x6A21;&#x5757;&#x5C31;&#x662F;&#x5DF2;&#x5C01;&#x88C5;&#x7684;(<span class="math inline">\(encapsulated\)</span>)&#x3002;</p>
<p>&#x2003;&#x2003;&#x5728;&#x7406;&#x60F3;&#x72B6;&#x6001;&#x4E0B;&#xFF0C;&#x7528;&#x6237;&#x4E0D;&#x5E94;&#x89C2;&#x5BDF;&#x5230;&#x5B83;&#x4EEC;&#x6240;&#x4F7F;&#x7528;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x7684;&#x5185;&#x90E8;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x3002;&#x800C;<span class="math inline">\(Java\)</span>&#x7684;<span class="math inline">\(private\)</span>&#x5173;&#x952E;&#x8BCD;&#x5C31;&#x5F88;&#x597D;&#x5730;&#x5EFA;&#x7ACB;&#x4E86;&#x62BD;&#x8C61;&#x5C4F;&#x969C;&#x3002;</p>
<h3 id="5&#x7C7B;&#x578B;&#x9519;&#x8BEF;-&#x7F16;&#x8BD1;&#x65F6;&#x7C7B;&#x578B;">5.&#x7C7B;&#x578B;&#x9519;&#x8BEF;&#x3001;&#x7F16;&#x8BD1;&#x65F6;&#x7C7B;&#x578B;</h3>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x8003;&#x8651;&#x4E0B;&#x9762;&#x7684;&#x7A0B;&#x5E8F;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">    VengefulSLList&lt;Integer&gt; vsl = <span class="keyword">new</span> <span class="title class_">VengefulSLList</span>&lt;Integer&gt;(<span class="number">9</span>);</span><br><span class="line">    SLList&lt;Integer&gt; sl = vsl;</span><br><span class="line"></span><br><span class="line">    sl.addLast(<span class="number">50</span>);</span><br><span class="line">    sl.removeLast();</span><br><span class="line"></span><br><span class="line">    sl.printLostItems();</span><br><span class="line">    VengefulSLList&lt;Integer&gt; vsl2 = sl;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">VengefulSLList&lt;Integer&gt; vsl = <span class="keyword">new</span> <span class="title class_">VengefulSLList</span>&lt;Integer&gt;(<span class="number">9</span>);</span><br><span class="line">SLList&lt;Integer&gt; sl = vsl;</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;&#x7A0B;&#x5E8F;&#x7684;&#x524D;&#x4E24;&#x884C;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#xFF0C;&#x56E0;&#x4E3A;<span class="math inline">\(VengefulSLList\)</span><span class="math inline">\(is-a\)</span><span class="math inline">\(SLList\)</span>&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x628A;<span class="math inline">\(VengefulSLList\)</span>&#x653E;&#x5165;<span class="math inline">\(SLList\)</span>&#x7684;&#x5185;&#x5B58;&#x76D2;&#x5B50;&#x4E2D;&#x3002; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sl.addLast(<span class="number">50</span>);</span><br><span class="line">sl.removeLast();</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x4E24;&#x884C;&#x4E5F;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#xFF0C;&#x6839;&#x636E;&#x524D;&#x9762;&#x7684;&#x8BB2;&#x89E3;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;<code>addLast</code>&#x4F1A;&#x8C03;&#x7528;<span class="math inline">\(SLList\)</span>&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x800C;&#x7B2C;&#x4E8C;&#x4E2A;<code>removeLast</code>&#x4F1A;&#x8C03;&#x7528;<span class="math inline">\(VengefulSLList\)</span>&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sl.printLostItems();</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;&#x4F46;&#x662F;&#x8FD9;&#x4E00;&#x884C;&#x7A0B;&#x5E8F;&#x65E0;&#x6CD5;&#x7F16;&#x8BD1;&#xFF0C;&#x56E0;&#x4E3A;<span class="math inline">\(SLList\)</span>&#x53CA;&#x5176;&#x4E3B;&#x7C7B;&#x90FD;&#x6CA1;&#x6709;<code>printLostItems</code>&#x8FD9;&#x4E00;&#x65B9;&#x6CD5;&#xFF0C;&#x5373;&#x4F7F;<span class="math inline">\(sl\)</span>&#x7684;&#x8FD0;&#x884C;&#x7C7B;&#x578B;&#x662F;<span class="math inline">\(VengefulSLList\)</span>&#x4F9D;&#x7136;&#x4E0D;&#x884C;&#x3002;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VengefulSLList&lt;Integer&gt; vsl2 = sl;</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x540C;&#x6837;&#x5730;&#xFF0C;&#x8FD9;&#x4E00;&#x884C;&#x7A0B;&#x5E8F;&#x4E5F;&#x4F1A;&#x7F16;&#x8BD1;&#x9519;&#x8BEF;&#x3002;&#x56E0;&#x4E3A;<span class="math inline">\(SLList\)</span>&#x5E76;&#x4E0D;<span class="math inline">\(is-a\;\)</span><span class="math inline">\(VengefulSLList\)</span>&#x3002;</p>
<p>&#x2003;&#x2003;&#x8FD9;&#x4E24;&#x4F8B;&#x8BF4;&#x660E;&#xFF0C;&#x7F16;&#x8BD1;&#x5668;&#x53EA;&#x652F;&#x6301;&#x7F16;&#x8BD1;&#x65F6;(<span class="math inline">\(compile-time\)</span>)&#x7684;&#x7C7B;&#x578B;&#x6240;&#x5305;&#x542B;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>
<p>&#x2003;&#x2003;&#x9664;&#x4E86;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x5BF9;&#x65B9;&#x6CD5;&#x7684;&#x8C03;&#x7528;&#x4E5F;&#x4F1A;&#x6709;&#x7F16;&#x8BD1;&#x65F6;&#x7C7B;&#x578B;&#xFF0C;&#x5373;&#x8BE5;&#x65B9;&#x6CD5;&#x58F0;&#x660E;&#x65F6;&#x7684;&#x7C7B;&#x578B;&#x3002;&#x4F8B;&#x5982;&#x4E0B;&#x9762;&#x7684;&#x7A0B;&#x5E8F;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Poodle</span> <span class="variable">frank</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Poodle</span>(<span class="string">&quot;Frank&quot;</span>, <span class="number">5</span>);</span><br><span class="line"><span class="type">Poodle</span> <span class="variable">frankJr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Poodle</span>(<span class="string">&quot;Frank Jr.&quot;</span>, <span class="number">15</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">Dog</span> <span class="variable">largerDog</span> <span class="operator">=</span> maxDog(frank, frankJr);</span><br><span class="line"><span class="type">Poodle</span> <span class="variable">largerPoodle</span> <span class="operator">=</span> maxDog(frank, frankJr); </span><br><span class="line"><span class="comment">//does not compile! RHS has compile-time type Dog</span></span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Poodle</span> <span class="variable">largerPoodle</span> <span class="operator">=</span> maxDog(frank, frankJr); </span><br><span class="line"><span class="comment">//does not compile! RHS has compile-time type Dog</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8BE5;&#x884C;&#x4EE3;&#x7801;&#x4E5F;&#x4F1A;&#x7F16;&#x8BD1;&#x9519;&#x8BEF;&#xFF0C;&#x56E0;&#x4E3A;<code>maxDog</code>&#x7684;&#x7F16;&#x8BD1;&#x65F6;&#x7C7B;&#x578B;&#x4E3A;<span class="math inline">\(Dog\)</span>&#x3002;</p>
<h3 id="6&#x7C7B;&#x578B;&#x94F8;&#x9020;casting">6.&#x7C7B;&#x578B;&#x94F8;&#x9020;<span class="math inline">\(casting\)</span></h3>
<p>&#x2003;&#x2003;&#x5728;<span class="math inline">\(Java\)</span>&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x544A;&#x8BC9;&#x7F16;&#x8BD1;&#x5668;&#x67D0;&#x4E2A;&#x8868;&#x8FBE;&#x5F0F;&#x6709;&#x7279;&#x5B9A;&#x7684;&#x7F16;&#x8BD1;&#x65F6;&#x7C7B;&#x578B;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x7C7B;&#x578B;&#x7684;&#x201C;&#x8F6C;&#x6362;&#x201D;&#x3002;</p>
<p>&#x2003;&#x2003;&#x4F8B;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5BF9;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x8FDB;&#x884C;&#x5982;&#x4E0B;&#x66F4;&#x6539;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Poodle</span> <span class="variable">largerPoodle</span> <span class="operator">=</span> (Poodle) maxDog(frank, frankJr); </span><br><span class="line"><span class="comment">// compiles! Right hand side has compile-time type Poodle after casting</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x4F46;&#x662F;&#xFF0C;&#x5BF9;&#x4E24;&#x4E2A;&#x6BEB;&#x4E0D;&#x76F8;&#x5E72;&#x7684;&#x7C7B;&#x8FDB;&#x884C;&#x7C7B;&#x578B;&#x94F8;&#x9020;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4;<code>ClassCastException</code>&#x7684;&#x9519;&#x8BEF;&#x3002;</p>
<h3 id="7&#x9AD8;&#x9636;&#x51FD;&#x6570;">7.&#x9AD8;&#x9636;&#x51FD;&#x6570;</h3>
<p>&#x2003;&#x2003;&#x5728;<span class="math inline">\(Java\)</span>&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x63A5;&#x53E3;&#x5B9E;&#x73B0;&#x9AD8;&#x9636;&#x51FD;&#x6570;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5148;&#x5728;&#x63A5;&#x53E3;&#x4E2D;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IntUnaryFunction</span> {</span><br><span class="line">    <span class="type">int</span> <span class="title function_">apply</span><span class="params">(<span class="type">int</span> x)</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x7136;&#x540E;&#x6211;&#x4EEC;&#x5199;&#x4E00;&#x4E2A;&#x7C7B;&#x6765;&#x5B9E;&#x73B0;&#x63A5;&#x53E3;&#x4E2D;&#x6307;&#x5B9A;&#x7684;&#x51FD;&#x6570;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TenX</span> <span class="keyword">implements</span> <span class="title class_">IntUnaryFunction</span> {</span><br><span class="line">    <span class="comment">/* Returns ten times the argument. */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">apply</span><span class="params">(<span class="type">int</span> x)</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">10</span> * x;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x7136;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5199;&#x51FA;&#x9AD8;&#x9636;&#x51FD;&#x6570;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x4E86;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">do_twice</span><span class="params">(IntUnaryFunction f, <span class="type">int</span> x)</span> {</span><br><span class="line">    <span class="keyword">return</span> f.apply(f.apply(x));</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5728;&#x8C03;&#x7528;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x521B;&#x9020;&#x4E00;&#x4E2A;&#x65B0;&#x7684;<span class="math inline">\(tenX\)</span>&#x5B9E;&#x4F8B;&#xFF0C;&#x7136;&#x540E;&#x4F20;&#x5165;&#x53C2;&#x6570;<span class="math inline">\(x\)</span>&#x5373;&#x53EF;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(do_twice(<span class="keyword">new</span> <span class="title class_">TenX</span>(), <span class="number">2</span>));</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x51FD;&#x6570;&#x5F0F;&#x63A5;&#x53E3;&#x5141;&#x8BB8;&#x6211;&#x4EEC;&#x4EE5;&#x4F18;&#x96C5;&#x7684;&#x65B9;&#x5F0F;&#x4F20;&#x9012;&#x51FD;&#x6570;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x63A5;&#x53E3;&#x5B9A;&#x4E49;&#x51FD;&#x6570;&#x7684;&#x7B7E;&#x540D;&#x4E0E;&#x884C;&#x4E3A;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;&#x5B9E;&#x73B0;&#x63A5;&#x53E3;&#x7684;&#x7C7B;&#x6765;&#x63D0;&#x4F9B;&#x5177;&#x4F53;&#x7684;&#x51FD;&#x6570;&#x3002;</p>
<h3 id="8summarcopy-by-origin-text">8.summar(copy by origin text)</h3>
<p>&#x2003;&#x2003;VengefulSLList extends SLList means VengefulSLList &quot;is-an&quot; SLList,
and inherits all of SLList&apos;s members:</p>
<ul>
<li>Variables, methods nested classes</li>
<li>Not constructors Subclass constructors must invoke superclass
constructor first. The super keyword can be used to invoke overridden
superclass methods and constructors.</li>
</ul>
<p>&#x2003;&#x2003;Invocation of overridden methods follows two simple rules:</p>
<ul>
<li>Compiler plays it safe and only allows us to do things according to
the static type.</li>
<li>For overridden methods (not overloaded methods), the actual method
invoked is based on the dynamic type of the invoking expression</li>
<li>Can use casting to overrule compiler type checking.</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/4.2.%E9%9A%90%E6%80%A7%E5%BA%8F%E5%88%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/4.2.%E9%9A%90%E6%80%A7%E5%BA%8F%E5%88%97/" class="post-title-link" itemprop="url">4.2.&#x9690;&#x6027;&#x5E8F;&#x5217;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 15:53:00" itemprop="dateModified" datetime="2024-06-02T15:53:00+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SICP-in-python/" itemprop="url" rel="index"><span itemprop="name">SICP in python</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SICP-in-python/Chapter-4-Data-Processing/" itemprop="url" rel="index"><span itemprop="name">Chapter 4.Data Processing</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>3k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>11 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="42&#x9690;&#x6027;&#x5E8F;&#x5217;implicitsequences"><span class="math inline">\(4.2\)</span>&#x9690;&#x6027;&#x5E8F;&#x5217;<span class="math inline">\(Implicit\;Sequences\)</span></h1>
<h2 id="&#x4E00;-&#x6982;&#x8FF0;">&#x4E00;&#x3001;&#x6982;&#x8FF0;</h2>
<h3 id="1&#x61D2;&#x60F0;&#x8BA1;&#x7B97;">1.&#x61D2;&#x60F0;&#x8BA1;&#x7B97;</h3>
<p>&#x2003;&#x2003;&#x4E00;&#x4E2A;&#x5E8F;&#x5217;&#x53EF;&#x4EE5;&#x5728;&#x4E0D;&#x76F4;&#x63A5;&#x5B58;&#x50A8;&#x5728;&#x7535;&#x8111;&#x5185;&#x5B58;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x88AB;&#x4EE3;&#x8868;(<span class="math inline">\(represent\)</span>)&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x5B83;<strong>&#x80FD;&#x591F;&#x8BBF;&#x95EE;&#x5E8F;&#x5217;&#x578B;&#x6570;&#x636E;&#x96C6;(<span class="math inline">\(sequential\;dataset\)</span>)&#x7684;&#x6240;&#x6709;&#x5143;&#x7D20;&#xFF0C;&#x5E76;&#x4E14;&#x4E0D;&#x7528;&#x9884;&#x5148;&#x8BA1;&#x7B97;&#x5B58;&#x50A8;&#x6240;&#x6709;&#x7684;&#x5143;&#x7D20;</strong>&#x3002;&#x4F5C;&#x4E3A;&#x66FF;&#x4EE3;&#xFF0C;&#x6211;&#x4EEC;<strong>&#x53EA;&#x5728;&#x9700;&#x8981;&#x8BBF;&#x95EE;&#x67D0;&#x5143;&#x7D20;&#x7684;&#x65F6;&#x5019;&#x8FDB;&#x884C;&#x8BA1;&#x7B97;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;&#x662F;&#x5E8F;&#x5217;&#x7C7B;&#x578B;<span class="math inline">\(range\)</span>&#x3002;&#x5728;<span class="math inline">\(range\)</span>&#x4E2D;&#xFF0C;&#x5F53;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x88AB;&#x8981;&#x6C42;&#x8BA1;&#x7B97;&#x51FA;&#x6765;&#x65F6;&#xFF0C;<span class="math inline">\(range\)</span>&#x624D;&#x4F1A;&#x7740;&#x624B;&#x8BA1;&#x7B97;&#x5B83;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x4E0D;&#x6D88;&#x8017;&#x5927;&#x91CF;&#x5185;&#x5B58;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x8868;&#x793A;&#x5F88;&#x5927;&#x533A;&#x95F4;&#x8303;&#x56F4;&#x7684;&#x6574;&#x6570;&#x3002;&#x53EA;&#x6709;<span class="math inline">\(range\)</span>&#x7684;&#x7ED3;&#x5C3E;&#x4F5C;&#x4E3A;<span class="math inline">\(range\)</span>&#x5BF9;&#x8C61;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x88AB;&#x5B58;&#x50A8;&#x4E86;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = <span class="built_in">range</span>(<span class="number">10000</span>, <span class="number">1000000000</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r[<span class="number">45006230</span>]</span><br><span class="line"><span class="number">45016230</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;<code>r[45006230]</code>&#x662F;&#x901A;&#x8FC7;&#x7B2C;&#x4E00;&#x4E2A;&#x5143;&#x7D20;<span class="math inline">\(10000\)</span>&#x52A0;&#x4E0A;&#x7D22;&#x5F15;(<span class="math inline">\(index\)</span>)<span class="math inline">\(45006230\)</span>&#x8BA1;&#x7B97;&#x51FA;&#x6765;&#x7684;&#x3002;&#x8FD9;&#x79CD;<strong>&#x5728;&#x9700;&#x8981;&#x67D0;&#x4E2A;&#x503C;&#x7684;&#x65F6;&#x5019;&#x624D;&#x8BA1;&#x7B97;&#x5B83;&#x7684;&#x884C;&#x4E3A;</strong>&#x88AB;&#x79F0;&#x4F5C;&#x61D2;&#x60F0;&#x8BA1;&#x7B97;(<span class="math inline">\(lazy\;computation\)</span>)&#x3002;</p>
<h3 id="2&#x8FED;&#x4EE3;&#x5668;">2.&#x8FED;&#x4EE3;&#x5668;</h3>
<p>&#x2003;&#x2003;&#x8FED;&#x4EE3;&#x5668;(iterator)&#x662F;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x5B83;&#x4E3A;&#x5E95;&#x5C42;&#x7684;&#x5E8F;&#x5217;&#x578B;&#x6570;&#x636E;&#x96C6;&#x63D0;&#x4F9B;&#x5FAA;&#x5E8F;&#x5B58;&#x53D6;&#x3002;&#x8FED;&#x4EE3;&#x5668;&#x62BD;&#x8C61;&#x6709;&#x4E24;&#x4E2A;&#x7EC4;&#x6210;&#x90E8;&#x5206;&#xFF1A;</p>
<ul>
<li><strong>&#x5728;&#x5E8F;&#x5217;&#x5143;&#x7D20;&#x4E2D;&#x68C0;&#x7D22;&#x4E0B;&#x4E00;&#x4E2A;&#x5143;&#x7D20;<span class="math inline">\(next\)</span></strong> &#x7684;&#x673A;&#x5236;&#x3002;</li>
<li><strong>&#x53D1;&#x51FA;&#x7ED3;&#x675F;&#x4FE1;&#x53F7;</strong>&#xFF1A;&#x5DF2;&#x7ECF;&#x5230;&#x8FBE;&#x5E8F;&#x5217;&#x7ED3;&#x675F;&#x5904;&#x3001;&#x6CA1;&#x6709;&#x5176;&#x4ED6;&#x5143;&#x7D20;&#x5B58;&#x5728;&#x7684;&#x4FE1;&#x53F7;&#x7684;&#x673A;&#x5236;&#x3002;</li>
</ul>
<p>&#x2003;&#x2003;&#x8FED;&#x4EE3;&#x5668;&#x7684;&#x6709;&#x7528;&#x4E4B;&#x5904;&#x57FA;&#x4E8E;&#x5E95;&#x5C42;&#x7684;&#x4E00;&#x7CFB;&#x5217;&#x4FE1;&#x606F;(<span class="math inline">\(series\;of\;data\)</span>)&#x53EF;&#x80FD;&#x4E0D;&#x4F1A;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x76F4;&#x63A5;&#x88AB;&#x8868;&#x793A;&#x3002;&#x800C;&#x8FED;&#x4EE3;&#x5668;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;<strong>&#x4F9D;&#x6B21;&#x8003;&#x8651;&#x4E00;&#x7CFB;&#x5217;&#x503C;&#x7684;&#x673A;&#x5236;</strong>&#xFF0C;&#x800C;<strong>&#x5176;&#x4ED6;&#x672A;&#x88AB;&#x8003;&#x8651;&#x7684;&#x503C;&#x4E0D;&#x9700;&#x8981;&#x540C;&#x65F6;&#x5B58;&#x50A8;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x800C;&#x662F;&#x5728;&#x8FED;&#x4EE3;&#x5668;&#x8BBF;&#x95EE;&#x5230;&#x5B83;&#x7684;&#x65F6;&#x5019;&#x624D;&#x88AB;&#x8BA1;&#x7B97;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;<span class="math inline">\(range\)</span>&#x4E4B;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x5BF9;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x61D2;&#x60F0;&#x8BA1;&#x7B97;&#xFF0C;&#x662F;&#x56E0;&#x4E3A;<strong>&#x5E8F;&#x5217;&#x5185;&#x90E8;&#x7684;&#x5143;&#x7D20;&#x5F62;&#x5F0F;&#x662F;&#x7EDF;&#x4E00;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x4EFB;&#x610F;&#x4E00;&#x4E2A;&#x503C;&#x90FD;&#x53EF;&#x4EE5;&#x5BB9;&#x6613;&#x5730;&#x901A;&#x8FC7;&#x5934;&#x5143;&#x7D20;&#x4E0E;&#x5C3E;&#x5143;&#x7D20;&#x8BA1;&#x7B97;&#x51FA;&#x6765;</strong>&#x3002;&#x800C;&#x8FED;&#x4EE3;&#x5668;&#x5C06;&#x61D2;&#x60F0;&#x8BA1;&#x7B97;&#x7684;&#x9002;&#x7528;&#x7C7B;&#x578B;&#x6269;&#x5927;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E9B;&#x5E8F;&#x5217;&#x7C7B;&#x578B;&#x4E0D;&#x9700;&#x8981;&#x81EA;&#x5DF1;&#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x8BA1;&#x7B97;&#x4EFB;&#x610F;&#x503C;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x76F8;&#x53CD;&#xFF0C;&#x5B83;&#x4EEC;<strong>&#x53EA;&#x9700;&#x8981;&#x80FD;&#x4F9D;&#x6B21;&#x8BA1;&#x7B97;&#x51FA;&#x4E0B;&#x4E00;&#x4E2A;&#x5143;&#x7D20;<span class="math inline">\(next\)</span>&#x5373;&#x53EF;</strong>&#x3002;</p>
<h2 id="&#x4E8C;-python&#x7684;&#x8FED;&#x4EE3;&#x5668;">&#x4E8C;&#x3001;<span class="math inline">\(python\)</span>&#x7684;&#x8FED;&#x4EE3;&#x5668;</h2>
<h3 id="1&#x8FED;&#x4EE3;&#x5668;&#x7684;&#x529F;&#x80FD;&#x4E0E;&#x6027;&#x8D28;">1.&#x8FED;&#x4EE3;&#x5668;&#x7684;&#x529F;&#x80FD;&#x4E0E;&#x6027;&#x8D28;</h3>
<p>&#x2003;&#x2003;<span class="math inline">\(python\)</span>&#x8FED;&#x4EE3;&#x5668;&#x5305;&#x542B;<code>__next__</code>&#x4FE1;&#x606F;&#xFF1A;&#x8BE2;&#x95EE;&#x8FED;&#x4EE3;&#x5668;&#x5E8F;&#x5217;&#x7684;&#x4E0B;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x662F;&#x4EC0;&#x4E48;&#x3002;&#x5BF9;<code>__next__</code>&#x7684;&#x8C03;&#x7528;<strong>&#x4F1A;&#x5BFC;&#x81F4;&#x8FED;&#x4EE3;&#x5668;&#x7684;&#x6539;&#x53D8;</strong>&#xFF1A;&#x5B83;<strong>&#x66F4;&#x65B0;&#x5F53;&#x524D;&#x8FED;&#x4EE3;&#x5668;&#x7684;&#x4F4D;&#x7F6E;</strong>&#x3002;<span class="math inline">\(python\)</span>&#x5728;&#x8FED;&#x4EE3;&#x5668;&#x5230;&#x8FBE;&#x5E8F;&#x5217;&#x672B;&#x7AEF;&#x65F6;&#x4F1A;&#x4EA7;&#x751F;<code>StopIteration</code>&#x7684;&#x5F02;&#x5E38;(<span class="math inline">\(exception\)</span>)&#x3002;</p>
<p>&#x2003;&#x2003;&#x4E0B;&#x9762;&#x7684;$ LetterIter$&#x8FED;&#x4EE3;&#x4E86;&#x4E00;&#x7CFB;&#x5217;&#x5B57;&#x6BCD;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LetterIter</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;An iterator over letters of the alphabet in ASCII order.&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, start=<span class="string">&apos;a&apos;</span>, end=<span class="string">&apos;e&apos;</span></span>):</span><br><span class="line">            self.next_letter = start</span><br><span class="line">            self.end = end</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__next__</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="keyword">if</span> self.next_letter == self.end:</span><br><span class="line">                <span class="keyword">raise</span> StopIteration</span><br><span class="line">            letter = self.next_letter</span><br><span class="line">            self.next_letter = <span class="built_in">chr</span>(<span class="built_in">ord</span>(letter)+<span class="number">1</span>)<span class="comment">#iterate to the next number</span></span><br><span class="line">            <span class="keyword">return</span> letter</span><br></pre></td></tr></table></figure>
&#x2003;&#x2003;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;&#x7C7B;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;<code>__next__</code>&#x65B9;&#x6CD5;&#x6216;<code>next</code>&#x51FD;&#x6570;&#x6765;&#x8BBF;&#x95EE;&#x5B57;&#x6BCD;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>letter_iter = LetterIter()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>letter_iter.__next__()</span><br><span class="line"><span class="string">&apos;a&apos;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>letter_iter.__next__()</span><br><span class="line"><span class="string">&apos;b&apos;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(letter_iter)</span><br><span class="line"><span class="string">&apos;c&apos;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>letter_iter.__next__()</span><br><span class="line"><span class="string">&apos;d&apos;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>letter_iter.__next__()</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">12</span>, <span class="keyword">in</span> <span class="built_in">next</span></span><br><span class="line">StopIteration</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FED;&#x4EE3;&#x5668;&#x662F;<strong>&#x53EF;&#x6539;&#x53D8;&#x7684;(<span class="math inline">\(mutable\)</span>)</strong>&#x3002;&#x5F53;&#x8FED;&#x4EE3;&#x5668;&#x5230;&#x8FBE;&#x5E8F;&#x5217;&#x7684;&#x672B;&#x5C3E;&#x65F6;&#xFF0C;&#x5B83;&#x5C31;&#x88AB;&#x8017;&#x5C3D;&#x4E86;&#x3002;<span class="math inline">\(LetterIter\)</span><strong>&#x53EA;&#x80FD;&#x88AB;&#x8FED;&#x4EE3;&#x4E00;&#x6B21;&#xFF0C;&#x5F53;&#x5B83;&#x7684;<code>__next__</code>&#x65B9;&#x6CD5;&#x4EA7;&#x751F;<code>StopIteration</code>&#x7684;&#x5F02;&#x5E38;&#x540E;&#xFF0C;&#x4ECE;&#x8FD9;&#x4EE5;&#x540E;&#x7684;&#x6240;&#x6709;&#x8FED;&#x4EE3;&#x90FD;&#x4F1A;&#x4EA7;&#x751F;&#x8FD9;&#x4E2A;&#x5F02;&#x5E38;</strong>&#x3002;&#x4E00;&#x822C;&#x5730;&#xFF0C;<strong>&#x8FED;&#x4EE3;&#x5668;&#x4E0D;&#x4F1A;&#x91CD;&#x7F6E;</strong>&#x3002;<strong>&#x5F53;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x5B9E;&#x4F8B;&#x88AB;&#x521B;&#x5EFA;&#x65F6;&#xFF0C;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x8FED;&#x4EE3;&#x5668;&#x4E5F;&#x88AB;&#x521B;&#x5EFA;&#x4E86;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x8FED;&#x4EE3;&#x5668;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5B9E;&#x73B0;<strong>&#x4E00;&#x4E2A;&#x4E0D;&#x4EA7;&#x751F;&#x5F02;&#x5E38;&#x7684;<code>__next__</code>&#x65B9;&#x6CD5;</strong>&#x6765;&#x8868;&#x793A;&#x65E0;&#x9650;&#x5E8F;&#x5217;&#xFF0C;&#x4F8B;&#x5982;&#x4E0B;&#x9762;&#x8868;&#x793A;&#x6B63;&#x6574;&#x6570;&#x5E8F;&#x5217;&#x7684;&#x8FED;&#x4EE3;&#x5668;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Positives</span>:</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">            self.next_positive = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__next__</span>(<span class="params">self</span>):</span><br><span class="line">            result = self.next_positive</span><br><span class="line">            self.next_positive += <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p = Positives()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(p)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(p)</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(p)</span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure></p>
<h3 id="2&#x53EF;&#x8FED;&#x4EE3;&#x6027;">2.&#x53EF;&#x8FED;&#x4EE3;&#x6027;</h3>
<p>&#x2003;&#x2003;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;<strong>&#x662F;&#x53EF;&#x8FED;&#x4EE3;&#x7684;(<span class="math inline">\(iterable\)</span>)&#xFF0C;&#x5F53;&#x5B83;&#x7684;<code>iter</code>&#x65B9;&#x6CD5;&#x88AB;&#x8C03;&#x7528;</strong>&#x3002;&#x53EF;&#x8FED;&#x4EE3;&#x503C;&#x4EE3;&#x8868;&#x6570;&#x636E;&#x96C6;&#x5408;&#xFF0C;&#x5E76;&#x4E14;&#x5B83;&#x4EEC;&#x63D0;&#x4F9B;&#x4E86;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x8FED;&#x4EE3;&#x5668;&#x7684;&#x56FA;&#x5B9A;&#x8868;&#x8FBE;&#x3002;</p>
<p>&#x2003;&#x2003;&#x4EE5;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x4EE3;&#x8868;&#x4E00;&#x7CFB;&#x5217;&#x6709;&#x5E8F;&#x5B57;&#x6BCD;&#x5E8F;&#x5217;&#x7684;&#x7C7B;&#x4E3A;&#x4F8B;&#x3002;&#x6BCF;&#x6B21;&#x5F53;&#x5176;<code>__iter__</code>&#x65B9;&#x6CD5;&#x88AB;&#x8C03;&#x7528;&#xFF0C;<strong>&#x4E00;&#x4E2A;&#x65B0;&#x7684;<span class="math inline">\(LetterIter\)</span>&#x5B9E;&#x4F8B;&#x5C31;&#x88AB;&#x521B;&#x5EFA;&#xFF0C;&#x8FD9;&#x5141;&#x8BB8;&#x4E86;&#x5BF9;&#x5E8F;&#x5217;&#x5185;&#x5BB9;&#x7684;&#x6709;&#x5E8F;&#x8BBF;&#x95EE;</strong>&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Letters</span>:</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, start=<span class="string">&apos;a&apos;</span>, end=<span class="string">&apos;e&apos;</span></span>):</span><br><span class="line">            self.start = start</span><br><span class="line">            self.end = end</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="keyword">return</span> LetterIter(self.start, self.end)</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5728;&#x4E0B;&#x9762;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#xFF0C;&#x4E24;&#x4E2A;&#x6E90;&#x81EA;&#x540C;&#x4E00;&#x4E2A;&#x53EF;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;&#x7684;&#x8FED;&#x4EE3;&#x5668;<strong>&#x72EC;&#x7ACB;&#x5730;</strong>&#x4EA7;&#x751F;&#x5404;&#x81EA;&#x7684;&#x5355;&#x8BCD;&#x5E8F;&#x5217;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>b_to_k = Letters(<span class="string">&apos;b&apos;</span>, <span class="string">&apos;k&apos;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>first_iterator = b_to_k.__iter__()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(first_iterator)</span><br><span class="line"><span class="string">&apos;b&apos;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(first_iterator)</span><br><span class="line"><span class="string">&apos;c&apos;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>second_iterator = <span class="built_in">iter</span>(b_to_k)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>second_iterator.__next__()</span><br><span class="line"><span class="string">&apos;b&apos;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>first_iterator.__next__()</span><br><span class="line"><span class="string">&apos;d&apos;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>first_iterator.__next__()</span><br><span class="line"><span class="string">&apos;e&apos;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>second_iterator.__next__()</span><br><span class="line"><span class="string">&apos;c&apos;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>second_iterator.__next__()</span><br><span class="line"><span class="string">&apos;d&apos;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="3for&#x8BED;&#x53E5;">3.<span class="math inline">\(for\)</span>&#x8BED;&#x53E5;</h3>
<p>&#x2003;&#x2003;<span class="math inline">\(for\)</span>&#x8BED;&#x53E5;&#x5BF9;&#x8FED;&#x4EE3;&#x5668;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x3002;&#x53EF;&#x8FED;&#x4EE3;&#x5BF9;&#x8C61;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;<span class="math inline">\(for\)</span>&#x8BED;&#x53E5;<code>&lt;expression&gt;</code>&#x7ED3;&#x6784;&#x7684;&#x503C;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> &lt;name&gt; <span class="keyword">in</span> &lt;expression&gt;:</span><br><span class="line">    &lt;suite&gt;</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x4E3A;&#x4E86;&#x6267;&#x884C;<span class="math inline">\(for\)</span>&#x8BED;&#x53E5;&#xFF0C;<span class="math inline">\(python\)</span>&#x4F1A;<strong>&#x8BA1;&#x7B97;<code>&lt;expression&gt;</code>&#xFF0C;&#x5B83;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x53EF;&#x8FED;&#x4EE3;&#x7684;&#x503C;</strong>&#x3002;&#x7136;&#x540E;&#xFF0C;<strong><code>__iter__</code>&#x65B9;&#x6CD5;&#x5728;&#x8BE5;&#x503C;&#x4E0A;&#x8C03;&#x7528;</strong>&#xFF0C;&#x76F4;&#x5230;&#x5F02;&#x5E38;&#x88AB;&#x63D0;&#x51FA;&#x3002;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;<span class="math inline">\(python\)</span><strong>&#x5C06;&#x8FED;&#x4EE3;&#x5668;&#x4EA7;&#x751F;&#x7684;&#x7ED3;&#x679C;&#x4E0E;<code>&lt;name&gt;</code>&#x7ED1;&#x5B9A;&#xFF0C;&#x7136;&#x540E;&#x6267;&#x884C;<code>&lt;suite&gt;</code></strong>&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>counts = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> item <span class="keyword">in</span> counts:</span><br><span class="line">        <span class="built_in">print</span>(item)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x901A;&#x8FC7;&#x5148;&#x524D;&#x5BF9;&#x8FED;&#x4EE3;&#x5668;&#x7684;&#x8BB2;&#x89E3;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;<span class="math inline">\(while\)</span>&#x8BED;&#x53E5;&#x5B9E;&#x73B0;&#x8BE5;<span class="math inline">\(for\)</span>&#x8BED;&#x53E5;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">items = counts.__iter__()</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        item = items.__next__()</span><br><span class="line">        <span class="built_in">print</span>(item)</span><br><span class="line"><span class="keyword">except</span> StopIteration:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure></p>
<h2 id="&#x4E09;-&#x751F;&#x6210;&#x5668;&#x4E0E;yield&#x8BED;&#x53E5;">&#x4E09;&#x3001;&#x751F;&#x6210;&#x5668;&#x4E0E;<code>yield</code>&#x8BED;&#x53E5;</h2>
<h3 id="1&#x5F15;&#x5165;">1.&#x5F15;&#x5165;</h3>
<p>&#x2003;&#x2003;&#x5F53;&#x6211;&#x4EEC;&#x5728;&#x5904;&#x7406;&#x590D;&#x6742;&#x5E8F;&#x5217;&#x3001;&#x5E76;&#x4E14;&#x9700;&#x8981;&#x5728;&#x8BA1;&#x7B97;&#x8FC7;&#x7A0B;&#x4E2D;&#x4FDD;&#x5B58;<code>__next__</code>&#x7684;&#x4F4D;&#x7F6E;&#x65F6;&#xFF0C;&#x5355;&#x72EC;&#x4F9D;&#x9760;&#x8FED;&#x4EE3;&#x5668;&#x663E;&#x5F97;&#x96BE;&#x4EE5;&#x4E3A;&#x7EE7;&#x3002;&#x751F;&#x6210;&#x5668;(<span class="math inline">\(genarator\)</span>)&#x5141;&#x8BB8;&#x6211;&#x4EEC;&#x5229;&#x7528;<span class="math inline">\(python\)</span>&#x7684;&#x7279;&#x6027;&#x5B9A;&#x4E49;&#x66F4;&#x4E3A;&#x590D;&#x6742;&#x7684;&#x8FED;&#x4EE3;&#x5668;&#x3002;</p>
<h3 id="2&#x751F;&#x6210;&#x5668;&#x4E0E;yield&#x8BED;&#x53E5;&#x7684;&#x58F0;&#x660E;&#x4E0E;&#x6267;&#x884C;">2.&#x751F;&#x6210;&#x5668;&#x4E0E;<code>yield</code>&#x8BED;&#x53E5;&#x7684;&#x58F0;&#x660E;&#x4E0E;&#x6267;&#x884C;</h3>
<p>&#x2003;&#x2003;&#x751F;&#x6210;&#x5668;&#x662F;&#x7531;&#x88AB;&#x79F0;&#x4E3A;&#x751F;&#x6210;&#x5668;&#x51FD;&#x6570;(<span class="math inline">\(genarator\;function\)</span>)&#x7684;&#x7279;&#x6B8A;&#x7C7B;&#x51FD;&#x6570;(<span class="math inline">\(class\;of\;function\)</span>)&#x8FD4;&#x56DE;&#x7684;&#x8FED;&#x4EE3;&#x5668;&#x3002;&#x751F;&#x6210;&#x5668;&#x51FD;&#x6570;&#x4E0E;&#x4E00;&#x822C;&#x51FD;&#x6570;&#x7684;&#x533A;&#x522B;&#x5728;&#x4E8E;&#xFF1A;&#x751F;&#x6210;&#x5668;&#x51FD;&#x6570;<strong>&#x901A;&#x8FC7;<code>yield</code>&#x8BED;&#x53E5;&#x8FD4;&#x56DE;&#x5143;&#x7D20;&#x800C;&#x4E0D;&#x662F;<code>return</code>&#x8BED;&#x53E5;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x751F;&#x6210;&#x5668;&#x5E76;&#x4E0D;&#x7528;&#x5BF9;&#x8C61;&#x7684;&#x5C5E;&#x6027;&#x6765;&#x8DDF;&#x8E2A;&#x5E8F;&#x5217;&#x7684;&#x8FC7;&#x7A0B;&#x3002;&#x76F8;&#x53CD;&#xFF0C;&#x4ED6;<strong>&#x63A7;&#x5236;&#x751F;&#x6210;&#x5668;&#x51FD;&#x6570;&#x7684;&#x6267;&#x884C;&#x8FC7;&#x7A0B;</strong>&#xFF0C;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x4F1A;<strong>&#x5728;&#x751F;&#x6210;&#x5668;&#x8C03;&#x7528;<code>__next__</code>&#x65B9;&#x6CD5;&#x540E;&#x4E00;&#x76F4;&#x8FD0;&#x884C;&#x76F4;&#x5230;&#x4E0B;&#x4E2A;<code>yield</code>&#x88AB;&#x6267;&#x884C;</strong>&#x3002;<span class="math inline">\(Letter\)</span>&#x8FED;&#x4EE3;&#x5668;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x751F;&#x6210;&#x5668;&#x66F4;&#x52A0;&#x7D27;&#x51D1;&#x5730;&#x5B9E;&#x73B0;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">letters_generator</span>():</span><br><span class="line">        current = <span class="string">&apos;a&apos;</span></span><br><span class="line">        <span class="keyword">while</span> current &lt;= <span class="string">&apos;d&apos;</span>:</span><br><span class="line">            <span class="keyword">yield</span> current</span><br><span class="line">            current = <span class="built_in">chr</span>(<span class="built_in">ord</span>(current)+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> letter <span class="keyword">in</span> letters_generator():</span><br><span class="line">        <span class="built_in">print</span>(letter)</span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line">c</span><br><span class="line">d</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5C3D;&#x7BA1;&#x6211;&#x4EEC;&#x6CA1;&#x6709;&#x76F4;&#x63A5;&#x5730;&#x5B9A;&#x4E49;<code>__iter__</code>&#x4E0E;<code>__next__</code>&#x65B9;&#x6CD5;&#xFF0C;&#x7A0B;&#x5E8F;&#x4E2D;&#x7684;<code>yield</code>&#x8BED;&#x53E5;&#x8868;&#x660E;&#x6211;&#x4EEC;&#x5728;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x751F;&#x6210;&#x5668;&#x51FD;&#x6570;&#x3002;<strong>&#x5F53;&#x88AB;&#x8C03;&#x7528;&#xFF0C;&#x751F;&#x6210;&#x5668;&#x51FD;&#x6570;&#x4E0D;&#x4F1A;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x7279;&#x5B9A;&#x7684;&#x751F;&#x6210;&#x503C;(<span class="math inline">\(yielded\;value\)</span>)&#xFF0C;&#x800C;&#x662F;&#x4E00;&#x4E2A;&#x751F;&#x6210;&#x5668;(&#x8FED;&#x4EE3;&#x5668;&#x7684;&#x4E00;&#x79CD;)&#xFF0C;&#x751F;&#x6210;&#x5668;&#x81EA;&#x5DF1;&#x4F1A;&#x8FD4;&#x56DE;&#x751F;&#x6210;&#x503C;</strong>&#x3002;&#x751F;&#x6210;&#x5668;&#x5BF9;&#x8C61;&#x6709;<code>__iter__</code>&#x548C;<code>__next__</code>&#x65B9;&#x6CD5;&#x3002;</p>
<p>&#x2003;&#x2003;&#x7B2C;&#x4E00;&#x6B21;<code>__next__</code>&#x88AB;&#x8C03;&#x7528;&#x65F6;&#xFF0C;&#x7A0B;&#x5E8F;&#x6267;&#x884C;<code>&lt;body&gt;</code>&#x5185;&#x8BED;&#x53E5;&#xFF0C;&#x5373;<code>letters_generator</code>&#xFF0C;&#x76F4;&#x5230;<strong>&#x9047;&#x5230;<code>yield</code>&#x8BED;&#x53E5;&#x3002;&#x7136;&#x540E;&#xFF0C;&#x5B83;&#x6682;&#x505C;&#x6267;&#x884C;&#x5E76;&#x8FD4;&#x56DE;<span class="math inline">\(current\)</span>&#x7684;&#x503C;</strong>&#x3002;<code>yield</code>&#x8BED;&#x53E5;&#x5E76;&#x4E0D;&#x4F1A;&#x7834;&#x574F;&#x65B0;&#x521B;&#x5EFA;&#x7684;&#x73AF;&#x5883;&#xFF0C;<strong>&#x5B83;&#x4F1A;&#x4FDD;&#x5B58;&#x8FD9;&#x4E2A;&#x73AF;&#x5883;&#x7559;&#x7740;&#x4E4B;&#x540E;&#x8BA1;&#x7B97;&#x4F7F;&#x7528;</strong>&#x3002;<strong>&#x5F53;<code>__next__</code>&#x88AB;&#x518D;&#x6B21;&#x8C03;&#x7528;&#x65F6;&#xFF0C;&#x7A0B;&#x5E8F;&#x4ECE;&#x4E4B;&#x524D;&#x505C;&#x4E0B;&#x6765;&#x7684;&#x5730;&#x65B9;&#x5F00;&#x59CB;&#x6267;&#x884C;</strong>&#x3002;&#x5728;&#x5BF9;<code>__next__</code>&#x7684;&#x540E;&#x7EED;&#x8C03;&#x7528;&#x4E2D;&#xFF0C;<code>letters_generator</code>&#x4F5C;&#x7528;&#x57DF;&#x4E2D;&#x7684;<span class="math inline">\(current\)</span>&#x503C;&#x548C;&#x5176;&#x4ED6;&#x7ED1;&#x5B9A;&#x540D;&#x79F0;&#x88AB;&#x4FDD;&#x5B58;&#x4E0B;&#x6765;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>letters = letters_generator()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(letters)</span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">&apos;generator&apos;</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>letters.__next__()</span><br><span class="line"><span class="string">&apos;a&apos;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>letters.__next__()</span><br><span class="line"><span class="string">&apos;b&apos;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>letters.__next__()</span><br><span class="line"><span class="string">&apos;c&apos;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>letters.__next__()</span><br><span class="line"><span class="string">&apos;d&apos;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>letters.__next__()</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">StopIteration</span><br></pre></td></tr></table></figure></p>
<h3 id="3&#x5229;&#x7528;yield&#x8BED;&#x53E5;&#x521B;&#x5EFA;&#x53EF;&#x8FED;&#x4EE3;&#x5BF9;&#x8C61;">3.&#x5229;&#x7528;<code>yield</code>&#x8BED;&#x53E5;&#x521B;&#x5EFA;&#x53EF;&#x8FED;&#x4EE3;&#x5BF9;&#x8C61;</h3>
<p>&#x2003;&#x2003;&#x5728;<span class="math inline">\(python\)</span>&#x4E2D;&#xFF0C;&#x8FED;&#x4EE3;&#x5668;&#x53EA;&#x4F1A;&#x5BF9;&#x5E95;&#x5C42;&#x5E8F;&#x5217;&#x7684;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x4E00;&#x6B21;&#x4F20;&#x9012;&#xFF0C;<strong>&#x5F53;&#x8FD9;&#x6B21;&#x4F20;&#x9012;&#x7ED3;&#x675F;&#x540E;&#xFF0C;&#x518D;&#x6B21;&#x8C03;&#x7528;<code>__next__</code>&#x65B9;&#x6CD5;&#xFF0C;&#x8FED;&#x4EE3;&#x5668;&#x5C06;&#x4E00;&#x76F4;&#x4EA7;&#x751F;<code>StopIteration</code>&#x5F02;&#x5E38;</strong>&#x3002;&#x800C;&#x8BB8;&#x591A;&#x7A0B;&#x5E8F;&#x9700;&#x8981;<strong>&#x591A;&#x6B21;&#x8FED;&#x4EE3;</strong>&#x5143;&#x7D20;&#xFF0C;&#x4F8B;&#x5982;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x679A;&#x4E3E;&#x4E00;&#x4E2A;&#x5217;&#x8868;&#x7684;&#x6240;&#x6709;<span class="math inline">\(pair\)</span>&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">all_pairs</span>(<span class="params">s</span>):</span><br><span class="line">        <span class="keyword">for</span> item1 <span class="keyword">in</span> s:</span><br><span class="line">            <span class="keyword">for</span> item2 <span class="keyword">in</span> s:</span><br><span class="line">                <span class="keyword">yield</span> (item1, item2)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>(all_pairs([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]))</span><br><span class="line">[(<span class="number">1</span>, <span class="number">1</span>), (<span class="number">1</span>, <span class="number">2</span>), (<span class="number">1</span>, <span class="number">3</span>), (<span class="number">2</span>, <span class="number">1</span>), (<span class="number">2</span>, <span class="number">2</span>), (<span class="number">2</span>, <span class="number">3</span>), (<span class="number">3</span>, <span class="number">1</span>), (<span class="number">3</span>, <span class="number">2</span>), (<span class="number">3</span>, <span class="number">3</span>)]</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5E8F;&#x5217;&#x672C;&#x8EAB;<strong>&#x4E0D;&#x662F;&#x8FED;&#x4EE3;&#x5668;&#xFF0C;&#x800C;&#x662F;&#x53EF;&#x8FED;&#x4EE3;&#x5BF9;&#x8C61;</strong>&#x3002;&#x5F53;<strong>&#x5E8F;&#x5217;&#x7684;<code>__iter__</code>&#x65B9;&#x6CD5;&#x88AB;&#x8C03;&#x7528;&#x540E;&#xFF0C;&#x5E8F;&#x5217;&#x4F1A;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x8FED;&#x4EE3;&#x5668;&#x5B9E;&#x4F8B;</strong>&#x3002;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x53EF;&#x8FED;&#x4EE3;&#x5BF9;&#x8C61;<strong>&#x5728;&#x6BCF;&#x6B21;&#x8C03;&#x7528;<code>__iter__</code>&#x540E;&#x90FD;&#x4F1A;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x65B0;&#x7684;&#x8FED;&#x4EE3;&#x5668;&#x5B9E;&#x4F8B;&#xFF0C;&#x5B83;&#x5C31;&#x53EF;&#x4EE5;&#x88AB;&#x591A;&#x6B21;&#x8FED;&#x4EE3;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x53EF;&#x8FED;&#x4EE3;&#x63A5;&#x53E3;&#x6765;&#x5B9A;&#x4E49;&#x65B0;&#x7684;&#x53EF;&#x8FED;&#x4EE3;&#x7C7B;&#xFF0C;&#x4F8B;&#x5982;&#x4E0B;&#x9762;<span class="math inline">\(LettersWithYield\)</span>&#x7C7B;&#x5C31;&#x5728;&#x6BCF;&#x6B21;&#x8C03;&#x7528;<code>__iter__</code>&#x540E;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x8FED;&#x4EE3;&#x5668;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#create an iterable object</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LettersWithYield</span>:</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, start=<span class="string">&apos;a&apos;</span>, end=<span class="string">&apos;e&apos;</span></span>):</span><br><span class="line">            self.start = start</span><br><span class="line">            self.end = end</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">            next_letter = self.start</span><br><span class="line">            <span class="keyword">while</span> next_letter &lt; self.end:</span><br><span class="line">                <span class="keyword">yield</span> next_letter</span><br><span class="line">                next_letter = <span class="built_in">chr</span>(<span class="built_in">ord</span>(next_letter)+<span class="number">1</span>)</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8BE5;&#x7C7B;&#x7684;<code>__iter__</code>&#x65B9;&#x6CD5;&#x662F;&#x4E00;&#x4E2A;&#x751F;&#x6210;&#x5668;&#x51FD;&#x6570;&#xFF0C;&#x5B83;<strong>&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x751F;&#x6210;&#x5668;&#x5BF9;&#x8C61;&#xFF0C;&#x8FD9;&#x4E2A;&#x751F;&#x6210;&#x5668;&#x5BF9;&#x8C61;&#x751F;&#x6210;&#x4ECE;<code>a</code>&#x5230;<code>d</code>&#x7684;&#x5E8F;&#x5217;&#x540E;&#x505C;&#x4E0B;</strong>&#x3002;&#x6BCF;&#x6B21;&#x6211;&#x4EEC;&#x8C03;&#x7528;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x751F;&#x6210;&#x5668;&#x4F1A;&#x5F00;&#x59CB;&#x5BF9;&#x5E8F;&#x5217;&#x578B;&#x6570;&#x636E;&#x7684;&#x65B0;&#x7684;&#x4F20;&#x9012;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>letters = LettersWithYield()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>(all_pairs(letters))[:<span class="number">5</span>]</span><br><span class="line">[(<span class="string">&apos;a&apos;</span>, <span class="string">&apos;a&apos;</span>), (<span class="string">&apos;a&apos;</span>, <span class="string">&apos;b&apos;</span>), (<span class="string">&apos;a&apos;</span>, <span class="string">&apos;c&apos;</span>), (<span class="string">&apos;a&apos;</span>, <span class="string">&apos;d&apos;</span>), (<span class="string">&apos;b&apos;</span>, <span class="string">&apos;a&apos;</span>)]</span><br></pre></td></tr></table></figure></p>
<h2 id="&#x56DB;-&#x6D41;">&#x56DB;&#x3001;&#x6D41;</h2>
<h3 id="1&#x6D41;&#x7684;&#x6982;&#x5FF5;">1.&#x6D41;&#x7684;&#x6982;&#x5FF5;</h3>
<p>&#x2003;&#x2003;&#x6D41;(<span class="math inline">\(stream\)</span>)&#x63D0;&#x4F9B;&#x4E86;&#x9690;&#x6027;&#x8868;&#x793A;&#x5E8F;&#x5217;&#x578B;&#x6570;&#x636E;&#x7684;&#x53E6;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#x3002;&#x6D41;&#x662F;<strong>&#x61D2;&#x60F0;&#x8BA1;&#x7B97;&#x7684;&#x9012;&#x5F52;&#x5217;&#x8868;(<span class="math inline">\(recusive\;list\)</span>)</strong>&#xFF0C;&#x4E0E;&#x94FE;&#x8868;&#x7ED3;&#x6784;&#x7C7B;&#x4F3C;&#x3002;&#x4F46;&#x4E0E;&#x94FE;&#x8868;&#x4E0D;&#x540C;&#xFF0C;<strong>&#x6D41;&#x7684;<span class="math inline">\(rest\)</span>&#x90E8;&#x5206;&#x53EA;&#x6709;&#x5728;&#x88AB;&#x8C03;&#x7528;&#x7684;&#x65F6;&#x5019;&#x624D;&#x4F1A;&#x88AB;&#x8BA1;&#x7B97;</strong>&#x3002;</p>
<h3 id="2&#x6D41;&#x7684;&#x5B9E;&#x73B0;&#x4E0E;&#x8C03;&#x7528;">2.&#x6D41;&#x7684;&#x5B9E;&#x73B0;&#x4E0E;&#x8C03;&#x7528;</h3>
<p>&#x2003;&#x2003;&#x4E3A;&#x4E86;&#x5B9E;&#x73B0;&#x61D2;&#x60F0;&#x8BA1;&#x7B97;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x6D41;&#x4F1A;<strong>&#x5B58;&#x50A8;&#x4E00;&#x4E2A;&#x8BA1;&#x7B97;<span class="math inline">\(rest\)</span>&#x90E8;&#x5206;&#x7684;&#x51FD;&#x6570;</strong>&#x3002;&#x5F53;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x88AB;&#x8C03;&#x7528;&#x65F6;&#xFF0C;<strong>&#x5B83;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x4F5C;&#x4E3A;&#x6D41;&#x7684;&#x5C5E;&#x6027;<code>_rest</code>&#x5B58;&#x50A8;&#x5728;&#x6D41;&#x7684;&#x4E00;&#x90E8;&#x5206;</strong>&#xFF0C;&#x540D;&#x79F0;&#x524D;&#x9762;&#x7684;&#x4E0B;&#x5212;&#x7EBF;&#x8BF4;&#x660E;<strong>&#x5B83;&#x4E0D;&#x5E94;&#x8BE5;&#x88AB;&#x76F4;&#x63A5;&#x8BBF;&#x95EE;</strong>&#x3002;&#x800C;<strong>&#x53EF;&#x8BBF;&#x95EE;&#x7684;<code>rest</code>&#x5C5E;&#x6027;&#x662F;&#x4E00;&#x4E2A;&#x8FD4;&#x56DE;&#x6D41;&#x7684;<span class="math inline">\(rest\)</span>&#x90E8;&#x5206;&#x7684;&#x5C5E;&#x6027;&#x65B9;&#x6CD5;</strong>&#x3002;&#x6D41;&#x7684;&#x57FA;&#x672C;&#x8BBE;&#x8BA1;&#x5982;&#x4E0B;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Stream</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;A lazily computed recursive list.&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">empty</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">            <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&apos;Stream.empty&apos;</span></span><br><span class="line">        empty = empty()</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, first, compute_rest=<span class="keyword">lambda</span>: empty</span>):</span><br><span class="line">            <span class="keyword">assert</span> <span class="built_in">callable</span>(compute_rest), <span class="string">&apos;compute_rest must be callable.&apos;</span></span><br><span class="line">            self.first = first</span><br><span class="line">            self._compute_rest = compute_rest</span><br><span class="line"><span class="meta">        @property</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">rest</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="string">&quot;&quot;&quot;Return the rest of the stream, computing it if necessary.&quot;&quot;&quot;</span></span><br><span class="line">            <span class="keyword">if</span> self._compute_rest <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                self._rest = self._compute_rest()</span><br><span class="line">                self._compute_rest = <span class="literal">None</span></span><br><span class="line">            <span class="keyword">return</span> self._rest</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&apos;Stream({0}, &lt;...&gt;)&apos;</span>.<span class="built_in">format</span>(<span class="built_in">repr</span>(self.first))</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x6D41;&#x53EF;&#x4EE5;&#x50CF;&#x94FE;&#x8868;&#x4E00;&#x6837;&#x5229;&#x7528;&#x5D4C;&#x5957;&#x8868;&#x8FBE;&#x5F0F;&#x521B;&#x5EFA;&#x3002;&#x4E3A;&#x4E86;&#x5B9E;&#x73B0;&#x61D2;&#x60F0;&#x8BA1;&#x7B97;&#xFF0C;&#x6211;&#x4EEC;&#x91C7;&#x7528;&#x533F;&#x540D;&#x51FD;&#x6570;&#x7684;&#x65B9;&#x6CD5;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s = Stream(<span class="number">1</span>, <span class="keyword">lambda</span>: Stream(<span class="number">2</span>+<span class="number">3</span>, <span class="keyword">lambda</span>: Stream(<span class="number">9</span>)))</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x91CC;&#x7684;<span class="math inline">\(lambda\)</span>&#x8868;&#x8FBE;&#x5F0F;&#x8FD4;&#x56DE;<strong>&#x8BA1;&#x7B97;&#x6D41;&#x5269;&#x4F59;&#x90E8;&#x5206;&#x7684;&#x65B9;&#x6CD5;</strong>&#x3002;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E0B;&#x9762;&#x7684;&#x64CD;&#x4F5C;&#x8BBF;&#x95EE;&#x6D41;&#x4E2D;&#x7684;&#x5143;&#x7D20;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>r.first</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.first</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r.rest.first</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.rest.first</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r.rest</span><br><span class="line">Rlist(<span class="number">5</span>, Rlist(<span class="number">9</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.rest</span><br><span class="line">Stream(<span class="number">5</span>, &lt;...&gt;)</span><br><span class="line"><span class="comment">#the fact that it will return the empty stream are undiscovered</span></span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5F53;&#x4E00;&#x4E2A;<span class="math inline">\(stream\)</span>&#x5B9E;&#x4F8B;&#x88AB;&#x521B;&#x5EFA;&#x65F6;&#xFF0C;<code>self._rest</code>&#x662F;<span class="math inline">\(None\)</span>&#xFF0C;&#x8FD9;&#x8868;&#x660E;&#x5B9E;&#x4F8B;&#x7684;<span class="math inline">\(rest\)</span>&#x90E8;&#x5206;&#x5C1A;&#x672A;&#x88AB;&#x8BA1;&#x7B97;&#xFF1B;<strong>&#x5F53;<code>rest</code>&#x5C5E;&#x6027;&#x901A;&#x8FC7;&#x70B9;&#x8868;&#x8FBE;&#x5F0F;&#x88AB;&#x8BBF;&#x95EE;&#x540E;&#xFF0C;<code>rest</code>&#x7684;&#x5C5E;&#x6027;&#x65B9;&#x6CD5;&#x88AB;&#x8C03;&#x7528;&#xFF0C;&#x89E6;&#x53D1;&#x4E86;<code>self._rest = self._compute_rest()</code>&#x7684;&#x8BA1;&#x7B97;</strong>&#x3002;</p>
<p>&#x2003;&#x2003;<code>compute_rest</code>&#x51FD;&#x6570;&#x7684;&#x5173;&#x952E;&#x5C5E;&#x6027;&#x662F;&#xFF1A;&#x5B83;<strong>&#x4E0D;&#x63A5;&#x53D7;&#x53C2;&#x6570;&#xFF0C;&#x5E76;&#x4E14;&#x8FD4;&#x56DE;<span class="math inline">\(stream\)</span>&#x6216;<span class="math inline">\(stream.empty\)</span></strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x61D2;&#x60F0;&#x8BA1;&#x7B97;&#x5141;&#x8BB8;&#x6211;&#x4EEC;&#x7528;&#x6D41;&#x8868;&#x793A;&#x65E0;&#x9650;&#x7684;&#x5E8F;&#x5217;&#x578B;&#x6570;&#x636E;&#x96C6;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x4EE5;&#x4E0B;&#x8BED;&#x53E5;&#x8868;&#x793A;&#x6B63;&#x6574;&#x6570;&#x96C6;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">integer_stream</span>(<span class="params">first</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">compute_rest</span>():</span><br><span class="line">        <span class="keyword">return</span> integer_stream(first+<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> Stream(first, compute_rest)</span><br></pre></td></tr></table></figure> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>positives = integer_stream(<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>positives</span><br><span class="line">Stream(<span class="number">1</span>, &lt;...&gt;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>positives.first</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<h3 id="3&#x5229;&#x7528;&#x6D41;&#x5B9E;&#x73B0;&#x5E8F;&#x5217;&#x57FA;&#x672C;&#x64CD;&#x4F5C;">3.&#x5229;&#x7528;&#x6D41;&#x5B9E;&#x73B0;&#x5E8F;&#x5217;&#x57FA;&#x672C;&#x64CD;&#x4F5C;</h3>
<p>&#x2003;&#x2003;&#x4E0A;&#x8FF0;<strong>&#x5229;&#x7528;&#x9AD8;&#x9636;&#x51FD;&#x6570;&#x6539;&#x53D8;<span class="math inline">\(compute_rest\)</span>&#x51FD;&#x6570;</strong>&#x7684;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x5176;&#x4ED6;&#x5E8F;&#x5217;&#x64CD;&#x4F5C;&#xFF1A;</p>
<h4 id="amap&#x6620;&#x5C04;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span><span class="math inline">\(map\)</span>&#x6620;&#x5C04;</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">map_stream</span>(<span class="params">fn, s</span>):</span><br><span class="line">        <span class="keyword">if</span> s <span class="keyword">is</span> Stream.empty:</span><br><span class="line">            <span class="keyword">return</span> s</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">compute_rest</span>():</span><br><span class="line">            <span class="keyword">return</span> map_stream(fn, s.rest)</span><br><span class="line">        <span class="keyword">return</span> Stream(fn(s.first), compute_rest)</span><br></pre></td></tr></table></figure>
<h4 id="b&#x7B5B;&#x9009;&#x6307;&#x5B9A;&#x5143;&#x7D20;">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>&#x7B5B;&#x9009;&#x6307;&#x5B9A;&#x5143;&#x7D20;</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">filter_stream</span>(<span class="params">fn, s</span>):</span><br><span class="line">        <span class="keyword">if</span> s <span class="keyword">is</span> Stream.empty:</span><br><span class="line">            <span class="keyword">return</span> s</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">compute_rest</span>():</span><br><span class="line">            <span class="keyword">return</span> filter_stream(fn, s.rest)</span><br><span class="line">        <span class="keyword">if</span> fn(s.first):</span><br><span class="line">            <span class="keyword">return</span> Stream(s.first, compute_rest)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> compute_rest()</span><br></pre></td></tr></table></figure>
<h4 id="c&#x7B5B;&#x9009;&#x524D;k&#x4E2A;&#x5143;&#x7D20;">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>&#x7B5B;&#x9009;&#x524D;<span class="math inline">\(k\)</span>&#x4E2A;&#x5143;&#x7D20;</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">first_k_as_list</span>(<span class="params">s, k</span>):</span><br><span class="line">        first_k = []</span><br><span class="line">        <span class="keyword">while</span> s <span class="keyword">is</span> <span class="keyword">not</span> Stream.empty <span class="keyword">and</span> k &gt; <span class="number">0</span>:</span><br><span class="line">            first_k.append(s.first)</span><br><span class="line">            s, k = s.rest, k-<span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> first_k</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = integer_stream(<span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line">Stream(<span class="number">3</span>, &lt;...&gt;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m = map_stream(<span class="keyword">lambda</span> x: x*x, s)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m</span><br><span class="line">Stream(<span class="number">9</span>, &lt;...&gt;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>first_k_as_list(m, <span class="number">5</span>)</span><br><span class="line">[<span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>, <span class="number">36</span>, <span class="number">49</span>]</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;&#x6B63;&#x5982;&#x94FE;&#x8868;&#x63D0;&#x4F9B;&#x7684;&#x7B80;&#x5355;&#x7684;&#x6570;&#x636E;&#x62BD;&#x8C61;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x6D41;&#x4E5F;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x51FD;&#x6570;&#x5316;&#x9012;&#x5F52;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x901A;&#x8FC7;&#x9AD8;&#x9636;&#x51FD;&#x6570;&#x5B9E;&#x73B0;&#x61D2;&#x60F0;&#x8BA1;&#x7B97;&#x3002;</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/4.3.subtype%20polymorphism/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/4.3.subtype%20polymorphism/" class="post-title-link" itemprop="url">4.3.&#x5B50;&#x7C7B;&#x591A;&#x6001;&#x6027;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 17:19:36" itemprop="dateModified" datetime="2024-06-02T17:19:36+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/4-inheritance-inplements/" itemprop="url" rel="index"><span itemprop="name">4.inheritance &amp; inplements</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>1.1k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>4 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="43&#x5B50;&#x7C7B;&#x591A;&#x6001;&#x6027;"><span class="math inline">\(4.3\)</span>&#x5B50;&#x7C7B;&#x591A;&#x6001;&#x6027;</h1>
<h3 id="1&#x591A;&#x6001;&#x6027;&#x7684;&#x6982;&#x5FF5;">1.&#x591A;&#x6001;&#x6027;&#x7684;&#x6982;&#x5FF5;</h3>
<p>&#x2003;&#x2003;&#x5728;&#x524D;&#x9762;&#xFF0C;&#x6211;&#x4EEC;&#x5B66;&#x4E60;&#x4E86;&#x5982;&#x4F55;&#x8FD0;&#x7528;&#x7EE7;&#x627F;&#x6765;&#x91CD;&#x590D;&#x5229;&#x7528;&#x5DF2;&#x6709;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x7EE7;&#x627F;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x8BBE;&#x8BA1;&#x5177;&#x6709;&#x591A;&#x6001;&#x6027;&#x7684;&#x901A;&#x7528;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x4E0E;&#x65B9;&#x6CD5;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5728;<span class="math inline">\(Java\)</span>&#x4E2D;&#xFF0C;&#x591A;&#x6001;&#x6027;(<span class="math inline">\(polymorphism\)</span>)&#x4EE3;&#x6307;&#x5BF9;&#x8C61;&#x5177;&#x6709;&#x4E0D;&#x540C;&#x5F62;&#x5F0F;&#x7684;&#x7C7B;&#x578B;(<span class="math inline">\(types\)</span>)&#x7684;&#x6027;&#x8D28;&#xFF1B;&#x5728;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x7F16;&#x7A0B;&#x4E2D;&#xFF0C;&#x591A;&#x6001;&#x6027;&#x4EE3;&#x6307;&#x5BF9;&#x8C61;&#x5177;&#x6709;&#x7684;&#x4E0D;&#x540C;&#x8EAB;&#x4EFD;&#xFF1A;&#x81EA;&#x5DF1;&#x7C7B;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#x3001;&#x4E3B;&#x7C7B;&#x7684;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;...</p>
<p>&#x2003;&#x2003;&#x8003;&#x8651;&#x4E0B;&#x9762;&#x7684;&#x95EE;&#x9898;&#xFF1A;&#x6211;&#x4EEC;&#x8981;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x51FD;&#x6570;&#xFF0C;&#x7528;&#x4E8E;&#x6BD4;&#x8F83;&#x4E24;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x5927;&#x5C0F;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;&#x9AD8;&#x9636;&#x51FD;&#x6570;&#x5B9E;&#x73B0;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">print_larger</span>(<span class="params">x, y, compare, stringify</span>):</span><br><span class="line">    <span class="keyword">if</span> compare(x, y):</span><br><span class="line">        <span class="keyword">return</span> stringify(x)</span><br><span class="line">    <span class="keyword">return</span> stringify(y)</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD8;&#x53EF;&#x4EE5;&#x7528;&#x5B50;&#x7C7B;&#x591A;&#x6001;&#x6027;&#x5B9E;&#x73B0;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">print_larger</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="keyword">if</span> x.largerThan(y):</span><br><span class="line">        <span class="keyword">return</span> x.<span class="built_in">str</span>()</span><br><span class="line">    <span class="keyword">return</span> y.<span class="built_in">str</span>()</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x9AD8;&#x9636;&#x51FD;&#x6570;&#x7ED9;&#x51FA;&#x7684;&#x662F;&#x666E;&#x9002;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5BF9;&#x4EFB;&#x4F55;&#x5BF9;&#x8C61;&#x90FD;&#x9002;&#x7528;&#x3002;&#x800C;&#x5728;&#x5B50;&#x7C7B;&#x591A;&#x6001;&#x6027;&#x7684;&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x9700;&#x8981;&#x5BF9;&#x8C61;&#x81EA;&#x5DF1;&#x505A;&#x51FA;&#x51B3;&#x5B9A;&#xFF0C;&#x6267;&#x884C;&#x76F8;&#x5E94;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;<code>x.largerThan</code>&#x65B9;&#x6CD5;&#x662F;&#x7531;<span class="math inline">\(x\)</span>&#x4E0E;<span class="math inline">\(y\)</span>&#x6765;&#x51B3;&#x5B9A;&#x7684;&#x3002;</p>
<h3 id="2&#x5B50;&#x7C7B;&#x591A;&#x6001;&#x6027;&#x7684;&#x5E94;&#x7528;">2.&#x5B50;&#x7C7B;&#x591A;&#x6001;&#x6027;&#x7684;&#x5E94;&#x7528;</h3>
<p>&#x2003;&#x2003;&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x666E;&#x9002;&#x7684;<code>max</code>&#x51FD;&#x6570;&#xFF0C;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x63A5;&#x53D7;&#x4EFB;&#x610F;&#x7C7B;&#x578B;&#x7684;&#x6570;&#x7EC4;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x6700;&#x5927;&#x5143;&#x7D20;&#x3002;</p>
<p>&#x2003;&#x2003;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x60F3;&#x6CD5;&#x662F;&#x7528;<code>&gt;</code>&#x6BD4;&#x8F83;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">max</span><span class="params">(Object[] items)</span> {</span><br><span class="line">    <span class="type">int</span> <span class="variable">maxDex</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; items.length; i += <span class="number">1</span>) {</span><br><span class="line">        <span class="keyword">if</span> (items[i] &gt; items[maxDex]) {</span><br><span class="line">            maxDex = i;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> items[maxDex];</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x9ED8;&#x8BA4;<code>&gt;</code>&#x53EF;&#x4EE5;&#x6BD4;&#x8F83;&#x4EFB;&#x610F;&#x7C7B;&#x578B;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x4F46;&#x662F;&#x5B9E;&#x9645;&#x4E0A;&#x4E0D;&#x884C;&#x3002;&#x56E0;&#x4E3A;<code>&gt;</code>&#x53EA;&#x80FD;&#x7528;&#x4E8E;&#x786E;&#x5B9A;&#x7C7B;&#x578B;&#x7684;&#x5BF9;&#x8C61;&#x3002;</p>
<p>&#x2003;&#x2003;&#x4E8E;&#x662F;&#x95EE;&#x9898;&#x8F6C;&#x4E3A;&#x5B9E;&#x73B0;&#x80FD;&#x6BD4;&#x8F83;&#x4EFB;&#x610F;&#x7C7B;&#x578B;&#x5BF9;&#x8C61;&#x7684;<code>&gt;</code>&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4E3A;&#x6B64;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x63A5;&#x53E3;<code>compareTo</code>&#xFF0C;&#x6765;&#x786E;&#x4FDD;&#x6BCF;&#x4E2A;&#x5BF9;&#x8C61;&#x90FD;&#x53EF;&#x4EE5;&#x8C03;&#x7528;&#x8BE5;&#x65B9;&#x6CD5;&#x6765;&#x6BD4;&#x8F83;&#x5927;&#x5C0F;:
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OurComparable</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(Object o)</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x5BF9;&#x6BCF;&#x4E2A;&#x5B50;&#x7C7B;&#x9010;&#x4E00;&#x5B9E;&#x73B0;&#x5BF9;&#x5E94;&#x7684;<span class="math inline">\(implements\)</span>&#x5373;&#x53EF;&#x3002;&#x4EE5;<span class="math inline">\(Dog\)</span>&#x7C7B;&#x4E3A;&#x4F8B;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">implements</span> <span class="title class_">OurComparable</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(Object o)</span> {</span><br><span class="line">        <span class="type">Dog</span> <span class="variable">d</span> <span class="operator">=</span> (Dog) o;</span><br><span class="line">        <span class="comment">// notice that compartTo takes in any object,we need to cast o.</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.size - d.size;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5B9E;&#x73B0;<code>compareTo</code>&#x540E;&#xFF0C;&#x4FBF;&#x53EF;&#x81EA;&#x7136;&#x5730;&#x5B9E;&#x73B0;<code>max</code>&#x4E86;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> OurComparable <span class="title function_">max</span><span class="params">(OurComparable[] items)</span> {</span><br><span class="line">    <span class="type">int</span> <span class="variable">maxDex</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; items.length; i += <span class="number">1</span>) {</span><br><span class="line">        <span class="type">int</span> <span class="variable">cmp</span> <span class="operator">=</span> items[i].compareTo(items[maxDex]);</span><br><span class="line">        <span class="keyword">if</span> (cmp &gt; <span class="number">0</span>) {</span><br><span class="line">            maxDex = i;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> items[maxDex];</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5229;&#x7528;&#x7EE7;&#x627F;&#xFF0C;&#x6211;&#x4EEC;&#x4F18;&#x96C5;&#x5730;&#x5B9E;&#x73B0;&#x4E86;&#x901A;&#x7528;&#x7684;<code>max</code>&#x51FD;&#x6570;&#x3002;</p>
<h3 id="3comparable&#x63A5;&#x53E3;">3.<code>comparable</code>&#x63A5;&#x53E3;</h3>
<p>&#x2003;&#x2003;<span class="math inline">\(Java\)</span>&#x4E2D;&#x5DF2;&#x6709;&#x7684;<code>comparable</code>&#x63A5;&#x53E3;&#x53EF;&#x4EE5;&#x66F4;&#x597D;&#x5730;&#x5B9E;&#x73B0;<code>max</code>&#xFF0C;&#x5B83;&#x7684;&#x5F62;&#x5F0F;&#x5982;&#x4E0B;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Comparable</span>&lt;T&gt; {</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(T obj)</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x4E0E;<span class="math inline">\(OurComparable\)</span>&#x76F8;&#x6BD4;&#xFF0C;&#x8BE5;&#x63A5;&#x53E3;&#x63A5;&#x53D7;&#x4E00;&#x4E2A;&#x901A;&#x7528;&#x7C7B;&#x578B;&#xFF0C;&#x8FD9;&#x4F7F;&#x5F97;&#x6211;&#x4EEC;&#x4E0D;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x7C7B;&#x578B;&#x94F8;&#x9020;&#xFF0C;&#x540C;&#x65F6;&#x5373;&#x4F7F;&#x4E00;&#x4E2A;&#x7C7B;&#x6CA1;&#x6709;&#x7EE7;&#x627F;&#x63A5;&#x53E3;&#xFF0C;&#x5B83;&#x4E5F;&#x53EF;&#x4EE5;&#x8C03;&#x7528;<code>max</code>&#x3002;&#x8FD9;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x7684;<span class="math inline">\(Dog\)</span>&#x7C7B;&#x53EF;&#x4EE5;&#x5982;&#x6B64;&#x5B9E;&#x73B0;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">implements</span> <span class="title class_">Comparable</span>&lt;Dog&gt; {</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(Dog d)</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.size - d.size;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x901A;&#x8FC7;&#x5185;&#x7F6E;(<span class="math inline">\(built-in\)</span>)&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x6211;&#x4EEC;&#x5F97;&#x4EE5;&#x5229;&#x7528;&#x5DF2;&#x6709;&#x7684;&#x5E93;(<span class="math inline">\(libraries\)</span>)&#x548C;<span class="math inline">\(Comparable\)</span>&#x63A5;&#x53E3;&#x3002;</p>
<h3 id="4comparator&#x63A5;&#x53E3;">4.<code>comparator</code>&#x63A5;&#x53E3;</h3>
<p>&#x2003;&#x2003;&#x8003;&#x8651;&#x4E0B;&#x9762;&#x7684;&#x95EE;&#x9898;&#xFF1A;&#x5047;&#x5982;&#x6211;&#x4EEC;&#x4E0D;&#x60F3;&#x8BA9;<span class="math inline">\(Dog\)</span>&#x4EE5;<span class="math inline">\(size\)</span>&#x6392;&#x5217;&#xFF0C;&#x8BE5;&#x600E;&#x4E48;&#x5199;<code>max</code>&#x5462;&#xFF1F;</p>
<p>&#x2003;&#x2003;<span class="math inline">\(Java\)</span>&#x7684;&#x5185;&#x7F6E;&#x63A5;&#x53E3;<code>comparator</code>&#x5185;&#x90E8;&#x5982;&#x4E0B;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Comparator</span>&lt;T&gt; {</span><br><span class="line">    <span class="type">int</span> <span class="title function_">compare</span><span class="params">(T o1, T o2)</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x8BF4;&#x660E;<code>comparator</code>&#x9700;&#x8981;&#x5B50;&#x7C7B;&#x5B9E;&#x73B0;<code>compare</code>&#x65B9;&#x6CD5;&#xFF0C;&#x5B83;&#x548C;<code>compareTo</code>&#x7684;&#x89C4;&#x5219;&#x76F8;&#x4F3C;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5982;&#x4E0B;&#x5B9E;&#x73B0;<span class="math inline">\(Dog\)</span>&#x7684;<code>compare</code>&#x65B9;&#x6CD5;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">implements</span> <span class="title class_">Comparable</span>&lt;Dog&gt; {</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(Dog uddaDog)</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.size - uddaDog.size;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">NameComparator</span> <span class="keyword">implements</span> <span class="title class_">Comparator</span>&lt;Dog&gt; {</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(Dog a, Dog b)</span> {</span><br><span class="line">            <span class="keyword">return</span> a.name.compareTo(b.name);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//declared it as static,for it doesn&apos;t use any other methods  </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Comparator&lt;Dog&gt; <span class="title function_">getNameComparator</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">NameComparator</span>();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x91CC;&#x7684;<span class="math inline">\(Dog\)</span>&#x7C7B;&#x901A;&#x8FC7;<code>Comparator</code>&#x7684;&#x5185;&#x90E8;&#x63A5;&#x53E3;&#x5B9E;&#x73B0;&#x4E86;&#x7EE7;&#x627F;&#x7684;&#x5C42;&#x6B21;&#x6027;&#xFF1A;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;<span class="math inline">\(Dog\)</span>&#x5185;&#x90E8;&#x5B9A;&#x4E49;&#x81EA;&#x5DF1;&#x9700;&#x8981;&#x7684;&#x6BD4;&#x8F83;&#x65B9;&#x6CD5;&#xFF1A;<code>NameComparator</code>&#x3001;<code>SizeComparator</code>...</p>
<h3 id="5&#x63A5;&#x53E3;&#x7684;&#x529F;&#x80FD;">5.&#x63A5;&#x53E3;&#x7684;&#x529F;&#x80FD;</h3>
<p>&#x2003;&#x2003;<span class="math inline">\(Java\)</span>&#x4E2D;&#x7684;&#x63A5;&#x53E3;&#x4E3A;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x4E86;&#x51FD;&#x6570;&#x56DE;&#x8C03;(<span class="math inline">\(callback\)</span>)&#x7684;&#x80FD;&#x529B;&#x3002;&#x6709;&#x65F6;&#xFF0C;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x9700;&#x8981;&#x5176;&#x4ED6;&#x8FD8;&#x672A;&#x5B9E;&#x73B0;&#x7684;&#x51FD;&#x6570;&#x7684;&#x5E2E;&#x52A9;&#xFF0C;&#x5982;<code>max</code>&#x9700;&#x8981;<code>compareTo</code>&#x3002;&#x800C;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x5C31;&#x662F;&#x8F85;&#x52A9;&#x51FD;&#x6570;(<span class="math inline">\(helper\;function\)</span>)&#xFF0C;&#x5982;<code>compareTo</code>&#x3002;&#x5728;<span class="math inline">\(Java\)</span>&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x628A;&#x9700;&#x8981;&#x7684;&#x51FD;&#x6570;&#x5C01;&#x88C5;&#x5728;&#x63A5;&#x53E3;&#x5185;&#x3002;</p>
<blockquote>
<p>&#x2003;&#x2003;A Comparable says, &quot;I want to compare myself to another object&quot;. It
is imbedded within the object itself, and it defines the natural
ordering of a type. A Comparator, on the other hand, is more like a
third party machine that compares two objects to each other. Since
there&apos;s only room for one compareTo method, if we want multiple ways to
compare, we must turn to Comparator.</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/4.3.%E5%A3%B0%E6%98%8E%E5%BC%8F%E7%BC%96%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/4.3.%E5%A3%B0%E6%98%8E%E5%BC%8F%E7%BC%96%E7%A8%8B/" class="post-title-link" itemprop="url">4.3.&#x58F0;&#x660E;&#x5F0F;&#x7F16;&#x7A0B;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 15:55:44" itemprop="dateModified" datetime="2024-06-02T15:55:44+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SICP-in-python/" itemprop="url" rel="index"><span itemprop="name">SICP in python</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SICP-in-python/Chapter-4-Data-Processing/" itemprop="url" rel="index"><span itemprop="name">Chapter 4.Data Processing</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>3.4k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>12 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="43&#x58F0;&#x660E;&#x5F0F;&#x7F16;&#x7A0B;declarativeprogramming"><span class="math inline">\(4.3\)</span>&#x58F0;&#x660E;&#x5F0F;&#x7F16;&#x7A0B;(<span class="math inline">\(declarative\;programming\)</span>)</h1>
<h2 id="&#x4E00;-&#x6982;&#x8FF0;">&#x4E00;&#x3001;&#x6982;&#x8FF0;</h2>
<p>&#x2003;&#x2003;&#x9664;&#x4E86;&#x6D41;(<span class="math inline">\(streams\)</span>)&#xFF0C;&#x6570;&#x636E;&#x7684;&#x503C;&#x4E5F;&#x7ECF;&#x5E38;&#x5B58;&#x50A8;&#x5728;&#x4E00;&#x4E2A;&#x53EB;&#x4F5C;&#x6570;&#x636E;&#x5E93;(<span class="math inline">\(database\)</span>)&#x7684;&#x4ED3;&#x5E93;&#x91CC;&#x3002;</p>
<p>&#x2003;&#x2003;&#x6570;&#x636E;&#x5E93;&#x7531;&#x5B58;&#x5165;&#x5176;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x548C;&#x68C0;&#x7D22;&#x3001;&#x8F6C;&#x6362;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x7684;&#x63A5;&#x53E3;&#x7EC4;&#x6210;&#x3002;&#x6BCF;&#x4E2A;&#x5B58;&#x50A8;&#x5728;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x7684;&#x503C;&#x79F0;&#x4F5C;&#x8BB0;&#x5F55;(<span class="math inline">\(record\)</span>)&#xFF0C;&#x6709;&#x7740;&#x76F8;&#x4F3C;&#x7ED3;&#x6784;&#x7684;&#x8BB0;&#x5F55;&#x88AB;&#x5F52;&#x7C7B;&#x4E3A;&#x8868;&#x683C;(<span class="math inline">\(tables\)</span>)&#x3002;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8BE2;&#x95EE;&#x8BED;&#x8A00;&#x4E2D;&#x7684;&#x8BE2;&#x95EE;&#x8BED;&#x53E5;(<span class="math inline">\(queries\)</span>)&#x6765;&#x68C0;&#x7D22;&#x3001;&#x8F6C;&#x6362;&#x8BB0;&#x5F55;&#x3002;&#x76EE;&#x524D;&#x6700;&#x666E;&#x904D;&#x7684;&#x8BE2;&#x95EE;&#x8BED;&#x8A00;&#x88AB;&#x79F0;&#x4F5C;<span class="math inline">\(Structure\;Query\;Language(SQL)\)</span>&#x3002;</p>
<p>&#x2003;&#x2003;<span class="math inline">\(SQL\)</span>&#x662F;&#x58F0;&#x660E;&#x5F0F;&#x7F16;&#x7A0B;&#x8BED;&#x8A00;&#x7684;&#x4E00;&#x79CD;&#x3002;&#x5728;&#x8FD9;&#x79CD;&#x8BED;&#x8A00;&#x4E2D;&#xFF0C;&#x58F0;&#x660E;&#x5E76;&#x4E0D;&#x76F4;&#x63A5;&#x63CF;&#x8FF0;&#x8BA1;&#x7B97;&#xFF0C;&#x800C;&#x662F;&#x63CF;&#x8FF0;&#x8BA1;&#x7B97;&#x60F3;&#x8981;&#x5F97;&#x5230;&#x7684;&#x7ED3;&#x679C;&#x3002;&#x800C;&#x8BBE;&#x8BA1;&#x548C;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x8BA1;&#x7B97;&#x8FC7;&#x7A0B;&#x6765;&#x5F97;&#x5230;&#x8FD9;&#x4E2A;&#x7ED3;&#x679C;&#x662F;&#x8BE2;&#x95EE;&#x89E3;&#x91CA;&#x5668;(<span class="math inline">\(query\;interpreter\)</span>)&#x7684;&#x5DE5;&#x4F5C;&#x3002;&#x8FD9;&#x79CD;&#x8BED;&#x8A00;&#x7ECF;&#x5E38;&#x5C06;&#x8FC7;&#x7A0B;&#x6027;&#x7684;&#x7EC6;&#x8282;(<span class="math inline">\(procedural\;details\)</span>)&#x62BD;&#x8C61;&#xFF0C;&#x800C;&#x4E13;&#x6CE8;&#x4E8E;&#x7ED3;&#x679C;&#x7684;&#x5F62;&#x5F0F;(<span class="math inline">\(form\)</span>)&#x3002;</p>
<h2 id="&#x4E8C;-sql">&#x4E8C;&#x3001;<span class="math inline">\(SQL\)</span></h2>
<h3 id="1&#x8868;&#x683C;">1.&#x8868;&#x683C;</h3>
<p>&#x2003;&#x2003;&#x8868;&#x683C;(<span class="math inline">\(table\)</span>)&#x5177;&#x6709;&#x56FA;&#x5B9A;&#x6570;&#x91CF;&#x7684;&#x547D;&#x540D;&#x5217;(<span class="math inline">\(named\;column\)</span>)&#x548C;&#x7C7B;&#x578B;&#x5217;(<span class="math inline">\(typed\;column\)</span>)&#x3002;&#x8868;&#x7684;&#x6BCF;&#x4E00;&#x884C;&#x8868;&#x793A;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x8BB0;&#x5F55;&#xFF0C;&#x884C;&#x4E2D;&#x7684;&#x6BCF;&#x4E00;&#x5217;&#x8868;&#x793A;&#x4E00;&#x4E2A;&#x503C;&#x3002;&#x4F8B;&#x5982;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x5173;&#x4E8E;&#x57CE;&#x5E02;&#x7684;&#x8868;&#x683C;&#xFF1A;</p>
<p><img src="/2024/05/31/4.3.%E5%A3%B0%E6%98%8E%E5%BC%8F%E7%BC%96%E7%A8%8B/image.png"></p>
<p>&#x2003;&#x2003;&#x4E00;&#x4E2A;&#x53EA;&#x6709;&#x4E00;&#x884C;&#x7684;&#x8868;&#x683C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<span class="math inline">\(select\)</span>&#x8BED;&#x53E5;&#x521B;&#x5EFA;&#x3002;&#x8BE5;&#x884C;&#x7684;&#x6BCF;&#x4E2A;&#x503C;&#x95F4;&#x7528;&#x9017;&#x53F7;&#x9694;&#x5F00;&#xFF0C;&#x5217;&#x540D;&#x79F0;&#x8DDF;&#x5728;&#x5173;&#x952E;&#x8BCD;<span class="math inline">\(as\)</span>&#x540E;&#x9762;&#x3002;&#x6240;&#x6709;&#x7684;<span class="math inline">\(SQL\)</span>&#x8BED;&#x53E5;&#x90FD;&#x4EE5;&#x5206;&#x53F7;&#x7ED3;&#x5C3E;&#xFF1A; <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; select 38 as latitude, 122 as longitude, &quot;Berkeley&quot; as name;</span><br><span class="line">38|122|Berkeley</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x591A;&#x884C;&#x7684;&#x8868;&#x683C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<span class="math inline">\(union\)</span>&#x8BED;&#x53E5;&#x521B;&#x5EFA;&#xFF1A; <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; select 38 as latitude, 122 as longitude, &quot;Berkeley&quot; as name union</span><br><span class="line">   ...&gt; select 42,             71,               &quot;Cambridge&quot;        union</span><br><span class="line">   ...&gt; select 45,             93,               &quot;Minneapolis&quot;;</span><br><span class="line">38|122|Berkeley</span><br><span class="line">42|71|Cambridge</span><br><span class="line">45|93|Minneapolis</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<span class="math inline">\(create\;table\)</span>&#x8BED;&#x53E5;&#x6765;&#x7ED9;&#x8868;&#x683C;&#x547D;&#x540D;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; create table cities as</span><br><span class="line">   ...&gt;    select 38 as latitude, 122 as longitude, &quot;Berkeley&quot; as name union</span><br><span class="line">   ...&gt;    select 42,             71,               &quot;Cambridge&quot;        union</span><br><span class="line">   ...&gt;    select 45,             93,               &quot;Minneapolis&quot;;</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5F53;&#x4E00;&#x4E2A;&#x8868;&#x683C;&#x88AB;&#x547D;&#x540D;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<span class="math inline">\(from\)</span>&#x8BED;&#x53E5;&#x8C03;&#x7528;&#x8FD9;&#x4E2A;&#x540D;&#x5B57;&#x3002;&#x8868;&#x683C;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x5217;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>select *</code>&#x5F62;&#x5F0F;&#x8BBF;&#x95EE;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; select * from cities;</span><br><span class="line">38|122|Berkeley</span><br><span class="line">42|71|Cambridge</span><br><span class="line">45|93|Minneapolis</span><br></pre></td></tr></table></figure></p>
<h3 id="2select&#x8BED;&#x53E5;">2.<span class="math inline">\(select\)</span>&#x8BED;&#x53E5;</h3>
<p>&#x2003;&#x2003;<span class="math inline">\(select\)</span>&#x8BED;&#x53E5;&#x901A;&#x8FC7;&#x5217;&#x4E3E;(<span class="math inline">\(listing\)</span>)&#x67D0;&#x4E00;&#x884C;&#x7684;&#x503C;&#xFF0C;&#x6216;&#x8005;(&#x66F4;&#x666E;&#x904D;&#x5730;)&#x4ECE;&#x4E00;&#x4E2A;&#x5DF2;&#x5B58;&#x5728;&#x7684;&#x8868;&#x683C;&#x4E2D;&#xFF0C;&#x5229;&#x7528;<span class="math inline">\(from\)</span>&#x53E5;&#x5F0F;&#x6295;&#x5C04;(<span class="math inline">\(project\)</span>)&#x6765;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x8868;&#x683C;&#x3002;&#x8BE5;&#x8BED;&#x53E5;&#x7684;&#x4E00;&#x822C;&#x683C;&#x5F0F;&#x5982;&#x4E0B;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select [column description] from [existing table name]</span><br></pre></td></tr></table></figure> &#x2003;&#x2003;&#x8FD9;&#x91CC;&#x7684;<span class="math inline">\(column\;expression\)</span>&#x8868;&#x793A;&#x5BF9;&#x539F;&#x6765;&#x8868;&#x683C;&#x7684;&#x5217;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x5982;&#x52A0;&#x51CF;&#x4E58;&#x9664;&#x7B49;&#x3002;</p>
<p>&#x2003;&#x2003;&#x4F8B;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;&#x5982;&#x4E0B;&#x65B9;&#x6CD5;&#x6765;&#x521B;&#x9020;&#x4E00;&#x4E2A;&#x4E24;&#x5217;&#x7684;&#x8868;&#x683C;&#xFF0C;&#x8FD9;&#x4E2A;&#x8868;&#x683C;&#x63CF;&#x8FF0;&#x4E86;&#x6BCF;&#x4E2A;&#x57CE;&#x5E02;&#x5230;<span class="math inline">\(Berkeley\)</span>&#x7684;&#x8DDD;&#x79BB;&#xFF1A; <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; select name, 60*abs(latitude-38) from cities;</span><br><span class="line">Berkeley|0</span><br><span class="line">Cambridge|240</span><br><span class="line">Minneapolis|420</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x540E;&#x7EED;&#x88AB;&#x5176;&#x5B83;<span class="math inline">\(select\)</span>&#x8BED;&#x53E5;&#x6240;&#x5F15;&#x7528;&#xFF0C;&#x5728;&#x5B9A;&#x4E49;&#x8868;&#x683C;&#x65F6;&#x7ED9;&#x6BCF;&#x4E00;&#x4E2A;&#x5217;&#x4E00;&#x4E2A;&#x540D;&#x5B57;&#x5F80;&#x5F80;&#x662F;&#x5FC5;&#x987B;&#x7684;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; create table distances as</span><br><span class="line">   ...&gt;   select name, 60*abs(latitude-38) as distance from cities;</span><br><span class="line">sqlite&gt; select distance/5, name from distances;</span><br><span class="line">0|Berkeley</span><br><span class="line">48|Cambridge</span><br><span class="line">84|Minneapolis</span><br></pre></td></tr></table></figure></p>
<h4 id="awhere&#x8BED;&#x53E5;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span><span class="math inline">\(Where\)</span>&#x8BED;&#x53E5;</h4>
<p>&#x2003;&#x2003;<span class="math inline">\(select\)</span>&#x8BED;&#x53E5;&#x4E5F;&#x53EF;&#x4EE5;&#x7A7F;&#x63D2;&#x4E00;&#x4E2A;&#x8868;&#x793A;&#x8FC7;&#x6EE4;&#x5143;&#x7D20;(<span class="math inline">\(filering\)</span>)&#x7684;<span class="math inline">\(where\)</span>&#x8BED;&#x53E5;&#x3002;&#x8FD9;&#x4E2A;&#x8868;&#x8FBE;&#x5F0F;&#x5C06;&#x4E0D;&#x7B26;&#x5408;<span class="math inline">\(where\)</span>&#x8BED;&#x53E5;&#x7684;&#x884C;&#x7ED9;&#x7B5B;&#x5E8F;&#x6389;&#x3002;&#x53EA;&#x6709;&#x7B26;&#x5408;&#x7B5B;&#x9009;&#x6761;&#x4EF6;&#x7684;&#x884C;&#x624D;&#x4F1A;&#x88AB;&#x7528;&#x4E8E;&#x6784;&#x6210;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x8868;&#x683C;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; create table cold as</span><br><span class="line">   ...&gt;   select name from cities where latitude &gt; 43;</span><br><span class="line">sqlite&gt; select name, &quot;is cold!&quot; from cold;</span><br><span class="line">Minneapolis|is cold!</span><br></pre></td></tr></table></figure></p>
<h4 id="b&#x987A;&#x5E8F;&#x8BED;&#x53E5;">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>&#x987A;&#x5E8F;&#x8BED;&#x53E5;</h4>
<p>&#x2003;&#x2003;&#x987A;&#x5E8F;&#x8BED;&#x53E5;(<span class="math inline">\(order\;clause\)</span>)&#x5305;&#x62EC;&#x4E00;&#x4E2A;&#x6392;&#x5E8F;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x6240;&#x6709;&#x672A;&#x88AB;&#x8FC7;&#x6EE4;&#x7684;&#x884C;&#x90FD;&#x4F1A;&#x6309;&#x7167;&#x8FD9;&#x4E2A;&#x8BED;&#x53E5;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; select distance, name from distances order by -distance;</span><br><span class="line">84|Minneapolis</span><br><span class="line">48|Cambridge</span><br><span class="line">0|Berkeley</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;<span class="math inline">\(select\)</span>&#x7684;&#x8FD9;&#x4E9B;&#x7279;&#x6027;&#x529F;&#x80FD;&#x4F7F;&#x5F97;<span class="math inline">\(select\)</span>&#x80FD;&#x591F;&#x8868;&#x793A;&#x5F88;&#x591A;&#x79CD;&#x7C7B;&#x7684;&#x884C;&#x8F93;&#x5165;&#x8868;&#x683C;&#x5230;&#x8F93;&#x51FA;&#x8868;&#x683C;&#x7684;&#x6620;&#x5C04;&#x3002;</p>
<h3 id="3&#x5408;&#x5E76;">3.&#x5408;&#x5E76;</h3>
<h4 id="a&#x5408;&#x5E76;&#x7684;&#x57FA;&#x672C;&#x64CD;&#x4F5C;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&#x5408;&#x5E76;&#x7684;&#x57FA;&#x672C;&#x64CD;&#x4F5C;</h4>
<p>&#x2003;&#x2003;&#x4F17;&#x591A;&#x6570;&#x636E;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5408;&#x5E76;(<span class="math inline">\(joining\)</span>)&#x8868;&#x683C;&#x53D8;&#x6210;&#x4E00;&#x4E2A;&#xFF0C;&#x8FD9;&#x662F;&#x6570;&#x636E;&#x5E93;&#x7CFB;&#x7EDF;&#x4E2D;&#x4E00;&#x4E2A;&#x57FA;&#x7840;&#x7684;&#x64CD;&#x4F5C;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5F53;&#x8868;&#x683C;&#x88AB;&#x5408;&#x5E76;&#x540E;&#xFF0C;&#x5BF9;&#x4E8E;&#x8F93;&#x5165;&#x8868;&#x683C;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x884C;&#xFF0C;&#x5408;&#x5E76;&#x540E;&#x7684;&#x8868;&#x683C;&#x90FD;&#x4F1A;&#x5305;&#x62EC;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x884C;&#x3002;&#x5982;&#x679C;&#x6709;&#x4E24;&#x4E2A;&#x8868;&#x683C;&#x8FDB;&#x884C;&#x5408;&#x5E76;&#x64CD;&#x4F5C;&#xFF0C;&#x5B83;&#x4EEC;&#x5206;&#x522B;&#x6709;<span class="math inline">\(m\)</span>&#x884C;&#x4E0E;<span class="math inline">\(n\)</span>&#x884C;&#xFF0C;&#x90A3;&#x4E48;&#x5408;&#x5E76;&#x540E;&#x7684;&#x8868;&#x683C;&#x5C31;&#x4F1A;&#x6709;<span class="math inline">\(m\times n\)</span>&#x884C;&#x3002;&#x5728;<span class="math inline">\(SQL\)</span>&#x8BED;&#x8A00;&#x4E2D;&#xFF0C;&#x5408;&#x5E76;&#x4E24;&#x4E2A;&#x8868;&#x683C;&#x662F;&#x901A;&#x8FC7;<span class="math inline">\(from\)</span>&#x8BED;&#x53E5;&#x52A0;&#x4E0A;&#x9017;&#x53F7;&#x9694;&#x5F00;&#x7684;&#x8868;&#x683C;&#x540D;&#x79F0;&#x5B9E;&#x73B0;&#x7684;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; create table temps as</span><br><span class="line">   ...&gt;   select &quot;Berkeley&quot; as city, 68 as temp union</span><br><span class="line">   ...&gt;   select &quot;Chicago&quot;         , 59         union</span><br><span class="line">   ...&gt;   select &quot;Minneapolis&quot;     , 55;</span><br><span class="line"></span><br><span class="line">sqlite&gt; select * from cities, temps;</span><br><span class="line">38|122|Berkeley|Berkeley|68</span><br><span class="line">38|122|Berkeley|Chicago|59</span><br><span class="line">38|122|Berkeley|Minneapolis|55</span><br><span class="line">42|71|Cambridge|Berkeley|68</span><br><span class="line">42|71|Cambridge|Chicago|59</span><br><span class="line">42|71|Cambridge|Minneapolis|55</span><br><span class="line">45|93|Minneapolis|Berkeley|68</span><br><span class="line">45|93|Minneapolis|Chicago|59</span><br><span class="line">45|93|Minneapolis|Minneapolis|55</span><br></pre></td></tr></table></figure></p>
<h4 id="b&#x4E0D;&#x540C;&#x8868;&#x683C;&#x7684;&#x5173;&#x7CFB;">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>&#x4E0D;&#x540C;&#x8868;&#x683C;&#x7684;&#x5173;&#x7CFB;</h4>
<p>&#x2003;&#x2003;&#x540C;&#x6837;&#x5730;&#xFF0C;&#x5408;&#x5E76;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<span class="math inline">\(where\)</span>&#x8BED;&#x53E5;&#xFF0C;&#x8868;&#x793A;&#x4E24;&#x4E2A;&#x8868;&#x683C;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x5C06;&#x6570;&#x636E;&#x6536;&#x96C6;&#x5230;&#x4E00;&#x4E2A;&#x8868;&#x4E2D;&#xFF0C;&#x4EE5;&#x83B7;&#x5F97;&#x6BCF;&#x4E2A;&#x57CE;&#x5E02;&#x81EA;&#x5DF1;&#x7684;<span class="math inline">\(temp\)</span>&#x548C;<span class="math inline">\(lati\)</span>&#x3002;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x8BED;&#x53E5;&#x5B9E;&#x73B0;&#x8FD9;&#x4E2A;&#x60F3;&#x6CD5;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; select name, latitude, temp from cities, temps where name = city;</span><br><span class="line">Berkeley|38|68</span><br><span class="line">Minneapolis|45|55</span><br></pre></td></tr></table></figure></p>
<h4 id="c&#x6D88;&#x9664;&#x6B67;&#x4E49;">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>&#x6D88;&#x9664;&#x6B67;&#x4E49;</h4>
<p>&#x2003;&#x2003;&#x4E3A;&#x4E86;&#x6D88;&#x9664;&#x540D;&#x79F0;&#x76F8;&#x540C;&#x7684;&#x8868;&#x683C;&#x95F4;&#x7684;&#x6B67;&#x4E49;&#xFF0C;<span class="math inline">\(SQL\)</span>&#x5141;&#x8BB8;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x5173;&#x952E;&#x5B57;<span class="math inline">\(as\)</span>&#x4E3A;<span class="math inline">\(form\)</span>&#x8BED;&#x53E5;&#x63D0;&#x4F9B;&#x522B;&#x540D;&#xFF0C;&#x5E76;&#x5229;&#x7528;&#x70B9;&#x8868;&#x8FBE;&#x5F0F;&#x6765;&#x5F15;&#x7528;&#x7279;&#x5B9A;&#x7684;&#x8868;&#x4E2D;&#x7684;&#x5217;&#x3002;&#x5728;&#x4E0B;&#x9762;&#x8BA1;&#x7B97;&#x4E0D;&#x540C;&#x57CE;&#x5E02;&#x6E29;&#x5DEE;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;<span class="math inline">\(where\)</span>&#x8BED;&#x53E5;&#x7684;&#x5B57;&#x6BCD;&#x987A;&#x5E8F;&#x7EA6;&#x675F;&#x786E;&#x4FDD;&#x4E86;&#x6BCF;&#x4E2A;&#x5BF9;&#x5728;&#x7ED3;&#x679C;&#x4E2D;&#x53EA;&#x51FA;&#x73B0;&#x4E00;&#x6B21;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; select a.city, b.city, a.temp - b.temp</span><br><span class="line">   ...&gt;        from temps as a, temps as b where a.city &lt; b.city;</span><br><span class="line">Berkeley|Chicago|10</span><br><span class="line">Berkeley|Minneapolis|15</span><br><span class="line">Chicago|Minneapolis|5</span><br></pre></td></tr></table></figure></p>
<h2 id="&#x4E09;-sql&#x89E3;&#x91CA;&#x5668;">&#x4E09;&#x3001;<span class="math inline">\(SQL\)</span>&#x89E3;&#x91CA;&#x5668;</h2>
<h3 id="1&#x6982;&#x62EC;">1.&#x6982;&#x62EC;</h3>
<p>&#x2003;&#x2003;&#x4E3A;&#x4E86;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<span class="math inline">\(SQL\)</span>&#x89E3;&#x91CA;&#x5668;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x521B;&#x9020;&#x4E00;&#x4E2A;&#x5BF9;&#x8868;&#x683C;&#x7684;&#x8868;&#x793A;&#x3001;&#x5BF9;<span class="math inline">\(SQL\)</span>&#x8BED;&#x53E5;&#x7684;&#x5206;&#x6790;&#x5668;&#xFF0C;&#x548C;&#x5BF9;&#x5206;&#x6790;&#x540E;&#x8BED;&#x53E5;&#x7684;&#x8BA1;&#x7B97;&#x5668;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5728;&#x8FD9;&#x4E2A;&#x5B9E;&#x73B0;&#x4E2D;&#xFF0C;&#x6BCF;&#x4E2A;&#x8868;&#x683C;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x4E00;&#x4E2A;&#x7C7B;&#xFF0C;&#x5E76;&#x4E14;&#x8868;&#x683C;&#x4E2D;&#x7684;&#x6BCF;&#x884C;&#x90FD;&#x7531;&#x8BE5;&#x7C7B;&#x7684;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#x6765;&#x4EE3;&#x8868;&#x3002;&#x4E00;&#x884C;&#x7684;&#x6BCF;&#x4E00;&#x5217;&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x5C5E;&#x6027;&#xFF0C;&#x5E76;&#x4E14;&#x8868;&#x683C;&#x662F;&#x5217;&#x7684;&#x5E8F;&#x5217;&#x3002;</p>
<h3 id="2table&#x7684;&#x521B;&#x5EFA;">2.<span class="math inline">\(table\)</span>&#x7684;&#x521B;&#x5EFA;</h3>
<p>&#x2003;&#x2003;&#x5728;<span class="math inline">\(python\)</span>&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;<span class="math inline">\(namedtuple\)</span>&#x51FD;&#x6570;&#x5B9E;&#x73B0;&#x8868;&#x683C;&#x7684;&#x7C7B;&#xFF0C;&#x5B83;&#x4F1A;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x65B0;&#x7684;<span class="math inline">\(tuple\)</span>&#x5B50;&#x7C7B;&#xFF0C;&#x8FD9;&#x4E2A;&#x5B50;&#x7C7B;&#x4F1A;&#x4E3A;&#x5143;&#x7EC4;&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#x7ED9;&#x4E88;&#x540D;&#x79F0;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5148;&#x524D;&#x7684;<span class="math inline">\(cities\)</span>&#x8868;&#x683C;&#x53EF;&#x4EE5;&#x7528;&#x5982;&#x4E0B;<span class="math inline">\(python\)</span>&#x8BED;&#x53E5;&#x5B9E;&#x73B0;&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line">CitiesRow = namedtuple(<span class="string">&quot;Row&quot;</span>, [<span class="string">&quot;latitude&quot;</span>, <span class="string">&quot;longitude&quot;</span>, <span class="string">&quot;name&quot;</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cities = [CitiesRow(<span class="number">38</span>, <span class="number">122</span>, <span class="string">&quot;Berkeley&quot;</span>),</span><br><span class="line">              CitiesRow(<span class="number">42</span>,  <span class="number">71</span>, <span class="string">&quot;Cambridge&quot;</span>),</span><br><span class="line">              CitiesRow(<span class="number">43</span>,  <span class="number">93</span>, <span class="string">&quot;Minneapolis&quot;</span>)]</span><br></pre></td></tr></table></figure></p>
<h3 id="3select&#x7684;&#x5B9E;&#x73B0;">3.<span class="math inline">\(select\)</span>&#x7684;&#x5B9E;&#x73B0;</h3>
<p>&#x2003;&#x2003;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5E8F;&#x5217;&#x64CD;&#x4F5C;&#x6765;&#x5B9E;&#x73B0;<span class="math inline">\(select\)</span>&#x8BED;&#x53E5;&#xFF0C;&#x4F8B;&#x5982;&#x5148;&#x524D;&#x751F;&#x6210;&#x7684;<span class="math inline">\(cities\)</span>&#x7684;<span class="math inline">\(distances\)</span>&#x7684;&#x8868;&#x683C;&#xFF1A; <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; create table distances as</span><br><span class="line">   ...&gt;   select name, 60*abs(latitude-38) as distance from cities;</span><br><span class="line">sqlite&gt; select distance/5, name from distances;</span><br><span class="line">0|Berkeley</span><br><span class="line">48|Cambridge</span><br><span class="line">84|Minneapolis</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x4E2A;&#x8868;&#x683C;&#x662F;&#x7531;<span class="math inline">\(cities\)</span>&#x7684;<span class="math inline">\(name\)</span>&#x5217;&#x548C;<span class="math inline">\(latitude\)</span>&#x5217;&#x751F;&#x6210;&#x7684;&#x3002;&#x8BE5;&#x8FC7;&#x7A0B;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5BF9;&#x8F93;&#x5165;&#x8868;&#x683C;&#x7684;&#x884C;&#x7528;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x6620;&#x5C04;(<span class="math inline">\(mapping\;a\;function\)</span>)&#x3001;&#x7136;&#x540E;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x884C;&#x6765;&#x5B9E;&#x73B0;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>DistancesRow = namedtuple(<span class="string">&quot;Row&quot;</span>, [<span class="string">&quot;name&quot;</span>, <span class="string">&quot;distance&quot;</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">select</span>(<span class="params">cities_row</span>):</span><br><span class="line">        latitude, longitude, name = cities_row</span><br><span class="line">        <span class="keyword">return</span> DistancesRow(name, <span class="number">60</span>*<span class="built_in">abs</span>(latitude-<span class="number">38</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>distances = <span class="built_in">list</span>(<span class="built_in">map</span>(select, cities))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> row <span class="keyword">in</span> distances:</span><br><span class="line">        <span class="built_in">print</span>(row)</span><br><span class="line">Row(name=<span class="string">&apos;Berkeley&apos;</span>, distance=<span class="number">0</span>)</span><br><span class="line">Row(name=<span class="string">&apos;Cambridge&apos;</span>, distance=<span class="number">240</span>)</span><br><span class="line">Row(name=<span class="string">&apos;Minneapolis&apos;</span>, distance=<span class="number">300</span>)</span><br></pre></td></tr></table></figure></p>
<h3 id="4&#x89E3;&#x91CA;&#x5668;&#x7684;&#x6574;&#x4F53;&#x5B9E;&#x73B0;">4.&#x89E3;&#x91CA;&#x5668;&#x7684;&#x6574;&#x4F53;&#x5B9E;&#x73B0;</h3>
<p>&#x2003;&#x2003;<span class="math inline">\(SQL\)</span>&#x89E3;&#x91CA;&#x5668;&#x7684;&#x8BBE;&#x8BA1;&#x5C06;&#x4E0A;&#x8FF0;&#x65B9;&#x6CD5;&#x666E;&#x904D;&#x5316;&#x4E86;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Select</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;select [columns] from [tables] where [condition] order by [order].&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, columns, tables, condition, order</span>):</span><br><span class="line">            self.columns = columns</span><br><span class="line">            self.tables = tables</span><br><span class="line">            self.condition = condition</span><br><span class="line">            self.order = order</span><br><span class="line">            self.make_row = create_make_row(self.columns)</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self, env</span>):</span><br><span class="line">            <span class="string">&quot;&quot;&quot;Join, filter, sort, and map rows from tables to columns.&quot;&quot;&quot;</span></span><br><span class="line">            from_rows = join(self.tables, env)</span><br><span class="line">            filtered_rows = <span class="built_in">filter</span>(self.<span class="built_in">filter</span>, from_rows)</span><br><span class="line">            ordered_rows = self.sort(filtered_rows)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">map</span>(self.make_row, ordered_rows)</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">filter</span>(<span class="params">self, row</span>):</span><br><span class="line">            <span class="keyword">if</span> self.condition:</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">eval</span>(self.condition, row)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">sort</span>(<span class="params">self, rows</span>):</span><br><span class="line">            <span class="keyword">if</span> self.order:</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">sorted</span>(rows, key=<span class="keyword">lambda</span> r: <span class="built_in">eval</span>(self.order, r))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> rows</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;<code>execute</code>&#x65B9;&#x6CD5;&#x5C06;&#x8F93;&#x5165;&#x7684;&#x8868;&#x683C;&#x8FDB;&#x884C;&#x5408;&#x5E76;&#x3001;&#x8FC7;&#x6EE4;&#x548C;&#x6392;&#x5E8F;&#x3002;&#x6700;&#x540E;&#x8F93;&#x51FA;&#x884C;&#x8C03;&#x7528;&#x7684;&#x51FD;&#x6570;<code>make_row</code>&#x662F;&#x4E00;&#x4E2A;&#x9AD8;&#x9636;&#x51FD;&#x6570;&#xFF0C;&#x5B83;&#x4E3A;&#x751F;&#x6210;&#x7684;&#x8868;&#x683C;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x7C7B;&#xFF0C;&#x5E76;&#x4E14;&#x5B9A;&#x4E49;&#x4E86;&#x5982;&#x4F55;&#x4ECE;&#x4E00;&#x4E2A;&#x8F93;&#x5165;&#x884C;(<span class="math inline">\(input\;row\)</span>)&#x5230;&#x4E00;&#x4E2A;&#x8F93;&#x51FA;&#x884C;(<span class="math inline">\(output\;row\)</span>)&#xFF1A; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">create_make_row</span>(<span class="params">description</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Return a function from an input environment (dict) to an output row.</span></span><br><span class="line"><span class="string">        description -- a comma-separated list of [expression] as [column name]</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment">#seperate the string by commas and space</span></span><br><span class="line">        columns = description.split(<span class="string">&quot;, &quot;</span>)</span><br><span class="line">        expressions, names = [], []</span><br><span class="line">        <span class="keyword">for</span> column <span class="keyword">in</span> columns:</span><br><span class="line">        <span class="comment">#if an &apos;as&apos; is contained in the coloum,then divide it into expression and column name</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot; as &quot;</span> <span class="keyword">in</span> column:</span><br><span class="line">                expression, name = column.split(<span class="string">&quot; as &quot;</span>)</span><br><span class="line">         <span class="comment">#else,view expression and name as the same</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                expression, name = column, column</span><br><span class="line">            expressions.append(expression)</span><br><span class="line">            names.append(name)</span><br><span class="line">        row = namedtuple(<span class="string">&quot;Row&quot;</span>, names)</span><br><span class="line">        <span class="comment">#the lambda function output a named tuple,its value is received by calculating the expression in the current environment</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">lambda</span> env: row(*[<span class="built_in">eval</span>(e, env) <span class="keyword">for</span> e <span class="keyword">in</span> expressions])</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x6700;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5B9A;&#x4E49;<span class="math inline">\(join\)</span>&#x51FD;&#x6570;&#x3002;&#x5728;&#x63D0;&#x4F9B;<code>env</code>&#xFF0C;&#x5305;&#x62EC;&#x7531;&#x540D;&#x5B57;&#x952E;(<span class="math inline">\(keyed\;by\;name\)</span>)&#x63A7;&#x5236;&#x7684;&#x73B0;&#x6709;&#x8868;&#x683C;(&#x4EE5;&#x884C;&#x5217;&#x8868;&#x7684;&#x5F62;&#x5F0F;&#x5B58;&#x5728;)&#xFF0C;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;<span class="math inline">\(join\)</span>&#x51FD;&#x6570;&#x901A;&#x8FC7;<span class="math inline">\(python\)</span>&#x7684;<span class="math inline">\(product\)</span>&#x51FD;&#x6570;&#xFF0C;&#x5C06;&#x8FD9;&#x4E9B;&#x884C;&#x5217;&#x8868;&#x8FDB;&#x884C;&#x5408;&#x5E76;&#x3002;&#x5BF9;&#x88AB;&#x5408;&#x5E76;&#x7684;&#x8F93;&#x51FA;&#x884C;&#xFF0C;&#x5B83;&#x7528;<code>make_env</code>&#x51FD;&#x6570;&#x6620;&#x5C04;&#xFF0C;&#x6765;&#x5F97;&#x51FA;&#x5BF9;&#x5E94;&#x5B57;&#x6BB5;&#x7684;&#x8BA1;&#x7B97;&#x503C;&#xFF1A;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">join</span>(<span class="params">tables, env</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Return an iterator over dictionaries from names to values in a row.</span></span><br><span class="line"><span class="string">        tables -- a comma-separate sequences of table names</span></span><br><span class="line"><span class="string">        env    -- a dictionary from global names to tables</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        names = tables.split(<span class="string">&quot;, &quot;</span>)</span><br><span class="line">        joined_rows = product(*[env[name] <span class="keyword">for</span> name <span class="keyword">in</span> names])</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">map</span>(<span class="keyword">lambda</span> rows: make_env(rows, names), joined_rows)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">make_env</span>(<span class="params">rows, names</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Create an environment of names bound to values.&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment">#transform a tuple into a dictionary</span></span><br><span class="line">        env = <span class="built_in">dict</span>(<span class="built_in">zip</span>(names, rows))</span><br><span class="line">        <span class="comment"># add the name and its value into the dictionary</span></span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> rows:</span><br><span class="line">            <span class="keyword">for</span> name <span class="keyword">in</span> row._fields:</span><br><span class="line">                env[name] = <span class="built_in">getattr</span>(row, name)</span><br><span class="line">        <span class="keyword">return</span> env</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x4E0A;&#x8FF0;&#x7684;<span class="math inline">\(SQL\)</span>&#x89E3;&#x91CA;&#x5668;&#x80FD;&#x591F;&#x5B9E;&#x73B0;&#x5927;&#x90E8;&#x5206;<span class="math inline">\(SQL\)</span>&#x8BED;&#x53E5;&#xFF1A; <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; select name, 60*abs(latitude-38) as distance</span><br><span class="line">   ...&gt;        from cities where name != &quot;Berkeley&quot; order by -longitude;</span><br><span class="line">Minneapolis|420</span><br><span class="line">Cambridge|240</span><br></pre></td></tr></table></figure> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>env = {<span class="string">&quot;cities&quot;</span>: cities}</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>select = Select(<span class="string">&quot;name, 60*abs(latitude-38) as distance&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;cities&quot;</span>, <span class="string">&quot;name != &apos;Berkeley&apos;&quot;</span>, <span class="string">&quot;-longitude&quot;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> row <span class="keyword">in</span> select.execute(env):</span><br><span class="line">        <span class="built_in">print</span>(row)</span><br><span class="line">Row(name=<span class="string">&apos;Minneapolis&apos;</span>, distance=<span class="number">300</span>)</span><br><span class="line">Row(name=<span class="string">&apos;Cambridge&apos;</span>, distance=<span class="number">240</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; select cities.name as name, distance, longitude</span><br><span class="line">   ...&gt;        from cities, distances where cities.name = distances.name;</span><br><span class="line">Cambridge|240|71</span><br><span class="line">Minneapolis|420|93</span><br></pre></td></tr></table></figure> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>env[<span class="string">&quot;distances&quot;</span>] = <span class="built_in">list</span>(select.execute(env))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>joined = Select(<span class="string">&quot;cities.name as name, distance, longitude&quot;</span>, <span class="string">&quot;cities, distances&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;cities.name == distances.name&quot;</span>, <span class="literal">None</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> row <span class="keyword">in</span> joined.execute(env):</span><br><span class="line">        <span class="built_in">print</span>(row)</span><br><span class="line">Row(name=<span class="string">&apos;Cambridge&apos;</span>, distance=<span class="number">240</span>, longitude=<span class="number">71</span>)</span><br><span class="line">Row(name=<span class="string">&apos;Minneapolis&apos;</span>, distance=<span class="number">300</span>, longitude=<span class="number">93</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="&#x56DB;-&#x9012;&#x5F52;select&#x8BED;&#x53E5;">&#x56DB;&#x3001;&#x9012;&#x5F52;<span class="math inline">\(select\)</span>&#x8BED;&#x53E5;</h2>
<h3 id="1with&#x8BED;&#x53E5;">1.<span class="math inline">\(with\)</span>&#x8BED;&#x53E5;</h3>
<p>&#x2003;&#x2003;<span class="math inline">\(with\)</span>&#x8BED;&#x53E5;&#x7684;&#x683C;&#x5F0F;&#x5982;&#x4E0B;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">with [tables] select [columns] from [names] where [condition] order by [order]</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x91CC;&#x7684;<span class="math inline">\(tables\)</span>&#x90E8;&#x5206;&#x662F;&#x4E00;&#x4E2A;&#x7528;&#x9017;&#x53F7;&#x5206;&#x9694;&#x5F00;&#x7684;&#x5217;&#x8868;&#xFF0C;&#x5217;&#x8868;&#x5185;&#x662F;&#x5BF9;&#x8868;&#x683C;&#x7684;&#x63CF;&#x8FF0;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[table name]([column names]) as ([select statement])</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x4EFB;&#x4F55;<span class="math inline">\(select\)</span>&#x8BED;&#x53E5;&#x90FD;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x63CF;&#x8FF0;&#x8868;&#x683C;&#x3002;</p>
<p>&#x2003;&#x2003;&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x5C55;&#x793A;&#x4E86;<span class="math inline">\(with\)</span>&#x8BED;&#x53E5;&#x7684;&#x4F7F;&#x7528;&#xFF1A; <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; with</span><br><span class="line">   ...&gt;   states(city, state) as (</span><br><span class="line">   ...&gt;     select &quot;Berkeley&quot;,  &quot;California&quot;    union</span><br><span class="line">   ...&gt;     select &quot;Boston&quot;,    &quot;Massachusetts&quot; union</span><br><span class="line">   ...&gt;     select &quot;Cambridge&quot;, &quot;Massachusetts&quot; union</span><br><span class="line">   ...&gt;     select &quot;Chicago&quot;,   &quot;Illinois&quot;      union</span><br><span class="line">   ...&gt;     select &quot;Pasadena&quot;,  &quot;California&quot;</span><br><span class="line">   ...&gt;   )</span><br><span class="line">   ...&gt; select a.city, b.city, a.state from states as a, states as b</span><br><span class="line">   ...&gt;        where a.state = b.state and a.city &lt; b.city;</span><br><span class="line">Berkeley|Pasadena|California</span><br><span class="line">Boston|Cambridge|Massachusetts</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5728;<span class="math inline">\(with\)</span>&#x8BED;&#x53E5;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x8868;&#x683C;&#x53EF;&#x4EE5;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x9012;&#x5F52;&#x7ED3;&#x6784;&#xFF0C;&#x901A;&#x8FC7;&#x5176;&#x4ED6;&#x7684;&#x8F93;&#x51FA;&#x884C;&#x6765;&#x5F97;&#x51FA;&#x5F53;&#x524D;&#x8F93;&#x51FA;&#x884C;&#x3002;&#x4F8B;&#x5982;&#x4E0B;&#x9762;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;<span class="math inline">\(5\)</span>&#x5230;<span class="math inline">\(15\)</span>&#x95F4;&#x6574;&#x6570;&#x7684;&#x8868;&#x683C;&#xFF1A; <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; with</span><br><span class="line">   ...&gt;   ints(n) as (</span><br><span class="line">   ...&gt;     select 5 union</span><br><span class="line">   ...&gt;     select n+1 from ints where n &lt; 15</span><br><span class="line">   ...&gt;   )</span><br><span class="line">   ...&gt; select n, n*n from ints where n % 2 = 1;</span><br><span class="line">5|25</span><br><span class="line">7|49</span><br><span class="line">9|81</span><br><span class="line">11|121</span><br><span class="line">13|169</span><br><span class="line">15|225</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;<span class="math inline">\(with\)</span>&#x8BED;&#x53E5;&#x8FD8;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;&#x591A;&#x91CD;&#x8868;&#x683C;&#xFF0C;&#x8868;&#x683C;&#x95F4;&#x7528;&#x9017;&#x53F7;&#x9694;&#x5F00;&#x3002;&#x4F8B;&#x5982;&#x4E0B;&#x9762;&#x6C42;&#x89E3;&#x52FE;&#x80A1;&#x6570;&#x7684;&#x8868;&#x683C;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; with</span><br><span class="line">   ...&gt;   ints(n) as (</span><br><span class="line">   ...&gt;     select 1 union </span><br><span class="line">            select n+1 from ints where n &lt; 20</span><br><span class="line">   ...&gt;   ),</span><br><span class="line">   ...&gt;   squares(x, xx) as (</span><br><span class="line">   ...&gt;     select n, n*n from ints</span><br><span class="line">   ...&gt;   ),</span><br><span class="line">   ...&gt;   sum_of_squares(a, b, sum) as (</span><br><span class="line">   ...&gt;     select a.x, b.x, a.xx + b.xx</span><br><span class="line">   ...&gt;            from squares as a, squares as b where a.x &lt; b.x</span><br><span class="line">   ...&gt;   )</span><br><span class="line">   ...&gt; select a, b, x from squares, sum_of_squares where sum = xx;</span><br><span class="line">3|4|5</span><br><span class="line">6|8|10</span><br><span class="line">5|12|13</span><br><span class="line">9|12|15</span><br><span class="line">8|15|17</span><br><span class="line">12|16|20</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8BBE;&#x8BA1;&#x9012;&#x5F52;&#x8BE2;&#x95EE;&#x9700;&#x8981;&#x786E;&#x4FDD;&#x6BCF;&#x4E2A;&#x8F93;&#x5165;&#x884C;&#x90FD;&#x6709;&#x8DB3;&#x591F;&#x7684;&#x4FE1;&#x606F;&#x6765;&#x8BA1;&#x7B97;&#x7ED3;&#x679C;&#x884C;&#x3002;&#x4F8B;&#x5982;&#x4E0B;&#x9762;&#x6C42;&#x89E3;&#x6590;&#x6CE2;&#x90A3;&#x5951;&#x6570;&#x7684;&#x8868;&#x683C;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; with</span><br><span class="line">   ...&gt;   fib(previous, current) as (</span><br><span class="line">   ...&gt;     select 0, 1 union</span><br><span class="line">   ...&gt;     select current, previous+current from fib</span><br><span class="line">   ...&gt;     where current &lt;= 100</span><br><span class="line">   ...&gt;   )</span><br><span class="line">   ...&gt; select previous from fib;</span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">5</span><br><span class="line">8</span><br><span class="line">13</span><br><span class="line">21</span><br><span class="line">34</span><br><span class="line">55</span><br><span class="line">89</span><br></pre></td></tr></table></figure></p>
<h3 id="2&#x642D;&#x5EFA;&#x5B57;&#x7B26;&#x4E32;">2.&#x642D;&#x5EFA;&#x5B57;&#x7B26;&#x4E32;</h3>
<p>&#x2003;&#x2003;&#x4E24;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>||</code>&#x64CD;&#x4F5C;&#x7B26;&#x5408;&#x5E76;&#x6210;&#x4E00;&#x4E2A;&#x66F4;&#x957F;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; with wall(n) as (</span><br><span class="line">  ....&gt;   select 99 union select 98 union select 97</span><br><span class="line">  ....&gt; )</span><br><span class="line">  ....&gt; select n || &quot; bottles&quot; from wall;</span><br><span class="line">99 bottles</span><br><span class="line">98 bottles</span><br><span class="line">97 bottles</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x4E2A;&#x64CD;&#x4F5C;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x901A;&#x8FC7;&#x77ED;&#x8BED;&#x6765;&#x6784;&#x5EFA;&#x53E5;&#x5B50;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x6784;&#x5EFA;&#x82F1;&#x8BED;&#x53E5;&#x5B50;&#x7684;&#x4E00;&#x4E2A;&#x65B9;&#x5F0F;&#x662F;&#x7528;&#x4E3B;&#x8BED;&#x3001;&#x52A8;&#x8BCD;&#x548C;&#x5BBE;&#x8BED;&#x8FDB;&#x884C;&#x7EC4;&#x5408;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; create table nouns as</span><br><span class="line">  ....&gt;   select &quot;the dog&quot; as phrase union</span><br><span class="line">  ....&gt;   select &quot;the cat&quot;           union</span><br><span class="line">  ....&gt;   select &quot;the bird&quot;;</span><br><span class="line">sqlite&gt; select subject.phrase || &quot; chased &quot; || object.phrase</span><br><span class="line">  ....&gt;        from nouns as subject, nouns as object</span><br><span class="line">  ....&gt;        where subject.phrase != object.phrase;</span><br><span class="line">the bird chased the cat</span><br><span class="line">the bird chased the dog</span><br><span class="line">the cat chased the bird</span><br><span class="line">the cat chased the dog</span><br><span class="line">the dog chased the bird</span><br><span class="line">the dog chased the cat</span><br></pre></td></tr></table></figure></p>
<h2 id="&#x4E94;-&#x5F52;&#x5E76;&#x4E0E;&#x5206;&#x7EC4;">&#x4E94;&#x3001;&#x5F52;&#x5E76;&#x4E0E;&#x5206;&#x7EC4;</h2>
<h3 id="1&#x5F52;&#x5E76;&#x64CD;&#x4F5C;">1.&#x5F52;&#x5E76;&#x64CD;&#x4F5C;</h3>
<p>&#x2003;&#x2003;<span class="math inline">\(select\)</span>&#x8BED;&#x53E5;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x5982;<span class="math inline">\(max\)</span>&#x3001;<span class="math inline">\(min\)</span>&#x3001;<span class="math inline">\(count\)</span>&#x3001;<span class="math inline">\(sum\)</span>&#x7B49;&#x5F52;&#x5E76;&#x64CD;&#x4F5C;&#xFF0C;&#x5B83;&#x4EEC;&#x5206;&#x522B;&#x8FD4;&#x56DE;&#x884C;&#x7684;&#x6700;&#x5927;&#x6700;&#x5C0F;&#x503C;&#x3001;&#x884C;&#x7684;&#x6570;&#x91CF;&#x548C;&#x884C;&#x5185;&#x503C;&#x7684;&#x548C;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; create table animals as</span><br><span class="line">  ....&gt;   select &quot;dog&quot; as name, 4 as legs, 20 as weight union</span><br><span class="line">  ....&gt;   select &quot;cat&quot;        , 4        , 10           union</span><br><span class="line">  ....&gt;   select &quot;ferret&quot;     , 4        , 10           union</span><br><span class="line">  ....&gt;   select &quot;t-rex&quot;      , 2        , 12000        union</span><br><span class="line">  ....&gt;   select &quot;penguin&quot;    , 2        , 10           union</span><br><span class="line">  ....&gt;   select &quot;bird&quot;       , 2        , 6;</span><br><span class="line">sqlite&gt; select max(legs) from animals;</span><br><span class="line">4</span><br><span class="line">sqlite&gt; select sum(weight) from animals;</span><br><span class="line">12056</span><br><span class="line">sqlite&gt; select min(legs), max(weight) from animals where name &lt;&gt; &quot;t-rex&quot;;</span><br><span class="line">2|20</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;<code>count(*)</code>&#x8BED;&#x53E5;&#x7528;&#x4E8E;&#x8BA1;&#x7B97;&#x5BF9;&#x5E94;&#x91CF;&#x7684;&#x884C;&#x7684;&#x6570;&#x91CF;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; select count(legs) from animals;</span><br><span class="line">6</span><br><span class="line">sqlite&gt; select count(*) from animals;</span><br><span class="line">6</span><br><span class="line">sqlite&gt; select count(distinct legs) from animals;</span><br><span class="line">2</span><br></pre></td></tr></table></figure></p>
<h3 id="2groupby&#x548C;having&#x8BED;&#x53E5;">2.<span class="math inline">\(group\;by\)</span>&#x548C;<span class="math inline">\(having\)</span>&#x8BED;&#x53E5;</h3>
<p>&#x2003;&#x2003;<span class="math inline">\(group\;by\)</span>&#x548C;<span class="math inline">\(having\)</span>&#x8BED;&#x53E5;&#x7528;&#x4E8E;&#x5C06;&#x8868;&#x683C;&#x7684;&#x884C;&#x5206;&#x5272;&#x4E3A;&#x7EC4;&#x7684;&#x4E00;&#x4E2A;&#x5B50;&#x96C6;(<span class="math inline">\(subset\;of\;groups\)</span>)&#x5E76;&#x53EA;&#x4ECE;&#x8FD9;&#x4E9B;&#x5B50;&#x96C6;&#x4E2D;&#x6311;&#x9009;&#x4E00;&#x4E2A;&#x3002;&#x4EFB;&#x4F55;&#x5728;<span class="math inline">\(having\)</span>&#x8BED;&#x53E5;&#x4E2D;&#x7684;&#x5F52;&#x5E76;&#x8BED;&#x53E5;&#x90FD;&#x4F1A;&#x5E94;&#x7528;&#x5230;&#x8868;&#x683C;&#x7684;&#x6BCF;&#x4E00;&#x884C;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4E00;&#x6B21;&#x6027;&#x7528;&#x4E8E;&#x8868;&#x683C;&#x7684;&#x6240;&#x6709;&#x884C;&#x3002;&#x4F8B;&#x5982;&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; select legs, max(weight) from animals group by legs;</span><br><span class="line">2|12000</span><br><span class="line">4|20</span><br><span class="line">sqlite&gt; select weight from animals group by weight having count(*)&gt;1;</span><br><span class="line">10</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;<span class="math inline">\(group\;by\)</span>&#x8BED;&#x53E5;&#x53EF;&#x4EE5;&#x63A5;&#x53D7;&#x591A;&#x4E2A;&#x5217;&#xFF0C;&#x5E76;&#x5C06;&#x539F;&#x6765;&#x7684;&#x8868;&#x683C;&#x6309;&#x7167;&#x8FD9;&#x4E9B;&#x5217;&#x5206;&#x7EC4;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; select max(name) from animals group by legs, weight order by name;</span><br><span class="line">bird</span><br><span class="line">dog</span><br><span class="line">ferret</span><br><span class="line">penguin</span><br><span class="line">t-rex</span><br><span class="line">sqlite&gt; select max(name), legs, weight from animals group by legs, weight</span><br><span class="line">  ....&gt;   having max(weight) &lt; 100;</span><br><span class="line">bird|2|6</span><br><span class="line">penguin|2|10</span><br><span class="line">ferret|4|10</span><br><span class="line">dog|4|20</span><br><span class="line">sqlite&gt; select count(*), weight/legs from animals group by weight/legs;</span><br><span class="line">2|2</span><br><span class="line">1|3</span><br><span class="line">2|5</span><br><span class="line">1|6000</span><br><span class="line"></span><br><span class="line">sqlite&gt; select name, legs, max(weight) from animals group by legs;</span><br><span class="line">t-rex|2|12000</span><br><span class="line">dog|4|20</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;<span class="math inline">\(having\)</span>&#x8BED;&#x53E5;&#x53EF;&#x4EE5;&#x548C;<span class="math inline">\(where\)</span>&#x8BED;&#x53E5;&#x4E00;&#x6837;&#x8FC7;&#x6EE4;&#x8868;&#x683C;&#x5143;&#x7D20;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x5305;&#x542B;&#x5BF9;&#x5F52;&#x5E76;&#x5143;&#x7D20;&#x7684;&#x5F15;&#x7528;&#x3002;&#x53EF;&#x4EE5;&#x6309;&#x7167;&#x5982;&#x4E0B;&#x539F;&#x5219;&#x9009;&#x62E9;&#x4E24;&#x79CD;&#x8BED;&#x53E5;&#xFF1A;&#x5F53;&#x8FC7;&#x6EE4;&#x6761;&#x4EF6;&#x662F;&#x5BF9;&#x5355;&#x4E00;&#x7684;&#x884C;&#x6267;&#x884C;&#x65F6;&#x4F7F;&#x7528;<span class="math inline">\(where\)</span>&#x8BED;&#x53E5;&#xFF1B;&#x5F53;&#x8FC7;&#x6EE4;&#x6761;&#x4EF6;&#x8BBE;&#x8BA1;&#x5F52;&#x5E76;&#x64CD;&#x4F5C;&#x65F6;&#x4F7F;&#x7528;<span class="math inline">\(having\)</span>&#x8BED;&#x53E5;&#x3002;</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/5.1.Autoboxing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/5.1.Autoboxing/" class="post-title-link" itemprop="url">5.1.&#x81EA;&#x52A8;&#x88C5;&#x7BB1;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 17:27:51" itemprop="dateModified" datetime="2024-06-02T17:27:51+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/5-Generics-and-Autoboxing/" itemprop="url" rel="index"><span itemprop="name">5.Generics and Autoboxing</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>393</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="51&#x81EA;&#x52A8;&#x88C5;&#x7BB1;"><span class="math inline">\(5.1\)</span>&#x81EA;&#x52A8;&#x88C5;&#x7BB1;</h1>
<h3 id="1&#x81EA;&#x52A8;&#x88C5;&#x7BB1;&#x4E0E;&#x89E3;&#x5305;">1.&#x81EA;&#x52A8;&#x88C5;&#x7BB1;&#x4E0E;&#x89E3;&#x5305;</h3>
<p>&#x2003;&#x2003;&#x5F53;&#x6211;&#x4EEC;&#x5B9E;&#x4F8B;&#x5316;&#x4E00;&#x4E2A;&#x6CDB;&#x578B;&#x5BF9;&#x8C61;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x6307;&#x5B9A;&#x5176;&#x5177;&#x4F53;&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x4F8B;&#x5982;<code>LinkedListDeque&lt;Integer&gt;</code>&#x3002;&#x5BF9;&#x4E8E;<span class="math inline">\(Java\)</span>&#x7684;<span class="math inline">\(8\)</span>&#x79CD;&#x57FA;&#x672C;&#x7C7B;&#x578B;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x76F8;&#x5E94;&#x7684;&#x5F15;&#x7528;&#x7C7B;&#x578B;&#xFF0C;&#x8FD9;&#x4E9B;&#x5F15;&#x7528;&#x7C7B;&#x578B;&#x88AB;&#x79F0;&#x4E3A;&#x5305;&#x88C5;&#x7C7B;(<span class="math inline">\(wrapper\;classes\)</span>)&#xFF1A;</p>
<p><img src="/2024/05/31/5.1.Autoboxing/image.png"></p>
<p>&#x2003;&#x2003;&#x7531;&#x5F15;&#x7528;&#x7C7B;&#x578B;&#x8F6C;&#x6362;&#x5230;&#x57FA;&#x672C;&#x7C7B;&#x578B;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x9700;&#x8981;&#x6267;&#x884C;&#x989D;&#x5916;&#x7684;&#x64CD;&#x4F5C;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5199;&#x5982;&#x4E0B;&#x7A0B;&#x5E8F;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BasicArrayList</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">      ArrayList&lt;Integer&gt; L = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">      L.add(<span class="number">5</span>);</span><br><span class="line">      L.add(<span class="number">6</span>);</span><br><span class="line">      <span class="type">int</span> <span class="variable">first</span> <span class="operator">=</span> L.get(<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x800C;&#x4E0D;&#x5FC5;&#x5199;&#x6210;&#x5982;&#x4E0B;&#x7E41;&#x7410;&#x7684;&#x5F62;&#x5F0F;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BasicArrayList</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">      ArrayList&lt;Integer&gt; L = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">      L.add(<span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">5</span>));</span><br><span class="line">      L.add(<span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">6</span>));</span><br><span class="line"></span><br><span class="line">      <span class="comment">/* Use the Integer.valueOf method to convert to int */</span></span><br><span class="line">      <span class="type">int</span> <span class="variable">first</span> <span class="operator">=</span> L.get(<span class="number">0</span>).valueOf();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;<span class="math inline">\(Java\)</span>&#x4F1A;&#x81EA;&#x52A8;&#x201C;&#x88C5;&#x7BB1;&#x201D;(<span class="math inline">\(autobox\)</span>)&#x4E0E;&#x201C;&#x89E3;&#x5305;&#x201D;(<span class="math inline">\(unbox\)</span>)&#x57FA;&#x672C;&#x7C7B;&#x578B;&#x4E0E;&#x5F15;&#x7528;&#x7C7B;&#x578B;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x4E0B;&#x9762;&#x7684;&#x7A0B;&#x5E8F;&#x90FD;&#x662F;&#x6B63;&#x786E;&#x7684;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">blah</span><span class="params">(Integer x)</span> {</span><br><span class="line">    System.out.println(x);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line">blah(x);</span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">blahPrimitive</span><span class="params">(<span class="type">int</span> x)</span> {</span><br><span class="line">    System.out.println(x);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">Integer</span> <span class="variable">x</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">20</span>);</span><br><span class="line">blahPrimitive(x);</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x4E0D;&#x8FC7;&#x9700;&#x8981;&#x6CE8;&#x610F;&#xFF0C;&#x6570;&#x7EC4;&#x4E0D;&#x80FD;&#x81EA;&#x52A8;&#x88C5;&#x7BB1;&#x6216;&#x89E3;&#x5305;&#x3002;</p>
<h3 id="2&#x7C7B;&#x578B;&#x6269;&#x5C55;">2.&#x7C7B;&#x578B;&#x6269;&#x5C55;</h3>
<p>&#x2003;&#x2003;&#x5F53;&#x9700;&#x8981;&#x7684;&#x65F6;&#x5019;&#xFF0C;<span class="math inline">\(Java\)</span>&#x4F1A;&#x81EA;&#x52A8;&#x6269;&#x5C55;&#x4E00;&#x4E2A;&#x521D;&#x59CB;&#x7C7B;&#x578B;&#x7684;&#x8303;&#x56F4;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">blahDouble</span><span class="params">(<span class="type">double</span> x)</span> {</span><br><span class="line">    System.out.println(&#x201C;<span class="type">double</span>: &#x201C; + x);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line">blahDouble(x);</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x662F;&#x6B63;&#x786E;&#x7684;&#xFF0C;&#x4F46;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">blahInt</span><span class="params">(<span class="type">int</span> x)</span> {</span><br><span class="line">    System.out.println(&#x201C;<span class="type">int</span>: &#x201C; + x);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line">blahInt(x);</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x662F;&#x9519;&#x8BEF;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;<span class="math inline">\(int\)</span>&#x7684;&#x8303;&#x56F4;&#x5C0F;&#x4E8E;<span class="math inline">\(double\)</span>&#xFF0C;&#x4E0D;&#x80FD;&#x6269;&#x5C55;&#x5230;&#x6BD4;&#x81EA;&#x5DF1;&#x66F4;&#x5927;&#x7684;&#x96C6;&#x5408;&#x4E2D;&#x3002;&#x6B64;&#x65F6;&#x5FC5;&#x987B;&#x4F7F;&#x7528;&#x7C7B;&#x578B;&#x94F8;&#x9020;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">double</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line">blahInt((<span class="type">int</span>) x);</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/5.3.Creating%20Another%20Generic%20Class/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/5.3.Creating%20Another%20Generic%20Class/" class="post-title-link" itemprop="url">5.3.&#x6CDB;&#x7C7B;&#x7684;&#x521B;&#x5EFA;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 17:27:49" itemprop="dateModified" datetime="2024-06-02T17:27:49+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/5-Generics-and-Autoboxing/" itemprop="url" rel="index"><span itemprop="name">5.Generics and Autoboxing</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>127</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="53&#x6CDB;&#x7C7B;&#x7684;&#x521B;&#x5EFA;"><span class="math inline">\(5.3\)</span>&#x6CDB;&#x7C7B;&#x7684;&#x521B;&#x5EFA;</h1>
<h3 id="1&#x6CDB;&#x578B;&#x65B9;&#x6CD5;&#x7684;&#x521B;&#x5EFA;">1.&#x6CDB;&#x578B;&#x65B9;&#x6CD5;&#x7684;&#x521B;&#x5EFA;</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;K,V&gt; V <span class="title function_">get</span><span class="params">(Map61B&lt;K,V&gt; map, K key)</span> {</span><br><span class="line">    <span class="keyword">if</span> map.containsKey(key) {</span><br><span class="line">        <span class="keyword">return</span> map.get(key);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">//why &lt;K,V&gt;?because the parameters takes two different</span></span><br><span class="line"><span class="comment">//genetic types,so we alse use two. </span></span><br></pre></td></tr></table></figure>
<h3 id="2gt&#x8FD0;&#x7B97;&#x7B26;&#x7684;&#x6CDB;&#x578B;&#x5316;">2.<code>&gt;</code>&#x8FD0;&#x7B97;&#x7B26;&#x7684;&#x6CDB;&#x578B;&#x5316;</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;K <span class="keyword">extends</span> <span class="title class_">Comparable</span>&lt;K&gt;, V&gt; K <span class="title function_">maxKey</span><span class="params">(Map61B&lt;K, V&gt; map)</span> {...}</span><br><span class="line"><span class="comment">// the &quot;extends&quot; assure that the object has a &quot;compareTo&quot; method.</span></span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;&#x6B64;&#x5904;&#x7684;<span class="math inline">\(extends\)</span>&#x5173;&#x952E;&#x8BCD;&#xFF0C;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x201C;<span class="math inline">\(K\)</span>&#x5FC5;&#x987B;&#x662F;&#x53EF;&#x6BD4;&#x7684;&#x201D;&#x7684;&#x58F0;&#x660E;&#x3002;<span class="math inline">\(extends\)</span>&#x4F1A;&#x5BF9;&#x5BF9;&#x8C61;&#x65BD;&#x52A0;&#x4E00;&#x4E2A;&#x7EA6;&#x675F;&#x3001;&#x800C;&#x975E;&#x8D4B;&#x4E88;&#x5B83;&#x65B0;&#x7684;&#x80FD;&#x529B;&#x3002;</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/6.2.Throwing%20Exceptions/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/6.2.Throwing%20Exceptions/" class="post-title-link" itemprop="url">6.2.&#x5F02;&#x5E38;&#x5F15;&#x53D1;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 17:32:28" itemprop="dateModified" datetime="2024-06-02T17:32:28+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/6-Exception-Iterator-Iterables-Object-Methods/" itemprop="url" rel="index"><span itemprop="name">6.Exception &amp; Iterator &amp; Iterables &amp; Object Methods</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>1.1k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>4 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="62&#x5F02;&#x5E38;&#x5F15;&#x53D1;"><span class="math inline">\(6.2\)</span>&#x5F02;&#x5E38;&#x5F15;&#x53D1;</h1>
<h3 id="1throw&#x8BED;&#x53E5;">1.<span class="math inline">\(throw\)</span>&#x8BED;&#x53E5;</h3>
<p>&#x2003;&#x2003;&#x8003;&#x8651;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x5B9E;&#x73B0;<span class="math inline">\(ArraySet\)</span>&#x7684;&#x7A0B;&#x5E8F;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArraySet</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Iterable</span>&lt;T&gt; {</span><br><span class="line">    <span class="keyword">private</span> T[] items;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> size; <span class="comment">// the next item to be added will be at position size</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ArraySet</span><span class="params">()</span> {</span><br><span class="line">        items = (T[]) <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">100</span>];</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Returns true if this map contains a mapping for the specified key.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">contains</span><span class="params">(T x)</span> {</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i += <span class="number">1</span>) {</span><br><span class="line">            <span class="keyword">if</span> (items[i].equals(x)) {</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Associates the specified value with the specified key in this map. */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(T x)</span> {</span><br><span class="line">        <span class="keyword">if</span> (contains(x)) {</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        items[size] = x;</span><br><span class="line">        size += <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Returns the number of key-value mappings in this map. */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x4E2A;&#x7A0B;&#x5E8F;&#x6709;&#x4E00;&#x4E2A;&#x5C0F;&#x95EE;&#x9898;&#xFF1A;&#x5F53;&#x6211;&#x4EEC;&#x5411;<span class="math inline">\(ArraySet\)</span>&#x4E2D;&#x52A0;&#x5165;<span class="math inline">\(null\)</span>&#x65F6;&#xFF0C;&#x4F1A;&#x4EA7;&#x751F;<code>NullPointerException</code>&#x7684;&#x9519;&#x8BEF;&#x3002;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#xFF1A;&#x5728;<code>contains</code>&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x7531;&#x4E8E;&#x52A0;&#x5165;&#x4E86;<span class="math inline">\(null\)</span>&#xFF0C;&#x8C03;&#x7528;<span class="math inline">\(items[i]\)</span>&#x65F6;&#x4F1A;&#x4EA7;&#x751F;&#x8FD9;&#x79CD;&#x9519;&#x8BEF;&#x3002;</p>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x629B;&#x51FA;&#x81EA;&#x5DF1;&#x7684;&#x5F02;&#x5E38;(<span class="math inline">\(exceptions\)</span>)&#x3002;&#x5728;<span class="math inline">\(python\)</span>&#x4E2D;&#x6211;&#x4EEC;&#x4F7F;&#x7528;<span class="math inline">\(raise\)</span>&#x8BED;&#x53E5;&#xFF0C;&#x800C;&#x5728;<span class="math inline">\(Java\)</span>&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;&#x5982;&#x4E0B;&#x8BED;&#x53E5;&#x58F0;&#x660E;&#x9519;&#x8BEF;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ExceptionObject</span>(parameter1, ...)</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x4E8E;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5982;&#x4E0B;&#x7F16;&#x5199;&#x6211;&#x4EEC;&#x7684;&#x5F02;&#x5E38;&#x629B;&#x5F03;(<span class="math inline">\(throwing\;exception\)</span>)&#x8BED;&#x53E5;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Associates the specified value with the specified key in this map.</span></span><br><span class="line"><span class="comment">   Throws an IllegalArgumentException if the key is null. */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(T x)</span> {</span><br><span class="line">    <span class="keyword">if</span> (x == <span class="literal">null</span>) {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;can&apos;t add null&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (contains(x)) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    items[size] = x;</span><br><span class="line">    size += <span class="number">1</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x867D;&#x7136;&#x4E0D;&#x7BA1;&#x6709;&#x6CA1;&#x6709;<span class="math inline">\(throw\)</span>&#x8BED;&#x53E5;&#xFF0C;&#x7A0B;&#x5E8F;&#x90FD;&#x4F1A;&#x5728;&#x8BE5;&#x5904;&#x4E2D;&#x65AD;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x901A;&#x8FC7;<span class="math inline">\(throw\)</span>&#x8BED;&#x53E5;&#xFF0C;&#x6211;&#x4EEC;&#x5BF9;&#x7A0B;&#x5E8F;&#x6709;&#x4E86;&#x66F4;&#x9AD8;&#x7684;&#x638C;&#x63A7;&#x529B;&#xFF1A;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x51B3;&#x5B9A;&#x7A0B;&#x5E8F;&#x5E94;&#x8BE5;&#x5728;&#x4F55;&#x5904;&#x4E2D;&#x65AD;&#x3002;&#x540C;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x5C06;<span class="math inline">\(Java\)</span>&#x4E2D;&#x7684;&#x62A5;&#x9519;&#x66F4;&#x6539;&#x4E3A;&#x66F4;&#x5177;&#x4F53;&#x7684;&#x8BED;&#x53E5;&#x3002;</p>
<h3 id="2catch&#x8BED;&#x53E5;">2.<span class="math inline">\(catch\)</span>&#x8BED;&#x53E5;</h3>
<p>&#x2003;&#x2003;&#x5229;&#x7528;&#x5148;&#x524D;&#x7684;<span class="math inline">\(throw\)</span>&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C06;<span class="math inline">\(Java\)</span>&#x4E2D;&#x7684;&#x9690;&#x6027;&#x9519;&#x8BEF;(<span class="math inline">\(implicit\;exceptions\)</span>)&#x663E;&#x5F0F;&#x5316;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">    System.out.println(<span class="string">&quot;ayyy lmao&quot;</span>);</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;For no reason.&quot;</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">$ java Alien</span><br><span class="line">ayyy lmao</span><br><span class="line">Exception in thread <span class="string">&quot;main&quot;</span> java.lang.RuntimeException: For no reason.</span><br><span class="line">at Alien.main(Alien.java:<span class="number">4</span>)</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#x4E86;&#x6784;&#x9020;&#x65B9;&#x6CD5;<code>new</code>&#xFF0C;&#x8FD9;&#x770B;&#x8D77;&#x6765;&#x548C;&#x7C7B;&#x7684;&#x5B9E;&#x4F8B;&#x5316;&#x975E;&#x5E38;&#x76F8;&#x4F3C;&#x2014;&#x2014;&#x4E8B;&#x5B9E;&#x4E0A;&#x5C31;&#x662F;&#x5982;&#x6B64;&#x3002;<span class="math inline">\(RuntimeException\)</span>&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x666E;&#x901A;&#x7684;<span class="math inline">\(Java\)</span>&#x5B9E;&#x4F8B;&#x3002;</p>
<p>&#x2003;&#x2003;&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;<span class="math inline">\(catch\)</span>&#x6BCF;&#x4E2A;&#x5F02;&#x5E38;&#x5B9E;&#x4F8B;&#xFF0C;&#x5982;&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Dog</span> <span class="variable">d</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dog</span>(<span class="string">&quot;Lucy&quot;</span>, <span class="string">&quot;Retriever&quot;</span>, <span class="number">80</span>);</span><br><span class="line">d.becomeAngry();</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> {</span><br><span class="line">    d.receivePat();</span><br><span class="line">} <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">    System.out.println(<span class="string">&quot;Tried to pat: &quot;</span> + e);</span><br><span class="line">}</span><br><span class="line">System.out.println(d);</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5176;&#x5BF9;&#x5E94;&#x8F93;&#x51FA;&#x53EF;&#x80FD;&#x4E3A;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ java ExceptionDemo</span><br><span class="line">Tried to pat: java.lang.RuntimeException: grrr... snarl snarl</span><br><span class="line">Lucy is a displeased Retriever weighing <span class="number">80.0</span> standard lb units.</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x6211;&#x4EEC;&#x5728;<span class="math inline">\(catch\)</span>&#x5230;<code>RuntimeException</code>&#x540E;&#xFF0C;&#x4F9D;&#x7136;&#x6267;&#x884C;&#x5230;&#x4E86;&#x6700;&#x540E;&#x4E00;&#x884C;&#x3002;</p>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x7528;<span class="math inline">\(catch\)</span>&#x8BED;&#x53E5;&#x6765;&#x6267;&#x884C;&#x4FEE;&#x6B63;&#x63AA;&#x65BD;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Dog</span> <span class="variable">d</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dog</span>(<span class="string">&quot;Lucy&quot;</span>, <span class="string">&quot;Retriever&quot;</span>, <span class="number">80</span>);</span><br><span class="line">d.becomeAngry();</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> {</span><br><span class="line">    d.receivePat();</span><br><span class="line">} <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">    System.out.println(</span><br><span class="line">    <span class="string">&quot;Tried to pat: &quot;</span> + e);</span><br><span class="line">    d.eatTreat(<span class="string">&quot;banana&quot;</span>);</span><br><span class="line">} </span><br><span class="line">d.receivePat();</span><br><span class="line">System.out.println(d);</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5728;&#x8FD9;&#x4E2A;&#x7A0B;&#x5E8F;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x53D1;&#x73B0;&#x5F02;&#x5E38;&#x65F6;&#x7528;<span class="math inline">\(treat\)</span>&#x6765;&#x6170;&#x629A;<span class="math inline">\(Dog\)</span>&#xFF0C;&#x8FD9;&#x6837;&#xFF0C;&#x7A0B;&#x5E8F;&#x7684;&#x5F02;&#x5E38;&#x5C31;&#x89E3;&#x51B3;&#x4E86;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ java ExceptionDemo</span><br><span class="line">Tried to pat: java.lang.RuntimeException: grrr... snarl snarl</span><br><span class="line">Lucy munches the banana</span><br><span class="line"></span><br><span class="line">Lucy enjoys the pat.</span><br><span class="line"></span><br><span class="line">Lucy is a happy Retriever weighing <span class="number">80.0</span> standard lb units.</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>&#x2003;&#x2003;In the real world, this corrective action might be extending an
antenna on a robot when an exception is thrown by an operation expecting
a ready antenna. Or perhaps we simply want to write the error to a log
file for later analysis.</p>
</blockquote>
<h3 id="3&#x5F02;&#x5E38;&#x5904;&#x7406;&#x7684;&#x54F2;&#x5B66;">3.&#x5F02;&#x5E38;&#x5904;&#x7406;&#x7684;&#x54F2;&#x5B66;</h3>
<p>&#x2003;&#x2003;&#x5F02;&#x5E38;&#x5904;&#x7406;&#x4F7F;&#x5F97;&#x6211;&#x4EEC;&#x5728;&#x6982;&#x5FF5;&#x4E0A;&#x5C06;&#x9519;&#x8BEF;&#x5904;&#x7406;(<span class="math inline">\(error\;handling\)</span>)&#x4E0E;&#x5269;&#x4F59;&#x90E8;&#x5206;&#x7684;&#x7A0B;&#x5E8F;&#x5206;&#x79BB;&#x5F00;&#x6765;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x8003;&#x8651;&#x4E0B;&#x9762;&#x7684;&#x7A0B;&#x5E8F;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">func readFile: {</span><br><span class="line">    open the file;</span><br><span class="line">    determine its size;</span><br><span class="line">    allocate that much memory;</span><br><span class="line">    read the file into memory;</span><br><span class="line">    close the file;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5982;&#x679C;&#x4E0D;&#x8FDB;&#x884C;&#x5F02;&#x5E38;&#x5904;&#x7406;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x80FD;&#x4F1A;&#x5BF9;&#x7A0B;&#x5E8F;&#x8FDB;&#x884C;&#x5982;&#x4E0B;&#x6539;&#x5199;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">func readFile: {</span><br><span class="line">    open the file;</span><br><span class="line">    <span class="keyword">if</span> (theFileIsOpen) {</span><br><span class="line">        determine its size;</span><br><span class="line">        <span class="keyword">if</span> (gotTheFileLength) {</span><br><span class="line">            allocate that much memory;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">return</span> error(<span class="string">&quot;fileLengthError&quot;</span>);</span><br><span class="line">        }</span><br><span class="line">            <span class="keyword">if</span> (gotEnoughMemory) {</span><br><span class="line">                read the file into memory;</span><br><span class="line">            <span class="keyword">if</span> (readFailed) {</span><br><span class="line">                <span class="keyword">return</span> error(<span class="string">&quot;readError&quot;</span>);</span><br><span class="line">            }</span><br><span class="line">        ...</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">return</span> error(<span class="string">&quot;memoryError&quot;</span>);</span><br><span class="line">        }</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">return</span> error(<span class="string">&quot;fileOpenError&quot;</span>)</span><br><span class="line">    } </span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x6837;&#x7684;&#x4EE3;&#x7801;&#x5341;&#x5206;&#x5197;&#x6742;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;&#x5F02;&#x5E38;&#x5904;&#x7406;&#x5982;&#x4E0B;&#x4E66;&#x5199;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">func readFile: {</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        open the file;</span><br><span class="line">        determine its size;</span><br><span class="line">        allocate that much memory;</span><br><span class="line">        read the file into memory;</span><br><span class="line">        close the file;</span><br><span class="line">    } <span class="keyword">catch</span> (fileOpenFailed) {</span><br><span class="line">        doSomething;</span><br><span class="line">    } <span class="keyword">catch</span> (sizeDeterminationFailed) {</span><br><span class="line">        doSomething;</span><br><span class="line">    } <span class="keyword">catch</span> (memoryAllocationFailed) {</span><br><span class="line">        doSomething;</span><br><span class="line">    } <span class="keyword">catch</span> (readFailed) {</span><br><span class="line">        doSomething;    </span><br><span class="line">    } <span class="keyword">catch</span> (fileCloseFailed) {</span><br><span class="line">        doSomething;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x5F02;&#x5E38;&#x5904;&#x7406;&#x7684;&#x65B9;&#x6CD5;&#x8BA9;&#x4EE3;&#x7801;&#x5341;&#x5206;&#x6574;&#x6D01;&#xFF1A;&#x9996;&#x5148;&#xFF0C;&#x7A0B;&#x5E8F;&#x5148;&#x5C1D;&#x8BD5;&#x6267;&#x884C;&#x6240;&#x9700;&#x7684;&#x64CD;&#x4F5C;&#xFF1B;&#x7136;&#x540E;&#xFF0C;&#x7A0B;&#x5E8F;&#x5F00;&#x59CB;&#x6355;&#x6349;&#x6240;&#x6709;&#x7684;&#x9519;&#x8BEF;&#x3002;</p>
<blockquote>
<p>&#x2003;&#x2003;Good code feels like a story; it has a certain beauty to its
construction. That clarity makes it easier to both write and maintain
over time.</p>
</blockquote>
<h3 id="4&#x672A;&#x88AB;&#x6355;&#x6349;&#x7684;&#x5F02;&#x5E38;">4.&#x672A;&#x88AB;&#x6355;&#x6349;&#x7684;&#x5F02;&#x5E38;</h3>
<p>&#x2003;&#x2003;&#x5F53;&#x4E00;&#x4E2A;&#x5F02;&#x5E38;&#x88AB;&#x5F15;&#x53D1;&#x65F6;&#xFF0C;&#x5B83;&#x4F1A;&#x5411;&#x4E0B;&#x5386;&#x7ECF;&#x5982;&#x4E0B;&#x7684;&#x6808;&#xFF1A;</p>
<p><img src="/2024/05/31/6.2.Throwing%20Exceptions/image.png"></p>
<p>&#x2003;&#x2003;&#x5982;&#x679C;&#x4E09;&#x4E2A;&#x65B9;&#x6CD5;&#x90FD;&#x6CA1;&#x6709;&#x6355;&#x6349;&#x5230;&#x5F02;&#x5E38;&#xFF0C;&#x7A0B;&#x5E8F;&#x5C31;&#x4F1A;&#x4E2D;&#x65AD;&#xFF0C;<span class="math inline">\(Java\)</span>&#x4F1A;&#x7ED9;&#x7528;&#x6237;&#x53D1;&#x9001;&#x4FE1;&#x606F;&#xFF0C;&#x5E76;&#x6253;&#x5370;&#x5806;&#x6808;&#x8DDF;&#x8E2A;&#x7684;&#x4FE1;&#x606F;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">java.lang.RuntimeException in thread &#x201C;main&#x201D;: </span><br><span class="line">at ArrayRingBuffer.peek:<span class="number">63</span> </span><br><span class="line">at GuitarString.sample:<span class="number">48</span> </span><br><span class="line">at GuitarHeroLite.java:<span class="number">110</span></span><br></pre></td></tr></table></figure></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/6.3.Iteration/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/6.3.Iteration/" class="post-title-link" itemprop="url">6.3.&#x8FED;&#x4EE3;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 17:37:40" itemprop="dateModified" datetime="2024-06-02T17:37:40+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/6-Exception-Iterator-Iterables-Object-Methods/" itemprop="url" rel="index"><span itemprop="name">6.Exception &amp; Iterator &amp; Iterables &amp; Object Methods</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>898</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>3 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="63&#x8FED;&#x4EE3;"><span class="math inline">\(6.3\)</span>&#x8FED;&#x4EE3;</h1>
<h3 id="1&#x589E;&#x5F3A;&#x578B;for&#x5FAA;&#x73AF;">1.&#x589E;&#x5F3A;&#x578B;<span class="math inline">\(for\)</span>&#x5FAA;&#x73AF;</h3>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x4EE5;&#x4E0B;<span class="math inline">\(for\)</span>&#x8BED;&#x53E5;&#x5B9E;&#x73B0;&#x5BF9;&#x6570;&#x7EC4;&#x5143;&#x7D20;&#x7684;&#x904D;&#x5386;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;String&gt; s = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">...</span><br><span class="line"><span class="keyword">for</span> (String city : s) {</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x4E0E;&#x4E0B;&#x9762;&#x7684;&#x7A0B;&#x5E8F;&#x7B49;&#x4EF7;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;String&gt; s = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">...</span><br><span class="line">Iterator&lt;String&gt; seer = s.iterator();</span><br><span class="line"><span class="keyword">while</span> (seer.hasNext()) {</span><br><span class="line">    <span class="type">String</span> <span class="variable">city</span> <span class="operator">=</span> seer.next();</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x4E2A;&#x7A0B;&#x5E8F;&#x7684;&#x5173;&#x952E;&#x5728;&#x4E8E;&#x88AB;&#x79F0;&#x4F5C;&#x8FED;&#x4EE3;&#x5668;(<span class="math inline">\(iterator\)</span>)&#x7684;&#x5BF9;&#x8C61;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x8FED;&#x4EE3;&#x5668;&#x5BF9;&#x8C61;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Iterator&lt;E&gt; <span class="title function_">iterator</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x4F8B;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5982;&#x4E0B;&#x8BED;&#x53E5;&#x5B9E;&#x73B0;&#x5BF9;<span class="math inline">\(List\)</span>&#x7684;&#x8FED;&#x4EE3;&#x904D;&#x5386;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; friends = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">...</span><br><span class="line">Iterator&lt;Integer&gt; seer = friends.iterator();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (seer.hasNext()) {</span><br><span class="line">System.out.println(seer.next());</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x4E2A;&#x8FED;&#x4EE3;&#x5668;&#x6709;&#x4E09;&#x4E2A;&#x5173;&#x952E;&#x65B9;&#x6CD5;&#xFF1A;</p>
<ol type="1">
<li>&#x83B7;&#x5F97;&#x8FED;&#x4EE3;&#x5668;&#x5BF9;&#x8C61;&#xFF1A;<code>Iterator&lt;Integer&gt; seer = friends.iterator();</code>&#x3002;</li>
<li>&#x68C0;&#x6D4B;&#x662F;&#x5426;&#x6709;&#x5BF9;&#x8C61;&#x5269;&#x4F59;&#xFF1A;<code>seer.hasNext()</code>&#x3002;</li>
<li>&#x8FD4;&#x56DE;&#x5F53;&#x524D;&#x5BF9;&#x8C61;&#x3001;&#x5E76;&#x4F7F;&#x8FED;&#x4EE3;&#x5668;&#x524D;&#x8FDB;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF1A;<code>seer.next()</code>&#x3002;</li>
</ol>
<h3 id="2&#x8FED;&#x4EE3;&#x5668;&#x7684;&#x5B9E;&#x73B0;">2.&#x8FED;&#x4EE3;&#x5668;&#x7684;&#x5B9E;&#x73B0;</h3>
<h4 id="a&#x8FED;&#x4EE3;&#x5668;&#x8981;&#x7D20;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&#x8FED;&#x4EE3;&#x5668;&#x8981;&#x7D20;</h4>
<p>&#x2003;&#x2003;&#x9996;&#x5148;&#xFF0C;&#x6211;&#x4EEC;&#x8003;&#x8651;&#x7F16;&#x8BD1;&#x5668;&#x9700;&#x8981;&#x77E5;&#x9053;&#x54EA;&#x4E9B;&#x53EF;&#x8FED;&#x4EE3;&#x5BF9;&#x8C61;&#x7684;&#x4FE1;&#x606F;&#x3002;&#x9996;&#x5148;&#xFF0C;<code>iterator()</code>&#x88AB;&#x8C03;&#x7528;&#x4E86;&#xFF0C;&#x4E8E;&#x662F;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x77E5;&#x9053;&#xFF1A;</p>
<ul>
<li>&#x8BE5;&#x63A5;&#x53E3;&#x5177;&#x6709;<code>iterator()</code>&#x65B9;&#x6CD5;&#x3002;</li>
</ul>
<p>&#x2003;&#x2003;&#x5176;&#x6B21;&#xFF0C;<span class="math inline">\(seer\)</span>&#x7684;<code>.next()</code>&#x4E0E;<code>.hasNext()</code>&#x65B9;&#x6CD5;&#x88AB;&#x8C03;&#x7528;&#x4E86;&#xFF0C;&#x4E8E;&#x662F;&#xFF1A;
*
&#x8FED;&#x4EE3;&#x5668;&#x63A5;&#x53E3;&#x662F;&#x5426;&#x6709;<code>.next()</code>&#x4E0E;<code>.hasNext()</code>&#x65B9;&#x6CD5;&#x3002;</p>
<h4 id="b&#x8FED;&#x4EE3;&#x5668;&#x7684;&#x5B9E;&#x73B0;">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>&#x8FED;&#x4EE3;&#x5668;&#x7684;&#x5B9E;&#x73B0;</h4>
<ol type="1">
<li><p>&#x6211;&#x4EEC;&#x7684;<span class="math inline">\(List\)</span>&#x63A5;&#x53E3;&#x9700;&#x8981;&#x6269;&#x5C55;&#x8FED;&#x4EE3;&#x5668;&#x63A5;&#x53E3;&#xFF0C;&#x7EE7;&#x627F;&#x8FED;&#x4EE3;&#x5668;&#x7684;&#x62BD;&#x8C61;&#x65B9;&#x6CD5;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Iterable</span>&lt;T&gt; {</span><br><span class="line">    Iterator&lt;T&gt; <span class="title function_">iterator</span><span class="params">()</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">List</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">Iterable</span>&lt;T&gt; {</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p></li>
<li><p>&#x7F16;&#x8BD1;&#x5668;&#x68C0;&#x67E5;&#x8FED;&#x4EE3;&#x5668;&#x63A5;&#x53E3;&#x662F;&#x5426;&#x5177;&#x6709;<code>.next()</code>&#x4E0E;<code>.hasNext()</code>&#x65B9;&#x6CD5;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Iterator</span>&lt;T&gt; {</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span>;</span><br><span class="line">    T <span class="title function_">next</span><span class="params">()</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p></li>
</ol>
<p>&#x2003;&#x2003;&#x7279;&#x5B9A;&#x7684;&#x7C7B;&#x9700;&#x8981;&#x5B9E;&#x73B0;&#x81EA;&#x5DF1;&#x7684;&#x8FED;&#x4EE3;&#x5668;&#x65B9;&#x6CD5;&#x4E0E;&#x884C;&#x4E3A;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x60F3;&#x7ED9;<span class="math inline">\(ArrarMap\)</span>&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x8FED;&#x4EE3;&#x5668;&#x3002;&#x53EF;&#x4EE5;&#x5148;&#x5982;&#x4E0B;&#x5B9E;&#x73B0;&#x8FED;&#x4EE3;&#x5668;&#x63A5;&#x53E3;&#x6240;&#x9700;&#x65B9;&#x6CD5;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">ArraySetIterator</span> <span class="keyword">implements</span> <span class="title class_">Iterator</span>&lt;T&gt; {</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> wizPos;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ArraySetIterator</span><span class="params">()</span> {</span><br><span class="line">        wizPos = <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> wizPos &lt; size;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">next</span><span class="params">()</span> {</span><br><span class="line">        <span class="type">T</span> <span class="variable">returnItem</span> <span class="operator">=</span> items[wizPos];</span><br><span class="line">        wizPos += <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> returnItem;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5229;&#x7528;<span class="math inline">\(ArraySetIterator\)</span>&#x6765;&#x5B9E;&#x73B0;&#x5BF9;<span class="math inline">\(ArrayMap\)</span>&#x7684;&#x8FED;&#x4EE3;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ArraySet&lt;Integer&gt; aset = <span class="keyword">new</span> <span class="title class_">ArraySet</span>&lt;&gt;();</span><br><span class="line">aset.add(<span class="number">5</span>);</span><br><span class="line">aset.add(<span class="number">23</span>);</span><br><span class="line">aset.add(<span class="number">42</span>);</span><br><span class="line"></span><br><span class="line">Iterator&lt;Integer&gt; iter = aset.iterator();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(iter.hasNext()) {</span><br><span class="line">    System.out.println(iter.next());</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h4 id="c&#x589E;&#x5F3A;&#x578B;for&#x5FAA;&#x73AF;&#x7684;&#x5B9E;&#x73B0;">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>&#x589E;&#x5F3A;&#x578B;<span class="math inline">\(for\)</span>&#x5FAA;&#x73AF;&#x7684;&#x5B9E;&#x73B0;</h4>
<p>&#x2003;&#x2003;&#x4E3A;&#x4E86;&#x5B9E;&#x73B0;&#x589E;&#x5F3A;&#x578B;<span class="math inline">\(for\)</span>&#x5FAA;&#x73AF;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8BA9;<span class="math inline">\(ArrayMap\)</span>&#x7C7B;&#x5B9E;&#x73B0;&#x53EF;&#x8FED;&#x4EE3;&#x63A5;&#x53E3;&#x3002;&#x53EF;&#x8FED;&#x4EE3;&#x63A5;&#x53E3;&#x7684;&#x5173;&#x952E;&#x65B9;&#x6CD5;&#x662F;<code>iterator</code>&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x5982;&#x4E0B;&#x5B9E;&#x73B0;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Iterator&lt;T&gt; <span class="title function_">iterator</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArraySetIterator</span>();</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x6837;&#x4EE5;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x589E;&#x5F3A;&#x578B;<span class="math inline">\(for\)</span>&#x5FAA;&#x73AF;&#x4E86;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ArraySet&lt;Integer&gt; aset = <span class="keyword">new</span> <span class="title class_">ArraySet</span>&lt;&gt;();</span><br><span class="line">...</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i : aset) {</span><br><span class="line">    System.out.println(i);</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h4 id="d&#x5173;&#x952E;&#x6982;&#x5FF5;&#x8FA8;&#x6790;">&#x2003;&#x2003;<span class="math inline">\(d.\)</span>&#x5173;&#x952E;&#x6982;&#x5FF5;&#x8FA8;&#x6790;</h4>
<ul>
<li><p>&#x53EF;&#x8FED;&#x4EE3;&#x5BF9;&#x8C61;(<span class="math inline">\(iterable\)</span>)&#xFF1A;&#x4F7F;&#x5F97;&#x4E00;&#x4E2A;&#x7C7B;&#x53EF;&#x4EE5;&#x88AB;&#x8FED;&#x4EE3;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x9700;&#x8981;&#x65B9;&#x6CD5;<code>iterator()</code>&#x3002;</p></li>
<li><p>&#x8FED;&#x4EE3;&#x5668;(<span class="math inline">\(iterator\)</span>)&#xFF1A;&#x5B9A;&#x4E49;&#x67D0;&#x4E9B;&#x65B9;&#x6CD5;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x7528;&#x4E8E;&#x5B9E;&#x73B0;&#x771F;&#x6B63;&#x7684;&#x8FED;&#x4EE3;&#x3002;</p></li>
</ul>
<blockquote>
<p>&#x2003;&#x2003; You can think of an Iterator as a machine that you put onto an
iterable that facilitates the iteration. Any iterable is the object on
which the iterator is performing.</p>
</blockquote>
<h3 id="3&#x53EF;&#x8FED;&#x4EE3;arrayset&#x7684;&#x5B8C;&#x6574;&#x5B9E;&#x73B0;">3.&#x53EF;&#x8FED;&#x4EE3;<span class="math inline">\(ArraySet\)</span>&#x7684;&#x5B8C;&#x6574;&#x5B9E;&#x73B0;</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArraySet</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Iterable</span>&lt;T&gt; {</span><br><span class="line">    <span class="keyword">private</span> T[] items;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> size; <span class="comment">// the next item to be added will be at position size</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ArraySet</span><span class="params">()</span> {</span><br><span class="line">        items = (T[]) <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">100</span>];</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Returns true if this map contains a mapping for the specified key.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">contains</span><span class="params">(T x)</span> {</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i += <span class="number">1</span>) {</span><br><span class="line">            <span class="keyword">if</span> (items[i].equals(x)) {</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Associates the specified value with the specified key in this map.</span></span><br><span class="line"><span class="comment">       Throws an IllegalArgumentException if the key is null. */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(T x)</span> {</span><br><span class="line">        <span class="keyword">if</span> (x == <span class="literal">null</span>) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;can&apos;t add null&quot;</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (contains(x)) {</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        items[size] = x;</span><br><span class="line">        size += <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Returns the number of key-value mappings in this map. */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** returns an iterator (a.k.a. seer) into ME */</span></span><br><span class="line">    <span class="keyword">public</span> Iterator&lt;T&gt; <span class="title function_">iterator</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArraySetIterator</span>();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">ArraySetIterator</span> <span class="keyword">implements</span> <span class="title class_">Iterator</span>&lt;T&gt; {</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> wizPos;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">ArraySetIterator</span><span class="params">()</span> {</span><br><span class="line">            wizPos = <span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> {</span><br><span class="line">            <span class="keyword">return</span> wizPos &lt; size;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> T <span class="title function_">next</span><span class="params">()</span> {</span><br><span class="line">            <span class="type">T</span> <span class="variable">returnItem</span> <span class="operator">=</span> items[wizPos];</span><br><span class="line">            wizPos += <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">return</span> returnItem;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        ArraySet&lt;Integer&gt; aset = <span class="keyword">new</span> <span class="title class_">ArraySet</span>&lt;&gt;();</span><br><span class="line">        aset.add(<span class="number">5</span>);</span><br><span class="line">        aset.add(<span class="number">23</span>);</span><br><span class="line">        aset.add(<span class="number">42</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//iteration</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i : aset) {</span><br><span class="line">            System.out.println(i);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/6.4.Object%20Methods/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/6.4.Object%20Methods/" class="post-title-link" itemprop="url">6.4.&#x5BF9;&#x8C61;&#x65B9;&#x6CD5;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 17:38:27" itemprop="dateModified" datetime="2024-06-02T17:38:27+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/6-Exception-Iterator-Iterables-Object-Methods/" itemprop="url" rel="index"><span itemprop="name">6.Exception &amp; Iterator &amp; Iterables &amp; Object Methods</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>638</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="64&#x5BF9;&#x8C61;&#x65B9;&#x6CD5;"><span class="math inline">\(6.4\)</span>&#x5BF9;&#x8C61;&#x65B9;&#x6CD5;</h1>
<h3 id="1&#x5BF9;&#x8C61;&#x65B9;&#x6CD5;&#x6982;&#x8FF0;">1.&#x5BF9;&#x8C61;&#x65B9;&#x6CD5;&#x6982;&#x8FF0;</h3>
<p>&#x2003;&#x2003;&#x6240;&#x6709;&#x7684;&#x7C7B;&#x90FD;&#x7EE7;&#x627F;&#x4E86;<span class="math inline">\(Object\)</span>&#x7C7B;&#x3002;&#x5B83;&#x4EEC;&#x7EE7;&#x627F;&#x7684;&#x65B9;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>String toString()</li>
<li>boolean equals(Object obj)</li>
<li>Class &lt;?&gt; getClass()</li>
<li>int hashCode()</li>
<li>protected Objectclone()</li>
<li>protected void finalize()</li>
<li>void notify()</li>
<li>void notifyAll()</li>
<li>void wait()</li>
<li>void wait(long timeout)</li>
<li>void wait(long timeout, int nanos)</li>
</ul>
<p>&#x2003;&#x2003;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x91CD;&#x70B9;&#x8BA8;&#x8BBA;&#x524D;&#x4E24;&#x4E2A;&#x3002;</p>
<h3 id="2tostring">2.<code>toString()</code></h3>
<p>&#x2003;&#x2003;<code>toString</code>&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x8868;&#x793A;&#x3002;&#x5BF9;&#x4E8E;&#x7279;&#x5B9A;&#x7684;&#x7C7B;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8986;&#x76D6;&#x5BF9;&#x8C61;&#x539F;&#x6709;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x8003;&#x8651;&#x4E0B;&#x9762;&#x7684;&#x95EE;&#x9898;&#xFF1A;</p>
<p>&#x2003;&#x2003;Exercise 6.4.1: Write the toString() method so that when we print
an ArraySet, it prints the elements separated by commas inside of curly
braces. i.e {1, 2, 3, 4}. Remember, the toString() method should return
a string: <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> {</span><br><span class="line">    <span class="comment">/* hmmm */</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;<span class="math inline">\(solution\)</span>&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> {</span><br><span class="line">    <span class="type">String</span> <span class="variable">returnString</span> <span class="operator">=</span> <span class="string">&quot;{&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i += <span class="number">1</span>) {</span><br><span class="line">        returnString += keys[i];</span><br><span class="line">        returnString += <span class="string">&quot;, &quot;</span>;</span><br><span class="line">    }</span><br><span class="line">    returnString += <span class="string">&quot;}&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> returnString;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x8FD9;&#x79CD;&#x5199;&#x6CD5;&#x770B;&#x4F3C;&#x7B80;&#x6D01;&#x4F18;&#x96C5;&#xFF0C;&#x4F46;&#x6BCF;&#x6B21;&#x4F7F;&#x7528;<code>+=</code>&#x8FD0;&#x7B97;&#x7B26;&#x540E;&#xFF0C;&#x90FD;&#x9700;&#x8981;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A;<span class="math inline">\(O(n^2)\)</span>&#x3002;&#x4E3A;&#x4E86;&#x4F18;&#x5316;&#x8BE5;&#x65B9;&#x6CD5;&#xFF0C;<span class="math inline">\(Java\)</span>&#x5185;&#x7F6E;&#x4E86;<code>StringBuilder</code>&#x65B9;&#x6CD5;&#x3002;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x521B;&#x9020;&#x4E00;&#x4E2A;<span class="math inline">\(String\)</span>&#x7684;&#x53EF;&#x53D8;&#x5BF9;&#x8C61;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5411;&#x5BF9;&#x8C61;&#x5185;&#x6DFB;&#x52A0;&#x5176;&#x5B83;<span class="math inline">\(String\)</span>&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> {</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">returnSB</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(<span class="string">&quot;{&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size - <span class="number">1</span>; i += <span class="number">1</span>) {</span><br><span class="line">            returnSB.append(items[i].toString());</span><br><span class="line">            returnSB.append(<span class="string">&quot;, &quot;</span>);</span><br><span class="line">        }</span><br><span class="line">        returnSB.append(items[size - <span class="number">1</span>]);</span><br><span class="line">        returnSB.append(<span class="string">&quot;}&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> returnSB.toString();</span><br><span class="line">    }</span><br></pre></td></tr></table></figure></p>
<h3 id="3equals">3.<code>equals()</code></h3>
<h4 id="aequals&#x7684;&#x5B9E;&#x73B0;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span><code>equals()</code>&#x7684;&#x5B9E;&#x73B0;</h4>
<p>&#x2003;&#x2003;&#x5728;<span class="math inline">\(Java\)</span>&#x4E2D;&#xFF0C;<code>==</code>&#x68C0;&#x67E5;&#x4E24;&#x4E2A;&#x5BF9;&#x8C61;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x662F;&#x5426;&#x4E3A;&#x540C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x3002;&#x7531;&#x4E4B;&#x524D;<span class="math inline">\(pass-by-value\)</span>&#x539F;&#x5219;&#xFF0C;<code>==</code>&#x4F1A;&#x68C0;&#x67E5;&#x4E24;&#x4E2A;&#x76D2;&#x5B50;&#x653E;&#x7684;&#x662F;&#x4E0D;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x4E1C;&#x897F;&#xFF1A;</p>
<ul>
<li>&#x5BF9;&#x4E8E;&#x57FA;&#x672C;&#x7C7B;&#x578B;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x8FD9;&#x8868;&#x793A;&#x6BD4;&#x8F83;&#x5B83;&#x4EEC;&#x7684;&#x503C;&#x662F;&#x5426;&#x76F8;&#x7B49;&#x3002;</li>
<li>&#x5BF9;&#x4E8E;&#x5BF9;&#x8C61;(<span class="math inline">\(objects\)</span>)&#xFF0C;&#x8FD9;&#x8868;&#x793A;&#x6BD4;&#x8F83;&#x4E24;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x5730;&#x5740;&#x6216;&#x6307;&#x9488;&#x662F;&#x5426;&#x76F8;&#x7B49;&#x3002;</li>
</ul>
<p>&#x2003;&#x2003;&#x800C;<code>equals()</code>&#x65B9;&#x6CD5;&#x5728;&#x6BD4;&#x8F83;&#x5BF9;&#x8C61;&#x65F6;&#xFF0C;&#x53EA;&#x4F1A;&#x6BD4;&#x8F83;&#x4E24;&#x8005;&#x7684;&#x503C;&#x662F;&#x5426;&#x76F8;&#x7B49;&#xFF0C;&#x8FD9;&#x4FBF;&#x662F;&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x5B83;&#x7684;&#x76EE;&#x7684;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5982;&#x4E0B;&#x5B9E;&#x73B0;<span class="math inline">\(ArraySet\)</span>&#x7684;<code>equals()</code>&#x65B9;&#x6CD5;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object other)</span> {</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span> == other) {</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (other == <span class="literal">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (other.getClass() != <span class="built_in">this</span>.getClass()) {</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        ArraySet&lt;T&gt; o = (ArraySet&lt;T&gt;) other;</span><br><span class="line">        <span class="keyword">if</span> (o.size() != <span class="built_in">this</span>.size()) {</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (T item : <span class="built_in">this</span>) {</span><br><span class="line">            <span class="keyword">if</span> (!o.contains(item)) {</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    }</span><br></pre></td></tr></table></figure> &#x2003;&#x2003;&#x5728;&#x4E0A;&#x9762;&#x7684;<code>equals()</code>&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x52A0;&#x5165;&#x4E86;&#x5BF9;<span class="math inline">\(null\)</span>&#x4E0E;&#x8DE8;&#x7C7B;&#x5BF9;&#x8C61;&#x7684;&#x6BD4;&#x8F83;&#x7684;&#x5224;&#x65AD;&#x3002;&#x6211;&#x4EEC;&#x4E5F;&#x901A;&#x8FC7;&#x9884;&#x5148;&#x5224;&#x65AD;<code>==</code>&#x7684;&#x60C5;&#x51B5;&#x4F18;&#x5316;&#x4E86;&#x65B9;&#x6CD5;&#x3002;</p>
<h4 id="bequals&#x65B9;&#x6CD5;&#x7684;&#x89C4;&#x5219;">&#x2003;&#x2003;<span class="math inline">\(b.\)</span><code>equals()</code>&#x65B9;&#x6CD5;&#x7684;&#x89C4;&#x5219;</h4>
<p>&#x2003;&#x2003;<code>equals()</code>&#x65B9;&#x6CD5;&#x8981;&#x7B26;&#x5408;&#x4EE5;&#x4E0B;&#x89C4;&#x5219;&#xFF1A;</p>
<ol type="1">
<li>&#x53CD;&#x8EAB;&#x6027;(<span class="math inline">\(reflexive\)</span>)&#xFF1A;<code>x.equals(x) == true</code>&#x3002;</li>
<li>&#x5BF9;&#x79F0;&#x6027;(<span class="math inline">\(symmetric\)</span>)&#xFF1A;<code>x.equals(y) == true</code>&#x5F53;&#x4E14;&#x4EC5;&#x5F53;<code>y.equals(x) == true</code>&#x3002;</li>
<li>&#x4F20;&#x9012;&#x6027;(<span class="math inline">\(transitive\)</span>)&#xFF1A;<code>x.equals(y), y.equals(z) == true</code>&#xFF0C;&#x5219;<code>x.equals(z) == true</code>&#x3002;</li>
<li><code>x.equals(null) == false</code>&#xFF0C;&#x4E0D;&#x8BBA;<span class="math inline">\(x\)</span>&#x662F;&#x4EC0;&#x4E48;&#x3002;</li>
<li><code>equals()</code>&#x65B9;&#x6CD5;&#x7684;&#x53C2;&#x6570;&#x5FC5;&#x987B;&#x662F;<span class="math inline">\(object\)</span>&#x578B;&#x7684;&#xFF0C;&#x8FD9;&#x6837;&#x624D;&#x80FD;&#x8986;&#x76D6;&#x539F;&#x6709;&#x7684;<code>.equals()</code>&#x65B9;&#x6CD5;&#x3002;</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/8.2.Asymptotics%20I/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/8.2.Asymptotics%20I/" class="post-title-link" itemprop="url">8.2.&#x6E10;&#x8FDB;&#x5206;&#x6790;&#x4ECB;&#x7ECD;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 17:46:49" itemprop="dateModified" datetime="2024-06-02T17:46:49+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/8-Effecient-Programming/" itemprop="url" rel="index"><span itemprop="name">8.Effecient Programming</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>200</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="82&#x6E10;&#x8FDB;&#x5206;&#x6790;&#x4ECB;&#x7ECD;"><span class="math inline">\(8.2\)</span>
&#x6E10;&#x8FDB;&#x5206;&#x6790;&#x4ECB;&#x7ECD;</h1>
<h3 id="1&#x7B80;&#x5316;&#x7684;&#x5206;&#x6790;&#x6D41;&#x7A0B;">1.&#x7B80;&#x5316;&#x7684;&#x5206;&#x6790;&#x6D41;&#x7A0B;</h3>
<blockquote>
<p>We can do the following steps to simplify our analysis: * Only
consider the worst case. * Pick a representative operation (aka: cost
model) * Ignore lower order terms * Ignore multiplicative constants.</p>
</blockquote>
<h3 id="2big-theta">2.<span class="math inline">\(Big-Theta\)</span></h3>
<p>&#x2003;&#x2003;&#x5F53;&#x5BF9;&#x4E8E;&#x4EFB;&#x4E00;&#x6BD4;<span class="math inline">\(N_0\)</span>&#x5927;&#x7684;<span class="math inline">\(N\)</span>&#xFF0C;&#x5B58;&#x5728;<span class="math inline">\(k_1\)</span>&#x3001;<span class="math inline">\(k_2\)</span>&#x4F7F;&#x5F97;<span class="math inline">\(k_1&#xB7;f(N)\leq R(N)\leq
k_2&#xB7;f(N)\)</span>&#xFF0C;&#x90A3;&#x4E48;&#xFF1A;<span class="math inline">\(R(N)\in
\Theta(f(N))\)</span>&#x3002;</p>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;<span class="math inline">\(\Theta\)</span>&#x6765;&#x8861;&#x91CF;&#x7A0B;&#x5E8F;&#x7684;&#x589E;&#x957F;&#x9636;&#x6570;&#xFF0C;&#x901A;&#x8FC7;&#x786E;&#x5B9A;&#x589E;&#x957F;&#x51FD;&#x6570;&#x7684;&#x4E0A;&#x754C;&#x548C;&#x4E0B;&#x754C;&#xFF0C;&#x6211;&#x4EEC;&#x76F8;&#x5F53;&#x4E8E;&#x201C;&#x786E;&#x5B9A;&#x201D;&#x4E86;&#x589E;&#x957F;&#x51FD;&#x6570;&#x3002;</p>
<h3 id="3big-o">3.<span class="math inline">\(Big-O\)</span></h3>
<p>&#x2003;&#x2003;<span class="math inline">\(O\)</span>&#x53EF;&#x4EE5;&#x770B;&#x4F5C;&#x662F;&#x589E;&#x957F;&#x51FD;&#x6570;&#x7684;&#x201C;&#x4E0D;&#x7B49;&#x5173;&#x7CFB;&#x201D;&#xFF0C;&#x5373;&#x201C;&#x5927;&#x4E8E;&#x7B49;&#x4E8E;&#x201D;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8BF4;<span class="math inline">\(R(N)\in O(f(n^2))\)</span>&#x3002;</p>
<p>&#x2003;&#x2003;&#x4E00;&#x822C;&#x5730;&#xFF0C;&#x5982;&#x679C;&#x5BF9;&#x4E8E;&#x4EFB;&#x4E00;&#x6BD4;<span class="math inline">\(N_0\)</span>&#x5927;&#x7684;<span class="math inline">\(N\)</span>&#xFF0C;&#x5B58;&#x5728;<span class="math inline">\(k_1\)</span>&#x4F7F;&#x5F97;<span class="math inline">\(R(N)\leq k_1&#xB7;f(N)\)</span>&#xFF0C;&#x6709;&#xFF1A;<span class="math inline">\(R(n)\in O(f(n))\)</span>&#x3002;</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/8.4.Omega,Amortized%20Analysis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/8.4.Omega,Amortized%20Analysis/" class="post-title-link" itemprop="url">8.4.&#x644A;&#x8FD8;&#x5206;&#x6790;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 17:45:01" itemprop="dateModified" datetime="2024-06-02T17:45:01+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/8-Effecient-Programming/" itemprop="url" rel="index"><span itemprop="name">8.Effecient Programming</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>838</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>3 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="84&#x644A;&#x8FD8;&#x5206;&#x6790;"><span class="math inline">\(8.4\)</span>&#x644A;&#x8FD8;&#x5206;&#x6790;</h1>
<h3 id="1big-omega">1.<span class="math inline">\(Big-Omega\)</span></h3>
<p>&#x2003;&#x2003;&#x4E0E;<span class="math inline">\(O\)</span>&#x76F8;&#x540C;&#xFF0C;<span class="math inline">\(\Omega\)</span>&#x63CF;&#x8FF0;&#x7684;&#x4E5F;&#x662F;&#x4E0D;&#x7B49;&#x5173;&#x7CFB;&#xFF1A;&#x5982;&#x679C;&#x5BF9;&#x4E8E;&#x4EFB;&#x4E00;&#x6BD4;<span class="math inline">\(N_0\)</span>&#x5927;&#x7684;<span class="math inline">\(N\)</span>&#xFF0C;&#x5B58;&#x5728;<span class="math inline">\(k_1\)</span>&#x4F7F;&#x5F97;<span class="math inline">\(R(N)\geq k_1&#xB7;f(N)\)</span>&#xFF0C;&#x6709;&#xFF1A;<span class="math inline">\(R(n)\in \Omega(f(n))\)</span>&#x3002;</p>
<p>&#x2003;&#x2003;&#x5173;&#x4E8E;<span class="math inline">\(\Omega\)</span>&#x6709;&#x4EE5;&#x4E0B;&#x4E24;&#x4E2A;&#x7ED3;&#x8BBA;&#xFF1A;</p>
<ul>
<li><span class="math inline">\(R(n)=O(f(n)),R(n)=\Omega(f(n))\Rightarrow
R(n)=\Theta(f(n))\)</span>&#x3002;</li>
<li>&#x5B83;&#x7528;&#x4E8E;&#x5206;&#x6790;&#x7B97;&#x6CD5;&#x7684;&#x57FA;&#x672C;&#x590D;&#x6742;&#x5EA6;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5BF9;&#x4E8E;&#x91CD;&#x590D;&#x67E5;&#x627E;&#x95EE;&#x9898;(<span class="math inline">\(duplicate-finding\)</span>)&#xFF0C;&#x6709;<span class="math inline">\(R(n)=\Omega(n)\)</span>&#xFF0C;&#x8FD9;&#x8BF4;&#x660E;&#x8BE5;&#x95EE;&#x9898;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x6700;&#x5C0F;&#x4E0D;&#x5F97;&#x8D85;&#x8FC7;<span class="math inline">\(n\)</span>(&#x56E0;&#x4E3A;&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#x81F3;&#x5C11;&#x8981;&#x904D;&#x5386;&#x4E00;&#x6B21;)&#x3002;</li>
</ul>
<p><img src="/2024/05/31/8.4.Omega,Amortized%20Analysis/image.png"></p>
<h3 id="2&#x644A;&#x8FD8;&#x5206;&#x6790;">2.&#x644A;&#x8FD8;&#x5206;&#x6790;</h3>
<h4 id="a&#x644A;&#x8FD8;&#x5206;&#x6790;&#x7684;&#x5F15;&#x5165;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&#x644A;&#x8FD8;&#x5206;&#x6790;&#x7684;&#x5F15;&#x5165;</h4>
<p>&#x2003;&#x2003;&#x8003;&#x8651;&#x4E0B;&#x9762;&#x7684;&#x95EE;&#x9898;&#xFF1A;</p>
<p>&#x2003;&#x2003;<span class="math inline">\(e.g.\)</span>There are two choices to
feed Grigometh:</p>
<ul>
<li><p>Choice 1: Every day, Grigometh eats 3 bushels of hay from your
urn.</p></li>
<li><p>Choice 2:Grigometh eats exponentially more hay over time, but
comes exponentially less frequently. Specifically:</p>
<ul>
<li>On day 1, he eats 1 bushel of hay (total 1)</li>
<li>On day 2, he eats 2 additional bushels of hay (total 3)</li>
<li>On day 4, he eats 4 additional bushels of hay (total 7)</li>
<li>On day 8, he eats 8 additional bushels of hay (total 15)</li>
</ul></li>
</ul>
<p>&#x2003;&#x2003;&#x9009;&#x62E9;<span class="math inline">\(1\)</span>&#x6BCF;&#x6B21;&#x53EA;&#x7528;&#x653E;&#x7F6E;&#x5E38;&#x6570;&#x4E2A;&#x5E72;&#x8349;&#xFF0C;&#x7136;&#x800C;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;&#x9009;&#x62E9;<span class="math inline">\(2\)</span>&#x9700;&#x8981;&#x7684;&#x5E72;&#x8349;&#x6570;&#x91CF;&#x66F4;&#x5C11;&#xFF0C;&#x56E0;&#x4E3A;&#xFF1A;</p>
<ul>
<li>On day 1, the average hay per day is 1.</li>
<li>On day 2, the average hay per day is 1.5.</li>
<li>On day 3, the average hay per day is 1.75.</li>
<li>On day 4, the average hay per day is 1.875.</li>
</ul>
<p>&#x2003;&#x2003;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x91C7;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#x662F;&#x5C06;&#x6240;&#x6709;&#x5929;&#x6570;&#x5E72;&#x8349;&#x7684;&#x603B;&#x548C;&#x201C;&#x5747;&#x644A;&#x201D;&#x5230;&#x6BCF;&#x4E00;&#x5929;&#x3002;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x9009;&#x62E9;<span class="math inline">\(2\)</span>&#x7684;&#x6BCF;&#x65E5;&#x5E72;&#x8349;&#x6D88;&#x8017;&#x91CF;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x5E38;&#x6570;&#x3002;&#x6211;&#x4EEC;&#x5C06;&#x9009;&#x62E9;<span class="math inline">\(2\)</span>&#x7684;&#x60C5;&#x51B5;&#x79F0;&#x4E3A;&#x5747;&#x644A;&#x5E38;&#x6570;&#x3002;</p>
<h4 id="b&#x644A;&#x8FD8;&#x5206;&#x6790;&#x7684;&#x6D41;&#x7A0B;">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>&#x644A;&#x8FD8;&#x5206;&#x6790;&#x7684;&#x6D41;&#x7A0B;</h4>
<p>&#x2003;&#x2003;&#x66F4;&#x4E3A;&#x4E25;&#x8C28;&#x7684;&#x644A;&#x8FD8;&#x5206;&#x6790;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;</p>
<ol type="1">
<li>&#x9009;&#x62E9;&#x4E00;&#x4E2A;&#x8017;&#x8D39;&#x6A21;&#x578B;(<span class="math inline">\(cost\;model\)</span>)&#x3002;</li>
<li>&#x8BA1;&#x7B97;&#x7B2C;<span class="math inline">\(i\)</span>&#x6B21;&#x64CD;&#x4F5C;&#x540E;&#x7684;&#x5E73;&#x5747;&#x8017;&#x8D39;&#x3002;</li>
<li>&#x8BC1;&#x660E;&#x5E73;&#x5747;&#x8017;&#x8D39;&#x4EE5;&#x5E38;&#x6570;&#x4E3A;&#x8FB9;&#x754C;(<span class="math inline">\(bound\)</span>)&#x3002;</li>
</ol>
<p>&#x2003;&#x2003;&#x4EE5;&#x6211;&#x4EEC;&#x7684;&#x6570;&#x7EC4;&#x6269;&#x5BB9;&#x4E3A;&#x4F8B;&#xFF0C;&#x5BF9;&#x4E8E;&#x6570;&#x7EC4;&#x6269;&#x5BB9;&#xFF0C;&#x6211;&#x4EEC;&#x6BCF;&#x6B21;&#x9700;&#x8981;&#x6267;&#x884C;&#x7684;&#x64CD;&#x4F5C;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>x.add(0) performs 1 write operation. No resizing. Total: 1
operation</li>
<li>x.add(1) resizes and copies the existing array (1 read, 1 write),
and then writes the new element. Total: 3 operations</li>
<li>x.add(2) resizes and copies the existing array (2 reads, 2 writes),
and then writes the new element. Total: 5 operations</li>
<li>x.add(3) does not resize, and only writes the new element. Total: 1
operations</li>
<li>x.add(4) resizes and copies the existing array (4 reads, 4 writes),
and then writes the new element. Total: 9 operations</li>
</ul>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5217;&#x51FA;&#x5982;&#x4E0B;&#x7684;&#x8868;&#x683C;&#xFF1A;</p>
<p><img src="/2024/05/31/8.4.Omega,Amortized%20Analysis/image-1.png"></p>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x5F15;&#x5165;&#x201C;&#x52BF;&#x80FD;&#x201D;(<span class="math inline">\(potential\)</span>)&#x7684;&#x6982;&#x5FF5;&#x3002;&#x5BF9;&#x4E8E;&#x6BCF;&#x4E2A;&#x64CD;&#x4F5C;<span class="math inline">\(i\)</span>&#xFF0C;&#x4EE4;<span class="math inline">\(c_i\)</span>&#x4E3A;&#x8BE5;&#x64CD;&#x4F5C;&#x7684;&#x771F;&#x5B9E;&#x65F6;&#x95F4;&#x8017;&#x8D39;&#xFF0C;&#x4EE4;<span class="math inline">\(a_i\)</span>&#x4E3A;&#x4EFB;&#x4E00;&#x644A;&#x8FD8;&#x65F6;&#x95F4;&#x6D88;&#x8017;&#x3002;&#x5BF9;&#x4E8E;&#x5E38;&#x6570;&#x65F6;&#x95F4;&#x6D88;&#x8017;&#xFF0C;<span class="math inline">\(a_i\)</span>&#x4E5F;&#x5FC5;&#x987B;&#x662F;&#x5E38;&#x6570;&#x3002;</p>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x4EE4;<span class="math inline">\(\Phi_i\)</span>&#x4E3A;&#x64CD;&#x4F5C;<span class="math inline">\(i\)</span>&#x7684;&#x52BF;&#x80FD;&#xFF0C;&#x7528;&#x4E8E;&#x8868;&#x793A;&#x644A;&#x8FD8;&#x6D88;&#x8017;&#x548C;&#x771F;&#x5B9E;&#x6D88;&#x8017;&#x95F4;&#x7684;&#x7D2F;&#x79EF;&#x5DEE;&#x8DDD;(<span class="math inline">\(difference\)</span>)&#xFF0C;&#x5219;&#xFF1A;<span class="math inline">\(\Phi_i=\Phi_{i-1}+a_i-c_i\)</span>&#x3002;</p>
<p>&#x2003;&#x2003;<span class="math inline">\(a_i\)</span>&#x53EF;&#x4EE5;&#x662F;&#x4EFB;&#x4E00;&#x6211;&#x4EEC;&#x9009;&#x62E9;&#x7684;&#x6570;&#x3002;&#x5982;&#x679C;&#x5BF9;&#x4E8E;&#x6211;&#x4EEC;&#x9009;&#x62E9;&#x7684;<span class="math inline">\(a_i\)</span>&#xFF0C;<span class="math inline">\(\Phi_i\)</span>&#x6C38;&#x8FDC;&#x662F;&#x975E;&#x8D1F;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x9884;&#x6D4B;&#x7684;&#x644A;&#x8FD8;&#x6D88;&#x8017;&#x5C31;&#x662F;&#x5B9E;&#x9645;&#x6D88;&#x8017;&#x7684;&#x4E0A;&#x754C;&#x3002;&#x5982;&#x679C;<span class="math inline">\(a_i\)</span>&#x4E3A;&#x4E00;&#x4E2A;&#x6C38;&#x8FDC;&#x4E0D;&#x53D8;&#x7684;&#x5E38;&#x6570;&#xFF0C;&#x90A3;&#x4E48;&#x5B9E;&#x9645;&#x6D88;&#x8017;&#x5C31;&#x662F;&#x4EE5;&#x5E38;&#x6570;&#x65F6;&#x95F4;&#x4E3A;&#x4E0A;&#x754C;&#xFF0C;&#x8FD9;&#x5373;&#x8BF4;&#x660E;&#x8BE5;&#x51FD;&#x6570;&#x7684;&#x5E73;&#x5747;&#x65F6;&#x95F4;&#x6D88;&#x8017;&#x4E3A;&#x5E38;&#x6570;&#xFF01;</p>
<p>&#x2003;&#x2003;&#x5BF9;&#x4E8E;&#x6570;&#x7EC4;&#x6269;&#x5BB9;&#xFF0C;&#x53EF;&#x4EE5;&#x5217;&#x51FA;&#x4EE5;&#x4E0B;&#x8868;&#x683C;&#xFF1A;</p>
<p><img src="/2024/05/31/8.4.Omega,Amortized%20Analysis/image-2.png"></p>
<p>&#x2003;&#x2003;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x52BF;&#x80FD;&#x4E00;&#x76F4;&#x662F;&#x975E;&#x8D1F;&#x7684;&#x3002;&#x8FD9;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5BA3;&#x79F0;&#xFF1A;&#x6570;&#x7EC4;&#x6269;&#x5BB9;&#x7684;&#x64CD;&#x4F5C;&#x7684;&#x644A;&#x8FD8;&#x65F6;&#x95F4;&#x662F;&#x5E38;&#x6570;&#x3002;</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/9.1.Introduction%20to%20Disjoint%20Sets/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/9.1.Introduction%20to%20Disjoint%20Sets/" class="post-title-link" itemprop="url">9.1.&#x5E76;&#x67E5;&#x96C6;&#x4ECB;&#x7ECD;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 17:51:08" itemprop="dateModified" datetime="2024-06-02T17:51:08+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/9-Disjoint-sets/" itemprop="url" rel="index"><span itemprop="name">9.Disjoint sets</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>43</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="91&#x5E76;&#x67E5;&#x96C6;&#x4ECB;&#x7ECD;"><span class="math inline">\(9.1\)</span>&#x5E76;&#x67E5;&#x96C6;&#x4ECB;&#x7ECD;</h1>
<h3 id="1&#x5E76;&#x67E5;&#x96C6;&#x7684;&#x63A5;&#x53E3;">1.&#x5E76;&#x67E5;&#x96C6;&#x7684;&#x63A5;&#x53E3;</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DisjointSets</span> {</span><br><span class="line">    <span class="comment">/** connects two items P and Q */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">connect</span><span class="params">(<span class="type">int</span> p, <span class="type">int</span> q)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** checks to see if two items are connected */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isConnected</span><span class="params">(<span class="type">int</span> p, <span class="type">int</span> q)</span>; </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/9.2.Quick%20Find/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/9.2.Quick%20Find/" class="post-title-link" itemprop="url">9.2.&#x5FEB;&#x901F;&#x67E5;&#x627E;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 17:51:55" itemprop="dateModified" datetime="2024-06-02T17:51:55+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/9-Disjoint-sets/" itemprop="url" rel="index"><span itemprop="name">9.Disjoint sets</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>334</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="92&#x5FEB;&#x901F;&#x67E5;&#x627E;"><span class="math inline">\(9.2\)</span>&#x5FEB;&#x901F;&#x67E5;&#x627E;</h1>
<h3 id="1&#x5E76;&#x67E5;&#x96C6;&#x7684;&#x6784;&#x9020;">1.&#x5E76;&#x67E5;&#x96C6;&#x7684;&#x6784;&#x9020;</h3>
<p>&#x2003;&#x2003;&#x76F4;&#x89C2;&#x4E0A;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<span class="math inline">\(ListOfSet\)</span>&#x6765;&#x8868;&#x793A;&#x5E76;&#x67E5;&#x96C6;&#xFF0C;&#x4F8B;&#x5982;<code>[{0}, {1}, {2}, {3}, {4}, {5}, {6}]</code>&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x8FD9;&#x79CD;&#x5F62;&#x5F0F;&#x7684;&#x5E76;&#x67E5;&#x96C6;&#x96BE;&#x4EE5;&#x5408;&#x5E76;&#x3002;</p>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x8003;&#x8651;&#x53EA;&#x7528;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#x6765;&#x5B9E;&#x73B0;&#x5E76;&#x67E5;&#x96C6;&#x7684;&#x5408;&#x5E76;&#x64CD;&#x4F5C;&#xFF0C;&#x8BE5;&#x6570;&#x7EC4;&#x6309;&#x5982;&#x4E0B;&#x65B9;&#x5F0F;&#x6784;&#x9020;&#xFF1A;</p>
<ul>
<li>&#x6570;&#x7EC4;&#x7684;&#x4E0B;&#x6807;&#x503C;&#x4EE3;&#x8868;&#x5143;&#x7D20;&#x672C;&#x8EAB;&#x3002;</li>
<li>&#x6570;&#x7EC4;&#x4E0B;&#x6807;&#x5BF9;&#x5E94;&#x7684;&#x503C;&#x4EE3;&#x8868;&#x5143;&#x7D20;&#x6240;&#x5C5E;&#x96C6;&#x5408;&#x7684;&#x5E8F;&#x53F7;&#x3002;</li>
</ul>
<p>&#x2003;&#x2003;&#x4F8B;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5982;&#x4E0B;&#x8868;&#x793A;<code>{0, 1, 2, 4}, {3, 5}, {6}</code>&#xFF1A;</p>
<p><img src="/2024/05/31/9.2.Quick%20Find/image.png"></p>
<p>&#x2003;&#x2003;&#x96C6;&#x5408;&#x7684;&#x5E8F;&#x53F7;&#x5E76;&#x4E0D;&#x91CD;&#x8981;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x786E;&#x4FDD;&#x76F8;&#x540C;&#x7684;&#x96C6;&#x5408;&#x7684;&#x503C;&#x76F8;&#x540C;&#x5373;&#x53EF;&#x3002;</p>
<h3 id="2connect&#x64CD;&#x4F5C;">2.<code>connect</code>&#x64CD;&#x4F5C;</h3>
<p>&#x2003;&#x2003;&#x6709;&#x4E86;&#x4E0A;&#x9762;&#x7684;&#x6784;&#x9020;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x66F4;&#x6539;&#x6570;&#x7EC4;&#x5BF9;&#x5E94;&#x4E0B;&#x6807;&#x7684;&#x503C;&#x6765;&#x5B9E;&#x73B0;&#x5408;&#x5E76;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5047;&#x5982;&#x6211;&#x4EEC;&#x60F3;&#x5C06;<span class="math inline">\(2\)</span>&#x4E0E;<span class="math inline">\(3\)</span>&#x5408;&#x5E76;&#xFF1A;</p>
<p><img src="/2024/05/31/9.2.Quick%20Find/image-1.png"></p>
<h3 id="3isconnected&#x64CD;&#x4F5C;">3.<code>isConnected</code>&#x64CD;&#x4F5C;</h3>
<p>&#x2003;&#x2003;&#x4E3A;&#x4E86;&#x68C0;&#x67E5;<code>isConnected(x, y)</code>&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x68C0;&#x67E5;&#x5B83;&#x4EEC;&#x5BF9;&#x5E94;&#x96C6;&#x5408;&#x7684;&#x5E8F;&#x53F7;&#x662F;&#x5426;&#x76F8;&#x7B49;&#x5373;&#x53EF;&#x3002;&#x8FD9;&#x53EA;&#x9700;&#x8981;&#x5E38;&#x6570;&#x65F6;&#x95F4;&#x3002;</p>
<h3 id="4&#x603B;&#x7ED3;&#x4E0E;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;">4.&#x603B;&#x7ED3;&#x4E0E;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;</h3>
<p><img src="/2024/05/31/9.2.Quick%20Find/image-2.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QuickFindDS</span> <span class="keyword">implements</span> <span class="title class_">DisjointSets</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span>[] id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">QuickFindDS</span><span class="params">(<span class="type">int</span> N)</span> {</span><br><span class="line">        id = <span class="keyword">new</span> <span class="title class_">int</span>[N];</span><br><span class="line">        <span class="comment">// initialize the parent</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; N; i += <span class="number">1</span>) {</span><br><span class="line">            id[i] = i;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">connect</span><span class="params">(<span class="type">int</span> p, <span class="type">int</span> q)</span> {</span><br><span class="line">        <span class="type">int</span> <span class="variable">pid</span> <span class="operator">=</span> id[p];</span><br><span class="line">        <span class="type">int</span> <span class="variable">qid</span> <span class="operator">=</span> id[q];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; id.length; i += <span class="number">1</span>) {</span><br><span class="line">            <span class="keyword">if</span> (id[i] == pid) {</span><br><span class="line">                id[i] = qid;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isConnected</span><span class="params">(<span class="type">int</span> p, <span class="type">int</span> q)</span> {</span><br><span class="line">        <span class="keyword">return</span> id[p] == id[q];</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/31/9.3.Quick%20Union/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/9.3.Quick%20Union/" class="post-title-link" itemprop="url">9.3.&#x5FEB;&#x901F;&#x5408;&#x5E76;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-31 17:48:59" itemprop="dateCreated datePublished" datetime="2024-05-31T17:48:59+08:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-02 17:57:09" itemprop="dateModified" datetime="2024-06-02T17:57:09+08:00">2024-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/" itemprop="url" rel="index"><span itemprop="name">CS61B DataStructure</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61B-DataStructure/9-Disjoint-sets/" itemprop="url" rel="index"><span itemprop="name">9.Disjoint sets</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>469</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="93&#x5FEB;&#x901F;&#x5408;&#x5E76;"><span class="math inline">\(9.3\)</span>&#x5FEB;&#x901F;&#x5408;&#x5E76;</h1>
<h3 id="1&#x6839;&#x8282;&#x70B9;&#x7684;&#x5F15;&#x5165;">1.&#x6839;&#x8282;&#x70B9;&#x7684;&#x5F15;&#x5165;</h3>
<p>&#x2003;&#x2003;&#x5047;&#x5982;&#x6211;&#x4EEC;&#x60F3;&#x8BA9;<code>connect</code>&#x64CD;&#x4F5C;&#x5FEB;&#x4E00;&#x4E9B;&#xFF0C;&#x7531;&#x4E8E;&#x5148;&#x524D;&#x7528;<span class="math inline">\(id[x]\)</span>&#x4EE3;&#x6307;&#x6240;&#x5C5E;&#x96C6;&#x5408;&#x7684;&#x64CD;&#x4F5C;&#x4ECD;&#x662F;&#x901A;&#x8FC7;&#x904D;&#x5386;&#x5E8F;&#x5217;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A;&#x7EBF;&#x6027;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x7528;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x4EE3;&#x6307;&#x6574;&#x4E2A;&#x96C6;&#x5408;&#xFF0C;&#x8FD9;&#x6837;&#x5408;&#x5E76;&#x64CD;&#x4F5C;&#x53EA;&#x9700;&#x8981;&#x5408;&#x5E76;&#x4E24;&#x4E2A;&#x5143;&#x7D20;&#x5373;&#x53EF;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5BF9;&#x5E8F;&#x5217;&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#xFF0C;&#x6211;&#x4EEC;&#x7ED9;&#x5B83;&#x5206;&#x6D3E;(<span class="math inline">\(assign\)</span>)&#x4E00;&#x4E2A;&#x503C;&#xFF0C;&#x8FD9;&#x4E2A;&#x503C;&#x662F;&#x5B83;&#x7684;&#x7236;&#x4EB2;(<span class="math inline">\(parent\)</span>)&#x7684;&#x7D22;&#x5F15;&#xFF1B;&#x5982;&#x679C;&#x67D0;&#x4E2A;&#x5143;&#x7D20;&#x6CA1;&#x6709;&#x7D22;&#x5F15;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x5C31;&#x662F;&#x6839;&#x8282;&#x70B9;&#xFF0C;&#x6211;&#x4EEC;&#x7ED9;&#x5B83;&#x5206;&#x6D3E;&#x4E00;&#x4E2A;&#x8D1F;&#x6570;&#x7684;&#x503C;&#x3002;&#x4E0B;&#x9762;&#x7684;&#x56FE;&#x793A;&#x5C55;&#x793A;&#x4E86;<code>{0, 1, 2, 4}, {3, 5}, {6}</code>&#x7684;&#x5BF9;&#x5E94;&#x8868;&#x793A;&#xFF1A;</p>
<p><img src="/2024/05/31/9.3.Quick%20Union/image-3.png"></p>
<p>&#x2003;&#x2003;&#x4E3A;&#x4E86;&#x5B9E;&#x73B0;&#x5FEB;&#x901F;&#x5408;&#x5E76;&#xFF0C;&#x6211;&#x4EEC;&#x5F15;&#x5165;&#x4E00;&#x4E2A;&#x8F85;&#x52A9;&#x51FD;&#x6570;<code>find(int item)</code>&#xFF0C;&#x5B83;&#x8FD4;&#x56DE;&#x67D0;&#x4E2A;&#x5143;&#x7D20;&#x5BF9;&#x5E94;&#x7684;&#x6839;&#x8282;&#x70B9;&#x3002;</p>
<h3 id="2connectx-y">2.<code>connect(x, y)</code></h3>
<p>&#x2003;&#x2003;&#x4E3A;&#x4E86;&#x5408;&#x5E76;&#x4E24;&#x5143;&#x7D20;&#xFF0C;&#x6211;&#x4EEC;&#x627E;&#x5230;&#x4E24;&#x4E2A;&#x5143;&#x7D20;&#x5BF9;&#x5E94;&#x7684;&#x6839;&#x8282;&#x70B9;&#xFF0C;&#x7136;&#x540E;&#x8BA9;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x6839;&#x8282;&#x70B9;&#x4F5C;&#x4E3A;&#x53E6;&#x4E00;&#x4E2A;&#x7684;&#x513F;&#x5B50;(<span class="math inline">\(child\)</span>)&#x3002;&#x4F8B;&#x5982;<code>connect(5, 2)</code>&#x9700;&#x8981;&#x8FDB;&#x884C;&#x5982;&#x4E0B;&#x64CD;&#x4F5C;&#xFF1A;</p>
<ol type="1">
<li><code>find(5)</code> <span class="math inline">\(\rightarrow
3\)</span></li>
<li><code>find(2)</code> <span class="math inline">\(\rightarrow
0\)</span></li>
<li>&#x8BBE;&#x7F6E;<code>parent[3] = 0</code></li>
</ol>
<p><img src="/2024/05/31/9.3.Quick%20Union/image-4.png"></p>
<h3 id="3isconnectedx-y">3.<code>isConnected(x, y)</code></h3>
<p>&#x2003;&#x2003;&#x5982;&#x679C;&#x4E24;&#x4E2A;&#x5143;&#x7D20;&#x540C;&#x5C5E;&#x4E00;&#x4E2A;&#x96C6;&#x5408;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x4EEC;&#x7684;&#x6839;&#x8282;&#x70B9;&#x5E94;&#x8BE5;&#x76F8;&#x540C;&#x3002;&#x53EA;&#x9700;&#x68C0;&#x67E5;<code>find(x) == find(y)</code>&#x5373;&#x53EF;&#x3002;</p>
<h3 id="4&#x603B;&#x7ED3;&#x4E0E;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;">4.&#x603B;&#x7ED3;&#x4E0E;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;</h3>
<p><img src="/2024/05/31/9.3.Quick%20Union/image-6.png"></p>
<p>&#x2003;&#x2003;&#x770B;&#x8D77;&#x6765;&#x5FEB;&#x901F;&#x5408;&#x5E76;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x6BD4;&#x5FEB;&#x901F;&#x67E5;&#x8BE2;&#x957F;&#xFF01;&#x4F46;&#x662F;<span class="math inline">\(O(n)\)</span>&#x4EE3;&#x8868;&#x7684;&#x662F;&#x5FEB;&#x901F;&#x5408;&#x5E76;&#x7684;&#x4E0A;&#x754C;&#x3002;&#x5F53;&#x6211;&#x4EEC;&#x7684;&#x6811;&#x6BD4;&#x8F83;&#x5E73;&#x8861;&#x65F6;&#xFF0C;&#x5FEB;&#x901F;&#x67E5;&#x8BE2;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4F1A;&#x975E;&#x5E38;&#x4F18;&#x79C0;&#x3002;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QuickUnionDS</span> <span class="keyword">implements</span> <span class="title class_">DisjointSets</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span>[] parent;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">QuickUnionDS</span><span class="params">(<span class="type">int</span> num)</span> {</span><br><span class="line">        parent = <span class="keyword">new</span> <span class="title class_">int</span>[num];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; num; i += <span class="number">1</span>) {</span><br><span class="line">            parent[i] = -<span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">find</span><span class="params">(<span class="type">int</span> p)</span> {</span><br><span class="line">        <span class="keyword">while</span>(parent[p] &gt;= <span class="number">0</span>) {</span><br><span class="line">            p = parent[p];</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">connect</span><span class="params">(<span class="type">int</span> p, <span class="type">int</span> q)</span> {</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> find(p);</span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> find(q);</span><br><span class="line">        parent[i] = j;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isConnected</span><span class="params">(<span class="type">int</span> p, <span class="type">int</span> q)</span> {</span><br><span class="line">        <span class="keyword">return</span> find(p) == find(q);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/22/1-3-C-Intro/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/22/1-3-C-Intro/" class="post-title-link" itemprop="url">1.3.C Intro</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-22 11:31:00" itemprop="dateCreated datePublished" datetime="2024-05-22T11:31:00+08:00">2024-05-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 21:28:45" itemprop="dateModified" datetime="2024-06-03T21:28:45+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/" itemprop="url" rel="index"><span itemprop="name">CS61C Great Ideas in Computer Architecture</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/Module-1-Intro/" itemprop="url" rel="index"><span itemprop="name">Module 1.Intro</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>418</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="13c-intro"><span class="math inline">\(1.3.\)</span>C Intro</h1>
<h3 id="1c-compilation">1.C compilation</h3>
<p><img src="/2024/05/22/1-3-C-Intro/image.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-1.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-2.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-3.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-4.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-5.png"></p>
<h3 id="2some-c-grammar">2.Some C grammar</h3>
<p><img src="/2024/05/22/1-3-C-Intro/image-6.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-7.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-8.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-9.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-10.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-11.png"></p>
<h3 id="3c-pointer">3.C pointer</h3>
<p><img src="/2024/05/22/1-3-C-Intro/image-12.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-13.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-14.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-15.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-16.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-17.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-18.png"></p>
<h3 id="4pointer-operation">4.Pointer operation</h3>
<p><img src="/2024/05/22/1-3-C-Intro/image-19.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-20.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-21.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-22.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-23.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-24.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-25.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-26.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-27.png"></p>
<blockquote>
<p>Why? * <em>Address validity</em>: The pointer is used to store the
memory address and point at the specified data. If we cast an integer to
a pointer, the integer may <strong>not be an valid memory
address</strong>, and visit this address will lead to program crash. *
<em>Type system protection</em>: Cast ignores the protection of the type
system. An important function of the type system is to ensure that the
operations in your code are safe. For example, converting an integer to
a pointer and accessing it, skipping the type system check, might result
in accessing an incorrect data type.</p>
</blockquote>
<hr>
<p><img src="/2024/05/22/1-3-C-Intro/image-28.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-29.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-30.png"></p>
<hr>
<p><img src="/2024/05/22/1-3-C-Intro/image-31.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-32.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-33.png"></p>
<hr>
<p><img src="/2024/05/22/1-3-C-Intro/image-34.png"></p>
<h3 id="5c-string">5.C string</h3>
<p><img src="/2024/05/22/1-3-C-Intro/image-35.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-36.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-37.png"></p>
<h3 id="6c-structures">6.C structures</h3>
<p><img src="/2024/05/22/1-3-C-Intro/image-38.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-39.png"></p>
<h3 id="7error-types">7.Error types</h3>
<p><img src="/2024/05/22/1-3-C-Intro/image-40.png"></p>
<hr>
<p><img src="/2024/05/22/1-3-C-Intro/image-41.png"></p>
<h3 id="8c-array">8.C array</h3>
<p><img src="/2024/05/22/1-3-C-Intro/image-42.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-43.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-44.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-45.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-46.png"></p>
<h3 id="9endianness">9.Endianness</h3>
<p><img src="/2024/05/22/1-3-C-Intro/image-47.png"></p>
<h3 id="10c-memory-management">10.C memory management</h3>
<p><img src="/2024/05/22/1-3-C-Intro/image-48.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-49.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-50.png"></p>
<hr>
<p><img src="/2024/05/22/1-3-C-Intro/image-51.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-52.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-53.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-54.png"></p>
<hr>
<p><img src="/2024/05/22/1-3-C-Intro/image-55.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-56.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-57.png"></p>
<blockquote>
<p>For example, the following program is right: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">void functionB(int *ptr) {</span><br><span class="line">    printf(&quot;Value: %d\n&quot;, *ptr);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">void functionA() {</span><br><span class="line">    int x = 10;</span><br><span class="line">    functionB(&amp;x);</span><br><span class="line">}</span><br></pre></td></tr></table></figure> Because
the local variable is stored on the stack during the run of
<code>functionB</code>, it&apos;s safe to pass its pointer to the
function.</p>
<p>However, this program is wrong: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">int* function() {</span><br><span class="line">    int x = 10;</span><br><span class="line">    return &amp;x; </span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">void example() {</span><br><span class="line">    int *p = function(); </span><br><span class="line">    printf(&quot;Value: %d\n&quot;, *p);</span><br><span class="line">}</span><br></pre></td></tr></table></figure> After the function is
returned, <strong>the stack frame where <code>x</code> is located is
released</strong>, and <strong>the memory address pointed to by pointer
<code>p</code> may be overwritten by other data</strong>. This can lead
to undefined behavior</p>
</blockquote>
<p><img src="/2024/05/22/1-3-C-Intro/image-58.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-59.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-60.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-61.png"></p>
<blockquote>
<p>Static string constants are typically <strong>stored in read-only
memory</strong>, and modifying these is an undifined behavior in C.</p>
</blockquote>
<p><img src="/2024/05/22/1-3-C-Intro/image-62.png"></p>
<hr>
<p><img src="/2024/05/22/1-3-C-Intro/image-63.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-64.png"></p>
<blockquote>
<p>The main reason for placing 4 bytes of data on multiples of 4 is to
<strong>optimize the processor&apos;s memory access efficiency</strong>.
Suppose a processor has a 4-byte memory bus width. When accessing 4-byte
aligned data, the processor <strong>can retrieve the entire data in one
memory read operation</strong>. If the data is not aligned (for example,
an int spanning two memory addresses) , the processor may <strong>need
to perform two memory reads and then merge the two reads</strong>. This
can cause performance degradation.</p>
</blockquote>
<figure>
<img src="/2024/05/22/1-3-C-Intro/image-65.png" alt="Alt text">
<figcaption aria-hidden="true">Alt text</figcaption>
</figure>
<blockquote>
<p>Let&apos;s take an example to illustrate the alignment process:
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">struct Example { </span><br><span class="line">	char a; </span><br><span class="line">	int b; </span><br><span class="line">};</span><br></pre></td></tr></table></figure> The <code>a</code> requires 1 byte, and alignment requires
1 byte, so it can be placed at the starting address of the
struction.</p>
<p>The <code>b</code> requires 4 bytes, and alignement requires 4 bytes,
so <strong>it must be placed on a multiple of 4 address.</strong> To
satisfy <code>b</code>&apos;s alignment requirements, the compiler
<strong>inserts three padding bytes after <code>a</code></strong>,
making <code>b</code>&apos;s address a multiple of 4.</p>
</blockquote>
<hr>
<p><img src="/2024/05/22/1-3-C-Intro/image-66.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-67.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-68.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-69.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-70.png"></p>
<hr>
<p><img src="/2024/05/22/1-3-C-Intro/image-71.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-72.png"></p>
<hr>
<p><img src="/2024/05/22/1-3-C-Intro/image-73.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-74.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-75.png"></p>
<p><img src="/2024/05/22/1-3-C-Intro/image-76.png"></p>
<hr>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/19/1-2-Number-Representation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/19/1-2-Number-Representation/" class="post-title-link" itemprop="url">1.2.Number Representation</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-19 10:31:00" itemprop="dateCreated datePublished" datetime="2024-05-19T10:31:00+08:00">2024-05-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 18:03:59" itemprop="dateModified" datetime="2024-06-03T18:03:59+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/" itemprop="url" rel="index"><span itemprop="name">CS61C Great Ideas in Computer Architecture</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/Module-1-Intro/" itemprop="url" rel="index"><span itemprop="name">Module 1.Intro</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>64</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="12number-representation"><span class="math inline">\(1.2.\)</span>Number Representation</h1>
<h3 id="1binary-representation">1.Binary representation</h3>
<p><img src="/2024/05/19/1-2-Number-Representation/image.png"></p>
<p><img src="/2024/05/19/1-2-Number-Representation/image-1.png"></p>
<p><img src="/2024/05/19/1-2-Number-Representation/image-2.png"></p>
<ul>
<li>We move -1 to the right by one, -2 to the right, etc. Then the two
0s overlap:</li>
</ul>
<p><img src="/2024/05/19/1-2-Number-Representation/image-3.png"></p>
<p><img src="/2024/05/19/1-2-Number-Representation/image-4.png"></p>
<p><img src="/2024/05/19/1-2-Number-Representation/image-5.png"></p>
<p><img src="/2024/05/19/1-2-Number-Representation/image-6.png"></p>
<p><img src="/2024/05/19/1-2-Number-Representation/image-7.png"></p>
<h3 id="2bias-encoding">2.Bias encoding</h3>
<p><img src="/2024/05/19/1-2-Number-Representation/image-8.png"></p>
<p><img src="/2024/05/19/1-2-Number-Representation/image-9.png"></p>
<p><img src="/2024/05/19/1-2-Number-Representation/image-10.png"></p>
<p><img src="/2024/05/19/1-2-Number-Representation/image-11.png"></p>
<p><img src="/2024/05/19/1-2-Number-Representation/image-12.png"></p>
<p><img src="/2024/05/19/1-2-Number-Representation/image-13.png"></p>
<p><img src="/2024/05/19/1-2-Number-Representation/image-14.png"></p>
<ul>
<li>Because the biased number are all <strong>start at 0</strong>,
<strong>the MSB doesn&apos;t represent the sign anymore</strong>. So in
floating point, we can compare two biased number directly as if they
were unsigned number.</li>
</ul>
<h3 id="3iec-standard-prefixes">3.IEC standard prefixes</h3>
<p><img src="/2024/05/19/1-2-Number-Representation/image-15.png"></p>
<p><img src="/2024/05/19/1-2-Number-Representation/image-16.png"></p>
<p><img src="/2024/05/19/1-2-Number-Representation/image-17.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/18/1-1-Great-Idea-Intro/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/18/1-1-Great-Idea-Intro/" class="post-title-link" itemprop="url">1.1.Great Indea Intro</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-18 11:31:00" itemprop="dateCreated datePublished" datetime="2024-05-18T11:31:00+08:00">2024-05-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 17:55:57" itemprop="dateModified" datetime="2024-06-03T17:55:57+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/" itemprop="url" rel="index"><span itemprop="name">CS61C Great Ideas in Computer Architecture</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS61C-Great-Ideas-in-Computer-Architecture/Module-1-Intro/" itemprop="url" rel="index"><span itemprop="name">Module 1.Intro</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>197</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="1cs61c-intro">1.CS61C intro</h3>
<p><img src="/2024/05/18/1-1-Great-Idea-Intro/image-4.png"></p>
<ul>
<li>The hareware is composed of <strong>a gazillion computers in
parallel</strong>.</li>
<li>The computers are consisted of <strong>parallel computers within the
processing unit</strong>.</li>
<li>We get parallelism all the way down the stack.</li>
</ul>
<p><img src="/2024/05/18/1-1-Great-Idea-Intro/image-5.png"></p>
<h3 id="2abstraction">2.Abstraction</h3>
<p><img src="/2024/05/18/1-1-Great-Idea-Intro/image.png"></p>
<ul>
<li>Each level of abstraction is only influenced by <strong>the level
above or below by one</strong>.</li>
<li>We can change out the architecture and keep the same machine
language to make program run faster.</li>
</ul>
<h3 id="3moores-law">3.Moore&apos;s law</h3>
<p><img src="/2024/05/18/1-1-Great-Idea-Intro/image-1.png"></p>
<ul>
<li><em>Moore&apos;s law</em>: Over time, the number of transistors that&apos;s
actual switches keeps growing exponentially.</li>
<li>However, we hit a brick wall that getting more performance is no
longer a matter of improving processes and adding transistors, but
<strong>exploiting parallelsome</strong>.</li>
</ul>
<h3 id="4localitymemory-hierarchy">4.Locality/Memory Hierarchy</h3>
<ul>
<li>It&apos;s about <strong>how far away is a piece of data</strong>.</li>
</ul>
<p><img src="/2024/05/18/1-1-Great-Idea-Intro/image-2.png"></p>
<p><img src="/2024/05/18/1-1-Great-Idea-Intro/image-3.png"></p>
<h3 id="5parallelism">5.Parallelism</h3>
<ul>
<li>We do lots of things at once, even within the most processor.</li>
<li>On the program, we spilt things up.</li>
</ul>
<p><img src="/2024/05/18/1-1-Great-Idea-Intro/image-6.png"></p>
<ul>
<li>However, there&apos;s a limit called <em>Amdahl&apos;s Law</em>: The amount
you can speed up something by parallelization depends on <strong>the
amount that&apos;s actually parallelizable</strong>. If the problem isn&apos;t
parallelizable, then it will fail.</li>
</ul>
<h3 id="6dependability-viaredundancy">6.Dependability via
redundancy</h3>
<ul>
<li>To deal with failures, we use <em>redundancy</em> so that a failing
piece doesn&apos;t make the whole thing fail:</li>
</ul>
<p><img src="/2024/05/18/1-1-Great-Idea-Intro/image-7.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/05/04/10-11-%E7%BC%96%E8%AF%91%E5%99%A8%E5%AE%9E%E7%8E%B0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/04/10-11-%E7%BC%96%E8%AF%91%E5%99%A8%E5%AE%9E%E7%8E%B0%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">10.11.&#x7F16;&#x8BD1;&#x5668;&#x5B9E;&#x73B0;&#x7B14;&#x8BB0;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-05-04 20:15:43" itemprop="dateCreated datePublished" datetime="2024-05-04T20:15:43+08:00">2024-05-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 16:06:53" itemprop="dateModified" datetime="2024-06-03T16:06:53+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-10-Code-Generator/" itemprop="url" rel="index"><span itemprop="name">Module 10.Code Generator</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>4.2k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>15 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="1011&#x7F16;&#x8BD1;&#x5668;&#x5B9E;&#x73B0;&#x7B14;&#x8BB0;"><span class="math inline">\(10.11.\)</span>&#x7F16;&#x8BD1;&#x5668;&#x5B9E;&#x73B0;&#x7B14;&#x8BB0;</h1>
<h3 id="1symbol-table&#x5B9E;&#x73B0;">1.<code>Symbol Table</code>&#x5B9E;&#x73B0;</h3>
<p>&#x2003;&#x2003;&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x8BFB;&#x53D6;&#x5355;&#x4E00;&#x5B57;&#x7B26;&#xFF0C;&#x6211;&#x4EEC;&#x9009;&#x62E9;<strong>&#x5229;&#x7528;<code>tokenizer</code>&#x751F;&#x6210;&#x7684;&#x4EE3;&#x7801;</strong>&#x6765;&#x6784;&#x5EFA;&#x6211;&#x4EEC;&#x7684;<code>Symbol Table</code>.</p>
<h4 id="a&#x51C6;&#x5907;&#x5DE5;&#x4F5C;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&#x51C6;&#x5907;&#x5DE5;&#x4F5C;</h4>
<ol type="1">
<li>&#x867D;&#x7136;&#x7406;&#x8BBA;&#x4E0A;&#x5E94;&#x8BE5;&#x5BF9;&#x4E8E;&#x6BCF;&#x4E00;&#x4E2A;&#x5B50;&#x7A0B;&#x5E8F;&#xFF0C;&#x6211;&#x4EEC;&#x90FD;&#x5E94;&#x8BE5;&#x5B9E;&#x65F6;&#x5730;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x5BF9;&#x5E94;&#x7684;<code>subroutineMap</code>&#xFF0C;&#x4F46;&#x662F;&#x7531;&#x4E8E;&#x8F83;&#x96BE;&#x5B9E;&#x73B0;&#xFF0C;&#x6211;&#x9009;&#x62E9;&#x904D;&#x5386;&#x6574;&#x4E2A;&#x7A0B;&#x5E8F;&#x540E;&#xFF0C;&#x5C06;&#x6BCF;&#x4E2A;&#x5B50;&#x7A0B;&#x5E8F;&#x5BF9;&#x5E94;&#x7684;<code>subroutineMap</code>&#x7528;&#x4E00;&#x4E2A;&#x65B0;&#x7684;<span class="math inline">\(Map\)</span>&#x6765;&#x5B58;&#x50A8;&#xFF1A;</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//for convenience, we store the symbolTable of each subroutine into a map.</span></span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Map&lt;String, Integer&gt;&gt; mapOfSubVar = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">&#xA0; &#xA0; <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Map&lt;String, String&gt;&gt; mapOfSubVarType = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">&#xA0; &#xA0; <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Map&lt;String, String&gt;&gt; mapOfSubVarKind = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Integer&gt; subroutineVar = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">&#xA0; &#xA0; <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, String&gt; typeOfSubroutineVar = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">&#xA0; &#xA0; <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, String&gt; kindOfSubroutineVar = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;&#x540C;&#x65F6;&#xFF0C;&#x8FD9;&#x8981;&#x6C42;&#x6211;&#x4EEC;&#x8BB0;&#x5F55;&#x4E0B;&#x5F53;&#x524D;&#x904D;&#x5386;&#x7684;&#x5B50;&#x7A0B;&#x5E8F;&#x7684;&#x540D;&#x79F0;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">StringBuilder</span> <span class="variable">currentStringName</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>&#x7531;&#x4E8E;&#x5BF9;&#x6BCF;&#x4E2A;<code>class</code>&#xFF0C;&#x6211;&#x4EEC;&#x90FD;&#x8981;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x65B0;&#x7684;<code>Symbol Table</code>&#xFF0C;
&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x5728;&#x751F;&#x6210;&#x5BF9;&#x5E94;&#x7684;<code>Symbol Table</code>&#x524D;&#x5148;&#x8981;&#x5BF9;&#x50A8;&#x5B58;&#x8868;&#x683C;&#x7684;<span class="math inline">\(Map\)</span>&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;&#xFF1A;</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">startClass</span><span class="params">()</span> {</span><br><span class="line">    classVar.clear();</span><br><span class="line">    typeOfClassVar.clear();</span><br><span class="line">    kindOfClassVar.clear();</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<ol start="3" type="1">
<li>&#x5728;&#x540E;&#x7EED;&#x751F;&#x6210;VM&#x4EE3;&#x7801;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x6BCF;&#x4E2A;&#x53D8;&#x91CF;&#x5BF9;&#x5E94;&#x7684;&#x5E8F;&#x53F7;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8BBE;&#x7F6E;&#x53D8;&#x91CF;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x5B58;&#x50A8;&#xFF1A;</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#xA0; &#xA0; <span class="comment">//use to return the kind index</span></span><br><span class="line">&#xA0; &#xA0; <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">classNum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">&#xA0; &#xA0; <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">argNum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">&#xA0; &#xA0; <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">localNum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//and for subroutine, we store their argNum and localNum</span></span><br><span class="line">&#xA0; &#xA0; <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Integer&gt; subroutineArgNum = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">&#xA0; &#xA0; <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Integer&gt; subroutineLCLNum = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br></pre></td></tr></table></figure>
<h4 id="b&#x7C7B;&#x53D8;&#x91CF;&#x5904;&#x7406;">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>&#x7C7B;&#x53D8;&#x91CF;&#x5904;&#x7406;</h4>
<p>&#x2003;&#x2003;&#x7C7B;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x53D8;&#x91CF;&#x9075;&#x5FAA;&#x4EE5;&#x4E0B;&#x7ED3;&#x6784;&#xFF1A;</p>
<p><span class="math display">\[kind+type+name(,name);\]</span></p>
<p>&#x2003;&#x2003;&#x7531;&#x4E8E;&#x8BE5;&#x7ED3;&#x6784;&#x5177;&#x6709;&#x666E;&#x9002;&#x6027;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;<strong>&#x9012;&#x5F52;</strong>&#x7684;&#x65B9;&#x6CD5;&#x8BFB;&#x53D6;&#x5E76;&#x5904;&#x7406;&#x6211;&#x4EEC;&#x8BFB;&#x5165;&#x7684;<em>token</em>&#xFF1A;</p>
<ol type="1">
<li>&#x5904;&#x7406;&#x4E00;&#x5B9A;&#x5B58;&#x5728;&#x7684;<span class="math inline">\(kind+type+name\)</span>.</li>
<li>&#x5224;&#x65AD;&#x662F;&#x5426;&#x6709;<span class="math inline">\(,name\)</span>&#x90E8;&#x5206;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x7684;&#x8BDD;&#x8FDB;&#x884C;&#x5904;&#x7406;.</li>
<li>&#x9012;&#x5F52;&#x6267;&#x884C;&#x4E0A;&#x8FF0;&#x6B65;&#x9AA4;&#xFF0C;&#x76F4;&#x81F3;&#x4E0B;&#x4E00;&#x4E2A;&#x4F20;&#x5165;&#x53D8;&#x91CF;&#x4E0D;&#x662F;<code>local</code>&#x53D8;&#x91CF;.</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">dealClassVar</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">if</span> (Tokenizer.getNextString().equals(<span class="string">&quot;field&quot;</span>) || Tokenizer.getNextString().equals(<span class="string">&quot;static&quot;</span>)) {</span><br><span class="line">        <span class="comment">// get the kind</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">classVarKind</span> <span class="operator">=</span> Tokenizer.stringAdvance();</span><br><span class="line">        <span class="comment">// get the type</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">classVarType</span> <span class="operator">=</span> Tokenizer.stringAdvance();</span><br><span class="line">        <span class="comment">// get the name</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">classVarName</span> <span class="operator">=</span> Tokenizer.stringAdvance();</span><br><span class="line">        <span class="comment">// add to correspond kind</span></span><br><span class="line">        <span class="keyword">if</span> (classVarKind.equals(<span class="string">&quot;static&quot;</span>)) {</span><br><span class="line">            classVar.put(classVarName, classNum++);</span><br><span class="line">            typeOfClassVar.put(classVarName, classVarType);</span><br><span class="line">            kindOfClassVar.put(classVarName, <span class="string">&quot;this&quot;</span>);</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (classVarKind.equals(<span class="string">&quot;field&quot;</span>)) {</span><br><span class="line">            classVar.put(classVarName, classNum++);</span><br><span class="line">            typeOfClassVar.put(classVarName, classVarType);</span><br><span class="line">            kindOfClassVar.put(classVarName, <span class="string">&quot;this&quot;</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// if there&apos;s a &apos;,&apos;, there remains some vars</span></span><br><span class="line">        <span class="keyword">while</span> (Tokenizer.getNextString().equals(<span class="string">&quot;,&quot;</span>)) {</span><br><span class="line">            Tokenizer.stringAdvance();</span><br><span class="line">            <span class="type">String</span> <span class="variable">nextName</span> <span class="operator">=</span> Tokenizer.stringAdvance();</span><br><span class="line">            <span class="comment">// after the operation, there will be &apos;,&apos; or &apos;;&apos;</span></span><br><span class="line">            <span class="keyword">if</span> (classVarKind.equals(<span class="string">&quot;static&quot;</span>)) {</span><br><span class="line">                classVar.put(nextName, classNum++);</span><br><span class="line">                typeOfClassVar.put(nextName, classVarType);</span><br><span class="line">                kindOfClassVar.put(nextName, <span class="string">&quot;this&quot;</span>);</span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">if</span> (classVarKind.equals(<span class="string">&quot;field&quot;</span>)) {</span><br><span class="line">                classVar.put(nextName, classNum++);</span><br><span class="line">                typeOfClassVar.put(nextName, classVarType);</span><br><span class="line">                kindOfClassVar.put(nextName, <span class="string">&quot;this&quot;</span>);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// then we meets &apos;;&apos;, we skip it</span></span><br><span class="line">        Tokenizer.stringAdvance();</span><br><span class="line">        <span class="comment">// we continuously deal with rest classVar recursively</span></span><br><span class="line">        <span class="keyword">if</span> (Tokenizer.getNextString().equals(<span class="string">&quot;field&quot;</span>) || Tokenizer.getNextString().equals(<span class="string">&quot;static&quot;</span>)) {</span><br><span class="line">            dealClassVar();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// finally, update the current string</span></span><br><span class="line">        currentStringName.setLength(<span class="number">0</span>);</span><br><span class="line">        currentStringName.append(Tokenizer.stringAdvance());</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="c&#x5B50;&#x7A0B;&#x5E8F;&#x53D8;&#x91CF;">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>&#x5B50;&#x7A0B;&#x5E8F;&#x53D8;&#x91CF;</h4>
<p>&#x2003;&#x2003;&#x5B50;&#x7A0B;&#x5E8F;&#x53D8;&#x91CF;&#x7ED3;&#x6784;&#x4E0E;&#x7C7B;&#x53D8;&#x91CF;&#x76F8;&#x4F3C;&#xFF0C;&#x8FD9;&#x91CC;&#x7565;&#x8FC7;&#x3002;&#x9700;&#x8981;&#x6CE8;&#x610F;&#xFF1A;&#x5B50;&#x7A0B;&#x5E8F;&#x4E2D;&#x5305;&#x542B;&#x53C2;&#x6570;&#x53D8;&#x91CF;&#xFF0C;&#x8FD9;&#x4E5F;&#x9700;&#x8981;&#x6211;&#x4EEC;&#x7EB3;&#x5165;&#x8003;&#x8651;&#x7684;&#x8303;&#x7574;&#xFF1A;</p>
<ul>
<li><p>&#x5BF9;&#x53C2;&#x6570;&#x7684;&#x5904;&#x7406;&#xFF1A; <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">dealFuncArgVar</span><span class="params">()</span> {</span><br><span class="line">    <span class="comment">//the function features: Dec + type + funcName + ( + args + )</span></span><br><span class="line">    <span class="comment">//so we need to ignore the irrelevant elements</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">subroutineType</span> <span class="operator">=</span> Tokenizer.stringAdvance();</span><br><span class="line">    currentSubroutineName.setLength(<span class="number">0</span>);</span><br><span class="line">    currentSubroutineName.append(className + <span class="string">&quot;.&quot;</span>);</span><br><span class="line">    currentSubroutineName.append(Tokenizer.stringAdvance());</span><br><span class="line">    Tokenizer.stringAdvance();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//we continue read the arguments until we meet &quot;)&quot;</span></span><br><span class="line">    <span class="keyword">while</span> (!Tokenizer.getNextString().equals(<span class="string">&quot;)&quot;</span>)) {</span><br><span class="line">        <span class="comment">// type + name</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">type</span> <span class="operator">=</span> Tokenizer.stringAdvance();</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> Tokenizer.stringAdvance();</span><br><span class="line">        subroutineVar.put(name, argNum++);</span><br><span class="line">        typeOfSubroutineVar.put(name, type);</span><br><span class="line">        kindOfSubroutineVar.put(name, <span class="string">&quot;argument&quot;</span>);</span><br><span class="line">        <span class="comment">//if there&apos;s a &apos;,&apos;, then we have more args</span></span><br><span class="line">        <span class="keyword">while</span> (Tokenizer.getNextString().equals(<span class="string">&quot;,&quot;</span>)) {</span><br><span class="line">            <span class="comment">//ignore the &apos;,&apos;</span></span><br><span class="line">            Tokenizer.stringAdvance();</span><br><span class="line">            type = Tokenizer.stringAdvance();</span><br><span class="line">            name = Tokenizer.stringAdvance();</span><br><span class="line">            subroutineVar.put(name, argNum++);</span><br><span class="line">            typeOfSubroutineVar.put(name, type);</span><br><span class="line">            kindOfSubroutineVar.put(name, <span class="string">&quot;argument&quot;</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//we ignore the &quot;)&quot;</span></span><br><span class="line">    Tokenizer.stringAdvance();</span><br><span class="line">    <span class="comment">//then we ignore the &quot;{&quot;</span></span><br><span class="line">    Tokenizer.stringAdvance();</span><br><span class="line">    currentStringName.setLength(<span class="number">0</span>);</span><br><span class="line">    currentStringName.append(Tokenizer.stringAdvance());</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure></p></li>
<li><p>&#x5BF9;&#x7A0B;&#x5E8F;&#x4F53;&#x5185;&#x90E8;&#x53D8;&#x91CF;&#x7684;&#x5904;&#x7406;&#xFF1A;</p></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">dealFuncLCLVar</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">if</span> (currentStringName.toString().equals(<span class="string">&quot;var&quot;</span>)) {</span><br><span class="line">        <span class="comment">//var + type + name</span></span><br><span class="line">        <span class="comment">//we skip var first</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">type</span> <span class="operator">=</span> Tokenizer.stringAdvance();</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> Tokenizer.stringAdvance();</span><br><span class="line"></span><br><span class="line">        subroutineVar.put(name, localNum++);</span><br><span class="line">        typeOfSubroutineVar.put(name, type);</span><br><span class="line">        kindOfSubroutineVar.put(name, <span class="string">&quot;local&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//deal with &quot;,&quot;</span></span><br><span class="line">        <span class="keyword">while</span> (Tokenizer.getNextString().equals(<span class="string">&quot;,&quot;</span>)) {</span><br><span class="line">            Tokenizer.stringAdvance();</span><br><span class="line">            name = Tokenizer.stringAdvance();</span><br><span class="line">            subroutineVar.put(name, localNum++);</span><br><span class="line">            typeOfSubroutineVar.put(name, type);</span><br><span class="line">            kindOfSubroutineVar.put(name, <span class="string">&quot;local&quot;</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//we meet a &quot;;&quot;</span></span><br><span class="line">    Tokenizer.stringAdvance();</span><br><span class="line">    currentStringName.setLength(<span class="number">0</span>);</span><br><span class="line">    currentStringName.append(Tokenizer.stringAdvance());</span><br><span class="line">    <span class="keyword">if</span> (currentStringName.toString().equals(<span class="string">&quot;var&quot;</span>)) dealFuncLCLVar();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; }</span><br></pre></td></tr></table></figure>
<h4 id="dsymbol-table&#x6700;&#x7EC8;&#x6784;&#x5EFA;">&#x2003;&#x2003;<span class="math inline">\(d.\)</span><code>Symbol Table</code>&#x6700;&#x7EC8;&#x6784;&#x5EFA;</h4>
<p>&#x2003;&#x2003;&#x6709;&#x4E86;&#x4E0A;&#x8FF0;&#x65B9;&#x6CD5;&#x7684;&#x94FA;&#x57AB;&#xFF0C; &#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x5728;&#x9047;&#x5230;&#x5BF9;&#x5E94;&#x7684;<span class="math inline">\(token\)</span>&#x65F6;&#x8C03;&#x7528;&#x5BF9;&#x5E94;&#x7684;&#x65B9;&#x6CD5;&#x5373;&#x53EF;&#x3002;&#x6211;&#x4EEC;&#x5229;&#x7528;<code>private static String currentStringName</code>&#x6765;&#x8BB0;&#x5F55;&#x5F53;&#x524D;&#x8BFB;&#x5165;&#x7684;<span class="math inline">\(token\)</span>&#xFF0C;&#x5982;&#x679C;&#x9047;&#x5230;&#x4E86;&#x58F0;&#x660E;&#x7C7B;&#x6216;&#x5B50;&#x7A0B;&#x5E8F;&#x7684;&#x5173;&#x952E;&#x5B57;&#xFF0C;&#x5C31;&#x8DF3;&#x8F6C;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x53D8;&#x91CF;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x4E2D;&#xFF1A;</p>
<ol type="1">
<li>&#x5F53;&#x9047;&#x5230;<code>class</code>&#x5173;&#x952E;&#x5B57;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x5FFD;&#x7565;&#x6389;<span class="math inline">\(class+className+{\)</span>&#x540E;&#x7740;&#x624B;&#x5904;&#x7406;&#x7C7B;&#x53D8;&#x91CF;&#xFF1A;</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//if we meet &quot;class&quot;, then we call dealClass</span></span><br><span class="line"><span class="keyword">if</span> (currentStringName.toString().equals(<span class="string">&quot;class&quot;</span>)) {</span><br><span class="line">    startClass();</span><br><span class="line"></span><br><span class="line">    className = Tokenizer.stringAdvance();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ignore the &apos;{&apos;</span></span><br><span class="line">    Tokenizer.stringAdvance();</span><br><span class="line"></span><br><span class="line">    dealClassVar();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!currentStringName.toString().equals(<span class="string">&quot;class&quot;</span>)) <span class="keyword">continue</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>&#x5F53;&#x9047;&#x5230;<code>funcDec</code>&#x5173;&#x952E;&#x8BCD;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x5904;&#x7406;<code>varDec</code>&#x90E8;&#x5206;&#xFF0C;&#x5E76;&#x5C06;&#x5F97;&#x5230;&#x7684;<span class="math inline">\(Map\)</span>&#x5B58;&#x5165;&#x5BF9;&#x5E94;&#x5B50;&#x7A0B;&#x5E8F;&#x7684;<span class="math inline">\(Map\)</span>&#x4E2D;&#xFF1A;</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (currentStringName.toString().equals(<span class="string">&quot;method&quot;</span>)</span><br><span class="line">        || currentStringName.toString().equals(<span class="string">&quot;function&quot;</span>)</span><br><span class="line">        || currentStringName.toString().equals(<span class="string">&quot;constructor&quot;</span>)) {</span><br><span class="line">    <span class="comment">//deal with the arguments first</span></span><br><span class="line">    startSubroutine();</span><br><span class="line">    <span class="keyword">if</span> (currentStringName.toString().equals(<span class="string">&quot;method&quot;</span>)) startMethod();</span><br><span class="line">    dealFuncArgVar();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//after the argument comes the body of func</span></span><br><span class="line">    <span class="comment">//we only care about varDec</span></span><br><span class="line">    <span class="keyword">if</span> (currentStringName.toString().equals(<span class="string">&quot;var&quot;</span>)) dealFuncLCLVar();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//we copy the current ArrayList and deliver the copyList</span></span><br><span class="line">    Map&lt;String, Integer&gt; copyVar = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(subroutineVar);</span><br><span class="line">    Map&lt;String, String&gt; copyType = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(typeOfSubroutineVar);</span><br><span class="line">    Map&lt;String, String&gt; copyKind = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(kindOfSubroutineVar);</span><br><span class="line"></span><br><span class="line">    mapOfSubVar.put(currentSubroutineName.toString(), copyVar);</span><br><span class="line">    mapOfSubVarType.put(currentSubroutineName.toString(), copyType);</span><br><span class="line">    mapOfSubVarKind.put(currentSubroutineName.toString(), copyKind);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//store the index of arg and lcl</span></span><br><span class="line">    subroutineLCLNum.put(currentSubroutineName.toString(), localNum);</span><br><span class="line">    subroutineArgNum.put(currentSubroutineName.toString(), argNum);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="d&#x4F9B;&#x5176;&#x4ED6;&#x7C7B;&#x4F7F;&#x7528;&#x7684;&#x51FD;&#x6570;">&#x2003;&#x2003;<span class="math inline">\(d.\)</span>&#x4F9B;&#x5176;&#x4ED6;&#x7C7B;&#x4F7F;&#x7528;&#x7684;&#x51FD;&#x6570;</h4>
<p>&#x2003;&#x2003;&#x5BF9;&#x4E8E;&#x7ED9;&#x5B9A;&#x7684;&#x8F93;&#x5165;&#xFF0C;&#x8FD4;&#x56DE;&#x8BE5;&#x8F93;&#x5165;&#x5728;<span class="math inline">\(Map\)</span>&#x4E2D;&#x5BF9;&#x5E94;&#x7684;&#x503C;&#x5373;&#x53EF;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">varCount</span><span class="params">(String <span class="keyword">var</span>, String subroutine)</span> {</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">if</span> (subroutine != <span class="literal">null</span> &amp;&amp; mapOfSubVar.get(subroutine).containsKey(<span class="keyword">var</span>))</span><br><span class="line">            <span class="keyword">return</span> mapOfSubVar.get(subroutine).get(<span class="keyword">var</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (classVar.containsKey(<span class="keyword">var</span>))</span><br><span class="line">            <span class="keyword">return</span> classVar.get(<span class="keyword">var</span>);</span><br><span class="line">    } <span class="keyword">catch</span> (ArrayIndexOutOfBoundsException e) {</span><br><span class="line">        System.out.println(<span class="string">&quot;The variable is undefined&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">varType</span><span class="params">(String <span class="keyword">var</span>, String subroutine)</span> {</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">if</span> (subroutine != <span class="literal">null</span> &amp;&amp; mapOfSubVarType.get(subroutine).containsKey(<span class="keyword">var</span>))</span><br><span class="line">            <span class="keyword">return</span> mapOfSubVarType.get(subroutine).get(<span class="keyword">var</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (typeOfClassVar.containsKey(<span class="keyword">var</span>))</span><br><span class="line">            <span class="keyword">return</span> typeOfClassVar.get(<span class="keyword">var</span>);</span><br><span class="line">    } <span class="keyword">catch</span> (ArrayIndexOutOfBoundsException e) {</span><br><span class="line">        System.out.println(<span class="string">&quot;The variable is undefined&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">varKind</span><span class="params">(String <span class="keyword">var</span>, String subroutine)</span> {</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">if</span> (subroutine != <span class="literal">null</span> &amp;&amp; mapOfSubVarKind.get(subroutine).containsKey(<span class="keyword">var</span>))</span><br><span class="line">            <span class="keyword">return</span> mapOfSubVarKind.get(subroutine).get(<span class="keyword">var</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (kindOfClassVar.containsKey(<span class="keyword">var</span>))</span><br><span class="line">            <span class="keyword">return</span> kindOfClassVar.get(<span class="keyword">var</span>);</span><br><span class="line">    } <span class="keyword">catch</span> (ArrayIndexOutOfBoundsException e) {</span><br><span class="line">        System.out.println(<span class="string">&quot;The variable is undefined.&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//if it&apos;s a classVar, then subroutine is null</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">kindCount</span><span class="params">(String kindName, String subroutine)</span> {</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">if</span> (subroutine.equals(<span class="string">&quot;Output.printInt&quot;</span>)) <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (kindName.equals(<span class="string">&quot;argument&quot;</span>)) <span class="keyword">return</span> subroutineArgNum.get(subroutine);</span><br><span class="line">        <span class="keyword">if</span> (kindName.equals(<span class="string">&quot;local&quot;</span>)) <span class="keyword">return</span> subroutineLCLNum.get(subroutine);</span><br><span class="line">        <span class="keyword">if</span> (kindName.equals(<span class="string">&quot;field&quot;</span>) || kindName.equals(<span class="string">&quot;static&quot;</span>)) <span class="keyword">return</span> classNum;</span><br><span class="line">    } <span class="keyword">catch</span> (ArrayIndexOutOfBoundsException e) {</span><br><span class="line">        System.out.println(<span class="string">&quot;The kind is out of range.&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="2vmwriter&#x5B9E;&#x73B0;">2.<code>VMWriter</code>&#x5B9E;&#x73B0;</h3>
<p>&#x2003;&#x2003;&#x4E3A;&#x6EE1;&#x8DB3;<code>CompileEngine</code>VM&#x4EE3;&#x7801;&#x7684;&#x751F;&#x6210;&#xFF0C;&#x6211;&#x4EEC;&#x5728;<code>VMWriter</code>&#x4E2D;&#x8BBE;&#x8BA1;&#x4EE5;&#x4E0B;&#x51FD;&#x6570;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">writePush</span><span class="params">(String segment, <span class="type">int</span> index)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">writePop</span><span class="params">(String segment, <span class="type">int</span> index)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">writeOp</span><span class="params">(String command)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">writeUnaryOp</span><span class="params">(String command)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">writeCall</span><span class="params">(String name, <span class="type">int</span> argNum)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">writeFunctionDec</span><span class="params">(String name, <span class="type">int</span> lclNum)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">writeFunctionCall</span><span class="params">(String name, <span class="type">int</span> argNum)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">writeReturn</span><span class="params">()</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ArrayList&lt;String&gt; <span class="title function_">writeString</span><span class="params">(String string)</span></span><br></pre></td></tr></table></figure>
<h3 id="3compileengine&#x5B9E;&#x73B0;">3.<code>CompileEngine</code>&#x5B9E;&#x73B0;</h3>
<p>&#x2003;&#x2003;&#x5728;<code>CompileEngine</code>&#x4E2D;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x8BFB;&#x5165;&#x5B8C;&#x6574;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x4EE5;&#x751F;&#x6210;&#x5BF9;&#x5E94;&#x7684;VM&#x4EE3;&#x7801;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x9009;&#x62E9;&#x76F4;&#x63A5;&#x8BFB;&#x5165;&#x6E90;&#x7A0B;&#x5E8F;&#xFF0C;&#x7136;&#x540E;&#x6839;&#x636E;&#x8BFB;&#x5165;&#x884C;&#x7684;&#x5173;&#x952E;&#x5B57;&#x5224;&#x65AD;&#x5176;&#x8868;&#x8FBE;&#x5F0F;&#x7C7B;&#x578B;&#x3002;</p>
<h4 id="a&#x51C6;&#x5907;&#x5DE5;&#x4F5C;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&#x51C6;&#x5907;&#x5DE5;&#x4F5C;</h4>
<p>&#x2003;&#x2003;&#x4E3A;&#x4E86;&#x9632;&#x6B62;<code>if</code>&#x548C;<code>while</code>&#x7684;<span class="math inline">\(label\)</span>&#x91CD;&#x590D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;<code>private static int ifLabelCount, whileLabelCount</code>&#x3002;</p>
<p>&#x2003;&#x2003;&#x540C;&#x65F6;&#xFF0C;&#x7531;&#x4E8E;&#x5728;&#x8C03;&#x7528;&#x51FD;&#x6570;&#x65F6;&#x9700;&#x8981;&#x77E5;&#x9053;&#x51FD;&#x6570;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x7C7B;&#x578B;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x8981;&#x5728;&#x7F16;&#x8BD1;&#x8FC7;&#x7A0B;&#x4E2D;&#x5B58;&#x50A8;&#x6211;&#x4EEC;&#x9047;&#x5230;&#x7684;&#x51FD;&#x6570;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, String&gt; funcType</span><br></pre></td></tr></table></figure>
<h4 id="b&#x8868;&#x8FBE;&#x5F0F;&#x8BA1;&#x7B97;">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>&#x8868;&#x8FBE;&#x5F0F;&#x8BA1;&#x7B97;</h4>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#xFF0C;<code>Jack</code>&#x4E2D;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x6709;&#x4EE5;&#x4E0B;&#x6027;&#x8D28;&#xFF1A; 1.
&#x5F53;&#x6CA1;&#x6709;&#x62EC;&#x53F7;&#x65F6;&#xFF0C;&#x4ECE;&#x5DE6;&#x5230;&#x53F3;&#x4F9D;&#x6B21;&#x8BA1;&#x7B97;&#x3002; 2. &#x6709;&#x62EC;&#x53F7;&#x65F6;&#xFF0C;&#x4F18;&#x5148;&#x8BA1;&#x7B97;&#x62EC;&#x53F7;&#x5185;&#x5F0F;&#x5B50;&#x3002;</p>
<p>&#x2003;&#x2003;&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;<strong>&#x4ECE;&#x5DE6;&#x5F80;&#x53F3;</strong>&#x5904;&#x7406;&#x8F93;&#x5165;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x5E76;<strong>&#x4F18;&#x5148;&#x8003;&#x8651;&#x662F;&#x5426;&#x6709;&#x62EC;&#x53F7;&#xFF0C;&#x5982;&#x679C;&#x9047;&#x5230;&#x62EC;&#x53F7;&#x4F18;&#x5148;&#x5904;&#x7406;&#x62EC;&#x53F7;&#x5185;&#x8BED;&#x53E5;</strong>&#x3002;</p>
<blockquote>
<p><span class="math inline">\(p.s.\)</span>:&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x5148;&#x8BA1;&#x7B97;&#x5185;&#x4FA7;&#x62EC;&#x53F7;&#x3001;&#x518D;&#x8BA1;&#x7B97;&#x5916;&#x4FA7;&#x62EC;&#x53F7;&#xFF0C;&#x4E00;&#x4E2A;&#x81EA;&#x7136;&#x7684;&#x60F3;&#x6CD5;&#x662F;<strong>&#x627E;&#x5230;&#x6700;&#x5185;&#x4FA7;&#x7684;&#x62EC;&#x53F7;&#x5BF9;&#xFF0C;&#x5904;&#x7406;&#x5B8C;&#x5176;&#x5185;&#x90E8;&#x8868;&#x8FBE;&#x5F0F;&#x540E;&#x5C06;&#x5176;&#x62B9;&#x53BB;&#xFF0C;&#x5411;&#x5916;&#x5EF6;&#x5C55;</strong>&#x3002;&#x4F46;&#x662F;&#x8FD9;&#x6837;&#x4E0D;&#x6EE1;&#x8DB3;&#x6027;&#x8D28;&#x4E00;&#xFF0C;&#x56E0;&#x800C;&#x4F1A;&#x5BFC;&#x81F4;&#x5931;&#x8D25;&#x3002;</p>
</blockquote>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5229;&#x7528;<strong>&#x6808;</strong>&#x6765;&#x8FDB;&#x884C;&#x62EC;&#x53F7;&#x5BF9;&#x7684;&#x5339;&#x914D;&#xFF0C;&#x7136;&#x540E;&#x8BA1;&#x7B97;&#x5BF9;&#x5E94;&#x4E0B;&#x6807;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x503C;&#x3002;</p>
<p>&#x2003;&#x2003;&#x5728;<code>Jack</code>&#x8BED;&#x6CD5;&#x4E00;&#x7AE0;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x8868;&#x8FBE;&#x5F0F;&#x5177;&#x6709;&#x5982;&#x4E0B;&#x7ED3;&#x6784;&#xFF1A;</p>
<p><span class="math display">\[expression=term(op\;term)\]</span></p>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x6CBF;&#x7528;&#x8BE5;&#x7ED3;&#x6784;&#xFF0C;<strong>&#x5229;&#x7528;<code>op</code>&#x5C06;&#x539F;&#x8868;&#x8FBE;&#x5F0F;&#x62C6;&#x5206;&#x6210;&#x4E00;&#x4E2A;&#x4E2A;&#x5B50;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x7136;&#x540E;&#x5206;&#x522B;&#x9012;&#x5F52;&#x8BA1;&#x7B97;</strong>&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x5E76;&#x4E0D;&#x80FD;&#x786E;&#x5B9A;<span class="math inline">\(term\)</span>&#x7684;&#x4E2A;&#x6570;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x5BF9;&#x4E0A;&#x9762;&#x7684;&#x7ED3;&#x6784;&#x8FDB;&#x884C;&#x6539;&#x52A8;&#xFF1A;</p>
<p><span class="math display">\[expression=term(op\;expression)\]</span></p>
<p>&#x2003;&#x2003;&#x8BE5;&#x7ED3;&#x6784;&#x7684;&#x53D8;&#x91CF;&#x4E2A;&#x6570;&#x662F;&#x786E;&#x5B9A;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x5206;&#x522B;&#x9012;&#x5F52;&#x8BA1;&#x7B97;&#x5373;&#x53EF;&#xFF1A;</p>
<blockquote>
<p><span class="math inline">\(p.s\)</span>&#x8FD9;&#x91CC;&#x6709;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x68D8;&#x624B;&#x7684;&#x95EE;&#x9898;&#xFF1A;&#x5BF9;&#x4E8E;<span class="math inline">\(unary\;op\)</span>&#x7684;&#x5904;&#x7406;&#x3002;&#x5728;<code>-(1+2)</code>&#x8FD9;&#x4E2A;&#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;<code>-</code>&#x5E76;&#x4E0D;&#x8D77;&#x5230;&#x62C6;&#x5206;&#x7684;&#x4F5C;&#x7528;&#x3002;&#x6CE8;&#x610F;&#x5230;&#x6211;&#x4EEC;&#x662F;&#x4EE5;<span class="math inline">\(term\)</span>&#x4E3A;&#x57FA;&#x672C;&#x5904;&#x7406;&#x5355;&#x5143;&#x7684;&#xFF0C;&#x800C;<strong>&#x5728;<span class="math inline">\(term\)</span>&#x4E2D;<span class="math inline">\(unary\;op\)</span>&#x53EA;&#x80FD;&#x5728;&#x7B2C;&#x4E00;&#x4E2A;&#x4F4D;&#x7F6E;</strong>&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x4ECE;&#x5DE6;&#x5F80;&#x53F3;&#x8BA1;&#x7B97;&#x524D;<strong>&#x5148;&#x5224;&#x65AD;&#x7B2C;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x662F;&#x5426;&#x4E3A;<span class="math inline">\(op\)</span>&#xFF0C;&#x5982;&#x679C;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x8BA1;&#x7B97;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x8BA1;&#x7B97;&#x5B8C;&#x7B2C;&#x4E00;&#x4E2A;<span class="math inline">\(term\)</span>&#x540E;&#x8BB0;&#x5F55;&#x8BE5;&#x8868;&#x8FBE;&#x5F0F;&#xFF1A;</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//if the first character belongs unary op //then we skip it </span></span><br><span class="line"><span class="type">String</span> <span class="variable">unaryOp</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>; </span><br><span class="line"><span class="keyword">if</span> (isOp(line.charAt(<span class="number">0</span>))) { </span><br><span class="line">	unaryOp = Character.toString(line.charAt(<span class="number">0</span>)); </span><br><span class="line">	line = line.substring(<span class="number">1</span>); </span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!unaryOp.isEmpty()) expression.add(VMWriter.writeUnaryOp(unaryOp));</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> ArrayList&lt;String&gt; <span class="title function_">compileExpression</span><span class="params">(String line)</span> {</span><br><span class="line">    ArrayList&lt;String&gt; expression = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//if the first character belongs unary op</span></span><br><span class="line">    <span class="comment">//then we skip it</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">unaryOp</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (isOp(line.charAt(<span class="number">0</span>))) {</span><br><span class="line">        unaryOp = Character.toString(line.charAt(<span class="number">0</span>));</span><br><span class="line">        line = line.substring(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!containOP(line)) {</span><br><span class="line">        ArrayList&lt;String&gt; term = compileTerm(line);</span><br><span class="line">        expression.addAll(term);</span><br><span class="line">        <span class="keyword">if</span> (!unaryOp.isEmpty())</span><br><span class="line">            expression.add(VMWriter.writeUnaryOp(unaryOp));</span><br><span class="line">        <span class="keyword">return</span> expression;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//if we meet (, deal with it first</span></span><br><span class="line">    <span class="keyword">if</span> (line.charAt(<span class="number">0</span>) == <span class="string">&apos;(&apos;</span>) {</span><br><span class="line">        Stack&lt;Integer&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">rightIndex</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; line.length(); i++) {</span><br><span class="line">            <span class="keyword">if</span> (line.charAt(i) == <span class="string">&apos;(&apos;</span>) stack.push(i);</span><br><span class="line">            <span class="keyword">if</span> (line.charAt(i) == <span class="string">&apos;)&apos;</span>) {</span><br><span class="line">                <span class="keyword">if</span> (!stack.isEmpty()) stack.pop();</span><br><span class="line">                <span class="keyword">else</span> {</span><br><span class="line">                    rightIndex = i;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">termExp</span> <span class="operator">=</span> line.substring(<span class="number">0</span>, rightIndex + <span class="number">1</span>);</span><br><span class="line">        expression.addAll(compileTerm(termExp));</span><br><span class="line">        <span class="keyword">if</span> (!unaryOp.isEmpty()) expression.add(VMWriter.writeUnaryOp(unaryOp));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//if the ) is not the last, then after it comes an op</span></span><br><span class="line">        <span class="comment">//it&apos;s defined by the Jack grammar</span></span><br><span class="line">        <span class="keyword">if</span> (rightIndex &lt; line.length() - <span class="number">1</span>) {</span><br><span class="line">            expression.addAll(compileExpression(line.substring(rightIndex + <span class="number">2</span>)));</span><br><span class="line">            expression.add(VMWriter.writeOp(Character.toString(line.charAt(rightIndex + <span class="number">1</span>))));</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> expression;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//we deal with the next op</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">opIndex</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">curOp</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; line.length(); i++) {</span><br><span class="line">        <span class="keyword">if</span> (isOp(line.charAt(i))) {</span><br><span class="line">            opIndex = i;</span><br><span class="line">            curOp = Character.toString(line.charAt(i));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">termExp1</span> <span class="operator">=</span> line.substring(<span class="number">0</span>, opIndex);</span><br><span class="line">    <span class="type">String</span> <span class="variable">termExp2</span> <span class="operator">=</span> line.substring(opIndex + <span class="number">1</span>);</span><br><span class="line">    expression.addAll(compileTerm(termExp1));</span><br><span class="line">    <span class="keyword">if</span> (!unaryOp.isEmpty())</span><br><span class="line">        expression.add(VMWriter.writeUnaryOp(unaryOp));</span><br><span class="line">    <span class="keyword">if</span> (!termExp2.isEmpty())</span><br><span class="line">        expression.addAll(compileExpression(termExp2));</span><br><span class="line">    expression.add(VMWriter.writeOp(curOp));</span><br><span class="line">    <span class="keyword">return</span> expression;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;&#x5BF9;&#x4E8E;<span class="math inline">\(term\)</span>&#x7684;&#x5904;&#x7406;&#x8F83;&#x4E3A;&#x7B80;&#x5355;&#xFF0C;&#x53EA;&#x9700;&#x6CE8;&#x610F;&#x5BF9;&#x51FD;&#x6570;&#x7684;&#x5224;&#x65AD;&#x65B9;&#x5F0F;&#x5373;&#x53EF;&#xFF1A;
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> ArrayList&lt;String&gt; <span class="title function_">compileTerm</span><span class="params">(String line)</span> {</span><br><span class="line">    ArrayList&lt;String&gt; term = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (line.matches(<span class="string">&quot;-?\\d+&quot;</span>)) {</span><br><span class="line">        term.add(VMWriter.writePush(<span class="string">&quot;constant&quot;</span>, Integer.parseInt(line)));</span><br><span class="line">        <span class="keyword">return</span> term;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (line.contains(<span class="string">&quot;(&quot;</span>)) {</span><br><span class="line">        <span class="comment">//if the first is &quot;(&quot;, then it&apos;s (expression)</span></span><br><span class="line">        <span class="keyword">if</span> (line.charAt(<span class="number">0</span>) == <span class="string">&apos;(&apos;</span>) {</span><br><span class="line">            term.addAll(compileExpression(line.substring(<span class="number">1</span>, line.length() - <span class="number">1</span>)));</span><br><span class="line">            <span class="keyword">return</span> term;</span><br><span class="line">        } <span class="keyword">else</span> { <span class="comment">//else, it&apos;s a functionCall</span></span><br><span class="line">            ArrayList&lt;String&gt; functionCall = compileSubroutineCall(line);</span><br><span class="line">            term.addAll(functionCall);</span><br><span class="line">            <span class="keyword">return</span> term;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//if line contains &apos;[&apos;, it must be an array</span></span><br><span class="line">    <span class="keyword">if</span> (line.contains(<span class="string">&quot;[&quot;</span>)) {</span><br><span class="line">        term.addAll(compileArray(line));</span><br><span class="line">        <span class="keyword">return</span> term;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//if it&apos;s a stringConstant, we use string method to append char by char</span></span><br><span class="line">    <span class="keyword">if</span> (line.charAt(<span class="number">0</span>) == <span class="string">&apos;&quot;&apos;</span>) {</span><br><span class="line">        <span class="type">String</span> <span class="variable">string</span> <span class="operator">=</span> line.substring(<span class="number">1</span>, line.length() - <span class="number">1</span>);</span><br><span class="line">        term.addAll(VMWriter.writeString(string));</span><br><span class="line">        <span class="keyword">return</span> term;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//else, it&apos;s a variable</span></span><br><span class="line">    <span class="keyword">else</span> {</span><br><span class="line">        term.add(VMWriter.writePush(SymbolTable.varKind(line, curSubroutine.toString()), SymbolTable.varCount(line, curSubroutine.toString())));</span><br><span class="line">        <span class="keyword">return</span> term;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<h4 id="creturn&#x8BED;&#x53E5;">&#x2003;&#x2003;<span class="math inline">\(c.\)</span><code>return</code>&#x8BED;&#x53E5;</h4>
<p>&#x2003;&#x2003;&#x6839;&#x636E;<code>return</code>&#x53D8;&#x91CF;&#x8FDB;&#x884C;&#x5206;&#x7C7B;&#x5904;&#x7406;&#x5373;&#x53EF;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> ArrayList&lt;String&gt; <span class="title function_">compileReturnStatement</span><span class="params">(String line)</span> {</span><br><span class="line">    ArrayList&lt;String&gt; returnStatement = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Extract the return value from the line</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">returnVal</span> <span class="operator">=</span> line.substring(<span class="number">6</span>, line.indexOf(<span class="string">&quot;;&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!returnVal.isEmpty()) {</span><br><span class="line">        <span class="keyword">if</span> (isKeywordConstant(returnVal)) {</span><br><span class="line">            <span class="comment">// Handle keyword constants</span></span><br><span class="line">            <span class="keyword">if</span> (returnVal.equals(<span class="string">&quot;this&quot;</span>)) {</span><br><span class="line">                returnStatement.add(VMWriter.writePush(<span class="string">&quot;pointer&quot;</span>, <span class="number">0</span>));</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (returnVal.equals(<span class="string">&quot;true&quot;</span>)) {</span><br><span class="line">                returnStatement.add(VMWriter.writePush(<span class="string">&quot;constant&quot;</span>, <span class="number">0</span>));</span><br><span class="line">                returnStatement.add(<span class="string">&quot;not&quot;</span>);</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (returnVal.equals(<span class="string">&quot;false&quot;</span>) || returnVal.equals(<span class="string">&quot;null&quot;</span>)) {</span><br><span class="line">                returnStatement.add(VMWriter.writePush(<span class="string">&quot;constant&quot;</span>, <span class="number">0</span>));</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (returnVal.matches(<span class="string">&quot;-?\\d+&quot;</span>)) {</span><br><span class="line">            <span class="comment">// Handle integer constants</span></span><br><span class="line">            returnStatement.add(VMWriter.writePush(<span class="string">&quot;constant&quot;</span>, Integer.parseInt(returnVal)));</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (returnVal.charAt(<span class="number">0</span>) == <span class="string">&apos;&quot;&apos;</span>) {</span><br><span class="line">            <span class="comment">// Handle string constants</span></span><br><span class="line">            returnVal = returnVal.substring(<span class="number">1</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">string</span> <span class="operator">=</span> returnVal.substring(<span class="number">0</span>, returnVal.length() - <span class="number">1</span>);</span><br><span class="line">            returnStatement.addAll(VMWriter.writeString(string));</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="comment">// Handle variable return values</span></span><br><span class="line">            returnStatement.add(VMWriter.writePush(SymbolTable.varKind(returnVal, curSubroutine.toString()), SymbolTable.varCount(returnVal, curSubroutine.toString())));</span><br><span class="line">        }</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="comment">// If no return value, push 0</span></span><br><span class="line">        returnStatement.add(VMWriter.writePush(<span class="string">&quot;constant&quot;</span>, <span class="number">0</span>));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add return command</span></span><br><span class="line">    returnStatement.add(<span class="string">&quot;return&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> returnStatement;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="ddo&#x8BED;&#x53E5;">&#x2003;&#x2003;<span class="math inline">\(d.\)</span><code>do</code>&#x8BED;&#x53E5;</h4>
<p>&#x2003;&#x2003;<code>do</code>&#x8BED;&#x53E5;&#x53EA;&#x9700;&#x5904;&#x7406;&#x88AB;&#x8C03;&#x7528;&#x7684;&#x51FD;&#x6570;&#x5373;&#x53EF;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> ArrayList&lt;String&gt; <span class="title function_">compileDoStatement</span><span class="params">(String line)</span> {</span><br><span class="line">	line = line.substring(<span class="number">2</span>);</span><br><span class="line">&#xA0; &#xA0; <span class="keyword">return</span> compileSubroutineCall(line);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h4 id="elet&#x8BED;&#x53E5;">&#x2003;&#x2003;<span class="math inline">\(e.\)</span><code>let</code>&#x8BED;&#x53E5;</h4>
<p>&#x2003;&#x2003;&#x5BF9;<code>let</code>&#x8BED;&#x53E5;&#x7684;&#x5904;&#x7406;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x5206;&#x7C7B;&#x7684;&#x4F9D;&#x636E;&#xFF1A;<strong>&#x5DE6;&#x4FA7;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x662F;&#x5426;&#x4E3A;&#x6570;&#x7EC4;</strong>&#xFF0C;&#x5982;&#x679C;&#x5DE6;&#x4FA7;&#x4E3A;&#x6570;&#x7EC4;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x52A0;&#x5165;&#x4EE5;&#x4E0B;&#x7684;&#x64CD;&#x4F5C;&#xFF1A;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pop temp 0</span><br><span class="line">pop pointer 1</span><br><span class="line">push temp 0</span><br><span class="line">pop that 0</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;&#x5426;&#x5219;&#x5DE6;&#x4FA7;&#x8868;&#x8FBE;&#x5F0F;&#x53EA;&#x80FD;&#x662F;&#x4E00;&#x4E2A;&#x666E;&#x901A;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x5176;<code>pop</code>&#x5373;&#x53EF;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&#xA0; &#xA0; <span class="keyword">private</span> <span class="keyword">static</span> ArrayList&lt;String&gt; <span class="title function_">compileLetStatement</span><span class="params">(String line)</span> {</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; ArrayList&lt;String&gt; letstatement = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; line = line.substring(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; <span class="type">String</span> <span class="variable">var1</span> <span class="operator">=</span> line.substring(<span class="number">0</span>, line.indexOf(<span class="string">&quot;=&quot;</span>));</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; <span class="type">String</span> <span class="variable">var2</span> <span class="operator">=</span> line.substring(line.indexOf(<span class="string">&quot;=&quot;</span>) + <span class="number">1</span>, line.indexOf(<span class="string">&quot;;&quot;</span>));</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; <span class="comment">//case 1: array var + expression</span></span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; <span class="keyword">if</span> (var1.contains(<span class="string">&quot;[&quot;</span>)) {</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; <span class="type">String</span> <span class="variable">exp1</span> <span class="operator">=</span> var1.substring(var1.indexOf(<span class="string">&quot;[&quot;</span>) + <span class="number">1</span>, var1.indexOf(<span class="string">&quot;]&quot;</span>));</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; <span class="type">String</span> <span class="variable">name1</span> <span class="operator">=</span> var1.substring(<span class="number">0</span>, var1.indexOf(<span class="string">&quot;[&quot;</span>));</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ArrayList&lt;String&gt; expression1 = compileExpression(exp1);</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; letstatement.addAll(expression1);</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; letstatement.add(VMWriter.writePush(SymbolTable.varKind(name1, curSubroutine.toString()), SymbolTable.varCount(name1, curSubroutine.toString())));</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; letstatement.add(<span class="string">&quot;add&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; letstatement.addAll(compileExpression(var2));</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; letstatement.add(VMWriter.writePop(<span class="string">&quot;temp&quot;</span>, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; letstatement.add(VMWriter.writePop(<span class="string">&quot;pointer&quot;</span>, <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; letstatement.add(VMWriter.writePush(<span class="string">&quot;temp&quot;</span>, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; letstatement.add(VMWriter.writePop(<span class="string">&quot;that&quot;</span>, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; <span class="keyword">return</span> letstatement;</span><br><span class="line"></span><br><span class="line">&#xA0; &#xA0; &#xA0; &#xA0; }</span><br></pre></td></tr></table></figure>
<h4 id="e&#x51FD;&#x6570;&#x4F53;&#x6A21;&#x5757;&#x8BBE;&#x8BA1;ampif-while&#x5904;&#x7406;&#x624B;&#x6BB5;">&#x2003;&#x2003;<span class="math inline">\(e.\)</span>&#x51FD;&#x6570;&#x4F53;&#x6A21;&#x5757;&#x8BBE;&#x8BA1;&amp;<code>if, while</code>&#x5904;&#x7406;&#x624B;&#x6BB5;</h4>
<p>&#x2003;&#x2003;&#x5728;&#x5904;&#x7406;<code>if</code>&#x8BED;&#x53E5;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728;&#x5904;&#x7406;<code>if</code>&#x82B1;&#x62EC;&#x53F7;&#x62EC;&#x8D77;&#x7684;&#x90E8;&#x5206;&#x540E;&#x6DFB;&#x52A0;<code>IF_ENDLabelindex</code>&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x81EA;&#x7136;&#x5730;&#x60F3;&#x5230;&#x5F15;&#x5165;<code>compileSubroutineBody</code>&#x51FD;&#x6570;&#x5BF9;&#x51FD;&#x6570;&#x4F53;&#x6A21;&#x5757;&#x8FDB;&#x884C;&#x6574;&#x4F53;&#x5730;&#x7F16;&#x8BD1;(&#x800C;&#x975E;&#x4E00;&#x6761;&#x8BED;&#x53E5;&#x4E00;&#x6761;&#x8BED;&#x53E5;&#x5730;&#x79BB;&#x6563;&#x5904;&#x7406;)&#xFF0C;&#x5B83;&#x63A5;&#x53D7;&#x7684;&#x53C2;&#x6570;&#x662F;<strong>&#x591A;&#x6761;&#x8BED;&#x53E5;&#x6784;&#x6210;&#x7684;&#x51FD;&#x6570;&#x4F53;<code>ArrayList&lt;String&gt;</code></strong>&#x3002;</p>
<p>&#x2003;&#x2003;&#x90A3;&#x4E48;&#x5982;&#x4F55;&#x5B9E;&#x73B0;<code>if</code>&#x8BED;&#x53E5;&#x5462;&#xFF1F;&#x4E00;&#x4E2A;&#x81EA;&#x7136;&#x5730;&#x60F3;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A;</p>
<ol type="1">
<li>&#x8BBE;&#x8BA1;&#x4E00;&#x4E2A;&#x51FD;&#x6570;<code>compileIfStatement()</code>&#xFF0C;&#x5B83;&#x63A5;&#x53D7;&#x4E00;&#x4E2A;<code>ArrayList&lt;String&gt;</code>&#xFF0C;&#x8FD4;&#x56DE;&#x7F16;&#x8BD1;&#x540E;&#x7684;<code>ArrayList&lt;String&gt;</code>&#x3002;</li>
<li>&#x4F20;&#x5165;<code>if</code>&#x8BED;&#x53E5;&#x5BF9;&#x5E94;&#x7684;&#x5B50;&#x7A0B;&#x5E8F;&#xFF0C;&#x7136;&#x540E;&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#x3002;</li>
</ol>
<p>&#x2003;&#x2003;&#x4F46;&#x662F;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x5F97;&#x5230;&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#x5E76;&#x5F80;&#x4E0B;&#x7EE7;&#x7EED;&#x5904;&#x7406;&#x65F6;&#xFF0C;&#x90A3;&#x4E9B;&#x5C5E;&#x4E8E;<code>if</code>&#x5B50;&#x7A0B;&#x5E8F;&#x7684;&#x4EE3;&#x7801;&#x4F1A;<strong>&#x88AB;&#x91CD;&#x590D;&#x5904;&#x7406;</strong>&#x3002;&#x8FD9;&#x5E76;&#x4E0D;&#x662F;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x7684;&#x7ED3;&#x679C;&#x3002;&#x7B14;&#x8005;&#x66FE;&#x8BD5;&#x8FC7;&#x5904;&#x7406;&#x5B8C;<code>if</code>&#x7684;&#x5B50;&#x7A0B;&#x5E8F;&#x540E;&#x5C06;&#x5176;&#x5220;&#x53BB;&#xFF0C;&#x4F46;&#x6700;&#x7EC8;&#x5931;&#x8D25;&#x4E86;&#x3002;&#x56E0;&#x6B64;&#x7B14;&#x8005;&#x60F3;&#x5230;&#x4E86;&#x4E0B;&#x9762;&#x7684;&#x65B9;&#x6CD5;&#xFF1A;</p>
<ol type="1">
<li>&#x6211;&#x4EEC;&#x4F9D;&#x7136;&#x5BF9;<code>if</code>&#x5BF9;&#x5E94;&#x7684;&#x5B50;&#x7A0B;&#x5E8F;&#x8FDB;&#x884C;&#x8BFB;&#x53D6;&#x3002;</li>
<li>&#x4F46;&#x6211;&#x4EEC;&#x5E76;&#x4E0D;&#x5C06;&#x5176;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x4F20;&#x5165;<code>compileIfStatement</code>&#xFF0C;&#x800C;&#x662F;<strong>&#x8BB0;&#x5F55;&#x4E0B;&#x8BE5;&#x5B50;&#x7A0B;&#x5E8F;&#x7684;&#x884C;&#x6570;</strong><code>ifIndex</code>&#x3002;</li>
<li>&#x540C;&#x65F6;&#xFF0C;&#x5728;<code>compileSubroutineBody</code>&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5B9E;&#x65F6;&#x66F4;&#x65B0;&#x5F53;&#x524D;&#x7684;&#x4EE3;&#x7801;&#x884C;&#x6570;<code>currentIndex</code>&#x3002;</li>
<li>&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x8BB0;&#x5F55;&#x7684;<code>currentIndex</code>&#x548C;<code>ifIndex</code><strong>&#x8BA1;&#x7B97;&#x51FA;&#x5E94;&#x8BE5;&#x6DFB;&#x52A0;<span class="math inline">\(label\)</span>&#x7684;&#x884C;&#x6570;</strong>&#xFF0C;&#x7136;&#x540E;<strong>&#x5F53;<code>currentIndex</code>&#x7684;&#x503C;&#x4E0E;&#x5176;&#x76F8;&#x7B49;&#x65F6;&#x6DFB;&#x52A0;<span class="math inline">\(label\)</span></strong>&#x3002;</li>
</ol>
<p>&#x2003;&#x2003;&#x540C;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x4F9D;&#x7136;&#x4FDD;&#x7559;<code>compileIfStatement</code>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x53EA;&#x662F;&#x8BE5;&#x65B9;&#x6CD5;&#x4EC5;&#x7528;&#x6765;&#x7F16;&#x8BD1;<code>if(expression)</code>&#x8BED;&#x53E5;&#x3002;</p>
<blockquote>
<p>&#x5982;&#x679C;&#x9047;&#x5230;<code>else</code>&#x8BED;&#x53E5;&#xFF0C;&#x76F4;&#x63A5;&#x5FFD;&#x7565;&#x5373;&#x53EF;&#x3002;</p>
</blockquote>
<blockquote>
<p>&#x53E6;&#xFF1A;&#x6211;&#x4EEC;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x7528;&#x7C7B;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;<code>static int ifLabelCount</code>&#x4F5C;&#x4E3A;&#x6807;&#x8BB0;&#x7684;&#x5E8F;&#x53F7;&#xFF0C;&#x56E0;&#x4E3A;&#x5F53;&#x5B58;&#x5728;&#x5D4C;&#x5957;&#x6761;&#x4EF6;&#x5FAA;&#x73AF;&#x65F6;&#xFF0C;&#x7531;&#x4E8E;&#x4E0D;&#x7BA1;&#x9047;&#x5230;&#x54EA;&#x4E2A;<code>if</code>&#x8BE5;&#x503C;&#x90FD;&#x4F1A;&#x589E;&#x52A0;1&#xFF0C;&#x8FD9;&#x4F1A;&#x5BFC;&#x81F4;<strong>&#x540C;&#x4E00;&#x4E2A;<code>if</code>&#x7684;&#x524D;&#x540E;&#x6807;&#x8BB0;&#x5E8F;&#x53F7;&#x4E0D;&#x4E00;&#x81F4;</strong>&#x3002;&#x5BF9;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;<strong>&#x7528;&#x4E00;&#x4E2A;<span class="math inline">\(Map\)</span>&#x6765;&#x5B58;&#x50A8;&#x7279;&#x5B9A;<code>lineIndex</code>&#x5BF9;&#x5E94;&#x7684;&#x6807;&#x8BB0;&#x5E8F;&#x53F7;</strong>&#xFF0C;&#x7531;&#x4E8E;<code>lineIndex</code>&#x662F;&#x552F;&#x4E00;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x524D;&#x540E;&#x6807;&#x8BB0;&#x5E8F;&#x53F7;&#x5C06;&#x4F1A;&#x4E00;&#x81F4;&#x3002;</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> ArrayList&lt;String&gt; <span class="title function_">compileSubroutineBody</span><span class="params">(ArrayList&lt;String&gt; lines)</span> {</span><br><span class="line">    ArrayList&lt;String&gt; subroutinebody = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> <span class="variable">lineIndex</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ifstatementLineNum</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">whilestatementLineNum</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (String line : lines) {</span><br><span class="line">        <span class="keyword">if</span> (lineIndex == ifstatementLineNum) {</span><br><span class="line">            <span class="type">int</span> <span class="variable">labelCnt</span> <span class="operator">=</span> loopCount.get(ifstatementLineNum);</span><br><span class="line">            subroutinebody.add(<span class="string">&quot;label IF_FALSE&quot;</span> + Integer.toString(labelCnt));</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (lineIndex == whilestatementLineNum) {</span><br><span class="line">            <span class="type">int</span> <span class="variable">labelCnt</span> <span class="operator">=</span> loopCount.get(whilestatementLineNum);</span><br><span class="line">            subroutinebody.add(<span class="string">&quot;goto WHILE_EXP&quot;</span> + Integer.toString(labelCnt));</span><br><span class="line">            subroutinebody.add(<span class="string">&quot;label WHILE_END&quot;</span> + Integer.toString(labelCnt));</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (line.indexOf(<span class="string">&quot;else&quot;</span>) == <span class="number">0</span>) {</span><br><span class="line">            line = line.substring(<span class="number">4</span>);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (line.indexOf(<span class="string">&quot;do&quot;</span>) == <span class="number">0</span>) {</span><br><span class="line">            subroutinebody.addAll(compileDoStatement(line));</span><br><span class="line">            lineIndex++;</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (line.indexOf(<span class="string">&quot;let&quot;</span>) == <span class="number">0</span>) {</span><br><span class="line">            subroutinebody.addAll(compileLetStatement(line));</span><br><span class="line">            lineIndex++;</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (line.indexOf(<span class="string">&quot;return&quot;</span>) == <span class="number">0</span>) {</span><br><span class="line">            subroutinebody.addAll(compileReturnStatement(line));</span><br><span class="line">            lineIndex++;</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (line.indexOf(<span class="string">&quot;if&quot;</span>) == <span class="number">0</span>) {</span><br><span class="line">            <span class="type">String</span> <span class="variable">ifstatement</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span> (line.contains(<span class="string">&quot;{&quot;</span>)) {</span><br><span class="line">                ifstatement = line.substring(<span class="number">0</span>, line.indexOf(<span class="string">&quot;{&quot;</span>));</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                ifstatement = line;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            subroutinebody.addAll(compileIfStatement(ifstatement));</span><br><span class="line">            subroutinebody.add(<span class="string">&quot;if-goto IF_TRUE&quot;</span> + Integer.toString(ifLabelCount));</span><br><span class="line">            subroutinebody.add(<span class="string">&quot;goto IF_FALSE&quot;</span> + Integer.toString(ifLabelCount));</span><br><span class="line">            subroutinebody.add(<span class="string">&quot;label IF_TRUE&quot;</span> + Integer.toString(ifLabelCount));</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (line.contains(<span class="string">&quot;{&quot;</span>) &amp;&amp; line.indexOf(<span class="string">&quot;{&quot;</span>) != line.length() - <span class="number">1</span>) {</span><br><span class="line">                ArrayList&lt;String&gt; statement = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">                statement.add(line.substring(line.indexOf(<span class="string">&quot;{&quot;</span>) + <span class="number">1</span>));</span><br><span class="line">                subroutinebody.addAll(compileSubroutineBody(statement));</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            ifstatementLineNum = Operation.selectContent(Operation.subList(lines, lineIndex)).size() + lineIndex++;</span><br><span class="line">            loopCount.put(ifstatementLineNum, ifLabelCount++);</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (line.indexOf(<span class="string">&quot;while&quot;</span>) == <span class="number">0</span>) {</span><br><span class="line">            <span class="type">String</span> <span class="variable">whilestatement</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span> (line.contains(<span class="string">&quot;{&quot;</span>)) {</span><br><span class="line">                whilestatement = line.substring(<span class="number">0</span>, line.indexOf(<span class="string">&quot;{&quot;</span>));</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                whilestatement = line;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            subroutinebody.add(<span class="string">&quot;label WHILE_EXP&quot;</span> + Integer.toString(whileLabelCount));</span><br><span class="line">            subroutinebody.addAll(compileWhileStatement(whilestatement));</span><br><span class="line">            subroutinebody.add(<span class="string">&quot;not&quot;</span>);</span><br><span class="line">            subroutinebody.add(<span class="string">&quot;if-goto WHILE_END&quot;</span> + Integer.toString(whileLabelCount));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (line.contains(<span class="string">&quot;{&quot;</span>) &amp;&amp; line.indexOf(<span class="string">&quot;{&quot;</span>) != line.length() - <span class="number">1</span>) {</span><br><span class="line">                ArrayList&lt;String&gt; statement = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">                statement.add(line.substring(line.indexOf(<span class="string">&quot;{&quot;</span>) + <span class="number">1</span>));</span><br><span class="line">                subroutinebody.addAll(compileSubroutineBody(statement));</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            whilestatementLineNum = Operation.selectContent(Operation.subList(lines, lineIndex)).size() + lineIndex++;</span><br><span class="line">            loopCount.put(whilestatementLineNum, whileLabelCount++);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            lineIndex++;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> subroutinebody;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h4 id="f&#x5176;&#x4ED6;&#x6742;&#x9879;&#x7684;&#x5904;&#x7406;">&#x2003;&#x2003;<span class="math inline">\(f.\)</span>&#x5176;&#x4ED6;&#x6742;&#x9879;&#x7684;&#x5904;&#x7406;</h4>
<p>&#x2003;&#x2003;&#x5728;&#x5B9E;&#x73B0;&#x4E86;&#x6846;&#x67B6;&#x7684;&#x5927;&#x90E8;&#x5206;&#x5185;&#x5BB9;&#x540E;&#xFF0C;&#x9488;&#x5BF9;VM&#x4EE3;&#x7801;&#x81EA;&#x8EAB;&#x7684;&#x7279;&#x5B9A;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x989D;&#x5916;&#x8865;&#x5145;&#x5BF9;&#x4E00;&#x4E9B;&#x64CD;&#x4F5C;&#x7684;&#x5B9E;&#x73B0;&#xFF1A;</p>
<ol type="1">
<li>&#x5BF9;&#x6570;&#x7EC4;&#x7684;&#x5904;&#x7406;&#xFF1A;&#x6211;&#x4EEC;&#x5C06;&#x6570;&#x7EC4;&#x540D;&#x79F0;&#x6240;&#x5728;&#x5185;&#x5B58;&#x6BB5;&#x548C;&#x5185;&#x90E8;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x503C;<code>add</code>&#xFF0C;&#x7136;&#x540E;<code>pop pointer 1</code>&#xFF0C;<code>push that 0</code>&#x5373;&#x53EF;&#xFF1A;</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> ArrayList&lt;String&gt; <span class="title function_">compileArray</span><span class="params">(String line)</span> {</span><br><span class="line">    ArrayList&lt;String&gt; array = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// the array consists of varName + [ + expression + ]</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">varName</span> <span class="operator">=</span> line.substring(<span class="number">0</span>, line.indexOf(<span class="string">&quot;[&quot;</span>));</span><br><span class="line">    <span class="type">String</span> <span class="variable">exp</span> <span class="operator">=</span> line.substring(line.indexOf(<span class="string">&quot;[&quot;</span>) + <span class="number">1</span>, line.indexOf(<span class="string">&quot;]&quot;</span>));</span><br><span class="line">    ArrayList&lt;String&gt; expression = compileExpression(exp);</span><br><span class="line"></span><br><span class="line">    array.add(VMWriter.writePush(SymbolTable.varKind(varName, curSubroutine.toString()), SymbolTable.varCount(varName, curSubroutine.toString())));</span><br><span class="line">    array.addAll(expression);</span><br><span class="line">    array.add(<span class="string">&quot;add&quot;</span>);</span><br><span class="line">    array.add(VMWriter.writePop(<span class="string">&quot;pointer&quot;</span>, <span class="number">1</span>));</span><br><span class="line">    array.add(VMWriter.writePush(<span class="string">&quot;that&quot;</span>, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> array;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>&#x8C03;&#x7528;&#x51FD;&#x6570;&#xFF1A;&#x5C06;&#x51FD;&#x6570;&#x6240;&#x9700;&#x53C2;&#x6570;<code>push</code>&#xFF0C;&#x7136;&#x540E;&#x8BA1;&#x7B97;&#x53C2;&#x6570;&#x4E2A;&#x6570;&#x3001;&#x8C03;&#x7528;&#x5373;&#x53EF;&#x3002;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x5224;&#x65AD;&#x51FD;&#x6570;&#x662F;&#x5426;&#x4E3A;<code>void</code>&#x578B;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x7684;&#x8BDD;&#x9700;&#x8981;<code>pop temp 0</code>&#xFF1A;</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> ArrayList&lt;String&gt; <span class="title function_">compileSubroutineCall</span><span class="params">(String line)</span> {</span><br><span class="line">    ArrayList&lt;String&gt; subroutine = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> <span class="variable">argNum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// we first store the functionName</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">funcName</span> <span class="operator">=</span> line.substring(<span class="number">0</span>, line.indexOf(<span class="string">&quot;(&quot;</span>));</span><br><span class="line">    line = line.substring(line.indexOf(<span class="string">&quot;(&quot;</span>));</span><br><span class="line">    <span class="keyword">if</span> (!funcName.contains(<span class="string">&quot;.&quot;</span>)) funcName = className + <span class="string">&quot;.&quot;</span> + funcName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// then comes the expressionList</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">expressionList</span> <span class="operator">=</span> line.substring(line.indexOf(<span class="string">&apos;(&apos;</span>) + <span class="number">1</span>, line.indexOf(<span class="string">&apos;)&apos;</span>));</span><br><span class="line">    <span class="keyword">if</span> (!expressionList.isEmpty()) {</span><br><span class="line">        ArrayList&lt;String&gt; expressions = compileExpressionList(expressionList);</span><br><span class="line">        subroutine.addAll(expressions);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!expressionList.isEmpty()) {</span><br><span class="line">        argNum = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; expressionList.length(); i++) {</span><br><span class="line">            <span class="keyword">if</span> (expressionList.charAt(i) == <span class="string">&apos;,&apos;</span>) argNum++;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// finally we call the method</span></span><br><span class="line">    <span class="keyword">if</span> (Tokenizer.funcCollection.contains(funcName)) {</span><br><span class="line">        subroutine.add(VMWriter.writeFunctionCall(funcName, argNum));</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">for</span> (String s : Tokenizer.funcCollection) {</span><br><span class="line">            <span class="keyword">if</span> (s.substring(s.indexOf(<span class="string">&quot;.&quot;</span>) + <span class="number">1</span>).equals(funcName.substring(funcName.indexOf(<span class="string">&quot;.&quot;</span>) + <span class="number">1</span>))) {</span><br><span class="line">                subroutine.add(VMWriter.writeFunctionCall(s, argNum));</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (funcType.get(funcName).equals(<span class="string">&quot;void&quot;</span>))</span><br><span class="line">        subroutine.add(VMWriter.writePop(<span class="string">&quot;temp&quot;</span>, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> subroutine;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h4 id="gcompileengine&#x6700;&#x7EC8;&#x6784;&#x5EFA;">&#x2003;&#x2003;<span class="math inline">\(g.\)</span>
<code>CompileEngine</code>&#x6700;&#x7EC8;&#x6784;&#x5EFA;</h4>
<ol type="1">
<li><p>&#x9884;&#x5904;&#x7406;&#x3002;&#x5C06;&#x5F85;&#x7F16;&#x8BD1;&#x7684;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x6587;&#x4EF6;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x4F20;&#x5165;<code>SymbolTable.constructor</code>&#xFF0C;&#x4EE5;&#x6784;&#x5EFA;&#x6BCF;&#x4E2A;&#x6587;&#x4EF6;&#x5BF9;&#x5E94;&#x7684;<code>Symbol Table</code>&#x3002;</p></li>
<li><p>&#x7F16;&#x8BD1;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x9047;&#x5230;&#x4E00;&#x4E2A;&#x51FD;&#x6570;/&#x65B9;&#x6CD5;&#x540D;&#xFF0C;&#x5148;&#x5C06;&#x5176;&#x5B58;&#x5165;<code>funcType</code>&#x4E2D;&#xFF0C;&#x4EE5;&#x5728;&#x540E;&#x7EED;&#x8C03;&#x7528;&#x8BE5;&#x51FD;&#x6570;&#x65F6;&#x80FD;&#x591F;&#x627E;&#x5230;&#x8BE5;&#x51FD;&#x6570;/&#x65B9;&#x6CD5;&#x540D;&#x3002;</p></li>
<li><p>&#x5BF9;<code>constructor</code>&#xFF0C;<code>method</code>&#x9700;&#x8981;&#x8FDB;&#x884C;&#x5404;&#x81EA;&#x7684;&#x9884;&#x5904;&#x7406;&#x3002;</p></li>
<li><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C06;&#x5F85;&#x7F16;&#x8BD1;&#x7684;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#x5206;&#x7C7B;&#xFF1A;</p>
<ul>
<li>&#x65B9;&#x6CD5;/&#x51FD;&#x6570;&#x7684;&#x58F0;&#x660E;&#x3002;</li>
<li>&#x53D8;&#x91CF;&#x58F0;&#x660E;&#x3002;</li>
<li>&#x65B9;&#x6CD5;/&#x51FD;&#x6570;&#x4F53;&#x3002;</li>
</ul></li>
</ol>
<p>&#x2003;&#x2003;&#x5BF9;&#x6BCF;&#x4E00;&#x7C7B;&#xFF0C;&#x5206;&#x522B;&#x7F16;&#x8BD1;&#x5373;&#x53EF;&#x3002;&#x9700;&#x8981;&#x6CE8;&#x610F;&#xFF0C;&#x5904;&#x7406;&#x51FD;&#x6570;&#x4F53;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8BFB;&#x5165;&#x6574;&#x4E2A;&#x5B50;&#x7A0B;&#x5E8F;&#xFF0C;&#x5C06;&#x5176;&#x653E;&#x5165;<code>ArrayList&lt;String&gt;</code>&#x4E2D;&#x4F5C;&#x4E3A;<code>compileSubroutineBody</code>&#x7684;&#x53C2;&#x6570;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">constructor</span><span class="params">(String[] files)</span> {</span><br><span class="line">    <span class="keyword">for</span> (String filename : files) {</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> filename.substring(<span class="number">0</span>, filename.length() - <span class="number">5</span>);</span><br><span class="line">        Operation.addToArray(Tokenizer.className, name);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    initType();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (String filename : files) {</span><br><span class="line">        SymbolTable.constructor(filename);</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="type">String</span> <span class="variable">vmFile</span> <span class="operator">=</span> filename.substring(<span class="number">0</span>, filename.length() - <span class="number">5</span>) + <span class="string">&quot;.vm&quot;</span>;</span><br><span class="line">            <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(filename));</span><br><span class="line">            <span class="type">BufferedWriter</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(<span class="keyword">new</span> <span class="title class_">FileWriter</span>(vmFile));</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> Operation.modify(reader.readLine());</span><br><span class="line">            <span class="keyword">while</span> (line != <span class="literal">null</span>) {</span><br><span class="line">                <span class="keyword">if</span> (!line.isEmpty()) {</span><br><span class="line">                    <span class="keyword">if</span> (line.indexOf(<span class="string">&quot;class&quot;</span>) == <span class="number">0</span>) {</span><br><span class="line">                        className.setLength(<span class="number">0</span>);</span><br><span class="line">                        className.append(line.substring(<span class="number">5</span>, line.length() - <span class="number">1</span>));</span><br><span class="line">                        line = Operation.modify(reader.readLine());</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    }</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (isSubroutineDec(line)) {</span><br><span class="line">                        <span class="type">String</span> <span class="variable">subroutineKind</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">                        <span class="type">String</span> <span class="variable">subroutineType</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">                        <span class="type">int</span> <span class="variable">subroutineLength</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">                        <span class="type">int</span> <span class="variable">typeLength</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; subroutineDec.length; i++) {</span><br><span class="line">                            <span class="keyword">if</span> (line.indexOf(subroutineDec[i]) == <span class="number">0</span>) {</span><br><span class="line">                                subroutineKind = subroutineDec[i];</span><br><span class="line">                                subroutineLength = subroutineDec[i].length();</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            }</span><br><span class="line">                        }</span><br><span class="line"></span><br><span class="line">                        line = line.substring(subroutineLength);</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// then comes the type</span></span><br><span class="line">                        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; type.length; i++) {</span><br><span class="line">                            <span class="keyword">if</span> (line.indexOf(type[i]) == <span class="number">0</span>) {</span><br><span class="line">                                subroutineType = type[i];</span><br><span class="line">                                typeLength = type[i].length();</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            }</span><br><span class="line">                        }</span><br><span class="line"></span><br><span class="line">                        line = line.substring(typeLength);</span><br><span class="line">                        <span class="type">String</span> <span class="variable">subroutine</span> <span class="operator">=</span> className + <span class="string">&quot;.&quot;</span> + line.substring(<span class="number">0</span>, line.indexOf(<span class="string">&quot;(&quot;</span>));</span><br><span class="line">                        curSubroutine.setLength(<span class="number">0</span>);</span><br><span class="line">                        curSubroutine.append(subroutine);</span><br><span class="line">                        funcType.put(curSubroutine.toString(), subroutineType);</span><br><span class="line">                        writer.write(VMWriter.writeFunctionDec(curSubroutine.toString(), SymbolTable.kindCount(<span class="string">&quot;local&quot;</span>, curSubroutine.toString())));</span><br><span class="line">                        writer.newLine();</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (subroutineKind.equals(<span class="string">&quot;constructor&quot;</span>)) {</span><br><span class="line">                            <span class="type">String</span> <span class="variable">line1</span> <span class="operator">=</span> VMWriter.writePush(<span class="string">&quot;constant&quot;</span>, SymbolTable.kindCount(<span class="string">&quot;field&quot;</span>, <span class="literal">null</span>));</span><br><span class="line">                            <span class="type">String</span> <span class="variable">line2</span> <span class="operator">=</span> VMWriter.writeCall(<span class="string">&quot;Memory.alloc&quot;</span>, <span class="number">1</span>);</span><br><span class="line">                            writer.write(line1);</span><br><span class="line">                            writer.newLine();</span><br><span class="line">                            writer.write(line2);</span><br><span class="line">                            writer.newLine();</span><br><span class="line">                        }</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (subroutineKind.equals(<span class="string">&quot;method&quot;</span>)) {</span><br><span class="line">                            <span class="type">String</span> <span class="variable">line1</span> <span class="operator">=</span> VMWriter.writePush(<span class="string">&quot;argument&quot;</span>, <span class="number">0</span>);</span><br><span class="line">                            <span class="type">String</span> <span class="variable">line2</span> <span class="operator">=</span> VMWriter.writePop(<span class="string">&quot;pointer&quot;</span>, <span class="number">0</span>);</span><br><span class="line">                            writer.write(line1);</span><br><span class="line">                            writer.newLine();</span><br><span class="line">                            writer.write(line2);</span><br><span class="line">                            writer.newLine();</span><br><span class="line">                        }</span><br><span class="line"></span><br><span class="line">                        line = Operation.modify(reader.readLine());</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    }</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// case 2: varDec, we just ignore it</span></span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (isVarDec(line)) {</span><br><span class="line">                        <span class="keyword">while</span> (isVarDec(line)) {</span><br><span class="line">                            line = Operation.modify(reader.readLine());</span><br><span class="line">                        }</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    }</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// case 3: subroutineBody</span></span><br><span class="line">                    <span class="keyword">else</span> {</span><br><span class="line">                        ArrayList&lt;String&gt; subroutineCode = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">                        <span class="keyword">while</span> (line != <span class="literal">null</span> &amp;&amp; !isSubroutineDec(line)) {</span><br><span class="line">                            <span class="keyword">if</span> (!line.isEmpty()) {</span><br><span class="line">                                System.out.println(line);</span><br><span class="line">                                subroutineCode.add(line);</span><br><span class="line">                            }</span><br><span class="line">                            line = Operation.modify(reader.readLine());</span><br><span class="line">                        }</span><br><span class="line"></span><br><span class="line">                        ArrayList&lt;String&gt; subroutineBody = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(compileSubroutineBody(subroutineCode));</span><br><span class="line">                        <span class="keyword">for</span> (String s : subroutineBody) {</span><br><span class="line">                            writer.write(s);</span><br><span class="line">                            writer.newLine();</span><br><span class="line">                        }</span><br><span class="line"></span><br><span class="line">                        line = Operation.modify(reader.readLine());</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">                line = Operation.modify(reader.readLine());</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            reader.close();</span><br><span class="line">            writer.close();</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/27/10-8-%E5%AF%B9%E6%95%B0%E7%BB%84%E7%9A%84%E5%A4%84%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/27/10-8-%E5%AF%B9%E6%95%B0%E7%BB%84%E7%9A%84%E5%A4%84%E7%90%86/" class="post-title-link" itemprop="url">10.8.&#x5BF9;&#x6570;&#x7EC4;&#x7684;&#x5904;&#x7406;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-27 20:15:43" itemprop="dateCreated datePublished" datetime="2024-04-27T20:15:43+08:00">2024-04-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 16:04:46" itemprop="dateModified" datetime="2024-06-03T16:04:46+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-10-Code-Generator/" itemprop="url" rel="index"><span itemprop="name">Module 10.Code Generator</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>521</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="108handling-array"><span class="math inline">\(10.8.\)</span>Handling Array</h1>
<h3 id="1array-construction">1.Array construction</h3>
<p>&#x2003;&#x2003;Assume that the high-level programmer writes
<code>var Array arr</code>.</p>
<ul>
<li>In response to this, the compiler will only <strong>allocate a
<code>local</code> variable</strong> to represent the array and
<strong>initialize this variable to 0</strong>.</li>
<li>This statement <strong>generates no code</strong>. The compiler will
<strong>get a variable called <code>loca1 0</code>, its type
<code>Array</code> and name <code>arr</code></strong>.</li>
</ul>
<p>&#x2003;&#x2003;When we construct this array by calling the subroutine of the
<code>Array</code> class: <code>let arr = Array.new(5)</code>.</p>
<ul>
<li>The compiler and OS will magically <strong>allocate sufficient space
in the heap</strong> to represent the array.</li>
<li>The base address of the new allocated block is going to be stored in
<code>local 0</code>, regardless of the address may be.</li>
<li>What we have here is <strong>a standard call to a Jack
subroutine</strong>, which we already knew how to handle.</li>
</ul>
<p><img src="/2024/04/27/10-8-%E5%AF%B9%E6%95%B0%E7%BB%84%E7%9A%84%E5%A4%84%E7%90%86/image.png"></p>
<h3 id="2array-manipulation">2.Array manipulation</h3>
<h4 id="athis-and-thatreview">&#x2003;&#x2003;<span class="math inline">\(a.\)</span><code>THIS</code> and <code>THAT</code>
review</h4>
<p><img src="/2024/04/27/10-8-%E5%AF%B9%E6%95%B0%E7%BB%84%E7%9A%84%E5%A4%84%E7%90%86/image-1.png"></p>
<p><img src="/2024/04/27/10-8-%E5%AF%B9%E6%95%B0%E7%BB%84%E7%9A%84%E5%A4%84%E7%90%86/image-2.png"></p>
<h5 id="bgenerating-code">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Generating code</h5>
<p>&#x2003;&#x2003;Suppose we want to conduct <code>arr[2] = 17</code>:</p>
<p><img src="/2024/04/27/10-8-%E5%AF%B9%E6%95%B0%E7%BB%84%E7%9A%84%E5%A4%84%E7%90%86/image-3.png"></p>
<ul>
<li><p>Since the base address of <code>arr</code> is stored in
<code>THAT</code>, we simply <code>push arr</code> then
<code>push index</code>, and <code>add</code> to get
<code>arr + 2</code>.</p></li>
<li><p>Then the <code>THAT</code> pointer will be aligned with the
address we want to manipulate.</p></li>
<li><p>Notice that:</p>
<ol type="1">
<li>We use <strong>only <code>THAT 0</code></strong>, we don&apos;t use other
entries from <code>THAT</code> segment.</li>
<li>The VM code you have <strong>operates in a completely symbolic
logical world</strong>. It doesn&apos;t know where the array is located in
RAM or which address we are manipulating. In this respect, it&apos;s a very
safe code, for it cannot reach out of the VM world, because all the
physical considerations are being implemented by the VM translator, and
VM code itself is completely oblivious of the host platform. This is
very important because we have numerous different computers, we don&apos;t
know where this code is going to run, and we <strong>don&apos;t have the
luxury of making any assumptions about the underlying hardware
platform</strong>.</li>
</ol></li>
</ul>
<p>&#x2003;&#x2003;What about <code>arr[exp1] = exp2</code>? As above, we may write
the following code:</p>
<p><img src="/2024/04/27/10-8-%E5%AF%B9%E6%95%B0%E7%BB%84%E7%9A%84%E5%A4%84%E7%90%86/image-4.png"></p>
<p>&#x2003;&#x2003;This seems make sense, but when we try to write
<code>a[i] = b[j]</code>, there comes a crush:</p>
<p><img src="/2024/04/27/10-8-%E5%AF%B9%E6%95%B0%E7%BB%84%E7%9A%84%E5%A4%84%E7%90%86/image-5.png"></p>
<p>&#x2003;&#x2003;To avoid this, we:</p>
<ol type="1">
<li>First deal with the right hand side and left hand side separately.
Once we complete this, the stack is going to <strong>contain two
addresses</strong>: the address of <code>a[i]</code> and the address of
<code>b[j]</code>:</li>
</ol>
<p><img src="/2024/04/27/10-8-%E5%AF%B9%E6%95%B0%E7%BB%84%E7%9A%84%E5%A4%84%E7%90%86/image-6.png"></p>
<ol start="2" type="1">
<li>We <strong><code>pop</code> the topmost value</strong> onto
<code>pointer 1</code>, which is <code>b[i]</code> in this example. Once
is done, we are going to get the following state:</li>
</ol>
<p><img src="/2024/04/27/10-8-%E5%AF%B9%E6%95%B0%E7%BB%84%E7%9A%84%E5%A4%84%E7%90%86/image-7.png"></p>
<ol start="3" type="1">
<li>Now that <code>That 0</code> is aligned with <code>b[j]</code>, we
<strong><code>push</code> the value in <code>b[j]</code> and
<code>pop</code> it into <code>temp 0</code></strong>. This is the
picture of the VM segments after the process:</li>
</ol>
<p><img src="/2024/04/27/10-8-%E5%AF%B9%E6%95%B0%E7%BB%84%E7%9A%84%E5%A4%84%E7%90%86/image-8.png"></p>
<ol start="4" type="1">
<li>Because we have <strong>safely saved the value of
<code>b[i]</code></strong>, we can <strong>take the address of
<code>a[i]</code> and <code>pop</code> it onto
<code>pointer 1</code></strong></li>
<li>We finally <strong><code>push temp 0</code> onto the stack</strong>
and <strong><code>pop</code> it onto <code>that 0</code></strong>, which
is on the address of <code>a[i]</code>:</li>
</ol>
<p><img src="/2024/04/27/10-8-%E5%AF%B9%E6%95%B0%E7%BB%84%E7%9A%84%E5%A4%84%E7%90%86/image-9.png"></p>
<p>&#x2003;&#x2003;The general solution for generating array access code is as
below:</p>
<p>![[Pasted image 20240507234141.png]]</p>
<p><img src="/2024/04/27/10-8-%E5%AF%B9%E6%95%B0%E7%BB%84%E7%9A%84%E5%A4%84%E7%90%86/image-10.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/26/10-7-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E6%93%8D%E7%BA%B5%E5%AF%B9%E8%B1%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/26/10-7-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E6%93%8D%E7%BA%B5%E5%AF%B9%E8%B1%A1/" class="post-title-link" itemprop="url">10.7.&#x5BF9;&#x5BF9;&#x8C61;&#x7684;&#x5904;&#x7406;&#x2014;&#x2014;&#x64CD;&#x7EB5;&#x5BF9;&#x8C61;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-26 20:15:43" itemprop="dateCreated datePublished" datetime="2024-04-26T20:15:43+08:00">2024-04-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 15:58:26" itemprop="dateModified" datetime="2024-06-03T15:58:26+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-10-Code-Generator/" itemprop="url" rel="index"><span itemprop="name">Module 10.Code Generator</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>489</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="107handling-objects-manipulation"><span class="math inline">\(10.7.\)</span>Handling Objects: Manipulation</h1>
<h3 id="1compiling-method-calls">1.Compiling method calls</h3>
<ul>
<li>In compiler, we are going to translate the OO method calls into
<strong>procedural style language</strong> like VM language or machine
language, they don&apos;t understand what an object is.</li>
</ul>
<p>&#x2003;&#x2003;In order to do this:</p>
<ul>
<li>We can <strong>treat the object as the first, implicit
argument</strong>. We push it onto the stack, because we want it to
<strong>be the first argument on which the method is going to
operate</strong>.</li>
</ul>
<p><img src="/2024/04/26/10-7-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E6%93%8D%E7%BA%B5%E5%AF%B9%E8%B1%A1/image-5.png"></p>
<ol type="1">
<li>We <code>push</code> the object into the stack.</li>
<li>We <code>push</code> enough arguments into the stack.</li>
<li>We <code>call</code> the method.</li>
</ol>
<p>&#x2003;&#x2003;When we say &quot;put the object onto the stack&quot;, we don&apos;t care what the
object is, we are only interested in its <em>base address</em>.</p>
<h3 id="2compiling-methods">2.Compiling methods</h3>
<p>&#x2003;&#x2003;Methods are used to operate on the object which refers to as
<code>THIS</code>. Therefore, each method&apos;s code needs to <strong>access
to the object&apos;s <code>field</code> variables</strong>.</p>
<p>&#x2003;&#x2003;In the previous unit, we know that we can access the <span class="math inline">\(ith\)</span> <code>field</code> by
<code>THIS i</code>. However, before we use <code>THIS</code>, we have
to anchor it on the proper address on the RAM first, so we also need
<code>pointer</code>.</p>
<p><img src="/2024/04/26/10-7-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E6%93%8D%E7%BA%B5%E5%AF%B9%E8%B1%A1/image-6.png"></p>
<p>&#x2003;&#x2003;Let&apos;s take the <code>distance</code> method as an example:</p>
<ol type="1">
<li>The method is compiled within a class, so we will <strong>compile
the class variables</strong>, namely <code>x, y, pointCount</code>. This
will end up generating no code.</li>
<li>Both the method declaration and variable declaration generate no
code, either. Instead, the compiler <strong>creates the symbol table of
the subroutine</strong> and <strong>populates it within the
<code>this</code> object as well as the explicit variables that is found
in the parameter list and the variable declaration.</strong></li>
<li>We can anticipate that the method will want to operate on the
current object, so we need to generate code that will <strong>anchor
this on the correct address in memory</strong>. And we know that the
current object address is <code>argument 0</code>, so we do
<code>push argument 0</code> and <code>pop pointer 0</code> to let
<code>THIS</code> pointer to contain the address of the current
object.</li>
</ol>
<p>&#x2003;&#x2003;When the <code>distance</code> method completes execution and
terminates, control will return to the caller. The compiled code of the
caller is as below:</p>
<p><img src="/2024/04/26/10-7-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E6%93%8D%E7%BA%B5%E5%AF%B9%E8%B1%A1/image-7.png"></p>
<ul>
<li>We know that the method returns a value on the top of stack, so we
remove it and put it into <code>d</code>.</li>
</ul>
<h3 id="3void-methodcompilation">3.<code>void</code> method
compilation</h3>
<p><img src="/2024/04/26/10-7-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E6%93%8D%E7%BA%B5%E5%AF%B9%E8%B1%A1/image-8.png"></p>
<p>&#x2003;&#x2003;The <code>void</code> doesn&apos;t expect to get a return value, while
according to the rules of the game, we must return a value. As a result,
we:</p>
<ol type="1">
<li>To obey the rule, we <strong>generate code at the end of each method
that returns a value</strong>.</li>
<li>Since we have nothing to return, we <code>push constant 0</code>,
which is a dummy value and then <code>return</code>.</li>
</ol>
<p>&#x2003;&#x2003;But now the compiled code faces a slight problem: the stack
contains uncessary value and we want to get rid of it.</p>
<ol start="3" type="1">
<li>To do this, we simply <code>pop temp 0</code>.</li>
</ol>
<p><img src="/2024/04/26/10-7-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E6%93%8D%E7%BA%B5%E5%AF%B9%E8%B1%A1/image-9.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/25/10-6-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E6%9E%84%E9%80%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/25/10-6-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E6%9E%84%E9%80%A0/" class="post-title-link" itemprop="url">10.6.&#x5BF9;&#x5BF9;&#x8C61;&#x7684;&#x5904;&#x7406;&#x2014;&#x2014;&#x6784;&#x9020;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-25 20:15:43" itemprop="dateCreated datePublished" datetime="2024-04-25T20:15:43+08:00">2024-04-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 15:56:21" itemprop="dateModified" datetime="2024-06-03T15:56:21+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-10-Code-Generator/" itemprop="url" rel="index"><span itemprop="name">Module 10.Code Generator</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>664</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="106handling-objects-construction"><span class="math inline">\(10.6.\)</span>Handling Objects: Construction</h1>
<p><img src="/2024/04/25/10-6-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E6%9E%84%E9%80%A0/image.png"></p>
<ul>
<li>What we have here is two completely separate compilation units. We
are facing the challenge of compiling the caller class and the callee
class.</li>
</ul>
<h3 id="1high-level-of-objectconstruction">1.High level of object
construction</h3>
<ul>
<li>When we do <code>var Point p1</code>, the compiler will end up
generating code on <strong>some location in the stack which is going to
be initialized to 0</strong>.</li>
<li>When we call the constructor, the compiled code will end up
<strong>creating the object proper on the heap</strong>.</li>
<li>The two class running together will end up <strong>taking the base
address of the newly created object</strong> and <strong>storing it in
what we assign previously the p1 variable</strong>.</li>
</ul>
<h3 id="2the-callerss-side">2.The callers&apos;s side</h3>
<p><img src="/2024/04/25/10-6-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E6%9E%84%E9%80%A0/image-1.png"></p>
<ul>
<li><p>Whenever the compiler encounters a variable declaration, it
<strong>generates no code whatsover</strong>. The only thing the
compiler does is it <strong>update the relevant symbol table</strong>.
Because we are now compiling code that resides in a certain subroutine,
we will end up <strong>updating the symbol table of the
subroutine</strong>.</p></li>
<li><p><code>Point.new(2, 3)</code> is a call to some subroutine, so we
handle it just like other subroutine. We push the two arguments and
<code>call Point.new</code></p></li>
<li><p>The calling code assumes that when the constructor will execute,
it will end up <strong>allocating some space on the RAM</strong> for the
newly constructed object. It will also take the base address of this
space on the RAM and <strong>return it to the caller</strong>.</p></li>
<li><p>So we <strong><code>pop</code> the topmost value of the stack
into <code>p1</code></strong>, because we want <code>p1</code> to point
at the base address of this object.</p></li>
</ul>
<h3 id="3resulting-impact">3.Resulting impact</h3>
<p><img src="/2024/04/25/10-6-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E6%9E%84%E9%80%A0/image-2.png"></p>
<ul>
<li>Only when we call the constructors will we actually create the
objects on RAM.</li>
<li>Object construction is a <strong>two-stage affair that happens both
during compile time and run time</strong>.</li>
</ul>
<h3 id="4the-big-picture-ofconstructors">4.The big picture of
constructors</h3>
<p><img src="/2024/04/25/10-6-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E6%9E%84%E9%80%A0/image-3.png"></p>
<p>&#x2003;&#x2003;A constructor is typically designed to do at least two things:</p>
<ol type="1">
<li><strong>Arrange some place</strong> on RAM for the new object.</li>
<li><strong>Assign certain values</strong> to the fields of the newly
constructed object.</li>
</ol>
<p>&#x2003;&#x2003;To do this, the constructor must have access to the object&apos;s
fields:</p>
<ul>
<li>We can <strong>manipulate <code>THIS</code> segment</strong> to
manipulate the object that the constructor juct created.</li>
<li>To access <code>THIS</code> segment, we first <strong>anchor it
properly on the right address in the RAM</strong> using
<code>pointer</code> segment.</li>
</ul>
<h3 id="5compiling-constuctor">5.Compiling constuctor</h3>
<ol type="1">
<li>The first thing we meet is the constructor signature. The compiler
will generate no code whatsover. The only thing it will do is <strong>it
will create the subroutine symbol table</strong> and <strong>record in
it two variables <code>ax</code> and <code>ay</code> which are both
arguments </strong></li>
</ol>
<p>&#x2003;&#x2003;Then comes the question: how much space is needed?</p>
<ol start="2" type="1">
<li>The compiler can <strong>consult the class level symbol
table</strong> and realize that objects of the point class requires two
words only, <code>x</code> and <code>y</code>.</li>
</ol>
<p>&#x2003;&#x2003;Then how do we find such a free memory block on RAM?</p>
<ol start="3" type="1">
<li><p>The <em>operating system</em> supplies a function called
<code>alloc</code>, if you provide <code>alloc(x)</code> with a certain
argument, it will <strong>find a memory block on the RAM</strong> and
<strong>return the base address of it.</strong> The memory block has two
important properties:</p>
<ol type="1">
<li>It&apos;s <code>x</code> words long.</li>
<li>It&apos;s free, no one needs it now, so the constructor can safely use
it.</li>
</ol></li>
</ol>
<p><img src="/2024/04/25/10-6-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E6%9E%84%E9%80%A0/image-4.png"></p>
<ol type="1">
<li>We <code>push 2</code>, because we <strong>need 2 words to store the
arguments</strong>.</li>
<li>We want to push <code>THIS</code> into the stack, we need 1 word, so
we <code>call Memory.alloc 1</code>.</li>
<li>As usual, we anchor <code>THIS</code> at the base address:
<code>pop pointer 0</code>.</li>
</ol>
<blockquote>
<p>If we do <code>pop pointer 0</code>, we are going to align the
virtual segment ot the object we currently constructed on the RAM. We do
this because I know that with very high likelihood the next commands in
the constructor will want to access the fields of the newly created
object.</p>
</blockquote>
<ol start="4" type="1">
<li>Since <code>THIS</code> is anchored on the right endness, to
<code>return</code>, we simply do <code>push pointer 0</code>. And when
the caller of constructor do <code>pop pointer 0</code>, it can
successfully get the address of the newly created object.</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/22/10-5-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E5%BA%95%E5%B1%82%E7%89%B9%E6%80%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/22/10-5-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E5%BA%95%E5%B1%82%E7%89%B9%E6%80%A7/" class="post-title-link" itemprop="url">10.5.&#x5BF9;&#x5BF9;&#x8C61;&#x7684;&#x5904;&#x7406;&#x2014;&#x2014;&#x5E95;&#x5C42;&#x7279;&#x6027;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-22 20:15:43" itemprop="dateCreated datePublished" datetime="2024-04-22T20:15:43+08:00">2024-04-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 15:52:40" itemprop="dateModified" datetime="2024-06-03T15:52:40+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-10-Code-Generator/" itemprop="url" rel="index"><span itemprop="name">Module 10.Code Generator</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>401</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="105handling-objects-low-levelaspects"><span class="math inline">\(10.5.\)</span>Handling Objects: Low-level
Aspects</h1>
<p><img src="/2024/04/22/10-5-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E5%BA%95%E5%B1%82%E7%89%B9%E6%80%A7/image.png"></p>
<h3 id="1handling-objects">1.Handling objects</h3>
<p>&#x2003;&#x2003;Let&apos;s review how we handle <code>local</code> and
<code>argument</code> first:</p>
<p><img src="/2024/04/22/10-5-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E5%BA%95%E5%B1%82%E7%89%B9%E6%80%A7/image-1.png"></p>
<ul>
<li><p>The first five words in the RAM are used as <strong>pointer that
hold the current value of the stack pointer, namely the base address of
the <code>local</code>, <code>argument</code>, <code>this</code>,
<code>that</code></strong>.</p></li>
<li><p>The VM implementation also allocates a certain area on RAM to
hold the global stack which <strong>keeps the working stack of the
currentlt running VM functions</strong> and all the working stack and
memory segments of the functions that wait to for the current function
to terminate, namely the functions which <strong>are on the calling
chain</strong>.</p></li>
<li><p>The VM implementation recalls the location of these segments of
the stack by <strong>using the two pointers <code>LCL</code> and
<code>ARG</code></strong>. It records the base address of this segment
in the <code>LCL</code>.</p></li>
</ul>
<p>&#x2003;&#x2003;Then how can we use the same architecture to represent object and
array data?</p>
<ol type="1">
<li>We use a different area altogether on the RAM called
<em><code>heap</code></em>.</li>
<li>On the <code>heap</code>, we recall the data of all the objects and
the arrays that the current program seeks to manipulate.</li>
</ol>
<p><img src="/2024/04/22/10-5-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E5%BA%95%E5%B1%82%E7%89%B9%E6%80%A7/image-2.png"></p>
<p>&#x2003;&#x2003;As opposed to the <code>local</code> and <code>argument</code>
segments which have only one of each to worry about, here you may have
many objects on the heap. So before we access an object using
<code>this</code> segment, we have to tell the system <strong>to which
object are we actually referring</strong>?</p>
<ul>
<li>The implementation of <code>this</code> location is first
<strong>use the pointer <code>this</code> and
<code>that</code></strong>.</li>
<li>Before we use the two segments, we <strong>first have to use the
<code>pointer</code> segment</strong> to <strong>tell the system where
we want to align <code>this</code> and <code>that</code> on the
RAM</strong>.</li>
</ul>
<blockquote>
<p>We had to provide a mechanism to anchor this and that on the
particular object and array the code has to operate on and we are using
this virtual segment pointer for this purpose.</p>
</blockquote>
<p>&#x2003;&#x2003;Now, suppose we want to access RAM words 8000, 8001, 8002... We can
achieve this by the following VM code:</p>
<p><img src="/2024/04/22/10-5-%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%84%E7%90%86-%E5%BA%95%E5%B1%82%E7%89%B9%E6%80%A7/image-3.png"></p>
<ul>
<li>Once we set <code>THIS</code> pointer to a particular address,
<strong><code>THIS</code>can be used as if it&apos;s anchored exactly on the
8000th address in RAM</strong>. Given this desired mapping, we can use
command related to <code>THIS</code>.</li>
<li><code>push this 0</code> will <strong>take the value which is
currently located in <code>RAM 8000</code> onto the stack</strong>.</li>
<li><code>pop this 0</code> will <strong>take something off the stack
and put it into <code>RAM 8000</code></strong>.</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/20/10-4-%E5%AF%B9%E6%8E%A7%E5%88%B6%E6%B5%81%E7%9A%84%E5%A4%84%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/20/10-4-%E5%AF%B9%E6%8E%A7%E5%88%B6%E6%B5%81%E7%9A%84%E5%A4%84%E7%90%86/" class="post-title-link" itemprop="url">10.4.&#x5BF9;&#x63A7;&#x5236;&#x6D41;&#x7684;&#x5904;&#x7406;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-20 19:15:43" itemprop="dateCreated datePublished" datetime="2024-04-20T19:15:43+08:00">2024-04-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 15:44:11" itemprop="dateModified" datetime="2024-06-03T15:44:11+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-10-Code-Generator/" itemprop="url" rel="index"><span itemprop="name">Module 10.Code Generator</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>77</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="114handling-flow-of-control"><span class="math inline">\(11.4.\)</span>Handling Flow of Control</h1>
<p><img src="/2024/04/20/10-4-%E5%AF%B9%E6%8E%A7%E5%88%B6%E6%B5%81%E7%9A%84%E5%A4%84%E7%90%86/image.png"></p>
<ul>
<li>The <code>not</code> operation will <strong>turn the expression into
a boolean value</strong>, thus make out code simpler and tighter.</li>
<li>The compiler generates these labels automatically.</li>
</ul>
<p><img src="/2024/04/20/10-4-%E5%AF%B9%E6%8E%A7%E5%88%B6%E6%B5%81%E7%9A%84%E5%A4%84%E7%90%86/image-1.png"></p>
<p>&#x2003;&#x2003;In a program, we may have multiple <code>if</code> and
<code>while</code>statements, to deal we this, we only have to assure
that <strong>the compiler generates unique labels</strong>.</p>
<p>&#x2003;&#x2003;Also the <code>if</code> and <code>while</code> statements may be
nested. That is , <strong>the compiler employs a highly recursive
compilation</strong>.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/20/10-2-%E5%AF%B9%E5%8F%98%E9%87%8F%E7%9A%84%E5%A4%84%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/20/10-2-%E5%AF%B9%E5%8F%98%E9%87%8F%E7%9A%84%E5%A4%84%E7%90%86/" class="post-title-link" itemprop="url">10.2.&#x5BF9;&#x53D8;&#x91CF;&#x7684;&#x5904;&#x7406;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-20 09:15:43" itemprop="dateCreated datePublished" datetime="2024-04-20T09:15:43+08:00">2024-04-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 15:36:13" itemprop="dateModified" datetime="2024-06-03T15:36:13+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-10-Code-Generator/" itemprop="url" rel="index"><span itemprop="name">Module 10.Code Generator</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>756</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>3 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="112handling-variables"><span class="math inline">\(11.2\)</span>Handling Variables</h1>
<h3 id="1program-compilation">1.Program compilation</h3>
<p>&#x2003;&#x2003;Remember that the VM language doesn&apos;t have symbolic variables, it
only has <code>local</code>, <code>this</code> and so on. In order to
resolve this pseudocode into final executable VM code, we have to
<strong>map these symbolic variables on what is called <em>virtual
memory segments</em></strong>. And to do this, we:</p>
<ul>
<li>need the <strong>variable properties</strong>.</li>
<li>also have to know <strong>the index of the variable of its
kind</strong>(first, second, etc.).</li>
</ul>
<p>&#x2003;&#x2003;And the properties of variables include:</p>
<ul>
<li><p><em>name</em>: It&apos;s an identifier.</p></li>
<li><p><em>type</em>: <code>int</code>, <code>char</code>,
<code>boolean</code> and <strong>all class name</strong>.</p></li>
<li><p><em>kind</em>: There are two kinds of variables, and we view them
separately:</p>
<ul>
<li><em>class level</em>: <code>field</code>, <code>static</code>
variables.</li>
<li><em>subroutine level</em>: <code>argument</code> and
<code>local</code> variables.</li>
</ul></li>
<li><p><em>scope</em>, which is the region of the code in which it is
recognized.</p></li>
</ul>
<h3 id="2symbol-table">2.Symbol table</h3>
<p>&#x2003;&#x2003;We handle the property of variables using a <em>symbol
table</em>:</p>
<p><img src="/2024/04/20/10-2-%E5%AF%B9%E5%8F%98%E9%87%8F%E7%9A%84%E5%A4%84%E7%90%86/image.png"></p>
<ul>
<li>A method is always designed to operate on the current object which
is called <code>this</code>. Therefore, the symbol table of method
<strong>always begins with <code>this</code> entry</strong>, which
represents the properties of current object.</li>
<li><code>this</code> is always treated as <code>argument 0</code></li>
<li>The type of current object is <strong>the name of the class to which
this subroutine belongs</strong>.</li>
</ul>
<p>&#x2003;&#x2003;The class level symbol table can be reset each time we begin to
compile a new class, for <strong>classes are standalone compilation
unity</strong>. Something similar happens when we compile
subroutines.</p>
<p>&#x2003;&#x2003;The code writer is going to encounter all sorts of variable
declaration commands, of which in Jack we have three:
<code>local</code>, <code>field</code> and <code>static</code>.</p>
<p>&#x2003;&#x2003;Then it&apos;s going to elucidate all important properties of the
declared variables, and <strong>add the information to the respective
symbol table</strong>. It generates no code whatsoever beyond updating
the symbol tables.</p>
<ul>
<li>If we are defining a <code>field</code> or a <code>static</code>
variable, the code writer will add a new row to the end of the class
level symbol table.</li>
<li>If we are defining <code>local</code> or <code>argument</code>, the
code writer will update the symbol table of the subroutine which is
currently being compiled.</li>
<li>Arguments are being defined as <strong>part of the parameter list of
the method&apos;s signature</strong>. When the code writer goes through the
parameter list, it adds the respective lines to the subroutine&apos;s symbol
table.</li>
</ul>
<p><img src="/2024/04/20/10-2-%E5%AF%B9%E5%8F%98%E9%87%8F%E7%9A%84%E5%A4%84%E7%90%86/image-1.png"></p>
<p>&#x2003;&#x2003;What about using variables within the context of expressions or
statements. Take <code>let dx = x - other.getX();</code> as an
example:</p>
<ul>
<li><p>For each variable in the code, we <strong>look up this variable
in the subroutine level symbol table</strong>.</p>
<ul>
<li>If we find it there, we know which property we have to use.</li>
<li>If don&apos;t, we revert to <strong>looking it up in the class level
symbol table</strong>.</li>
<li>If don&apos;t either, we can conclude that the variable is undefined and
throw an error message.</li>
</ul></li>
</ul>
<p>&#x2003;&#x2003;How can the statements be translated into VM code? Take
<code>let y = y +dy</code> for example:</p>
<ol type="1">
<li>In the process of generating code, the code generator will look up
the respective table.</li>
<li>It finds out that <strong><code>y</code> stands for the second
<code>field</code> of the current object</strong>, so it will be
translated into <code>this 1</code></li>
<li><code>dy</code> stands for the second <code>local</code> variable,
so it will be translated into <code>local 1</code></li>
</ol>
<p><img src="/2024/04/20/10-2-%E5%AF%B9%E5%8F%98%E9%87%8F%E7%9A%84%E5%A4%84%E7%90%86/image-2.png"></p>
<p><img src="/2024/04/20/10-2-%E5%AF%B9%E5%8F%98%E9%87%8F%E7%9A%84%E5%A4%84%E7%90%86/image-3.png"></p>
<h3 id="3handling-variables-ingeneral">3.Handling variables in
general</h3>
<p>&#x2003;&#x2003;High level of programming languages vary in terms of:</p>
<ul>
<li>variable types</li>
<li>variable kinds</li>
<li>nested scoping rules</li>
</ul>
<p>&#x2003;&#x2003;And the symbol table generation and usage we discussed right now
can be easily entended to handle any number of possible variables types
and kinds.</p>
<p>&#x2003;&#x2003;Some languages, like Java, feature <em>unlimited scoping</em>. this
means that whenever you define a block of code with a pair of curly
brackets, you can define variables within this code which are recognized
only within that block. <code>x</code> in this scope doesn&apos;t mean the
same as <code>x</code> in that block.</p>
<p>&#x2003;&#x2003;To represent the information in our symbol table mechanism, we use
<strong>a linked list of symbol tables</strong>:</p>
<ul>
<li>When start compiling the class, we first create an linked list.</li>
<li>The first symbol table we add to the list is the class level symbol
table.</li>
<li>When we start compiling a method, we create the method symbol table
like before.</li>
<li>Whenever we have another scoping region, we <strong>add another
symbol table to the linked list</strong>.</li>
</ul>
<p><img src="/2024/04/20/10-2-%E5%AF%B9%E5%8F%98%E9%87%8F%E7%9A%84%E5%A4%84%E7%90%86/image-4.png"></p>
<p>&#x2003;&#x2003;When you encounter some variable <code>x</code> in the code we:</p>
<ol type="1">
<li>Look up <code>x</code> in the current scope, which is also the first
table.</li>
<li>If fail, we move to the next symbol table.</li>
<li>We simply go on downstream until we get to the class level symbol
table.</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/20/10-3-%E5%AF%B9%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E5%A4%84%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/20/10-3-%E5%AF%B9%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E5%A4%84%E7%90%86/" class="post-title-link" itemprop="url">10.3.&#x5BF9;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x5904;&#x7406;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-20 09:15:43" itemprop="dateCreated datePublished" datetime="2024-04-20T09:15:43+08:00">2024-04-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 15:39:49" itemprop="dateModified" datetime="2024-06-03T15:39:49+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-10-Code-Generator/" itemprop="url" rel="index"><span itemprop="name">Module 10.Code Generator</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>397</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="113handling-expression"><span class="math inline">\(11.3.\)</span>Handling Expression</h1>
<h3 id="1expressions-definitionreview">1.Expressions definition
review</h3>
<p><img src="/2024/04/20/10-3-%E5%AF%B9%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E5%A4%84%E7%90%86/image-5.png"></p>
<h3 id="2parse-tree">2.Parse tree</h3>
<p><img src="/2024/04/20/10-3-%E5%AF%B9%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E5%A4%84%E7%90%86/image-6.png"></p>
<ul>
<li><em>infix</em>: that&apos;s sort of ingrained into our brains in
elementary school.</li>
<li><em>prefix</em>: that&apos;s what we do when we define functions: we put
the function name and then a list of operands or parameters or
arguments.</li>
<li><em>postfix</em>: that&apos;s closely related to the stack machine. Say
we want to do an <code>add</code> operation, we <code>push x</code>,
<code>push y</code> and finally <code>pop</code>, this is exactly
postfix.</li>
</ul>
<h3 id="3generating-code-forexpressions">3.Generating code for
expressions</h3>
<p>&#x2003;&#x2003;In high level language like Java, we declare expressions in infix,
and the target language, so our compiler has to translate from infix to
postfix. Here are two ways to do this:</p>
<p><img src="/2024/04/20/10-3-%E5%AF%B9%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E5%A4%84%E7%90%86/image-7.png"></p>
<ol type="1">
<li>We generate a parse tree through the infix expression.</li>
<li>The parser takes the source code and produces XML code from it.</li>
<li>We go through every node in the parse tree in a certain order.</li>
</ol>
<p>&#x2003;&#x2003;To convert the parse tree into the VM code, we use the
<em>deep-first tree traversal algorithm</em>:</p>
<ul>
<li>We go all the way down, and when we hit a terminal leaf, we process
it.</li>
</ul>
<p>&#x2003;&#x2003;However, the parse tree we have may be gigantic, so it may be
better not to have the side effect. We will use the following code
generation algorithm instead:</p>
<p><img src="/2024/04/20/10-3-%E5%AF%B9%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E5%A4%84%E7%90%86/image-8.png"></p>
<ul>
<li>Whatever is the mapping of <code>x</code> is dictated by the symbol
table which is always in the background of the co-generation
algorithms.</li>
</ul>
<p>&#x2003;&#x2003;The nice thing about this algorithm is that not only does it
<strong>capture the semantics of the input expression</strong>, it also
<strong>computes the value of this expression</strong>. That is, in the
runtime the value of the expression is going to be placed on the
stack.</p>
<h3 id="4from-parsing-to-codegeneration">4.From parsing to code
generation</h3>
<p>&#x2003;&#x2003;In the previous project, we develop a Jack Analyzer that generate
static XML code, but in this part, the XML is completely irrelevant now.
Instead, we generate actual executable VM code. And there are some
general guidelines on what has to be done:</p>
<ul>
<li>We have <strong>operator priority</strong> in some operation, such
as mathematics operations (however, Jack doesn&apos;t have this). Since the
compiler will ignore it, we ourselves must take this into
consideration.</li>
<li>Once we have parenthesis in Jack, we have to take operator priority
into consideration. We have to make the code write algorithm work in the
proper order as dictated by the parenthesis.</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/19/9-9-%E5%88%86%E6%9E%90%E5%99%A8%E5%AE%9E%E7%8E%B0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/19/9-9-%E5%88%86%E6%9E%90%E5%99%A8%E5%AE%9E%E7%8E%B0%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">9.9.&#x5206;&#x6790;&#x5668;&#x5B9E;&#x73B0;&#x7B14;&#x8BB0;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-19 09:12:43" itemprop="dateCreated datePublished" datetime="2024-04-19T09:12:43+08:00">2024-04-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 15:31:22" itemprop="dateModified" datetime="2024-06-03T15:31:22+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-9-Syntax-Analyze/" itemprop="url" rel="index"><span itemprop="name">Module 9.Syntax Analyze</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>607</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="99&#x5206;&#x6790;&#x5668;&#x5B9E;&#x73B0;&#x7B14;&#x8BB0;"><span class="math inline">\(9.9.\)</span>&#x5206;&#x6790;&#x5668;&#x5B9E;&#x73B0;&#x7B14;&#x8BB0;</h1>
<h3 id="1&#x5206;&#x8BCD;&#x5668;">1.&#x5206;&#x8BCD;&#x5668;</h3>
<p>&#x2003;&#x2003;&#x5B9E;&#x73B0;&#x5206;&#x8BCD;&#x5668;&#xFF0C;&#x5BB9;&#x6613;&#x60F3;&#x5230;&#x5148;&#x6309;&#x7167;token&#x8FDB;&#x884C;&#x5206;&#x7C7B;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (ch == <span class="string">&apos;&quot;&apos;</span>)</span><br><span class="line"><span class="keyword">if</span> (Character.isDigit(ch))</span><br><span class="line"><span class="keyword">if</span> (isSymbol(ch))</span><br><span class="line"><span class="keyword">for</span> (String keywordName : keyword)</span><br><span class="line"><span class="keyword">else</span></span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;&#x4F46;&#x662F;&#xFF0C;&#x6709;&#x65F6;&#x5173;&#x952E;&#x8BCD;&#x4F1A;&#x6DF7;&#x6742;&#x5728;&#x6807;&#x8BC6;&#x7B26;&#x4E2D;&#xFF0C;&#x5BFC;&#x81F4;&#x5206;&#x8BCD;&#x9519;&#x8BEF;&#x3002;&#x6B64;&#x65F6;&#x6211;&#x4EEC;&#x5728;&#x5904;&#x7406;&#x5B8C;&#x5173;&#x952E;&#x8BCD;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x5F15;&#x5165;&#x4E00;&#x4E9B;<strong>&#x8BED;&#x6CD5;&#x6A21;&#x5F0F;</strong>&#xFF0C;&#x5BF9;&#x4E00;&#x4E9B;&#x7279;&#x4F8B;<strong>&#x4F18;&#x5148;&#x5904;&#x7406;</strong>&#xFF0C;&#x4EE5;&#x907F;&#x514D;&#x610F;&#x5916;&#x60C5;&#x51B5;&#x7684;&#x51FA;&#x73B0;&#xFF1A;</p>
<ol type="1">
<li>&#x7C7B;&#x7684;&#x5B9A;&#x4E49;&#xFF1A;</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (keywordName.equals(<span class="string">&quot;class&quot;</span>)) {</span><br><span class="line">    <span class="type">String</span> <span class="variable">classname</span> <span class="operator">=</span> line.substring(<span class="number">0</span>, line.indexOf(<span class="string">&quot;{&quot;</span>));</span><br><span class="line">    currentClass = classname;</span><br><span class="line">    writer.write(identifierVal(classname));</span><br><span class="line">    writer.newLine();</span><br><span class="line">    token.add(<span class="string">&quot;identifier&quot;</span>);</span><br><span class="line">    tokenLine.add(identifierVal(classname));</span><br><span class="line">    stringCollection.add(classname);</span><br><span class="line">    line = line.substring(classname.length());</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>&#x53D8;&#x91CF;&#x7684;&#x58F0;&#x660E;&#xFF1A;</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (isVarDec(keywordName)) {</span><br><span class="line">    <span class="comment">// The first is type declaration</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">tag</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (String s : type) {</span><br><span class="line">        <span class="keyword">if</span> (line.indexOf(s) == <span class="number">0</span>) {</span><br><span class="line">            tag = <span class="literal">true</span>;</span><br><span class="line">            writer.write(keywordVal(s));</span><br><span class="line">            writer.newLine();</span><br><span class="line">            token.add(<span class="string">&quot;keyword&quot;</span>);</span><br><span class="line">            tokenLine.add(keywordVal(s));</span><br><span class="line">            stringCollection.add(s);</span><br><span class="line">            line = line.substring(s.length());</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!tag) {</span><br><span class="line">        <span class="keyword">for</span> (String s : className) {</span><br><span class="line">            <span class="keyword">if</span> (line.indexOf(s) == <span class="number">0</span>) {</span><br><span class="line">                writer.write(identifierVal(s));</span><br><span class="line">                writer.newLine();</span><br><span class="line">                token.add(<span class="string">&quot;identifier&quot;</span>);</span><br><span class="line">                tokenLine.add(identifierVal(s));</span><br><span class="line">                stringCollection.add(s);</span><br><span class="line">                line = line.substring(s.length());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Then comes the varName</span></span><br><span class="line">    String varName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (line.contains(<span class="string">&quot;,&quot;</span>) &amp;&amp; line.indexOf(<span class="string">&quot;,&quot;</span>) &lt; line.indexOf(<span class="string">&quot;;&quot;</span>)) {</span><br><span class="line">        varName = line.substring(<span class="number">0</span>, line.indexOf(<span class="string">&quot;,&quot;</span>));</span><br><span class="line">        writer.write(identifierVal(varName));</span><br><span class="line">        writer.newLine();</span><br><span class="line">        token.add(<span class="string">&quot;identifier&quot;</span>);</span><br><span class="line">        tokenLine.add(identifierVal(varName));</span><br><span class="line">        stringCollection.add(varName);</span><br><span class="line">        line = line.substring(varName.length());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// We need to consider if there exists a &apos;,&apos;</span></span><br><span class="line">        <span class="keyword">while</span> (line.charAt(<span class="number">0</span>) == <span class="string">&apos;,&apos;</span>) {</span><br><span class="line">            writer.write(identifierVal(<span class="string">&quot;,&quot;</span>));</span><br><span class="line">            writer.newLine();</span><br><span class="line">            token.add(<span class="string">&quot;identifier&quot;</span>);</span><br><span class="line">            tokenLine.add(identifierVal(<span class="string">&quot;,&quot;</span>));</span><br><span class="line">            stringCollection.add(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            line = line.substring(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (line.contains(<span class="string">&quot;,&quot;</span>) &amp;&amp; line.indexOf(<span class="string">&quot;,&quot;</span>) &lt; line.indexOf(<span class="string">&quot;;&quot;</span>)) {</span><br><span class="line">                varName = line.substring(<span class="number">0</span>, line.indexOf(<span class="string">&quot;,&quot;</span>));</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                varName = line.substring(<span class="number">0</span>, line.indexOf(<span class="string">&quot;;&quot;</span>));</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            writer.write(identifierVal(varName));</span><br><span class="line">            writer.newLine();</span><br><span class="line">            token.add(<span class="string">&quot;identifier&quot;</span>);</span><br><span class="line">            tokenLine.add(identifierVal(varName));</span><br><span class="line">            stringCollection.add(varName);</span><br><span class="line">            line = line.substring(varName.length());</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        writer.write(identifierVal(<span class="string">&quot;;&quot;</span>));</span><br><span class="line">        writer.newLine();</span><br><span class="line">        token.add(<span class="string">&quot;identifier&quot;</span>);</span><br><span class="line">        tokenLine.add(identifierVal(<span class="string">&quot;;&quot;</span>));</span><br><span class="line">        stringCollection.add(<span class="string">&quot;;&quot;</span>);</span><br><span class="line">        line = line.substring(<span class="number">1</span>);</span><br><span class="line">    } <span class="keyword">else</span> { <span class="comment">// No &apos;,&apos;, just &apos;;&apos;</span></span><br><span class="line">        varName = line.substring(<span class="number">0</span>, line.indexOf(<span class="string">&quot;;&quot;</span>));</span><br><span class="line">        writer.write(identifierVal(varName));</span><br><span class="line">        writer.newLine();</span><br><span class="line">        token.add(<span class="string">&quot;identifier&quot;</span>);</span><br><span class="line">        tokenLine.add(identifierVal(varName));</span><br><span class="line">        stringCollection.add(varName);</span><br><span class="line">        line = line.substring(varName.length());</span><br><span class="line"></span><br><span class="line">        writer.write(identifierVal(<span class="string">&quot;;&quot;</span>));</span><br><span class="line">        writer.newLine();</span><br><span class="line">        token.add(<span class="string">&quot;symbol&quot;</span>);</span><br><span class="line">        tokenLine.add(identifierVal(<span class="string">&quot;;&quot;</span>));</span><br><span class="line">        stringCollection.add(<span class="string">&quot;;&quot;</span>);</span><br><span class="line">        line = line.substring(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<ol start="3" type="1">
<li>&#x51FD;&#x6570;&#x7684;&#x58F0;&#x660E;&#xFF1A;</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (isSubroutineDec(keywordName)) {</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">tag</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (String s : type) {</span><br><span class="line">        <span class="keyword">if</span> (line.indexOf(s) == <span class="number">0</span>) {</span><br><span class="line">            tag = <span class="literal">true</span>;</span><br><span class="line">            writer.write(keywordVal(s));</span><br><span class="line">            writer.newLine();</span><br><span class="line">            token.add(<span class="string">&quot;keyword&quot;</span>);</span><br><span class="line">            tokenLine.add(keywordVal(s));</span><br><span class="line">            stringCollection.add(s);</span><br><span class="line">            line = line.substring(s.length());</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!tag) {</span><br><span class="line">        <span class="keyword">for</span> (String s : className) {</span><br><span class="line">            <span class="keyword">if</span> (line.indexOf(s) == <span class="number">0</span>) {</span><br><span class="line">                writer.write(identifierVal(s));</span><br><span class="line">                writer.newLine();</span><br><span class="line">                token.add(<span class="string">&quot;identifier&quot;</span>);</span><br><span class="line">                tokenLine.add(identifierVal(s));</span><br><span class="line">                stringCollection.add(s);</span><br><span class="line">                line = line.substring(s.length());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">varName</span> <span class="operator">=</span> line.substring(<span class="number">0</span>, line.indexOf(<span class="string">&quot;(&quot;</span>));</span><br><span class="line">    funcCollection.add(currentClass + <span class="string">&quot;.&quot;</span> + varName);</span><br><span class="line">    writer.write(identifierVal(varName));</span><br><span class="line">    writer.newLine();</span><br><span class="line">    token.add(<span class="string">&quot;identifier&quot;</span>);</span><br><span class="line">    tokenLine.add(identifierVal(varName));</span><br><span class="line">    stringCollection.add(varName);</span><br><span class="line">    line = line.substring(varName.length());</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="2&#x5206;&#x6790;&#x5668;">2.&#x5206;&#x6790;&#x5668;</h3>
<p>&#x2003;&#x2003;&#x5728;&#x5206;&#x6790;&#x5668;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x7ECF;&#x5206;&#x8BCD;&#x5668;&#x5904;&#x7406;&#x8FC7;&#x7684;&#x6587;&#x4EF6;&#x6765;&#x6784;&#x5EFA;&#x6700;&#x7EC8;&#x7684;.xml&#x6587;&#x4EF6;&#x3002;&#x7531;&#x4E8E;&#x5BF9;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x6211;&#x4EEC;&#x53EF;&#x80FD;&#x4F1A;&#x751F;&#x6210;&#x591A;&#x884C;&#x4EE3;&#x7801;&#xFF0C;&#x6211;&#x4EEC;&#x9009;&#x62E9;&#x5229;&#x7528;<code>ArrayList&lt;String&gt;</code>&#x6765;&#x5B58;&#x50A8;&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#x4EA7;&#x751F;&#x7684;&#x8BED;&#x53E5;&#x3002;&#x5F53;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x4E2D;&#x5305;&#x542B;&#x4E86;&#x5176;&#x4ED6;&#x5B50;&#x5143;&#x7D20;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;<strong>&#x5728;&#x8C03;&#x7528;&#x5904;&#x7406;&#x5B50;&#x5143;&#x7D20;&#x7684;&#x65B9;&#x6CD5;&#x3001;&#x5F97;&#x5230;&#x5B50;&#x5143;&#x7D20;&#x7684;&#x5206;&#x6790;&#x4EE3;&#x7801;&#x540E;&#xFF0C;&#x52A0;&#x5165;&#x8BE5;&#x5143;&#x7D20;&#x7684;<code>ArrayList</code>&#x5373;&#x53EF;</strong>&#x3002;&#x8FD9;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<strong>&#x9012;&#x5F52;</strong>&#x8C03;&#x7528;&#x6765;&#x5B8C;&#x6210;&#x5BF9;&#x7A0B;&#x5E8F;&#x7684;&#x5206;&#x6790;</p>
<p>&#x2003;&#x2003;&#x4EE5;<code>class</code>&#x7684;&#x5206;&#x6790;&#x4E3A;&#x4F8B;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5199;&#x51FA;&#x4EE5;&#x4E0B;&#x7684;&#x4EE3;&#x7801;&#x6846;&#x67B6;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> ArrayList&lt;String&gt; <span class="title function_">compileClass</span><span class="params">()</span> {</span><br><span class="line">    ArrayList&lt;String&gt; class_ = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    class_.add(<span class="string">&quot;&lt;class&gt;&quot;</span>);</span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">//call method recursively</span></span><br><span class="line">    class_.addAll(compileClassVar());</span><br><span class="line">    class_.addAll(compileSubroutineDec());</span><br><span class="line"></span><br><span class="line">    ......</span><br><span class="line">    class_.add(<span class="string">&quot;&lt;/class&gt;&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> class_;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/16/9-5-%E8%A7%A3%E6%9E%90%E5%99%A8%E9%80%BB%E8%BE%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/16/9-5-%E8%A7%A3%E6%9E%90%E5%99%A8%E9%80%BB%E8%BE%91/" class="post-title-link" itemprop="url">9.5.&#x89E3;&#x6790;&#x5668;&#x903B;&#x8F91;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-16 17:17:43" itemprop="dateCreated datePublished" datetime="2024-04-16T17:17:43+08:00">2024-04-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 15:27:03" itemprop="dateModified" datetime="2024-06-03T15:27:03+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-9-Syntax-Analyze/" itemprop="url" rel="index"><span itemprop="name">Module 9.Syntax Analyze</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>482</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="95parserlogic"><span class="math inline">\(9.5.\)</span>Parser
Logic</h1>
<h3 id="1parsing-logic">1.Parsing logic</h3>
<p>&#x2003;&#x2003;In order to carry out parsing, we are going to build a
<code>CompilationEngine</code> class which consist of <strong>a set of
methods, one method for every non-terminal rule</strong>.</p>
<p><img src="/2024/04/16/9-5-%E8%A7%A3%E6%9E%90%E5%99%A8%E9%80%BB%E8%BE%91/image.png"></p>
<ul>
<li>The code of each <code>compilexxx</code> method follows the
right-hand side of the rule xxx</li>
<li>Each <code>compilexxx</code> method is responsible for
<strong>advancing</strong> and <strong>handling its own part of the
input</strong>.</li>
</ul>
<p>&#x2003;&#x2003;To illustrate this, let&apos;s focus on one of these methods
<code>compileWhileStatement</code>:</p>
<p><img src="/2024/04/16/9-5-%E8%A7%A3%E6%9E%90%E5%99%A8%E9%80%BB%E8%BE%91/image-1.png"></p>
<ol type="1">
<li><p>We <strong>follow the right-hand side of the rule</strong>, and
parse the input it dictates.</p>
<ul>
<li>In <code>whileStatement</code>, it says we should expect to see the
token <code>while</code>. If we find it in the input, we record the
fact. Then the left parenthesis, and so on and so forth,</li>
<li>At some point we will get a non-terminal rule like
<code>expression</code>, then we go to next step:</li>
</ul></li>
<li><p>If the right-hand side specifies a non-terminal rule
<code>xxx</code>, we call the corresponding method
<code>compilexxx</code></p></li>
<li><p>We do this recursively untile we exhaust the input.</p></li>
</ol>
<p>&#x2003;&#x2003;And to initialize this process, we:</p>
<ol type="1">
<li>Advance the tokenizer.</li>
<li>Call <code>compileWhileStatement</code>.</li>
</ol>
<h3 id="2parser-design">2.Parser design</h3>
<p>&#x2003;&#x2003;We also take the <code>compileWhileStatement</code> as an
example:</p>
<ol type="1">
<li>If we look at the grammar, we first see that you should see a
<code>while</code> , so we <strong>call a method
<code>eat(&apos;while&apos;)</code></strong>, which means you should expect now to
eat the <code>while</code> token.</li>
<li>We do the same thing <code>eat(&apos;(&apos;)</code>.</li>
<li>We meet a non-terminal rule <code>expression</code>, so we call
<code>compileExpression();</code></li>
<li>And so on and so forth...</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class CompilationEngine { </span><br><span class="line">	</span><br><span class="line">	compileWhileStatement() { </span><br><span class="line">		eat(&apos;while&#x2019;);</span><br><span class="line">		eat(&apos;(&apos;);  </span><br><span class="line">		compileExpression(); </span><br><span class="line">		eat(&apos;)&apos;);</span><br><span class="line">		...</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;When it comes to <code>eat</code> method:</p>
<ul>
<li>It&apos;s a private method.</li>
<li>It says <strong>you should expect to see the given string</strong>,
if not, you should <strong>throw an error</strong>.</li>
<li>Otherwise, simply <strong>advance the input</strong>.</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">eat(string) {</span><br><span class="line">	if (currentToken &lt;&gt; string) </span><br><span class="line">		error...</span><br><span class="line">	else</span><br><span class="line">		advance...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="3some-observationabout-grammars-and-parsing">3.Some observation
about grammars and parsing</h3>
<ul>
<li><p><em>LL grammar</em>: It&apos;s a grammar that <strong>can be parsed by
a recursive descent algorithm parser without backtracking</strong>.</p>
<ul>
<li>When you make a decision that what you have is a <code>while</code>
statement, you don&apos;t have to kind of retract your progress and find out
a mistake.</li>
</ul></li>
<li><p><em>LL(k) parser</em>: It&apos;s an LL parser that needs to look ahead
at most k tokens before you know which rule you are dealing with.</p>
<ul>
<li>The grammar we saw so far is <em>LL1</em>, because <strong>once we
have a particular token in hand like <code>let</code>, we immediately
know which rule we have to invoke</strong>.</li>
<li>There are also things that don&apos;t belong to LL1, like English. For
example, when we meet a token word &quot;lift&quot;, we still have no idea what we
should do with it. A verb? A noun? We have to look more tokens
downstream to know which rule to use. In this process, we may need to
backtrack and reconsider some of the rules we have to use...</li>
</ul></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/16/10-4-%E8%A7%A3%E6%9E%90%E6%A0%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/16/10-4-%E8%A7%A3%E6%9E%90%E6%A0%91/" class="post-title-link" itemprop="url">9.4.&#x89E3;&#x6790;&#x6811;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-16 12:17:43" itemprop="dateCreated datePublished" datetime="2024-04-16T12:17:43+08:00">2024-04-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 15:22:19" itemprop="dateModified" datetime="2024-06-03T15:22:19+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-9-Syntax-Analyze/" itemprop="url" rel="index"><span itemprop="name">Module 9.Syntax Analyze</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>196</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="94parsetree"><span class="math inline">\(9.4.\)</span>Parse
Tree</h1>
<h3 id="1parse-tree-introduction">1.Parse tree introduction</h3>
<p>&#x2003;&#x2003;In this part we are going to be specific about the grammatical
structure. Take the sentence &quot;the dog ate my homework&quot; for example,
here&apos;s the grammatical structure of it:</p>
<p><img src="/2024/04/16/10-4-%E8%A7%A3%E6%9E%90%E6%A0%91/image.png"></p>
<p>&#x2003;&#x2003;It&apos;s recorded using a <em>parse tree</em>. The tree is a recursive
structure, and the grammatical structure of the inputs are
<strong>recursive</strong>, too.</p>
<ul>
<li>The <code>sentence</code> consists of two lower-level sub parse
tree.</li>
<li>We continue to expanding the tree until get to the boundary of the
tree, called <em>leaves</em> or <em>terminal nodes</em>. In the case of
lexical analysis, they are <strong>the tokens from which the input is
constructed</strong>.</li>
</ul>
<p>&#x2003;&#x2003;Then let&apos;s move to Jack. Take the input
<code>while (count &lt; 100) {let count = count + 1;}</code> for
example:</p>
<p><img src="/2024/04/16/10-4-%E8%A7%A3%E6%9E%90%E6%A0%91/image-1.png"></p>
<blockquote>
<p>The notion of a parse tree is an obstruct artifact that sits
somewhere above all these nice diagrams. And this diagram here is just
one way to describe this parse tree.</p>
</blockquote>
<p>&#x2003;&#x2003;To motivate this, let&apos;s focus on some subset of the prase tree:</p>
<p><img src="/2024/04/16/10-4-%E8%A7%A3%E6%9E%90%E6%A0%91/image-2.png"></p>
<p>&#x2003;&#x2003;Another way of describing the same parse tree can be <em>XML
format</em>:</p>
<p><img src="/2024/04/16/10-4-%E8%A7%A3%E6%9E%90%E6%A0%91/image-3.png"></p>
<ul>
<li>In XML, we describe the structure of data using <em>markup
tags</em>.</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/16/10-3-%E8%AF%AD%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/16/10-3-%E8%AF%AD%E6%B3%95/" class="post-title-link" itemprop="url">9.3.&#x8BED;&#x6CD5;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-16 09:17:43" itemprop="dateCreated datePublished" datetime="2024-04-16T09:17:43+08:00">2024-04-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 15:18:56" itemprop="dateModified" datetime="2024-06-03T15:18:56+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-9-Syntax-Analyze/" itemprop="url" rel="index"><span itemprop="name">Module 9.Syntax Analyze</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>340</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="93grammars"><span class="math inline">\(9.3.\)</span>Grammars</h1>
<h3 id="1grammar-introduction">1.Grammar introduction</h3>
<p>&#x2003;&#x2003;In the previous unit, we gain the ability to think about the
program as a set of tokens, but the effect that we have a set of valid
tokens doesn&apos;t imply that we have a valid program. <strong>It&apos;s not only
the tokens that are important, the order of the tokens is critically
important as well</strong>.</p>
<p>&#x2003;&#x2003;And the artifact that <strong>defines in what order we can put
tokens together legibly</strong> is referred to as <em>grammar</em>.</p>
<ul>
<li>A grammar is a set of rules, describing how tokens can be combined
to create valid language constructs</li>
</ul>
<p>&#x2003;&#x2003;Take the English language as an example:</p>
<p><img src="/2024/04/16/10-3-%E8%AF%AD%E6%B3%95/image.png"></p>
<p>&#x2003;&#x2003;It&apos;s just a subset of English language, but is sufficiently rich to
support plenty of inputs. Consider the sentence &quot;The dog ate my
homework&quot;:</p>
<ul>
<li>&apos;The&apos; is a det and &apos;dog&apos; is a noun, so the sentence begins with a
noun phrase.</li>
<li>&apos;ate&apos; is a verb and &apos;my homework&apos; is once again a noun phrase, so
this subsentence is a verb phrase.</li>
<li>Taken together, we have a noun phrase followed by a verb phrase,
therefore we have a legitimate sentence.</li>
</ul>
<p>&#x2003;&#x2003;In this example, we notice that grammar is indeed made of a set of
rules. And these rules fall into two broad categories:</p>
<ol type="1">
<li><em>Terminal rule</em>: Its right-hand side consists of constants
only.</li>
<li><em>Non-terminal rule</em>: Its right-hand side consists of names of
other rules, and probably constants.</li>
</ol>
<h3 id="2jack-grammar">2.Jack grammar</h3>
<p>&#x2003;&#x2003;Let&apos;s focus on a subset of Jack language in which we have three
possible statements: <code>if</code>, <code>while</code>,
<code>let</code>:</p>
<p><img src="/2024/04/16/10-3-%E8%AF%AD%E6%B3%95/image-1.png"></p>
<ul>
<li>We use <code>*</code> to indicate 0 or more.</li>
<li>We use <code>|</code> to denote choice.</li>
<li>We use <code>?</code> to denote 0 or 1.</li>
</ul>
<p>&#x2003;&#x2003;And the process of <strong>determining if a given input conforms to
a grammar</strong> is called <em>prasing</em>.</p>
<p>&#x2003;&#x2003;Notice that in the process of doing this confirmation, we also
<strong>uncover the entire grammatical structure of the given
input</strong>, because we analyze how the input corresponds to the
various components of the rule.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/15/9-2-%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/15/9-2-%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">9.2.&#x8BCD;&#x6CD5;&#x5206;&#x6790;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-15 20:17:43" itemprop="dateCreated datePublished" datetime="2024-04-15T20:17:43+08:00">2024-04-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 15:16:17" itemprop="dateModified" datetime="2024-06-03T15:16:17+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-9-Syntax-Analyze/" itemprop="url" rel="index"><span itemprop="name">Module 9.Syntax Analyze</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>442</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="92lexical-analysis"><span class="math inline">\(9.2.\)</span>Lexical Analysis</h1>
<h3 id="1-tokenizing">1. Tokenizing</h3>
<p>&#x2003;&#x2003;In the previous unit, we observed that the syntax analyzer consist
of two modules: a <em>tokenizer</em> and a <em>parser</em>:</p>
<p><img src="/2024/04/15/9-2-%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90/image.png"></p>
<p>&#x2003;&#x2003;And the tokenizer is an application of a more general area of
theory known as <em>lexical analysis</em>. Here&apos;s an example of
tokenizing in action:</p>
<p><img src="/2024/04/15/9-2-%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90/image-1.png"></p>
<ul>
<li><p>As far as <em>lexical analysis</em> is concerned, the input is
nothing more than <strong>a stream of characters</strong>.</p></li>
<li><p><em>Tokenizing</em> refers to <strong>grouping the primitive
stream of characters into a stream of meaningful tokens</strong>. It
provides a very simple yet important preliminary processing of the
file.</p></li>
<li><p>A <em>token</em> is <strong>a string of characters that has a
meaning</strong>.</p>
<ul>
<li>Different programming languages have different definitions of token.
For example, <code>x++</code> in C makes a lot of sense, but not in
Jack, for it doesn&apos;t have an <code>++</code> operation.</li>
</ul></li>
</ul>
<p>&#x2003;&#x2003;Once we come up with these stream of tokens, we can <strong>hand it
over to the compiler and completely forget the original input
file</strong>.</p>
<h3 id="2jack-tokenizer">2.Jack tokenizer</h3>
<p>&#x2003;&#x2003;In Jack, we have 5 kinds of tokens:</p>
<p><img src="/2024/04/15/9-2-%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90/image-2.png"></p>
<p>&#x2003;&#x2003;And our tokenizer will provide these useful service:</p>
<ol type="1">
<li><p>Handle the compiler&apos;s input: It allow us to view the input as a
stream of tokens.</p></li>
<li><p>Allow advancing the input: It allow us to know:</p>
<ul>
<li><strong>If there are more tokens to process</strong>.</li>
<li><strong>What the next token is</strong>.</li>
<li><strong>The value, type of this token</strong>.</li>
</ul></li>
<li><p>Supply the value, type of the current token.</p></li>
</ol>
<p>&#x2003;&#x2003;Here&apos;s an example of a program that use these services:</p>
<p><img src="/2024/04/15/9-2-%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90/image-3.png"></p>
<p>&#x2003;&#x2003;The <code>TokenizerTest</code> is a program that construct the
tokenizer object. Here&apos;s what it does:</p>
<ul>
<li>It goes through the input, and for every token, it <strong>lists the
token to be out of file</strong>.</li>
<li>In the first line, <code>if</code> is surrounded by two
<em>tags</em>, it <strong>describe the type of the token</strong>.</li>
</ul>
<p>&#x2003;&#x2003;And to conduct these functionalities, we can write this pseudo
code: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">tknzr = new JackTokenizer(&quot;Prog.jack&quot;)</span><br><span class="line">tknzr.advance();</span><br><span class="line">while tknzr.hasMoreTokens() {</span><br><span class="line">	tokenclassification=  current token classification</span><br><span class="line">	print &quot;&lt;&quot; + tokenclassification + &quot;&gt;&quot;</span><br><span class="line">	print the current token value</span><br><span class="line">	print &quot;&lt;/&quot; + tokenclassification + &quot;&gt;&quot;</span><br><span class="line">	print newLine</span><br><span class="line">	tknzr.advance();</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<ol type="1">
<li><p>We get the first token, and it becomes the current
token.</p></li>
<li><p>We enter a loop as long as we have more tokens to
process.</p></li>
<li><p>In each line of the program, we have to <strong>output the
classification of the token</strong>, and we have to <strong>do it
twice</strong>.</p></li>
<li><p>We:</p>
<ol type="1">
<li>Print the <strong>opening tag</strong>, then</li>
<li>Print the <strong>value of of the current token</strong>,</li>
<li>Print the <strong>token itself</strong>,</li>
<li>At last print <strong>end tag with token
classification</strong>.</li>
</ol></li>
<li><p>We print a newline, and <code>advance()</code> to get the next
token from the tokenizer, until we consume all the tokens from the input
file.</p></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/13/8-3-%E5%88%97%E8%A1%A8%E5%A4%84%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/13/8-3-%E5%88%97%E8%A1%A8%E5%A4%84%E7%90%86/" class="post-title-link" itemprop="url">8.3.&#x5217;&#x8868;&#x5904;&#x7406;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-13 19:17:43" itemprop="dateCreated datePublished" datetime="2024-04-13T19:17:43+08:00">2024-04-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 15:08:02" itemprop="dateModified" datetime="2024-06-03T15:08:02+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-8-High-Level-Language/" itemprop="url" rel="index"><span itemprop="name">Module 8.High Level Language</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>532</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="83listprocessing"><span class="math inline">\(8.3.\)</span>List
Processing</h1>
<h3 id="1list-processing">1.List processing</h3>
<h4 id="acreation">&#x2003;&#x2003;$a.Creation</h4>
<p><img src="/2024/04/13/8-3-%E5%88%97%E8%A1%A8%E5%A4%84%E7%90%86/image.png"></p>
<p>&#x2003;&#x2003;The client process is described as below:</p>
<p><img src="/2024/04/13/8-3-%E5%88%97%E8%A1%A8%E5%A4%84%E7%90%86/image-1.png"></p>
<ol type="1">
<li>We create a V pointer. We will get the variable containing 0,
because all local variables are initialized to 0.</li>
<li>We invoke the list constructor, and the list constructor is going to
<strong>come back with a block of memory that represents the number 5
and null</strong>.</li>
<li>V is going to <strong>point to the base address</strong> of the
object that was returned by the constructor.</li>
<li>The previous version of V is no longer relevant, and the next
command will do exactly the same.</li>
</ol>
<h4 id="bsequential-access">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Sequential access</h4>
<p>&#x2003;&#x2003;We will use the <code>print</code> method to illustrate the
sequential process:</p>
<p><img src="/2024/04/13/8-3-%E5%88%97%E8%A1%A8%E5%A4%84%E7%90%86/image-2.png"></p>
<blockquote>
<p>In Object-based Programming, when we call a method on an object, we
are implicitily <strong>passing the object as a parameter to this
method</strong>.</p>
</blockquote>
<p>&#x2003;&#x2003;In the constructor, we do these things:</p>
<ol type="1">
<li><p>We create <code>current</code>, it&apos;s an identifier that exist
outside the world of list. We use a special variable called
<code>this</code> which stands for the current object.</p>
<ul>
<li><code>this</code> is the point from which we are going to
<strong>refer to the object that was passed with</strong>.</li>
</ul></li>
</ol>
<p><img src="/2024/04/13/8-3-%E5%88%97%E8%A1%A8%E5%A4%84%E7%90%86/image-3.png"></p>
<ol start="2" type="1">
<li>The entry point of the list is <code>this</code>, and we set
<code>current</code> to <code>this</code>, then we get two pointers
referring to the head of the list.</li>
</ol>
<p><img src="/2024/04/13/8-3-%E5%88%97%E8%A1%A8%E5%A4%84%E7%90%86/image-4.png"></p>
<ol start="3" type="1">
<li>Now we enter the loop, we print the <code>data</code> and move
<code>current</code> to <code>next</code>.</li>
</ol>
<p><img src="/2024/04/13/8-3-%E5%88%97%E8%A1%A8%E5%A4%84%E7%90%86/image-5.png"></p>
<ol start="4" type="1">
<li>At last we <code>return</code>, <code>current</code> no longer
exists and <code>this</code> is reinstated and points to the list as
before.</li>
</ol>
<p>&#x2003;&#x2003;When the client want to create a list:</p>
<ol type="1">
<li>It all starts by creating a <code>V</code> pointer. We <strong>get
the variable containing value 0</strong> because all local variables are
initialized to 0.</li>
</ol>
<p>&#x2003;&#x2003;Then we call the constructor, and the list constructor is going to
come back with a block of memory that represents the
<code>(5, null)</code>.</p>
<p><img src="/2024/04/13/8-3-%E5%88%97%E8%A1%A8%E5%A4%84%E7%90%86/image-6.png"></p>
<ol start="2" type="1">
<li>Once the <code>List.new</code> is called, the previous vesion of
<code>V</code> is no longer relevant. The rest steps are trival.</li>
</ol>
<p><img src="/2024/04/13/8-3-%E5%88%97%E8%A1%A8%E5%A4%84%E7%90%86/image-7.png"></p>
<h4 id="crecursive-access">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>Recursive access</h4>
<p>&#x2003;&#x2003;Let&apos;s take the <code>dispose</code> method as an example:</p>
<p><img src="/2024/04/13/8-3-%E5%88%97%E8%A1%A8%E5%A4%84%E7%90%86/image-8.png"></p>
<ol type="1">
<li>As usual, we first call a variable <code>V</code>. The
<code>dispose</code> method doesn&apos;t know what <code>V</code> is, so the
variable <code>this</code> was passed to <code>dispose</code>.</li>
<li>The <code>next</code> isn&apos;t null, so we go to the recursive call.
The <code>this</code> now points at the tail of the list.</li>
</ol>
<p><img src="/2024/04/13/8-3-%E5%88%97%E8%A1%A8%E5%A4%84%E7%90%86/image-9.png"></p>
<ol start="3" type="1">
<li>We finally meet 5, do the <code>deAlloc</code> and
<code>return</code>. Once we do the <code>return</code>, we get
completely out of the recursive method, and <strong>what used to be
called <code>this</code> goes back to be named
<code>V</code></strong>.</li>
</ol>
<p><img src="/2024/04/13/8-3-%E5%88%97%E8%A1%A8%E5%A4%84%E7%90%86/image-10.png"></p>
<ol start="4" type="1">
<li>Now the <code>V</code> points to nothing, for we basically disposed
everything in this list.</li>
</ol>
<p><img src="/2024/04/13/8-3-%E5%88%97%E8%A1%A8%E5%A4%84%E7%90%86/image-11.png"></p>
<p>&#x2003;&#x2003;However, recursion is very inefficient operation and if you do this
with a big list, you will probably get a <code>StackOverflow</code>
error.</p>
<h3 id="4list-representation">4.List representation</h3>
<p>&#x2003;&#x2003;The following list:</p>
<p><img src="/2024/04/13/8-3-%E5%88%97%E8%A1%A8%E5%A4%84%E7%90%86/image-12.png"></p>
<p>&#x2003;&#x2003;is represented in the host RAM like this:</p>
<p><img src="/2024/04/13/8-3-%E5%88%97%E8%A1%A8%E5%A4%84%E7%90%86/image-13.png"></p>
<p>&#x2003;&#x2003;Then who makes these work?</p>
<ul>
<li>High-level: the constructor</li>
<li>Low-level: when compiling the constructor, <strong>the compiler
plants calls to OS routines that find, and allocate, available memory
space for the new object</strong>.</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/13/8-2-%E5%9F%BA%E4%BA%8E%E5%AF%B9%E8%B1%A1%E7%9A%84%E7%BC%96%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/13/8-2-%E5%9F%BA%E4%BA%8E%E5%AF%B9%E8%B1%A1%E7%9A%84%E7%BC%96%E7%A8%8B/" class="post-title-link" itemprop="url">8.2.&#x57FA;&#x4E8E;&#x5BF9;&#x8C61;&#x7684;&#x7F16;&#x7A0B;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-13 16:15:43" itemprop="dateCreated datePublished" datetime="2024-04-13T16:15:43+08:00">2024-04-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 14:59:20" itemprop="dateModified" datetime="2024-06-03T14:59:20+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-8-High-Level-Language/" itemprop="url" rel="index"><span itemprop="name">Module 8.High Level Language</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>428</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="92object-based-programming"><span class="math inline">\(9.2.\)</span>Object-based Programming</h1>
<h3 id="1object-oriented-programming">1.Object-oriented programming</h3>
<p>&#x2003;&#x2003;When designing an abstraction, we</p>
<ol type="1">
<li><p>Consider <strong>what kind of data do we want to store
about</strong> and <strong>the objects that this class is supposed to
represent</strong>.</p>
<ul>
<li>In our case, we need to store numerator and denominator.</li>
</ul></li>
<li><p>We store these values into integer type of
<code>field</code>.</p></li>
<li><p><strong>The only way to access field values from outside the
class is through <em>accessor</em> methods</strong>, so we create
accessors to facilitate access.</p></li>
</ol>
<p><img src="/2024/04/13/8-2-%E5%9F%BA%E4%BA%8E%E5%AF%B9%E8%B1%A1%E7%9A%84%E7%BC%96%E7%A8%8B/image.png"></p>
<ol start="4" type="1">
<li><p>Then we write a <em>constructor</em> to create new objects. We
create the object and <strong>return it to the base
address</strong>.</p>
<ul>
<li><p><code>this</code> is a standard reference to the current object.
It is actually <strong>the base address of the current object in the
host RAM</strong>.</p></li>
<li><p>One of the rules of the game is that a Jack constructor must</p>
<ul>
<li>return the <em>base address</em>.</li>
<li>return <em>an object of the type of the surrounding class</em> or
<em>the class to which this constructor belongs</em>.</li>
<li>In Jack, every subroutine must <strong>always terminate with
<code>return</code> command</strong>.</li>
</ul></li>
</ul></li>
<li><p>We create several methods as we wish, this is quite simple so we
skip this part.</p></li>
<li><p>We create <code>dispose</code> method:</p>
<ul>
<li>The method is implemented using a call to the host operation system.
We call the OS routine <code>deAlloc</code>, which takes an address in
memory and disposes the memory block that begins in this address.</li>
<li>This is important to Jack, because Jack has no garbage collection
services, so it&apos;s up to the programmer to do this.</li>
</ul></li>
</ol>
<h3 id="2object-representation">2.Object representation</h3>
<p><img src="/2024/04/13/8-2-%E5%9F%BA%E4%BA%8E%E5%AF%B9%E8%B1%A1%E7%9A%84%E7%BC%96%E7%A8%8B/image-1.png"></p>
<p>&#x2003;&#x2003;In client&apos;s view:</p>
<ul>
<li>Each fraction is represented by a block that includes all the field
values of the current object.</li>
<li>We have a reference to each of these blocks, which is <strong>the
name of the variable</strong>.</li>
</ul>
<p>&#x2003;&#x2003;In the host RAM:</p>
<ul>
<li>Some area of it <strong>is designated to represent the the stack of
the currently running application</strong>.</li>
<li>The <code>stack</code> is used to <strong>store
variables</strong>.</li>
<li>We have the <code>heap</code> where we <strong>represent objects and
arrays</strong>.</li>
</ul>
<p>&#x2003;We see that we have a variable <code>a</code> which contains the
number 15087. If we <strong>treat this variable as a pointer and look up
this address in the RAM</strong>, we see that the number after the 2 is
3. This two numbers comprise the memory block that represents our first
object.</p>
<p>&#x2003;&#x2003;How does this representation is established? The secret is that:
when the compiler is going to compile your constructor, it would</p>
<ol type="1">
<li><strong>Inject some calls to the operating system</strong>.</li>
<li><strong>These calls are going to find available memory and allocate
it to the object that was just constructed</strong>.</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/13/7-12-%E7%BF%BB%E8%AF%91%E5%99%A8%E5%AE%9E%E7%8E%B0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/13/7-12-%E7%BF%BB%E8%AF%91%E5%99%A8%E5%AE%9E%E7%8E%B0%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">7.12.&#x7FFB;&#x8BD1;&#x5668;&#x5B9E;&#x73B0;&#x7B14;&#x8BB0;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-13 09:25:43" itemprop="dateCreated datePublished" datetime="2024-04-13T09:25:43+08:00">2024-04-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 14:54:01" itemprop="dateModified" datetime="2024-06-03T14:54:01+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-7-VM-Machine/" itemprop="url" rel="index"><span itemprop="name">Module 7.VM Machine</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>1.3k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>5 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="712&#x7FFB;&#x8BD1;&#x5668;&#x5B9E;&#x73B0;&#x7B14;&#x8BB0;"><span class="math inline">\(7.12.\)</span>&#x7FFB;&#x8BD1;&#x5668;&#x5B9E;&#x73B0;&#x7B14;&#x8BB0;</h1>
<h3 id="1localargumentthisthattemp&#x7684;&#x5B9E;&#x73B0;">1.
<code>local,argument,this,that,temp</code>&#x7684;&#x5B9E;&#x73B0;</h3>
<p>&#x2003;&#x2003;&#x8FD9;&#x51E0;&#x4E2A;&#x5185;&#x5B58;&#x6BB5;&#x7684;<code>push</code>&#x5B9E;&#x73B0;&#x90FD;&#x9075;&#x5FAA;<code>*sp=*addr</code>&#x7684;&#x8FC7;&#x7A0B;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C06;&#x8BE5;&#x8FC7;&#x7A0B;&#x62C6;&#x5206;&#x4E3A;&#x4E0B;&#x9762;&#x7684;&#x5B50;&#x8FC7;&#x7A0B;&#xFF1A;</p>
<ul>
<li><code>D=*addr</code>.</li>
<li><code>*sp=D</code>.</li>
<li><code>sp++</code></li>
</ul>
<p>&#x2003;&#x2003;&#x540C;&#x65F6;&#xFF0C;&#x6839;&#x636E;&#x5148;&#x524D;&#x7684;&#x8BA8;&#x8BBA;&#xFF0C;<code>push</code>&#x64CD;&#x4F5C;&#x4E2D;&#x7684;<code>addr</code>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>baseAddr+index</code>&#x6765;&#x8BA1;&#x7B97;&#x3002;<code>index</code>&#x7684;&#x503C;&#x5F88;&#x5BB9;&#x6613;&#x83B7;&#x53D6;&#xFF0C;&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x7684;&#x64CD;&#x4F5C;&#x4E3A;<code>push local x</code>,
&#x5219;&#xFF1A; <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//get index</span><br><span class="line">@x</span><br><span class="line">D=A</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x4F46;&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x5982;&#x679C;&#x8981;&#x83B7;&#x53D6;<code>baseAddr</code>&#xFF0C;&#x56E0;&#x4E3A;&#x6B64;&#x65F6;&#x7684;D&#x5BC4;&#x5B58;&#x5668;&#x5DF2;&#x7ECF;&#x5B58;&#x50A8;&#x4E86;<code>x</code>&#x7684;&#x5E8F;&#x53F7;&#xFF0C;
&#x6211;&#x4EEC;&#x4F1A;&#x60F3;&#x901A;&#x8FC7;A&#x5BC4;&#x5B58;&#x5668;&#x83B7;&#x5F97;<code>baseAddr</code>,
&#x7136;&#x540E;&#x5C06;<code>baseAddr+index</code>&#x7684;&#x5730;&#x5740;&#x5B58;&#x5165;A&#x5BC4;&#x5B58;&#x5668;&#x4E2D;&#xFF1A; <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//get base addr</span><br><span class="line">@LCL</span><br><span class="line">A=M</span><br><span class="line">A=A+D</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x987A;&#x5229;&#x5B8C;&#x6210;<code>LCL</code>&#x5185;&#x5B58;&#x6BB5;&#x7684;&#x5730;&#x5740;&#x8BFB;&#x5165;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x7528;D&#x5BC4;&#x5B58;&#x5668;&#x8BFB;&#x5165;<code>baseAddr+index</code>&#x5BF9;&#x5E94;&#x7684;&#x6570;&#x636E;&#x3002;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D=A+D</span><br></pre></td></tr></table></figure>
&#x2003;&#x2003;&#x4F46;&#x662F;&#xFF0C;&#x6B64;&#x65F6;&#x7684;<code>A</code>&#x50A8;&#x5B58;&#x7684;&#x5DF2;&#x4E0D;&#x662F;&#x539F;&#x5148;&#x7684;<code>baseAddr</code>&#x4E86;&#xFF0C;&#x901A;&#x8FC7;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x66F4;&#x65B0;<code>D</code>&#x7684;&#x503C;&#x662F;&#x4E0D;&#x884C;&#x7684;&#x3002;&#x8FD9;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8003;&#x8651;<strong>&#x540C;&#x65F6;&#x66F4;&#x65B0;<code>A</code>&#x4E0E;<code>D</code>&#x7684;&#x503C;</strong>&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x672A;&#x6539;&#x53D8;&#x7684;<code>A</code>&#x6210;&#x529F;&#x66F4;&#x65B0;<code>A</code>&#x4E0E;<code>D</code>:
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@x</span><br><span class="line">D=A</span><br><span class="line">@LCL</span><br><span class="line">A=M //pointer</span><br><span class="line">AD=A+D</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x7136;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;<code>D=*addr</code>&#xFF0C;&#x7531;&#x524D;&#x9762;&#x8BB2;&#x89E3;&#x7684;&#x6307;&#x9488;&#x7684;&#x8868;&#x793A;&#xFF0C;&#x53EA;&#x9700;&#x8865;&#x4E0A;<code>D=M</code>&#x8BED;&#x53E5;&#x5373;&#x53EF;&#x3002;</p>
<p>&#x2003;&#x2003;&#x63A5;&#x4E0B;&#x6765;&#x5C31;&#x662F;&#x8F83;&#x4E3A;&#x7B80;&#x5355;&#x7684;<code>*sp=D</code>&#x64CD;&#x4F5C;&#x4E86;&#xFF1A; <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@SP</span><br><span class="line">A=M</span><br><span class="line">M=D</span><br><span class="line">@SP</span><br><span class="line">M=M+1</span><br></pre></td></tr></table></figure></p>
<h3 id="2loop&#x5B9E;&#x73B0;">2.<code>Loop</code>&#x5B9E;&#x73B0;</h3>
<p>&#x2003;&#x2003;&#x5BF9;&#x4E8E;<code>if-goto</code>&#x8BED;&#x53E5;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x6839;&#x636E;&#x6808;&#x9876;&#x5143;&#x7D20;&#x662F;&#x5426;&#x4E3A;<code>0</code>&#x6765;&#x5224;&#x65AD;&#x662F;&#x5426;&#x9700;&#x8981;&#x8DF3;&#x8F6C;&#x5230;&#x6240;&#x9700;&#x5206;&#x652F;&#x3002;&#x56E0;&#x4E3A;&#x5728;&#x6808;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x7528;<code>0</code>&#x8868;&#x793A;<code>false</code>&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@SP</span><br><span class="line">M=M-1</span><br><span class="line">@SP</span><br><span class="line">A=M</span><br><span class="line">D=M</span><br><span class="line">@LABEL</span><br><span class="line">D;JNE</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x800C;&#x5BF9;&#x4E8E;&#x65E0;&#x6761;&#x4EF6;&#x7684;<code>goto</code>&#x8BED;&#x53E5;&#xFF0C;&#x5229;&#x7528;<code>0,JMP</code>&#x5373;&#x53EF;&#x5B9E;&#x73B0;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@LABEL</span><br><span class="line">0;JMP</span><br></pre></td></tr></table></figure></p>
<h3 id="3function&#x5B9E;&#x73B0;">3.<code>function</code>&#x5B9E;&#x73B0;</h3>
<p>&#x2003;&#x2003;&#x5728;<code>Hack</code>&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x4E3A;<code>function</code>&#x521B;&#x5EFA;&#x5BF9;&#x5E94;&#x6807;&#x7B7E;&#x5373;&#x53EF;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(LABEL)</span><br></pre></td></tr></table></figure></p>
<h3 id="4call&#x5B9E;&#x73B0;">4.<code>Call</code>&#x5B9E;&#x73B0;</h3>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x6309;&#x7167;<span class="math inline">\(8.6.\)</span>&#x8282;&#x6240;&#x8BB2;&#x9010;&#x6B65;&#x5B9E;&#x73B0;<code>call</code>&#x529F;&#x80FD;&#xFF1A;</p>
<ol type="1">
<li><p>&#x5728;&#x6808;&#x4E2D;&#x653E;&#x5165;<code>returnAddress</code>&#x7684;&#x6807;&#x7B7E;&#xFF0C;&#x8FD9;&#x6807;&#x5FD7;&#x7740;&#x6211;&#x4EEC;&#x5728;&#x8C03;&#x7528;&#x51FD;&#x6570;&#x540E;&#x5C06;&#x8FD4;&#x56DE;&#x7684;&#x5730;&#x5740;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@return_address1</span><br></pre></td></tr></table></figure> &#x2003;&#x2003;&#x8BE5;&#x5730;&#x5740;&#x4EA6;&#x662F;&#x6808;&#x6307;&#x9488;&#x7684;&#x521D;&#x59CB;&#x4F4D;&#x7F6E;&#x6240;&#x5728;&#x4E4B;&#x5904;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">D=A</span><br><span class="line">@SP</span><br><span class="line">A=M</span><br><span class="line">M=D</span><br></pre></td></tr></table></figure></p></li>
<li><p>&#x7136;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x4F9D;&#x6B21;&#x653E;&#x5165;<code>LCL</code>, <code>ARG</code>,
<code>THIS</code>,
<code>THAT</code>&#xFF0C;&#x4EE5;&#x4FDD;&#x5B58;&#x8C03;&#x7528;&#x8005;(caller)&#x7684;&#x5185;&#x5B58;&#x6BB5;&#x3002;</p></li>
</ol>
<p>&#x2003;&#x2003;&#x5BF9;&#x4E8E;&#x6BCF;&#x4E00;&#x4E2A;&#x5185;&#x5B58;&#x6BB5;&#xFF0C;&#x6211;&#x4EEC;&#x50CF;&#x666E;&#x901A;&#x7684;<code>push</code>&#x64CD;&#x4F5C;&#x4E00;&#x6837;&#xFF0C;&#x5C06;&#x5176;&#x653E;&#x5165;&#x6808;&#x6307;&#x9488;&#x6240;&#x6307;&#x4F4D;&#x7F6E;&#xFF0C;&#x7136;&#x540E;&#x79FB;&#x52A8;&#x6808;&#x6307;&#x9488;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SP = memorySegment</span><br><span class="line">SP = SP + 1</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">@LCL</span><br><span class="line">D=M</span><br><span class="line">@SP</span><br><span class="line">A=M</span><br><span class="line">M=D</span><br><span class="line">@SP</span><br><span class="line">M=M+1</span><br><span class="line"></span><br><span class="line">@SRG</span><br><span class="line">D=M</span><br><span class="line">@SP</span><br><span class="line">A=M</span><br><span class="line">M=D</span><br><span class="line">@SP</span><br><span class="line">M=M+1</span><br><span class="line"></span><br><span class="line">@THIS</span><br><span class="line">D=M</span><br><span class="line">@SP</span><br><span class="line">A=M</span><br><span class="line">M=D</span><br><span class="line">@SP</span><br><span class="line">M=M+1</span><br><span class="line"></span><br><span class="line">@THAT</span><br><span class="line">D=M</span><br><span class="line">@SP</span><br><span class="line">A=M</span><br><span class="line">M=D</span><br><span class="line">@SP</span><br><span class="line">M=M+1</span><br></pre></td></tr></table></figure>
<ol start="3" type="1">
<li>&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x8981;&#x91CD;&#x5B9A;&#x5411;<code>ARG</code>&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x628A;&#x5B83;&#x5B9A;&#x5411;&#x81F3;<code>ARG[0]</code>&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x800C;&#x8BE5;&#x4F4D;&#x7F6E;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8BA1;&#x7B97;&#x5F97;&#x51FA;&#xFF1A;</li>
</ol>
<p>&#x2003;&#x2003;&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x8C03;&#x7528;&#x7684;&#x51FD;&#x6570;&#x4E3A;<code>call func x</code>&#xFF0C;&#x5219;&#x5728;<code>ARG</code>&#x5185;&#x5B58;&#x6BB5;&#x524D;&#x6709;4(&#x524D;&#x56DB;&#x4E2A;&#x5185;&#x5B58;&#x6BB5;)+x(<code>LCL</code>&#x9700;&#x8981;&#x7684;&#x4F4D;&#x7F6E;&#x4E2A;&#x6570;)&#xFF0C;&#x5BF9;&#x5E94;&#x4EE3;&#x7801;&#x4E3A;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@5+x</span><br><span class="line">D=A</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;&#x7136;&#x540E;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5C06;&#x6808;&#x6307;&#x9488;&#x79FB;&#x5230;&#x5BF9;&#x5E94;&#x4F4D;&#x7F6E;&#xFF0C;&#x5E76;&#x5C06;<code>ARG</code>&#x7684;&#x521D;&#x59CB;&#x4F4D;&#x7F6E;&#x8BBE;&#x7F6E;&#x5728;&#x8FD9;&#x91CC;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@SP</span><br><span class="line">A=M</span><br><span class="line">AD=A-D</span><br><span class="line">@ARG</span><br><span class="line">M=D</span><br></pre></td></tr></table></figure></p>
<ol start="4" type="1">
<li><p>&#x4E3A;&#x4E86;&#x80FD;&#x591F;&#x6B63;&#x786E;&#x8BBF;&#x95EE;<code>LCL</code>&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;<code>LCL</code>
<code>push</code>&#x5230;&#x6808;&#x6307;&#x9488;&#x6240;&#x5728;&#x4F4D;&#x7F6E;&#xFF1A; <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@SP</span><br><span class="line">D=M</span><br><span class="line">@LCL</span><br><span class="line">M=D</span><br></pre></td></tr></table></figure></p></li>
<li><p>&#x7136;&#x540E;&#xFF0C;&#x6211;&#x4EEC;<code>goto</code>&#x9700;&#x8981;&#x6267;&#x884C;&#x7684;&#x51FD;&#x6570;&#x4EE5;&#x6267;&#x884C;&#x51FD;&#x6570;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@func</span><br><span class="line">0;JMP</span><br></pre></td></tr></table></figure></p></li>
<li><p>&#x6700;&#x540E;&#x6211;&#x4EEC;&#x63D2;&#x5165;<code>returnAddress</code>&#x7684;&#x6807;&#x7B7E;&#xFF0C;&#x8FD9;&#x6837;&#x5F53;&#x51FD;&#x6570;&#x88AB;&#x6267;&#x884C;&#x5B8C;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x56DE;&#x5230;&#x6700;&#x521D;&#x8C03;&#x7528;&#x5B83;&#x7684;&#x5730;&#x65B9;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(return_address1)</span><br></pre></td></tr></table></figure></p></li>
</ol>
<h3 id="5return&#x5B9E;&#x73B0;">5.<code>return</code>&#x5B9E;&#x73B0;</h3>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x6309;&#x7167;<span class="math inline">\(8.6.\)</span>&#x8282;&#x6240;&#x8BB2;&#x9010;&#x6B65;&#x5B9E;&#x73B0;<code>call</code>&#x529F;&#x80FD;&#xFF1A;</p>
<ol type="1">
<li><p>&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x4E34;&#x65F6;&#x53D8;&#x91CF;<code>frame</code>&#xFF0C;&#x5E76;&#x628A;<code>LCL</code>&#x7684;&#x503C;&#x8D4B;&#x7ED9;&#x5B83;&#x3002;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@LCL</span><br><span class="line">D=M</span><br><span class="line">@frame</span><br><span class="line">M=D</span><br></pre></td></tr></table></figure></p></li>
<li><p>&#x6211;&#x4EEC;&#x5C06;<code>return</code>&#x7684;&#x503C;&#x653E;&#x5728;&#x6808;&#x9876;&#x3002;&#x7531;&#x4E8E;&#x6709;&#x56DB;&#x4E2A;&#x5360;&#x636E;&#x4E3B;&#x5185;&#x5B58;&#x7684;&#x5185;&#x5B58;&#x6BB5;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E0A;&#x79FB;4+1=5&#x4E2A;&#xFF0C;<code>frame-5</code>&#x5373;&#x4E3A;<code>return</code>&#x7684;&#x5730;&#x5740;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@5</span><br><span class="line">A=D-A</span><br><span class="line">D=M</span><br><span class="line">@ret</span><br><span class="line">M=D</span><br></pre></td></tr></table></figure></p></li>
</ol>
<blockquote>
<p>&#x4E3A;&#x4EC0;&#x4E48;&#x6B64;&#x65F6;&#x4E0D;&#x8003;&#x8651;&#x6BCF;&#x4E2A;&#x5185;&#x5B58;&#x6BB5;&#x4E2D;&#x7684;&#x539F;&#x6709;&#x5143;&#x7D20;&#x4E86;&#x5462;&#xFF1F;&#x56E0;&#x4E3A;<strong>&#x5728;<code>return</code>&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8986;&#x76D6;&#x6240;&#x6709;&#x7684;&#x5DF2;&#x6709;&#x5143;&#x7D20;&#xFF0C;&#x8FD9;&#x8981;&#x6C42;&#x6211;&#x4EEC;&#x5C06;&#x8FD9;&#x4E9B;&#x5143;&#x7D20;&#x5F53;&#x4F5C;&#x4E0D;&#x5B58;&#x5728;</strong>&#x3002;&#x800C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x8003;&#x8651;&#x8FD9;&#x4E9B;&#x5143;&#x7D20;&#x5E76;&#x5C06;<code>ret</code>&#x4E0A;&#x79FB;&#xFF0C;<strong>&#x5728;&#x4E4B;&#x540E;&#x7684;&#x6B65;&#x9AA4;&#x4E2D;&#x5C31;&#x65E0;&#x6CD5;&#x8986;&#x76D6;&#x4E00;&#x4E9B;&#x539F;&#x6709;&#x7684;&#x65E7;&#x6570;&#x636E;&#x548C;&#x6E05;&#x7A7A;&#x8C03;&#x7528;&#x51FD;&#x6570;&#x7684;&#x6808;&#x4E86;</strong>&#x3002;</p>
</blockquote>
<ol start="3" type="1">
<li><p>&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5C06;&#x5F85;<code>return</code>&#x7684;&#x503C;&#x590D;&#x5236;&#x5230;<code>ARG[0]</code>&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x800C;&#x8BE5;&#x503C;&#x5C31;&#x5728;&#x6808;&#x9876;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8F7B;&#x6613;&#x5730;&#x901A;&#x8FC7;&#x64CD;&#x7EB5;&#x6808;&#x6307;&#x9488;&#x8BFB;&#x53D6;&#x8BE5;&#x503C;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@SP</span><br><span class="line">M=M-1</span><br><span class="line">A=M</span><br><span class="line">D=M</span><br><span class="line">@ARG</span><br><span class="line">A=M</span><br><span class="line">M=D</span><br></pre></td></tr></table></figure></p></li>
<li><p>&#x8C03;&#x7528;&#x8005;&#x9700;&#x8981;&#x80FD;&#x591F;&#x83B7;&#x53D6;&#x8BE5;&#x503C;&#xFF0C;&#x56E0;&#x6B64;&#x6808;&#x6307;&#x9488;&#x5E94;&#x4E0E;<code>ARG</code>&#x76F8;&#x90BB;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@ARG</span><br><span class="line">D=M</span><br><span class="line">@SP</span><br><span class="line">M=D+1</span><br></pre></td></tr></table></figure></p></li>
<li><p>&#x7136;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x7740;&#x624B;&#x8986;&#x76D6;&#x539F;&#x6709;&#x7684;&#x5185;&#x5B58;&#x6BB5;&#x4E86;&#x3002;&#x6211;&#x4EEC;&#x4ECE;&#x5148;&#x524D;&#x8BBE;&#x7F6E;&#x7684;<code>frame</code>&#x5730;&#x5740;&#x5F80;&#x4E0B;&#xFF0C;&#x4F9D;&#x6B21;&#x8BBE;&#x7F6E;&#x65B0;&#x7684;&#x5185;&#x5B58;&#x6BB5;&#x5730;&#x5740;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">@frame</span><br><span class="line">M=M-1</span><br><span class="line">A=M</span><br><span class="line">D=M</span><br><span class="line">@THAT </span><br><span class="line">M=D</span><br><span class="line"></span><br><span class="line">@frame</span><br><span class="line">M=M-1</span><br><span class="line">A=M</span><br><span class="line">D=M</span><br><span class="line">@THIS </span><br><span class="line">M=D</span><br><span class="line"></span><br><span class="line">@frame</span><br><span class="line">M=M-1</span><br><span class="line">A=M</span><br><span class="line">D=M</span><br><span class="line">@ARG </span><br><span class="line">M=D</span><br><span class="line"></span><br><span class="line">@frame</span><br><span class="line">M=M-1</span><br><span class="line">A=M</span><br><span class="line">D=M</span><br><span class="line">@LCL </span><br><span class="line">M=D</span><br></pre></td></tr></table></figure></p></li>
<li><p>&#x6700;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x56DE;&#x5230;&#x6700;&#x521D;&#x8BBE;&#x7F6E;&#x7684;<code>ret</code>&#x4F4D;&#x7F6E;&#x3002;&#x7531;&#x4E8E;<code>ret</code>&#x5E76;&#x975E;&#x6807;&#x7B7E;&#xFF0C;&#x8981;&#x8DF3;&#x8F6C;&#x5230;&#x5176;&#x5730;&#x5740;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x6307;&#x9488;&#x64CD;&#x4F5C;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@ret</span><br><span class="line">A=M</span><br><span class="line">0;JMP</span><br></pre></td></tr></table></figure></p></li>
</ol>
<h3 id="6initial&#x5B9E;&#x73B0;">6.<code>Initial</code>&#x5B9E;&#x73B0;</h3>
<p>&#x2003;&#x2003;&#x5F53;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7FFB;&#x8BD1;&#x7684;VM&#x4EE3;&#x7801;&#x662F;&#x6709;&#x6548;&#x7684;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x9700;&#x8981;&#x5BF9;&#x6211;&#x4EEC;&#x7684;&#x786C;&#x4EF6;&#x7CFB;&#x7EDF;&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;&#xFF1A;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@256</span><br><span class="line">D=A</span><br><span class="line">@SP</span><br><span class="line">M=D</span><br><span class="line"></span><br><span class="line">call Sys.init// same as other call statements before.</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/11/7-11-Hack%E5%B9%B3%E5%8F%B0%E4%B8%8A%E7%9A%84VM%E5%AE%9E%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/11/7-11-Hack%E5%B9%B3%E5%8F%B0%E4%B8%8A%E7%9A%84VM%E5%AE%9E%E7%8E%B0/" class="post-title-link" itemprop="url">7.11.Hack&#x5E73;&#x53F0;&#x4E0A;&#x7684;VM&#x5B9E;&#x73B0;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-11 18:15:43" itemprop="dateCreated datePublished" datetime="2024-04-11T18:15:43+08:00">2024-04-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 14:51:28" itemprop="dateModified" datetime="2024-06-03T14:51:28+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-7-VM-Machine/" itemprop="url" rel="index"><span itemprop="name">Module 7.VM Machine</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>206</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="711vm-implementation-on-the-hackplatform"><span class="math inline">\(7.11.\)</span>VM Implementation on the Hack
Platform</h1>
<h3 id="1program-compilation-andtranslation">1.Program compilation and
translation</h3>
<p><img src="/2024/04/11/7-11-Hack%E5%B9%B3%E5%8F%B0%E4%B8%8A%E7%9A%84VM%E5%AE%9E%E7%8E%B0/image.png"></p>
<ul>
<li>When we translate from Jack to VM, we lost <em>the notion of
constructors, methods</em>, because everything becomes functions.</li>
<li>When we translate from VM to assembly, we lost <em>the notion of
functions</em>, because we just have a long stream of assembly
commands.</li>
</ul>
<h3 id="2vm-convention">2.VM convention</h3>
<p>&#x2003;&#x2003;In order to tranlate the VM code into assembly code, we need to
comply to certain conventions:</p>
<ol type="1">
<li><p><em>VM programming convention</em>: One file in any VM program is
expected to be named <code>Main.vm</code>; one VM function in this file
is expected to be named <code>main</code>.</p></li>
<li><p><em>VM implementation convention</em>: When the VM implementation
starts running, or is reset, it starts executing the argument-less OS
function <code>Sys.init</code>.<code>Sys.init</code> then calls
<code>Main.main</code>, and enters an infinite loop.</p></li>
<li><p><em>Hardware platform convention</em>:</p>
<ul>
<li>We request that the code you see here <strong>will be stored in the
target computer&apos;s instruction memory beginning in address
<code>0</code></strong>, for our Hack computer is programmed to start
executing the program beginning with address <code>0</code>.</li>
<li>So we first set <code>SP = 256</code>. By doing this, it will
determined that the stack should begin in this address in the whole
stream.</li>
<li>Then we <code>call Sys.init</code>.</li>
</ul></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SP = 256</span><br><span class="line">Call Sys.init</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/11/7-10-%E5%87%BD%E6%95%B0%E8%BF%90%E8%A1%8C%E5%AE%9E%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/11/7-10-%E5%87%BD%E6%95%B0%E8%BF%90%E8%A1%8C%E5%AE%9E%E7%8E%B0/" class="post-title-link" itemprop="url">7.10.&#x51FD;&#x6570;&#x8FD0;&#x884C;&#x5B9E;&#x73B0;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-11 14:35:43" itemprop="dateCreated datePublished" datetime="2024-04-11T14:35:43+08:00">2024-04-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 14:49:14" itemprop="dateModified" datetime="2024-06-03T14:49:14+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-7-VM-Machine/" itemprop="url" rel="index"><span itemprop="name">Module 7.VM Machine</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>758</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>3 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="710function-call-and-returnimplementation"><span class="math inline">\(7.10.\)</span>Function Call and Return
Implementation</h1>
<h3 id="1the-callers-view">1.The caller&apos;s view</h3>
<p>&#x2003;&#x2003;In the calling function&apos;s view:</p>
<ul>
<li>Before calling another function, I must <strong>push as many
arguments as the function expects to get</strong>;</li>
<li>Next, I invoke the function using
<code>call functionName nArgs</code>;</li>
<li>After the called function returns, the argument values that I pushed
before the call have disappeared from the stack, and <strong>a return
value (that always exists) appears at the top of the
stack</strong>;</li>
<li>After the called function returns, <strong>all my memory segments
are exactly the same as they were before the call</strong> (except that
temp is undefined and some values of my static segment may have
changed).</li>
</ul>
<h3 id="2the-callees-view">2.The callee&apos;s view</h3>
<p>&#x2003;&#x2003;In the called function&apos;s view:</p>
<ul>
<li>Before I start executing, <strong>my<code>argument</code> segment
has been initialized with the argument values passed by the
caller</strong>.</li>
<li>My <strong><code>local</code> variables segment has been allocated
and initialized to zeros</strong>.</li>
<li>My <code>static</code> segment has been set to <strong>the
<code>static</code> segment of the VM file to which I belong</strong>
(memory segments <code>this</code>, <code>that</code>,
<code>pointer</code>, and <code>temp</code> are undefined upon
entry).</li>
<li>My working stack is empty.</li>
<li>Before returning, I must <strong>push a value onto the
stack</strong>.</li>
</ul>
<h3 id="3handling-call">3.Handling <code>call</code></h3>
<p>&#x2003;&#x2003;We can implement the VM code by these steps:</p>
<p><img src="/2024/04/11/7-10-%E5%87%BD%E6%95%B0%E8%BF%90%E8%A1%8C%E5%AE%9E%E7%8E%B0/image.png"></p>
<p>&#x2003;&#x2003;In terms of <code>call</code>, we do these steps:</p>
<ol type="1">
<li><p>Push a label onto the stack, and use the same label when we are
going to return after the called function terminates.
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">push returnAddress</span><br></pre></td></tr></table></figure></p></li>
<li><p>Push some label that we generate to <strong>save the memory
segment of the caller</strong>: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">push LCL</span><br><span class="line">push ARG</span><br><span class="line">push THIS</span><br><span class="line">push THAT</span><br></pre></td></tr></table></figure></p></li>
<li><p>The <code>argument</code> should <strong>be repositioned for the
called function</strong>, and we should reposition it at the beginning
of the <code>ARG</code> segment:</p>
<ul>
<li>We can calculate the address, because we know how many values we
pushed. Say we push 5 values the we do : <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ARG = SP - 5</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li><p>Push the <code>local</code> segment to insure that the function
can visit its local variables correctly : <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LCL = SP</span><br></pre></td></tr></table></figure></p></li>
<li><p>We execute the called function by simply writing the command
<code>goto nameOfFunction</code>: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">goto functionName</span><br></pre></td></tr></table></figure></p></li>
<li><p>We insert the <code>returnAddress</code> label, so that when the
function has been executed, we can get back to the place we invoke it :
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(returnAddress) //Declares a label for the return-address</span><br></pre></td></tr></table></figure></p></li>
</ol>
<p><img src="/2024/04/11/7-10-%E5%87%BD%E6%95%B0%E8%BF%90%E8%A1%8C%E5%AE%9E%E7%8E%B0/image-1.png"></p>
<h3 id="4handling-function">4.Handling <code>function</code></h3>
<p>&#x2003;&#x2003;The big picture of handling <code>function</code> is that:</p>
<ul>
<li>The first thing translator does is <strong>it takes the function
name and generates a label</strong>, and the label will serve as
<strong>the entry point to the translated assembly code of the
function</strong>.</li>
<li>We simply write some assembly code that <strong>handles the setting
up of the function&apos;s execution</strong>.</li>
</ul>
<ol type="1">
<li>We take the function name and generate its label:</li>
<li>Since we know how many local variables we have to create, we do
<code>push 0</code> <code>nVars</code> times. <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(functionName)</span><br><span class="line">	//repeat nVars times</span><br><span class="line">	push 0</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="4handling-return">4.Handling <code>return</code></h3>
<p>&#x2003;&#x2003;After setting up, the function can start doing its thing. We need
to generate assembly code that <strong>moves the return value to the
caller, reinstates the caller&apos;s state, and finally <code>goto</code> the
return address</strong>.</p>
<ol type="1">
<li>Create some temporary variable (called <code>endFrame</code>) and
assign the value of <code>LCL</code> to it: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">endFrame = LCL</span><br></pre></td></tr></table></figure></li>
</ol>
<p>&#x2003;&#x2003;If you look at the stack diagram, you will see that
<code>endFrame</code> indeed <strong>points at the end of the frame in
the host RAM</strong>.</p>
<p><img src="/2024/04/11/7-10-%E5%87%BD%E6%95%B0%E8%BF%90%E8%A1%8C%E5%AE%9E%E7%8E%B0/image-2.png"></p>
<ol start="2" type="1">
<li><p>Since we should put the return value at the top of the stack, say
we have 5 values, the <code>endFrame - 5</code> will be the exact return
address.</p>
<ul>
<li>We need to use <code>*</code> to look inside and get the address.
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">retaddr = *(endFrame - 5)</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li><p>Reposition the return value for the caller.</p>
<ul>
<li>The value should be copied to <code>argument 0</code>, and we
already have a pointer <code>ARG</code> located in the position</li>
<li><code>pop</code> is going to retrieve the return value off the
stack. We take this value and put it in <code>ARG</code>.
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*ARG = pop()</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li><p>The caller expects to see a return value and continue to do its
work, so the stack pointer should <strong>be just after
<code>ARG</code></strong>.<br>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SP = ARG + 1</span><br></pre></td></tr></table></figure></p></li>
<li><p>Then we can begin to recover the various segments that we saved
on the stack before. <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">THAT = *(endFrame - 1)</span><br><span class="line">THIS = *(endFrame - 2)</span><br><span class="line">ARG = *(endFrame - 3)</span><br><span class="line">LCL = *(endFrame - 4)</span><br></pre></td></tr></table></figure></p></li>
<li><p>Finally we can jump to the return address we copied before:
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">goto retAddr</span><br></pre></td></tr></table></figure></p></li>
</ol>
<p><img src="/2024/04/11/7-10-%E5%87%BD%E6%95%B0%E8%BF%90%E8%A1%8C%E5%AE%9E%E7%8E%B0/image-3.png"></p>
<ul>
<li>Every thing below <code>SP</code> is recycled. <strong>The next push
is going to override the memory location where <code>SP</code>
shows</strong>.</li>
<li>The caller will see the return value at the top of its working
stack.</li>
<li>The stack pointer will point at the next world in the memory.</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/11/7-9-%E5%87%BD%E6%95%B0%E8%BF%90%E8%A1%8C%E6%A8%A1%E6%8B%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/11/7-9-%E5%87%BD%E6%95%B0%E8%BF%90%E8%A1%8C%E6%A8%A1%E6%8B%9F/" class="post-title-link" itemprop="url">7.9.&#x51FD;&#x6570;&#x8FD0;&#x884C;&#x6A21;&#x62DF;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-11 10:32:46" itemprop="dateCreated datePublished" datetime="2024-04-11T10:32:46+08:00">2024-04-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 14:44:19" itemprop="dateModified" datetime="2024-06-03T14:44:19+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-7-VM-Machine/" itemprop="url" rel="index"><span itemprop="name">Module 7.VM Machine</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>508</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="79run-time-simulation"><span class="math inline">\(7.9.\)</span>Run-time Simulation</h1>
<h3 id="1run-time-example">1.Run-time example</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">int main() {</span><br><span class="line">	return factorial(3);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">int factorial(int n) {</span><br><span class="line">	if (n == 1) return 1;</span><br><span class="line">	else return n * factorial(n - 1);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<ul>
<li><p>When compiling the <code>main</code> part, we:</p>
<ul>
<li><code>push 3</code></li>
<li><code>call factorial</code></li>
<li><code>return</code></li>
</ul></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function main</span><br><span class="line">	push 3</span><br><span class="line">	call factorial</span><br><span class="line">	return</span><br></pre></td></tr></table></figure>
<ul>
<li><p>Then we start to compile the function:</p>
<ul>
<li>We declare the function.</li>
<li>We evaluate the condition <code>n==1</code></li>
<li>If the conitional statement returns false, we <code>push n</code>,
and compute <code>factorial(n - 1)</code></li>
</ul></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function factorial(n) </span><br><span class="line">	push n</span><br><span class="line">	push 1</span><br><span class="line">	eq </span><br><span class="line">	if-goto BASECASE</span><br><span class="line">	</span><br><span class="line">	push n</span><br><span class="line">	push n</span><br><span class="line">	pusn 1</span><br><span class="line">	sub</span><br><span class="line">	call factorial</span><br><span class="line">	call mult</span><br><span class="line">	return</span><br><span class="line"></span><br><span class="line">label BASECASE</span><br><span class="line">	push 1</span><br><span class="line">	return</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;The pseudo VM code can be translated into these VM codes:
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">function main 0</span><br><span class="line">	push constant 3</span><br><span class="line">	call factorial 1</span><br><span class="line">	return</span><br><span class="line"></span><br><span class="line">function factorial 0</span><br><span class="line">	push argument 0</span><br><span class="line">	push constant 1</span><br><span class="line">	eq</span><br><span class="line">	if-goto BASECASE</span><br><span class="line"></span><br><span class="line">	push argument 0</span><br><span class="line">	push argument 0</span><br><span class="line">	push constant 1</span><br><span class="line">	sub</span><br><span class="line">	call factorial 1</span><br><span class="line">	call mult 2</span><br><span class="line">	return </span><br><span class="line"></span><br><span class="line">label BASECASE</span><br><span class="line">	push constant 1</span><br><span class="line">	return</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;Then what happen during the runtime?</p>
<ol type="1">
<li><code>main</code> starts running, and informs that it has 0 local
variable.</li>
<li><code>main</code> pushes, so it starts with an empty stack.</li>
<li><code>push constant 3</code>, then we get a 3 on the stack.</li>
</ol>
<p><img src="/2024/04/11/7-9-%E5%87%BD%E6%95%B0%E8%BF%90%E8%A1%8C%E6%A8%A1%E6%8B%9F/image.png"></p>
<ol start="4" type="1">
<li><code>call factorial 1</code>, the 1 informs that 1 argument was
pushed onto the stack. So we can <strong>refer to the topmost value in
the stack as argument 0</strong>.</li>
</ol>
<p><img src="/2024/04/11/7-9-%E5%87%BD%E6%95%B0%E8%BF%90%E8%A1%8C%E6%A8%A1%E6%8B%9F/image-1.png"></p>
<h3 id="2callee-process">2.Callee process</h3>
<p>&#x2003;&#x2003;Then we begin to deal with the <code>call</code> command.</p>
<ol type="1">
<li>We first <strong>save the frame of <code>main</code> onto the
stack</strong>. Then we jump to execute <code>factorial</code>.</li>
</ol>
<p><img src="/2024/04/11/7-9-%E5%87%BD%E6%95%B0%E8%BF%90%E8%A1%8C%E6%A8%A1%E6%8B%9F/image-2.png"></p>
<ul>
<li>The blue dot shows the <em>return address</em> in the given code.
And this is exactly where we want to return to after
<code>factorial</code> finishes.</li>
</ul>
<ol start="2" type="1">
<li>The <code>eq</code> consumes <code>argument 0</code> and
<code>constant 1</code>, so <strong>the overall effect of the first 4
commands on the stack is <code>nil</code></strong>.</li>
<li>We <code>push argument 0</code>, <code>push argument 0</code>,
<code>push constant 1</code>, <code>sub</code>, so we are going to get 3
and 2 on the stack.</li>
</ol>
<p><img src="/2024/04/11/7-9-%E5%87%BD%E6%95%B0%E8%BF%90%E8%A1%8C%E6%A8%A1%E6%8B%9F/image-3.png"></p>
<ol start="4" type="1">
<li><code>call factorial 1</code>, we <strong>inform the implementation
that 1 argument has been pushed onto the stack</strong>, we can refer to
it as <code>argument 0</code>.</li>
<li>We want to issue a <code>call</code> command, so the implementation
is going to <strong>save the frame of the current function</strong>, and
the return address is the green dot, we save it, too.</li>
</ol>
<p><img src="/2024/04/11/7-9-%E5%87%BD%E6%95%B0%E8%BF%90%E8%A1%8C%E6%A8%A1%E6%8B%9F/image-4.png"></p>
<ol start="6" type="1">
<li>After several calls, we turn to <code>f(1)</code>, and the global
stack now looks like this:</li>
</ol>
<p><img src="/2024/04/11/7-9-%E5%87%BD%E6%95%B0%E8%BF%90%E8%A1%8C%E6%A8%A1%E6%8B%9F/image-5.png"></p>
<ol start="7" type="1">
<li>This time 1 equals 1, we jump to <code>BASECASE</code>,
<code>push constant 1</code> and do a <code>return</code>.</li>
</ol>
<p>&#x2003;&#x2003;When the inplementation encounters the <code>return</code> command,
it:</p>
<ol type="1">
<li>Gets the return address off the stack.</li>
<li>Copy the return value. In this case, it&apos;s <code>argument 0</code>,
so we copy 1 on <code>arg0</code>.</li>
<li>After <code>return</code>, we can recycle the current frame, which
is no more relevant.</li>
</ol>
<p><img src="/2024/04/11/7-9-%E5%87%BD%E6%95%B0%E8%BF%90%E8%A1%8C%E6%A8%A1%E6%8B%9F/image-6.png"></p>
<p>&#x2003;&#x2003;And we do this step again and again:</p>
<p><img src="/2024/04/11/7-9-%E5%87%BD%E6%95%B0%E8%BF%90%E8%A1%8C%E6%A8%A1%E6%8B%9F/image-7.png"></p>
<p>&#x2003;&#x2003;During the process, the caller is completely oblivious of all the
drama, it takes part behind the scene.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/11/7-8-%E5%87%BD%E6%95%B0%E5%AE%9E%E7%8E%B0%E5%89%8D%E7%9E%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/11/7-8-%E5%87%BD%E6%95%B0%E5%AE%9E%E7%8E%B0%E5%89%8D%E7%9E%BB/" class="post-title-link" itemprop="url">7.8.&#x51FD;&#x6570;&#x5B9E;&#x73B0;&#x524D;&#x77BB;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-11 08:22:16" itemprop="dateCreated datePublished" datetime="2024-04-11T08:22:16+08:00">2024-04-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 14:37:35" itemprop="dateModified" datetime="2024-06-03T14:37:35+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-7-VM-Machine/" itemprop="url" rel="index"><span itemprop="name">Module 7.VM Machine</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>741</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>3 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="78function-impletation-preview"><span class="math inline">\(7.8.\)</span>Function Impletation Preview</h1>
<h3 id="1program-execution">1.Program execution</h3>
<ul>
<li><p>When a function enters its execution, we need to create a
<em>state</em> for this function.</p>
<ul>
<li>Give it an <em>empty working stack</em>, its <em>memory
segment</em>.</li>
</ul></li>
<li><p>The working stack and some of the segments should be:</p>
<ul>
<li>Created <strong>when the function starts running</strong>.</li>
<li><strong>Maintained as long as the function is
executing</strong>.</li>
<li><strong>Recycled</strong> when the function retums.</li>
</ul></li>
<li><p>When we call a function, we will have two states: the state of
<em>caller</em> and the state of <em>callee</em>. Once the callee starts
running, <strong>the state of the caller has to be saved
somewhere</strong>. And when the callee terminates, we can
<strong>reinstate the caller state and continue its
execution</strong>.</p></li>
</ul>
<p><img src="/2024/04/11/7-8-%E5%87%BD%E6%95%B0%E5%AE%9E%E7%8E%B0%E5%89%8D%E7%9E%BB/image.png"></p>
<h3 id="2function-call-and-return">2.Function call and return</h3>
<p>&#x2003;&#x2003;However, a <em>calling chain</em> may be several functions deep,
and how can we maintain all the states of these functions?</p>
<p>&#x2003;&#x2003;To deal with this, we can use the <em>FILO</em> (first in last out)
pattern. The only function to be return is the function which is
currently running, and which is also <strong>the end of the calling
chain</strong>. Once this function returns, the calling chain shortens,
so on and so forth.</p>
<p>&#x2003;&#x2003;This pattern is similiar to <em>stack</em>, this implies that we
may use a stack in order to save and retrieve all these function
states.</p>
<p>&#x2003;&#x2003;Take this simple function as example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mult(17, 212)</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;In the view of the caller, the effect of the procedure is that
<strong>the function&apos;s arguements has been replaced with the function
value</strong>:</p>
<p><img src="/2024/04/11/7-8-%E5%87%BD%E6%95%B0%E5%AE%9E%E7%8E%B0%E5%89%8D%E7%9E%BB/image-1.png"></p>
<p>&#x2003;And the details are as follows:</p>
<ul>
<li><p>We push some values in the stack, and nothing happens. And then
we <code>call foo nArgs</code>.</p></li>
<li><p>By the information <code>nArgs</code>, we know where to
<strong>set <code>arg</code> pointer</strong>.</p>
<ul>
<li>From now on, we know what&apos;s above the <code>arg</code> is
<strong>the working stack of the caller</strong>, and what&apos;s below the
<code>arg</code> are <strong>the arguments to be use by
callee</strong>.</li>
</ul></li>
<li><p>Before we jump to the called function, we have to save the state
of the caller:</p>
<ul>
<li>The working stack is safe, it is already on the stack, so we can
leave it alone.</li>
<li>We have to save the <em>segment</em> and the <em>return
address</em>. Taken together, we call these thing <em>frame</em>.</li>
<li>The VM implementation simply <strong>push these memory segments into
stack</strong>. In this way we save the frame, and will be able to
return to them later on.</li>
</ul></li>
</ul>
<p><img src="/2024/04/11/7-8-%E5%87%BD%E6%95%B0%E5%AE%9E%E7%8E%B0%E5%89%8D%E7%9E%BB/image-2.png"></p>
<ul>
<li>Jump to <strong>execute foo</strong>.</li>
</ul>
<p>&#x2003;&#x2003;After the called function is entered, it:</p>
<ul>
<li><p>Create a <em>local segment</em>.</p></li>
<li><p>Having known that we need n variables, we need to
<strong>initialize them to 0</strong></p>
<ul>
<li>From now on, we can refer to these values as <code>local 0</code>,
<code>local 1</code> and so on.</li>
</ul></li>
</ul>
<p><img src="/2024/04/11/7-8-%E5%87%BD%E6%95%B0%E5%AE%9E%E7%8E%B0%E5%89%8D%E7%9E%BB/image-3.png"></p>
<p>&#x2003;&#x2003;Assume that the called function is running and doing its things, in
this process, it:</p>
<ul>
<li>Grow its working stack, and it now has a working stack of its
own.</li>
</ul>
<p><img src="/2024/04/11/7-8-%E5%87%BD%E6%95%B0%E5%AE%9E%E7%8E%B0%E5%89%8D%E7%9E%BB/image-4.png"></p>
<ul>
<li><p>When it is goint to <code>return</code> at some point, we push
the return value <strong>at the bottom of the stack</strong>.</p></li>
<li><p>We pop the topmost value, and <strong>copy it onto
<code>argument 0</code></strong> to replace the pushed arguments with
return value.</p></li>
<li><p>We <strong>restore the segment pointers of the callers</strong>,
take the saved <em>memory segments</em> to the <em>current
segments</em>.</p></li>
<li><p>Then we <strong>clear the stack of the called function</strong>,
and <strong>set the stack pointer for the caller</strong>.</p>
<ul>
<li>The stack pointer should be located after
<code>argument 0</code>.</li>
</ul></li>
<li><p>Finally, we <strong>jump to the return address</strong> in the
caller, and continue executing the caller&apos;s code.</p></li>
</ul>
<h3 id="3global-stack">3.Global stack</h3>
<p>&#x2003;&#x2003;Our previous discussion is only about the caller and callee, but
there are many other pairs of callers and callees in the calling chain,
and we have to maintain their states, too.</p>
<p>&#x2003;&#x2003;As a result, we get a very large stack called <em>global stack</em>
containing the information of the entire program.</p>
<ul>
<li><p>We refer to some subset of the global stack <em>block</em>. It&apos;s
the world of the currently running function, and it contains:</p>
<ul>
<li><em>argument segment</em>. These are the function&apos;s arguments.</li>
<li><em>saved information that belongs to caller</em>.</li>
<li><em>local segment</em></li>
<li><em>working stack of its own</em></li>
</ul></li>
</ul>
<p><img src="/2024/04/11/7-8-%E5%87%BD%E6%95%B0%E5%AE%9E%E7%8E%B0%E5%89%8D%E7%9E%BB/image-5.png"></p>
<ul>
<li>The global stack contains many more such blocks.</li>
</ul>
<p>&#x2003;&#x2003;And there are some more observations we can make:</p>
<ul>
<li>We only have to save <code>local</code>, <code>argument</code>,
<code>this</code> and <code>that</code> segments, for the other four
parts don&apos;t belong to the world of the function.</li>
<li>We use the stack not only when executing the program, but also
executing all the behind-scene apparatus that is required to service the
program. Everything is saved on the same stack.</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/10/7-7-%E5%87%BD%E6%95%B0%E6%8A%BD%E8%B1%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/10/7-7-%E5%87%BD%E6%95%B0%E6%8A%BD%E8%B1%A1/" class="post-title-link" itemprop="url">7.7.&#x51FD;&#x6570;&#x62BD;&#x8C61;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-10 20:12:16" itemprop="dateCreated datePublished" datetime="2024-04-10T20:12:16+08:00">2024-04-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 14:32:41" itemprop="dateModified" datetime="2024-06-03T14:32:41+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-7-VM-Machine/" itemprop="url" rel="index"><span itemprop="name">Module 7.VM Machine</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>520</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="77function-abstraction"><span class="math inline">\(7.7.\)</span>Function: Abstraction</h1>
<h3 id="1function-in-vm-language">1.Function in VM language</h3>
<ul>
<li><p>The VM language features:</p>
<ul>
<li><em>primitive operation</em>(fixed): <code>add</code>,
<code>sub</code></li>
<li><em>abstract operation</em>(extensible): <code>mutiple</code></li>
</ul></li>
</ul>
<p>&#x2003;&#x2003;When we want to call a function, we:</p>
<ul>
<li>push the required argument onto the stack.</li>
<li>call the function. Then <strong>the result of function will replace
the argument you push earlier</strong>.</li>
</ul>
<p>&#x2003;&#x2003;Take this simple funtion call <code>sqrt(x-17+x*5)</code> as
example, it can be translated into: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">push x</span><br><span class="line">push 17</span><br><span class="line">sub</span><br><span class="line">push x </span><br><span class="line">push 5</span><br><span class="line">call Math.multiply</span><br><span class="line">add </span><br><span class="line">call Math.sqrt</span><br></pre></td></tr></table></figure></p>
<h3 id="2function-definition">2.Function definition</h3>
<p>&#x2003;&#x2003;Take the previous function as example: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// returns x&quot;y</span><br><span class="line">int mult(int x, int y) {</span><br><span class="line">	int sum = 0;</span><br><span class="line">	int n = 1;</span><br><span class="line">	while !(n&gt;y) {</span><br><span class="line">		sum += x;</span><br><span class="line">		x ++;</span><br><span class="line">	}</span><br><span class="line">	return sum;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;As is discussed before, it&apos;s pseudo VM code is as below:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">function mult(x,y)</span><br><span class="line">	push 0</span><br><span class="line">	pop sum</span><br><span class="line">	push 1</span><br><span class="line">	pop n</span><br><span class="line">label LOOP</span><br><span class="line">	push n</span><br><span class="line">	push y</span><br><span class="line">	gt</span><br><span class="line">	if-goto ENDLOOP</span><br><span class="line">	push sum</span><br><span class="line">	push x</span><br><span class="line">	add</span><br><span class="line">	pop sum</span><br><span class="line">	push n</span><br><span class="line">	push 1</span><br><span class="line">	add</span><br><span class="line">	pop n</span><br><span class="line">	goto LOOP</span><br><span class="line">label ENDLOOP</span><br><span class="line">	push sum</span><br><span class="line">	return</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;In fact, it can be translated into this VM code:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">function mult 2</span><br><span class="line">	push constant 0 //sum = 0</span><br><span class="line">	pop local 0</span><br><span class="line">	push constant 1 //n = 1</span><br><span class="line">	pop local 1</span><br><span class="line">label LOOP</span><br><span class="line">	push local 1 //if clause</span><br><span class="line">	push argument 1</span><br><span class="line">	gt</span><br><span class="line">	if-goto ENDLOOP</span><br><span class="line">	push local 0 // sum += x</span><br><span class="line">	push argument 0</span><br><span class="line">	add</span><br><span class="line">	pop local 0</span><br><span class="line">	pop local 1 // n ++</span><br><span class="line">	push constant 1</span><br><span class="line">	add</span><br><span class="line">	pop local 1</span><br><span class="line">	goto LOOP</span><br><span class="line">label ENDLOOP</span><br><span class="line">	push local 0 // return sum</span><br><span class="line">	return</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;Let&apos;s discuss the implementation in detail:</p>
<ol type="1">
<li><p><em>Function declaration</em>:</p>
<ul>
<li><code>Function</code>: function declaration.</li>
<li><code>mult</code>: the name of the function.</li>
<li><code>2</code>: use 2 <em>local variables</em> in the function.</li>
</ul></li>
<li><p><em>Function body</em>:</p>
<ul>
<li>branching.</li>
<li>the variable declared within the body should be stored in
<code>local</code>.</li>
<li>the assignment of variables can be done through
<code>push constant</code> and <code>pop local</code>.</li>
</ul></li>
<li><p><em>Return value</em></p>
<ul>
<li><code>push</code> the to-return value in the stack.</li>
<li><code>return</code> statement at the end of program.</li>
</ul></li>
</ol>
<h3 id="3function-execution">3.Function execution</h3>
<p>&#x2003;&#x2003;We can execute a function in a <code>Main</code> function:
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function main 0</span><br><span class="line">	push constant 3</span><br><span class="line">	push constant 5</span><br><span class="line">	push constant 8</span><br><span class="line">	call mult 2</span><br><span class="line">	add </span><br><span class="line">	return </span><br></pre></td></tr></table></figure></p>
<ul>
<li>the <code>2</code> next to <code>mult</code> indicates that
<strong>the funtion takes in 2 arguments</strong>.</li>
<li>the whole process can be described through these diagrams:</li>
</ul>
<p><img src="/2024/04/10/7-7-%E5%87%BD%E6%95%B0%E6%8A%BD%E8%B1%A1/image.png"></p>
<p><img src="/2024/04/10/7-7-%E5%87%BD%E6%95%B0%E6%8A%BD%E8%B1%A1/image-1.png"></p>
<p><img src="/2024/04/10/7-7-%E5%87%BD%E6%95%B0%E6%8A%BD%E8%B1%A1/image-2.png"></p>
<p>&#x2003;&#x2003;for each function <code>call</code> during run-time, the
implementation of the <code>call</code> command should :</p>
<ul>
<li><p><strong>Pass parameters</strong> from the calling function to the
called function;</p></li>
<li><p><strong>Determine the return address</strong> within the caller&apos;s
code;</p></li>
<li><p><strong>Save the caller&apos;s return address, stack and memory
segments</strong>;</p>
<ul>
<li>so that when we return to the <code>main</code>, we will be able to
<strong>recreate the private world of <code>main</code></strong>.</li>
</ul></li>
<li><p>Jump to <strong>execute the called fiunction</strong>:</p></li>
</ul>
<p>&#x2003;&#x2003;And for each function <code>return</code> during run-time, the
impletation has to:</p>
<ul>
<li><p>Return to the caller <em>the value computed by the called
function</em>;</p>
<ul>
<li>The implementation knows that the topmost value on the stack must be
the return value, so it returns the value.</li>
</ul></li>
<li><p><strong>Recycle the memory resources</strong> used by the called
funetion;</p></li>
<li><p><strong>Reinstate the caller&apos;s stack and memory
segments</strong>;</p></li>
<li><p>Jump to the <strong>return address in the caller&apos;s
code</strong>.</p></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/10/7-7-%E5%88%86%E6%94%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/10/7-7-%E5%88%86%E6%94%AF/" class="post-title-link" itemprop="url">7.6.&#x5206;&#x652F;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-10 16:44:10" itemprop="dateCreated datePublished" datetime="2024-04-10T16:44:10+08:00">2024-04-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 14:28:40" itemprop="dateModified" datetime="2024-06-03T14:28:40+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-7-VM-Machine/" itemprop="url" rel="index"><span itemprop="name">Module 7.VM Machine</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>146</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="76branching"><span class="math inline">\(7.6.\)</span>Branching</h1>
<h3 id="1branching-implementation">1.Branching implementation</h3>
<p>&#x2003;&#x2003;Take the following program as example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//return x * y</span><br><span class="line">int mult (int x, int y) {</span><br><span class="line">	int sum = 0;</span><br><span class="line">	int n = 1;</span><br><span class="line"></span><br><span class="line">	while !(n&gt;y) {</span><br><span class="line">		sum += x;</span><br><span class="line">		n++;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	return sum;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;This program can be translated into pseudo VM code as below:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">function mult(x,y)</span><br><span class="line">	push 0</span><br><span class="line">	pop sum</span><br><span class="line">	push 1</span><br><span class="line">	pop n</span><br><span class="line">label LOOP</span><br><span class="line">	push n</span><br><span class="line">	push y</span><br><span class="line">	gt</span><br><span class="line">	if-goto ENDLOOP</span><br><span class="line">	push sum</span><br><span class="line">	push x</span><br><span class="line">	add</span><br><span class="line">	pop sum</span><br><span class="line">	push n</span><br><span class="line">	push 1</span><br><span class="line">	add</span><br><span class="line">	pop n</span><br><span class="line">	goto LOOP</span><br><span class="line">label ENDLOOP</span><br><span class="line">	push sum</span><br><span class="line">	return</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;Notice that we have three new symbols: <code>label</code>,
<code>if-goto</code>, <code>goto</code>:</p>
<ul>
<li><code>label LABEL</code> declare the label.</li>
<li><code>if-goto LABEL</code>: if the statement is true, then jump to
<code>LABEL</code>.</li>
<li><code>goto LABEL</code>: jump to <code>LABEL</code> with no
condition.</li>
</ul>
<p>&#x2003;&#x2003;With these three statement, we can translate the branching
expression into VM code.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/09/7-5-%E5%86%85%E5%AD%98%E6%AE%B5%E7%9A%84%E5%AE%9E%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/09/7-5-%E5%86%85%E5%AD%98%E6%AE%B5%E7%9A%84%E5%AE%9E%E7%8E%B0/" class="post-title-link" itemprop="url">7.5.&#x5185;&#x5B58;&#x6BB5;&#x7684;&#x5B9E;&#x73B0;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-09 10:32:16" itemprop="dateCreated datePublished" datetime="2024-04-09T10:32:16+08:00">2024-04-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 08:15:56" itemprop="dateModified" datetime="2024-06-03T08:15:56+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-7-VM-Machine/" itemprop="url" rel="index"><span itemprop="name">Module 7.VM Machine</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>751</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>3 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="75memory-segment-implementation"><span class="math inline">\(7.5.\)</span>Memory Segment implementation</h1>
<h3 id="1local-implementation">1.<code>local</code> implementation</h3>
<p>&#x2003;&#x2003;The <code>local</code> segment can be placed <strong>anywhere we
want in the host RAM</strong>, for we just need to <strong>remember the
base address of the block</strong>.</p>
<ul>
<li>We place the <strong>base address of the <code>local</code>
segment</strong> in a pointer called <em>LCL</em>.</li>
<li><em>LCL</em> will refer to <code>RAM 1</code>.</li>
</ul>
<p><img src="/2024/04/09/7-5-%E5%86%85%E5%AD%98%E6%AE%B5%E7%9A%84%E5%AE%9E%E7%8E%B0/image.png"></p>
<p><img src="/2024/04/09/7-5-%E5%86%85%E5%AD%98%E6%AE%B5%E7%9A%84%E5%AE%9E%E7%8E%B0/image-1.png"></p>
<p>&#x2003;&#x2003;Then we can <code>push</code> or <code>pop</code> a value easily.
Say we want to accomplish <code>pop local 2</code>:</p>
<p><img src="/2024/04/09/7-5-%E5%86%85%E5%AD%98%E6%AE%B5%E7%9A%84%E5%AE%9E%E7%8E%B0/image-2.png"></p>
<p>&#x2003;&#x2003;We can do this by putting the stack-top value into
<code>RAM[1015]</code>.</p>
<p><img src="/2024/04/09/7-5-%E5%86%85%E5%AD%98%E6%AE%B5%E7%9A%84%E5%AE%9E%E7%8E%B0/image-3.png"></p>
<ul>
<li>How do we know which <code>RAM</code> to add to? We get it by
<code>base addr + index</code></li>
</ul>
<p>&#x2003;&#x2003;This process can be translated into this VM code: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//get the place to be added</span><br><span class="line">addr = addr + index</span><br><span class="line">//get the value, and put it into correct place</span><br><span class="line">sp--</span><br><span class="line">*addr = *sp</span><br><span class="line">// D = *sp, *addr = D</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;Notice that 5 is still in <code>RAM[257]</code>, it hasn&apos;t been
removed. It&apos;s common to have these wasted data in the stack, and it&apos;s
not big deal, for <strong>the pointer indicates exactly which part of
the stack are in play, not the data</strong>.</p>
<h3 id="2argumentthisthatimplementation">2.<code>argument,this,that</code>
implementation</h3>
<ul>
<li><p>When translating the high-level code of some method into VM
code:</p>
<ul>
<li>Maps the method&apos;s local and argument variables onto the
<code>local</code> and <code>argument</code> segments</li>
<li>Maps the object fields and the array entries that the method is
currently processing onto the <code>this</code> and <code>that</code>
segments</li>
</ul></li>
</ul>
<p>&#x2003;&#x2003;The process of <code>argument</code>, <code>this</code> and
<code>that</code> is nearly the same as <code>local</code>:</p>
<p><img src="/2024/04/09/7-5-%E5%86%85%E5%AD%98%E6%AE%B5%E7%9A%84%E5%AE%9E%E7%8E%B0/image-4.png"></p>
<p>&#x2003;&#x2003;The process can be translated into this VM code: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//push</span><br><span class="line">addr = segmentPointer + index</span><br><span class="line">*sp = *addr</span><br><span class="line">sp++</span><br><span class="line"></span><br><span class="line">//pop</span><br><span class="line">addr = segmentPointer + index</span><br><span class="line">sp--</span><br><span class="line">*addr = *sp</span><br></pre></td></tr></table></figure></p>
<h3 id="3constant">3.<code>Constant</code></h3>
<ul>
<li><p>When the compiler translates the high-level code of some method
into VM,</p>
<ul>
<li>it translates high-level operations involving constant into VM
operations involving the constant segment.</li>
</ul></li>
<li><p>When we implement <code>constant</code>, we simply <strong>supply
the specified constant</strong>.</p></li>
<li><p>Since we won&apos;t store things where a <code>constant</code>
resides, there&apos;s no <code>pop</code> in <code>constant</code>.</p></li>
<li><p>The <code>constant</code> segment is a <strong>truly virtual
segment</strong>. So whenever we see a <code>push constant i</code>
command, we simply supply the specified constant
<code>i</code>.</p></li>
</ul>
<p><img src="/2024/04/09/7-5-%E5%86%85%E5%AD%98%E6%AE%B5%E7%9A%84%E5%AE%9E%E7%8E%B0/image-5.png"></p>
<h3 id="4static">4.<code>Static</code></h3>
<ul>
<li><p>When translating the high-level code of some method into VM code,
the compiler:</p>
<ul>
<li>Maps the static variables that the method sees onto the
<code>static</code> segment.</li>
</ul></li>
<li><p>The <code>static</code> variables should <strong>be seen by all
the methods in a program</strong>. &#x2003;&#x2003;To complement this, we store the
variables in a <em>&quot;global space&quot;</em>:</p></li>
<li><p>Have the VM translator translate each VM reference
<code>static i</code>(in file <code>Foo.vm</code>)into an <em>assembly
reference</em> <code>Foo.i</code>.</p>
<ul>
<li><code>Foo</code> is the name of the file, and <code>i</code> is the
index of VM command.</li>
</ul></li>
<li><p>Following assembly, the Hack assembler will map these references
onto <code>RAM[16]</code>,<code>RAM[17]</code>,<code>RAM[18]</code>,
...</p></li>
</ul>
<p>&#x2003;&#x2003;For example, the statement <code>pop static 5</code> can be
translated into: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Foo.5</span><br><span class="line">M = D</span><br><span class="line">//the register stores this data</span><br><span class="line"></span><br><span class="line">@Foo.2</span><br><span class="line">M = D</span><br></pre></td></tr></table></figure> * The entries of <code>static</code>
segment will end up being mapped onto <code>RAM[16]</code>,
<code>RAM[17]</code>, ... , in the order <strong>in which they appear in
the program</strong> (not their names!!!).</p>
<figure>
<img src="/2024/04/09/7-5-%E5%86%85%E5%AD%98%E6%AE%B5%E7%9A%84%E5%AE%9E%E7%8E%B0/image-6.png" alt="Alt text">
<figcaption aria-hidden="true">Alt text</figcaption>
</figure>
<blockquote>
<p>Static variables are stored <strong>in a section of memory called the
static data segment</strong>, which is allocated when the program is
loaded and has fixed memory addresses. When we want to retrieve the
value of a static variable, we need to read the value stored <strong>at
the memory location</strong> where the static variable is stored, rather
than directly accessing the value of the static variable itself. This is
why we need to use <code>D=M</code> instead of <code>D=A</code> to get a
<code>static</code> value.</p>
</blockquote>
<h3 id="5temp">5.<code>Temp</code></h3>
<p>&#x2003;&#x2003;When the compiler translates the Jack program into VM code, it
sometimes has to use temporary variables.</p>
<ul>
<li>We let the 8 place segment called <code>temp</code> to contain and
serve these variables when needed.</li>
<li><code>temp</code> is going to be a <strong>fixed 8-place memory
segment</strong>.</li>
<li>The variables will be mapped on <code>RAM</code> locations 5 to
12.</li>
</ul>
<p><img src="/2024/04/09/7-5-%E5%86%85%E5%AD%98%E6%AE%B5%E7%9A%84%E5%AE%9E%E7%8E%B0/image-7.png"></p>
<h3 id="6pointer">6.Pointer</h3>
<ul>
<li><p>When translating a high-level method code into VM code,the
compiler:</p>
<ul>
<li>Has to remember the base addresses of <code>this</code>, which
represents <em>the current object</em>, and <code>that</code>, which
represents <em>the current array of method be processing</em>.</li>
<li>Generates code that <strong>keeps track of the base addresses of the
this and that segments</strong> using the pointer segment.</li>
</ul></li>
<li><p><code>pointer</code> is a fixed memory segment. It has only two
entries, <code>0</code> and <code>1</code>.</p>
<ul>
<li>So we can only <code>push</code> and <code>pop</code> <code>0</code>
and <code>1</code></li>
</ul></li>
<li><p>Accessing <code>pointer 0</code> should result in
<strong>accessing <code>THIS</code></strong>.</p></li>
<li><p>Accessing <code>pointer 1</code> should result in
<strong>accessing <code>THAT</code></strong>.</p></li>
</ul>
<p><img src="/2024/04/09/7-5-%E5%86%85%E5%AD%98%E6%AE%B5%E7%9A%84%E5%AE%9E%E7%8E%B0/image-8.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/08/7-4-%E5%A0%86%E6%A0%88%E7%BB%93%E6%9E%84%E5%AE%9E%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/08/7-4-%E5%A0%86%E6%A0%88%E7%BB%93%E6%9E%84%E5%AE%9E%E7%8E%B0/" class="post-title-link" itemprop="url">7.4.&#x5806;&#x6808;&#x7ED3;&#x6784;&#x5B9E;&#x73B0;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-08 18:24:16" itemprop="dateCreated datePublished" datetime="2024-04-08T18:24:16+08:00">2024-04-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 08:06:14" itemprop="dateModified" datetime="2024-06-03T08:06:14+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-7-VM-Machine/" itemprop="url" rel="index"><span itemprop="name">Module 7.VM Machine</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>311</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="74implementation-of-stack"><span class="math inline">\(7.4.\)</span>Implementation of Stack</h1>
<h3 id="1pointer-manipulation">1.Pointer manipulation</h3>
<p>&#x2003;&#x2003;We first introduce <em>pointer notation</em>: <code>*p</code>
represents <strong>the value stores in the address that <code>p</code>
points to</strong>.</p>
<p><img src="/2024/04/08/7-4-%E5%A0%86%E6%A0%88%E7%BB%93%E6%9E%84%E5%AE%9E%E7%8E%B0/image.png"></p>
<p>&#x2003;&#x2003;In <em>Hack</em>, the pointer statement:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D = *p // D becomes 23</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;can be translated into:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@p</span><br><span class="line">A = M</span><br><span class="line">D = M</span><br></pre></td></tr></table></figure>
<ul>
<li><code>A = M</code> points the pointer to the address of register
M.</li>
<li><code>D = M</code> gets the value of the RAM.</li>
</ul>
<p>&#x2003;&#x2003;The calculation of pointer, such as:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p--</span><br><span class="line">D = *p</span><br></pre></td></tr></table></figure>
<p>&#x2003;&#x2003;When <code>p--</code>, <code>*p</code> refers to
<code>RAM[256]</code>. After than when we invoke <code>D = *p</code>, it
will get the value stored in <code>RAM[256]</code>, namely 19.</p>
<p>&#x2003;&#x2003;When we assign a number to pointer, such as: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">*q = 9</span><br><span class="line">q++</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;The <code>*q</code> refers to <code>RAM[1024]</code>, which stores
value 5. After the assignment, <code>RAM[1024]</code>stores 9
instead.</p>
<h3 id="2stack-machine-operation">2.Stack machine operation</h3>
<p>&#x2003;&#x2003;Before implementation, we make two assumption:</p>
<ol type="1">
<li>The stack pointer will be stored in <code>RAM[0]</code>.</li>
<li>Stack base address will be <code>addr = 256</code>.</li>
</ol>
<p>&#x2003;&#x2003;Let&apos;s <code>push</code> two value first:</p>
<p><img src="/2024/04/08/7-4-%E5%A0%86%E6%A0%88%E7%BB%93%E6%9E%84%E5%AE%9E%E7%8E%B0/image-1.png"></p>
<p>&#x2003;&#x2003;After the <code>push</code>, the stack pointer will point to 258,
and our RAM looks like this:</p>
<p><img src="/2024/04/08/7-4-%E5%A0%86%E6%A0%88%E7%BB%93%E6%9E%84%E5%AE%9E%E7%8E%B0/image-2.png"></p>
<p>&#x2003;&#x2003;And we push <code>12 + 5</code> into the stack, then 17 will be in
the previous available space, and stack pointer moves forward:</p>
<p><img src="/2024/04/08/7-4-%E5%A0%86%E6%A0%88%E7%BB%93%E6%9E%84%E5%AE%9E%E7%8E%B0/image-3.png"></p>
<p>&#x2003;&#x2003;So we can write the VM code: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//push x</span><br><span class="line">*sp = x</span><br><span class="line">sp++</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;This can be translated into this Hack assembly: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//push x</span><br><span class="line">@x</span><br><span class="line">D = A // D = x</span><br><span class="line">@SP</span><br><span class="line">A = M // *sp = D</span><br><span class="line">M = D</span><br><span class="line">@SP //increase the location</span><br><span class="line">M = M + 1</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>&#x2003;&#x2003;In this program, the A register plays two roles: &#x2003;&#x2003;<em>Data
register</em> which stores x &#x2003;&#x2003;<em>Address register</em> as usual</p>
</blockquote>
<h3 id="3vm-translator-perspective">3.VM translator perspective</h3>
<p><img src="/2024/04/08/7-4-%E5%A0%86%E6%A0%88%E7%BB%93%E6%9E%84%E5%AE%9E%E7%8E%B0/image-4.png"></p>
<ul>
<li><p>VM translator is:</p>
<ul>
<li>A program that translates VM code into machine language.</li>
<li>Each VM command generates several assembly commands.</li>
</ul></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/08/7-2-VM%E7%BB%93%E6%9E%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/08/7-2-VM%E7%BB%93%E6%9E%84/" class="post-title-link" itemprop="url">7.2.VM&#x7ED3;&#x6784;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-08 15:54:36" itemprop="dateCreated datePublished" datetime="2024-04-08T15:54:36+08:00">2024-04-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 07:57:13" itemprop="dateModified" datetime="2024-06-03T07:57:13+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-7-VM-Machine/" itemprop="url" rel="index"><span itemprop="name">Module 7.VM Machine</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>250</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="72vm-abstractionthe-stack"><span class="math inline">\(7.2.\)</span>VM Abstraction&#x2014;&#x2014;the Stack</h1>
<h3 id="1-the-stack-machine">1. The stack machine</h3>
<ul>
<li>The stack machine is an <em>abstraction</em> that consists of
<strong>an architecture, a stack and a set of operation which we can
apply to the architecture</strong>.</li>
</ul>
<p><img src="/2024/04/08/7-2-VM%E7%BB%93%E6%9E%84/image.png"></p>
<ul>
<li>It can be considered an <em>array</em> which offers direct access to
every element in the memory, as oppose to the traditional stack which
only offers a stack pointer.</li>
<li>When we do <code>push x</code>, <strong>the address of
<code>x</code></strong> will be push into the stack:</li>
</ul>
<p><img src="/2024/04/08/7-2-VM%E7%BB%93%E6%9E%84/image-1.png"></p>
<ul>
<li><p>When we do <code>pop y</code>:</p>
<ul>
<li>the <strong>current top value in the stack</strong> will be
removed,</li>
<li>the <strong>popped value</strong> will override <code>y</code> (in
this example, when 7 is popped, 3 becomes the new top value).</li>
</ul></li>
</ul>
<p><img src="/2024/04/08/7-2-VM%E7%BB%93%E6%9E%84/image-2.png"></p>
<h3 id="2stack-arithmetic">2.Stack arithmetic</h3>
<p>&#x2003;&#x2003;If we want to apply a certain function on the stack, we have to do
three different things:</p>
<ol type="1">
<li>Pop as many required operands in the stack as possible.</li>
<li>Apply the function to these operands in a separate process and get
the result.</li>
<li>Push the result back into the stack.</li>
</ol>
<p><img src="/2024/04/08/7-2-VM%E7%BB%93%E6%9E%84/image-3.png"></p>
<p>&#x2003;&#x2003;The obstruction supports all these operations inherently, all we
have to do it to call <code>add</code> or <code>neg</code>, and these
things will take place.</p>
<p><img src="/2024/04/08/7-2-VM%E7%BB%93%E6%9E%84/image-4.png"></p>
<h3 id="3vm-commands">3.VM commands</h3>
<ul>
<li>Arithmetic commands:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// d = (2 - x) + (y + 9)</span><br><span class="line">push 2</span><br><span class="line">push x</span><br><span class="line">sub</span><br><span class="line">push y</span><br><span class="line">push 9</span><br><span class="line">add</span><br><span class="line">add </span><br><span class="line">pop d</span><br></pre></td></tr></table></figure>
<p><img src="/2024/04/08/7-2-VM%E7%BB%93%E6%9E%84/image-5.png"></p>
<ul>
<li>Logic commands: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// (x &lt; 7) or (y == 8)</span><br><span class="line">push x </span><br><span class="line">push 7</span><br><span class="line">lt</span><br><span class="line">push y</span><br><span class="line">push 8</span><br><span class="line">eq </span><br><span class="line">or</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/2024/04/08/7-2-VM%E7%BB%93%E6%9E%84/image-6.png"></p>
<p>&#x2003;&#x2003;Where do these commands come from? It&apos;s compiled from the
high-level language:</p>
<p><img src="/2024/04/08/7-2-VM%E7%BB%93%E6%9E%84/image-7.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/08/7-3-%E5%86%85%E5%AD%98%E6%AE%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/08/7-3-%E5%86%85%E5%AD%98%E6%AE%B5/" class="post-title-link" itemprop="url">7.3.&#x5185;&#x5B58;&#x6BB5;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-08 15:54:36" itemprop="dateCreated datePublished" datetime="2024-04-08T15:54:36+08:00">2024-04-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 08:02:02" itemprop="dateModified" datetime="2024-06-03T08:02:02+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-7-VM-Machine/" itemprop="url" rel="index"><span itemprop="name">Module 7.VM Machine</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>239</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="73memorysegments"><span class="math inline">\(7.3.\)</span>Memory
Segments</h1>
<h3 id="1memory-segments-intro">1.Memory segments intro</h3>
<p>&#x2003;&#x2003;There are different variable kinds in the high-level language, such
as:</p>
<ul>
<li>Argument variables</li>
<li>Local variables</li>
<li>Static variables</li>
</ul>
<p>&#x2003;&#x2003;Since different kind of variables <strong>play different
role</strong>, we need some mechanism to <strong>record the different
roles of different variables</strong>. We can achieve this by the notion
of <em>memory segments</em>:</p>
<p><img src="/2024/04/08/7-3-%E5%86%85%E5%AD%98%E6%AE%B5/image.png"></p>
<p>&#x2003;&#x2003;So the program below can be translated into two ways: without
<em>memory segments</em>:</p>
<p><img src="/2024/04/08/7-3-%E5%86%85%E5%AD%98%E6%AE%B5/image-1.png"></p>
<p>&#x2003;&#x2003;And with <em>memory segments</em>:</p>
<p><img src="/2024/04/08/7-3-%E5%86%85%E5%AD%98%E6%AE%B5/image-2.png"></p>
<p>&#x2003;&#x2003;In this way, we will be able to preserve the role semantics of
these variables.</p>
<p>&#x2003;&#x2003;But it seems that we lost the variable names in the process. It&apos;s
not a big deal, however, for <strong>the VM obstruction doesn&apos;t
recognize symbolic variable names</strong>, all the variables are
replaced by references to memory segments.</p>
<p>&#x2003;&#x2003;Through memory segments, we now interact with several different
segments:</p>
<p><img src="/2024/04/08/7-3-%E5%86%85%E5%AD%98%E6%AE%B5/image-3.png"></p>
<p>&#x2003;&#x2003;And the syntax of the command is:
<code>push / pop segment i</code></p>
<ul>
<li><em>segment</em> is the segment you want to operate on.</li>
<li><em>i</em> is the index of the command in that segment.</li>
<li><span class="math inline">\(e.g.\)</span>
:<code>push constant 17</code></li>
<li><span class="math inline">\(e.g.\)</span> : translation of
<code>let static 2 = argument 1</code>:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">push argument 1</span><br><span class="line">pop static 2</span><br></pre></td></tr></table></figure>
<h3 id="2the-usage-of-segment">2.The usage of segment</h3>
<ul>
<li><p>There&apos;s a lot of semantics going on in the high-level
language:</p>
<ul>
<li>static variables, local variables, argument variables, ...</li>
<li>the <em>object</em> consisting a bundle of variables</li>
</ul></li>
<li><p>We can handle all the semantics using the eight virtual
segments.</p></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/08/7-1-%E7%A8%8B%E5%BA%8F%E7%BC%96%E8%AF%91%E5%89%8D%E7%9E%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/08/7-1-%E7%A8%8B%E5%BA%8F%E7%BC%96%E8%AF%91%E5%89%8D%E7%9E%BB/" class="post-title-link" itemprop="url">7.1.&#x7A0B;&#x5E8F;&#x7F16;&#x8BD1;&#x524D;&#x77BB;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-08 13:24:34" itemprop="dateCreated datePublished" datetime="2024-04-08T13:24:34+08:00">2024-04-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 07:51:48" itemprop="dateModified" datetime="2024-06-03T07:51:48+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-7-VM-Machine/" itemprop="url" rel="index"><span itemprop="name">Module 7.VM Machine</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>266</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="71program-compilation-preview"><span class="math inline">\(7.1.\)</span>Program Compilation Preview</h1>
<h3 id="1problem-in-compilation">1.Problem in compilation</h3>
<p>&#x2003;&#x2003;To start with an abstract program and end with something actually
runs on the computer, we need</p>
<ul>
<li>A computer that can run machine language code.</li>
<li>Translating the high level language into machine language.</li>
</ul>
<p><img src="/2024/04/08/7-1-%E7%A8%8B%E5%BA%8F%E7%BC%96%E8%AF%91%E5%89%8D%E7%9E%BB/image.png"></p>
<p>&#x2003;&#x2003;However, there are so many kinds of computers in the world, and
many of them <strong>use different processes, which take different
machine languages</strong>. It seems that we have to develop many
compilers, one for each processor. This is very annoying.</p>
<p>&#x2003;&#x2003;Luckily, this &quot;write once fix everywhere&quot; can be replaced by a
&quot;write once run everywhere&quot; process.</p>
<h3 id="2-2-tier-compilation">2. 2-Tier compilation</h3>
<p>&#x2003;&#x2003;Let&apos;s take Java as example:</p>
<ul>
<li><p>The first tier: also called <em>the top tier</em></p>
<ul>
<li><p>Java compiler translates the Java program into VM code.</p>
<ul>
<li>The VM code is designed to run on an abstract artifact called
<em>virtual machine</em>.</li>
<li>It&apos;s not a real computer, so if we want to execute the code, we have
to translate it further into machine language and realize it on real
hardware (computer, for example).</li>
</ul></li>
</ul></li>
</ul>
<p><img src="/2024/04/08/7-1-%E7%A8%8B%E5%BA%8F%E7%BC%96%E8%AF%91%E5%89%8D%E7%9E%BB/image-1.png"></p>
<ul>
<li><p>The second tier:</p>
<ul>
<li>We equip the target device with <em>JVM</em>, the Java machine
implementation.</li>
<li>The JVM is a program that takes VM code and translates it into the
target code of the target platform.</li>
<li>We need such translator <strong>for every platform on which we want
to execute VM program</strong>.</li>
</ul></li>
</ul>
<p><img src="/2024/04/08/7-1-%E7%A8%8B%E5%BA%8F%E7%BC%96%E8%AF%91%E5%89%8D%E7%9E%BB/image-2.png"></p>
<p>&#x2003;&#x2003;The gap between high-level language (Java, for example) and
low-level language is huge. But by <strong>introducing an intermediate
level</strong>, we <strong>decouple this process into two separate
standalone sub-processes</strong>: the compiler of <em>VM compiler</em>
and <em>VM implementation</em>.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/07/6-5-Hack%E6%B1%87%E7%BC%96%E5%99%A8%E5%BC%80%E5%8F%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/07/6-5-Hack%E6%B1%87%E7%BC%96%E5%99%A8%E5%BC%80%E5%8F%91/" class="post-title-link" itemprop="url">6.5.Hack&#x6C47;&#x7F16;&#x5668;&#x5F00;&#x53D1;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-07 18:24:54" itemprop="dateCreated datePublished" datetime="2024-04-07T18:24:54+08:00">2024-04-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 00:05:51" itemprop="dateModified" datetime="2024-06-03T00:05:51+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-6-Assembler/" itemprop="url" rel="index"><span itemprop="name">Module 6.Assembler</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>417</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="65developing-a-hack-assembler"><span class="math inline">\(6.5.\)</span>Developing a Hack Assembler</h1>
<h3 id="1start-reding-a-file">1.Start reding a file</h3>
<p>&#x2003;&#x2003;In general, this part:</p>
<ul>
<li>Need to be able to read the input and break it into parts.</li>
<li>Doesn&apos;t need to understand what the command means or how it will be
translated into machine language.</li>
<li>Need to understand the format of the input language and how it
breaks into different components.</li>
</ul>
<p>&#x2003;&#x2003;In detail, we may divide it into several parts:</p>
<ol type="1">
<li><p>Read a file with a given name.</p>
<ul>
<li>You may want a constructor to be able to accept the file name and
then open the file for reading.</li>
</ul></li>
<li><p>Move to next command in the file:</p>
<ol type="1">
<li>Are we finished? <code>boolean hasMoreCommands()</code></li>
<li>Get the next command: <code>void advance()</code></li>
<li>Read into one line into some kind of string.</li>
<li>Skip white space including comments.</li>
</ol></li>
<li><p>Get the fields of the current command</p>
<ul>
<li>Type of command (A, C, or label)</li>
</ul></li>
</ol>
<p><img src="/2024/04/07/6-5-Hack%E6%B1%87%E7%BC%96%E5%99%A8%E5%BC%80%E5%8F%91/image.png"></p>
<h3 id="2translating-mnemonic-tocode">2.Translating mnemonic to
code</h3>
<p>&#x2003;&#x2003;In general, this part:</p>
<ul>
<li><p>Don&apos;t need to worry about how the mnemonic fields were
obtained.</p>
<ul>
<li>No need to know what part of input line it is, etc.</li>
</ul></li>
</ul>
<p>&#x2003;&#x2003;In detail, we:</p>
<ol type="1">
<li>Ask the parser to give us the string that corresponds to each part
of the field.</li>
<li>Once we get the three string, we go to the code object to translate
each one of them separately according to the known table.</li>
<li>Concatenate the output together.</li>
</ol>
<p><img src="/2024/04/07/6-5-Hack%E6%B1%87%E7%BC%96%E5%99%A8%E5%BC%80%E5%8F%91/image-1.png"></p>
<h3 id="3the-symbol-table">3.The symbol table</h3>
<p>&#x2003;&#x2003;In general, this part:</p>
<ul>
<li>Don&apos;t need to know what the symbols mean.</li>
<li>Need to maintain the association between a symbol and a memory
address.</li>
</ul>
<p>&#x2003;&#x2003;In detail, we need to be able to:</p>
<ol type="1">
<li>Create an new empty table</li>
<li>Add a (symbol, address) pair to the table</li>
<li>Does the table contain a given symbol?</li>
<li>What is the address associated with a given symbol?</li>
</ol>
<p>&#x2003;&#x2003;And do the following things:</p>
<ol type="1">
<li><p>Create a new empty table</p></li>
<li><p>Add all the pre-defined symbols to the table</p></li>
<li><p>While reading the input, add labels and new variables to the
table</p>
<ul>
<li><p>Labels: when you see a <code>&quot;(xxx)&quot;</code> command,add
<code>&quot;xxx&quot;</code> and the address of the next machine language
command</p>
<ul>
<li>Comment 1: this requires maintaining this running address (line
number).</li>
<li>Comment 2: this may need to be done in a first pass</li>
</ul></li>
<li><p>Variables: when you see an <code>&quot;@xxx&quot;</code> command, where
<code>&quot;xxx&quot;</code> is not a number and not already in the table, add
<code>&quot;xxx&quot;</code> and the next free address for variable
allocation</p></li>
</ul></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/07/6-4-%E7%AC%A6%E5%8F%B7%E7%9A%84%E5%A4%84%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/07/6-4-%E7%AC%A6%E5%8F%B7%E7%9A%84%E5%A4%84%E7%90%86/" class="post-title-link" itemprop="url">6.4.&#x7B26;&#x53F7;&#x7684;&#x5904;&#x7406;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-07 15:34:54" itemprop="dateCreated datePublished" datetime="2024-04-07T15:34:54+08:00">2024-04-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 00:00:56" itemprop="dateModified" datetime="2024-06-03T00:00:56+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-6-Assembler/" itemprop="url" rel="index"><span itemprop="name">Module 6.Assembler</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>632</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="64handling-the-symbol"><span class="math inline">\(6.4.\)</span>Handling the Symbol</h1>
<h3 id="1type-of-symbol">1.Type of symbol</h3>
<p>&#x2003;&#x2003;Generally there are three types of symbol:</p>
<ul>
<li><em>Variable symbols</em>: Which represents memory locations where
the programmer wants to maintain values.</li>
<li><em>Label symbols</em>: Which represents destinations of goto
instructions.</li>
<li><em>Pre-defined symbols</em>: Which represents special memory
lorations.</li>
</ul>
<h3 id="2pre-define-symbolstranslation">2.Pre-define symbols
translation</h3>
<ul>
<li>These symbols exist only <strong>in the context of A
instructions</strong>. So they will only be seen in expression like
<code>@preDefinedSymbol</code></li>
<li>Translating <code>@preDefinedSymbol</code>: Replace
<code>preDefineSymbol</code> with its corresponding value:</li>
</ul>
<p><img src="/2024/04/07/6-4-%E7%AC%A6%E5%8F%B7%E7%9A%84%E5%A4%84%E7%90%86/image.png"></p>
<h3 id="3label-symbols-translation">3.Label symbols translation</h3>
<p>&#x2003;&#x2003;To begin with, there are two sorts of label:</p>
<ul>
<li>Used to label destination of <code>goto</code> commands. For
example, <code>@STOP, 0;JMP</code></li>
<li>Declared by the <em>pseudo-command</em>. For example,
<code>(STOP)</code></li>
</ul>
<blockquote>
<p>This is called pseudo-commands because <strong>it doesn&apos;t generate
any code</strong>. When we translate the program into binary. we don&apos;t
translate the label declaration instructions.</p>
</blockquote>
<p>&#x2003;&#x2003;To allocate a specific location to each label, we
<strong>number</strong> the instruction one by one, like the left hand
side:</p>
<p><img src="/2024/04/07/6-4-%E7%AC%A6%E5%8F%B7%E7%9A%84%E5%A4%84%E7%90%86/image-1.png"></p>
<ul>
<li>We ignore <strong>white space and pseudo-commands</strong> when
numbering.</li>
</ul>
<p>&#x2003;&#x2003;Once we complete the numbering, we can <strong>refer the label to
its corresponding line number</strong>. For example, <code>LOOP</code>
relates to 4 and <code>STOP</code> relates to 18. And when we see the
instruction <code>@LOOP</code>, we actually mean <code>@4</code>.</p>
<p>&#x2003;&#x2003;After this pre-work, the translating is plain: * Translating
<code>@labelSymbol</code>: Replace <code>labelSymbol</code> with its
value.</p>
<h3 id="4varables-translation">4.Varables translation</h3>
<ul>
<li>Any symbol xx appearing in an assembly program which <strong>is not
pre-defined</strong> and <strong>is not defined elsewhere using the
(xxx) directive</strong> is treated as a variable</li>
<li>if a variable appears in the program for the first time, we allocate
it to a memory address <strong>starting from address 16</strong> . If we
see this varable popping up later in the program, we simply <strong>look
up the value that you assigned to it before</strong>.</li>
</ul>
<h3 id="5symbol-table-construction">5.Symbol table construction</h3>
<h4 id="afirstpass">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>First
pass</h4>
<p>&#x2003;&#x2003;In the <em>first pass</em>, we extract from the program <strong>all
the label symbols</strong>.</p>
<ul>
<li><p>Before starting any translation, create an empty table and add
all the predefined symbos one by one.</p></li>
<li><p>March through the entire text file that constitutes the source
assembly program:</p>
<ul>
<li><p>Only <strong>look for label declarations</strong></p>
<ul>
<li>Line of code that begins with left parenthesis.</li>
</ul></li>
<li><p>Meanwhile keep track of how many lines you&apos;ve read so far (only
count real instructions).</p></li>
</ul></li>
</ul>
<p><img src="/2024/04/07/6-4-%E7%AC%A6%E5%8F%B7%E7%9A%84%E5%A4%84%E7%90%86/image-2.png"></p>
<h4 id="bsecondpass">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Second
pass</h4>
<ul>
<li>We start once again to scan the entire program.</li>
<li>Whenever we see a symbol <strong>which doesn&apos;t appear in the symbol
table</strong>, we add it to the table, assign to it <code>16</code> or
larger number (for it must be a varable).</li>
<li>If we find them in the symbol table, then they&apos;ve been declared and
we can use them.</li>
</ul>
<h4 id="cmore-about-the-table">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>More about the table</h4>
<ul>
<li>When resolving a symbol, we look it up in the table, retrieve its
value, and put it into the instruction. What you get is <strong>the
meaning of this symbol</strong> according to the symbol table.</li>
<li>We maintain the table as long as the assembler is processing the
program, and then we can toss it away.</li>
</ul>
<h3 id="6summary-the-assemblyprocess">6.Summary: The assembly
process</h3>
<ul>
<li><p><em>Initialization</em>:</p>
<ul>
<li>Construct an empty symbol table,</li>
<li>Add the pre-defined symbols to the symbol table,</li>
</ul></li>
<li><p><em>First pass</em>:</p>
<ul>
<li><p>Scan the entire program;</p></li>
<li><p>For each &quot;instruction&quot; of the form <code>(xxx)</code>:</p>
<ul>
<li>Add the pair (xxx, address) to the symbol table, where
<em>address</em> is <strong>the number of the instruction following
<code>(xxx)</code></strong>.</li>
</ul></li>
</ul></li>
<li><p><em>Second pass</em>:</p>
<ul>
<li><p>Set n to 16</p></li>
<li><p>Scan the entire program again, for each instruction:</p>
<ul>
<li><p>If the instruction is <code>@symbol</code>, look up symbol in the
symbol table:</p>
<ul>
<li><p>If (symbol, value) is found, use value to complete the
instruction&apos;s translation;</p></li>
<li><p>If not found:</p>
<ul>
<li>Add (symbol, n) to the symbol table,</li>
<li>Use n to complete the instruction&apos;s translation,</li>
<li>n++</li>
</ul></li>
</ul></li>
</ul></li>
<li><p>If the instruction is a C-instruction, complete the instruction&apos;s
translation.</p></li>
<li><p>Write the translated instruction to the output file.</p></li>
</ul></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/07/5-5-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AE%9E%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/07/5-5-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AE%9E%E7%8E%B0/" class="post-title-link" itemprop="url">5.5.Hack&#x8BA1;&#x7B97;&#x673A;&#x5B9E;&#x73B0;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-07 10:24:34" itemprop="dateCreated datePublished" datetime="2024-04-07T10:24:34+08:00">2024-04-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 16:17:37" itemprop="dateModified" datetime="2024-06-03T16:17:37+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-5-Computer-Architecture/" itemprop="url" rel="index"><span itemprop="name">Module 5.Computer Architecture</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>1k</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>4 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="55hack&#x8BA1;&#x7B97;&#x673A;&#x5B9E;&#x73B0;&#x7B14;&#x8BB0;"><span class="math inline">\(5.5.\)</span>Hack&#x8BA1;&#x7B97;&#x673A;&#x5B9E;&#x73B0;&#x7B14;&#x8BB0;</h1>
<h3 id="1cpu&#x5B9E;&#x73B0;">1.CPU&#x5B9E;&#x73B0;</h3>
<p><img src="/2024/04/07/5-5-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AE%9E%E7%8E%B0/image.png"></p>
<h4 id="a&#x6307;&#x4EE4;&#x8BC6;&#x522B;">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>&#x6307;&#x4EE4;&#x8BC6;&#x522B;</h4>
<ul>
<li><code>instruction[15]</code>:&#x7528;&#x4E8E;<strong>&#x5224;&#x65AD;&#x662F;&#x5426;&#x4E3A;<code>A</code>&#x6307;&#x4EE4;</strong>&#x3002;</li>
<li><code>instruction[12]</code>&#x7528;&#x4E8E;<strong>&#x9009;&#x62E9;ALU&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x8F93;&#x5165;&#x6765;&#x6E90;</strong>&#x3002;&#x5F53;<code>instruction[12] = 0</code>&#x65F6;&#xFF0C;ALU&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x8F93;&#x5165;&#x4E3A;<code>A</code>&#x5BC4;&#x5B58;&#x5668;&#xFF1B;&#x5426;&#x5219;&#x4E3A;&#x5B58;&#x50A8;&#x5668;&#x7684;&#x8F93;&#x5165;&#x6570;&#x636E;<code>inM</code>&#x3002;</li>
<li><code>instruction[6:11]</code>:&#x7528;&#x4E8E;<strong>&#x63A7;&#x5236;ALU&#x7684;&#x64CD;&#x4F5C;</strong>&#x3002;</li>
<li><code>instruction[5]</code>:&#x5F53;<code>instruction[15] = 0</code>&#x65F6;&#xFF0C;<code>instruction[5]</code><strong>&#x5C31;&#x662F;<code>A</code>&#x6307;&#x4EE4;&#x7684;&#x4E00;&#x90E8;&#x5206;</strong>&#xFF1B;&#x5426;&#x5219;&#xFF0C;&#x5B83;&#x5C31;&#x662F;<code>C</code>&#x6307;&#x4EE4;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x3002;</li>
<li><code>instruction[4]</code>:&#x7528;&#x4E8E;<strong>&#x9009;&#x62E9;ALU&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x8F93;&#x5165;</strong>&#x3002;&#x5F53;<code>instruction[4] = 1</code>&#x65F6;&#xFF0C;&#x6211;&#x4EEC;<strong>&#x5C06;&#x5185;&#x5B58;&#x4E2D;&#x8BFB;&#x53D6;&#x7684;&#x6570;&#x636E;&#x4F5C;&#x4E3A;ALU&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x8F93;&#x5165;(&#x5373;<code>inM</code>)</strong>&#xFF1B;&#x5426;&#x5219;<strong>&#x5C06;<code>A</code>&#x5BC4;&#x5B58;&#x5668;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x4F5C;&#x4E3A;ALU&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x8F93;&#x5165;</strong>&#x3002;</li>
<li><code>instruction[3]</code>:&#x7528;&#x4E8E;<strong>&#x6307;&#x793A;&#x662F;&#x5426;&#x8981;&#x5411;&#x6570;&#x636E;&#x5185;&#x5B58;&#x5199;&#x5165;&#x6570;&#x636E;</strong>&#x3002;&#x5F53;<code>instruction[3] = 1</code>&#x65F6;&#xFF0C;&#x8868;&#x793A;&#x8981;&#x5411;&#x6570;&#x636E;&#x5185;&#x5B58;&#x4E2D;&#x5199;&#x5165;&#x6570;&#x636E;(&#x5373;<code>writeM = 1</code>)&#xFF1B;&#x5426;&#x5219;&#x4E0D;&#x5BF9;&#x6570;&#x636E;&#x5185;&#x5B58;&#x8FDB;&#x884C;&#x5199;&#x5165;&#x64CD;&#x4F5C;&#x3002;</li>
<li><code>C</code>&#x6307;&#x4EE4;&#x5BF9;&#x5E94;&#x7684;16&#x4F4D;&#x6307;&#x4EE4;&#xFF1A;</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 c1 c2 c3 c4 c5 c6 d1 d2 d3 j1 j2 j3</span><br></pre></td></tr></table></figure>
<ul>
<li><code>A</code>&#x6307;&#x4EE4;&#x5BF9;&#x5E94;&#x7684;16&#x4F4D;&#x6307;&#x4EE4;</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 address[14:0]</span><br></pre></td></tr></table></figure>
<h4 id="ba&#x5BC4;&#x5B58;&#x5668;&#x5904;&#x7406;">&#x2003;&#x2003;<span class="math inline">\(b.\)</span><code>A</code>&#x5BC4;&#x5B58;&#x5668;&#x5904;&#x7406;</h4>
<figure>
<img src="/2024/04/07/5-5-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AE%9E%E7%8E%B0/image-1.png" alt="Alt text">
<figcaption aria-hidden="true">Alt text</figcaption>
</figure>
<ol type="1">
<li>&#x8F93;&#x5165;&#x7684;16&#x4F4D;&#x6307;&#x4EE4;&#x548C;ALU&#x7684;&#x8F93;&#x51FA;&#x7ECF;&#x8FC7;<code>Mux16</code>&#x4F5C;&#x4E3A;<code>A</code>&#x5BC4;&#x5B58;&#x5668;&#x7684;&#x8F93;&#x5165;&#xFF1A;</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mux16(a = instruction, b = ALUOut, sel = instruction[15], out = Ain);</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>&#x5728;&#x540E;&#x9762;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x77E5;&#x9053;&#x6307;&#x4EE4;&#x662F;&#x5426;&#x4E3A;<code>A</code>&#x6307;&#x4EE4;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x7528;&#x4E00;&#x4E2A;pin&#x6765;&#x8BB0;&#x5F55;&#xFF1A;</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Not(in = instruction[15], out = NotA);</span><br></pre></td></tr></table></figure>
<ol start="3" type="1">
<li><p>&#x5224;&#x65AD;&#x662F;&#x5426;&#x9700;&#x8981;&#x5C06;&#x6307;&#x4EE4;&#x52A0;&#x8F7D;&#x5230;<code>A</code>&#x5BC4;&#x5B58;&#x5668;&#x4E2D;&#x3002;&#x6B64;&#x65F6;&#x6709;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#xFF1A;</p>
<ol type="1">
<li>&#x5F53;&#x524D;&#x6307;&#x4EE4;&#x4E0D;&#x662F;<code>A</code>&#x6307;&#x4EE4;&#xFF0C;&#x5219;&#x9009;&#x62E9;&#x52A0;&#x8F7D;&#x3002;</li>
<li>&#x5F53;&#x524D;&#x6307;&#x4EE4;&#x4E3A;<code>A</code>&#x6307;&#x4EE4;&#xFF0C;&#x4F46;&#x662F;<code>instruction[5] = 1</code>(&#x8BE5;&#x4F4D;&#x7F6E;&#x7528;&#x4E8E;&#x5B58;&#x50A8;<code>A</code>&#x6307;&#x4EE4;&#x6709;&#x5173;&#x4FE1;&#x606F;)&#xFF0C;&#x5219;&#x9009;&#x62E9;&#x52A0;&#x8F7D;&#xFF1A;</li>
</ol></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Or(a = NotA, b = instruction[5] , out=loadA);</span><br><span class="line">ARegister(in = Ain, load = loadA, out = Aout, out[0..14] = addressM);</span><br></pre></td></tr></table></figure>
<h4 id="calu&#x8FD0;&#x7B97;">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>ALU&#x8FD0;&#x7B97;</h4>
<p><img src="/2024/04/07/5-5-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AE%9E%E7%8E%B0/image-2.png"></p>
<ol type="1">
<li>&#x6211;&#x4EEC;&#x5148;&#x5904;&#x7406;ALU&#x7684;&#x4E24;&#x4E2A;&#x8F93;&#x5165;&#x6E90;&#xFF0C;&#x5176;&#x4E2D;&#x7B2C;&#x4E8C;&#x4E2A;&#x8F93;&#x5165;&#x6E90;&#x7531;<code>C</code>&#x6307;&#x4EE4;&#x96C6;&#x7684;<code>instruction[12]</code>&#x63A7;&#x5236;&#xFF1A;</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Mux16(a = Aout, b = inM, sel = instruction[12], out = AMout);</span><br><span class="line">And(a = instruction[15], b = instruction[4], out = loadD);</span><br><span class="line">DRegister(in = ALUOut, load = loadD, out = Dout);</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x6839;&#x636E;&#x5148;&#x524D;&#x7684;&#x6307;&#x4EE4;&#x8BC6;&#x522B;&#x8FDB;&#x884C;ALU&#x8FD0;&#x7B97;&#x5E76;&#x8F93;&#x51FA;&#xFF1A;</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">And(a = instruction[11], b = instruction[15], out = zx);</span><br><span class="line">And(a = instruction[10], b = instruction[15], out = nx);</span><br><span class="line">Or(a = instruction[9], b = NotA, out = zy);</span><br><span class="line">Or(a = instruction[8], b = NotA, out = ny);</span><br><span class="line">And(a = instruction[7], b = instruction[15], out = f);</span><br><span class="line">And(a = instruction[6], b = instruction[15], out = no);</span><br><span class="line"></span><br><span class="line">ALU(x = Dout, y = AMout, zx = zx, nx = nx, zy = zy, ny = ny, f = f, no = no, out = outM, out = ALUOut, zr = zero, ng = nega);</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>zy</code>&#x548C;<code>ny</code>&#x63A7;&#x5236;&#x4FE1;&#x53F7;&#x5728;<code>A</code>&#x6307;&#x4EE4;&#x65F6;&#x88AB;&#x5F3A;&#x5236;&#x4E3A;1&#x662F;&#x4E3A;&#x4E86;<strong>&#x786E;&#x4FDD;ALU&#x7684;&#x8F93;&#x5165;&#x5728;&#x5904;&#x7406;<code>A</code>&#x6307;&#x4EE4;&#x65F6;&#x88AB;&#x7B80;&#x5316;&#x4E0E;&#x56FA;&#x5B9A;&#xFF0C;&#x4E0D;&#x53D7;<code>C</code>&#x6307;&#x4EE4;&#x63A7;&#x5236;&#x4F4D;&#x7684;&#x5F71;&#x54CD;</strong>&#xFF0C;&#x4ECE;&#x800C;&#x907F;&#x514D;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x8BA1;&#x7B97;&#x3002;</p>
</blockquote>
<ol start="3" type="1">
<li>&#x4E4B;&#x540E;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x6267;&#x884C;<code>C</code>&#x6307;&#x4EE4;&#x96C6;&#x7684;&#x8DF3;&#x8F6C;&#x903B;&#x8F91;&#x3002;&#x6211;&#x4EEC;&#x6839;&#x636E;<strong>ALU&#x8BA1;&#x7B97;&#x7ED3;&#x679C;&#x548C;&#x6307;&#x4EE4;&#x4E2D;&#x7684;&#x8DF3;&#x8F6C;&#x4F4D;</strong>&#x6765;&#x51B3;&#x5B9A;&#x662F;&#x5426;&#x8DF3;&#x8F6C;&#x3002;</li>
</ol>
<p>&#x2003;&#x2003;&#x9996;&#x5148;&#x5BF9;<code>C</code>&#x6307;&#x4EE4;&#x96C6;&#x7684;&#x8DF3;&#x8F6C;&#x4F4D;&#x8FDB;&#x884C;&#x660E;&#x6670;&#xFF1A;</p>
<ul>
<li><code>instruction[0]</code>&#x5BF9;&#x5E94;<code>JGT</code>&#xFF0C;&#x5F53;ALU&#x8F93;&#x51FA;&#x4E3A;&#x6B63;&#x6570;&#x65F6;&#x8DF3;&#x8F6C;&#x3002;</li>
<li><code>instruction[1]</code>&#x5BF9;&#x5E94;<code>JEQ</code>&#xFF0C;&#x5F53;ALU&#x8F93;&#x51FA;&#x4E3A;0&#x65F6;&#x8DF3;&#x8F6C;&#x3002;</li>
<li><code>instruction[2]</code>&#x5BF9;&#x5E94;<code>JLT</code>&#xFF0C;&#x5F53;ALU&#x8F93;&#x51FA;&#x4E3A;&#x8D1F;&#x6570;&#x65F6;&#x8DF3;&#x8F6C;&#x3002;</li>
</ul>
<p>&#x2003;&#x2003;&#x4E8E;&#x662F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5199;&#x51FA;&#x4EE5;&#x4E0B;&#x4EE3;&#x7801;&#xFF1A;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Or(a = zero, b = nega, out = notpos);</span><br><span class="line">Not(in = notpos, out = pos);</span><br><span class="line">&#xA0; &#xA0; </span><br><span class="line">And(a = instruction[0], b = pos, out = out3);</span><br><span class="line">And(a = instruction[1], b = zero, out = out2);</span><br><span class="line">And(a = instruction[2], b = nega, out = out1);</span><br><span class="line"></span><br><span class="line">Or(a = out1, b = out2, out = out12);</span><br><span class="line">Or(a = out12, b = out3, out = out123);</span><br><span class="line"></span><br><span class="line">And(a = out123, b = instruction[15], out = jump);</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>pos</code>, <code>nega</code>,
<code>zero</code>&#x5206;&#x522B;&#x4EE3;&#x8868;&#x6B63;&#x6570;&#x3001;&#x8D1F;&#x6570;&#x548C;&#x6070;&#x597D;&#x4E3A;0&#x3002;&#x5E76;&#x4E14;&#x6CE8;&#x610F;&#x9664;&#x4E86;&#x6EE1;&#x8DB3;&#x8DF3;&#x8F6C;&#x6761;&#x4EF6;&#x5916;&#xFF0C;&#x8FD8;&#x9700;&#x8981;<strong>&#x786E;&#x4FDD;&#x5F53;&#x524D;&#x662F;<code>C</code>&#x6307;&#x4EE4;</strong>&#x3002;</p>
</blockquote>
<ol start="4" type="1">
<li>&#x6700;&#x540E;&#x6211;&#x4EEC;&#x8C03;&#x7528;<code>PC</code>&#x4EE5;&#x5B58;&#x50A8;&#x5E76;&#x66F4;&#x65B0;&#x5F53;&#x524D;&#x6307;&#x4EE4;&#x7684;&#x5730;&#x5740;&#xFF1A;</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PC(in = Aout, load = jump, reset = reset, inc = true, out[0..14] = pc);</span><br></pre></td></tr></table></figure>
<h3 id="2&#x5185;&#x5B58;&#x5B9E;&#x73B0;">2.&#x5185;&#x5B58;&#x5B9E;&#x73B0;</h3>
<p>&#x2003;&#x2003;&#x5185;&#x5B58;&#x5B9E;&#x73B0;&#x8F83;&#x4E3A;&#x7B80;&#x5355;&#xFF0C;&#x6839;&#x636E;&#x4F20;&#x5165;&#x7684;15&#x4F4D;&#x5730;&#x5740;<code>address</code>&#x7684;&#x540E;&#x4E24;&#x4F4D;&#x4EE5;&#x53CA;<code>load</code>&#x6765;&#x8C03;&#x63A7;RAM&#x3001;&#x5C4F;&#x5E55;&#x4EE5;&#x53CA;&#x952E;&#x76D8;&#x5373;&#x53EF;&#x3002;</p>
<ul>
<li><code>01 and load: RAMLoad</code></li>
<li><code>10 and load: SCRLoad</code></li>
<li><code>11 and load and other digit 0: KEYLoad</code></li>
</ul>
<h3 id="3hack&#x8BA1;&#x7B97;&#x673A;&#x5B9E;&#x73B0;">3.Hack&#x8BA1;&#x7B97;&#x673A;&#x5B9E;&#x73B0;</h3>
<p><img src="/2024/04/07/5-5-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AE%9E%E7%8E%B0/image-3.png"></p>
<p>&#x2003;&#x2003;&#x6211;&#x4EEC;&#x6839;&#x636E;&#x8BA1;&#x7B97;&#x673A;&#x7684;&#x7ED3;&#x6784;&#xFF0C;&#x5BF9;&#x5DF2;&#x6709;&#x82AF;&#x7247;&#x8FDB;&#x884C;&#x63A5;&#x7EBF;&#x5373;&#x53EF;&#xFF1A;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CPU(inM = MemoryOut, instruction = Rominstruction, reset = reset, outM = CPUoutM, writeM = CPUload, addressM = CPUaddress, pc = CPUpc);</span><br><span class="line">Memory(in = CPUoutM, load = CPUload, address = CPUaddress, out = MemoryOut);</span><br><span class="line">ROM32K(address = CPUpc, out = Rominstruction);</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/07/6-1-%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E4%B8%8E%E7%A8%8B%E5%BA%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/07/6-1-%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E4%B8%8E%E7%A8%8B%E5%BA%8F/" class="post-title-link" itemprop="url">6.1.&#x6C47;&#x7F16;&#x8BED;&#x8A00;&#x4E0E;&#x7A0B;&#x5E8F;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-07 09:34:24" itemprop="dateCreated datePublished" datetime="2024-04-07T09:34:24+08:00">2024-04-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 07:47:54" itemprop="dateModified" datetime="2024-06-03T07:47:54+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-6-Assembler/" itemprop="url" rel="index"><span itemprop="name">Module 6.Assembler</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>214</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="61assemble-program-and-assembler"><span class="math inline">\(6.1.\)</span>Assemble Program and Assembler</h1>
<h3 id="1basic-assembler-logic">1.Basic assembler logic</h3>
<ul>
<li><p>Repeat:</p>
<ul>
<li>Read the next Assembly language command.</li>
<li>Break it into the different fields it is composed of.</li>
<li>Lookup the binary code for each field.</li>
<li>Combine these codes into a single machine language command.</li>
<li>Output this machine language command.</li>
</ul></li>
<li><p>One thing we need to worry about: <em>Symbols</em>:</p>
<ul>
<li><p>Two cases:</p>
<ul>
<li><em>Labels</em>: When jumping into a certain part, you give it a
name instead of hard core the address. <code>JMP loop</code></li>
<li><em>Variables</em>: You give a variable name rather than always
refer to its exact address in memory. <code>load R1, weight</code></li>
</ul></li>
<li><p>To convert it into concrete address, we use a <em>symbol
table</em>:</p></li>
</ul></li>
</ul>
<p><img src="/2024/04/07/6-1-%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E4%B8%8E%E7%A8%8B%E5%BA%8F/image.png"></p>
<ul>
<li><p>To maintain such table:</p>
<ul>
<li>When we first meet a symbol, we need to <strong>allocate a new
memory location</strong> to hold it. For the assembler, it will find the
<strong>next memory location that&apos;s available</strong>.</li>
<li>When we meet it again, we simply refer to its address in the
table.</li>
</ul></li>
<li><p>One special case: <em>Forward references</em>: We can jump into a
label before where it was defined. There are two ways to handle it:</p>
<ol type="1">
<li>Use a little bit to remember that we&apos;ve set the labels but don&apos;t
know where it is yet. We leave it blank until label appears.(more
complicated)</li>
<li>In first pass just figure out all address.</li>
</ol></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/06/5-4-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/06/5-4-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA/" class="post-title-link" itemprop="url">5.4.Hack&#x8BA1;&#x7B97;&#x673A;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-06 11:34:24" itemprop="dateCreated datePublished" datetime="2024-04-06T11:34:24+08:00">2024-04-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 16:17:37" itemprop="dateModified" datetime="2024-06-03T16:17:37+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-5-Computer-Architecture/" itemprop="url" rel="index"><span itemprop="name">Module 5.Computer Architecture</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>747</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>3 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="54hackcomputer"><span class="math inline">\(5.4.\)</span>Hack
Computer</h1>
<h3 id="1hack-computer-abstraction">1.Hack computer abstraction</h3>
<ul>
<li>A computer capable of running programs written in the Hack machine
language.</li>
</ul>
<h3 id="2cpu-operations">2.CPU operations</h3>
<p><img src="/2024/04/06/5-4-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA/image.png"></p>
<figure>
<img src="/2024/04/06/5-4-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA/image-1.png" alt="Alt text">
<figcaption aria-hidden="true">Alt text</figcaption>
</figure>
<ul>
<li><p>If the instruction includes <code>D And A</code>, CPU is going to
<strong>manipulate the respective D and A registers</strong>.</p></li>
<li><p>If the instruction ia an A instruction like <code>@17</code>, CPU
is going to <strong>take the 15-bit data value and store them inside the
A register</strong>. This value is <strong>emitted by
<code>addressM</code></strong>.</p></li>
<li><p>If the instruction&apos;s <em>right hand side</em> includes
<code>M</code> like <code>M = M + 1</code>, this value is <strong>read
from <code>inM</code> interface</strong>.</p></li>
<li><p>If the instruction&apos;s <em>left hand side</em> includes
<code>M</code>, then the value output should be stored in the data
memory of the selected memory register.</p>
<ul>
<li>As we discuss in the CPU, we have to provide <strong>what things we
want to write, where to write and the control bits</strong> to write
something to the data memory. As a result, <strong>the ALU output is
emitted by <code>outM</code>, and the <code>writeM</code> is
asserted</strong>.</li>
</ul></li>
<li><p>If we have a jump situation <code>@100, D = D - 1; JEQ</code>. ,
we want to jump to the address that was specified before(100, in this
case):</p>
<ul>
<li>If <code>reset == 0</code>, CPU logic uses <strong>the jump bits and
the ALU output</strong> to decide whether or not there should be a
jump.</li>
<li>If there is a jump, <code>PC = A</code></li>
<li>Else, <code>PC++</code></li>
<li>The updated <code>PC</code> value <strong>is emitted by
<em>pc</em></strong>.</li>
<li>If <code>reset == 1</code>, <em>pc</em> emits <code>0</code>,
causing a program restart</li>
</ul></li>
</ul>
<h3 id="3memory-abstraction">3.Memory abstraction</h3>
<figure>
<img src="/2024/04/06/5-4-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA/image-2.png" alt="Alt text">
<figcaption aria-hidden="true">Alt text</figcaption>
</figure>
<ul>
<li><p>Three different segments:</p>
<ul>
<li>Address 0 to 16383(16k): <em>data memory</em></li>
<li>Address 16384 to 24575(next 8k): <em>screen memory map</em></li>
<li>Address 24576: <em>keyboard memory map</em></li>
</ul></li>
</ul>
<h3 id="4memory-implementation">4.Memory implementation</h3>
<p>&#x2003;&#x2003;We bulid our memory from three different sub-chips:</p>
<ul>
<li><em>RAM:</em> 16-bit 16K RAM chip</li>
<li><em>Screen</em>: 16-bit/8K memory chip with a raster display
side-effect.</li>
<li><em>Keyboard</em>: 16-bit register with a keyboard side-effect.</li>
</ul>
<h4 id="aram">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>RAM</h4>
<p>![[Pasted image 20240406103441.png]]</p>
<ul>
<li>The inputs and outputs of RAM16 are identical to the inputs and
outputs of the overall memory chip.</li>
<li>So whoever builds the chip has to make sure to take the outside
inputs and outputs and <strong>make connections that will funnel these
value into the inner chip box, such as RAM 16K</strong>.</li>
</ul>
<h4 id="bscreen">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Screen</h4>
<p>![[Pasted image 20240406104348.png]]</p>
<ul>
<li>We use a special built-in <em>8K screen chip</em> that knows how to
automatically refresh a connected display unit.
<ul>
<li>It&apos;s a RAM chip, which has a nice side effect of refreshing a
connected display unit.</li>
</ul></li>
</ul>
<h4 id="ckeyboard">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>Keyboard</h4>
<p><img src="/2024/04/06/5-4-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA/image-3.png"></p>
<ul>
<li>We use a built-in Keyboard chip featuring a keyboard capture
side-effect, which is that it always reflects what the user is pressing
on the keyboard.</li>
</ul>
<h3 id="5instruction-memory">5.Instruction memory</h3>
<h4 id="aintro">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>Intro</h4>
<ul>
<li>We implement this instruction memory using a chip called <em>ROM
32K</em>.</li>
</ul>
<p><img src="/2024/04/06/5-4-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA/image-4.png"></p>
<ul>
<li><p>We can <strong>loading a program</strong> in this way:</p>
<ul>
<li><p>Hardware inplementation: <em>plug-and-play ROM chips</em>: We put
our machine instruction code into a ROM chip. We take this RAM chip,
plug it into the computer. We press the <code>reset</code> button, and
the computer will start executing this particular program.</p>
<ul>
<li>If we want to run another program, we take the chip out and plug in
another chip.</li>
</ul></li>
</ul></li>
</ul>
<h4 id="brominterface">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>ROM
interface</h4>
<p><img src="/2024/04/06/5-4-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA/image-5.png"></p>
<ul>
<li>It&apos;s a <strong>read-only</strong> device.</li>
<li>Contains a sequence of Hack instructions (program).</li>
<li>The <em>output</em> of of the ROM is always <strong>the contents of
the register that is selected by the address input</strong>.</li>
<li>Since the <em>pc</em> always emits the address of next instruction,
if we feed this address into ROM, we are guaranteed that ROM will always
admit a 16-bit value that we can treat as the current instruction.</li>
</ul>
<h3 id="6hack-computerimplementation">6.Hack computer
implementation</h3>
<p><img src="/2024/04/06/5-4-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA/image-6.png"></p>
<ul>
<li>We first connect to the CPU <strong>the instruction memory which we
call ROM</strong>. The instruction input of the CPU is taken from the
output of instruction memory.</li>
<li>In the process of executing this instuction, we are going to compute
the address of the next instruction. This address is emitted by
<em>pc</em>.</li>
<li>The address goes all the way into the address of the instruction
unit, and the unit will emit the next instruction that has to be
executed in the next cycle.</li>
</ul>
<p><img src="/2024/04/06/5-4-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA/image-7.png"></p>
<ul>
<li>To do something useful with the outputs, we connect outputs to
<em>memory unit</em>.</li>
<li>We take the output of the memory, and connect it back into the
CPU</li>
</ul>
<p><img src="/2024/04/06/5-4-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA/image-8.png"></p>
<ul>
<li>The input and output units are the only two things the computer
users sees when he works.</li>
<li>With this computer is a display unit, a keyboard and the reset
button.</li>
</ul>
<p><img src="/2024/04/06/5-4-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA/image-9.png"></p>
<p><img src="/2024/04/06/5-4-Hack%E8%AE%A1%E7%AE%97%E6%9C%BA/image-10.png"></p>
<ul>
<li>This is the overall computer architect!!!</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/06/5-2-%E8%8E%B7%E5%8F%96-%E6%89%A7%E8%A1%8C%E5%BE%AA%E7%8E%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/06/5-2-%E8%8E%B7%E5%8F%96-%E6%89%A7%E8%A1%8C%E5%BE%AA%E7%8E%AF/" class="post-title-link" itemprop="url">5.2.&#x83B7;&#x53D6;-&#x6267;&#x884C;&#x5FAA;&#x73AF;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-06 09:44:54" itemprop="dateCreated datePublished" datetime="2024-04-06T09:44:54+08:00">2024-04-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 16:18:12" itemprop="dateModified" datetime="2024-06-03T16:18:12+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-5-Computer-Architecture/" itemprop="url" rel="index"><span itemprop="name">Module 5.Computer Architecture</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>477</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="52the-fetch-execute-cycle"><span class="math inline">\(5.2.\)</span>The Fetch-Execute Cycle</h1>
<ul>
<li><em>Fetch an instruction from the program memory</em></li>
<li><em>Execute</em> it</li>
</ul>
<h3 id="1fetching">1.Fetching</h3>
<ul>
<li><p>The next instruction is located at the <em>program memory</em>,
the program memory is in the <em>memory</em>, and its address is
specified by the <em>program counter</em>.</p></li>
<li><p>We need to basically <strong>put the location of the next
instruction into the &quot;address&quot; of the program memory</strong>. Then we
need to read the contents at that location and then will get the basic
instructions we need to execute.</p></li>
<li><p>We usually put the address of the next instruction into the
address input of the program memory by <em>program
counter</em>.</p></li>
</ul>
<p>&#x2003;&#x2003;The hardware cycle of executing the fetch operation is as
below:</p>
<p><img src="/2024/04/06/5-2-%E8%8E%B7%E5%8F%96-%E6%89%A7%E8%A1%8C%E5%BE%AA%E7%8E%AF/image.png"></p>
<ul>
<li>When we need to jump into a new location, we <strong>manipulate the
program counter</strong> so that it will have the address of the next
instruction.</li>
<li>The output of the program counter feeds into the address
specification of program memory.</li>
<li>The program memory output comes the actual instruction code that we
need to execute.</li>
</ul>
<h3 id="2execute">2.Execute</h3>
<ul>
<li><p>The instruction code specifies &quot;what to do&quot;</p>
<ul>
<li>Which arithmetie or logical instruction.</li>
<li>What memory to access (read/write).</li>
<li>If/where to jump.</li>
</ul></li>
<li><p><em>Bit aspect</em>: Execute current instruction means
<strong>taking the bits from the instruction code that specifies what to
do</strong>, and do what needs to be done.</p>
<ul>
<li>Often, different subsets of the bits control different aspects of
the operation</li>
</ul></li>
<li><p><em>Hardware aspect</em>:</p></li>
</ul>
<p><img src="/2024/04/06/5-2-%E8%8E%B7%E5%8F%96-%E6%89%A7%E8%A1%8C%E5%BE%AA%E7%8E%AF/image-1.png"></p>
<ul>
<li><p><em>control bus</em>:</p>
<ul>
<li><p>tells the ALU what instruction to compute,</p></li>
<li><p>tells where do the data pieces come from,</p></li>
</ul></li>
</ul>
<h3 id="2the-clash">2.The clash</h3>
<p>&#x2003;&#x2003;There&apos;s a clash in the cycle above:</p>
<ul>
<li>For <em>fetch</em>, we need to put into the address of the memory
<strong>the address of the next instruction</strong> to get the
instruction output.</li>
<li>For <em>execute</em>, we need to put into the address of the memory
<strong>the address of the data pieces</strong> that we want to operate
on to access data.</li>
<li>But we only have a single memory, so <strong>should we put into the
memory the address of data or instructions</strong>?</li>
</ul>
<p><img src="/2024/04/06/5-2-%E8%8E%B7%E5%8F%96-%E6%89%A7%E8%A1%8C%E5%BE%AA%E7%8E%AF/image-2.png"></p>
<p>&#x2003;&#x2003;To solve this problem, we will do <strong>one after
another</strong>. We will achieve this through a
<em>Multiplexer</em>:</p>
<ul>
<li>In the first part, the <em>fetch cycle</em>, the multiplexer set the
memory to point into <strong>the program counter that is the location of
the next instruction</strong>.</li>
<li>While in the <em>execute cycle</em>, the multiplexer will set the
memory to point into <strong>the data address that we need to
access</strong>.</li>
</ul>
<p>&#x2003;&#x2003;So how do we do this together?</p>
<p><img src="/2024/04/06/5-2-%E8%8E%B7%E5%8F%96-%E6%89%A7%E8%A1%8C%E5%BE%AA%E7%8E%AF/image-3.png"></p>
<ul>
<li>When we are in a <em>fetch cycle</em>, we get the next instruction,
and then we need to <strong>remember it inside an instruction
register</strong>.</li>
<li><strong>That instruction register is exactly what is remains holding
the value of the instruction that we are now executing in the execute
cycle.</strong> Then in the <em>execute cycle</em> we have the
instruction already stored in this register, so we can work with all the
information we need for the cycle.</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/06/5-3-CPU/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/06/5-3-CPU/" class="post-title-link" itemprop="url">5.3.CPU</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-06 09:44:54" itemprop="dateCreated datePublished" datetime="2024-04-06T09:44:54+08:00">2024-04-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 16:18:12" itemprop="dateModified" datetime="2024-06-03T16:18:12+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-5-Computer-Architecture/" itemprop="url" rel="index"><span itemprop="name">Module 5.Computer Architecture</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>726</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>3 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="53central-processing-unit"><span class="math inline">\(5.3.\)</span>Central Processing Unit</h1>
<h3 id="1abstraction">1.Abstraction</h3>
<p>&#x2003;&#x2003;We can view CPU as <strong>a 16-bit</strong> processor, designed
to:</p>
<ul>
<li><p>Execute the current instruction.</p>
<ul>
<li>This turns the static code into reality.</li>
</ul></li>
<li><p>Figure out which instruction to execute next.</p></li>
</ul>
<h3 id="2hack-cpu-interface">2.Hack CPU interface</h3>
<p><img src="/2024/04/06/5-3-CPU/image.png"></p>
<ul>
<li>CPU is connected both to the <em>instruction memory</em> and to the
<em>data memory</em>.</li>
</ul>
<p>&#x2003;&#x2003;here is the specific input and output connections of the CPU:</p>
<p><img src="/2024/04/06/5-3-CPU/image-1.png"></p>
<ul>
<li><p>We have three inputs coming from three completely different
sources.</p>
<ul>
<li><p>A 16-bit <em>data value</em>, which is the value of <strong>the
currently selected data memory register</strong>. This is the value CPU
is going to operate on.</p></li>
<li><p>A 16-bit <em>instruction value</em>, which is the value of
<strong>the selected instruction memory register</strong>.</p>
<ul>
<li>Remember that at any given point of time, there is always <strong>a
selected register in the instruction memory</strong>, and a
<strong>selected memory register in the data memory</strong>. So always
something comes into the CPU.</li>
</ul></li>
<li><p>A 1-bit <em>input</em>, which we <strong>decide to call the
reset</strong>.</p></li>
</ul></li>
<li><p>On the right hand side we see the outputs of ALU:</p>
<ul>
<li><p>The ALU specifies 3 different things to write something to the
data memory:</p>
<ol type="1">
<li><em>outM</em>: What we want to write.</li>
<li><em>writeM</em>: A <strong>load bit</strong> that enables the data
memory to write operations.</li>
<li><em>address</em>: Where do we want to write it.</li>
<li><em>pc</em>: It holds the <strong>address of the next
instruction</strong> that has to be fetched and executed in the next
cycle of this computer.</li>
</ol></li>
</ul></li>
</ul>
<h3 id="3cpu-implementation">3.CPU implementation</h3>
<p>&#x2003;&#x2003;The whole CPU hardware diagram is as below:</p>
<p><img src="/2024/04/06/5-3-CPU/image-2.png"></p>
<h4 id="aainstruction">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>A
instruction</h4>
<p><img src="/2024/04/06/5-3-CPU/image-3.png"></p>
<p>&#x2003;&#x2003;This section contains:</p>
<ul>
<li><em>A register</em> called A.</li>
<li><em>An A-instruction input</em> that connects to this register
through a <em>multiplexer</em>.</li>
</ul>
<p>&#x2003;&#x2003;We see that this instruction seeks to load the value
<code>3001</code> into a register. In order to carry out this
instruction, the CPU do:</p>
<ol type="1">
<li>Decode the instruction into <strong>op-code + 15-bit
value</strong>.</li>
<li>Noticing that it is a A instruction, CPU <strong>stores the 15-bit
value in the A-register</strong>.</li>
<li>Take the output of A register and admit it outside.</li>
</ol>
<h4 id="b-cinstruction">&#x2003;&#x2003;<span class="math inline">\(b.\)</span> C
instruction</h4>
<p><img src="/2024/04/06/5-3-CPU/image-4.png"></p>
<p>&#x2003;&#x2003;This section contains:</p>
<ul>
<li>A register.</li>
<li>C instruction.</li>
</ul>
<p>&#x2003;&#x2003;Others is the same as above.</p>
<ul>
<li><p>Say we want to gain an A instruction, we can use the
<em>Mux16</em>:</p>
<ul>
<li>If the instruction input is with an op-code <code>0</code>, we
choose the instruction input.</li>
<li>Otherwise, we choose the ALU input.</li>
</ul></li>
</ul>
<h4 id="caluoperation">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>ALU
Operation</h4>
<p><img src="/2024/04/06/5-3-CPU/image-5.png"></p>
<ul>
<li><p>The inputs of ALU come from:</p>
<ol type="1">
<li><p><em>D register</em></p></li>
<li><p>Either the value of <em>A register</em> or <em>selected memory
register</em>.</p></li>
<li><p><em>Multiplexer</em> takes care of this decision, and the control
bit of it is <strong>one of the bits in the instruction</strong>.</p>
<ul>
<li>The CPU designer has to <strong>choose this bit</strong>, and then
ALU gets the correct input.</li>
</ul></li>
</ol></li>
<li><p>ALU also has <em>6 control bits taken together</em> to
<strong>tell or specify the ALU which operation we want to carry
out</strong>.</p></li>
</ul>
<p><img src="/2024/04/06/5-3-CPU/image-6.png"></p>
<ul>
<li><p>The output of ALU is <strong>simultaneously</strong> fed
into:</p>
<ol type="1">
<li><p><em>D register</em></p></li>
<li><p><em>A register</em></p></li>
<li><p><em>M register</em></p>
<ul>
<li>It goes through a <em>Multiplexer</em>.</li>
</ul></li>
</ol></li>
</ul>
<p>&#x2003;&#x2003;The same ALU is fanned out into 3 different places, so we have the
same ALU output knocking on three different doors. The programmer has to
decide which door to be opened. The decision is made by next field of
bits &#x2014;&#x2014; <em>destination bits</em>:</p>
<ul>
<li>We have 3 destination bits, which decide whether or not open the
<em>D register</em>, <em>A register</em>, <em>M register</em> and the
<em>data memory</em> to accept the ALU output.</li>
</ul>
<h4 id="dcontrol-abstraction">&#x2003;&#x2003;<span class="math inline">\(d.\)</span>Control abstraction</h4>
<p>&#x2003;&#x2003;The computer is loaded with some program, when you push
<code>reset</code>, <strong>the program starts running</strong>.</p>
<p>&#x2003;&#x2003;In our previous chapter, we know that the last three bits of the
instruction is <em>jump bits</em>, which a <code>1</code> represents
unconditional <code>goto</code>. CPU realizes this functionality by
<em>program counter</em></p>
<h5 id="ipcabstraction">&#x2003;&#x2003;<span class="math inline">\(i.\)</span>PC
abstraction</h5>
<ul>
<li><p>Emits <strong>the address of the next instruction</strong>:</p>
<ul>
<li>To start / restart the program&apos;s execution: <code>PC = 0</code>(for
we want to execute the first instruction of the program).</li>
<li>no jump: <code>PC++</code></li>
<li>unconditional <code>goto</code>: <code>PC = A</code></li>
<li>conditional <code>goto</code>: if true <code>PC = A</code> else
<code>PC++</code></li>
</ul></li>
</ul>
<h5 id="iicontrol-implementation">&#x2003;&#x2003;<span class="math inline">\(ii.\)</span>Control implementation</h5>
<p><img src="/2024/04/06/5-3-CPU/image-7.png"></p>
<p><img src="/2024/04/06/5-3-CPU/image-8.png"></p>
<ul>
<li><p>if <code>reset == 1</code>, <code>PC=0</code></p></li>
<li><p>else</p>
<ul>
<li><p>We have to look at the <strong>jump bits</strong> and
simultaneously look at the <strong>ALU output</strong> to decide if we
want to carry out the jump.</p></li>
<li><p><code>load = f(jump bits, ALU control outputs)</code></p>
<ul>
<li>if <code>load == 1</code>, <code>PC = A</code></li>
<li>else <code>PC++</code></li>
</ul></li>
</ul></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/05/4-8-%E6%8C%87%E9%92%88%E3%80%81%E8%BE%93%E5%85%A5%E4%B8%8E%E8%BE%93%E5%87%BA%E6%8E%A7%E5%88%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/05/4-8-%E6%8C%87%E9%92%88%E3%80%81%E8%BE%93%E5%85%A5%E4%B8%8E%E8%BE%93%E5%87%BA%E6%8E%A7%E5%88%B6/" class="post-title-link" itemprop="url">4.8.&#x6307;&#x9488;&#xFF0C;&#x8F93;&#x5165;&#x4E0E;&#x8F93;&#x51FA;&#x63A7;&#x5236;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-05 20:23:44" itemprop="dateCreated datePublished" datetime="2024-04-05T20:23:44+08:00">2024-04-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 16:16:48" itemprop="dateModified" datetime="2024-06-03T16:16:48+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-4-Machine-Language/" itemprop="url" rel="index"><span itemprop="name">Module 4.Machine Language</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>268</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="48pointer-and-input-outputcontrol"><span class="math inline">\(4.8.\)</span>Pointer and Input, Output
Control</h1>
<h3 id="1pointer">1.Pointer</h3>
<p>&#x2003;&#x2003;We use <strong>A-instruction</strong> to point to a certain
address. For example: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">//   for(i = 0; i &lt; n; i ++) {</span><br><span class="line">//      arr[i] = -1</span><br><span class="line">//   }</span><br><span class="line"></span><br><span class="line">//   suppose arr = 100 and n = 10</span><br><span class="line"></span><br><span class="line">//initialize</span><br><span class="line">	@100</span><br><span class="line">	D = A</span><br><span class="line">	@arr</span><br><span class="line">	M = D</span><br><span class="line"></span><br><span class="line">	@10</span><br><span class="line">	D = A</span><br><span class="line">	@n</span><br><span class="line">	M = D</span><br><span class="line"></span><br><span class="line">	@i</span><br><span class="line">	M = 0</span><br><span class="line"></span><br><span class="line">//iteration</span><br><span class="line"></span><br><span class="line">(LOOP)</span><br><span class="line">	@i</span><br><span class="line">	D = M</span><br><span class="line">	@n </span><br><span class="line">	D = D - M</span><br><span class="line">	@END</span><br><span class="line">	D;JEQ</span><br><span class="line"></span><br><span class="line">	//RAM[arr + i] = -1</span><br><span class="line">	@i</span><br><span class="line">	D = M</span><br><span class="line">	@arr</span><br><span class="line">	A = D + M</span><br><span class="line">	M = -1</span><br><span class="line">	@i</span><br><span class="line">	M = M + 1</span><br><span class="line">	</span><br><span class="line">	@LOOP</span><br><span class="line">	0;JMP</span><br><span class="line"></span><br><span class="line">	(END)</span><br><span class="line">	@END</span><br><span class="line">	0;JMP</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;The key step in the program is <code>A = D + M, M = -1</code>:</p>
<ul>
<li><p>The <code>A = D + M</code> point the address of <code>arr</code>
to the <strong>base address</strong> of <code>arr</code>(the initial
address, 100) plus i, which match the expression
<code>arr + i</code>.</p></li>
<li><p>By the time we say M equals -1, the register that will be
affected is the register in A address.</p></li>
<li><p>Variables that store memory addresses like <code>arr + i</code>
are called <em>pointers</em>.</p></li>
<li><p>Typical pointer semantics:&quot;set the address register to the
contents of some <strong>memory register</strong>&quot;</p></li>
</ul>
<h3 id="2screen-input">2.Screen input</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">//for (i = 0; i &lt; n; i ++)</span><br><span class="line">//    draw 16 black pixels at the </span><br><span class="line">//    beginning of row i</span><br><span class="line"></span><br><span class="line">//    addr = SCREEN</span><br><span class="line">//    n = RAM[0]</span><br><span class="line">//    i = 0</span><br><span class="line">//    LOOP:</span><br><span class="line">//    if i &gt; n goto END</span><br><span class="line">//    RAM[addr] = -1 1111111111111111</span><br><span class="line">//    addr = addr + 32</span><br><span class="line">//    i = i + 1</span><br><span class="line">//    goto LOOP</span><br><span class="line"></span><br><span class="line">@SCREEN</span><br><span class="line">D = A</span><br><span class="line">@addr</span><br><span class="line">M = D</span><br><span class="line"></span><br><span class="line">@R0</span><br><span class="line">D = M</span><br><span class="line">@n</span><br><span class="line">M = D</span><br><span class="line"></span><br><span class="line">@i</span><br><span class="line">M = 0</span><br><span class="line"></span><br><span class="line">(LOOP)</span><br><span class="line">	@i</span><br><span class="line">	D = M</span><br><span class="line">	@n</span><br><span class="line">	D = D - M</span><br><span class="line">	@END</span><br><span class="line">	D; JGT</span><br><span class="line"></span><br><span class="line">	@addr</span><br><span class="line">	A = M</span><br><span class="line">	M = -1</span><br><span class="line"></span><br><span class="line">	@i</span><br><span class="line">	M = M + 1</span><br><span class="line">	@32</span><br><span class="line">	D = A</span><br><span class="line">	@addr</span><br><span class="line">	M = M + D</span><br><span class="line">	(LOOP)</span><br><span class="line">	0; JMP</span><br><span class="line">	</span><br><span class="line">(END)</span><br><span class="line">	@END</span><br><span class="line">	0; JMP</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/05/5-1-%E5%86%AF%C2%B7%E8%AF%BA%E4%BC%8A%E6%9B%BC%E7%BB%93%E6%9E%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/05/5-1-%E5%86%AF%C2%B7%E8%AF%BA%E4%BC%8A%E6%9B%BC%E7%BB%93%E6%9E%84/" class="post-title-link" itemprop="url">5.1.&#x51AF;&#xB7;&#x8BFA;&#x4F0A;&#x66FC;&#x7ED3;&#x6784;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-05 20:23:44" itemprop="dateCreated datePublished" datetime="2024-04-05T20:23:44+08:00">2024-04-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 16:17:37" itemprop="dateModified" datetime="2024-06-03T16:17:37+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-5-Computer-Architecture/" itemprop="url" rel="index"><span itemprop="name">Module 5.Computer Architecture</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>585</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="51von-neumman-architect"><span class="math inline">\(5.1.\)</span>Von Neumman Architect</h1>
<h3 id="1stored-program-computer">1.Stored program computer</h3>
<p><img src="/2024/04/05/5-1-%E5%86%AF%C2%B7%E8%AF%BA%E4%BC%8A%E6%9B%BC%E7%BB%93%E6%9E%84/image.png"></p>
<ul>
<li><p><em>Memory</em>: It&apos;s used to do two things:</p>
<ol type="1">
<li>Store all the kind of the data that we&apos;re going to use in the
computation</li>
<li>Hold the program as a sequence of instructions that are going to be
executed one by one.</li>
</ol></li>
<li><p><em>CPU</em>: Carry out these instructions, run them and control
everything.</p></li>
</ul>
<p>&#x2003;&#x2003;The detailed CPU instrcture is as below:</p>
<p><img src="/2024/04/05/5-1-%E5%86%AF%C2%B7%E8%AF%BA%E4%BC%8A%E6%9B%BC%E7%BB%93%E6%9E%84/image-1.png"></p>
<ul>
<li><em>ALU</em>: A piece of <strong>hardware</strong> that is able to
add numbers and subtract numbers maybe do logical operations and so
on.</li>
<li>A bunch of <em>Register</em>: <strong>Store data</strong> that we&apos;re
going to use for the rest of computation.</li>
</ul>
<h3 id="2information-flow">2.Information flow</h3>
<h4 id="aintro">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>Intro</h4>
<ul>
<li>The memory itself has two part: the part that <strong>stores the
program</strong> and the part that <strong>stores the
data</strong>.</li>
<li>We can consider these things as <strong>a flow of
data</strong>.</li>
</ul>
<p><img src="/2024/04/05/5-1-%E5%86%AF%C2%B7%E8%AF%BA%E4%BC%8A%E6%9B%BC%E7%BB%93%E6%9E%84/image-2.png"></p>
<p>&#x2003;&#x2003;There are three types of information passed around the system:</p>
<ol type="1">
<li><em>Data</em>: When we do addition, for example, the number needs to
be moved from the data in memory to the other systematic logic unit that
is going to do something with them, and send them back.</li>
<li><em>Address</em>: The data we need to access now lies in
address.</li>
<li><em>Control</em>: It tells each part of the system what to do at
this particular point.</li>
</ol>
<ul>
<li><em>Data bus, address bus and control bus</em>.</li>
</ul>
<h4 id="baluinfo-flow">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>ALU
info flow</h4>
<p><img src="/2024/04/05/5-1-%E5%86%AF%C2%B7%E8%AF%BA%E4%BC%8A%E6%9B%BC%E7%BB%93%E6%9E%84/image-3.png"></p>
<ul>
<li><p><em>Data bus</em>: ALU needs to <strong>have some information
from the data bus</strong>, and then <strong>feeds the output value
back</strong> into the data bus. It&apos;s going to go to other places that
also connect to the data bus, such as memory.</p></li>
<li><p><em>Control bus</em>: ALU needs to know what kind of operation it
dose every time, so it has to get information from the control bus
<strong>specifying the type of operation it does</strong>. On the other
hand, according to the results of the operations it did, it should be
able to <strong>tell other part of the system what to do</strong>.</p>
<ul>
<li>For example, if it sees that a certain number is greater than 0, it
can control the jump to the next instruction.</li>
</ul></li>
</ul>
<h4 id="cregisters">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>Registers</h4>
<p><img src="/2024/04/05/5-1-%E5%86%AF%C2%B7%E8%AF%BA%E4%BC%8A%E6%9B%BC%E7%BB%93%E6%9E%84/image-4.png"></p>
<ul>
<li><p><em>Data bus</em>: The same as ALU.</p></li>
<li><p><em>Address bus</em>: The way we achieve indirect addressing into
a RAM or ROM is <strong>putting number address into a register</strong>
that specifies where we want to access. So we are going to have
registers control a connection to the address bus which controls
memories, and feeds into memory.</p>
<ul>
<li>We&apos;ll have registers either exclusively or both address and data
registers.</li>
</ul></li>
</ul>
<h4 id="dmemory">&#x2003;&#x2003;<span class="math inline">\(d.\)</span>Memory</h4>
<p><img src="/2024/04/05/5-1-%E5%86%AF%C2%B7%E8%AF%BA%E4%BC%8A%E6%9B%BC%E7%BB%93%E6%9E%84/image-5.png"></p>
<ul>
<li>The memory needs to specify what address we are going to work
with.</li>
</ul>
<p><img src="/2024/04/05/5-1-%E5%86%AF%C2%B7%E8%AF%BA%E4%BC%8A%E6%9B%BC%E7%BB%93%E6%9E%84/image-6.png"></p>
<ul>
<li><p>Once we actually work with a certain address, we are going to be
needed to be able to read it or write into it, get information from it
or put information into it. This means we need to be connected to
<em>data bus</em>.</p>
<ul>
<li><p><em>Data memory</em> gets an address of a data piece that needs
to be operated on.</p></li>
<li><p><em>Program memory</em> requires us to <strong>put the address of
the next program instruction into the memory</strong>. We need to be
able to put an address into the program memory, and get instructions
from there.</p>
<ul>
<li>The instructions we get from the program memory may have data as
well. But it&apos;s of great importance that <strong>they tell the rest of
the system what to do</strong>.</li>
<li>We need to be able to take information from the next instruction
from the data output of the program memory and <strong>feed it into the
control bus</strong>.</li>
</ul></li>
</ul></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/05/4-7-%E5%88%86%E6%94%AF%E3%80%81%E5%8F%98%E9%87%8F%E4%B8%8E%E8%BF%AD%E4%BB%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/05/4-7-%E5%88%86%E6%94%AF%E3%80%81%E5%8F%98%E9%87%8F%E4%B8%8E%E8%BF%AD%E4%BB%A3/" class="post-title-link" itemprop="url">4.7.&#x5206;&#x652F;&#xFF0C;&#x53D8;&#x91CF;&#x4E0E;&#x8FED;&#x4EE3;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-05 17:13:54" itemprop="dateCreated datePublished" datetime="2024-04-05T17:13:54+08:00">2024-04-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 16:16:48" itemprop="dateModified" datetime="2024-06-03T16:16:48+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-4-Machine-Language/" itemprop="url" rel="index"><span itemprop="name">Module 4.Machine Language</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>414</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="47branchingvarables-and-iteration"><span class="math inline">\(4.7.\)</span>Branching,Varables and Iteration</h1>
<h3 id="1branching">1.Branching</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">//Computes:if R0&gt;0</span><br><span class="line">//            R1=1</span><br><span class="line">//         else</span><br><span class="line">//            R1=0</span><br><span class="line">@R0</span><br><span class="line">D=M</span><br><span class="line"></span><br><span class="line">@8</span><br><span class="line">D;JGT</span><br><span class="line"></span><br><span class="line">//if D isn&apos;t greater than 0, do this block</span><br><span class="line">@R1</span><br><span class="line">M = 0</span><br><span class="line">@10</span><br><span class="line">0;JMP</span><br><span class="line"></span><br><span class="line">//else, do this</span><br><span class="line">@R1</span><br><span class="line">M = 1</span><br><span class="line"></span><br><span class="line">@10</span><br><span class="line">0;JMP</span><br></pre></td></tr></table></figure>
<ul>
<li><em>Symbolic reference</em>: The above code is correct but
unreadable. Fortunately, we have a nice feature called <em>symbolic
reference</em>. For example, the above code can be rewrited like
this:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@R0</span><br><span class="line">D=M</span><br><span class="line"></span><br><span class="line">@POSITIVE</span><br><span class="line">D;JGT</span><br><span class="line"></span><br><span class="line">@R1</span><br><span class="line">M = 0</span><br><span class="line">@END</span><br><span class="line">@10</span><br><span class="line">0;JMP</span><br><span class="line"></span><br><span class="line">(POSITIVE)</span><br><span class="line">@R1</span><br><span class="line">M = 1</span><br><span class="line"></span><br><span class="line">(END)</span><br><span class="line">@10</span><br><span class="line">0;JMP</span><br></pre></td></tr></table></figure>
<ul>
<li><p>The <code>POSITIVE</code> label appears twice in the code: In the
first place we declare this label, and what we are saying is
<strong>&quot;here is a piece of code that I want to jump to some other place
in the code called <code>POSITIVE</code>&quot;</strong>.</p>
<ul>
<li>LABEL translates to n, where n is the instruction number following
the (LABEL) declaration, in the assembler.</li>
</ul></li>
</ul>
<h3 id="2varables">2.Varables</h3>
<p>&#x2003;&#x2003;In machine language, besides <code>R0</code> and symbolic
reference, we can also set out own <em>varables</em>. For example:
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@R0</span><br><span class="line">D = M</span><br><span class="line">@temp</span><br><span class="line">M = D</span><br><span class="line"></span><br><span class="line">@R1</span><br><span class="line">D = M</span><br><span class="line">@R0</span><br><span class="line">M = D</span><br><span class="line"></span><br><span class="line">@temp</span><br><span class="line">D = M</span><br><span class="line">@R1</span><br><span class="line">M = D</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;The <code>temp</code> is a varable set by ourselves, and we
represent it by using <code>@temp</code>. This kind of naming improve
the readability of our code.</p>
<blockquote>
<p>&#x2003;&#x2003;However, assembly language does not inherently support variables.
Therefore, when we write &quot;<span class="citation" data-cites="temp">@temp</span>&quot;, we are essentially <strong>requesting
the computer to find an available memory register in the memory
unit</strong> and <strong>assume its number to be &quot;n&quot;</strong>, and
then, from now on, <strong>use it to represent what we call the
&quot;variable temp&quot;</strong>.</p>
</blockquote>
<h3 id="3iteration">3.Iteration</h3>
<p>&#x2003;&#x2003;Considering this question: Compute RAM[1] = 1+2+...+RAM[0]. We have
the following pseudo code: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">n = RO</span><br><span class="line">i = 1</span><br><span class="line">sum = 0</span><br><span class="line">LOOP:</span><br><span class="line">if i&gt;n goto STOP</span><br><span class="line">sum = sum + i</span><br><span class="line">i = i + 1</span><br><span class="line">goto LOOP</span><br><span class="line">STOP:</span><br><span class="line">R1 = sum</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;We can implement the pseudo code as below: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">//initialize</span><br><span class="line">@R0</span><br><span class="line">D = M</span><br><span class="line">@n</span><br><span class="line">M = D</span><br><span class="line">@i</span><br><span class="line">M = 1</span><br><span class="line">@sum</span><br><span class="line">M = 0</span><br><span class="line"></span><br><span class="line">//computing</span><br><span class="line">(LOOP)</span><br><span class="line">	@i</span><br><span class="line">	D = M</span><br><span class="line">	@n</span><br><span class="line">	M = M - D</span><br><span class="line">	//the if clause</span><br><span class="line">	@STOP</span><br><span class="line">	D;JGT</span><br><span class="line"></span><br><span class="line">	@sum </span><br><span class="line">	D = M</span><br><span class="line">	@i</span><br><span class="line">	D = D + M</span><br><span class="line">	@sum</span><br><span class="line">	M = D</span><br><span class="line">	@i</span><br><span class="line">	M = M + 1</span><br><span class="line">	@LOOP</span><br><span class="line">	0;JMP</span><br><span class="line"></span><br><span class="line">(STOP)</span><br><span class="line">	@sum</span><br><span class="line">	D = M</span><br><span class="line">	@R1</span><br><span class="line">	M = D</span><br><span class="line"></span><br><span class="line">(END)</span><br><span class="line">	@END</span><br><span class="line">	0;JMP</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;We may take the process to lessen our burden with writing loop:</p>
<ol type="1">
<li>First write in pseudo code.</li>
<li>Debug your pseudo code.</li>
<li>Translating the pseudo code into machine language.</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/05/4-6-%E5%AF%84%E5%AD%98%E5%99%A8%E4%B8%8E%E5%86%85%E5%AD%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/05/4-6-%E5%AF%84%E5%AD%98%E5%99%A8%E4%B8%8E%E5%86%85%E5%AD%98/" class="post-title-link" itemprop="url">4.6.&#x5BC4;&#x5B58;&#x5668;&#x4E0E;&#x5185;&#x5B58;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-05 12:34:04" itemprop="dateCreated datePublished" datetime="2024-04-05T12:34:04+08:00">2024-04-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 16:16:48" itemprop="dateModified" datetime="2024-06-03T16:16:48+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-4-Machine-Language/" itemprop="url" rel="index"><span itemprop="name">Module 4.Machine Language</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>110</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="46working-with-register-and-memory"><span class="math inline">\(4.6.\)</span>Working with register and memory</h1>
<h3 id="1operations-towards-d">1.Operations towards D</h3>
<ul>
<li><p>Storing value: It turns out that there&apos;s no direct way to do it,
we have to do it indirectly. For example, if we want to store 10 in
register D: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@10</span><br><span class="line">D = A</span><br></pre></td></tr></table></figure></p></li>
<li><p>Incresing value: We can use C instructions directly:
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D = D + 1</span><br></pre></td></tr></table></figure></p></li>
<li><p>Setting D to RAM value: It&apos;s similar to storing value:
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@10</span><br><span class="line">D = M</span><br></pre></td></tr></table></figure></p></li>
</ul>
<h3 id="2usage-of-d-register">2.Usage of D register</h3>
<p>&#x2003;&#x2003;D register is of great importance in assignment operations:
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//set RAM[10] to 5</span><br><span class="line">@5</span><br><span class="line">D = A</span><br><span class="line">@10</span><br><span class="line">M = D</span><br><span class="line"></span><br><span class="line">//set RAM[10] to RAM[5]</span><br><span class="line">@ 5</span><br><span class="line">D = M</span><br><span class="line">@10</span><br><span class="line">M = D</span><br></pre></td></tr></table></figure></p>
<h3 id="3built-in-symbol">3.Built-in symbol</h3>
<p><img src="/2024/04/05/4-6-%E5%AF%84%E5%AD%98%E5%99%A8%E4%B8%8E%E5%86%85%E5%AD%98/image.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/05/4-5-%E8%BE%93%E5%85%A5%E4%B8%8E%E8%BE%93%E5%87%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/05/4-5-%E8%BE%93%E5%85%A5%E4%B8%8E%E8%BE%93%E5%87%BA/" class="post-title-link" itemprop="url">4.5.&#x8F93;&#x5165;&#x4E0E;&#x8F93;&#x51FA;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-05 10:23:14" itemprop="dateCreated datePublished" datetime="2024-04-05T10:23:14+08:00">2024-04-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 16:16:48" itemprop="dateModified" datetime="2024-06-03T16:16:48+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-4-Machine-Language/" itemprop="url" rel="index"><span itemprop="name">Module 4.Machine Language</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>524</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="45inputand-output"><span class="math inline">\(4.5.\)</span>Input
and Output</h1>
<h3 id="1-output">1. Output</h3>
<h4 id="adisplay">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>Display</h4>
<ul>
<li>The most important player in manipulating the display element is
called <em>screen memory map</em>.</li>
<li>It is a designated area which is part of the data memory(RAM).</li>
<li>The physical display unit is continuously refreshed from the
contents of the memory map, and this happens many times each second. in
the next refresh cycle,what is changed in the memory is going to be
reflected on the screen.</li>
</ul>
<p><img src="/2024/04/05/4-5-%E8%BE%93%E5%85%A5%E4%B8%8E%E8%BE%93%E5%87%BA/image.png"></p>
<h4 id="bscreen-memory-map">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Screen memory map</h4>
<p>&#x2003;&#x2003;Our display unit looks like this:</p>
<p><img src="/2024/04/05/4-5-%E8%BE%93%E5%85%A5%E4%B8%8E%E8%BE%93%E5%87%BA/image-1.png"></p>
<p>&#x2003;&#x2003;It&apos;s a <em>table</em>, or a <em>matrix</em>, consisting of 256 rows
and 512 columns. And in each intersection of a row and a column, we have
what is known as a <em>pixel</em>. This is a black and white screen, so
we can either turn the pixel on or we can turn it off.</p>
<p>&#x2003;&#x2003;We can use out screen memory map to manipulate it, which looks like
this:</p>
<p><img src="/2024/04/05/4-5-%E8%BE%93%E5%85%A5%E4%B8%8E%E8%BE%93%E5%87%BA/image-2.png"></p>
<ul>
<li><p>It&apos;s a sequense of 16-bit values. Each one of these values is
called <em>word</em>.</p></li>
<li><p>For every pixel on the physical display unit, we have a bit that
represents this pixel in the screen memory map. If I want to turn on
this pixel, I put 1 in this bit, if I want to turn it off,I put 0 in
this bit.</p></li>
<li><p>To set <code>pixel(row, col)</code>on/off:</p>
<ol type="1">
<li><p><code>word = Screen[row*32 + col/16]</code></p>
<ul>
<li><strong>We cannot access individual bits</strong>.If we want to
access an individual bit, we have to first figure out <strong>in which
word this bit resides</strong>. And then I have to retrieve the entire
word, manipulate this particular bit and finally write it back into
memory.</li>
</ul></li>
<li><p><code>word = RAM[16384 + row*32 + col/16]</code></p>
<ul>
<li>If we access the <strong>screen chip</strong>, we simply use <span class="math inline">\(row\times 32+{col\over 16}\)</span>. But if we
access the <strong>OVERALL RAM</strong>, we have to take this
<strong>relative address</strong> and add it to the <strong>base
address</strong> of the memory of the memory map in the overall memory,
which happens to be 16384.</li>
</ul></li>
<li><p>Set <code>col%16</code> bit of <code>word</code> to 0 or
1</p></li>
<li><p>Commit <code>word</code> to the RAM</p></li>
<li><ol type="1">
<li>and (4) are done using 16-bit RAM access operations.</li>
</ol></li>
</ol></li>
</ul>
<h3 id="2input">2.Input</h3>
<h4 id="akeyboard">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>Keyboard</h4>
<ul>
<li>The physical keyboard is connected to the computer using a cable. If
you will trace this cable, you will see that it goes into <strong>an
area in the RAM</strong> which is called <em>keyboard memory
map</em>.</li>
</ul>
<h4 id="bkeyboard-memory-map">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Keyboard memory map</h4>
<ul>
<li>Keyboard memory map is a single 16-bit register:</li>
</ul>
<p><img src="/2024/04/05/4-5-%E8%BE%93%E5%85%A5%E4%B8%8E%E8%BE%93%E5%87%BA/image-3.png"></p>
<ul>
<li><p>When a key is pressed on the keyboard, the key&apos;s
<strong>scan-code</strong>, which is an agreed-upon value, travels
through the cable and appears in the keyboard memory map.</p>
<ul>
<li><span class="math inline">\(e.g.\)</span> If I press &apos;K&apos;, 75 is
going to appear in its binary manifestation in the in the keyboard
chip.</li>
</ul></li>
</ul>
<p><img src="/2024/04/05/4-5-%E8%BE%93%E5%85%A5%E4%B8%8E%E8%BE%93%E5%87%BA/image-4.png"></p>
<ul>
<li><p>if you want to check if which key is currently pressed, all we
have to do is <strong>probe the contents of the keyboard
chip</strong>.</p>
<ul>
<li>In Hack computer, We probe the contents of RAM in address 24576, for
this is where the keyboard memory map happens to reside.</li>
</ul></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/05/4-4-Hack%E8%AF%AD%E8%A8%80%E8%A7%84%E8%8C%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/05/4-4-Hack%E8%AF%AD%E8%A8%80%E8%A7%84%E8%8C%83/" class="post-title-link" itemprop="url">4.4.Hack&#x8BED;&#x8A00;&#x89C4;&#x8303;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-05 08:33:24" itemprop="dateCreated datePublished" datetime="2024-04-05T08:33:24+08:00">2024-04-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 16:16:26" itemprop="dateModified" datetime="2024-06-03T16:16:26+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-4-Machine-Language/" itemprop="url" rel="index"><span itemprop="name">Module 4.Machine Language</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>99</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="44hack-language-specification"><span class="math inline">\(4.4.\)</span>Hack Language Specification</h1>
<h3 id="1the-binary-syntax-for-ainstruction">1.The binary syntax for A
instruction</h3>
<ul>
<li><p>The first zero of a binary number is called <em>operate code</em>
in HL.</p></li>
<li><p>Syntax: Starts with <code>0</code>, and the <code>value</code> is
less or equal than <span class="math inline">\(2^{15}-1\)</span>.</p>
<ul>
<li>For example: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//set A register to 21</span><br><span class="line">0000000000010101</span><br></pre></td></tr></table></figure></li>
</ul></li>
</ul>
<h3 id="2the-binary-syntax-for-cinstruction">2.The binary syntax for C
instruction</h3>
<p>&#x2003;&#x2003;The binary syntax correspond to symbolic syntax is as below:</p>
<p><img src="/2024/04/05/4-4-Hack%E8%AF%AD%E8%A8%80%E8%A7%84%E8%8C%83/image.png"></p>
<ul>
<li>The <code>comp</code> mapping table from symbolic to binary is as
below:</li>
</ul>
<p><img src="/2024/04/05/4-4-Hack%E8%AF%AD%E8%A8%80%E8%A7%84%E8%8C%83/image-1.png"></p>
<ul>
<li>The <code>dest</code> mapping table from symbolic to binary is as
below:</li>
</ul>
<p><img src="/2024/04/05/4-4-Hack%E8%AF%AD%E8%A8%80%E8%A7%84%E8%8C%83/image-2.png"></p>
<ul>
<li>The <code>jump</code> mapping table from symbolic to binary is as
below:</li>
</ul>
<p><img src="/2024/04/05/4-4-Hack%E8%AF%AD%E8%A8%80%E8%A7%84%E8%8C%83/image-3.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/05/3-4-%E8%AE%A1%E6%95%B0%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/05/3-4-%E8%AE%A1%E6%95%B0%E5%99%A8/" class="post-title-link" itemprop="url">3.4.&#x8BA1;&#x6570;&#x5668;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-05 08:25:29" itemprop="dateCreated datePublished" datetime="2024-04-05T08:25:29+08:00">2024-04-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-04 09:19:14" itemprop="dateModified" datetime="2024-06-04T09:19:14+08:00">2024-06-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-3-Memory/" itemprop="url" rel="index"><span itemprop="name">Module 3.Memory</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>44</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="34counter"><span class="math inline">\(3.4.\)</span>Counter</h1>
<h3 id="1counter-intro">1.Counter intro</h3>
<p>&#x2003;&#x2003;A counter is used to direct certain instruction among instructions.
It contains these features:</p>
<ul>
<li><code>Reset</code>: Fetch the first instruction.</li>
<li><code>Next</code>: Fetch the next instruction.</li>
<li><code>Goto</code>: Fetch instruction n.</li>
</ul>
<p>&#x2003;&#x2003; Its &quot;black box&quot; diagram looks like this:</p>
<p><img src="/2024/04/05/3-4-%E8%AE%A1%E6%95%B0%E5%99%A8/image.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/04/3-3-%E5%AD%98%E5%82%A8%E5%8D%95%E5%85%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/04/3-3-%E5%AD%98%E5%82%A8%E5%8D%95%E5%85%83/" class="post-title-link" itemprop="url">3.3.&#x5B58;&#x50A8;&#x5355;&#x5143;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-04 20:19:31" itemprop="dateCreated datePublished" datetime="2024-04-04T20:19:31+08:00">2024-04-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 16:15:36" itemprop="dateModified" datetime="2024-06-03T16:15:36+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-3-Memory/" itemprop="url" rel="index"><span itemprop="name">Module 3.Memory</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>364</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="33memoryunits"><span class="math inline">\(3.3.\)</span>Memory
Units</h1>
<h3 id="1from-1-bit-to-register">1.From 1-bit to register</h3>
<p>&#x2003;&#x2003;the previous unit ended up with a description of how&#xA0;a single bit
register works.&#xA0;And it doesn&apos;t take a big stretch of imagination to
understand that you&#xA0;can <strong>take several such one bit register and
put them one next to the other</strong>.&#xA0;And by doing this, you can
create <em>an abstraction of a 16-bit number</em>.</p>
<p><img src="/2024/04/04/3-3-%E5%AD%98%E5%82%A8%E5%8D%95%E5%85%83/image.png"></p>
<ul>
<li>The <strong>width</strong> of the register, in general, is a
parameter called <span class="math inline">\(w\)</span>.&#xA0;In some
computers it&apos;s 16-bit,&#xA0;in other computers it may be 32-bits or
64-bit.</li>
<li>The register&apos;s <strong>state</strong> refers to the value which is
currently stored in the register.</li>
</ul>
<p>&#x2003;&#x2003;let&apos;s take a user&apos;s perspective of this of this device:</p>
<ul>
<li>How do we <strong>read</strong> the value of this register? We
simply probe the output. Because at any given point of time, the output
simply emits the state of the register.</li>
<li>How do we <strong>write</strong> the value of this register? We set
<code>in</code> to the new value <span class="math inline">\(v\)</span>,
and set <code>load</code> to 1, then the register state becomes 1.</li>
<li>And from the next cycle onward,&#xA0;the output of the register will also
start emitting this value <span class="math inline">\(v\)</span>.&#xA0;From
the next cycle onward,&#xA0;the register will effectively store the value
<span class="math inline">\(v\)</span>. And it will keep on storing this
value forever until we decide to change&#xA0;this value in the very same
manner.</li>
</ul>
<h3 id="2ram">2.RAM</h3>
<p>&#x2003;&#x2003;A RAM can be abstracted as a sequence of n addressable registers,
with addresses from 0 to n-1:</p>
<p><img src="/2024/04/04/3-3-%E5%AD%98%E5%82%A8%E5%8D%95%E5%85%83/image-1.png"></p>
<ul>
<li>There&apos;s one thing very important to emphasize: at any given point
of&#xA0;time, <strong>only one register is selected and only one register is
working</strong>, all the other registers don&apos;t take any part in the
game.</li>
</ul>
<p>&#x2003;&#x2003;Given this fact, we have to say <strong>which is the register on
which we want to operate</strong>, <strong>which is the register that we
want to read</strong>, or <strong>which is the register whose value we
want to change</strong>.</p>
<ul>
<li><p>To <strong>read</strong> a particular register, we:</p>
<ol type="1">
<li>Sent the address to RAM.</li>
<li>Probe the output.</li>
</ol></li>
<li><p>To <strong>write</strong> a particular register, we:</p>
<ol type="1">
<li>Sent the address to RAM.</li>
<li>Set the value and <code>load</code>.</li>
</ol></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/04/3-2-%E8%A7%A6%E5%8F%91%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/04/3-2-%E8%A7%A6%E5%8F%91%E5%99%A8/" class="post-title-link" itemprop="url">3.2.&#x89E6;&#x53D1;&#x5668;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-04 17:29:11" itemprop="dateCreated datePublished" datetime="2024-04-04T17:29:11+08:00">2024-04-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 16:15:36" itemprop="dateModified" datetime="2024-06-03T16:15:36+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-3-Memory/" itemprop="url" rel="index"><span itemprop="name">Module 3.Memory</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>475</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="32flipflops"><span class="math inline">\(3.2.\)</span>Flip
Flops</h1>
<h3 id="1clocked-data-flip-flops">1.Clocked Data Flip Flops</h3>
<p>&#x2003;&#x2003;To implement the sequential logic, we need an element that
<em>remember one bit of information from <span class="math inline">\(t-1\)</span> so that it can be used at time <span class="math inline">\(t\)</span></em>. It remembers by &quot;flipping&quot;
between the possible states. Such gates that can flip between two states
are called <em>Flip Flop</em>:</p>
<p><img src="/2024/04/04/3-2-%E8%A7%A6%E5%8F%91%E5%99%A8/image.png"></p>
<p>&#x2003;&#x2003;Take the clock below as example:</p>
<p><img src="/2024/04/04/3-2-%E8%A7%A6%E5%8F%91%E5%99%A8/image-1.png"></p>
<ul>
<li>At time 1, we don&apos;t exactly know what our output will be because we
haven&apos;t&#xA0;specified what happened in the previous time unit. So we just
don&apos;t know what the output is.</li>
<li>At time 2, the output is exactly what the input was in time 1,
<code>1</code>.</li>
<li>......</li>
</ul>
<h3 id="2sequential-logicimplementation">2.Sequential logic
implementation</h3>
<p>&#x2003;&#x2003;Here is a generic paradigm of how we&apos;re going to build&#xA0;all our
logic in the computer, and it&apos;s going to be a combination
of&#xA0;<em>remembering information via this basic D flip flops</em> and then
<em>manipulating them using combinatorial logics</em>:</p>
<p><img src="/2024/04/04/3-2-%E8%A7%A6%E5%8F%91%E5%99%A8/image-2.png"></p>
<ul>
<li>We have an array of D flip flops&#xA0;which basically compromise all of
our memory in the system.</li>
<li>Their output is going to be fed into some combinatorial
logic&#xA0;together with the new input that you get in this time unit.</li>
<li>All of this is going to change the state that we have in the D flip
flop for&#xA0;the next time unit.</li>
</ul>
<h3 id="31-bit-register">3.1-bit Register</h3>
<p>&#x2003;&#x2003;The 1-bit Register has these functionalities:</p>
<ul>
<li>Once we take the load bit and&#xA0;put the 1 into it, we want it
<strong>remember the input bit at that time</strong>.</li>
<li>When the load bit goes down to 0 we want it <strong>keep remembering
the last input that was loaded into it for&#xA0;infinity, until a new load
operation is performed</strong>.</li>
</ul>
<p><img src="/2024/04/04/3-2-%E8%A7%A6%E5%8F%91%E5%99%A8/image-3.png"></p>
<p>&#x2003;&#x2003;Notice that there are two source into the DFF: one is the output
from the previous stage, the other is the new input. Whether source to
be chosen is decided by <code>load</code>, so we may use a
<code>Mux</code> to solve this:</p>
<p><img src="/2024/04/04/3-2-%E8%A7%A6%E5%8F%91%E5%99%A8/image-4.png"></p>
<ul>
<li>The DFF serves the purpose of storing and maintaining the previous
input value in this process. When the load bit is set to 1, the DFF
<strong>stores the input value and holds it unchanged until the next
load operation</strong>. When the load bit is 0, the DFF
<strong>maintains the value from the previous load and continues to
output this value in the next time</strong> unit until a new load
operation occurs. Therefore, the DFF is essentially used to remember and
sustain the state of the input value.</li>
<li><strong>The final output is determined by the multiplexer
(Mux)</strong>. The DFF is responsible for storing the previously loaded
value and sending it to the multiplexer based on the state of the load
bit. The multiplexer <strong>selects whether to accept the new input
value or the previously loaded value based on the load bit&apos;s
status</strong>, and then outputs the selected value.</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/04/4-2-%E6%9C%BA%E5%99%A8%E8%AF%AD%E8%A8%80%E7%BB%84%E6%88%90%E5%85%83%E7%B4%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/04/4-2-%E6%9C%BA%E5%99%A8%E8%AF%AD%E8%A8%80%E7%BB%84%E6%88%90%E5%85%83%E7%B4%A0/" class="post-title-link" itemprop="url">4.2.&#x673A;&#x5668;&#x8BED;&#x8A00;&#x7EC4;&#x6210;&#x5143;&#x7D20;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-04 17:14:31" itemprop="dateCreated datePublished" datetime="2024-04-04T17:14:31+08:00">2024-04-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 16:16:48" itemprop="dateModified" datetime="2024-06-03T16:16:48+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-4-Machine-Language/" itemprop="url" rel="index"><span itemprop="name">Module 4.Machine Language</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>809</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>3 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="42the-elements-of-machine-language"><span class="math inline">\(4.2.\)</span>The Elements of Machine Language</h1>
<h3 id="1machine-language">1.Machine language</h3>
<ul>
<li><p>The machine language is a most important <em>interface between
hardware and software</em>. It&apos;s exactly the way software can control
hardware.</p>
<ul>
<li>What are the supported operations?</li>
<li>What do they operate on?</li>
<li>How is the program controlled?</li>
</ul></li>
<li><p>This kind of interface is done in a almost one-to-one
correspondence with the actual hardware implementation. The idea is that
the hardware is built in a way that directly corresponds to <em>the type
of functionality that is provided by the software layer above
it</em>.</p></li>
<li><p>When we actually go to design a machine language, the basic
element is a <em>cost-performance tradeoff</em>. The more sophisticated
operations that we want to give our machine language, the more <em>large
or sophisticated data types</em> it operates on, the more
<em>costly</em> it will be to actually build this.</p></li>
<li><p>Each machine language defines a set of operations which fall into
several categories:</p>
<ul>
<li><strong>Arithmetic Operations</strong>: add, subtract, ...</li>
<li><strong>Logical Operations</strong>: <code>And</code>,
<code>Or</code>, ...</li>
<li><strong>Flow Control</strong>: <code>goto instructionX</code>,
<code>if C then goto instruction Y</code></li>
</ul></li>
</ul>
<h3 id="2memory">2.Memory</h3>
<ul>
<li><p>accessing memory is an expensive operation in at least two
related points of view :</p>
<ol type="1">
<li>If you have a large memory, specifying what part of memory you want
to work with requires a large amount of bits.</li>
<li>It&apos;s going to be wasteful in terms of instruction, for accessing a
value from a large memory takes relatively long time.</li>
</ol></li>
</ul>
<p>&#x2003;&#x2003;To solve this, we introduce memory hierarchy*:</p>
<ul>
<li><p>The basic idea is instead of having just one large block of
memory, we&apos;re going to have a whole sequence of memories that
<strong>are getting bigger and bigger</strong>.</p>
<ul>
<li><p>The smallest memories are going to be very easy to access.
Because:</p>
<ol type="1">
<li>We don&apos;t have to specify large address space because there are only
going to be a very few of them.</li>
<li>The amount of them is small, so we can get information from them
very quickly.</li>
</ol></li>
<li><p>Then, there is going to be slight larger memories called
<em>cache</em>.</p></li>
<li><p>And even big memory, called <em>main memory</em>.</p></li>
<li><p>And maybe even even larger memory called <em>disk</em>.</p></li>
</ul></li>
</ul>
<p><img src="/2024/04/04/4-2-%E6%9C%BA%E5%99%A8%E8%AF%AD%E8%A8%80%E7%BB%84%E6%88%90%E5%85%83%E7%B4%A0/image.png"></p>
<ul>
<li>At each time we get farther away from the arithmetic unit itself,
our memory gets bigger, accessing it becomes harder both in terms of
giving a larger, wider address, and in terms of the time we need to wait
until we get the value. But we have more information there.</li>
</ul>
<h3 id="3registers">3.Registers</h3>
<ul>
<li><p>Almost every CPU has a few <em>easy-accessed registers</em> that
are located inside the CPU. Since there are so few of them and
everything requires very few bits, getting the information of them is
extremely quickly.</p></li>
<li><p>There are two kinds of register:</p>
<ol type="1">
<li><p><em>Data Registers</em>: We can put numbers, etc, in the
register. And when we are saying something like add the register 1 to
register 2, what will happen is <strong>the contents of register
1</strong> will be added to <strong>the contents of register
2</strong>.</p></li>
<li><p><em>Address Register</em>: We can put into the register an
address into main memory. It allow us to specify at which part of the
bigger memory we want to access for operations.</p>
<ul>
<li>For example, say we have a operation like storing the contents of
register 1 into memory address that is specified by that register called
A. Once we actually perform this operation in the hardware, the number
77 will be written into the main memory.</li>
</ul></li>
</ol></li>
</ul>
<p><img src="/2024/04/04/4-2-%E6%9C%BA%E5%99%A8%E8%AF%AD%E8%A8%80%E7%BB%84%E6%88%90%E5%85%83%E7%B4%A0/image-1.png"></p>
<h3 id="4addressing-modes">4.Addressing modes</h3>
<ul>
<li><em>Register</em>: <span class="math inline">\(e.g.\)</span><code>Add R1 R2</code> means adding
R2 to R1.</li>
<li><em>Direct</em>: We can have direct access to memory.<span class="math inline">\(e.g.\)</span> <code>Add R1 M[200]</code> means
adding R1 to memory location <code>200</code>.</li>
<li><em>Indirect</em>: This is a example we had previously for using the
A register where the <code>@A</code> memory address that we access is
not specified as part of instruction, but rather is already written
inside <em>the address register</em> that <strong>was previously loaded
inside the CPU with some correct value</strong>.<span class="math inline">\(e.g.\)</span> <code>Add R1 @A</code></li>
<li><em>Immediate</em>: <span class="math inline">\(e.g.\)</span>
<code>Add R1 73</code></li>
</ul>
<h3 id="5dealing-with-input-andoutput">5.Dealing with input and
output</h3>
<ul>
<li><p>One way to actually access these input or output
devices(keyboard, for example) is to actually <strong>connect the
registers which control these output devices as part of your
memory</strong>.</p>
<ul>
<li>For example, we may have a mouse that is connected in a way that
whenever the user moves the mouse, the last movement is written into
some kind of a register. And that register is accessible by the computer
in a certain address as part of the memory. This gives us access to
input and output as though we are accessing the memory itself.</li>
</ul></li>
<li><p>Software are usually part of the <strong>drivers</strong> in an
operating system. It must know exactly not only <strong>what are the
addresses to which this input or output device is connected</strong>,but
also <strong>how to speak with it</strong>.</p></li>
</ul>
<h3 id="6flow-control">6.Flow control</h3>
<ul>
<li>Sometimes we need to &quot;jump&quot; unconditionally to another location, for
example:</li>
</ul>
<p><img src="/2024/04/04/4-2-%E6%9C%BA%E5%99%A8%E8%AF%AD%E8%A8%80%E7%BB%84%E6%88%90%E5%85%83%E7%B4%A0/image-2.png"></p>
<ul>
<li>Sometimes we need to jump only if some condition is met, for
example:</li>
</ul>
<p><img src="/2024/04/04/4-2-%E6%9C%BA%E5%99%A8%E8%AF%AD%E8%A8%80%E7%BB%84%E6%88%90%E5%85%83%E7%B4%A0/image-3.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/04/4-3-%E6%9C%BA%E5%99%A8%E8%AF%AD%E8%A8%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/04/4-3-%E6%9C%BA%E5%99%A8%E8%AF%AD%E8%A8%80/" class="post-title-link" itemprop="url">4.3.&#x673A;&#x5668;&#x8BED;&#x8A00;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-04 17:14:31" itemprop="dateCreated datePublished" datetime="2024-04-04T17:14:31+08:00">2024-04-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 16:16:28" itemprop="dateModified" datetime="2024-06-03T16:16:28+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-4-Machine-Language/" itemprop="url" rel="index"><span itemprop="name">Module 4.Machine Language</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>468</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="43machine-language"><span class="math inline">\(4.3.\)</span>Machine Language</h1>
<h3 id="1background-knowledge-ofhack-computer">1.Background knowledge of
Hack Computer</h3>
<h4 id="ahardware">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>Hardware</h4>
<p><img src="/2024/04/04/4-3-%E6%9C%BA%E5%99%A8%E8%AF%AD%E8%A8%80/image.png"></p>
<ul>
<li><em>Data memory</em>(RAM): It is a sequence of 16-bit values.And
each of these values is going to be stored in a memory register</li>
<li><em>Instruction memory(ROM)</em>: It is a separate memory space that
is also a sequence of 16 bit values.</li>
<li><em>CPU</em>: It is a device which is capable of
<strong>manipulating 16 bit values</strong> using mostly the ALU which
resides inside the CPU.</li>
<li><em>Instruction buses, data buses, address buses</em>: It enables us
to move data from one place to another.</li>
</ul>
<p>&#x2003;&#x2003;The Hack machine language recognizes three registers:</p>
<ul>
<li>D holds a 16-bit value</li>
<li>A holds a 16-bit value</li>
<li>M represents the 16-bit RAM register addressed by A</li>
</ul>
<h4 id="blanguage">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Language</h4>
<ul>
<li><p>The Hack machine language includes:</p>
<ul>
<li>16-bit A-instructions</li>
<li>16-bit C-instructions</li>
</ul></li>
</ul>
<h4 id="cregister">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>Register</h4>
<p>&#x2003;&#x2003;The hack computer recognizes three registers:</p>
<ol type="1">
<li><em>D register</em>: It holds a 16-bit data which represent a piece
of <strong>data</strong>.</li>
<li><em>A register</em>: It holds a 16-bit data which represent either a
<strong>data value</strong> or an <strong>address</strong>.</li>
<li><em>M register</em>. It is called <strong>selected memory
register</strong>.</li>
</ol>
<h3 id="2syntax">2.Syntax</h3>
<h4 id="aainstruction">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>A
instruction</h4>
<ul>
<li><p>Syntax: <code>@value</code>, value is either:</p>
<ul>
<li>a non-negative decimal constant or</li>
<li>a symbol referring to such a constant</li>
</ul></li>
<li><p>Semantics:</p>
<ol type="1">
<li>Sets the A register to value</li>
<li>Side effect: RAM[A]becomes the selected RAM register.</li>
</ol></li>
<li><p>We always need A instruction before we operate on the
memory.</p></li>
</ul>
<p>&#x2003;&#x2003;<span class="math inline">\(e.g.\)</span> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//set RAM[100] to -1</span><br><span class="line">@100 //A = 100</span><br><span class="line">M = -1 //RAM[100] = -1, M denotes register number 100 in the memory unit</span><br></pre></td></tr></table></figure> ####
&#x2003;&#x2003;<span class="math inline">\(b.\)</span>C instruction</p>
<ul>
<li><p>syntax:`dest=comp; jump.</p></li>
<li><p><code>comp</code> contains:<code>0</code>, <code>1</code>,
<code>-1</code>, <code>D</code>, <code>A</code>, <code>-D</code>,
<code>!A</code>, <code>D-A</code>, <code>D+1</code>, <code>D-M</code>,
etc.</p></li>
<li><p><code>dest</code>: We have 8 possible
destination:<code>null</code>, <code>D</code>, <code>M</code>,
<code>MD</code>, <code>A</code>, <code>AM</code>, <code>AD</code>,
<code>AMD</code>(<code>M</code> refers to RAM)</p>
<ul>
<li><code>null</code> means we don&apos;t want to to store the results of a
computation at all.</li>
<li>We can store the result in RAM register or D-register and
simultaneously both in M and in D. That is, we can simultaneously in
more than one containers, and the programmer is free to use any he
wants.</li>
<li><code>jump</code>: <code>null</code>, <code>JGT</code>,
<code>JEQ</code>, <code>JGE</code>, <code>JLT</code>, <code>JNE</code>,
<code>JLE</code>,<code>JMP</code>. They always compare the result of the
computation to 0. And <code>if (comp jump 0)</code> jumps to execute the
instruction in RAM[A].<br>
</li>
<li>If we want to do unconditional jump, we do <code>0; JMP</code>.</li>
</ul></li>
<li><p>Semantics:</p>
<ol type="1">
<li>Compute the value of comp</li>
<li>Stores the result in dest:</li>
<li>If the Boolean expression (comp jump B)is true,</li>
<li>jumps to execute the instruction stored in ROM[A].</li>
</ol></li>
</ul>
<p>&#x2003;&#x2003;<span class="math inline">\(e.g.\)</span> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//if (D-1==0) jump to execute the instruction stored in ROM[56]</span><br><span class="line">@56</span><br><span class="line">D-1; JEQ</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/04/3-1-%E6%97%B6%E5%BA%8F%E9%80%BB%E8%BE%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/04/3-1-%E6%97%B6%E5%BA%8F%E9%80%BB%E8%BE%91/" class="post-title-link" itemprop="url">3.1.&#x65F6;&#x5E8F;&#x903B;&#x8F91;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-04 15:23:21" itemprop="dateCreated datePublished" datetime="2024-04-04T15:23:21+08:00">2024-04-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 16:15:36" itemprop="dateModified" datetime="2024-06-03T16:15:36+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-3-Memory/" itemprop="url" rel="index"><span itemprop="name">Module 3.Memory</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>573</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="31sequential-logic"><span class="math inline">\(3.1.\)</span>Sequential Logic</h1>
<h3 id="1background">1.Background</h3>
<p>&#x2003;&#x2003;In the previous chapter, we&apos;ve completely ignored the issue of
time:</p>
<ul>
<li><p><strong>Everything happened immediately</strong>, there were
inputs and&#xA0;immediately the outputs were some function of them.</p></li>
<li><p><strong>The inputs never change</strong>, we didn&apos;t have any
notion of change.</p></li>
<li><p>We didn&apos;t have any notion of things <strong>happening one thing
after another</strong>. Just was some kind of logical mapping from
inputs to outputs.</p></li>
</ul>
<p>&#x2003;&#x2003;So, there are two things that we want to complement:</p>
<ol type="1">
<li><p>Be able to&#xA0;use the same hardware to <strong>compute many things
one time after another</strong>. We need to be able to reuse our
hardware.</p>
<ul>
<li>For example, if we take some kind of loop in a hard,&#xA0;in a, in some
kind of software program, that the loop calls for doing the same&#xA0;thing
many times, we want to be able to use a same hardware to do that.</li>
</ul></li>
<li><p><strong>Remember things from the past</strong>.When we need to
remember intermediate results,we need to remember where we are in a
computation.</p></li>
</ol>
<h3 id="2the-clock">2.The clock</h3>
<p>&#x2003;&#x2003;What we&apos;re going to do is to <strong>convert the continuous
physical time into discrete time</strong>.</p>
<p>&#x2003;&#x2003;To do this, we&apos;re going to have a <em>clock</em>:</p>
<ul>
<li>It is some kind of <em>oscillator going up and down at a certain
fixed rate</em>.</li>
<li>Each cycle of the clock is treated as one <em>digital integer time
unit</em>.</li>
</ul>
<p><img src="/2024/04/04/3-1-%E6%97%B6%E5%BA%8F%E9%80%BB%E8%BE%91/image.png"></p>
<ul>
<li><p>With each time unit, we are going to deal it as a indivisible
thing. <em>Nothing changes in a time unit</em>.</p></li>
<li><p>In a time unit, it will compute the output from the input <em>in
an instantaneous manner</em>.</p></li>
</ul>
<h3 id="3delay">3.Delay</h3>
<p>&#x2003;&#x2003;However, for a physical signal, it doesn&apos;t change instantaneously
in a number time between time as we suppose. In reality, the little
course current builds slowly, and the voltage may change slowly. That is
to say, the actual analog signal takes time to reach its final stage,
both input and output.</p>
<p><img src="/2024/04/04/3-1-%E6%97%B6%E5%BA%8F%E9%80%BB%E8%BE%91/image-1.png"></p>
<p>&#x2003;&#x2003;Therefore, we will give ourselves enough time between consecutive
time units. For example, we will give the logical operations <em>at the
end of the grey area</em> to make sure that <em>all the hardware there
really stabilizes:</em></p>
<p><img src="/2024/04/04/3-1-%E6%97%B6%E5%BA%8F%E9%80%BB%E8%BE%91/image-2.png"></p>
<p>&#x2003;&#x2003;And then,we can simply ignore these inconsistencies because
now,whatever happened before the gray area,we don&apos;t need to worry about
it because we know it&apos;s gone by the end of the clock cycle.</p>
<h3 id="4combinatorial-logic">4.Combinatorial logic</h3>
<ul>
<li>Combinatorial logic: It&apos;s a stateless logic, where <em>the output
depends solely on the current input state:</em><span class="math inline">\(out(t)=f(in(t))\)</span>. Our ALU and bool chips
take this logic.</li>
<li>Sequential logic: <span class="math inline">\(out(t)=f(in(t-1))\)</span>.</li>
</ul>
<h3 id="5state-feedback">5.State feedback</h3>
<ul>
<li><p>The sequential logic points out a new way of thinking, which is
to <strong>consider inputs and outputs as the same bits, capable of
being transmitted on the same bus and occupying the same hardware
location</strong>. This design allows us to <strong>feed output values
back to the input</strong>, creating a <strong>state</strong> rather
than simply passing data. Thus, we can use a particular bit in the
circuit to store state information rather than solely transmitting
data.</p></li>
<li><p>This new way of thinking alters our understanding of time.
Instead of viewing time as continuous, we now divide it into discrete
integer time steps and observe the events happening sequentially at each
time step. This approach enables us to <strong>change the state
incrementally</strong>, remembering the result from the previous time
step at each subsequent step and building upon it.</p></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/04/2-4-%E7%AE%97%E6%9C%AF%E9%80%BB%E8%BE%91%E5%8D%95%E5%85%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/04/2-4-%E7%AE%97%E6%9C%AF%E9%80%BB%E8%BE%91%E5%8D%95%E5%85%83/" class="post-title-link" itemprop="url">2.4.&#x7B97;&#x672F;&#x903B;&#x8F91;&#x5355;&#x5143;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-04 10:27:29" itemprop="dateCreated datePublished" datetime="2024-04-04T10:27:29+08:00">2024-04-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 16:15:36" itemprop="dateModified" datetime="2024-06-03T16:15:36+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-2-Boolean-Calculation-ALU/" itemprop="url" rel="index"><span itemprop="name">Module 2.Boolean Calculation &amp; ALU</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>157</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="24arthimetic-logic-unit"><span class="math inline">\(2.4.\)</span>Arthimetic Logic Unit</h1>
<h3 id="1alu-intro">1.ALU intro</h3>
<p>&#x2003;&#x2003;The Arithmetic Logic Unit (ALU) is a crucial component in
computers, responsible for <em>executing various arithmetic and logic
operations</em>. Typically <em>part of the CPU</em>, it handles
arithmetic operations such as addition, subtraction, multiplication, and
division, as well as logic operations including <code>AND</code>,
<code>OR</code>, <code>NOT</code>, and <code>XOR</code>, based on
instructions provided.</p>
<h3 id="2alu-structure">2.ALU structure</h3>
<p>&#x2003;&#x2003;We can describe the ALU through the diagram below:</p>
<p><img src="/2024/04/04/2-4-%E7%AE%97%E6%9C%AF%E9%80%BB%E8%BE%91%E5%8D%95%E5%85%83/image.png"></p>
<ul>
<li><p>The ALU computes a function on the two inputs, and outputs the
result.</p></li>
<li><p><strong>f</strong>:one out of a family of pre-defined arithmetic
and logical functions. It contains:</p>
<ul>
<li>Arithmetic operations:integer addition, multiplication, division,
...</li>
<li>Logical operations: And, Or, Xor....</li>
</ul></li>
</ul>
<blockquote>
<p><span class="math inline">\(p.s.\)</span>There is a interesting
question towards ALU: Which operation should ALU operate? If we choose
to ignore some operation in ALU, when we want to use it, we have to
implement it in the software. This is also called a <em>Hardware and
Software trade off</em>.</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/04/2-3-%E4%BA%8C%E8%BF%9B%E5%88%B6%E8%BF%90%E7%AE%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/04/2-3-%E4%BA%8C%E8%BF%9B%E5%88%B6%E8%BF%90%E7%AE%97/" class="post-title-link" itemprop="url">2.3.&#x4E8C;&#x8FDB;&#x5236;&#x8FD0;&#x7B97;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-04 09:23:25" itemprop="dateCreated datePublished" datetime="2024-04-04T09:23:25+08:00">2024-04-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 16:15:36" itemprop="dateModified" datetime="2024-06-03T16:15:36+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-2-Boolean-Calculation-ALU/" itemprop="url" rel="index"><span itemprop="name">Module 2.Boolean Calculation &amp; ALU</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>335</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="23binary-arithmetic"><span class="math inline">\(2.3.\)</span>Binary Arithmetic</h1>
<h3 id="1negative-numberrepresentation">1.Negative number
representation</h3>
<p>&#x2003;&#x2003;For a negative number <span class="math inline">\(x\)</span>, we
use <span class="math inline">\(2^n - x\)</span> to represent it.</p>
<ul>
<li><span class="math inline">\(e.g.\)</span>-4 is represent as
<code>1100</code> in four-bit binary number, also equal to 16-4=12.</li>
</ul>
<p>&#x2003;&#x2003;In order not to mistake this representation with positive number,
we prescribe that <em>a positive number cannot use the left-most bit to
represent number</em>.</p>
<h3 id="2binary-addition">2.Binary addition</h3>
<p>&#x2003;&#x2003;Before discuss the numerical addition, we first take a look at the
bit-to-bit addition. We use the folloing API to deal with the carry:
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CHIP AddBit {</span><br><span class="line">	IN a, b;</span><br><span class="line">	OUT out, carry;</span><br><span class="line"></span><br><span class="line">	PARTS:</span><br><span class="line">	......</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x2003;&#x2003;After the implementation, for a number, we just need to do
<code>AddBit</code> for each bit of it.</p>
<blockquote>
<p><span class="math inline">\(p.s.:\)</span>How do we deal with the
following 4-bit addition<code>1000 + 1100</code>? &#x2003;&#x2003;The answer is
<code>0100</code>. This is because the left-most bit addition gets a
carry, but it is out of the bit range. This is called <em>integer
overflow</em>. When facing this, the computer will do <span class="math inline">\(\mod 2^n\)</span> to the true result, where <span class="math inline">\(n\)</span> is the bit number.</p>
</blockquote>
<blockquote>
<p><span class="math inline">\(p.s:\)</span>By the <em>integer
overflow</em> theory, we can prove that the <em>simple positive addition
also suits negative numbers</em>.</p>
<p><span class="math inline">\(proof:\)</span>Assume there are two
negative number <span class="math inline">\(x,y\)</span>, they are
represented as <span class="math inline">\(2^n-x,2^n-y\)</span>. Add
them together, and we get <span class="math inline">\(2^{n+1}-x-y\)</span>. The result apparently
overflow the range, so<span class="math inline">\(\mod 2^n\)</span>, and
we get <span class="math inline">\(2^n - x - y\)</span>. This is the
binary representation of <span class="math inline">\(-x-y\)</span>,
<span class="math inline">\(QED\)</span>.</p>
</blockquote>
<h3 id="3binary-subtraction">3.Binary subtraction</h3>
<p>&#x2003;&#x2003;To do subtraction, we just need to add a number&apos;s negation. We know
that <span class="math inline">\(-x\)</span> is represented as <span class="math inline">\(2^n-x\)</span>. Let&apos;s do some transformation
like:</p>
<p><span class="math display">\[(2^n-1)-x+1\]</span></p>
<p>&#x2003;&#x2003;Why this? Notice that <span class="math inline">\(2^n-1\)</span> is
<code>1111</code>, and it&apos;s easy to subtract other number, for carry
will never occur in this instance. For <span class="math inline">\(+1\)</span>, since we have implement addition,
it&apos;s also easy.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/03/1-5-%E7%A1%AC%E4%BB%B6%E6%A8%A1%E6%8B%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/03/1-5-%E7%A1%AC%E4%BB%B6%E6%A8%A1%E6%8B%9F/" class="post-title-link" itemprop="url">1.5.&#x786C;&#x4EF6;&#x6A21;&#x62DF;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-03 16:55:53" itemprop="dateCreated datePublished" datetime="2024-04-03T16:55:53+08:00">2024-04-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 16:14:35" itemprop="dateModified" datetime="2024-06-03T16:14:35+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-1-Boolean-Function/" itemprop="url" rel="index"><span itemprop="name">Module 1.Boolean Function</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>229</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>1 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="15hardware-simulation"><span class="math inline">\(1.5.\)</span>Hardware simulation</h1>
<ol type="1">
<li><p><strong>Interactive Simulation:</strong> We can load an HDL file
into a hardware simulator program, which allows us to interactively test
various operations of the chip. This mode of testing is called
interactive simulation.</p></li>
<li><p><strong>Script-Based Simulation:</strong> Alternatively, we can
write a test script in a special testing language designed for this
purpose. This script outlines predetermined tests, enabling systematic
testing of the chip&apos;s functionality without manual interaction. This
mode is called script-based simulation.</p></li>
<li><p><strong>Output Comparison:</strong> We can record simulation
output to an output file and compare it to a desired output stored in a
compare file. This allows us to validate the chip&apos;s behavior against
expected results. Moreover, we can change our test script to compare
file, so that it can do comparation.</p></li>
</ol>
<ul>
<li><p>Additionally, we&apos;ll discuss the use of compare files, which
enable comparison of simulation outputs with desired results. These
files can be generated through behavioral simulation, where the chip
logic is implemented in high-level languages and tested before HDL
implementation.</p></li>
<li><p><strong>System architect</strong>: They design how to achieve the
functionality, breaking the overall behaviour into smaller chips. They
offer:</p>
<ul>
<li>A chip API</li>
<li>A test script</li>
<li>A compare file</li>
</ul></li>
<li><p><strong>Developer</strong>: You receive stub files documenting
chip interfaces, along with test scripts and compare files prepared by
system architects. Your task will be to write the HDL code to implement
the missing functionality.</p></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/03/1-4-%E7%A1%AC%E4%BB%B6%E6%8F%8F%E8%BF%B0%E8%AF%AD%E8%A8%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/03/1-4-%E7%A1%AC%E4%BB%B6%E6%8F%8F%E8%BF%B0%E8%AF%AD%E8%A8%80/" class="post-title-link" itemprop="url">1.4.&#x786C;&#x4EF6;&#x63CF;&#x8FF0;&#x8BED;&#x8A00;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-03 15:34:23" itemprop="dateCreated datePublished" datetime="2024-04-03T15:34:23+08:00">2024-04-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 16:14:35" itemprop="dateModified" datetime="2024-06-03T16:14:35+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-1-Boolean-Function/" itemprop="url" rel="index"><span itemprop="name">Module 1.Boolean Function</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>506</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="14hardware-description-language"><span class="math inline">\(1.4.\)</span>Hardware description language</h1>
<h3 id="1logic-gate">1.Logic gate</h3>
<ul>
<li>An <em>elementary logic gate</em> is an elementary chip which is
designed to deliver a well-defined functionality.</li>
<li>A <em>composite logic gate</em> is one which is made up from
elementary logic gate and other composite logic gates.</li>
</ul>
<p>&#x2003;&#x2003;The <code>AND</code> gate, <code>OR</code> gate and
<code>NOT</code> gate can be represented by these diagrams:</p>
<p><img src="/2024/04/03/1-4-%E7%A1%AC%E4%BB%B6%E6%8F%8F%E8%BF%B0%E8%AF%AD%E8%A8%80/image.png"></p>
<p><img src="/2024/04/03/1-4-%E7%A1%AC%E4%BB%B6%E6%8F%8F%E8%BF%B0%E8%AF%AD%E8%A8%80/image-1.png"></p>
<p>&#x2003;&#x2003;By connecting the elementary gate together, we can get composite
gates that have more complicated funtionality. For example:</p>
<p><img src="/2024/04/03/1-4-%E7%A1%AC%E4%BB%B6%E6%8F%8F%E8%BF%B0%E8%AF%AD%E8%A8%80/image-2.png"></p>
<h3 id="2hdl">2.HDL</h3>
<h4 id="aintro">&#x2003;&#x2003;<span class="math inline">\(a.\)</span>Intro</h4>
<p>&#x2003;&#x2003;We can actually build and implement the logic gates using a
formalism called <em>Hardware Description Language</em> or HDL. Once you
build a logic gate in HDL,you can actually simulate it, test it.And
finally,build it in hardware.</p>
<p>&#x2003;&#x2003;The hardware description of a logic gate contains these
structure:</p>
<ul>
<li><em>Interface</em>: It describe what the chip takes in as input and
the output.</li>
<li><em>Implementation</em>: It describe how the chip achieves its
functionality.</li>
</ul>
<p>&#x2003;&#x2003;For example the gate below can be describe as :</p>
<p><img src="/2024/04/03/1-4-%E7%A1%AC%E4%BB%B6%E6%8F%8F%E8%BF%B0%E8%AF%AD%E8%A8%80/image-3.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CHIP Xor {</span><br><span class="line">	IN a, b;</span><br><span class="line">	OUT out;</span><br><span class="line">	</span><br><span class="line">	PARTS:</span><br><span class="line">	Not (in = a, out = nota);</span><br><span class="line">	Not (in = b, out = notb);</span><br><span class="line">	And (a = a, b = notb, out = aAndNotb);</span><br><span class="line">	And (a = nota, b = b, out = NotaAndb);</span><br><span class="line">	Or (a = aAndNotb, b = NotaAndb, out = out);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h4 id="bdiagram-development">&#x2003;&#x2003;<span class="math inline">\(b.\)</span>Diagram development</h4>
<p>&#x2003;&#x2003;Then how can we develop a diagram through its functionality
description? The following steps might help:</p>
<ol type="1">
<li><p><em>draw the boundary of the chip diagram.</em></p>
<ul>
<li>we use this dash to outline for this purpose and what remains
outside the boundary is the user&apos;s view of this gate. In other
word,the,the gate interface.All the users knows is that he or she has a
gate that has two inputs,a and b,an output called out and
altogether.They somehow, this chip as if by magic,delivers Xor
functionality</li>
</ul></li>
</ol>
<p><img src="/2024/04/03/1-4-%E7%A1%AC%E4%BB%B6%E6%8F%8F%E8%BF%B0%E8%AF%AD%E8%A8%80/image-4.png"></p>
<ol start="2" type="1">
<li><p>Notice how the a signal is being copied and sent simultaneously
into two different destinations.Take a as an example, one of them is
sent to <code>And</code> gate and the other <code>Not</code>
gate.</p></li>
<li><p>Whenever you use an off-the-shelf gate,you are bound to <em>use
the names of the gate&apos;s input and output as advertised.</em></p>
<ul>
<li>In other words, the gate comes along with what can be called the
gate&apos;s signature or the gate&apos;s APl. So we have no degrees of freedom
here.</li>
</ul></li>
<li><p>The red connections are use to <em>connect the different chip
parts together</em>. The rule is that every one of these connections
<em>has to be named</em> and it&apos;s our responsibility to come up with
self-descriptive names.</p></li>
</ol>
<h4 id="csomefeatures">&#x2003;&#x2003;<span class="math inline">\(c.\)</span>Some
features</h4>
<ul>
<li><p>The interface of one chip is <strong>unique</strong>. That&apos;s
because there&apos;s only one way to describe the chip.</p></li>
<li><p>The implementation of one chip is not unique, however.</p></li>
<li><p>HDL is a <em>functional or declarative language</em>. There is no
procedure going on.There&apos;s no program execution going on. It is nothing
more than <em>a static description of the gate diagram</em>.</p>
<ul>
<li>So because HDL is a functional language,we can actually write those
HDL statements <em>in any order that we wish</em>.</li>
</ul></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://fyerfyer.github.io.com/2024/04/03/1-2-%E5%B8%83%E5%B0%94%E5%87%BD%E6%95%B0%E5%90%88%E6%88%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="fyerfyer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fyerfyer">
      <meta itemprop="description" content="fyerfyer&apos;s blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | fyerfyer">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/03/1-2-%E5%B8%83%E5%B0%94%E5%87%BD%E6%95%B0%E5%90%88%E6%88%90/" class="post-title-link" itemprop="url">1.2.&#x5E03;&#x5C14;&#x51FD;&#x6570;&#x5408;&#x6210;</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">&#x53D1;&#x8868;&#x4E8E;</span>

      <time title="&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF1A;2024-04-03 14:39:28" itemprop="dateCreated datePublished" datetime="2024-04-03T14:39:28+08:00">2024-04-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">&#x66F4;&#x65B0;&#x4E8E;</span>
      <time title="&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF1A;2024-06-03 16:14:35" itemprop="dateModified" datetime="2024-06-03T16:14:35+08:00">2024-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">&#x5206;&#x7C7B;&#x4E8E;</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/" itemprop="url" rel="index"><span itemprop="name">The Elements of Computer System</span></a>
        </span>
          &#xFF0C;
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/The-Elements-of-Computer-System/Module-1-Boolean-Function/" itemprop="url" rel="index"><span itemprop="name">Module 1.Boolean Function</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="&#x672C;&#x6587;&#x5B57;&#x6570;">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">&#x672C;&#x6587;&#x5B57;&#x6570;&#xFF1A;</span>
      <span>430</span>
    </span>
    <span class="post-meta-item" title="&#x9605;&#x8BFB;&#x65F6;&#x957F;">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
      <span>2 &#x5206;&#x949F;</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="12boolean-function-construction"><span class="math inline">\(1.2.\)</span>Boolean function construction</h1>
<h3 id="1basic-method">1.Basic method</h3>
<p>&#x2003;&#x2003;Our goal is to create a boolean function that fits in the given
truth table. To achieve this, we can do the following steps:</p>
<ol type="1">
<li>Select the line that has the bool value <code>0</code>and
<code>1</code> separately.</li>
<li>For each line that has the bool value <code>0</code>, create a
function that is able to get the value.</li>
<li>Combine these functions with <code>or</code>, thus get a new
function(say <code>f1</code>).</li>
<li>Do the same thing for bool value <code>1</code>&#xFF0C;and get a new
function <code>f2</code>.</li>
<li>Combine the two function with <code>and</code> :
<code>f1 and f2</code>.</li>
</ol>
<p>&#x2003;&#x2003;Take this truth table as an example:</p>
<p><img src="/2024/04/03/1-2-%E5%B8%83%E5%B0%94%E5%87%BD%E6%95%B0%E5%90%88%E6%88%90/image.png"></p>
<ul>
<li>For line 1, 3, 5 that equal <code>1</code>, we each get:
<code>NOT x</code>, <code>NOT x</code>, <code>NOT y</code>.</li>
<li>Thus the new function for <code>1</code> is
<code>NOT x OR NOT x OR NOT y</code>.(Actually, it could have multiple
forms)</li>
<li>For line 2, 4, 6, 7, 8, we each get: <code>NOT z</code>,
<code>NOT y</code>, <code>NOT x</code>, <code>NOT x</code>,
<code>NOT x</code>, <code>NOT x</code>.</li>
<li>Thus the new function for <code>0</code> is
<code>NOT x OR NOT y OR NOT x OR NOT x OR NOT x OR NOT x OR NOT x OR NOT x</code>.</li>
<li>Combine the two new functions, we get the final result:
<code>(NOT x OR NOT x OR NOT y) AND (NOT x OR NOT y OR NOT x OR NOT x OR NOT x OR NOT x OR NOT x OR NOT x)</code>.</li>
</ul>
<p>&#x2003;&#x2003;Once we get the final result, we can use boolean function
calculation to simplify it.</p>
<h3 id="2simplify-the-system">2.Simplify the system</h3>
<p>&#x2003;&#x2003;Actually, we don&apos;t need <code>OR</code> to join the process, we can
complete the task only by <code>AND</code> and <code>NOT</code>. This is
because the <em>De Morgan&apos;s laws</em> allow us to transform an
<code>OR</code> into <code>AND</code> clause.</p>
<p>&#x2003;&#x2003;Furthermore, we define <code>NAND</code> as <code>NOT AND</code>.
For example, <code>x NAND y</code> is equal to <code>NOT x AND y</code>.
We can prove that every boolean function can be represented by only the
<code>NAND</code> statement.</p>
<p>&#x2003;&#x2003;<span class="math inline">\(proof:\)</span>Since we are able to
represent all boolean functions by <code>AND</code> and
<code>NOT</code>, we only need to represent <code>AND</code> and
<code>NOT</code> using <code>NAND</code>:</p>
<ul>
<li><code>NOT x</code> can be represented by <code>x NAND x</code>, this
is obvious.</li>
<li><code>x AND y</code> can be represent by
<code>(x NAND y)NAND(x NAND y)</code>. We can rewrite the statement as
<code>NOT(NOT x AND y)</code>, the statement in the parentheses is
<code>x NAND y</code> itself, so it is transform into
<code>NOT x NAND y</code>. Using <code>NOT</code> representation again,
and we get the result.</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>





</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">



  <div class="copyright">
    &#xA9; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">fyerfyer</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>&#x7AD9;&#x70B9;&#x603B;&#x5B57;&#x6570;&#xFF1A;</span>
    <span title="&#x7AD9;&#x70B9;&#x603B;&#x5B57;&#x6570;">109k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>&#x7AD9;&#x70B9;&#x9605;&#x8BFB;&#x65F6;&#x957F; &#x2248;</span>
    <span title="&#x7AD9;&#x70B9;&#x9605;&#x8BFB;&#x65F6;&#x957F;">6:35</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="&#x603B;&#x8BBF;&#x5BA2;&#x91CF;">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="&#x603B;&#x8BBF;&#x95EE;&#x91CF;">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">&#x7531; <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> &amp; <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> &#x5F3A;&#x529B;&#x9A71;&#x52A8;
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"all","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
